{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":"<p>\u6b22\u8fce\u8bbf\u95ee\uff01\u6211\u662f\u4e00\u540d\u540e\u7aef\u5f00\u53d1\u5de5\u7a0b\u5e08\uff0c\u4e3b\u8981\u4f7f\u7528 Java\uff0c\u5076\u5c14\u4e5f\u4f1a\u627f\u62c5\u4e00\u4e9b\u8fd0\u7ef4\u76f8\u5173\u5de5\u4f5c\u3002\u8fd9\u91cc\u4e3b\u8981\u8bb0\u5f55\u6211\u7684\u4e2a\u4eba\u7b14\u8bb0\uff0c\u65b9\u4fbf\u81ea\u67e5\uff0c\u4e5f\u5e0c\u671b\u80fd\u4e3a\u4f60\u63d0\u4f9b\u5e2e\u52a9\u3002</p> <p>\u5982\u679c\u60a8\u6709\u4efb\u4f55\u95ee\u9898\u6216\u5efa\u8bae\uff0c\u6b22\u8fce\u4ea4\u6d41\u8ba8\u8bba\uff01 \u90ae\u7bb1\uff1asuomea@qq.com</p>"},{"location":"#_1","title":"\ud83d\udd16\u4e3b\u8981\u5185\u5bb9\u5206\u7c7b","text":"<p>\u200b\u200b\ud83d\udcbd \u6570\u636e\u5e93\u200b\u200b</p> <p>MySQL\u3001Redis\u3001Doris\u3001DM\u3001PostgreSQL\u3002</p> <p>\u200b\u200b\u2615 Java \u6280\u672f\u6808\u200b\u200b</p> <p>Java\u3001Spring\u3001MyBatis\u3002</p> <p>\u200b\u200b\ud83d\udee0 \u8fd0\u7ef4\u76f8\u5173\u200b\u200b</p> <p>Linux\u3001Nginx\u3001Docker\u3001K8s\u3002</p> <p>\u200b\u200b\u26f0 \u4e09\u5ea7\u5927\u5c71\u200b\u200b</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u3001\u8ba1\u7b97\u673a\u7f51\u7edc\u3001\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5\u3002</p> <p>\u200b\u200b\ud83d\udcca \u5927\u6570\u636e\u751f\u6001\u200b\u200b</p> <p>Kafka\u3001Hadoop\u3001Flink\u3002</p>"},{"location":"BigData/Flink/Flink%20Tips/","title":"Flink Tips","text":""},{"location":"BigData/Flink/Flink%20Tips/#flink","title":"Flink","text":"<p><code>JobManager</code> \u5bf9\u4f5c\u4e1a\u8fdb\u884c\u8c03\u5ea6\uff0c\u5206\u53d1\u7ed9 <code>TaskManager</code>\u3002 <code>TaskManager</code> \u6267\u884c\u4efb\u52a1\u3002</p>"},{"location":"BigData/Flink/Flink%20Tips/#_1","title":"\u4f1a\u8bdd\u6a21\u5f0f","text":"<p>Session \u4f1a\u8bdd\u6a21\u5f0f\u9700\u8981\u5148\u542f\u52a8\u4e00\u4e2a Flink \u96c6\u7fa4\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u5411\u96c6\u7fa4\u63d0\u4ea4\u4f5c\u4e1a\u3002\u96c6\u7fa4\u662f\u4e00\u76f4\u8fd0\u884c\u7684\uff0c\u8d44\u6e90\u603b\u91cf\u4e5f\u662f\u56fa\u5b9a\u7684\u3002\u5ba2\u6237\u7aef\u63d0\u4ea4\u7684\u591a\u4e2a\u4efb\u52a1\u4f1a\u7ade\u4e89\u96c6\u7fa4\u4e2d\u7684\u8d44\u6e90\u3002 \u8fd9\u79cd\u6a21\u5f0f\u9002\u5408\u5355\u4e2a\u89c4\u6a21\u5c0f\u3001\u6267\u884c\u65f6\u95f4\u77ed\u7684\u5927\u91cf\u4f5c\u4e1a\u3002</p>"},{"location":"BigData/Flink/Flink%20Tips/#_2","title":"\u5355\u4f5c\u4e1a\u6a21\u5f0f","text":"<p>Pre-Job \u5355\u4f5c\u4e1a\u6a21\u5f0f\u4e3a\u6bcf\u4e2a\u63d0\u4ea4\u7684\u4f5c\u4e1a\u542f\u52a8\u4e00\u4e2a\u5355\u72ec\u7684\u96c6\u7fa4\uff0c\u4f5c\u4e1a\u5b8c\u6210\u4e4b\u540e\uff0c\u96c6\u7fa4\u5c31\u4f1a\u5173\u95ed\uff0c\u6240\u6709\u7684\u8d44\u6e90\u91ca\u653e\u3002 Flink \u672c\u8eab\u65e0\u6cd5\u76f4\u63a5\u8fd9\u6837\u8fd0\u884c\uff0c\u9700\u8981\u501f\u52a9\u8d44\u6e90\u7ba1\u7406\u6846\u67b6\u5982 YARN\u3001Kubernetes \u6765\u542f\u52a8\u5355\u4f5c\u4e1a\u6a21\u5f0f\u3002</p>"},{"location":"BigData/Flink/Flink%20Tips/#_3","title":"\u5e94\u7528\u6a21\u5f0f","text":""},{"location":"BigData/Flink/Flink%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/","title":"Flink \u5feb\u901f\u5f00\u59cb","text":""},{"location":"BigData/Flink/Flink%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/#_1","title":"\u5355\u8bcd\u8ba1\u6570","text":"<p>\u4f9d\u8d56\uff1a <pre><code>        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n            &lt;artifactId&gt;flink-streaming-java&lt;/artifactId&gt;\n            &lt;version&gt;1.20.0&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n            &lt;artifactId&gt;flink-clients&lt;/artifactId&gt;\n            &lt;version&gt;1.20.0&lt;/version&gt;\n        &lt;/dependency&gt;\n</code></pre></p> <p>\u4ee3\u7801\uff1a <pre><code>import org.apache.flink.api.common.functions.FlatMapFunction;\nimport org.apache.flink.api.java.tuple.Tuple2;\nimport org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;\nimport org.apache.flink.util.Collector;\n\nimport java.util.Arrays;\n\npublic class WordCount {\n    public static void main(String[] args) throws Exception{\n        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\n        env.fromData(Arrays.asList(\"hello world\", \"nihao shijie\", \"hello jacky\"))\n                .flatMap(new FlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() {\n                    @Override\n                    public void flatMap(String s, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; collector) throws Exception {\n                        String[] words = s.split(\" \");\n                        for (String word : words) {\n                            collector.collect(Tuple2.of(word, 1));\n                        }\n                    }\n                })\n                .keyBy(item -&gt; item.f0)\n                .sum(1)\n                .print();\n\n        env.execute(\"Word Count Example\");\n    }\n}\n</code></pre></p> <p>\u8f93\u51fa\uff1a <pre><code>3&gt; (hello,1)\n3&gt; (hello,2)\n6&gt; (world,1)\n3&gt; (shijie,1)\n1&gt; (nihao,1)\n9&gt; (jacky,1)\n</code></pre></p>"},{"location":"BigData/Flink/Flink%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/#_2","title":"\u5355\u8bcd\u8ba1\u6570\u5347\u7ea7","text":"<p>\u670d\u52a1\u5668\u76d1\u542c\u7aef\u53e3 <code>nc -lk 8080</code>\u3002\u670d\u52a1\u7aef\u76d1\u542c <code>listen 8080</code> \u7aef\u53e3\u5e76\u4fdd\u6301 <code>keep</code> \u8fde\u63a5\uff0c\u80fd\u591f\u901a\u8fc7\u547d\u4ee4\u884c\u5411\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u53d1\u9001\u6570\u636e\u3002</p> <p>\u4ee3\u7801\uff1a <pre><code>import org.apache.flink.api.common.functions.FlatMapFunction;  \nimport org.apache.flink.api.java.tuple.Tuple2;  \nimport org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;  \nimport org.apache.flink.util.Collector;  \n\npublic class WordCountFromSocket {  \n    public static void main(String[] args) throws Exception{  \n        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();  \n        env.socketTextStream(\"localhost\", 8080)  \n                .flatMap(new FlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() {  \n                    @Override  \n                    public void flatMap(String s, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; collector) throws Exception {  \n                        for (String word : s.split(\" \")) {  \n                            collector.collect(Tuple2.of(word, 1));  \n                        }  \n                    }  \n                })  \n                .keyBy(item -&gt; item.f0)  \n                .sum(1)  \n                .print();  \n        env.execute();  \n    }  \n}\n</code></pre></p>"},{"location":"BigData/Flink/Flink%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/#flink","title":"Flink \u96c6\u7fa4\u7684\u89d2\u8272","text":"<p><code>Client</code> \u63d0\u4ea4\u4f5c\u4e1a\uff0c\u4e0d\u662f\u8fd0\u884c\u65f6\u548c\u6267\u884c\u7a0b\u5e8f\u7684\u4e00\u90e8\u5206\u3002</p> <p><code>JobManager</code> \u8c03\u5ea6\u4f5c\u4e1a\uff0c\u9ed8\u8ba4\u8fdb\u7a0b\u4e3a <code>org.apache.flink.runtime.entrypoint.StandaloneSessionClusterEntrypoint</code>\u3002</p> <p><code>TaskManager</code> \u6267\u884c\u4f5c\u4e1a\uff0c\u8fde\u63a5\u5230 <code>JobManager</code> \u5ba3\u5e03\u81ea\u5df1\u53ef\u7528\uff0c\u5e76\u88ab\u5206\u914d\u5de5\u4f5c\u3002\u9ed8\u8ba4\u8fdb\u7a0b\u4e3a <code>org.apache.flink.runtime.taskexecutor.TaskManagerRunner</code>\u3002</p>"},{"location":"BigData/Flink/Flink%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/#flink_1","title":"\u63d0\u4ea4\u4f5c\u4e1a\u7ed9 Flink \u96c6\u7fa4","text":"<p>\u542f\u52a8\u670d\u52a1\u3002 <pre><code>./bin/start-cluster.sh\n</code></pre> <code>Web</code> \u5730\u5740\u9ed8\u8ba4\u4e3a <code>http://localhost:8081/#/overview</code> \u9ed8\u8ba4\u53ea\u6709 <code>localhost</code> \u8bbf\u95ee\uff0c\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 <code>rest.bin-address</code> \u7ed1\u5b9a <code>0.0.0.0</code> \u5373\u53ef\u3002</p> <p>\u914d\u7f6e\u4f9d\u8d56\u548c\u6253\u5305\u63d2\u4ef6\uff0c\u7136\u540e\u6253\u5305\u9879\u76ee\u3002 <pre><code>    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n            &lt;artifactId&gt;flink-streaming-java&lt;/artifactId&gt;\n            &lt;version&gt;1.20.0&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n            &lt;artifactId&gt;flink-clients&lt;/artifactId&gt;\n            &lt;version&gt;1.20.0&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n\n    &lt;/dependencies&gt;\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.1.1&lt;/version&gt;\n                &lt;executions&gt;\n                    &lt;execution&gt;\n                        &lt;phase&gt;package&lt;/phase&gt;\n                        &lt;goals&gt;\n                            &lt;goal&gt;shade&lt;/goal&gt;\n                        &lt;/goals&gt;\n                        &lt;configuration&gt;\n                            &lt;artifactSet&gt;\n                                &lt;excludes&gt;\n                                    &lt;exclude&gt;com.google.code.findbugs:jsr305&lt;/exclude&gt;\n                                &lt;/excludes&gt;\n                            &lt;/artifactSet&gt;\n                            &lt;filters&gt;\n                                &lt;filter&gt;\n                                    &lt;!-- Do not copy the signatures in the META-INF folder.\n                                    Otherwise, this might cause SecurityExceptions when using the JAR. --&gt;\n                                    &lt;artifact&gt;*:*&lt;/artifact&gt;\n                                    &lt;excludes&gt;\n                                        &lt;exclude&gt;META-INF/*.SF&lt;/exclude&gt;\n                                        &lt;exclude&gt;META-INF/*.DSA&lt;/exclude&gt;\n                                        &lt;exclude&gt;META-INF/*.RSA&lt;/exclude&gt;\n                                    &lt;/excludes&gt;\n                                &lt;/filter&gt;\n                            &lt;/filters&gt;\n                            &lt;transformers&gt;\n                                &lt;transformer implementation=\"org.apache.maven.plugins.shade.resource.ManifestResourceTransformer\"&gt;\n                                    &lt;!-- Replace this with the main class of your job --&gt;\n                                    &lt;mainClass&gt;my.programs.main.clazz&lt;/mainClass&gt;\n                                &lt;/transformer&gt;\n                                &lt;transformer implementation=\"org.apache.maven.plugins.shade.resource.ServicesResourceTransformer\"/&gt;\n                            &lt;/transformers&gt;\n                        &lt;/configuration&gt;\n                    &lt;/execution&gt;\n                &lt;/executions&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n</code></pre></p> <p>Tips \u4f9d\u8d56\u914d\u7f6e\u4e3a provided \u4e4b\u540e idea \u8fd0\u884c\u4f1a\u63d0\u793a\u627e\u4e0d\u5230\u7c7b\uff0c\u70b9\u51fb\u4e0b\u56fe\u5de6\u4e0b\u89d2\u7684 Edit configuration templates\uff0c\u52fe\u9009 <code>Add dependencies with \"provided\" scope to classpath</code> \u5373\u53ef\u5728\u672c\u5730\u8fd0\u884c\u3002 </p> <p>\u767b\u5f55 Flink Web\uff0c\u8fdb\u5165\u63d0\u4ea4\u4f5c\u4e1a\u754c\u9762\uff0c\u70b9\u89e3 Add New\uff0c\u9009\u62e9 jar \u5305\u3002 </p> <p>\u70b9\u51fb\u4e0a\u4f20\u7684 jar \u5305\uff0c\u7f16\u8f91\u586b\u5165\u5165\u53e3\u7c7b\uff0c\u7136\u540e\u70b9\u51fb Submit \u4f1a\u7acb\u5373\u6267\u884c\u5165\u53e3\u7c7b\u4ee3\u7801\u3002\u53ef\u4ee5\u591a\u6b21 Submit \u4e0d\u540c\u7684\u5165\u53e3\u7c7b\u3002 </p> <p>\u5728 Jobs \u754c\u9762\u53ef\u4ee5\u770b\u5230\u63d0\u4ea4\u7684\u4f5c\u4e1a\uff0c\u4ee5\u53ca\u8fd0\u884c\u72b6\u6001\uff0c\u8fd0\u884c\u5728\u54ea\u4e2a TaskManager \u4e0a\u3002\u5728\u4f5c\u4e1a\u8be6\u60c5\u754c\u9762\u7684\u5de6\u4e0a\u89d2\u53ef\u4ee5 Cancel Job\u3002  </p> <p>\u8fdb\u5165\u5230\u5177\u4f53\u7684 TaskManager \u4e4b\u540e\uff0c\u53ef\u4ee5\u5728 Stdout \u770b\u5230\u8f93\u51fa\u3002 </p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u884c\u63d0\u4ea4\u4f5c\u4e1a\uff0c<code>-d</code> \u8868\u793a\u5206\u79bb\u6a21\u5f0f\u8fd0\u884c\u3002 <pre><code>% bin/flink run -m localhost:8081 -d -c com.otto.WordCountFromSocket flink-1.0-SNAPSHOT.jar\u00a0\nJob has been submitted with JobID d4c29ebd42a91596e36619d7e679cef1\n</code></pre></p> <p>\u505c\u6b62 Flink \u670d\u52a1 <pre><code>bin/stop-cluster.sh\n</code></pre></p> <p>YARN \u6a21\u5f0f\u8fd0\u884c</p> <pre><code>export HADOOP_HOME=/usr/local/hadoop-3.4.1\nexport PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin\n\nexport HADOOP_CLASSPATH=`hadoop_classpath`\nexport HADOOP_CONF_DIR=$HADOOP_HOME/etc/hadoop\n</code></pre>"},{"location":"BigData/Flink/Flink%20%E7%AA%97%E5%8F%A3/","title":"Flink \u7a97\u53e3","text":"<p>\u7a97\u53e3\u662f\u6d41\u5904\u7406\u7684\u6838\u5fc3\u6982\u5ff5\u4e4b\u4e00\uff0c\u7528\u4e8e\u5c06\u65e0\u754c\u7684\u6570\u636e\u6d41\u5212\u5206\u4e3a\u6709\u9650\u5927\u5c0f\u7684\u5757\uff0c\u4ee5\u4fbf\u8fdb\u884c\u805a\u5408\u3001\u7edf\u8ba1\u7b49\u6709\u754c\u6570\u636e\u5904\u7406\u3002</p>"},{"location":"BigData/Flink/Flink%20%E7%AA%97%E5%8F%A3/#_1","title":"\u7a97\u53e3\u7684\u751f\u547d\u5468\u671f","text":"<p>\u7a97\u53e3\u7684\u521b\u5efa\u65f6\u673a\u662f\u5f53\u5c5e\u4e8e\u8be5\u7a97\u53e3\u7684\u7b2c\u4e00\u4e2a\u6570\u636e\u5230\u8fbe\u65f6\u3002 \u7a97\u53e3\u7684\u8ba1\u7b97\u65f6\u673a\u662f\u5f53\u65f6\u95f4\u5230\u8fbe\u6216\u8005\u5143\u7d20\u6570\u91cf\u8fbe\u5230\u9608\u503c\u65f6\u5904\u7f5a\u7a97\u53e3\u8ba1\u7b97\u3002 \u7a97\u53e3\u7684\u9500\u6bc1\u65f6\u673a\u662f\u5b8c\u6210\u8ba1\u7b97\u4e4b\u540e\u3002</p>"},{"location":"BigData/Flink/Flink%20%E7%AA%97%E5%8F%A3/#_2","title":"\u7a97\u53e3\u7684\u7c7b\u578b","text":"<p>\u6309\u7167\u65f6\u95f4\u5212\u5206\u4e3a \u6eda\u52a8\u7a97\u53e3\uff0c\u5927\u5c0f\u56fa\u5b9a\uff0c\u4e0d\u91cd\u53e0\u3002</p> <p>\u6ed1\u52a8\u7a97\u53e3\uff0c\u5927\u5c0f\u56fa\u5b9a\uff0c\u53ef\u91cd\u53e0\uff08\u901a\u8fc7\u6ed1\u52a8\u6b65\u957f\u63a7\u5236\uff09\u3002</p> <p>\u4f1a\u8bdd\u7a97\u53e3\uff0c</p> <p>\u6309\u7167\u8ba1\u6570\u5212\u5206\u4e3a \u6eda\u52a8\u8ba1\u6570\u7a97\u53e3\uff0c\u6bcf N \u6761\u6570\u636e\u89e6\u53d1\u4e00\u6b21\u8ba1\u7b97\u3002</p> <p>\u6ed1\u52a8\u8ba1\u6570\u7a97\u53e3\uff0c\u6bcf M \u6761\u6570\u636e\u6ed1\u52a8\u4e00\u6b21\uff0c\u7edf\u8ba1\u6700\u65b0 N \u6761\u6570\u636e\u3002</p>"},{"location":"BigData/Flink/Flink%20%E7%AA%97%E5%8F%A3/#api","title":"\u7a97\u53e3\u7684 API \u64cd\u4f5c","text":"<p>\u6307\u5b9a\u7a97\u53e3\u5206\u914d\u5668\uff0c\u8bbe\u7f6e\u7a97\u53e3\u7684\u7c7b\u578b \u5982\u679c\u5f00\u7a97\u4e4b\u524d\uff0c\u6ca1\u6709\u8fdb\u884c keyBy \u64cd\u4f5c\uff0c\u90a3\u4e48\u7a97\u53e3\u903b\u8f91\u53ea\u80fd\u5728\u4e00\u4e2a\u4efb\u52a1\u4e0a\u8fd0\u884c\uff0c\u76f8\u5f53\u4e8e\u5e76\u884c\u5ea6\u4e3a 1\uff1b\u5982\u679c\u8fdb\u884c\u4e86 keyBy \u64cd\u4f5c\uff0c\u76f8\u5f53\u4e8e\u6bcf\u4e2a key \u90fd\u5b9a\u4e49\u4e86\u7a97\u53e3\uff0c\u5404\u81ea\u72ec\u7acb\u8ba1\u7b97\u3002</p> <p>keyBy \u7684\u6570\u636e\u6d41\u4f7f\u7528 window \u51fd\u6570\uff0c\u6ca1\u6709 keyBy \u7684\u6570\u636e\u6d41\u4f7f\u7528 windowAll \u51fd\u6570\u3002</p> <pre><code>          // \u57fa\u4e8e\u65f6\u95f4\u7684\u7a97\u53e3  \n//        .window(TumblingProcessingTimeWindows.of(Duration.of(200, ChronoUnit.MILLIS)))  \n//        .window(TumblingEventTimeWindows.of(Duration.of(200, ChronoUnit.MILLIS)))  \n//        .window(SlidingEventTimeWindows.of(Duration.of(200, ChronoUnit.MILLIS), Duration.of(1000, ChronoUnit.MILLIS)))  \n//        .window(SlidingProcessingTimeWindows.of(Duration.of(200, ChronoUnit.MILLIS), Duration.of(1000, ChronoUnit.MILLIS)))  \n//        .window(ProcessingTimeSessionWindows.withGap(Duration.of(200, ChronoUnit.MILLIS)))  \n\n          // \u57fa\u4e8e\u6570\u91cf\u7684\u7a97\u53e3  \n//        .countWindow(100) // \u6eda\u52a8\u7a97\u53e3 5 \u4e2a\u5143\u7d20  \n//        .countWindow(5, 2) // \u6ed1\u52a8\u7a97\u53e3 5 \u4e2a\u5143\u7d20\uff0c2 \u4e2a\u6b65\u957f\n</code></pre> <p>\u89e3\u6790\u4e00\u4e9b TumblingProcessingTimeWidows \u7684\u6e90\u7801 <pre><code>public static TumblingProcessingTimeWindows of(Duration size) {  \n    return new TumblingProcessingTimeWindows(size.toMillis(), 0, WindowStagger.ALIGNED);  \n}\n\nprivate TumblingProcessingTimeWindows(long size, long offset, WindowStagger windowStagger) {  \n    if (Math.abs(offset) &gt;= size) {  \n        throw new IllegalArgumentException(  \n                \"TumblingProcessingTimeWindows parameters must satisfy abs(offset) &lt; size\");  \n    }  \n\n    this.size = size;  \n    this.globalOffset = offset;  \n    this.windowStagger = windowStagger;  \n}\n\n@Override  \npublic Collection&lt;TimeWindow&gt; assignWindows(  \n        Object element, long timestamp, WindowAssignerContext context) {  \n    final long now = context.getCurrentProcessingTime();  \n    if (staggerOffset == null) {  \n        staggerOffset =  \n                windowStagger.getStaggerOffset(context.getCurrentProcessingTime(), size);  \n    }  \n    long start =  \n            TimeWindow.getWindowStartWithOffset(  \n                    now, (globalOffset + staggerOffset) % size, size);  \n    return Collections.singletonList(new TimeWindow(start, start + size));  \n}\n\n// \u5982\u679c\u7a97\u53e3\u7684\u957f\u5ea6\u4e3a 10\uff0c\u90a3\u4e48 2025-01-01 01:01:23 \u65f6\u95f4\u7684\u6570\u636e\uff0c\u5c31\u5c5e\u4e8e 2025-01-01 01:01:20 - 2025-01-01 01:01:30 \u8fd9\u4e2a\u7a97\u53e3\npublic static long getWindowStartWithOffset(long timestamp, long offset, long windowSize) {  \n    final long remainder = (timestamp - offset) % windowSize;  \n    // handle both positive and negative cases  \n    if (remainder &lt; 0) {  \n        return timestamp - (remainder + windowSize);  \n    } else {  \n        return timestamp - remainder;  \n    }  \n}\n</code></pre></p>"},{"location":"BigData/Flink/Flink%20%E7%AA%97%E5%8F%A3/#_3","title":"\u7b80\u5355\u805a\u5408","text":"<p>sum\u3001min\u3001minBy\u3001max\u3001maxBy\u3002</p>"},{"location":"BigData/Flink/Flink%20%E7%AA%97%E5%8F%A3/#_4","title":"\u589e\u91cf\u805a\u5408\u51fd\u6570","text":"<p>\u6765\u4e00\u6761\u6570\u636e\u8ba1\u7b97\u4e00\u6b21\uff0c\u7a97\u53e3\u89e6\u53d1\u7684\u65f6\u5019\u8f93\u51fa\u8ba1\u7b97\u7ed3\u679c reduce\uff0c\u4e24\u4e24\u805a\u5408\uff0c\u6765\u4e00\u6761\u6570\u636e\u5c31\u8ba1\u7b97\u4e00\u6b21\uff0c\u53ea\u6709\u4e00\u6761\u6570\u636e\u4e0d\u4f1a\u89e6\u53d1\u8ba1\u7b97\u3002\u6ce8\u610f\uff0c\u8be5\u51fd\u6570\u7684\u8f93\u5165\u3001\u4e2d\u95f4\u72b6\u6001\u548c\u8f93\u51fa\u7c7b\u578b\u9700\u8981\u4e00\u81f4\u3002 <pre><code>ds  \n        .keyBy(VehicleGps::getPlate)  \n                .window(TumblingProcessingTimeWindows.of(Duration.of(200, ChronoUnit.MILLIS)))  \n                        .reduce(new ReduceFunction&lt;VehicleGps&gt;() {  \n                            @Override  \n                            public VehicleGps reduce(VehicleGps vehicleGps, VehicleGps t1) throws Exception {  \n                                return null;  \n                            }  \n                        })\n</code></pre> aggregate\uff0c\u57fa\u672c\u7b49\u540c\u4e8e reduce\uff0c\u4f46\u662f\u8f93\u5165\u3001\u7d2f\u52a0\u72b6\u6001\u3001\u8f93\u51fa\u7c7b\u578b\u53ef\u4ee5\u90fd\u4e0d\u4e00\u81f4\u3002 <pre><code>ds  \n        .keyBy(VehicleGps::getPlate)  \n                .window(TumblingProcessingTimeWindows.of(Duration.of(200, ChronoUnit.MILLIS)))  \n                        .aggregate(new AggregateFunction&lt;VehicleGps, Integer, Integer&gt;() {  \n                            @Override  \n                            public Integer createAccumulator() {  \n                                return null;  \n                            }  \n\n                            @Override  \n                            public Integer add(VehicleGps vehicleGps, Integer o) {  \n                                return null;  \n                            }  \n\n                            @Override  \n                            public Integer getResult(Integer o) {  \n                                return null;  \n                            }  \n\n                            @Override  \n                            public Integer merge(Integer o, Integer acc1) {  \n                                return null;  \n                            }  \n                        })\n</code></pre></p> <p>\u589e\u91cf\u805a\u5408\u4e5f\u53ef\u4ee5\u62ff\u5230\u7a97\u53e3\u4e0a\u4e0b\u6587\uff0c\u793a\u4f8b\uff1a <pre><code>ds  \n        .keyBy(VehicleGps::getPlate)  \n                .window(TumblingProcessingTimeWindows.of(Duration.of(200, ChronoUnit.MILLIS)))  \n                        .aggregate(new AggregateFunction&lt;VehicleGps, Integer, Integer&gt;() {  \n                            @Override  \n                            public Integer createAccumulator() {  \n                                return null;  \n                            }  \n\n                            @Override  \n                            public Integer add(VehicleGps vehicleGps, Integer o) {  \n                                return null;  \n                            }  \n\n                            @Override  \n                            public Integer getResult(Integer o) {  \n                                return null;  \n                            }  \n\n                            @Override  \n                            public Integer merge(Integer o, Integer acc1) {  \n                                return null;  \n                            }  \n                        }, \n                        // public abstract class ProcessWindowFunction&lt;IN, OUT, KEY, W extends Window&gt;  \n                        new ProcessWindowFunction&lt;Integer, String, String, TimeWindow&gt;() {  \n                            @Override  \n                            public void process(String s, ProcessWindowFunction&lt;Integer, String, String, TimeWindow&gt;.Context context, Iterable&lt;Integer&gt; elements, Collector&lt;String&gt; out) throws Exception {  \n\n                            }  \n                        });\n</code></pre> \u8fd9\u91cc\u7684 ProcessWindowFunction \u7a97\u53e3\u51fd\u6570\u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21\uff0c\u5373 elements \u53ea\u6709\u4e00\u6761\u6570\u636e\uff0c\u5c31\u662f AggregateFunction \u7a97\u53e3\u8ba1\u7b97\u5b8c\u6210\u540e\u7684\u7ed3\u679c\u3002\u8fd9\u6837\uff0c\u5c31\u80fd\u5728\u589e\u91cf\u805a\u5408\u51fd\u6570\u4e2d\u62ff\u5230\u7a97\u53e3\u4e0a\u4e0b\u6587\u4fe1\u606f\u4e86\u3002 </p>"},{"location":"BigData/Flink/Flink%20%E7%AA%97%E5%8F%A3/#_5","title":"\u5168\u7a97\u53e3\u51fd\u6570","text":"<p>\u6570\u636e\u6765\u4e86\u4e0d\u8fdb\u884c\u8ba1\u7b97\uff0c\u7a97\u53e3\u89e6\u53d1\u7684\u65f6\u5019\u8ba1\u7b97\u5e76\u8f93\u51fa\u7ed3\u679c process  <pre><code>ds  \n    .keyBy(VehicleGps::getPlate)  \n    .window(TumblingProcessingTimeWindows.of(Duration.of(200, ChronoUnit.MILLIS)))  \n    .process(new ProcessWindowFunction&lt;VehicleGps, String, String, TimeWindow&gt;() {  \n        /**\n        * s keyBy \u7684 key\n        * context \u7a97\u53e3\u4e0a\u4e0b\u6587\n        * iterable \u7a97\u53e3\u5185\u7684\u6570\u636e\n        * collector \u91c7\u96c6\u5668\n        */\n        @Override  \n        public void process(String s, Context context, Iterable&lt;VehicleGps&gt; iterable, Collector&lt;String&gt; collector) throws Exception {  \n\n        }  \n    })\n</code></pre></p> <p>\u7a97\u53e3\u4e0a\u4e0b\u6587\u652f\u6301\u7684\u529f\u80fd <pre><code>public abstract W window();  \n\npublic abstract long currentProcessingTime();  \n\npublic abstract long currentWatermark();  \n\npublic abstract KeyedStateStore windowState();  \n\npublic abstract KeyedStateStore globalState();  \n\npublic abstract &lt;X&gt; void output(OutputTag&lt;X&gt; var1, X var2);\n</code></pre></p>"},{"location":"BigData/Flink/Flink%20%E7%AA%97%E5%8F%A3/#_6","title":"\u7a97\u53e3\u7684\u65f6\u95f4\u8bed\u4e49","text":"<p>\u4e8b\u4ef6\u65f6\u95f4</p> <p>\u5904\u7406\u65f6\u95f4</p>"},{"location":"BigData/Flink/Flink%20%E8%AF%BB%E5%8F%96%20Kafka%20%E6%95%B0%E6%8D%AE/","title":"Flink \u8bfb\u53d6 Kafka \u6570\u636e","text":"<p>\u6dfb\u52a0\u4f9d\u8d56 <pre><code>&lt;dependency&gt;  \n    &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;  \n    &lt;artifactId&gt;flink-streaming-java&lt;/artifactId&gt;  \n    &lt;version&gt;1.20.0&lt;/version&gt;  \n&lt;/dependency&gt;  \n\n&lt;dependency&gt;  \n    &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;  \n    &lt;artifactId&gt;flink-clients&lt;/artifactId&gt;  \n    &lt;version&gt;1.20.0&lt;/version&gt;  \n&lt;/dependency&gt;  \n\n&lt;dependency&gt;  \n    &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;  \n    &lt;artifactId&gt;flink-connector-base&lt;/artifactId&gt;  \n    &lt;version&gt;1.20.0&lt;/version&gt;  \n&lt;/dependency&gt;  \n\n&lt;dependency&gt;  \n    &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;  \n    &lt;artifactId&gt;flink-connector-kafka&lt;/artifactId&gt;  \n    &lt;version&gt;3.1.0-1.18&lt;/version&gt;  \n&lt;/dependency&gt;\n</code></pre></p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();  \nenv.setParallelism(3);  \n\nKafkaSource&lt;String&gt; kafkaSource = KafkaSource.&lt;String&gt;builder()  \n        .setBootstrapServers(\"192.168.31.115:9092\")  \n        .setGroupId(\"jacky-flink\")  \n        .setTopics(\"quickstart-events\")  \n        .setValueOnlyDeserializer(new SimpleStringSchema())  \n        .setStartingOffsets(OffsetsInitializer.latest())  \n        .build();  \n\nenv.fromSource(kafkaSource, WatermarkStrategy.noWatermarks(), \"kafkaQuickstartEvents\")  \n        .print();  \n\nenv.execute();\n</code></pre></p> <p>\u5173\u4e8e offset Kafka \u7684\u53c2\u6570 auto.reset.offsets \u7684\u914d\u7f6e - earliest\uff1a\u5982\u679c\u5b58\u5728 offset\uff0c\u5219\u4ece offset \u5f00\u59cb\u6d88\u8d39\uff1b\u5426\u5219\u4ece\u6700\u65e9\u7684\u6570\u636e\u5f00\u59cb\u6d88\u8d39\u3002 - latest\uff1a\u5982\u679c\u5b58\u5728 offset\uff0c\u5219\u4ece offset \u5f00\u59cb\u6d88\u8d39\uff1b\u5426\u5219\u4ece\u6700\u65b0\u7684\u6570\u636e\u5f00\u59cb\u6d88\u8d39\u3002</p> <p>Flink \u7684 setStartingOffsets \u65b9\u6cd5\u53c2\u6570\uff1a - OffsetsInitializer.earliest()\uff1a\u4ece\u6700\u65e9\u7684\u6570\u636e\u5f00\u59cb\u6d88\u8d39\u3002 - OffsetsInitializer.latest()\uff1a\u4ece\u6700\u65b0\u7684\u6570\u636e\u5f00\u59cb\u6d88\u8d39\u3002</p>"},{"location":"BigData/Flink/Flink%20%E8%BD%AC%E6%8D%A2%E7%AE%97%E5%AD%90/","title":"Flink \u8f6c\u6362\u7b97\u5b50","text":"<p>keyBy \u5c06\u6570\u636e\u6d41\u5212\u5206\u4e3a\u591a\u4e2a\u903b\u8f91\u5206\u533a\uff0c\u76f8\u540c\u7684 key \u7684\u6570\u636e\u4f1a\u5206\u914d\u5230\u540c\u4e00\u4e2a\u5206\u533a\uff08\u540c\u4e00\u4e2a\u5b50\u4efb\u52a1\u5904\u7406\uff09\u3002</p> <p>keyBy \u4e4b\u540e\u8fd4\u56de KeyedStream</p> <p>\u652f\u6301 sum\u3001max\u3001min\u3001maxBy\u3001minBy \u7b49\u7b80\u5355\u805a\u5408\u7b97\u5b50 max\uff1a\u53ea\u4f1a\u53d6\u6bd4\u8f83\u5b57\u6bb5\u7684\u6700\u5927\u503c\uff0c\u5206\u6bd4\u8f83\u5b57\u6bb5\u4fdd\u7559\u7b2c\u4e00\u6b21\u7684\u503c\u3002 maxBy\uff1a\u53d6\u6bd4\u8f83\u5b57\u6bb5\u7684\u6700\u5927\u503c\uff0c\u540c\u65f6\u975e\u6bd4\u8f83\u5b57\u6bb5\u53d6\u6700\u5927\u503c\u7684\u8fd9\u6761\u6570\u636e\u7684\u503c\u3002</p> <p>reduce \u4e24\u4e24\u805a\u5408 \u5bf9\u6570\u636e\u6d41\u4e2d\u7684\u5143\u7d20\u8fdb\u884c\u4e24\u4e24\u5408\u5e76\uff0c\u5c5e\u4e8e\u589e\u91cf\u805a\u5408\uff0c\u6bcf\u6765\u4e00\u6761\u6570\u636e\u5c31\u8ba1\u7b97\u4e00\u6b21\u3002\u8f93\u5165\u548c\u8f93\u51fa\u7c7b\u578b\u5fc5\u987b\u76f8\u540c\u3002\u6ce8\u610f\uff0c\u903b\u8f91\u5206\u533a\u5185\u7684\u7b2c\u4e00\u6761\u6570\u636e\u4e0d\u4f1a\u8d70\u805a\u5408\u903b\u8f91\uff0c\u56e0\u4e3a\u8fd8\u6ca1\u6709\u7b2c\u4e8c\u6761\u6570\u636e\u3002\u5982\u679c\u7b2c\u4e09\u6761\u6570\u636e\u8fdb\u6765\uff0c\u90a3\u4e48 reduce \u7684 tempData \u53c2\u6570\u5c31\u662f\u7b2c\u4e00\u6761\u548c\u7b2c\u4e8c\u6761 reduce \u8fd4\u56de\u7684\u7ed3\u679c\uff0ct1 \u662f\u7b2c\u4e09\u6761\u6570\u636e\u3002 <pre><code>ds  \n        .keyBy(TempData::getId)  \n        .reduce((ReduceFunction&lt;TempData&gt;) (tempData, t1) -&gt; {  \n            TempData result = new TempData();  \n            result.setId(tempData.getId());  \n            result.setTime(null);  \n            result.setTemp(tempData.getTemp() + t1.getTemp());  \n            return result;  \n        })  \n        .map(JSON::toJSONString)  \n        .print();\n</code></pre></p>"},{"location":"BigData/Hadoop/Hadoop%20Tips/","title":"Hadoop Tips","text":""},{"location":"BigData/Hadoop/Hadoop%20Tips/#_1","title":"\u8282\u70b9\u4ecb\u7ecd","text":""},{"location":"BigData/Hadoop/Hadoop%20Tips/#hdfs","title":"HDFS","text":"<p><code>NameNode</code> \u5b58\u50a8\u6587\u4ef6\u7684\u5143\u6570\u636e\uff0c\u8bb0\u5f55\u6587\u4ef6\u5c5e\u6027\u4ee5\u53ca\u6587\u4ef6\u5757\u6240\u5728\u7684 <code>DataNode</code> \u4fe1\u606f\u3002</p> <p><code>DataNode</code> \u5177\u4f53\u5b58\u50a8\u6570\u636e\u53ca\u6821\u9a8c\u548c\u3002  </p> <p><code>SecondaryNameNode</code> \u662f <code>NameNode</code> \u7684\u5907\u4efd\u8282\u70b9\u3002  </p>"},{"location":"BigData/Hadoop/Hadoop%20Tips/#yarn","title":"YARN","text":"<p><code>ResourceManager</code> \u7ba1\u7406\u6240\u6709\u96c6\u7fa4\u7684\u8d44\u6e90\u3002\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u76d1\u63a7 <code>NodeManager</code>\uff0c\u542f\u52a8\u76d1\u63a7 <code>ApplicationMaster</code>\u3002  </p> <p><code>NodeManager</code> \u7ba1\u7406\u5355\u4e2a\u8282\u70b9\u7684\u8d44\u6e90\u3002\u5904\u7406\u6765\u81ea <code>ResourceManager</code> \u7684\u547d\u4ee4\uff0c\u5904\u7406\u6765\u81ea <code>ApplicationMaster</code> \u7684\u547d\u4ee4\u3002 </p> <p><code>ApplicationMaster</code> \u8d1f\u8d23\u7ba1\u7406\u5355\u4e2a\u8fd0\u884c\u4efb\u52a1\u3002 </p> <p><code>Container</code> \u4efb\u52a1\u8fd0\u884c\u7684\u5bb9\u5668\u3002  </p>"},{"location":"BigData/Hadoop/Hadoop%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/","title":"Hadoop \u5feb\u901f\u5f00\u59cb","text":""},{"location":"BigData/Hadoop/Hadoop%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/#hadoop","title":"\u5355\u8282\u70b9\u5b89\u88c5 Hadoop","text":"<p>\u51c6\u5907\u6587\u4ef6 <pre><code>OpenJDK11U-jdk_x64_linux_hotspot_11.0.26_4.tar.gz\nhadoop-3.4.1.tar.gz\n</code></pre></p> <p>\u5b89\u88c5 JDK\uff0c\u73af\u5883\u53d8\u91cf\u914d\u7f6e\uff1a <pre><code>$ cat /etc/profile.d/java.sh \nexport JAVA_HOME=/usr/local/jdk-11.0.26+4\nexport PATH=$PATH:$JAVA_HOME/bin\n</code></pre></p> <p>\u521b\u5efa hadoop \u7528\u6237 <pre><code>useradd -m -s /bin/bash hadoop\npasswd hadoop\n</code></pre></p> <p>\u63a5\u4e0b\u6765\u4f7f\u7528 hadoop \u7528\u6237\u8fdb\u884c\u64cd\u4f5c</p> <p>ssh \u914d\u7f6e\u672c\u673a\u514d\u5bc6\u767b\u5f55 <pre><code>ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa\ncat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys\nchmod 0600 ~/.ssh/authorized_keys\n</code></pre></p> <p>\u9a8c\u8bc1\u514d\u5bc6\u767b\u5f55\u6548\u679c\uff1a <pre><code>ssh localhost\n</code></pre></p> <p>\u5b89\u88c5 Hadoop \u914d\u7f6e\u73af\u5883\u53d8\u91cf\uff08\u5207\u6362\u4e3a root \u7528\u6237\u914d\u7f6e\uff09\uff1a <pre><code># cat /etc/profile.d/hadoop.sh \nexport HADOOP_HOME=/home/hadoop/hadoop-3.4.1\nexport HADOOP_CONF_DIR=$HADOOP_HOME/etc/hadoop\nexport PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin\n</code></pre></p> <p>\u521b\u5efa Hadoop \u6570\u636e\u5b58\u50a8\u76ee\u5f55\uff1a <pre><code>/home/hadoop/hadoop-3.4.1/hadoop-files\n/home/hadoop/hadoop-3.4.1/hadoop-files/namenode\n/home/hadoop/hadoop-3.4.1/hadoop-files/datanode\n</code></pre></p> <p>\u8fdb\u5165\u5230 Hadoop \u76ee\u5f55\uff0c\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff1a etc/hadoop/core-site.xml\uff0c\u914d\u7f6e HDFS \u7684\u9ed8\u8ba4\u8bbf\u95ee\u6587\u4ef6\u5730\u5740\u3002 <pre><code>&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;fs.defaultFS&lt;/name&gt;\n        &lt;value&gt;hdfs://192.168.199.134:9000&lt;/value&gt;  &lt;!-- \u4f7f\u7528\u670d\u52a1\u5668IP --&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre></p> <p>etc/hadoop/hdfs-site.xml\uff0c\u914d\u7f6e\u6587\u4ef6\u5feb\u7684\u526f\u672c\u6570\u3002 <pre><code>&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.replication&lt;/name&gt;\n        &lt;value&gt;1&lt;/value&gt;  &lt;!-- \u5355\u8282\u70b9\u526f\u672c\u6570\u4e3a1 --&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;\n        &lt;value&gt;file:///home/hadoop/hadoop-3.4.1/hadoop-files/namenode&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;\n        &lt;value&gt;file:///home/hadoop/hadoop-3.4.1/hadoop-files/datanode&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre></p> <p>etc/hadoop/hadoop-env.sh\uff0c\u914d\u7f6e JAVA_HOME \u73af\u5883\u53d8\u91cf\uff1a <pre><code>export JAVA_HOME=/usr/local/jdk-11.0.26+4\n</code></pre></p> <p>\u683c\u5f0f\u5316\u6587\u4ef6\u7cfb\u7edf <pre><code>hdfs namenode -format\n</code></pre></p> <p>\u542f\u52a8 NameNode \u548c DataNode <pre><code>start-dfs.sh\n</code></pre></p> <p>\u6d4b\u8bd5 HDFS \u529f\u80fd\uff1a <pre><code>$ hdfs dfs -ls /\n$ hdfs dfs -mkdir /test\n$ hdfs dfs -ls /\nFound 1 items\ndrwxr-xr-x   - hadoop supergroup          0 2025-03-28 18:56 /test\n$ hdfs dfs -put test.txt /test\n$ hdfs dfs -cat /test/test.txt\nhello hadoop\n</code></pre></p> <p>\u8bbf\u95ee\u5730\u5740\uff1ahttp://192.168.199.134:9870/</p> <p>\u5b89\u88c5\u914d\u7f6e YARN etc/hadoop/mapred-site.xml <pre><code>&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;mapreduce.framework.name&lt;/name&gt;\n        &lt;value&gt;yarn&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre></p> <p>etc/hadoop/yarn-site.xml <pre><code>&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;\n        &lt;value&gt;mapreduce_shuffle&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;\n        &lt;value&gt;192.168.199.134&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre></p> <p>\u542f\u52a8 YARN <pre><code>start-yarn.sh\n</code></pre></p> <p>\u8bbf\u95ee\u5730\u5740\uff1ahttp://192.168.199.134:8088/cluster</p>"},{"location":"BigData/Kafka/Kafka%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","title":"Kafka \u5e38\u7528\u547d\u4ee4","text":"","tags":["Kafka"]},{"location":"BigData/Kafka/Kafka%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#_1","title":"\u4e3b\u9898\u64cd\u4f5c","text":"<p>topic \u64cd\u4f5c\u9009\u9879 <pre><code>--topic \u6307\u5b9a\u8981\u64cd\u4f5c\u7684 topic \u540d\u79f0\n--create \u521b\u5efa topic\n--delete \u5220\u9664 topic\n--describe \u67e5\u770b topic \u7684\u8be6\u7ec6\u63cf\u8ff0\n--alter \u4fee\u6539\u4e3b\u9898\n--partitions &lt;num&gt; \u4fee\u6539\u4e3b\u9898\u7684\u5206\u533a\u6570\uff0c\u53ea\u80fd\u589e\u52a0\uff0c\u4e0d\u80fd\u51cf\u5c11\n--replication-factor &lt;num&gt; \u8bbe\u7f6e\u5206\u533a\u526f\u672c\u6570\uff08\u5982\u679c\u8bbe\u7f6e\u4e3a 3\uff0c\u90a3\u4e48\u5c31\u662f 1 \u4e2a Leader \u526f\u672c\uff0c3 \u4e2a Follower \u526f\u672c\uff09\n--config &lt;key=val&gt; \u66f4\u65b0\u7cfb\u7edf\u9ed8\u8ba4\u8bbe\u7f6e\n</code></pre></p> <p>\u521b\u5efa Topic\uff1a <pre><code>bin/kafka-topics.sh --bootstrap-server localhost:9092 \\\n    --create \\\n    --topic quickstart-events [--partitions num] [--replication-factor num] --command-config admin-jaas\n</code></pre></p> <p>\u67e5\u770b Topic \u7684\u5206\u533a offset \u4fe1\u606f\uff1a <pre><code>bin/kafka-run-class kafka.tools.GetOffsetShell ----bootstrap-server localhost:9092 \\\n --topic &lt;TOPIC&gt; \\\n --time -1\n\n# time -1 \u8868\u793a\u83b7\u53d6\u6700\u65b0\u7684 offset \u4fe1\u606f\n</code></pre></p>","tags":["Kafka"]},{"location":"BigData/Kafka/Kafka%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#_2","title":"\u6d88\u8d39\u6d88\u606f","text":"<p>\u67e5\u770b\u6d88\u8d39\u8005\u7ec4\u7684\u6d88\u8d39\u60c5\u51b5 <pre><code>bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group GOUP_NAME --describe \n</code></pre></p> <p>\u63a7\u5236\u53f0\u6d88\u8d39\u8005 <pre><code>bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic &lt;topic_name&gt;\n\n\u9ed8\u8ba4\u4ece latest \u6d88\u8d39\u6d88\u606f\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6d88\u8d39\u8005\u7ec4\u3002\u4e0b\u9762\u662f\u4e00\u4e9b\u53ef\u4ee5\u6307\u5b9a\u7684\u9009\u9879\uff1a\n--from-beginning \u6307\u5b9a\u4e86\u4ece\u5f00\u5934\u8bfb\u53d6\u6d88\u606f\n\n--max-message \u6307\u5b9a\u4e86\u8bfb\u53d6\u6d88\u606f\u7684\u6570\u91cf\uff0c\u4e0d\u6307\u5b9a\u7684\u8bdd\u4f1a\u6301\u7eed\u6d88\u8d39\u4e0b\u53bb\n\n--offset \u6267\u884c\u6d88\u8d39\u7684\u8d77\u59cb offset \u4f4d\u7f6e\n\n--partition \u6307\u5b9a\u5206\u533a\n</code></pre></p> <p>\u6307\u5b9a\u5206\u533a\u6d88\u8d39\u6700\u65b0\u7684\u4e24\u6761\u6d88\u606f\uff0cpartition \u548c offset \u9700\u8981\u540c\u65f6\u6307\u5b9a\u3002 <pre><code>bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 \\\n    --topic &lt;topic_name&gt; --partition &lt;partitionidu&gt; --offset &lt;offset&gt; --max-messages 2\n</code></pre></p>","tags":["Kafka"]},{"location":"BigData/Kafka/Kafka%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#_3","title":"\u751f\u4ea7\u8005\u6743\u9650","text":"<p>\u8d4b\u4e88 usera \u7528\u6237\u5411 Topic <code>quickstart-events</code> \u5199\u5165\u6743\u9650\u3002 <pre><code>bin/kafka-acls.sh --bootstrap-server localhost:9092 \\\n    --add \\\n    --allow-principal User:usera \\\n    --operation Write \\\n    --topic quickstart-events \\\n    --command-config admin-jaas\n</code></pre></p> <p>\u8d4b\u4e88 usera \u7528\u6237\u5411\u6240\u6709 topic \u5199\u5165\u7684\u6743\u9650\uff1a <pre><code>bin/kafka-acls.sh --bootstrap-server localhost:9092 \\\n    --add \\\n    --allow-principal User:usera \\\n    --operation Write \\\n    --topic '*' \\\n    --command-config admin-jaas\n</code></pre></p> <p>\u6d4b\u8bd5 <pre><code>bin/kafka-console-producer.sh --bootstrap-server localhost:9092  \\\n    --topic quickstart-events \\\n    --producer.config usera-jaas\n</code></pre></p>","tags":["Kafka"]},{"location":"BigData/Kafka/Kafka%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#_4","title":"\u6d88\u8d39\u8005\u6743\u9650","text":"<p>\u8d4b\u4e88 <code>usera</code> \u7528\u6237\u4f7f\u7528 <code>usera</code> \u6d88\u8d39\u8005\u7ec4\u6d88\u8d39 Topic <code>quickstart-events</code> \u7684\u6743\u9650\u3002 <pre><code>bin/kafka-acls.sh --bootstrap-server localhost:9092 \\\n    --add \\\n    --allow-principal User:usera \\\n    --operation Read \\\n    --topic quickstart-events \\\n    --group usera \\\n    --command-config admin-jaas\n</code></pre></p> <p>\u6d4b\u8bd5 <pre><code>bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 \\\n    --topic quickstart-events \\\n    --from-beginning \\\n    --group usera \\\n    --consumer.config usera-jaas\n</code></pre></p> <p>\u8d4b\u4e88 <code>usera</code> \u7528\u6237\u5bf9\u6240\u6709 Topic \u7684\u8bfb\u53d6\u6743\u9650\u3002 <pre><code>bin/kafka-acls.sh --bootstrap-server localhost:9092 \\\n    --add \\\n    --allow-principal User:usera \\\n    --operation Read \\\n    --topic '*' \\\n    --group '*' \\\n    --command-config admin-jaas\n</code></pre></p>","tags":["Kafka"]},{"location":"BigData/Kafka/Kafka%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#_5","title":"\u6743\u9650\u67e5\u770b","text":"<p>\u67e5\u770b\u6240\u6709\u7684 ACL \u6743\u9650\u914d\u7f6e\u3002 <pre><code>bin/kafka-acls.sh --bootstrap-server localhost:9092 \\\n    --list [--principal User:username] [--topic topicname] [--group topicname] \\\n    --command-config admin-jaas\n</code></pre></p>","tags":["Kafka"]},{"location":"BigData/Kafka/Kafka%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#_6","title":"\u6743\u9650\u5220\u9664","text":"<p>\u5220\u9664 <code>usera</code> \u7528\u6237\u5bf9 Topic <code>quickstart-event</code> \u7684\u8bfb\u53d6\u6743\u9650\u3002 <pre><code>bin/kafka-acls.sh --bootstrap-server localhost:9092 \\\n    --remove \\\n    --allow-principal User:usera \\\n    --operation Read \\\n    --topic quickstart-events \\\n    --command-config admin-jaas \n</code></pre></p>","tags":["Kafka"]},{"location":"BigData/Kafka/Kafka%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/","title":"Kafka \u5feb\u901f\u5f00\u59cb","text":""},{"location":"BigData/Kafka/Kafka%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/#kafka","title":"Kafka \u5b89\u88c5","text":"<p>\u51c6\u5907\u5b89\u88c5\u6587\u4ef6\u3002 <pre><code>kafka_2.13-3.9.0.tgz  \nOpenJDK21U-jdk_aarch64_linux_hotspot_21.0.5_11.tar.gz\n# tar -zxvf OpenJDK21U-jdk_aarch64_linux_hotspot_21.0.5_11.tar.gz -C /usr/local/\n# tar -zxvf kafka_2.13-3.9.0.tgz -C /usr/local/\n</code></pre></p> <p>\u914d\u7f6e Java \u73af\u5883\u53d8\u91cf  /etc/profile.d/java.sh\u3002 <pre><code>export JAVA_HOME=/usr/local/jdk-21.0.5+11\nexport PATH=$PATH:$JAVA_HOME/bin\n</code></pre></p> <p>\u8fdb\u5165\u5230 Kafka \u76ee\u5f55\u4e0b\uff0c\u914d\u7f6e\u5b58\u50a8\u76ee\u5f55 kafka-files\u3002 <pre><code># kdir kafka-files\n\n\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 config/kraft/reconfig-server.properties\uff0c\u4fee\u6539\u914d\u7f6e\u3002\nlog.dirs=/usr/local/kafka_2.13-3.9.0/kafka-files\u3002\n</code></pre></p> <p>\u521d\u59cb\u5316\u542f\u52a8 Kafka <pre><code># KAFKA_CLUSTER_ID=\"$(bin/kafka-storage.sh random-uuid)\"\n# bin/kafka-storage.sh format --standalone -t $KAFKA_CLUSTER_ID -c config/kraft/reconfig-server.properties\n# bin/kafka-server-start.sh -daemon config/kraft/reconfig-server.properties\n</code></pre></p>"},{"location":"BigData/Kafka/Kafka%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/#_1","title":"\u5e38\u7528\u547d\u4ee4","text":"<p>\u521b\u5efa Topic <pre><code># bin/kafka-topics.sh --bootstrap-server localhost:9092 --topic quickstart-events --create\nCreated topic quickstart-events.\n</code></pre></p> <p>\u67e5\u770b Topic \u5217\u8868 <pre><code># bin/kafka-topics.sh --bootstrap-server localhost:9092 --list\nquickstart-events\n</code></pre></p> <p>\u67e5\u770b Topic \u8be6\u60c5 <pre><code># bin/kafka-topics.sh --bootstrap-server localhost:9092 --topic quickstart-events --describe\nTopic: quickstart-events TopicId: l9MVAfeWQ1am7pCdFHbdiA PartitionCount: 1 ReplicationFactor: 1 Configs: segment.bytes=1073741824\nTopic: quickstart-events Partition: 0 Leader: 1 Replicas: 1 Isr: 1 Elr: LastKnownElr:\n</code></pre></p> <p>\u4fee\u6539 Topic \u7684\u5206\u533a <pre><code># bin/kafka-topics.sh --bootstrap-server localhost:9092 --topic quickstart-events --alter --partitions 2\n# bin/kafka-topics.sh --bootstrap-server localhost:9092 --topic quickstart-events --describe\nTopic: quickstart-events TopicId: l9MVAfeWQ1am7pCdFHbdiA PartitionCount: 2 ReplicationFactor: 1 Configs: segment.bytes=1073741824\nTopic: quickstart-events Partition: 0 Leader: 1 Replicas: 1 Isr: 1 Elr: LastKnownElr:\u00a0\nTopic: quickstart-events Partition: 1 Leader: 1 Replicas: 1 Isr: 1 Elr: LastKnownElr:\n</code></pre></p> <p>\u547d\u4ee4\u884c\u6d88\u8d39\u6d88\u606f <pre><code># bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic quickstart-events\n</code></pre></p> <p>\u547d\u4ee4\u884c\u751f\u4ea7\u6d88\u606f <pre><code># bin/kafka-console-producer.sh --bootstrap-server localhost:9092 --topic quickstart-events\n</code></pre></p> <p>\u5220\u9664 Topic <pre><code># bin/kafka-topics.sh --bootstrap-server localhost:9092 --topic quickstart-events --delete\n</code></pre></p>"},{"location":"BigData/Kafka/Kafka%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/#kafka-ui","title":"\u5b89\u88c5 Kafka UI","text":"<p>KafkaUI \u4ed3\u5e93\u5730\u5740\uff1ahttps://github.com/provectus/kafka-ui</p> <p>docker \u5b89\u88c5 <pre><code># docker run -itd --name kafka-ui -p 8080:8080 -e DYNAMIC_CONFIG_ENABLED=true provectuslabs/kafka-ui\n</code></pre></p> <p>jar \u5305\u76f4\u63a5\u5b89\u88c5\uff0c\u914d\u7f6e\u53c2\u8003\uff1ahttps://github.com/provectus/kafka-ui/tree/master/kafka-ui-api/src/main/resources <pre><code># java -jar kafka-ui-api-v0.7.2.jar --dynamic.config.enabled=true\n</code></pre></p> <p>jar \u5305\u76f4\u63a5\u8fd0\u884c\uff0c\u6307\u5b9a\u989d\u5916\u7684\u914d\u7f6e\u6587\u4ef6\uff1a <pre><code># java -Dspring.config.additional-location=&lt;path-to-application-local.yml&gt; -jar &lt;path-to-jar&gt;.jar\n</code></pre></p>"},{"location":"BigData/Kafka/Kafka%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/#_2","title":"\u751f\u4ea7\u6d88\u8d39\u4ee3\u7801\u793a\u4f8b","text":"<p>\u5f15\u5165\u4f9d\u8d56 <pre><code>&lt;dependency&gt;  \n    &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;  \n    &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;  \n    &lt;version&gt;3.9.0&lt;/version&gt;  \n&lt;/dependency&gt;\n</code></pre></p> <p>\u751f\u4ea7\u8005 <pre><code>public static void main(String[] args) {  \n    // Kafka \u914d\u7f6e\u4fe1\u606f  \n    Properties properties = new Properties();  \n    properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"localhost:9092\");  \n    properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());  \n    properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());  \n\n    // Kafka \u751f\u4ea7\u8005  \n    try (KafkaProducer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(properties)) {  \n        // Kafka \u53d1\u9001\u6d88\u606f  \n        for (int i = 0; i &lt; 10; i ++) {  \n            String key = String.format(\"[key: %d]\", i);  \n            String msg = String.format(\"[msg: %d]\", i);  \n            ProducerRecord&lt;String, String&gt; record = new ProducerRecord&lt;&gt;(\"quickstart-events\", key, msg);  \n            producer.send(record, (recordMetadata, e) -&gt; {  \n                System.out.println(msg + \" -- partition: \" + recordMetadata.partition() + \" -- offset: \" + recordMetadata.offset());  \n            });  \n        }  \n    }  \n}\n</code></pre></p> <p>\u6d88\u8d39\u8005 <pre><code>private static volatile boolean running = true;  \n\npublic static void main(String[] args) {  \n    Properties properties = new Properties();  \n    properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"localhost:9092\");  \n    properties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());  \n    properties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());  \n    properties.put(ConsumerConfig.GROUP_ID_CONFIG, \"group-a\");  \n\n    try(KafkaConsumer&lt;String, String&gt; kafkaConsumer = new KafkaConsumer&lt;&gt;(properties)) {  \n        kafkaConsumer.subscribe(Collections.singletonList(\"quickstart-events\"));  \n\n        while (running) {  \n            ConsumerRecords&lt;String, String&gt; consumerRecords = kafkaConsumer.poll(100);  \n            for (ConsumerRecord&lt;String, String&gt; consumerRecord : consumerRecords) {  \n                System.out.println(consumerRecord);  \n            }  \n        }  \n    }  \n}\n</code></pre></p>"},{"location":"BigData/Kafka/Kafka%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/#_3","title":"\u96c6\u7fa4\u5b89\u88c5","text":"<p>\u53c2\u8003\uff1ahttps://medium.com/@azsecured/install-kafka-cluster-kraft-with-sasl-plaintext-and-acl-configs-ae01a1e0040d</p>"},{"location":"BigData/Kafka/Kafka%20%E9%85%8D%E7%BD%AE/","title":"Kafka \u914d\u7f6e","text":"<p>Controller \u662f Kafka \u96c6\u7fa4\u7684\u4e00\u4e2a\u8282\u70b9\uff0c\u7ba1\u7406\u534f\u8c03 Kafka \u96c6\u7fa4\u3002</p> <p>Broker \u662f Kafka \u96c6\u7fa4\u7684\u4e00\u4e2a\u8282\u70b9\uff0c\u5bf9\u5916\u63d0\u670d\u52a1\u3002</p> <p>Topic \u4e3b\u9898\uff0c\u4e00\u4e2a Kafka \u96c6\u7fa4\u53ef\u4ee5\u5305\u542b\u5f88\u591a\u7684\u4e3b\u9898\u3002</p> <p>Partition \u533a\uff0c\u4e00\u4e2a\u4e3b\u9898\u53ef\u4ee5\u6709\u591a\u4e2a\u5206\u533a\uff0c\u6bcf\u4e2a\u5206\u533a\u5305\u542b\u4e3b\u9898\u4e2d\u7684\u4e00\u90e8\u5206\u6570\u636e\u3002\u5206\u533a\u53ef\u4ee5\u914d\u7f6e\u5b58\u50a8\u591a\u4efd\uff0c\u5305\u62ec\u539f\u59cb\u6570\u636e\u5728\u5185\u90fd\u79f0\u4e3a\u526f\u672c\u3002\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u526f\u672c\u63d0\u4f9b\u670d\u52a1\uff0c\u79f0\u4e3a Leader \u526f\u672c\uff1b\u5176\u4f59\u7684\u526f\u672c\u79f0\u4e3a Folloer \u526f\u672c\uff0c\u63d0\u4f9b\u6570\u636e\u5907\u4efd\u529f\u80fd\u3002</p> <p>Consumer Group \u662f\u6d88\u8d39\u8005\u7ec4\uff0c\u6d88\u8d39\u8005\u5c5e\u4e8e\u6d88\u8d39\u8005\u7ec4\u3002\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u4f1a\u5b8c\u6574\u7684\u6d88\u8d39\u4e00\u4e2a\u4e3b\u9898\u7684\u6570\u636e\uff0c\u5177\u4f53\u7531\u6d88\u8d39\u8005\u6d88\u8d39\u5206\u533a\u7684\u6570\u636e\u5b9e\u73b0\u3002\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u7684\u6bcf\u4e2a\u6d88\u8d39\u8005\u53ef\u4ee5\u6d88\u8d39\u96f6\u5230\u591a\u4e2a\u5206\u533a\u7684\u6570\u636e\uff0c\u4f46\u662f\u4e0d\u80fd\u591a\u4e2a\u6d88\u8d39\u8005\u540c\u65f6\u6d88\u8d39\u4e00\u4e2a\u5206\u533a\u7684\u6570\u636e\u3002</p> <p>![[Kafka-ConsumerGroup.png]]</p>"},{"location":"BigData/Kafka/Kafka%20%E9%85%8D%E7%BD%AE/#_1","title":"\u751f\u4ea7\u8005\u914d\u7f6e","text":"<p>Kafka \u751f\u4ea7\u8005\u6709\u4e24\u4e2a\u7ebf\u7a0b\uff08\u5047\u8bbe Main \u7ebf\u7a0b\u548c Sender \u7ebf\u7a0b\uff09\uff0c\u4e00\u4e2a\u5185\u5b58\u6c60\u7f13\u5b58\u53d1\u9001\u7684\u6570\u636e\u3002</p> <p>\u5047\u8bbe send(msg) \u65b9\u6cd5\u5728 Main \u7ebf\u7a0b\u8c03\u7528\uff0c\u6d88\u606f\u4f1a\u7ecf\u5386\u62e6\u622a\u5668\u3001\u5e8f\u5217\u5316\u5668\u3001\u5206\u533a\u5668\uff0c\u7136\u540e\u6d88\u606f\u4f1a\u5b58\u50a8\u5728\u5185\u5b58\u6c60\u4e2d\u3002Sender \u7ebf\u7a0b\u8d1f\u8d23\u8bfb\u53d6\u7f13\u5b58\u7684\u6570\u636e\u53d1\u9001\u5230 Kafka\u3002</p> <p>buffer.memory \u63a7\u5236\u7f13\u51b2\u533a\u7684\u5bb9\u91cf\uff0c\u9ed8\u8ba4 32MB\u3002\u5982\u679c\u7f13\u51b2\u533a\u6ee1\u4e86\uff0cmax.blocks.ms \u63a7\u5236 Main \u7ebf\u7a0b\u5199\u5165\u5230\u7f13\u51b2\u533a\u7684\u963b\u585e\u65f6\u95f4\u3002 \u7f13\u51b2\u533a\u91cc\u9762\u662f\u591a\u4e2a\u961f\u5217\uff0c\u6bcf\u4e2a topic \u7684\u5206\u533a\u90fd\u5bf9\u5e94\u4e00\u4e2a\u961f\u5217\u3002\u961f\u5217\u4e2d\u7684\u591a\u4e2a\u6d88\u606f\u53ef\u4ee5\u7ec4\u6210\u4e00\u4e2a\u6279\u6b21\uff0cbatch.size \u63a7\u5236\u6279\u6b21\u7684\u5927\u5c0f\u3002\u5982\u679c\u6d88\u606f\u6279\u6b21\u8fbe\u5230 batch.size \u5219\u6574\u6279\u6b21\u7684\u6d88\u606f\u4f1a\u53d1\u9001\u5230 Kafka\u3002\u5982\u679c\u4e00\u6279\u6b21\u7684\u6d88\u606f\u5927\u5c0f\u672a\u8fbe\u5230 batch.size\uff0c\u53ef\u80fd\u4f1a\u56e0\u4e3a\u8d85\u65f6 linger.ms \u800c\u63d0\u524d\u53d1\u9001\uff0clinger.ms \u9ed8\u8ba4\u4e3a 0\uff0c\u6d88\u606f\u7acb\u5373\u53d1\u9001\u3002</p> <p>buffer-available-bytes \u7528\u6765\u76d1\u63a7\u7f13\u51b2\u533a\u7684\u60c5\u51b5\u3002 compression.type=gzip \u53ef\u4ee5\u542f\u7528\u6d88\u606f\u538b\u7f29\uff0c\u51cf\u5c11\u7f13\u51b2\u533a\u7684\u5360\u7528\u3002</p>"},{"location":"BigData/Kafka/Kafka%20%E9%85%8D%E7%BD%AE/#_2","title":"\u6d88\u8d39\u8005\u914d\u7f6e","text":"<p>auto.offset.reset \u8be5\u5c5e\u6027\u6307\u5b9a\u4e86\u6d88\u8d39\u8005\u5728\u8bfb\u53d6\u4e00\u4e2a\u6ca1\u6709\u504f\u79fb\u91cf\u7684\u5206\u533a\u6216\u8005\u504f\u79fb\u91cf\u65e0\u6548\u7684\u60c5\u51b5\u4e0b\uff08\u56e0\u6d88\u8d39\u8005\u957f \u65f6\u95f4\u5931\u6548\uff0c\u5305\u542b\u504f\u79fb\u91cf\u7684\u8bb0\u5f55\u5df2\u7ecf\u8fc7\u65f6\u5e76\u88ab\u5220\u9664\uff09\u8be5\u4f5c\u4f55\u5904\u7406\u3002\u5b83\u7684\u9ed8\u8ba4\u503c\u662f <code>latest</code>\uff0c\u610f\u601d\u662f\u8bf4\uff0c\u5728\u504f\u79fb\u91cf\u65e0\u6548\u7684\u60c5\u51b5\u4e0b\uff0c\u6d88\u8d39\u8005\u5c06\u4ece\u6700\u65b0\u7684\u8bb0\u5f55\u5f00\u59cb\u8bfb\u53d6\u6570\u636e\uff08\u5728\u6d88\u8d39\u8005\u542f\u52a8\u4e4b\u540e\u751f\u6210\u7684\u8bb0\u5f55\uff09\u3002\u53e6\u4e00\u4e2a\u503c\u662f <code>earliest</code>\uff0c\u610f\u601d\u662f\u8bf4\uff0c\u5728\u504f\u79fb\u91cf\u65e0\u6548\u7684\u60c5\u51b5\u4e0b\uff0c\u6d88\u8d39\u8005\u5c06\u4ece\u8d77\u59cb\u4f4d\u7f6e\u8bfb\u53d6\u5206\u533a\u7684\u8bb0\u5f55\u3002</p> <p>enable.auto.commit  \u8be5\u5c5e\u6027\u6307\u5b9a\u4e86\u6d88\u8d39\u8005\u662f\u5426\u81ea\u52a8\u63d0\u4ea4\u504f\u79fb\u91cf\uff0c\u9ed8\u8ba4\u503c\u662f true\u3002\u4e3a\u4e86\u5c3d\u91cf\u907f\u514d\u51fa\u73b0\u91cd\u590d\u6570\u636e\u548c\u6570\u636e\u4e22\u5931\uff0c\u53ef\u4ee5\u628a\u5b83\u8bbe\u4e3a false\uff0c\u7531\u81ea\u5df1\u63a7\u5236\u4f55\u65f6\u63d0\u4ea4\u504f\u79fb\u91cf\u3002\u5982\u679c\u628a\u5b83\u8bbe\u4e3a true\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e <code>auto.commit.interval.ms</code> \u5c5e\u6027\u6765\u63a7\u5236\u63d0\u4ea4\u7684\u9891\u7387\u3002</p> <p>Kafka \u6d88\u8d39\u8005\u901a\u8fc7 poll() \u62c9\u53d6\u5206\u533a\u91cc\u9762\u7684\u6d88\u606f\u8fdb\u884c\u6d88\u8d39\uff0c\u9ed8\u8ba4\u60c5\u51b5\u6d88\u8d39\u8005\u9ed8\u8ba4\u4e0d\u9700\u8981\u786e\u8ba4\u6d88\u8d39\uff0c\u800c\u662f\u6bcf\u8fc7\u4e00\u6bb5\u65f6\u95f4\u628a\u81ea\u5df1\u4ece poll() \u63a5\u6536\u5230\u7684\u6700\u5927\u504f\u79fb\u91cf\u63d0\u4ea4\u4e0a\u53bb\uff08\u6709\u53ef\u80fd\u5df2\u7ecf\u63d0\u4ea4\u4e86\u504f\u79fb\u91cf\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709\u6d88\u8d39\u5904\u7406\u5b8c\u6210\uff09\u3002\u81ea\u52a8\u63d0\u4ea4\u7531 <code>enable.auto.commit</code> \u63a7\u5236\uff0c\u9891\u7387\u7531 <code>auto.commit.interval.ms</code> \u63a7\u5236\uff0c\u9ed8\u8ba4 5s\u3002</p> <p>\u91cd\u590d\u6d88\u8d39\u7684\u60c5\u51b5\uff0c\u5982\u679c\u4e0a\u4e00\u6b21\u63d0\u4ea4\u504f\u79fb\u91cf\u4e4b\u540e\uff0c\u6d88\u8d39\u8005\u53c8\u6d88\u8d39\u4e86\u4e00\u4e9b\u6d88\u606f\u4f46\u662f\u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u63d0\u4ea4\uff0c\u6d88\u8d39\u8005\u91cd\u542f\u4f1a\u5bfc\u81f4 poll() \u62c9\u53d6\u5df2\u7ecf\u6d88\u8d39\u8fc7\u7684\u6d88\u606f\u3002</p> <p>\u6d88\u606f\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u5982\u679c\u4e0a\u4e00\u6b21\u63d0\u4ea4\u504f\u79fb\u91cf\u4e4b\u540e\uff0c\u6d88\u8d39\u8005\u8fd8\u6ca1\u6d88\u8d39\u5b8c\u504f\u79fb\u91cf\u4e4b\u524d\u7684\u6d88\u606f\uff0c\u6d88\u8d39\u8005\u91cd\u542f poll() \u53ea\u4f1a\u62c9\u53d6\u504f\u79fb\u91cf\u4e4b\u540e\u7684\u6d88\u606f\uff0c\u5bfc\u81f4\u6d88\u606f\u4e22\u5931\u3002</p> <p>\u5173\u95ed <code>enable.auto.commit</code>\uff0c\u4f7f\u7528 <code>commitSync()</code> \u65b9\u6cd5\u8fdb\u884c\u540c\u6b65\u624b\u52a8\u63d0\u4ea4\uff0c\u80fd\u591f\u89e3\u51b3\u6d88\u606f\u4e22\u5931\u7684\u95ee\u9898\u3002\u4f46\u662f\u4ecd\u4e0d\u80fd\u907f\u514d\u6d88\u606f\u91cd\u590d\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u63d0\u4ea4\u6709\u53ef\u80fd\u5931\u8d25\uff0c\u5bfc\u81f4\u91cd\u590d\u6d88\u8d39\u3002</p>"},{"location":"BigData/Minio/Minio%20Tips/","title":"Minio Tips","text":"<p>\u4e0a\u4f20\uff0c\u67e5\u770b\u7684\u7b56\u7565\uff1a <pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"s3:GetObject\",\n                \"s3:ListBucket\",\n                \"s3:PutObject\"\n            ],\n            \"Resource\": [\n                \"arn:aws:s3:::xxx-bucket\",\n                \"arn:aws:s3:::xxx-bucket/*\"\n            ]\n        }\n    ]\n}\n</code></pre></p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%20Tips/","title":"\u8fbe\u68a6 Tips","text":""},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%20Tips/#jar","title":"\u5b89\u88dd\u8fbe\u68a6 Jar \u5305","text":"<p>Maven \u4f9d\u8d56 <pre><code>&lt;dependency&gt;  \n    &lt;groupId&gt;com.dm&lt;/groupId&gt;  \n    &lt;artifactId&gt;DmJdbcDriver18&lt;/artifactId&gt;  \n    &lt;version&gt;18&lt;/version&gt;  \n&lt;/dependency&gt;\n</code></pre></p> <p>\u5b89\u88c5 Jar \u5305 <pre><code>mvn install:install-file -Dfile=.\\DmJdbcDriver18.jar -DgroupId=com.dm -DartifactId=DmJdbcDriver18 -Dversion=18 -Dpackaging=jar \n</code></pre></p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%20Tips/#_1","title":"\u67e5\u8be2\u66f4\u65b0\u8bb8\u53ef\u4fe1\u606f","text":"<p>\u67e5\u770b\u8bb8\u53ef\u4fe1\u606f\uff0cEXPIRED_DATE \u4e3a\u7a7a\u8bf4\u660e\u6c38\u4e45\u6709\u6548\u3002 <pre><code>select * from v$license\n</code></pre></p> <p>\u67e5\u770b\u7248\u672c\u4fe1\u606f\u3002 <pre><code>select * from v$instance;\n</code></pre></p> <p>\u66f4\u65b0\u8bb8\u53ef\u6587\u4ef6 dm.key <pre><code>\u8fdb\u5165\u5230 DM \u5b89\u88c5\u76ee\u5f55\u7684 bin \u76ee\u5f55\ndmdbms/bin\n\n\u5907\u4efd\u539f\u6709\u7684 key\nmv dm.key dm.key.bak\n\n\u5bfc\u5165\u65b0\u7684 key \u5230 bin \u76ee\u5f55\u4e0b\nmv new.key dm.key\n\n\u66f4\u65b0\u6587\u4ef6\u5c5e\u6027\nchown dmdba:dmdba dm.key\n\n\u4f7f\u7528 SYSDBA \u767b\u5f55\u8fbe\u68a6\uff0c\u6267\u884c\u66f4\u65b0\u8bb8\u53ef\u64cd\u4f5c\nSP_LOAD_LIC_INFO();\n\n\u67e5\u8be2\u8bb8\u53ef\u4fe1\u606f\nselect * from v$license\n</code></pre></p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%20Tips/#_2","title":"\u7528\u6237\u3001\u6a21\u5f0f\u3001\u8868\u7a7a\u95f4","text":"<p>\u8868\u7a7a\u95f4\u662f\u4e00\u4e2a\u903b\u8f91\u6982\u5ff5\uff0c\u7531\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u7269\u7406\u6570\u636e\u5e93\u6587\u4ef6\u7ec4\u6210\u3002\u6570\u636e\u5e93\u4e2d\u6240\u6709\u7684\u5bf9\u8c61\u90fd\u5b58\u50a8\u5728\u8868\u7a7a\u95f4\u5bf9\u5e94\u7684\u6570\u636e\u6587\u4ef6\u4e2d\u3002</p> <p>\u9ed8\u8ba4\u7684\u8868\u7a7a\u95f4\uff1a - SYSTEM\uff0c\u5b58\u50a8\u6570\u636e\u5b57\u5178\u3001\u7cfb\u7edf\u5143\u6570\u636e\u3002 - MAIN\uff0c\u7528\u6237\u9ed8\u8ba4\u7684\u8868\u7a7a\u95f4\u3002 - TEMP\uff0c\u4e34\u65f6\u8868\u7a7a\u95f4\uff0c\u7528\u6237\u6392\u5e8f\u64cd\u4f5c\u3001\u4e34\u65f6\u8868\u7b49\u4e34\u65f6\u6570\u636e\u5b58\u50a8\u3002 - ROLL\uff0c\u56de\u6eda\u8868\u7a7a\u95f4\uff0c\u5b58\u50a8\u4e8b\u52a1\u56de\u6eda\u6570\u636e\u3002 - HMAIN\uff0cHUGE \u8868\u7684\u9ed8\u8ba4\u8868\u7a7a\u95f4\uff0c\u7528\u6237\u5b58\u50a8\u5217\u5f0f\u5b58\u50a8\u7684\u5927\u6570\u636e\u8868\u3002</p> <p>\u81ea\u5b9a\u4e49\u8868\u7a7a\u95f4\uff0c\u7528\u6237\u81ea\u5df1\u521b\u5efa\u7684\u8868\u7a7a\u95f4\uff0c\u7528\u6765\u5b58\u50a8\u7528\u6237\u81ea\u5df1\u7684\u8868\u6570\u636e\u3001\u7d22\u5f15\u6570\u636e\u7b49\u3002</p> <p>\u8868\u7a7a\u95f4\u7684\u610f\u4e49\u5728\u4e8e\u7269\u7406\u7684\u78c1\u76d8\u53ef\u4ee5\u8fdb\u884c\u903b\u8f91\u4e0a\u7684\u5212\u5206\u4e3a\u4e0d\u901a\u7684\u8868\u7a7a\u95f4\uff0c\u5bf9\u8868\u7a7a\u95f4\u8fdb\u884c\u7ba1\u7406\uff08\u5bb9\u91cf\u9650\u5236/\u6269\u5bb9\uff0c\u5907\u4efd\uff0c\u6743\u9650\u63a7\u5236\uff09\u3002</p> <p>\u8fbe\u68a6\u521b\u5efa\u7528\u6237\u7684\u65f6\u5019\u4f1a\u9ed8\u8ba4\u521b\u5efa\u4e00\u4e2a\u540c\u540d\u7684\u6a21\u5f0f\uff0c\u7528\u6237\u5bf9\u8be5\u6a21\u5f0f\u62e5\u6709\u5168\u90e8\u7684\u6743\u9650\uff0c\u4e0d\u9700\u8981\u989d\u5916\u6388\u6743\u3002</p> <p>\u5982\u679c\u521b\u5efa\u7528\u6237\u7684\u65f6\u5019\u6ca1\u6709\u8bbe\u7f6e\u9ed8\u8ba4\u8868\u7a7a\u95f4\uff0c\u90a3\u4e48\u7528\u6237\u9ed8\u8ba4\u4f7f\u7528 MAIN \u8868\u7a7a\u95f4\u3002\u5982\u679c\u8bbe\u7f6e\u4e86\u9ed8\u8ba4\u7684\u81ea\u5b9a\u4e49\u8868\u7a7a\u95f4\uff0c\u90a3\u4e48\u8be5\u7528\u6237\u7684\u9ed8\u8ba4\u6570\u636e\u90fd\u5b58\u50a8\u5728\u81ea\u5b9a\u4e49\u8868\u7a7a\u95f4\u4e2d\u3002</p> <p>\u7528\u6237\u521b\u5efa\u8868\u548c\u7d22\u5f15\u7684\u65f6\u5019\u90fd\u53ef\u4ee5\u5355\u72ec\u6307\u5b9a\u8868\u7a7a\u95f4\uff0c\u524d\u63d0\u662f\u7528\u6237\u5bf9\u6307\u5b9a\u7684\u8868\u7a7a\u95f4\u6709\u6743\u9650\u3002</p> <p>\u6a21\u5f0f\u53ea\u662f\u4e00\u4e2a\u5b58\u7cb9\u7684\u903b\u8f91\u6982\u5ff5\uff0c\u6ca1\u6709\u5b58\u50a8\u5c5e\u6027\uff0c\u4e0d\u5173\u8054\u8868\u7a7a\u95f4\u3002\u4f46\u662f\u6a21\u5f0f\u662f\u6743\u9650\u7ba1\u7406\u7684\u6838\u5fc3\u5355\u5143\u3002</p> <p>\u5982\u679c\u7528\u6237\u5bf9\u6a21\u5f0f\u4e2d\u7684\u8868\u6709\u8bfb\u5199\u6743\u9650\uff0c\u4f46\u662f\u5bf9\u6a21\u5f0f\u4e2d\u7684\u8868\u6240\u5c5e\u7684\u8868\u7a7a\u95f4\u6ca1\u6709\u914d\u989d\uff0c\u90a3\u4e48\u4e0d\u5f71\u54cd\u7528\u6237\u5bf9\u6a21\u5f0f\u4e2d\u5df2\u7ecf\u5b58\u5728\u8868\u8fdb\u884c\u8bfb\u5199\u3002</p> <p>\u67e5\u8be2\u8868\u7a7a\u95f4\uff1a <pre><code>SELECT * FROM V$TABLESPACE; \nSELECT * FROM DBA_DATA_FILES;\n</code></pre></p> <p>\u521b\u5efa\u8868\u7a7a\u95f4\uff0c\u8bbe\u7f6e\u521d\u59cb\u5927\u5c0f 128M\uff0c\u8bbe\u7f6e\u81ea\u52a8\u6269\u5c55\uff0c\u6bcf\u6b21 100M\uff0c\u4e0a\u9650 10240M\uff1a <pre><code>create tablespace \"TEST\" datafile '/data/dmdata/DAMENG/TEST.DBF' size 128 autoextend on next 100 maxsize 10240;\n</code></pre></p> <p>\u66f4\u65b0\u8868\u7a7a\u95f4\uff0c\u8bbe\u7f6e\u81ea\u52a8\u6269\u5c55\uff0c\u6bcf\u6b21 100M\uff0c\u4e0a\u9650 10240M\uff1a <pre><code>alter tablespace \"TEST\" datafile '/data/dmdata/DAMENG/TEST.DBF' autoextend on next 100 maxsize 10240;\n</code></pre></p> <p>\u521b\u5efa\u7528\u6237\uff0c\u5e76\u8d4b\u4e88\u89d2\u8272\uff1a <pre><code>create user \"TEST\" identified by \"Dameng@123\" hash with SHA512 salt \nencrypt by \"123456\" \ndefault tablespace \"TEST\" \ndefault index tablespace \"TEST\"; \n\ngrant \"PUBLIC\",\"SOI\",\"DBA\",\"RESOURCE\" to \"TEST\";\n</code></pre></p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%20Tips/#null","title":"\u8fbe\u68a6\u6392\u5e8f NULL \u503c\u5904\u7406","text":"<p>\u8fbe\u68a6\u4f7f\u7528 order by \u5b57\u6bb5\u6392\u5e8f\u7684\u65f6\u5019\uff0c\u5c06\u5b57\u6bb5\u503c\u4e3a null \u7684\u6570\u636e\u6c38\u8fdc\u6392\u5728\u6700\u540e\u3002\u4f7f\u7528 nulls last|first\u3002 <pre><code>select * from user order by age desc nulls last;\n</code></pre></p> <p>\u4f7f\u7528 case when \u8fdb\u884c\u5904\u7406\uff0c\u9996\u5148\u5c06 null \u8bbe\u7f6e\u4e3a 1\uff0c\u975e null \u8bbe\u7f6e\u4e3a 0 \u6b63\u5e8f\u6392\u5217\uff0c\u8fd9\u6837\u5c31\u5c06 null \u503c\u6392\u5728\u6700\u540e\u4e86\uff0c\u7136\u540e\u518d\u6309\u5b57\u6bb5\u503c\u6392\u5e8f\u3002 <pre><code>select * from user order by CASE WHEN age IS NULL THEN 1 ELSE 0 END, age desc\n</code></pre></p> <p>\u53ef\u4ee5\u5728 dm.ini \u4e2d\u8fdb\u884c\u914d\u7f6e ORDER_BY_NULLS_FLAG \u53c2\u6570\uff0c\u9ed8\u8ba4\u503c\u4e3a 0\u3002\u6765\u63a7\u5236 NULL \u503c\u6392\u5e8f\u4f4d\u7f6e\uff0c\u4f46\u662f\u6ce8\u610f\u8be5\u53c2\u6570\u65e0\u6cd5\u5c06 NULL \u503c\u59cb\u7ec8\u5728\u6700\u540e\u9762\u8fd4\u56de\u3002</p> <ul> <li>0 \u8868\u793a NULL \u503c\u59cb\u7ec8\u5728\u6700\u524d\u9762\u8fd4\u56de\uff1b</li> <li>1 \u8868\u793a ASC \u5347\u5e8f\u6392\u5e8f\u65f6 NULL \u503c\u5728\u6700\u540e\u8fd4\u56de\uff0cDESC \u964d\u5e8f\u6392\u5e8f\u65f6 NULL \u503c\u5728\u6700\u524d\u9762\u8fd4\u56de\uff0c\u5728\u53c2\u6570\u7b49\u4e8e 1 \u7684\u60c5\u51b5\u4e0b\uff0cNULL \u503c\u7684\u8fd4\u56de\u4e0e ORACLE \u4fdd\u6301\u4e00\u81f4\uff1b</li> <li>2 \u8868\u793a ASC \u5347\u5e8f\u6392\u5e8f\u65f6 NULL \u503c\u5728\u6700\u524d\u9762\u8fd4\u56de\uff0cDESC \u964d\u5e8f\u6392\u5e8f\u65f6 NULL \u503c\u5728\u6700\u540e\u8fd4\u56de\uff0c\u5728\u53c2\u6570\u7b49\u4e8e 2 \u7684\u60c5\u51b5\u4e0b\uff0cNULL \u503c\u7684\u8fd4\u56de\u4e0e MYSQL \u4fdd\u6301\u4e00\u81f4\uff1b</li> <li>3 \u8868\u793a\u5728\u53d6\u503c\u4e3a 1 \u7684\u57fa\u7840\u4e0a\uff0c\u5c06\u7a7a\u4e32\u7f6e\u4e8e NULL \u503c\u548c\u975e\u7a7a\u503c\u4e4b\u95f4 <pre><code>SELECT * FROM V$PARAMETER WHERE name = 'ORDER_BY_NULLS_FLAG';\n\nALTER SYSTEM SET 'ORDER_BY_NULLS_FLAG' = 2;\n</code></pre></li> </ul> <p>\u67e5\u770b\u8868\u5217\u8868 <pre><code>SELECT * FROM ALL_TABLES WHERE OWNER = '\u6a21\u5f0f\u540d';\n</code></pre> \u67e5\u770b\u5217\u5c5e\u6027 <pre><code>SELECT * FROM USER_COL_COMMENTS;\n</code></pre></p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%20Tips/#_3","title":"\u5220\u9664\u5907\u4efd\u6570\u636e","text":"<pre><code>REMOVE BACKUPSETS WITH BACKUPDIR '/data/backup/dm' UNTIL TIME '2025-11-01 12:00:00'\n</code></pre> <p>\u5f52\u6863\u5904\u7406 https://eco.dameng.com/community/post/20221117164710H0521BIY0PYUDLYQ0K</p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%20Tips/#_4","title":"\u66f4\u65b0\u5bc6\u7801","text":"<pre><code>ALTER USER SYSDBA IDENTIFIED BY \"xxxxx\";\n</code></pre>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%A4%87%E4%BB%BD/","title":"\u8fbe\u68a6\u5907\u4efd","text":"<p>\u903b\u8f91\u5907\u4efd\u4e0e\u8fd8\u539f \u4f7f\u7528 dexp \u548c dimp \u547d\u4ee4\u8fdb\u884c\u903b\u8f91\u5bfc\u5165\u5bfc\u51fa\u3002</p> <p>\u9650\u5236\u662f\u53ea\u80fd\u6062\u590d\u5230\u5bfc\u51fa\u7684\u6570\u636e\uff0c\u5bfc\u51fa\u8282\u70b9\u4e4b\u540e\u7684\u65b0\u6570\u636e\u6ca1\u529e\u6cd5\u6062\u590d\u3002</p> <p>\u8054\u673a\u5907\u4efd\u4e0e\u8fd8\u539f \u9700\u8981\u914d\u5408\u5f52\u6863\uff0c\u5f52\u6863\u662f\u628a redo \u548c undo \u65e5\u5fd7\u7684\u5185\u5bb9\u8fdb\u884c\u8f6c\u5b58\uff0c\u56e0\u4e3a\u8fd9\u4e24\u4e2a\u65e5\u5fd7\u6709\u9650\u5236\u3002\u5f52\u6863\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\u9700\u8981\u624b\u52a8\u5f00\u542f\u3002</p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%AE%89%E8%A3%85/","title":"\u8fbe\u68a6\u5b89\u88c5","text":""},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%AE%89%E8%A3%85/#docker","title":"Docker \u5b89\u88c5","text":"<p>\u53bb\u5b98\u7f51\u4e0b\u8f7d Docker \u5b89\u88c5\u5305\u3002</p> <p>\u5bfc\u5165\u955c\u50cf\uff1a <pre><code># docker image load -i dm8_20240715_x86_rh6_rq_single.tar\n# docker image ls \nREPOSITORY                                      TAG                                 IMAGE ID       CREATED        SIZE\ndm8_single                                      dm8_20240715_rev232765_x86_rh6_64   0880e3256f92   7 weeks ago    1.14GB\n</code></pre></p> <p>\u542f\u52a8\uff1a <pre><code>docker run -d -p 5236:5236 --restart=always --name=dm8 --privileged=true -e LD_LIBRARY_PATH=/opt/dmdbms/bin -e PAGE_SIZE=16 -e EXTENT_SIZE=32 -e LOG_SIZE=1024 -e UNICODE_FLAG=1  -e INSTANCE_NAME=dm8 dm8_single:dm8_20240715_rev232765_x86_rh6_64\n</code></pre></p> <p>\u67e5\u770b\u65e5\u5fd7\uff1a <pre><code># docker logs -f dm8 \nScript start.\nfile dm.key not found, use default license!\nLicense will expire on 2025-06-21\nNormal of FAST\nNormal of DEFAULT\nNormal of RECYCLE\nNormal of KEEP\nNormal of ROLL\n\n log file path: /opt/dmdbms/data/DAMENG/DAMENG01.log\n\n\n log file path: /opt/dmdbms/data/DAMENG/DAMENG02.log\n\nwrite to dir [/opt/dmdbms/data/DAMENG].\ncreate dm database success. 2024-09-08 21:57:50\ninitdb V8\ndb version: 0x7000c\nInit DM success!\nStart DmAPService...\nStarting DmAPService:                                      [ OK ]\n</code></pre></p> <p>\u6d4b\u8bd5\uff1a <pre><code># docker exec -it dm8 bash\nroot@a2966c7e44a6:/# cd /opt/dmdbms/bin\nroot@a2966c7e44a6:/opt/dmdbms/bin# ./disql SYSDBA/SYSDBA001\n\nServer[LOCALHOST:5236]:mode is normal, state is open\nlogin used time : 3.460(ms)\ndisql V8\nSQL&gt; select id_code();\n\nLINEID     ID_CODE()                          \n---------- -----------------------------------\n1          --03134284194-20240621-232765-20108\n\nused time: 1.031(ms). Execute id is 65101.\n</code></pre></p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%AE%89%E8%A3%85/#_1","title":"\u6587\u4ef6\u5b89\u88c5","text":""},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%AE%89%E8%A3%85/#_2","title":"\u51c6\u5907\u5de5\u4f5c","text":"<p>\u5355\u72ec\u521b\u5efa\u7528\u6237\u548c\u7ec4\u5b89\u88c5\u8fbe\u68a6\u3002 \u7ec4\uff1adinstall \u7528\u6237\uff1admdba</p> <p>\u5b89\u88c5\u76ee\u5f55\uff1a/home/dmdba/dmdbms \u5b9e\u4f8b\u4fdd\u5b58\u76ee\u5f55\uff1a/dmdata/data</p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%AE%89%E8%A3%85/#_3","title":"\u521b\u5efa\u7528\u6237\u548c\u7ec4","text":"<p>\u521b\u5efa\u7ec4\u548c\u7528\u6237\uff0c\u4e0d\u80fd\u4f7f\u7528 root \u7528\u6237\u5b89\u88c5\u3002 <pre><code>groupadd dinstall -g 2001\nuseradd -G dinstall -m -d /home/dmdba -s /bin/bash -u 2001 dmdba\n</code></pre></p> <p>groupadd  - g \u53c2\u6570\u6307\u5b9a\u4e86\u7fa4\u7ec4\u7684 GID\u3002</p> <p>useradd   - -G \u6307\u5b9a\u4e86\u8d26\u53f7\u7684\u6240\u5c5e\u7fa4\u7ec4\u3002  - -m \u5f3a\u5236\u5efa\u7acb\u7528\u6237\u7684\u5bb6\u76ee\u5f55\u3002  - -d \u6307\u5b9a\u4e86\u7528\u6237\u7684\u5bb6\u76ee\u5f55\u3002  - -s \u6307\u5b9a\u7528\u6237\u767b\u5f55\u540e\u7684 shell\u3002  - -u \u6307\u5b9a\u7528\u6237\u7684 UID\u3002</p> <p>\u8bbe\u7f6e dmdba \u7528\u6237\u7684\u5bc6\u7801 <pre><code>passwd dmdba\n</code></pre></p> <p>\u521b\u5efa\u6570\u636e\u5b58\u50a8\u76ee\u5f55 <pre><code>mkdir -p /dmdata/data\nchown -R dmdba:dinstall /dmdata/data\nchmod -R 755 /dmdata/data\n</code></pre></p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%AE%89%E8%A3%85/#_4","title":"\u8d44\u6e90\u9650\u5236\u8bbe\u7f6e","text":"<p>\u8bbe\u7f6e dmdba \u7528\u6237\u7684\u7cfb\u7edf\u8d44\u6e90\u9650\u5236 \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6<code>/etc/security/limits.conf</code>\uff0c\u65b0\u589e\u5982\u4e0b\u5185\u5bb9\uff1a <pre><code>dmdba  soft      nice       0\ndmdba  hard      nice       0\ndmdba  soft      as         unlimited\ndmdba  hard      as         unlimited\ndmdba  soft      fsize      unlimited\ndmdba  hard      fsize      unlimited\ndmdba  soft      nproc      65536\ndmdba  hard      nproc      65536\ndmdba  soft      nofile     65536\ndmdba  hard      nofile     65536\ndmdba  soft      core       unlimited\ndmdba  hard      core       unlimited\ndmdba  soft      data       unlimited\ndmdba  hard      data       unlimited\n</code></pre></p> <p>\u8bbe\u7f6e\u8d44\u6e90\u9650\u5236\u7684\u7528\u6237\u4e3a dmdba\uff0c\u8fd9\u4e2a\u9650\u5236\u4f1a\u5bf9\u5c5e\u4e8e\u8be5\u7528\u6237\u7684\u6240\u6709\u8fdb\u7a0b\u90fd\u751f\u6548\u3002</p> <p>hard \u4e3a\u4e25\u683c\u7684\u8bbe\u5b9a\uff0c\u5fc5\u5b9a\u4e0d\u80fd\u8d85\u8fc7\u8fd9\u4e2a\u8bbe\u5b9a\u7684\u6570\u503c\u3002 soft \u4e3a\u8b66\u544a\u7684\u8bbe\u5b9a\uff0c\u53ef\u4ee5\u8d85\u8fc7\u8fd9\u4e2a\u6570\u503c\uff0c\u4f46\u662f\u82e5\u8d85\u8fc7\u4f1a\u6709\u8b66\u544a\u4fe1\u606f\u3002\u4e00\u822c soft \u8bbe\u7f6e\u5c0f\u4e8e hard\u3002</p> <p>nice \u8bbe\u7f6e\u8fdb\u7a0b\u8c03\u5ea6\u7684\u4f18\u5148\u7ea7\u4e3a 0\uff08\u9ed8\u8ba4\u503c\uff09\u3002 as \u865a\u62df\u5185\u5b58\u8bbe\u7f6e\u65e0\u9650\u5236\u3002 fsize \u6587\u4ef6\u5927\u5c0f\u65e0\u9650\u5236\u3002 nproc \u8bbe\u7f6e\u7528\u6237\u53ef\u4ee5\u542f\u52a8\u7684\u6700\u5927\u8fdb\u7a0b\u6570\u3002 nofile \u8bbe\u7f6e\u7528\u6237\u53ef\u4ee5\u540c\u65f6\u6253\u5f00\u7684\u6587\u4ef6\u6570\u91cf\u3002 core \u6838\u5fc3\u8f6c\u50a8\u6587\u4ef6\u5927\u5c0f\u65e0\u9650\u5236\uff0c\u5373\u8fdb\u7a0b\u5728\u5d29\u6e83\u8def\u65f6\u751f\u6210\u7684\u6838\u5fc3\u8f6c\u50a8\u6587\u4ef6\u53ef\u4ee5\u662f\u4efb\u610f\u5927\u5c0f\u7684\u3002 data \u8fdb\u7a0b\u53ef\u4ee5\u4f7f\u7528\u7684\u6570\u636e\u6bb5\u7684\u5927\u5c0f\u6ca1\u6709\u9650\u5236\u3002</p> <p>\u5207\u6362\u5230 dmdba \u7528\u6237\u67e5\u770b\u914d\u7f6e\u662f\u5426\u751f\u6548\u3002 <pre><code># su dmabd\n$ ulimit -a\nreal-time non-blocking time  (microseconds, -R) unlimited\ncore file size              (blocks, -c) unlimited\ndata seg size               (kbytes, -d) unlimited\nscheduling priority                 (-e) 20\nfile size                   (blocks, -f) unlimited\npending signals                     (-i) 15509\nmax locked memory           (kbytes, -l) 501132\nmax memory size             (kbytes, -m) unlimited\nopen files                          (-n) 65536\npipe size                (512 bytes, -p) 8\nPOSIX message queues         (bytes, -q) 819200\nreal-time priority                  (-r) 0\nstack size                  (kbytes, -s) 8192\ncpu time                   (seconds, -t) unlimited\nmax user processes                  (-u) 65536\nvirtual memory              (kbytes, -v) unlimited\nfile locks                          (-x) unlimited\n</code></pre></p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%AE%89%E8%A3%85/#_5","title":"\u5b89\u88c5","text":""},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%AE%89%E8%A3%85/#_6","title":"\u4e0b\u8f7d\u5b89\u88c5\u6587\u4ef6","text":"<p>\u4e0b\u8f7d\u5b89\u88c5\u6587\u4ef6 dm8_20240116_x86_rh7_64.zip\uff0c\u4e0b\u8f7d\u5730\u5740 https://eco.dameng.com/download</p> <p>\u89e3\u538b\u7f29\u3002 <pre><code># unzip dm8_20240116_x86_rh7_64.zip \nArchive:  dm8_20240116_x86_rh7_64.zip\n  inflating: dm8_20240116_x86_rh7_64.iso  \n extracting: dm8_20240116_x86_rh7_64.iso_SHA256.txt  \n  inflating: dm8_20240116_x86_rh7_64.iso.README  \n# ls -l\ntotal 1838696\n-rw-r--r-- 1 root root 950382592 Jan 17 09:36 dm8_20240116_x86_rh7_64.iso\n-rw-r--r-- 1 root root       185 Jan 19 12:30 dm8_20240116_x86_rh7_64.iso.README\n-rw-r--r-- 1 root root       100 Jan 17 09:37 dm8_20240116_x86_rh7_64.iso_SHA256.txt\n-rw-r--r-- 1 root root 932423162 Feb 25 20:41 dm8_20240116_x86_rh7_64.zip\n</code></pre></p> <p>\u6302\u8f7d iso \u5b89\u88c5\u5305\u5230 /mnt \u76ee\u5f55\u4e0b\u3002 <pre><code># mount -o loop dm8_20240116_x86_rh7_64.iso /mnt\n# ls -l /mnt/\ntotal 928047\n-r-xr-xr-x 1 root root   2587575 Jan 16 09:17 'DM8 Install.pdf'\n-r-xr-xr-x 1 root root 947731830 Jan 16 09:20  DMInstall.bin\n</code></pre></p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%AE%89%E8%A3%85/#_7","title":"\u5b89\u88c5","text":"<pre><code># cd /mnt\n# ./DMInstall.bin -i\nInstaller Language: \n[1]: \u7b80\u4f53\u4e2d\u6587\n[2]: English\nPlease select the installer's language [2]:\nExtract install files......... \ntime(seconds)        unlimited\nfile(blocks)         unlimited\ndata(kbytes)         unlimited\nstack(kbytes)        8192\ncoredump(blocks)     0\nmemory(kbytes)       unlimited\nlocked memory(kbytes) 501132\nprocess              15509\nnofiles              1024\nvmemory(kbytes)      unlimited\nlocks                unlimited\nrtprio               0\n\nThe max number of open files is too little, suggest to set 65536 or more to number of open files.\n\nWelcome to DM DBMS Installer\n\nWhether to input the path of Key File? (Y/y:Yes N/n:No) [Y/y]:n\n\nWhether to Set The TimeZone? (Y/y:Yes N/n:No) [Y/y]:y\nTimeZone:\n[ 1]: (GTM-12:00) West Date Line\n[ 2]: (GTM-11:00) Samoa\n[ 3]: (GTM-10:00) Hawaii\n[ 4]: (GTM-09:00) Alaska\n[ 5]: (GTM-08:00) Pacific(America and Canada)\n[ 6]: (GTM-07:00) Arizona\n[ 7]: (GTM-06:00) Central(America and Canada)\n[ 8]: (GTM-05:00) East(America and Canada)\n[ 9]: (GTM-04:00) Atlantic(America and Canada)\n[10]: (GTM-03:00) Brasilia\n[11]: (GTM-02:00) Middle Atlantic\n[12]: (GTM-01:00) Azores\n[13]: (GTM) Greenwich Mean Time\n[14]: (GTM+01:00) Sarajevo\n[15]: (GTM+02:00) Cairo\n[16]: (GTM+03:00) Moscow\n[17]: (GTM+04:00) AbuDhabi\n[18]: (GTM+05:00) Islamabad\n[19]: (GTM+06:00) Dakar\n[20]: (GTM+07:00) BangKok,Hanoi\n[21]: (GTM+08:00) China\n[22]: (GTM+09:00) Seoul\n[23]: (GTM+10:00) Guam\n[24]: (GTM+11:00) Solomon\n[25]: (GTM+12:00) Fiji\n[26]: (GTM+13:00) Nukualofa\n[27]: (GTM+14:00) Kiribati\nPlease Select the TimeZone [21]:21\n\nInstallation Type:\n1 Typical\n2 Server\n3 Client\n4 Custom\nPlease Input the number of the Installation Type [1 Typical]:\nRequire Space: 1979M\n\nPlease Input the install path [/opt/dmdbms]:/home/dmdba/dmdbms\nAvailable Space:12G\nPlease Confirm the install path(/home/dmdba/dmdbms)? (Y/y:Yes N/n:No) [Y/y]:y\n\nPre-Installation Summary\nInstallation Location: /home/dmdba/dmdbms\nRequire Space: 1979M\nAvailable Space: 12G\nVersion Information: \nExpire Date: \nInstallation Type: Typical\nConfirm to Install? (Y/y:Yes N/n:No):y\n2024-02-25 20:55:41 \n[INFO] Installing DM DBMS...\n2024-02-25 20:55:42 \n[INFO] Installing BASE Module...\n2024-02-25 20:55:47 \n[INFO] Installing SERVER Module...\n2024-02-25 20:55:48 \n[INFO] Installing CLIENT Module...\n2024-02-25 20:55:49 \n[INFO] Installing DRIVERS Module...\n2024-02-25 20:55:52 \n[INFO] Installing MANUAL Module...\n2024-02-25 20:55:52 \n[INFO] Installing SERVICE Module...\n2024-02-25 20:55:53 \n[INFO] Move log file to log directory.\n2024-02-25 20:55:54 \n[INFO] Starting DmAPService service...\n2024-02-25 20:55:54 \n[INFO] Start DmAPService service successfully.\n2024-02-25 20:55:54 \n[INFO] Installed DM DBMS completely.\n\nEnd\n</code></pre>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%AE%89%E8%A3%85/#_8","title":"\u914d\u7f6e\u73af\u5883\u53d8\u91cf","text":"<p>\u7f16\u8f91 <code>/home/dmdba/.bash_profile</code>\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a <pre><code>export LD_LIBRARY_PATH=\"$LD_LIBRARY_PATH:/home/dmdba/dmdbms/bin\"\nexport DM_HOME=\"/home/dmdba/dmdbms\"\nexport PATH=$PATH:$DM_HOME/bin:$DM_HOME/tool\n</code></pre></p> <p>\u5207\u6362\u81f3 dmdba \u7528\u6237\uff0c\u4f7f\u914d\u7f6e\u751f\u6548\u3002 <pre><code># su dmdba\n$ source .bash_profile\n</code></pre></p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%AE%89%E8%A3%85/#_9","title":"\u521d\u59cb\u5316","text":"<p>\u67e5\u770b\u521d\u59cb\u5316\u53c2\u6570\uff1a <pre><code># su dmdba \n$ cd /home/dmdba/dmdbms/bin\n$ ./dminit help\ninitdb V8\ndb version: 0x7000c\nfile dm.key not found, use default license!\nLicense will expire on 2025-01-15\nversion: 03134284132-20240115-215128-20081 Pack2\nFormat:  ./dminit         KEYWORD=value\n\nExample: ./dminit         PATH=/public/dmdb/dmData PAGE_SIZE=16\n\nKeyword                     Explanation(default value)\n--------------------------------------------------------------------------------\nINI_FILE                    dm.ini path\nPATH                        database path\nCTL_PATH                    control file path\nLOG_PATH                    log file path\nEXTENT_SIZE                 extent size of data file(16), optional value: 16, 32, 64, unit: PAGE\nPAGE_SIZE                   page size(8), optional value: 4, 8, 16, 32, unit: K\nLOG_SIZE                    log file size(256), unit: M, range: 256M ~ 8G\nCASE_SENSITIVE              whether case is sensitive(Y), optional value: Y/N or 1/0\nCHARSET/UNICODE_FLAG        CHARSET(0), optional value:0[GB18030],1[UTF-8],2[EUC-KR]\nSEC_PRIV_MODE               security privilege mode(0), optional value\u00a3\u00ba0[TRADITION], 1[BMJ], 2[EVAL], 3[ZB]\nLENGTH_IN_CHAR              whether LENGTH for VARCHAR is in characters(N), optional value: Y/N, 1/0\nSYSDBA_PWD                  set SYSDBA password(SYSDBA)\nSYSAUDITOR_PWD              set SYSAUDITOR password(SYSAUDITOR)\nDB_NAME                     database name(DAMENG)\nINSTANCE_NAME               instance name(DMSERVER)\nPORT_NUM                    listener port(5236)\nBUFFER                      System buffer size(100), unit: M\nTIME_ZONE                   set time zone(+08:00)\nPAGE_CHECK                  page check mode(3), optional value: 0/1/2/3\nPAGE_HASH_NAME              set page check hash algorithm\nEXTERNAL_CIPHER_NAME        set default encrypt/decrypt algorithm\nEXTERNAL_HASH_NAME          set default hash algorithm\nEXTERNAL_CRYPTO_NAME        set crypto name to encrypt svr key\nRLOG_ENCRYPT_NAME           encrypt cipher name of redo log\nRLOG_ENCRYPT_POSTFIX        Postfix name of redo log, max length is 10. Default name is log, e.g. DAMENG01.log\nUSBKEY_PIN                  set usbkey pin\nPAGE_ENC_SLICE_SIZE         slice size for page encryption, optional value: 0, 512, 4096, unit: Byte\nENCRYPT_NAME                set algorithm for encrypt the whole database\nBLANK_PAD_MODE              set blank padding mode(0), optional value:0/1\nSYSTEM_MIRROR_PATH          mirror path of system data file\nMAIN_MIRROR_PATH            mirror path of main file\nROLL_MIRROR_PATH            mirror path of roll file\nMAL_FLAG                    MAL_INI flag(0) in dm.ini\nARCH_FLAG                   ARCH_INI(0) flag in dm.ini\nMPP_FLAG                    MPP_INI(0) flag in dm.ini\nCONTROL                     control file path!\nAUTO_OVERWRITE              whether overwrite all files with the same name(0) 0: no 1: part 2: all\nUSE_NEW_HASH                whether use new hash algorithm for string. (default 1)\nDCP_MODE                    whether is DM CLUSTER PROXY mode(default 0)\nDCP_PORT_NUM                in DCP mode, set dcp_port_num\nELOG_PATH                   set the path of log file recording the contents during initialization\nAP_PORT_NUM                 listener port for cooperative worker in distribution environment\nHUGE_WITH_DELTA             Only support to create with delta huge table(default 1) 1: YES  0: NO\nRLOG_GEN_FOR_HUGE           whether to generate redo log for with delta huge table(default 1) 1: YES  0: NO\nPSEG_MGR_FLAG               Only use manager segment to record trx info(default 0) 1: YES  0: NO\nCHAR_FIX_STORAGE            whether CHARACTER type stored by fixed length(N), optional value: Y/N, 1/0\nSQL_LOG_FORBID              whether forbid SQL log(N), optional value: Y/N, 1/0\nDPC_MODE                    specify instance role in DPC cluster(default 0) 0: None 1: MP 2: BP 3: SP, value MP/BP/SP also works\nHELP                        print help information\n</code></pre></p> <p>\u9700\u8981\u6ce8\u610f\uff1aPAGE_SIZE\u3001EXTENT_SIZE\u3001CASE_SENSITIVE \u548c CHARSET \u53c2\u6570\u4e00\u65e6\u521d\u59cb\u5316\u5b8c\u6210\u65e0\u6cd5\u4fee\u6539\u3002</p> <p>\u521d\u59cb\u5316 <pre><code>$ ./dminit path=/dmdata/data PAGE_SIZE=32 EXTENT_SIZE=32 CASE_SENSITIVE=n CHARSET=0 \nCASE_SENSITIVE=n CHARSET=0 \ninitdb V8\ndb version: 0x7000c\nfile dm.key not found, use default license!\nLicense will expire on 2025-01-15\nNormal of FAST\nNormal of DEFAULT\nNormal of RECYCLE\nNormal of KEEP\nNormal of ROLL\n\n log file path: /dmdata/data/DAMENG/DAMENG01.log\n\n\n log file path: /dmdata/data/DAMENG/DAMENG02.log\n\nwrite to dir [/dmdata/data/DAMENG].\ncreate dm database success. 2024-02-25 21:19:19\n</code></pre></p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%AE%89%E8%A3%85/#_10","title":"\u6ce8\u518c\u670d\u52a1","text":"<pre><code># cd /home/dmdba/dmdbms/script/root\n# ./dm_service_installer.sh -t dmserver -dm_ini /dmdata/data/DAMENG/dm.ini -p DM\nCreated symlink /etc/systemd/system/multi-user.target.wants/DmServiceDM.service \u2192 /lib/systemd/system/DmServiceDM.service.\nFinished to create the service (DmServiceDM)\n</code></pre>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%AE%89%E8%A3%85/#_11","title":"\u542f\u52a8","text":"<p>\u542f\u52a8\u6570\u636e\u5e93 <pre><code>$ cd /home/dmdba/dmdbms/bin\n$ ./DmServiceDM start\nStarting DmServiceDM:                                      [ OK ]\n</code></pre></p> <p>\u505c\u6b62\u6570\u636e\u5e93 <pre><code>$ ./DmServiceDM stop\n</code></pre></p> <p>\u91cd\u542f\u6570\u636e\u5e93 <pre><code>$ ./DmServiceDM restart\n</code></pre></p> <p>\u67e5\u770b\u6570\u636e\u5e93\u72b6\u6001 <pre><code>$ ./DmServiceDM status\n</code></pre></p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%AE%89%E8%A3%85/#_12","title":"\u5e38\u7528\u64cd\u4f5c","text":"<p>\u767b\u5f55\u6570\u636e\u5e93 <pre><code># ./disql SYSDBA/SYSDBA@localhost:5236\ndisql V8\n\u7528\u6237\u540d:&lt;username&gt;\n\u5bc6\u7801:\n</code></pre></p> <p>\u67e5\u770b\u6709\u54ea\u4e9b\u6a21\u5f0f\u3002 <pre><code>SELECT * FROM DBA_USERS;\n</code></pre></p> <p>\u8868\u589e\u52a0\u7b7e\u540d\u5b57\u6bb5\u3002 <pre><code>alter table sys_log add sign_data clob;\n</code></pre></p> <p>\u67e5\u770b\u6709\u54ea\u4e9b\u8868\u3002 <pre><code>SELECT TABLE_NAME\nFROM DBA_TABLES\nWHERE OWNER = 'CAR_REPAIRE';\n\nSELECT *\nFROM all_tab_comments\nWHERE OWNER = 'COMPENSATE_COLLECTION_SYSTEM';\n</code></pre></p> <p>\u67e5\u770b\u6709\u54ea\u4e9b\u5b57\u6bb5\u3002 <pre><code>SELECT *\nFROM all_col_comments\nWHERE OWNER = 'COMPENSATE_COLLECTION_SYSTEM';\n</code></pre></p>"},{"location":"DataBase/DM/%E8%BE%BE%E6%A2%A6%E5%AE%89%E8%A3%85/#_13","title":"\u5bc6\u7801\u8bbe\u7f6e","text":"<p>\u8bbe\u7f6e\u5bc6\u7801\u590d\u6742\u5ea6\uff1a <pre><code>-- \u7b2c\u4e00\u4e2a\u53c2\u6570\uff1a0 \u8868\u793a\u5f53\u524d\u4f1a\u8bdd\u751f\u6548\uff1b1 \u8868\u793a\u6c38\u4e45\u6709\u6548\uff0c\u4e14\u7acb\u5373\u751f\u6548\uff0c\u4e0d\u9700\u8981\u91cd\u542f\u6570\u636e\u5e93\uff1b2 \u4ec5\u6c38\u4e45\u6709\u6548\uff0c\u4f46\u662f\u9700\u8981\u91cd\u542f\u6570\u636e\u5e93\u624d\u884c\u3002\n-- \u7b2c\u4e8c\u4e2a\u53c2\u6570\uff1aPWS_POLICY \u8868\u793a\u5bc6\u7801\u7b56\u7565\n-- \u7b2c\u4e09\u4e2a\u53c2\u6570\uff1a31 = 1\uff08\u5bc6\u7801\u957f\u5ea6\u81f3\u5c11\u4e3a 9\uff09+ 2\uff08\u5fc5\u987b\u5305\u542b\u6570\u5b57\uff09+ 4\uff08\u5fc5\u987b\u5305\u542b\u5927\u5199\u5b57\u6bcd\uff09+ 8\uff08\u5fc5\u987b\u5305\u542b\u5c0f\u5199\u5b57\u6bcd\uff09+ 16\uff08\u5fc5\u987b\u5305\u542b\u7279\u6b8a\u5b57\u7b26\uff09\u3002\n-- \u4e00\u822c\u7b2c\u4e09\u4e2a\u53c2\u6570\u8bbe\u7f6e\u4e3a 15 \u5373\u53ef\nsp_set_para_value(1,'PWD_POLICY', 31);\n\n\u67e5\u770b\nselect * from v$dm_ini where para_name='PWD_POLICY';\n</code></pre></p>"},{"location":"DataBase/Doris/Doris%20Tips/","title":"Doris Tips","text":""},{"location":"DataBase/Doris/Doris%20Tips/#_1","title":"\u65e5\u671f\u65f6\u95f4\u652f\u6301\u7684\u503c\u683c\u5f0f","text":"<p>\u652f\u6301\u7684\u683c\u5f0f <pre><code>yyyy-MM-dd HH:mm:ss\nyyyy-MM-dd HH:mm:ss.SSS\nyyyyMMddHHmmss\nyyyyMMddHHmmssSSS\n</code></pre></p> <p>\u6d4b\u8bd5 <pre><code>create table test_dt(\n    k1 TINYINT,\n    k2 datetime\n) \nCOMMENT \"datetime type test table\"\nDISTRIBUTED BY HASH(k1) BUCKETS 1\nPROPERTIES ('replication_num' = '1');\n\ninsert into test_dt(k1, k2)\nvalues\n(1, '2024-07-19 12:32:45'),\n(1, '2024-07-19 12:32:45.111'),\n(1, '20240719123245'),\n(1, '20240719123245111'),\n(1, '20240719 123245');   // \u8fd9\u4e00\u6761\u4e0d\u4f1a\u8bc6\u522b\u6b63\u786e\u7684\u65e5\u671f\u65f6\u95f4\uff0c\u4f46\u662f\u63d2\u5165\u4e0d\u4f1a\u62a5\u9519\uff0c\u65e5\u671f\u65f6\u95f4\u5b57\u6bb5\u4e3a null\n</code></pre></p>"},{"location":"DataBase/Doris/Doris%20Tips/#geojson","title":"\u5c06\u8f68\u8ff9\u6570\u636e\u8f6c\u4e3a GeoJson","text":"<pre><code>-- \u5c06\u67e5\u8be2\u7684\u6570\u636e geojson \u5c55\u793a\u8def\u5f84\nSELECT CONCAT(\n    '{\"type\": \"LineString\", \"coordinates\": [',\n    GROUP_CONCAT(\n        CONCAT('[', lon, ',', lat, ']') order by time \n    ),\n    ']}'\n) AS geojson\nFROM vehicle_gps where license = '\u6caaA-99999' and time &gt;= '2001-01-01 00:00:00'  ;\n</code></pre>"},{"location":"DataBase/Doris/Doris%20Tips/#_2","title":"\u8d4b\u4e88\u7528\u6237\u67e5\u8be2\u6743\u9650","text":"<p>\u8d4b\u4e88\u7528\u6237\u5bf9\u6570\u636e\u5e93\u6240\u6709\u8868\u7684\u67e5\u8be2\u6743\u9650 <pre><code>create user 'user_a' identified by 'password';\n\n-- \u8d4b\u4e88\u90e8\u5206\u8868\u7684\u67e5\u8be2\u6743\u9650\ngrant select on db.table1 to 'user_a';\ngrant select on db.table2 to 'user_a';\ngrant select on db.table3 to 'user_a';\n\n-- \u8d4b\u4e88\u6570\u636e\u5e93\u5168\u90e8\u8868\u7684\u67e5\u8be2\u6743\u9650\ngrant select on db.* to 'user_a';\n\nflush privileges;\n</code></pre></p>"},{"location":"DataBase/Doris/Doris%20%E5%8A%A8%E6%80%81%E5%88%86%E5%8C%BA/","title":"Doris \u52a8\u6001\u5206\u533a","text":""},{"location":"DataBase/Doris/Doris%20%E5%8A%A8%E6%80%81%E5%88%86%E5%8C%BA/#doris","title":"Doris \u521b\u5efa\u5206\u533a\u8868","text":"<p>\u521b\u5efa\u5206\u533a\u8868\u7684\u793a\u4f8b SQL\uff1a <pre><code>CREATE TABLE vehicle_gps_data (\n  license varchar(255) comment '\u8f66\u724c',\n  `time` datetime comment '\u65f6\u95f4',\n  color varchar(100) comment '\u8f66\u724c\u989c\u8272',\n  lon decimal(15, 12) comment '\u7ecf\u5ea6',\n  lat decimal(15, 12) comment '\u7eac\u5ea6',\n  create_time datetime not null default current_timestamp comment '\u521b\u5efa\u65f6\u95f4'\n)\nUNIQUE KEY (`time`, `license`)\nPARTITION BY RANGE(`time`)() DISTRIBUTED BY HASH(`time`) BUCKETS 8 PROPERTIES (\n  \"replication_num\" = \"1\",\n  \"dynamic_partition.enable\" = \"true\",\n  \"dynamic_partition.time_unit\" = \"MONTH\",\n  \"dynamic_partition.end\" = \"10\",\n  \"dynamic_partition.prefix\" = \"p\",\n  \"dynamic_partition.buckets\" = \"8\",\n  \"dynamic_partition.create_history_partition\" = \"true\",\n  \"dynamic_partition.history_partition_num\" = \"8\",\n  \"dynamic_partition.time_zone\"=\"Asia/Shanghai\"\n);\n</code></pre></p> <p>\u67e5\u8be2\u5206\u533a\u4fe1\u606f\uff1a <pre><code>-- \u67e5\u8be2\u5206\u533a\u4fe1\u606f\nshow partitions from vehicle_gps_data;\n</code></pre></p> <p>\u4fee\u6539\u52a8\u6001\u5206\u533a\u5c5e\u6027\uff1a <pre><code>alter table vehicle_gps_data set (\n    \"dynamic_partition.start\" = \"-2\"\n)\n</code></pre></p> <p>Note</p> <p>\u5728\u4f7f\u7528 ALTER TABLE \u8bed\u53e5\u4fee\u6539\u52a8\u6001\u5206\u533a\u65f6\uff0c\u4e0d\u4f1a\u7acb\u5373\u751f\u6548\u3002Doris \u4f1a\u4ee5\u00a0<code>dynamic_partition_check_interval_seconds</code>\u00a0\u53c2\u6570\u6307\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u8f6e\u8bad\u68c0\u67e5 dynamic partition \u5206\u533a\uff0c\u5b8c\u6210\u9700\u8981\u7684\u5206\u533a\u521b\u5efa\u4e0e\u5220\u9664\u64cd\u4f5c\u3002</p>"},{"location":"DataBase/Doris/Doris%20%E5%8A%A8%E6%80%81%E5%88%86%E5%8C%BA/#_1","title":"\u52a8\u6001\u5206\u533a\u5c5e\u6027\u53c2\u6570","text":"<p>\u52a8\u6001\u5206\u533a\u7684\u53c2\u6570\u4ee5 dynamic_partition \u4e3a\u524d\u7f00\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4ee5\u4e0b\u89c4\u5219\u53c2\u6570\uff1a</p> \u53c2\u6570 \u5fc5\u9009 \u8bf4\u660e <code>enable</code> \u5426 \u662f\u5426\u5f00\u542f\u52a8\u6001\u5206\u533a\u7279\u6027\u3002\u53ef\u4ee5\u6307\u5b9a\u4e3a TRUE \u6216 FALSE\u3002\u5982\u679c\u6307\u5b9a\u4e86\u52a8\u6001\u5206\u533a\u5176\u4ed6\u5fc5\u586b\u53c2\u6570\uff0c\u9ed8\u8ba4\u4e3a TRUE\u3002 <code>time_unit</code> \u662f \u52a8\u6001\u5206\u533a\u8c03\u5ea6\u7684\u5355\u4f4d\u3002\u53ef\u6307\u5b9a\u4e3a\u00a0<code>HOUR</code>\u3001<code>DAY</code>\u3001<code>WEEK</code>\u3001<code>MONTH</code>\u3001<code>YEAR</code>\u3002\u5206\u522b\u8868\u793a\u6309\u5c0f\u65f6\u3001\u6309\u5929\u3001\u6309\u661f\u671f\u3001\u6309\u6708\u3001\u6309\u5e74\u8fdb\u884c\u5206\u533a\u521b\u5efa\u6216\u5220\u9664\uff1a <code>start</code> \u5426 \u52a8\u6001\u5206\u533a\u7684\u8d77\u59cb\u504f\u79fb\uff0c\u4e3a\u8d1f\u6570\u3002\u9ed8\u8ba4\u503c\u4e3a -2147483648\uff0c\u5373\u4e0d\u5220\u9664\u5386\u53f2\u5206\u533a\u3002\u6839\u636e\u00a0<code>time_unit</code>\u00a0\u5c5e\u6027\u7684\u4e0d\u540c\uff0c\u4ee5\u5f53\u5929\uff08\u661f\u671f/\u6708\uff09\u4e3a\u57fa\u51c6\uff0c\u5206\u533a\u8303\u56f4\u5728\u6b64\u504f\u79fb\u4e4b\u524d\u7684\u5206\u533a\u5c06\u4f1a\u88ab\u5220\u9664\u3002\u6b64\u504f\u79fb\u4e4b\u540e\u81f3\u5f53\u524d\u65f6\u95f4\u7684\u5386\u53f2\u5206\u533a\u5982\u4e0d\u5b58\u5728\uff0c\u662f\u5426\u521b\u5efa\u53d6\u51b3\u4e8e\u00a0<code>dynamic_partition.create_history_partition</code>\u3002 <code>end</code> \u662f \u52a8\u6001\u5206\u533a\u7684\u7ed3\u675f\u504f\u79fb\uff0c\u4e3a\u6b63\u6570\u3002\u6839\u636e\u00a0<code>time_unit</code>\u00a0\u5c5e\u6027\u7684\u4e0d\u540c\uff0c\u4ee5\u5f53\u5929\uff08\u661f\u671f/\u6708\uff09\u4e3a\u57fa\u51c6\uff0c\u63d0\u524d\u521b\u5efa\u5bf9\u5e94\u8303\u56f4\u7684\u5206\u533a\u3002 <code>prefix</code> \u662f \u52a8\u6001\u521b\u5efa\u7684\u5206\u533a\u540d\u524d\u7f00\u3002 <code>buckets</code> \u5426 \u52a8\u6001\u521b\u5efa\u7684\u5206\u533a\u6240\u5bf9\u5e94\u7684\u5206\u6876\u6570\u3002\u8bbe\u7f6e\u8be5\u53c2\u6570\u540e\u4f1a\u8986\u76d6\u00a0<code>DISTRIBUTED</code>\u00a0\u4e2d\u6307\u5b9a\u7684\u5206\u6876\u6570\u3002\u91cf\u3002 <code>replication_num</code> \u5426 \u52a8\u6001\u521b\u5efa\u7684\u5206\u533a\u6240\u5bf9\u5e94\u7684\u526f\u672c\u6570\u91cf\uff0c\u5982\u679c\u4e0d\u586b\u5199\uff0c\u5219\u9ed8\u8ba4\u4e3a\u8be5\u8868\u521b\u5efa\u65f6\u6307\u5b9a\u7684\u526f\u672c\u6570\u91cf\u3002 <code>create_history_partition</code> \u5426 \u9ed8\u8ba4\u4e3a false\u3002\u5f53\u7f6e\u4e3a true \u65f6\uff0cDoris \u4f1a\u81ea\u52a8\u521b\u5efa\u6240\u6709\u5206\u533a\uff0c\u5177\u4f53\u521b\u5efa\u89c4\u5219\u89c1\u4e0b\u6587\u3002\u540c\u65f6\uff0cFE \u7684\u53c2\u6570\u00a0<code>max_dynamic_partition_num</code>\u00a0\u4f1a\u9650\u5236\u603b\u5206\u533a\u6570\u91cf\uff0c\u4ee5\u907f\u514d\u4e00\u6b21\u6027\u521b\u5efa\u8fc7\u591a\u5206\u533a\u3002\u5f53\u671f\u671b\u521b\u5efa\u7684\u5206\u533a\u4e2a\u6570\u5927\u4e8e\u00a0<code>max_dynamic_partition_num</code>\u00a0\u503c\u65f6\uff0c\u64cd\u4f5c\u5c06\u88ab\u7981\u6b62\u3002\u5f53\u4e0d\u6307\u5b9a\u00a0<code>start</code>\u00a0\u5c5e\u6027\u65f6\uff0c\u8be5\u53c2\u6570\u4e0d\u751f\u6548\u3002 <code>history_partition_num</code> \u5426 \u5f53<code>create_history_partition</code>\u00a0\u4e3a\u00a0<code>true</code>\u00a0\u65f6\uff0c\u8be5\u53c2\u6570\u7528\u4e8e\u6307\u5b9a\u521b\u5efa\u5386\u53f2\u5206\u533a\u6570\u91cf\u3002\u9ed8\u8ba4\u503c\u4e3a -1\uff0c\u5373\u672a\u8bbe\u7f6e\u3002\u8be5\u53d8\u91cf\u4e0e\u00a0<code>dynamic_partition.start</code>\u00a0\u4f5c\u7528\u76f8\u540c\uff0c\u5efa\u8bae\u540c\u65f6\u53ea\u8bbe\u7f6e\u4e00\u4e2a\u3002 <code>start_day_of_week</code> \u5426 \u5f53\u00a0<code>time_unit</code>\u00a0\u4e3a\u00a0<code>WEEK</code>\u00a0\u65f6\uff0c\u8be5\u53c2\u6570\u7528\u4e8e\u6307\u5b9a\u6bcf\u5468\u7684\u8d77\u59cb\u70b9\u3002\u53d6\u503c\u4e3a 1 \u5230 7\u3002\u5176\u4e2d 1 \u8868\u793a\u5468\u4e00\uff0c7 \u8868\u793a\u5468\u65e5\u3002\u9ed8\u8ba4\u4e3a 1\uff0c\u5373\u8868\u793a\u6bcf\u5468\u4ee5\u5468\u4e00\u4e3a\u8d77\u59cb\u70b9\u3002 <code>start_day_of_month</code> \u5426 \u5f53\u00a0<code>time_unit</code>\u00a0\u4e3a\u00a0<code>MONTH</code>\u00a0\u65f6\uff0c\u8be5\u53c2\u6570\u7528\u4e8e\u6307\u5b9a\u6bcf\u6708\u7684\u8d77\u59cb\u65e5\u671f\u3002\u53d6\u503c\u4e3a 1 \u5230 28\u3002\u5176\u4e2d 1 \u8868\u793a\u6bcf\u6708 1 \u53f7\uff0c28 \u8868\u793a\u6bcf\u6708 28 \u53f7\u3002\u9ed8\u8ba4\u4e3a 1\uff0c\u5373\u8868\u793a\u6bcf\u6708\u4ee5 1 \u53f7\u4e3a\u8d77\u59cb\u70b9\u3002\u6682\u4e0d\u652f\u6301\u4ee5 29\u300130\u300131 \u53f7\u4e3a\u8d77\u59cb\u65e5\uff0c\u4ee5\u907f\u514d\u56e0\u95f0\u5e74\u6216\u95f0\u6708\u5e26\u6765\u7684\u6b67\u4e49\u3002 <code>reserved_history_periods</code> \u5426 \u9700\u8981\u4fdd\u7559\u7684\u5386\u53f2\u5206\u533a\u7684\u65f6\u95f4\u8303\u56f4\u3002\u5f53<code>dynamic_partition.time_unit</code>\u00a0\u8bbe\u7f6e\u4e3a \"DAY/WEEK/MONTH/YEAR\" \u65f6\uff0c\u9700\u8981\u4ee5\u00a0<code>[yyyy-MM-dd,yyyy-MM-dd],[...,...]</code>\u00a0\u683c\u5f0f\u8fdb\u884c\u8bbe\u7f6e\u3002\u5f53<code>dynamic_partition.time_unit</code>\u00a0\u8bbe\u7f6e\u4e3a \"HOUR\" \u65f6\uff0c\u9700\u8981\u4ee5\u00a0<code>[yyyy-MM-dd HH:mm:ss,yyyy-MM-dd HH:mm:ss],[...,...]</code>\u00a0\u7684\u683c\u5f0f\u6765\u8fdb\u884c\u8bbe\u7f6e\u3002\u5982\u679c\u4e0d\u8bbe\u7f6e\uff0c\u9ed8\u8ba4\u4e3a\u00a0<code>\"NULL\"</code>\u3002 <code>time_zone</code> \u5426 \u52a8\u6001\u5206\u533a\u65f6\u533a\uff0c\u9ed8\u8ba4\u4e3a\u5f53\u524d\u670d\u52a1\u5668\u7684\u7cfb\u7edf\u65f6\u533a\uff0c\u5982\u00a0<code>Asia/Shanghai</code>\u3002\u66f4\u591a\u65f6\u533a\u8bbe\u7f6e\u53ef\u4ee5\u53c2\u8003\u65f6\u533a\u7ba1\u7406\u3002"},{"location":"DataBase/Doris/Doris%20%E5%8A%A8%E6%80%81%E5%88%86%E5%8C%BA/#fe","title":"FE \u914d\u7f6e\u53c2\u6570","text":"<p>\u53ef\u4ee5\u5728 FE \u914d\u7f6e\u6587\u4ef6\u6216\u901a\u8fc7\u00a0<code>ADMIN SET FRONTEND CONFIG</code>\u00a0\u547d\u4ee4\u4fee\u6539 FE \u4e2d\u7684\u52a8\u6001\u5206\u533a\u53c2\u6570\u914d\u7f6e\uff1a</p> \u53c2\u6570 \u9ed8\u8ba4\u503c \u8bf4\u660e <code>dynamic_partition_enable</code> false \u662f\u5426\u5f00\u542f Doris \u7684\u52a8\u6001\u5206\u533a\u529f\u80fd\u3002\u8be5\u53c2\u6570\u53ea\u5f71\u54cd\u52a8\u6001\u5206\u533a\u8868\u7684\u5206\u533a\u64cd\u4f5c\uff0c\u4e0d\u5f71\u54cd\u666e\u901a\u8868\u3002 <code>dynamic_partition_check_interval_seconds</code> 600 \u52a8\u6001\u5206\u533a\u7ebf\u7a0b\u7684\u6267\u884c\u9891\u7387\uff0c\u5355\u4f4d\u4e3a\u79d2\u3002 <code>max_dynamic_partition_num</code> 500 \u7528\u4e8e\u9650\u5236\u521b\u5efa\u52a8\u6001\u5206\u533a\u8868\u65f6\u53ef\u4ee5\u521b\u5efa\u7684\u6700\u5927\u5206\u533a\u6570\uff0c\u907f\u514d\u4e00\u6b21\u521b\u5efa\u8fc7\u591a\u5206\u533a\u3002"},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20Kafka%20%E7%9A%84%E6%95%B0%E6%8D%AE/","title":"Doris \u63a5\u5165 Kafka \u7684\u6570\u636e","text":""},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20Kafka%20%E7%9A%84%E6%95%B0%E6%8D%AE/#kafka","title":"Kafka \u8d26\u53f7\u6388\u6743","text":"<pre><code>bin/kafka-acls.sh --bootstrap-server localhost:9092 \\\n    --add \\\n    --allow-principal User:xxx \\\n    --operation Read \\\n    --topic '*' --group 'xxx' \\\n    --command-config admin-jaas \n</code></pre>"},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20Kafka%20%E7%9A%84%E6%95%B0%E6%8D%AE/#_1","title":"\u521b\u5efa\u552f\u4e00\u6a21\u578b","text":"<pre><code>CREATE TABLE user_info(\n    user_id BIGINT NOT NULL COMMENT \"\u7528\u6237 ID\",\n    name VARCHAR(20) COMMENT \"\u7528\u6237\u59d3\u540d\",\n    born_time datetime COMMENT \"\u51fa\u751f\u65e5\u671f\"\n)\nUNIQUE KEY(user_id)\nDISTRIBUTED BY HASH(user_id) BUCKETS 1;\n</code></pre>"},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20Kafka%20%E7%9A%84%E6%95%B0%E6%8D%AE/#_2","title":"\u521b\u5efa\u5bfc\u5165\u4f5c\u4e1a","text":"<pre><code>CREATE ROUTINE LOAD `db_name`.`job_name` ON `user_info`\nPROPERTIES (\n    \"format\" = \"json\",\n    \"strict_mode\" = \"false\")\nFROM KAFKA (\n    \"kafka_broker_list\" = \"172.31.8.164:9092,172.31.8.165:9092,172.31.8.166:9092\",\n    \"kafka_topic\" = \"quickstart-events\",\n    \"property.group.id\" = \"xxxxx\",\n    \"property.kafka_default_offsets\" = \"OFFSET_END\",\n    \"property.security.protocol\" = \"SASL_PLAINTEXT\",\n    \"property.sasl.mechanism\" = \"PLAIN\",\n    \"property.sasl.username\" = \"xxxx\",\n    \"property.sasl.password\" = \"xxxx\");\n</code></pre>"},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20Kafka%20%E7%9A%84%E6%95%B0%E6%8D%AE/#kafka_1","title":"\u5f80 Kafka \u4e2d\u5199\u5165\u6570\u636e\u6d4b\u8bd5","text":"<p>\u503c\u4e3a null \u6216\u8005\u65e5\u671f\u683c\u5f0f\u90fd\u517c\u5bb9\uff0cunique key \u6a21\u5f0f\u4e5f\u80fd\u552f\u4e00\u53bb\u91cd\u4fdd\u7559\u65b0\u7684\u6570\u636e\u3002 <pre><code>{ \"user_id\" : 1, \"name\" : \"Benjamin\", \"born_time\": \"2023-01-01 00:00:00\" }\n{ \"user_id\" : 2, \"name\" : \"Emily\", \"born_time\": \"20240101122323\" }\n{ \"user_id\" : 3, \"name\" : \"Emily\", \"born_time\": \"20240101122323\" }\n{ \"user_id\" : 4, \"name\" : \"Emily\", \"born_time\": null }\n{ \"user_id\" : 5, \"name\" : \"Alexander\"}\n{ \"user_id\" : 4, \"name\" : \"Alexander\"}\n{ \"user_id\" : 6, \"born_time\": \"20240101122323\", \"name\" : \"Emily\"}\n</code></pre></p>"},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20Kafka%20%E7%9A%84%E6%95%B0%E6%8D%AE/#_3","title":"\u5bfc\u5165\u4efb\u52a1\u7ba1\u7406","text":"<p>show routine load \u80fd\u591f\u67e5\u8be2\u5bfc\u5165\u4f5c\u4e1a\u7684\u72b6\u6001\u3002</p> <p>\u5982\u679c\u9047\u5230\u9519\u8bef\uff0c\u6bd4\u5982\u5fc5\u586b\u5b57\u6bb5\u7f3a\u5c11\u4f1a\u5bfc\u81f4\u4efb\u52a1 pause\uff0c<code>resume routine load for task_name;</code> \u91cd\u542f\u542f\u52a8\u4efb\u52a1\u5c31\u597d\uff0c\u4f1a\u8df3\u8fc7\u9519\u8bef\u7684\u6d88\u606f\u3002</p> <p>\u6d4b\u8bd5\u5b8c\u6bd5\u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7 pause \u6682\u505c\u5bfc\u5165\u4efb\u52a1\uff1a<code>pause routine load for  task_name;</code>\u3002</p>"},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20Kafka%20%E7%9A%84%E6%95%B0%E6%8D%AE/#_4","title":"\u6848\u4f8b\u8c03\u4f18","text":""},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20Kafka%20%E7%9A%84%E6%95%B0%E6%8D%AE/#_5","title":"\u8fc7\u6ee4\u6570\u636e","text":"<p>\u524d\u7aef\u4e0a\u4f20\u7684\u6570\u636e\u65e5\u671f\u683c\u5f0f\u662f\u5bf9\u7684\uff0c\u4f46\u662f\u503c\u4e0d\u5bf9\uff0c\u6bd4\u5982 0024-01-01 00:00:00\uff0c\u8fd9\u79cd\u6570\u636e\u7531\u4e8e\u6ca1\u6709\u5bf9\u5e94\u7684\u5206\u533a\u8868\uff0c\u5bfc\u81f4 Routine Load \u5bfc\u5165\u4efb\u52a1\u6682\u505c\u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 Routine Load \u5bfc\u5165\u4efb\u52a1\uff0c\u4ece\u6307\u5b9a\u7684 Kafka Topic \u5206\u533a\u548c\u504f\u79fb\u5f00\u59cb\u6d88\u8d39\u6570\u636e\uff0c\u4f46\u662f\u8fd9\u6837\u5b9a\u4f4d\u810f\u6570\u636e\u7684\u4f4d\u7f6e\u6bd4\u8f83\u9ebb\u70e6\u3002</p> <p>\u6216\u8005\uff0c\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 Routine Load \u5bfc\u5165\u4efb\u52a1 load_properties \u7684 WHERE \u5b50\u6a21\u5757\uff0c\u6765\u8fc7\u6ee4\u6389\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\u3002</p> <p>\u76ee\u524d\u8fd8\u4e0d\u652f\u6301\u76f4\u63a5\u4fee\u6539 RoutineLoad \u589e\u52a0 Where \u5b50\u53e5\uff0c\u6240\u4ee5\u8981 STOP RoutineLoad\uff0c \u7136\u540e\u518d\u91cd\u65b0\u521b\u5efa\u3002\u91cd\u65b0\u521b\u5efa\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 kafka_partitions \u548c kafka_offsets \u6307\u5b9a\u6bcf\u4e2a\u5206\u533a\u7684\u8d77\u59cb\u6d88\u8d39 offset\uff0c\u6765\u907f\u514d\u91cd\u590d\u6216\u8005\u9057\u6f0f\u6d88\u8d39\u6570\u636e\u3002 <pre><code>CREATE ROUTINE LOAD `iot_data`.`kafka-quickstart_events` ON `quickstart_events`\nWHERE born_time &gt; '1900-01-01 00:00:00'\nPROPERTIES (\n    \"format\" = \"json\",\n    \"strict_mode\" = \"false\")\nFROM KAFKA (\n    \"kafka_broker_list\" = \"172.31.8.164:9092,172.31.8.165:9092,172.31.8.166:9092\",\n    \"kafka_topic\" = \"quickstart-events\",\n    \"kafka_partitions\" = \"0,1,2\",\n    \"kafka_offsets\" = \"1239,1235,1237\",\n    \"property.group.id\" = \"xxxxx\",\n    \"property.security.protocol\" = \"SASL_PLAINTEXT\",\n    \"property.sasl.mechanism\" = \"PLAIN\",\n    \"property.sasl.username\" = \"xxxx\",\n    \"property.sasl.password\" = \"xxxx\");\n</code></pre></p> <p>\u4e0a\u9762\u7684\u60c5\u51b5\u662f\u6709\u6570\u636e\uff0c\u4f46\u662f\u6570\u636e\u4e0d\u5728\u5206\u533a\u91cc\u9762\u3002\u8fd8\u6709\u4e00\u79cd\u810f\u6570\u636e\u662f\u5fc5\u586b\u5b57\u6bb5\u4e3a\u7a7a\uff0c\u8fd9\u65f6\u4f7f\u7528 where \u5c31\u8fc7\u6ee4\u4e0d\u6389\uff0c\u56e0\u4e3a Doris \u4f1a\u5728 where \u5b50\u53e5\u4e4b\u524d\u8fdb\u8d28\u91cf\u68c0\u67e5\u3002\u6240\u4ee5\u9700\u8981\u4f7f\u7528 columns_mapping \u8fdb\u884c\u5904\u7406\u3002 <pre><code>CREATE ROUTINE LOAD yunlu_iot_data.tunnel_rectangular_info ON tunnel_rectangular_info\nCOLUMNS(\ndev_id = IFNULL(dev_id, 'unknown')\n),\nWHERE dev_id != 'unknown'\nFROM KAFKA (\n</code></pre></p>"},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20Kafka%20%E7%9A%84%E6%95%B0%E6%8D%AE/#routineload","title":"\u4fee\u6539 RoutineLoad \u5b50\u4efb\u52a1\u6700\u5927\u8fd0\u884c\u65f6\u95f4","text":"<p>\u9ed8\u8ba4 60 \u79d2\uff0c\u4e3a\u4e86\u63d0\u5347\u6570\u636e\u5165\u5e93\u9891\u7387\uff0c\u4fee\u6539\u4e3a 10 \u79d2\u3002 <pre><code>pause routine load for iot_data.hk_anpr;\n\nALTER ROUTINE LOAD FOR iot_data.hk_anpr PROPERTIES(\n    \"max_batch_interval\" = \"10\"\n)\n\nresume routine load for iot_data.hk_anpr;\n</code></pre></p>"},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20MySQL%20%E7%9A%84%E6%95%B0%E6%8D%AE/","title":"Doris \u63a5\u5165 MySQL \u7684\u6570\u636e","text":""},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20MySQL%20%E7%9A%84%E6%95%B0%E6%8D%AE/#_1","title":"\u6570\u636e\u51c6\u5907","text":""},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20MySQL%20%E7%9A%84%E6%95%B0%E6%8D%AE/#mysql","title":"MySQL \u51c6\u5907","text":"<p>\u521b\u5efa\u8868 <pre><code>create database iot_data;\nuse iod_data;\n\nCREATE TABLE `thermo_hygro_meter` (\n  `device_id` varchar(20) DEFAULT NULL COMMENT '\u68c0\u6d4b\u8bbe\u5907ID',\n  `detect_time` datetime NOT NULL COMMENT '\u68c0\u6d4b\u65f6\u95f4',\n  `temperature` decimal(5,3) DEFAULT NULL COMMENT '\u6e29\u5ea6\uff0c\u5355\u4f4d\uff1a\u6444\u6c0f\u5ea6',\n  `humidity` decimal(5,3) DEFAULT NULL COMMENT '\u76f8\u5bf9\u6e7f\u5ea6',\n  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4',\n  UNIQUE KEY `device_id` (`device_id`,`detect_time`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='\u6e29\u6e7f\u5ea6\u68c0\u6d4b\u6307\u6807';\n</code></pre></p> <p>\u63d2\u5165\u793a\u4f8b\u6570\u636e <pre><code>insert into thermo_hygro_meter \nvalues \n(\"TH-001\", '2024-01-01 00:00:00', 23.50, 50.01, '2024-01-01 00:00:02'),\n(\"TH-001\", '2024-01-02 00:00:00', 25.00, 48.00, '2024-01-02 00:00:01'),\n(\"TH-001\", '2024-01-03 00:00:00', 28.20, 49.21, '2024-01-03 00:00:02'),\n(\"TH-002\", '2024-01-01 00:00:00', 23.30, 47.11, '2024-01-01 00:00:01'),\n(\"TH-002\", '2024-01-02 00:00:00', 24.40, 48.21, '2024-01-02 00:00:02'),\n(\"TH-002\", '2024-01-03 00:00:00', 27.50, 49.31, '2024-01-03 00:00:02'),\n(\"TH-003\", '2024-01-01 00:00:00', 23.60, 45.41, '2024-01-01 00:00:01'),\n(\"TH-003\", '2024-01-02 00:00:00', 22.70, 52.56, '2024-01-02 00:00:02'),\n(\"TH-003\", '2024-01-03 00:00:00', 21.80, 53.74, '2024-01-03 00:00:02');\n</code></pre></p>"},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20MySQL%20%E7%9A%84%E6%95%B0%E6%8D%AE/#doris","title":"Doris \u51c6\u5907","text":"<p>\u521b\u5efa\u8868 <pre><code>create database iot_data;\nuse iod_data;\n\nCREATE TABLE `thermo_hygro_meter` (  \n  `device_id` varchar(20) DEFAULT NULL COMMENT '\u68c0\u6d4b\u8bbe\u5907ID',  \n  `detect_time` datetime NOT NULL COMMENT '\u68c0\u6d4b\u65f6\u95f4',  \n  `temperature` decimal(5, 3) DEFAULT NULL COMMENT '\u6e29\u5ea6\uff0c\u5355\u4f4d\uff1a\u6444\u6c0f\u5ea6',  \n  `humidity` decimal(5, 3) DEFAULT NULL COMMENT '\u76f8\u5bf9\u6e7f\u5ea6',  \n  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4'  \n)   \nUNIQUE KEY (`device_id`, `detect_time`)   \nDISTRIBUTED BY HASH(`detect_time`) BUCKETS 1;  \n</code></pre></p>"},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20MySQL%20%E7%9A%84%E6%95%B0%E6%8D%AE/#insert-into-select","title":"INSERT INTO SELECT","text":"<p>\u53c2\u8003\u6587\u6863 1. https://doris.apache.org/zh-CN/docs/2.0/lakehouse/database/jdbc 2. https://doris.apache.org/zh-CN/docs/2.0/data-operate/import/insert-into-manual  </p> <p>\u4e0b\u8f7d\u6700\u65b0\u7684 MySQL JDBC \u9a71\u52a8\uff0c\u653e\u5728 FE \u548c BE \u7684 <code>fe/jdbc_drivers/</code> <code>be/jdbc_drivers</code> \u76ee\u5f55\u4e0b\u3002</p> <p>\u521b\u5efa\u6570\u636e\u6e90 <pre><code>-- \u521b\u5efa mysql \u6570\u636e\u6e90\nCREATE CATALOG mysql PROPERTIES (\n    \"type\"=\"jdbc\",\n    \"user\"=\"root\",\n    \"password\"=\"xxxx\",\n    \"jdbc_url\" = \"jdbc:mysql://192.168.31.11:3306\",\n    \"driver_url\" = \"mysql-connector-j-8.4.0.jar\",\n    \"driver_class\" = \"com.mysql.cj.jdbc.Driver\"\n);\n\n-- \u67e5\u8be2\u6dfb\u52a0\u7684 catalog \u6570\u636e\u6e90\nshow catalogs;\n\n-- \u67e5\u8be2 mysql \u4e2d\u6709\u54ea\u4e9b\u6570\u636e\u5e93\nshow databases from mysql;\n\n-- \u67e5\u770b mysql iot_data \u6570\u636e\u5e93\u4e2d\u6709\u54ea\u4e9b\u8868\nshow tables from mysql.iot_data;\n\n-- \u67e5\u770b mysql iot_data \u6570\u636e\u5e93\u4e2d thermo_hygro_meter \u8868\u7684\u6570\u636e\nselect * from mysql.iot_data.thermo_hygro_meter;\n</code></pre></p> <p>\u5bfc\u5165 MySQL \u4e2d\u7684\u6570\u636e\u5230 Doris\u3002 <pre><code>insert into thermo_hygro_meter select * from mysql.iot_data.thermo_hygro_meter;\n\n-- \u6216\u8005\n\ninsert into thermo_hygro_meter(device_id, detect_time, temperature, humidity, create_time)\nselect device_id, detect_time, temperature, humidity, create_time from mysql.iot_data.thermo_hygro_meter;\n</code></pre></p> <p>Note</p> <p>\u521b\u5efa\u5b8c mysql \u6570\u636e\u6e90\u4e4b\u540e\uff0cmysql \u7684\u5143\u6570\u636e\u4fe1\u606f\uff08\u5982\u8868\u7684\u5b57\u6bb5\u5217\u8868\uff09\u4f1a\u88ab Doris \u7f13\u5b58\u4e0b\u6765\u3002\u5982\u679c MySQL \u6e90\u66f4\u65b0\u4e86\u5b57\u6bb5\u4fe1\u606f\uff0c\u4f1a\u5bfc\u81f4\u5728 Doris \u4e2d\u67e5\u8be2\uff08<code>select *</code> \u6216\u8005 <code>select new_field_name</code>\uff09\u51fa\u9519\u3002\u63d0\u95ee\u94fe\u63a5 \u89e3\u51b3\u65b9\u6848\u662f\u5237\u65b0 Catalog \u6570\u636e\u6e90\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u53c2\u8003\u94fe\u63a5\uff1a <pre><code>REFRESH CATALOG catalog_name;  \nREFRESH DATABASE [catalog_name.]database_name;  \nREFRESH TABLE [catalog_name.][database_name.]table_name;\n</code></pre></p> <p>\u6d4b\u8bd5\u5927\u91cf\u6570\u636e\u5bfc\u5165\u7684\u6027\u80fd\u3002</p> <p>\u5728 2.1 \u7248\u672c Doris \u5f15\u5165\u4e86 Job Scheduler \u5b9e\u73b0\u4f5c\u4e1a\u8c03\u5ea6\uff0c\u7ed3\u5408 Catalog \u80fd\u591f\u5b9e\u73b0\u5b9a\u65f6\u540c\u6b65\u6570\u636e\u7684\u65b9\u6848\uff0c\u6700\u9ad8\u9891\u7387\u4e3a 1 \u5206\u949f\u6267\u884c\u4e00\u6b21\u3002</p> <p>\u521b\u5efa\u540c\u6b65\u4f5c\u4e1a <pre><code>CREATE JOB my_job \nON SCHEDULE EVERY 1 DAY STARTS '2020-01-01 00:00:00' \nDO INSERT INTO db1.tbl1 SELECT * FROM db2.tbl2 WHERE  create_time &gt;=  days_add(now(),-1);\n</code></pre></p> <p>\u67e5\u8be2\u540c\u6b65\u4f5c\u4e1a\u548c\u4efb\u52a1 <pre><code>select * from jobs(type='insert');\nselect * from tasks(type='insert');\n</code></pre></p> <p>\u5220\u9664\u5b9a\u65f6\u540c\u6b65\u4f5c\u4e1a <pre><code>DROP JOB where jobName = &lt;job_name&gt; ;\n</code></pre></p>"},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20MySQL%20%E7%9A%84%E6%95%B0%E6%8D%AE/#jdbc","title":"JDBC","text":"<p>\u5bf9\u4e8e\u4e00\u4e9b\u6570\u636e\u5e93\uff08\u6bd4\u5982 MySQL\uff09\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b JDBC \u5e76\u4e0d\u603b\u662f\u5c06\u591a\u4e2a INSERT \u8bed\u53e5\u5408\u5e76\u6210\u4e00\u4e2a\u6279\u91cf\u63d2\u5165\u8bed\u53e5\u53d1\u9001\u7ed9\u6570\u636e\u5e93\uff0c\u800c\u662f\u9010\u6761\u53d1\u9001\u3002\u8fd9\u4f1a\u589e\u52a0\u7f51\u7edc\u5ef6\u8fdf\u548c\u6570\u636e\u5e93\u5904\u7406\u5f00\u9500\u3002\u542f\u7528 <code>rewriteBatchedStatements</code> \u540e\uff0cJDBC \u4f1a\u5c1d\u8bd5\u5c06\u591a\u4e2a INSERT \u8bed\u53e5\u5408\u5e76\u4e3a\u4e00\u4e2a\u5927\u7684 INSERT \u8bed\u53e5\uff0c\u4ee5\u4fbf\u4e00\u6b21\u6027\u53d1\u9001\u7ed9\u6570\u636e\u5e93\uff0c\u4ece\u800c\u663e\u8457\u63d0\u5347\u63d2\u5165\u6548\u7387\u3002</p> <p>Doris \u5728\u542f\u7528\u4e86 <code>rewriteBatchedStatements=true</code> \u4e4b\u540e\u5927\u6279\u91cf\u7684\u5b9e\u65f6\u5199\u5165\uff0c\u8fd8\u662f\u6709\u70b9\u6162\u3002\u5355\u6b21\u5199\u5165 2w \u6761\u6570\u636e\u5927\u6982\u8017\u65f6 20s\u3002</p>"},{"location":"DataBase/Doris/Doris%20%E6%8E%A5%E5%85%A5%20MySQL%20%E7%9A%84%E6%95%B0%E6%8D%AE/#streamload","title":"StreamLoad","text":"<p>\u53c2\u8003\u6570\u636e\u5bfc\u5165\u7684 StreamLoad \u7684\u65b9\u5f0f\u3002</p> <p>\u5982\u679c JSON \u5b57\u6bb5\u4e0e\u8868\u5b57\u6bb5\u5b8c\u5168\u4e00\u81f4\uff0c\u53ef\u4ee5\u7701\u7565 jsonpaths \u548c columns \u8bf7\u6c42\u5934\u3002</p> <pre><code>curl -L -X PUT 'http://172.31.8.116:8030/api/dbname/tablename/_stream_load' \\\n    -H 'Expect: 100-continue' \\\n    -H 'format: json' \\\n    -H 'strip_outer_array: true' \\\n    -H 'jsonpaths: [\"$.user_id\", \"$.name\", \"$.born_time\"]' \\\n    -H 'columns: user_id,name,born_time' \\\n    -H 'Content-Type: application/json' \\\n    -H 'Authorization: Basic base64(username:password)' \\\n    -d '[\n    {\n        \"user_id\": 1,\n        \"name\": \"Emily\",\n        \"born_time\": \"20231212234523111\"\n    },\n    {\n        \"user_id\": 2,\n        \"name\": \"Benjamin\",\n        \"born_time\": \"20231212234523222\"\n    }]'\n</code></pre>"},{"location":"DataBase/ES/ES%20DSL%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F/","title":"ES DSL\u67e5\u8be2\u65b9\u5f0f","text":"<p>\u67e5\u8be2\u6240\u6709\uff1a\u67e5\u8be2\u51fa\u6240\u6709\u6570\u636e\uff0c\u4e00\u822c\u6d4b\u8bd5\u4f7f\u7528\uff0cmatch_all\uff0c\u4e0d\u4f1a\u8fd4\u56de\u5168\u90e8\u6570\u636e\uff0c\u6709\u9650\u5236\u6761\u6570\u5566\u3002 \u5168\u6587\u68c0\u7d22\uff1a\u5229\u7528\u5206\u8bcd\u5668\u5bf9\u67e5\u8be2\u6587\u672c\u8fdb\u884c\u5206\u8bcd\uff0c\u7136\u540e\u5339\u914d\u5012\u6392\u7d22\u5f15\u5e93\uff0c\u7136\u540e\u62ff\u5230\u6587\u6863\u7684 ID\uff0c\u8ba1\u7b97\u5f97\u5206\uff0c\u6839\u636e ID \u67e5\u8be2\u6587\u6863\u3002 - match_query - match - multi_match_query \u7cbe\u786e\u67e5\u8be2\uff1a\u6839\u636e\u7cbe\u786e\u7684\u8bcd\u6761\u67e5\u627e\u6570\u636e\uff0c\u4e00\u822c\u67e5\u8be2 keyword\u3001\u6570\u503c\u3001\u65e5\u671f\u3001boolean \u7b49\u7c7b\u578b\u5b57\u6bb5\u3002 - ids - range - term \u5730\u7406\u67e5\u8be2\uff1a\u6839\u636e\u7ecf\u7eac\u5ea6\u67e5\u8be2\u3002 - geo_distance - geo_bounding_box \u590d\u5408\u67e5\u8be2\uff1a\u5c06\u4e0a\u8ff0\u7684\u67e5\u8be2\u6761\u4ef6\u7ec4\u5408\u8d77\u6765\uff0c\u5408\u5e76\u67e5\u8be2\u6761\u4ef6\u3002 - bool - function_score</p> <p>\u57fa\u672c\u8bed\u6cd5 <pre><code>GET /indexName/_search\n{\n    \"query\": {\n        \"\u67e5\u8be2\u7c7b\u578b\": {\n            \"\u67e5\u8be2\u6761\u4ef6\": \"\u6761\u4ef6\u503c\"\n        }\n    }\n}\n</code></pre></p> <p>\u67e5\u8be2\u793a\u4f8b <pre><code># \u67e5\u8be2\u5168\u90e8\nGET /book/_search\n{\n  \"query\": {\n    \"match_all\": {}\n  }\n}\n\n# \u5168\u6587\u68c0\u7d22\uff0c\u5355\u5b57\u6bb5\nGET /book/_search\n{\n  \"query\": {\n    \"match\": {\n      \"all\": \"Java\"\n    }\n  }\n}\n\n# \u5168\u6587\u68c0\u7d22\uff0c\u591a\u5b57\u6bb5\uff0c\u53ef\u4ee5\u4f7f\u7528 * \u8868\u793a\u5168\u90e8\u5b57\u6bb5\nGET /book/_search\n{\n  \"query\": {\n    \"multi_match\": {\n      \"query\": \"Java\",\n      \"fields\": [\"name\", \"author\"]\n    }\n  }\n}\n\n# \u7cbe\u786e\u67e5\u8be2\u8bcd\u6761\u67e5\u8be2\nGET /book/_search\n{\n  \"query\": {\n    \"term\": {\n      \"name\": {\n        \"value\": \"Java \u63ed\u79d8\"\n      }\n    }\n  }\n}\n\n# \u7cbe\u786e\u67e5\u8be2\u8303\u56f4\u67e5\u8be2\nGET /boot/_search\n{\n  \"query\": {\n    \"range\": {\n      \"public_year\": {\n        \"gte\": 2013,\n        \"lte\": 2034\n      }\n    }\n  }\n}\n</code></pre></p>"},{"location":"DataBase/ES/%E6%93%8D%E4%BD%9C/","title":"\u64cd\u4f5c","text":""},{"location":"DataBase/ES/%E6%93%8D%E4%BD%9C/#mapping","title":"Mapping \u64cd\u4f5c","text":"<p>mapping \u5927\u81f4\u76f8\u5f53\u4e8e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684 DDL\uff0c\u662f\u5bf9\u6587\u6863\u7684\u7ea6\u675f\u3002</p> <ul> <li>type \u6570\u636e\u7c7b\u578b\uff0c\u5e38\u89c1\u7684\u7c7b\u578b\u5982\u4e0b\u3002\u6ca1\u6709\u6570\u7ec4\u7c7b\u578b\uff0c\u4f46\u662f\u4e00\u4e2a\u5b57\u6bb5\u53ef\u4ee5\u6709\u591a\u4e2a\u503c\u3002<ul> <li>\u5b57\u7b26\u4e32\uff1atext\uff08\u53ef\u5206\u8bcd\u7684\u6587\u672c\uff09\uff0ckeyword\uff08\u7cbe\u786e\u503c\uff0c\u5982\u54c1\u724c\u3001\u56fd\u5bb6\u3001IP \u5730\u5740\u7b49\uff09\u3002</li> <li>\u6570\u503c\uff1along\u3001integer\u3001short\u3001byte\u3001double\u3001float\u3002</li> <li>\u5e03\u5c14\u503c\uff1aboolean\u3002</li> <li>\u65e5\u671f\uff1adate\u3002</li> <li>\u5bf9\u8c61\uff1aobject\u3002</li> </ul> </li> <li>index \u7d22\u5f15\uff0c\u662f\u5426\u521b\u5efa\u5012\u6392\u7d22\u5f15\uff0c\u9ed8\u8ba4\u4e3a true \u652f\u6301\u641c\u7d22\u3002\u4e0d\u9700\u8981\u53c2\u4e0e\u641c\u7d22\u7684\u5b57\u6bb5\u8bbe\u7f6e\u4e3a false\u3002</li> <li>analyzer \u5206\u8bcd\u5668\uff0c\u4e00\u822c\u4ec5 text \u7c7b\u578b\u7684\u5b57\u6bb5\u9700\u8981\u6307\u5b9a\u5206\u8bcd\u5668\u3002</li> <li>properties \u5b50\u5b57\u6bb5\uff0c\u4e00\u822c object \u7c7b\u578b\u9700\u8981\u8bbe\u7f6e\u3002</li> </ul> <p>\u67e5\u770b\u6240\u6709\u7684\u7d22\u5f15 <pre><code>GET /_cat/indices?v\n</code></pre></p> <p>\u521b\u5efa\u7d22\u5f15\u5e93 <pre><code>PUT /index_name\n{\n    \"mappings\": {\n        \"properties\": {\n            \"field_name_1\": {\n                \"type\": \"text\",\n                \"analyzer\": \"ik_max_word\"\n            }\n        }\n    }\n}\n</code></pre></p> <p>\u67e5\u8be2\u7d22\u5f15\u5e93 <pre><code>GET /index_name\n</code></pre></p> <p>\u5220\u9664\u7d22\u5f15\u5e93 <pre><code>DELETE /index_name\n</code></pre></p> <p>\u7d22\u5f15\u5e93\u4e0d\u652f\u6301\u4fee\u6539\uff0c\u4f46\u662f\u53ef\u4ee5\u6dfb\u52a0\u65b0\u7684\u5b57\u6bb5\u3002 <pre><code>PUT /index_name/_mapping\n{\n    \"properties\": {\n        \"new_field_name\": {\n            \"type\": \"text\"\n        }\n    }\n}\n</code></pre></p>"},{"location":"DataBase/ES/%E6%93%8D%E4%BD%9C/#document","title":"Document \u64cd\u4f5c","text":"<p>\u65b0\u589e\uff0c\u540c\u65f6\u6307\u5b9aID <pre><code>POST /index_name/_doc/id\n{\n    \"filed\"\uff1a \"value\"\n}\n</code></pre></p> <p>\u6839\u636eID\u83b7\u53d6 <pre><code>GET /index_name/_doc/id\n</code></pre></p> <p>\u6839\u636eID\u5220\u9664 <pre><code>DELETE /index_name/_doc/id\n</code></pre></p> <p>\u5168\u91cf\u4fee\u6539\uff0c\u4f1a\u5148\u6839\u636e ID \u6267\u884c\u5220\u9664\u64cd\u4f5c\uff0c\u7136\u540e\u518d\u6267\u884c\u65b0\u589e\u64cd\u4f5c <pre><code>PUT /index_name/_doc/id\n{\n    \"field\": \"value\"\n}\n</code></pre></p> <p>\u4fee\u6539\u6307\u5b9a\u5b57\u6bb5\u7684\u503c <pre><code>POST /index_name/_update/id\n{\n    \"doc\": {\n        \"field\": \"new_value\"\n    }\n}\n</code></pre></p>"},{"location":"DataBase/ES/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/","title":"\u73af\u5883\u642d\u5efa","text":"<p>\u521b\u5efa\u7f51\u7edc <pre><code>docker network create elastic-net\n</code></pre></p> <p>\u914d\u7f6e\u5bc6\u7801 <pre><code>export ELASTIC_PASSWORD=\"&lt;ES_PASSWORD&gt;\"  # password for \"elastic\" username\nexport KIBANA_PASSWORD=\"&lt;KIB_PASSWORD&gt;\"   # Used _internally_ by Kibana, must be at least 6 characters long\n</code></pre></p> <p>Docker \u5b89\u88c5 ES <pre><code>docker run -p 9200:9200 -itd --name elasticsearch --network elastic-net \\\n  -e ELASTIC_PASSWORD=$ELASTIC_PASSWORD \\\n  -e \"discovery.type=single-node\" \\\n  -e \"xpack.security.http.ssl.enabled=false\" \\\n  -e \"xpack.license.self_generated.type=basic\" \\\n  docker.elastic.co/elasticsearch/elasticsearch:8.12.2\n</code></pre></p> <p>Docker \u5b89\u88c5 Kibana</p> <p>\u521d\u59cb\u5316 <code>kibana_system</code> \u7528\u6237\u5bc6\u7801 <pre><code>curl -u elastic:$ELASTIC_PASSWORD \\\n  -X POST \\\n  http://localhost:9200/_security/user/kibana_system/_password \\\n  -d '{\"password\":\"'\"$KIBANA_PASSWORD\"'\"}' \\\n  -H 'Content-Type: application/json'\n</code></pre></p> <p>\u5b89\u88c5 Kibana <pre><code>docker run -p 5601:5601 -itd --name kibana --network elastic-net \\\n  -e ELASTICSEARCH_URL=http://elasticsearch:9200 \\\n  -e ELASTICSEARCH_HOSTS=http://elasticsearch:9200 \\\n  -e ELASTICSEARCH_USERNAME=kibana_system \\\n  -e ELASTICSEARCH_PASSWORD=$KIBANA_PASSWORD \\\n  -e \"xpack.security.enabled=false\" \\\n  -e \"xpack.license.self_generated.type=basic\" \\\n  docker.elastic.co/kibana/kibana:8.12.2\n</code></pre></p> <p>\u5b8c\u6210\u5b89\u88c5\u4e86 ES \u548c Kibana\uff0c ES \u5730\u5740\uff1ahttp://192.168.31.11:9200\uff0c ES \u6709\u4e24\u4e2a\u7528\u6237  - \u7ba1\u7406\u5458\u7528\u6237 elastic/$ELASTIC_PASSWORD\u3002 - Kibana \u5bb9\u5668\u8fde\u63a5\u7528\u6237 kibana_system/$KIBANA_PASSWORD Kibana \u5730\u5740\uff1ahttp://192.168.31.11:5601\uff0c\u4f7f\u7528 ES \u7ba1\u7406\u5458\u7528\u6237\u767b\u5f55\u5373\u53ef\u3002</p> <p>ES \u914d\u7f6e\u4e2d\u6587\u5206\u8bcd\u5668 \u4e0b\u8f7d\u5206\u8bcd\u5668\u5b89\u88c5\u5305\uff0chttps://github.com/infinilabs/analysis-ik/releases\uff0c\u6ce8\u610f\u7248\u672c\u5339\u914d\u3002 <pre><code>unzip elasticsearch-analysis-ik-8.12.2.zip -d ik\ndocker cp ik/ elasticsearch:/usr/share/elasticsearch/plugins/\ndocker restart elasticsearch\n</code></pre></p> <p>\u6d4b\u8bd5 ik \u5206\u8bcd\u5668 <pre><code>POST /_analyze\n{\n  \"analyzer\": \"standard\",\n  \"text\": \"nice to meet you \u6211\u662f\u7a0b\u5e8f\u5458\uff01\"\n}\n\nPOST /_analyze\n{\n  \"analyzer\": \"ik_smart\",\n  \"text\": \"nice to meet you \u6211\u662f\u7a0b\u5e8f\u5458\uff01\"\n}\n\nPOST /_analyze\n{\n  \"analyzer\": \"ik_max_word\",\n  \"text\": \"nice to meet you \u6211\u662f\u7a0b\u5e8f\u5458\uff01\"\n}\n</code></pre></p> <p>ik \u5206\u8bcd\u5668\u652f\u6301\u914d\u7f6e\u6269\u5c55\u8bcd\u548c\u505c\u6b62\u8bcd\u3002\u5982\u679c ik \u81ea\u5e26\u7684\u5b57\u5178\u91cc\u9762\u6ca1\u6709\u76f8\u5173\u8bcd\u6c47\uff0c\u9ed8\u8ba4\u5206\u6210\u4e00\u4e2a\u4e00\u4e2a\u5b57\uff0c\u6269\u5c55\u8bcd\u5178\u53ef\u4ee5\u914d\u7f6e\u76f8\u5173\u7684\u8bcd\u907f\u514d\u5206\u6210\u4e00\u4e2a\u4e00\u4e2a\u5b57\u3002\u505c\u6b62\u8bcd\u53ef\u4ee5\u914d\u7f6e\u4e00\u4e9b\u8bed\u6c14\u8bcd\u6216\u8005\u51a0\u8bcd\u6216\u8005\u4e00\u4e9b\u654f\u611f\u8bcd\uff0c\u90a3\u4e48\u5206\u8bcd\u7684\u65f6\u5019\u8fd9\u4e9b\u8bcd\u5c31\u4f1a\u5ffd\u7565\u6389\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;!DOCTYPE properties SYSTEM \"http://java.sun.com/dtd/properties.dtd\"&gt;\n&lt;properties&gt;\n    &lt;comment&gt;IK Analyzer \u6269\u5c55\u914d\u7f6e&lt;/comment&gt;\n    &lt;!--\u7528\u6237\u53ef\u4ee5\u5728\u8fd9\u91cc\u914d\u7f6e\u81ea\u5df1\u7684\u6269\u5c55\u5b57\u5178 --&gt;\n    &lt;entry key=\"ext_dict\"&gt;&lt;/entry&gt;\n     &lt;!--\u7528\u6237\u53ef\u4ee5\u5728\u8fd9\u91cc\u914d\u7f6e\u81ea\u5df1\u7684\u6269\u5c55\u505c\u6b62\u8bcd\u5b57\u5178--&gt;\n    &lt;entry key=\"ext_stopwords\"&gt;&lt;/entry&gt;\n    &lt;!--\u7528\u6237\u53ef\u4ee5\u5728\u8fd9\u91cc\u914d\u7f6e\u8fdc\u7a0b\u6269\u5c55\u5b57\u5178 --&gt;\n    &lt;!-- &lt;entry key=\"remote_ext_dict\"&gt;words_location&lt;/entry&gt; --&gt;\n    &lt;!--\u7528\u6237\u53ef\u4ee5\u5728\u8fd9\u91cc\u914d\u7f6e\u8fdc\u7a0b\u6269\u5c55\u505c\u6b62\u8bcd\u5b57\u5178--&gt;\n    &lt;!-- &lt;entry key=\"remote_ext_stopwords\"&gt;words_location&lt;/entry&gt; --&gt;\n&lt;/properties&gt;\n</code></pre></p>"},{"location":"DataBase/MySQL/MySQL%20Tips/","title":"MySQL Tips","text":"","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20Tips/#count","title":"count \u51fd\u6570\u7684\u6ce8\u610f\u4e8b\u9879","text":"<p><code>count(*)</code> \u4f1a\u7edf\u8ba1\u6240\u6709\u884c\uff1b<code>count(expr)</code> \u51fd\u6570\u53ea\u4f1a\u7edf\u8ba1 <code>expr</code> \u975e NULL \u7684\u884c\u3002</p> <p><code>count(a != b)</code> \u5982\u679c a \u548c b \u5176\u4e2d\u4e00\u4e2a\u4e3a NULL \u6216\u4e24\u4e2a\u90fd\u4e3a NULL\uff0c\u8868\u8fbe\u5f0f <code>a != b</code> \u5c31\u4e3a NULL\uff1b\u5426\u5219\u8868\u8fbe\u5f0f\u7684\u503c\u5c31\u662f TRUE/FALSE\uff0c\u975e NULL\u3002</p> <p><code>sum(case when (a != b) then 1 else 0 end)</code> \u7528\u6765\u7edf\u8ba1 a \u548c b \u90fd\u4e0d\u4e3a NULL \u4e14 a \u548c b \u4e0d\u76f8\u7b49\u7684\u6570\u91cf\u3002</p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20Tips/#find_in_set","title":"find_in_set \u51fd\u6570\u7684\u7528\u6cd5","text":"<p>\u7528\u6cd5 <code>find_in_set(find_str, field_name)</code>\uff0c<code>find_str</code> \u4e3a\u8981\u67e5\u627e\u7684\u5b57\u7b26\u4e32\uff0c<code>field_name</code> \u4e3a\u5b57\u6bb5\u540d\uff0c\u9700\u8981\u4ee5\u82f1\u6587\u7684\u9017\u53f7\u5206\u9694\u3002</p> <p>\u793a\u4f8b\u67e5\u8be2 SQL\uff1a <pre><code>select * from user where find_in_set('\u4e2d\u56fd\u4eba', tag);\n</code></pre></p> <p><code>Mybatis Plus</code> \u4e2d\u7684\u7528\u6cd5\uff1a <pre><code>Wrappers.&lt;User&gt;lambdaQuery()\n    .apply(\"find_in_set({0}, tag)\", \"\u4e2d\u56fd\u4eba\");\n</code></pre></p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20Tips/#root","title":"root \u7528\u6237\u5fd8\u8bb0\u5bc6\u7801","text":"<p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\u589e\u52a0\u9009\u9879 <code>skip-grant-tables</code>\uff0c\u7136\u540e\u91cd\u542f MySQL \u670d\u52a1\u3002 </p> <p>\u76f4\u63a5\u8f93\u5165 mysql \u547d\u4ee4\u767b\u5f55\u6570\u636e\u5e93\uff0c\u6e05\u9664 root \u7528\u6237\u7684\u8eab\u4efd\u8ba4\u8bc1\u4fe1\u606f\uff1a <pre><code>update mysql.user set authentication_string = null where user = 'root';\nflush privileges;\nexit;\n</code></pre></p> <p>\u518d\u6b21\u8f93\u5165\u547d\u4ee4  <code>mysql -u root</code> \u8fdb\u5165 MySQL \u66f4\u65b0 root \u7528\u6237\u5bc6\u7801\uff1a <pre><code>alter user root@localhost identified  by 'new_password';\nflush privileges;\nexit;\n</code></pre></p> <p>\u53bb\u6389\u589e\u52a0\u7684\u914d\u7f6e\uff0c\u91cd\u542f MySQL \u670d\u52a1\uff0c\u5b8c\u6210\u3002\u53c2\u8003 Stackoverflow \u94fe\u63a5</p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20Tips/#too-many-connections","title":"\u9519\u8bef\u4fee\u590d Too many connections","text":"<p>\u8c03\u6574 max_connections \u7cfb\u7edf\u53d8\u91cf\uff0c\u91cd\u542f\u6570\u636e\u5e93\u3002\u53c2\u8003\u5b98\u65b9\u6587\u6863</p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20Tips/#_1","title":"\u7528\u6237\u548c\u6743\u9650\u64cd\u4f5c","text":"<p>\u7528\u6237\u64cd\u4f5c\uff1a <pre><code>-- \u67e5\u770b\u548c\u521b\u5efa\u7528\u6237\nselect user, host from mysql.user;\ncreate user 'test'@'%' identified by 'xxxx';\n</code></pre></p> <p>\u6743\u9650\u64cd\u4f5c <pre><code>-- \u67e5\u770b\u7528\u6237\u6743\u9650\nshow grants for username;\n\n-- \u8d4b\u4e88\u548c\u64a4\u9500\u5e93\u7684\u8bfb\u53d6\u6743\u9650\nGRANT SELECT ON mydb.* TO 'username'@'%';\nREVOKE SELECT ON mydb.* TO 'username'@'%';\n\n-- \u8d4b\u4e88\u548c\u64a4\u9500\u5e93\u7684\u6240\u6709\u6743\u9650\nGRANT ALL PRIVILEGES ON mydb.* TO 'username'@'%';\nREVOKE ALL PRIVILEGES ON mydb.* FROM 'username'@'%';\n\n-- \u5237\u65b0\u6743\u9650\u4fe1\u606f\nFLUSH PRIVILEGES;\n</code></pre></p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20Tips/#_2","title":"\u67e5\u770b\u5360\u7528\u7a7a\u95f4","text":"<p>\u67e5\u770b\u5e93\u548c\u8868\u7684\u5360\u7528\u7a7a\u95f4\uff1a <pre><code>-- \u67e5\u770b\u6bcf\u4e2a\u5e93\u5360\u7528\u7a7a\u95f4\u5927\u5c0f\nselect sum(DATA_LENGTH / 1024 / 1024 / 1024) as data, 'GB', TABLE_SCHEMA \nfrom information_schema.TABLES \nwhere TABLE_SCHEMA not in ('mysql', 'sys', 'performance_schema', 'information_schema') \ngroup by TABLE_SCHEMA order by data;\n\n-- \u67e5\u770b\u5e93\u4e2d\u6bcf\u4e2a\u8868\u5360\u7528\u7a7a\u95f4\u5927\u5c0f\nselect sum(DATA_LENGTH / 1024 / 1024 ) as data, 'MB', TABLE_SCHEMA, TABLE_NAME \nfrom information_schema.TABLES \nwhere TABLE_SCHEMA not in ('mysql', 'sys', 'performance_schema', 'information_schema') and TABLE_SCHEMA = 'xxxxx' \ngroup by TABLE_SCHEMA, TABLE_NAME order by TABLE_SCHEMA, data desc ;\n</code></pre></p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E4%B8%BB%E4%BB%8E/","title":"MySQL \u4e3b\u4ece","text":"","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E4%B8%BB%E4%BB%8E/#_1","title":"\u4e3b\u4ece\u4ecb\u7ecd","text":"<p>\u4e3b\u4ece\u80fd\u591f\u5c06\u4e00\u4e2a MySQL \u7684\u6570\u636e\u590d\u5236\u5230\u4e00\u4e2a\u6216\u8005\u591a\u4e2a MySQL\uff0c\u9ed8\u8ba4\u4e3b\u4ece\u662f\u5f02\u6b65\u7684\u3002\u80fd\u591f\u914d\u7f6e\u540c\u6b65\u6240\u6709\u7684\u6570\u636e\u5e93\u3001\u9009\u62e9\u7684\u6570\u636e\u5e93\u751a\u81f3\u9009\u62e9\u7684\u8868\u3002</p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E4%B8%BB%E4%BB%8E/#_2","title":"\u4e3b\u4ece\u7684\u4f18\u70b9","text":"<p>\u6a2a\u5411\u6269\u5c55\u89e3\u51b3\u65b9\u6848\uff0c\u5c06\u8d1f\u8f7d\u5206\u6563\u5230\u591a\u4e2a\u526f\u672c\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6240\u6709\u7684\u5199\u5165\u548c\u66f4\u65b0\u90fd\u5fc5\u987b\u5728\u4e3b\u5e93\u670d\u52a1\u5668\u4e0a\u8fdb\u884c\uff0c\u4f46\u662f\u8bfb\u53d6\u53ef\u4ee5\u5728\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u526f\u672c\u4e0a\u8fdb\u884c\u3002 \u8bfb\u5199\u5206\u79bb\u7684\u6a21\u578b\u53ef\u4ee5\u63d0\u9ad8\u6027\u80fd\uff0c\u4e3b\u5e93\u4e13\u6ce8\u4e8e\u5199\u5165\u548c\u66f4\u65b0\uff0c\u53ef\u4ee5\u6269\u5c55\u66f4\u591a\u7684\u526f\u672c\u63d0\u9ad8\u8bfb\u53d6\u901f\u5ea6\u3002</p> <p>\u6570\u636e\u5b89\u5168\uff0c\u7531\u4e8e\u526f\u672c\u53ef\u4ee5\u6682\u505c\u590d\u5236\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u5728\u526f\u672c\u4e0a\u8fd0\u884c\u5907\u4efd\u670d\u52a1\u800c\u4e0d\u4f1a\u5bf9\u4e3b\u5e93\u6570\u636e\u9020\u6210\u5f71\u54cd\u3002</p> <p>\u5206\u6790\uff0c\u5728\u526f\u672c\u4e0a\u5206\u6790\u6570\u636e\u4e0d\u4f1a\u5f71\u54cd\u4e3b\u5e93\u7684\u6027\u80fd\u3002</p> <p>\u8fdc\u8ddd\u79bb\u6570\u636e\u5206\u53d1\uff0c\u53ef\u4ee5\u4f7f\u7528\u672c\u5730\u7684\u526f\u672c\u4f9b\u8fdc\u7a0b\u7ad9\u70b9\u4f7f\u7528\uff0c\u800c\u4e0d\u4f1a\u5f71\u54cd\u4e3b\u5e93\u7684\u6027\u80fd\u3002</p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E4%B8%BB%E4%BB%8E/#_3","title":"\u4e3b\u4ece\u7684\u65b9\u5f0f","text":"<p>MySQL 8.1 \u652f\u6301\u4e0d\u540c\u7684\u4e3b\u4ece\u65b9\u6cd5\uff1a</p> <ul> <li>\u4f20\u7edf\u65b9\u5f0f\u57fa\u4e8e\u4ece\u4e3b\u5e93\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u590d\u5236\u4e8b\u4ef6\uff0c\u5e76\u4e14\u8981\u6c42\u65e5\u5fd7\u6587\u4ef6\u548c\u5176\u4e2d\u7684\u4f4d\u7f6e\u5728\u4e3b\u5e93\u548c\u526f\u672c\u4e4b\u95f4\u540c\u6b65\u3002</li> <li>\u65b0\u7684\u65b9\u5f0f\u662f\u57fa\u4e8e\u5168\u5c40\u4e8b\u52a1\u6807\u8bc6\u7b26\uff08Global Transaction Identifiers\uff0cGTIDs\uff09\uff0c\u8fd9\u79cd\u65b9\u5f0f\u662f\u4e8b\u52a1\u6027\u7684\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u5904\u7406\u65e5\u5fd7\u6587\u4ef6\u6216\u8005\u6587\u4ef6\u5185\u7684\u4f4d\u7f6e\uff0c\u7b80\u5316\u4e86\u8bb8\u591a\u5e38\u89c1\u7684\u590d\u5236 \u4efb\u52a1\u3002\u4f7f\u7528 GTIDs \u7684\u4e3b\u4ece\u53ef\u4ee5\u4fdd\u8bc1\u4e3b\u5e93\u548c\u526f\u672c\u4e4b\u95f4\u7684\u4e00\u81f4\u6027\uff0c\u53ea\u8981\u5728\u4e3b\u5e93\u4e0a\u63d0\u4ea4\u8fc7\u7684\u4e8b\u52a1\u4e5f\u5df2\u5e94\u7528\u4e8e\u526f\u672c\u3002</li> </ul>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E4%B8%BB%E4%BB%8E/#_4","title":"\u4e3b\u4ece\u683c\u5f0f\u7c7b\u578b","text":"<p>\u4e3b\u4ece\u683c\u5f0f\u6709\u4e24\u79cd\u6838\u5fc3\u7684\u7c7b\u578b\uff1a</p> <ul> <li>\u57fa\u4e8e\u8bed\u53e5\u7684\u590d\u5236\uff08Statement Base Replication\uff0cSBR\uff09\uff0c\u590d\u5236\u6574\u4e2a SQL \u8bed\u53e5\u6267\u884c\u3002</li> <li>\u57fa\u4e8e\u884c\u7684\u590d\u5236\uff08Rwo Base Replication\uff0cRBR\uff09\uff0c\u4ec5\u590d\u5236\u6539\u53d8\u7684\u884c\u3002</li> </ul>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E4%B8%BB%E4%BB%8E/#_5","title":"\u57fa\u4e8e\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7684\u4e3b\u4ece","text":"<p>\u4e3b\u5e93\u5c06\u66f4\u65b0\u4f5c\u4e3a\u201c\u4e8b\u4ef6\u201d\u5199\u5165\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0c\u4ece\u5e93\u4ece\u6e90\u8bfb\u53d6\u65e5\u5fd7\u5e76\u5728\u672c\u5730\u6570\u636e\u5e93\u4e0a\u6267\u884c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u7684\u4e8b\u4ef6\u3002\u6bcf\u4e2a\u4ece\u5e93\u90fd\u4f1a\u63a5\u6536\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\u7684\u5168\u90e8\u5185\u5bb9\uff0c\u4f46\u662f \u4ece\u5e93\u6839\u636e\u914d\u7f6e\u53ef\u4ee5\u51b3\u5b9a\u6267\u884c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u7684\u54ea\u4e9b\u8bed\u53e5\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u6267\u884c\u5168\u90e8\u7684\u8bed\u53e5\u3002</p> <p>\u4e3b\u5e93\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e0d\u80fd\u914d\u7f6e\u4ec5\u8bb0\u5f55\u67d0\u4e9b\u4e8b\u4ef6\u3002</p> <p>\u4e3b\u5e93\u548c\u4ece\u5e93\u90fd\u5fc5\u987b\u914d\u7f6e\u552f\u4e00\u7684 ID\uff08\u4f7f\u7528 server_id \u7cfb\u7edf\u53d8\u91cf\uff09\u3002\u6bcf\u4e2a\u4ece\u5e93\u90fd\u5fc5\u987b\u914d\u7f6e\u4e3b\u5e93\u7684\u5730\u5740\u3001\u65e5\u5fd7\u6587\u4ef6\u540d\u548c\u8be5\u6587\u4ef6\u4e2d\u7684\u4f4d\u7f6e\u4fe1\u606f\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>CHANGE REPLICATION SOURCE TO</code>\u5728\u4ece\u5e93\u4e0a\u914d\u7f6e\u3002</p> <p>\u8fd9\u91cc\u7b80\u8981\u63cf\u8ff0\u4e00\u4e0b\u4e3b\u4ece\u7684\u6b65\u9aa4\uff1a</p> <ol> <li>\u5728\u4e3b\u5e93\u4e0a\u786e\u4fdd\u5f00\u542f\u4e86\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0c\u5e76\u4e14\u914d\u7f6e\u7684\u552f\u4e00\u7684\u670d\u52a1\u5668 ID\u3002\u91cd\u65b0\u914d\u7f6e\u9700\u8981\u91cd\u542f\u6570\u636e\u5e93\u3002</li> <li>\u5728\u6bcf\u4e2a\u4ece\u5e93\u4e0a\u914d\u7f6e\u552f\u4e00\u7684\u670d\u52a1\u5668 ID\u3002\u91cd\u65b0\u914d\u7f6e\u9700\u8981\u91cd\u542f\u6570\u636e\u5e93\u3002</li> <li>\u5728\u4e3b\u5e93\u4e0a\u521b\u5efa\u4e00\u4e2a\u5355\u72ec\u7684\u7528\u6237\uff0c\u5728\u4ece\u5e93\u8bfb\u53d6\u4e3b\u5e93\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u662f\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002</li> <li>\u5728\u8fdb\u884c\u590d\u5236\u4e4b\u524d\uff0c\u5e94\u8bb0\u5f55\u4e3b\u5e93\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7684\u5f53\u524d\u4f4d\u7f6e\uff0c\u914d\u7f6e\u4ece\u5e93\u65f6\u9700\u8981\u8fd9\u4e2a\u4fe1\u606f\u3002\u5982\u679c\u4e3b\u5e93\u5df2\u7ecf\u6709\u6570\u636e\uff0c\u5219\u9700\u8981\u521b\u5efa\u6570\u636e\u7684\u5feb\u7167\uff0c\u5c06\u6570\u636e\u590d\u5236\u5230\u4ece\u5e93\u3002</li> <li>\u914d\u7f6e\u4ece\u5e93\u4e3b\u5e93\u7684\u4fe1\u606f\uff08\u5982\uff1a\u5730\u5740\u3001\u767b\u5f55\u51ed\u8bc1\u3001\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u540d\u548c\u4f4d\u7f6e\uff09\u3002</li> </ol>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E4%B8%BB%E4%BB%8E/#_6","title":"\u914d\u7f6e\u4e3b\u5e93","text":"<p>\u521b\u5efa\u7528\u4e8e\u540c\u6b65\u7684\u7528\u6237 <pre><code>create user 'repl'@'%' identified by 'password';\ngrant replication slave on *.* to 'repl'@'%';\nflush privileges;\n</code></pre></p> <p>\u4e8c\u8fdb\u5236\u65e5\u5fd7\u9ed8\u8ba4\u662f\u5f00\u542f\u7684\uff0c\u65e5\u5fd7\u9ed8\u8ba4\u5b58\u50a8\u518d\u6570\u636e\u76ee\u5f55\u4e0b\uff0c\u670d\u52a1\u5668 ID \u9ed8\u8ba4\u662f 1\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u9700\u8981\u91cd\u542f\u6570\u636e\u5e93\u3002\u914d\u7f6e\u6587\u4ef6 /etc/mysql/mysql.conf.d/mysqld.cnf\u65b0\u589e\u914d\u7f6e\uff1a <pre><code>[mysqld]\nserver_id               = 2\nlog-bin                 = mysql-bin\n\ncharacter-set-server    = utf8mb4\nmax_connections         = 2000\n</code></pre></p> <p>\u4f7f\u7528\u542f\u52a8\u9009\u9879 --binlog-expire-logs-seconds \u8bbe\u7f6e\u65e5\u5fd7\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u9ed8\u8ba4 30 \u5929\u3002</p> <p>\u4f7f\u7528\u542f\u52a8\u9009\u9879 --binglog-do-db=db_name \u53ef\u4ee5\u914d\u7f6e\u6307\u5b9a\u6570\u636e\u5e93\u751f\u6210 binlog\u3002\u8be5\u542f\u52a8\u9009\u9879\u6ca1\u6709\u5bf9\u5e94\u7684\u7cfb\u7edf\u53d8\u91cf\u3002 <pre><code>[mysqld] \nbinlog-do-db=test_db \nbinlog-do-db=dev_db\n</code></pre></p> <p>\u4f7f\u7528\u542f\u52a8\u9009\u9879 --binglog-ignore-db=db_name \u53ef\u4ee5\u914d\u7f6e\u5bf9\u67d0\u4e2a\u6570\u636e\u5e93\u4e0d\u751f\u6210 binlog\u3002\u8be5\u542f\u52a8\u9009\u9879\u6ca1\u6709\u5bf9\u5e94\u7684\u7cfb\u7edf\u53d8\u91cf\u3002 <pre><code>[mysqld] \nbinlog-ignore-db=test_db \nbinlog-ignore-db=dev_db\n</code></pre></p> <p>\u67e5\u770b binlog \u7684\u6587\u4ef6\u5185\u5bb9\uff1a <pre><code>mysqlbinlog --no-defaults --base64-output=decode-rows -v ./mysql_binary_log.135674 --result-file=135674.sql\n</code></pre> - <code>mysqlbinlog</code>\uff1a\u8fd9\u662f MySQL \u63d0\u4f9b\u7684\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u8bfb\u53d6\u548c\u663e\u793a MySQL \u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u7684\u5185\u5bb9\u3002</p> <ul> <li> <p><code>--no-defaults</code>\uff1a\u8fd9\u4e2a\u9009\u9879\u544a\u8bc9\u5de5\u5177\u4e0d\u8981\u4f7f\u7528\u4efb\u4f55\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6\uff08\u5982 <code>my.cnf</code> \u6216 <code>my.ini</code>\uff09\u3002\u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd\u547d\u4ee4\u7684\u6267\u884c\u4ec5\u4f9d\u8d56\u4e8e\u547d\u4ee4\u884c\u4e2d\u63d0\u4f9b\u7684\u53c2\u6570\uff0c\u800c\u4e0d\u53d7\u4efb\u4f55\u914d\u7f6e\u6587\u4ef6\u7684\u5f71\u54cd\u3002</p> </li> <li> <p><code>--base64-output=decode-rows</code>\uff1a\u8fd9\u4e2a\u9009\u9879\u6307\u5b9a\u89e3\u7801\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u7684\u57fa\u4e8e base64 \u7f16\u7801\u7684\u884c\u4e8b\u4ef6\u3002\u5f53\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u7684\u884c\u6570\u636e\u88ab\u4fee\u6539\u65f6\uff0c\u4f1a\u8fdb\u884c base64 \u7f16\u7801\uff0c\u56e0\u6b64\u89e3\u7801\u540e\u53ef\u4ee5\u4f7f\u8f93\u51fa\u66f4\u5177\u53ef\u8bfb\u6027\u3002</p> </li> <li> <p><code>-v</code>\uff1a\u8fd9\u4e2a\u9009\u9879\u662f <code>verbose</code>\uff08\u8be6\u7ec6\u6a21\u5f0f\uff09\u7684\u7f29\u5199\uff0c\u8868\u793a\u8f93\u51fa\u4f1a\u66f4\u52a0\u8be6\u7ec6\u3002\u5b83\u4f1a\u4ee5\u53ef\u8bfb\u7684\u683c\u5f0f\u5c55\u793a\u6bcf\u4e2a\u4e8b\u4ef6\u7684\u5185\u5bb9\uff0c\u663e\u793a\u5b9e\u9645\u6267\u884c\u7684 SQL \u8bed\u53e5\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u4e8b\u4ef6\u7c7b\u578b\u3002</p> </li> <li> <p><code>./mysql_binary_log.135674</code>\uff1a\u8fd9\u662f\u9700\u8981\u5904\u7406\u7684 MySQL \u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u7684\u8def\u5f84\u3002\u5728\u6b64\u547d\u4ee4\u4e2d\uff0c\u6587\u4ef6\u540d\u4e3a <code>mysql_binary_log.135674</code>\uff0c\u8be5\u6587\u4ef6\u5305\u542b\u4e86 MySQL \u6570\u636e\u5e93\u7684\u6240\u6709\u66f4\u6539\u65e5\u5fd7\u3002</p> </li> <li> <p><code>--result-file=135674.sql</code>\uff1a\u8fd9\u4e2a\u9009\u9879\u6307\u5b9a\u5904\u7406\u540e\u7684\u7ed3\u679c\u8f93\u51fa\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d\u3002\u5728\u672c\u4f8b\u4e2d\uff0c\u89e3\u7801\u540e\u7684 SQL \u8bed\u53e5\u548c\u6570\u636e\u53d8\u66f4\u5c06\u4fdd\u5b58\u5230 <code>135674.sql</code> \u6587\u4ef6\u4e2d\u3002</p> </li> </ul> <p>\u67e5\u770b\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u548c\u4f4d\u7f6e\uff0c\u4ece\u5e93\u914d\u7f6e\u9700\u8981\u4f7f\u7528 <code>File</code>\u548c<code>Position</code>\u3002 <pre><code>mysql&gt; show master status \\G\n*************************** 1. row ***************************\n             File: binlog.000003\n         Position: 157\n     Binlog_Do_DB: \n Binlog_Ignore_DB: \nExecuted_Gtid_Set: \n1 row in set (0.00 sec)\n</code></pre></p> <p>\u5220\u9664 binlog \u6587\u4ef6\uff1a <pre><code>-- \u5220\u9664\u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\u4e4b\u524d\u7684\u6240\u6709 binlog\nPURGE BINARY LOGS TO 'mysql-bin.000010';\n\n-- \u5220\u9664\u6307\u5b9a\u65f6\u95f4\u70b9\u4e4b\u524d\u7684\u6240\u6709 binlog\nPURGE BINARY LOGS BEFORE '2023-01-01 00:00:00';\n</code></pre></p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E4%B8%BB%E4%BB%8E/#_7","title":"\u914d\u7f6e\u4ece\u5e93","text":"<p>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u9700\u8981\u91cd\u542f\u6570\u636e\u5e93\u3002\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 /etc/mysql/mysql.conf.d/mysqld.cnf\uff1a <pre><code>[mysqld]\nserver_id               = 21\nexpire_logs_days        = 15\n\nread-only               = 1\ncharacter-set-server    = utf8mb4\nmax_connections         = 2000\n</code></pre></p> <p>\u914d\u7f6e\u4ece\u5e93\u53ea\u540c\u6b65\u4e3b\u5e93\u7684\u90e8\u5206\u6570\u636e\u5e93\uff1a <pre><code>[mysqld]\nreplicate-do-db=database1\nreplicate-do-db=database2\n</code></pre></p> <p>\u914d\u7f6e\u4e3b\u5e93\u4fe1\u606f\uff1a <pre><code>CHANGE REPLICATION SOURCE TO\n    SOURCE_HOST='192.168.1.13',\n    SOURCE_USER='repl',\n    SOURCE_PASSWORD='password',\n    SOURCE_LOG_FILE='binlog.000003',\n    SOURCE_LOG_POS=157;\n</code></pre></p> <p>\u5f00\u542f\u4e3b\u4ece\u540c\u6b65\uff1a <pre><code>start replica;\n</code></pre></p> <p>\u67e5\u770b\u4e3b\u4ece\u72b6\u6001\uff1a <pre><code>mysql&gt; show replica status \\G\n*************************** 1. row ***************************\n               Slave_IO_State: Waiting for source to send event\n                  Master_Host: 192.168.1.13\n                  Master_User: repl\n                  Master_Port: 3306\n                Connect_Retry: 60\n              Master_Log_File: binlog.000003\n          Read_Master_Log_Pos: 157\n               Relay_Log_File: suomea04-relay-bin.000002\n                Relay_Log_Pos: 323\n        Relay_Master_Log_File: binlog.000003\n             Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n\u00b7\u00b7\u00b7\n</code></pre></p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E4%B8%BB%E4%BB%8E/#_8","title":"\u4e3b\u5e93\u5df2\u7ecf\u6709\u6570\u636e\u7684\u60c5\u51b5","text":"<p>\u5982\u679c\u4e3b\u5e93\u5df2\u7ecf\u6709\u6570\u636e,\u9700\u8981\u5148\u4f7f\u7528 mysqldump \u5bfc\u51fa\u4e3b\u5e93\u6570\u636e\uff0c\u628a\u6570\u636e\u5bfc\u5165\u4ece\u5e93\u4e4b\u540e\u518d\u914d\u7f6e\u4ece\u5e93\u8fdb\u884c\u540c\u6b65\u3002 <pre><code>mysqldump -u root -p --source-data=2 --databases test_db &gt; /root/test.sql\n</code></pre></p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f <code>--source-data</code> \u9009\u9879\u4f1a\u5bfc\u51fa\u4e3b\u5e93\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u540d\u548c\u4f4d\u7f6e\u4fe1\u606f\u5230 <code>test.sql</code> \u6587\u4ef6\u4e2d\uff0c\u9ed8\u8ba4\u503c\u662f <code>1</code>\uff0c\u5982\u679c\u8bbe\u7f6e\u503c\u4e3a <code>2</code> \u7684\u8bdd\u4f1a\u6ce8\u91ca\u6389\u8be5 SQL \u8bed\u53e5\u3002 <pre><code>\u00b7\u00b7\u00b7\n-- CHANGE MASTER TO MASTER_LOG_FILE='binlog.000003', MASTER_LOG_POS=363;\n\u00b7\u00b7\u00b7\n</code></pre></p> <p>\u5982\u679c <code>--source-data</code> \u8bbe\u7f6e\u4e3a <code>1</code>\uff0c\u4ece\u5e93\u5bfc\u5165\u6570\u636e\u7684\u65f6\u5019\u5c31\u4f1a\u8bbe\u7f6e\u4e3b\u5e93\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u548c\u4f4d\u7f6e\u4fe1\u606f\uff0c\u6267\u884c <code>CHANGE REPLICATION SOURCE TO</code> \u8bed\u53e5\u65f6\u5c31\u4e0d\u9700\u8981\u518d\u6b21\u8bbe\u7f6e\u4e86\uff1b \u5982\u679c\u8bbe\u7f6e\u4e3a <code>2</code>\uff0c\u4ece\u5e93\u6267\u884c <code>CHANGE REPLICATION SOURCE TO</code> \u8bed\u53e5\u9700\u8981\u8bbe\u7f6e\u4e8c\u8fdb\u5236\u6587\u4ef6\u548c\u4f4d\u7f6e\u4fe1\u606f\uff0c\u503c\u9700\u8981\u53bb\u4e3b\u5e93\u5bfc\u51fa\u7684 SQL \u6587\u4ef6\u4e2d\u67e5\u627e\u3002</p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E4%B8%BB%E4%BB%8E/#_9","title":"\u4e3b\u4ece\u5207\u6362","text":"<p>\u5047\u8bbe\u4e3b\u5e93\u6570\u636e\u5e93\u670d\u52a1\u5668\u70b8\u4e86\uff0c\u90a3\u4e48\u4ece\u5e93\u8fdb\u884c\u64cd\u4f5c\uff1a <pre><code>-- \u9996\u5148\u505c\u6b62\u4e3b\u4ece\u540c\u6b65\nstop slave;\nreset slave all;\n\n-- \u53d6\u6d88\u6570\u636e\u5e93\u7684\u53ea\u8bfb\u9650\u5236\nSET GLOBAL read_only=0;\n\n-- \u670d\u52a1\u914d\u7f6e\u66f4\u65b0\u6570\u636e\u5e93\u5730\u5740\uff0c\u91cd\u542f\u670d\u52a1\n</code></pre></p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE/","title":"MySQL \u5220\u9664\u91cd\u590d\u6570\u636e","text":"<p>\u5148\u5907\u4efd\u6574\u8868\uff0c\u9632\u6b62\u6570\u636e\u8bef\u5220\u3002</p> <pre><code>select * from alarm_remote_check where id not in (\n    select min(id) from alarm_remote_check\n    group by license, detectdate, dsid, detectsn\n)\n</code></pre>"},{"location":"DataBase/MySQL/MySQL%20%E5%8F%98%E9%87%8F/","title":"MySQL \u53d8\u91cf","text":""},{"location":"DataBase/MySQL/MySQL%20%E5%8F%98%E9%87%8F/#_1","title":"\u7cfb\u7edf\u53d8\u91cf","text":""},{"location":"DataBase/MySQL/MySQL%20%E5%8F%98%E9%87%8F/#_2","title":"\u8bbe\u7f6e\u7cfb\u7edf\u53d8\u91cf","text":"<p>\u5f88\u591a\u7cfb\u7edf\u53d8\u91cf\u53ef\u4ee5\u901a\u8fc7\u542f\u52a8\u9009\u9879\u5728 MySQL \u542f\u52a8\u65f6\u8bbe\u7f6e\uff0c\u542f\u52a8\u9009\u9879\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u884c\u6216\u8005\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\uff0c\u547d\u4ee4\u884c\u7684\u4f18\u5148\u7ea7\u5927\u4e8e\u914d\u7f6e\u6587\u4ef6\u3002</p> <p>\u901a\u8fc7\u547d\u4ee4\u884c\u8bbe\u7f6e\u542f\u52a8\u9009\u9879\uff1a <pre><code>mysqld --max-connections=2000\n</code></pre></p> <p>\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e\u542f\u52a8\u9009\u9879\uff1a <pre><code>[server]\nmax-connections=2000\n</code></pre></p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\u542f\u52a8\u9009\u9879 max-connections \u5bf9\u5e94\u7684\u7cfb\u7edf\u53d8\u91cf\u4e3a max_connections\u3002</p>"},{"location":"DataBase/MySQL/MySQL%20%E5%8F%98%E9%87%8F/#_3","title":"\u4f5c\u7528\u8303\u56f4","text":"<p>\u7cfb\u7edf\u53d8\u91cf\u6709\u4e24\u79cd\u4f5c\u7528\u8303\u56f4\uff08scope\uff09\uff0c\u5168\u5c40\u53d8\u91cf GLOBAL \u548c\u4f1a\u8bdd\u53d8\u91cf SESSION\u3002\u53c2\u8003\u5b98\u65b9\u6587\u6863\u53ef\u4ee5\u67e5\u9605\u7cfb\u7edf\u53d8\u91cf\u7684\u4f5c\u7528\u8303\u56f4\u3002</p> <p>\u5927\u90e8\u5206\u7cfb\u7edf\u53d8\u91cf\u53ea\u6709 GLOBAL \u4f5c\u7528\u8303\u56f4\uff0c\u4e00\u90e8\u5206\u53d8\u91cf\u53ea\u6709 SESSION \u4f5c\u7528\u8303\u56f4\uff0c\u4e00\u90e8\u5206\u53d8\u91cf\u7684\u4f5c\u7528\u8303\u56f4\u4e3a GLOBAL\uff0cSESSION\u3002\u670d\u52a1\u5668\u5728\u542f\u52a8\u65f6\uff0c\u4f1a\u5c06\u6bcf\u4e2a\u5168\u5c40\u53d8\u91cf\u521d\u59cb\u5316\u4e3a\u5176\u9ed8\u8ba4\u503c\uff0c\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u884c\u6216\u8005\u914d\u7f6e\u6587\u4ef6\u6307\u5b9a\u542f\u52a8\u9009\u9879\u4fee\u6539\u8fd9\u4e9b\u9ed8\u8ba4\u503c\uff08\u53ea\u80fd\u8bbe\u7f6e GLOBAL \u4f5c\u7528\u8303\u56f4\uff09\u3002\u670d\u52a1\u5668\u8fd8\u4e3a\u6bcf\u4e00\u4e2a\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u7ef4\u62a4\u4e86\u4e00\u7ec4\u4f1a\u8bdd\u53d8\u91cf\uff0c\u5ba2\u6237\u7aef\u7684\u4f1a\u8bdd\u53d8\u91cf\u5728\u8fde\u63a5\u65f6\u4f7f\u7528\u76f8\u5e94\u5168\u5c40\u53d8\u91cf\u7684\u5f53\u524d\u503c\u8fdb\u884c\u521d\u59cb\u5316\u3002</p> <p>\u6bd4\u5982 <code>max_connections</code> \u7cfb\u7edf\u53d8\u91cf\u5c31\u662f GLOBAL \u4f5c\u7528\u8303\u56f4\u7684\uff0c\u5168\u5c40\u9650\u5b9a\u4e86\u540c\u65f6\u8fde\u63a5\u5230\u7cfb\u7edf\u7684\u5ba2\u6237\u7aef\u6570\u91cf\u3002</p> <p>\u6bd4\u5982 <code>autocommit</code> \u7cfb\u7edf\u53d8\u91cf\u7684\u4f5c\u7528\u8303\u56f4\u5c31\u662f GLOBAL\uff0cSESSION\u3002\u6570\u636e\u5e93\u542f\u52a8\u65f6\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf autocommit\uff0c\u4e4b\u540e\u6bcf\u4e00\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u65f6\u5019\u6570\u636e\u5e93\u4f1a\u4e3a\u6bcf\u4e2a\u5ba2\u6237\u7aef\u7ef4\u62a4\u4e00\u4e2a\u4f1a\u8bdd\u53d8\u91cf autocommit\uff0c\u4f1a\u8bdd\u53d8\u91cf autocommit \u7684\u9ed8\u8ba4\u503c\u4e3a\u5ba2\u6237\u7aef\u8fde\u63a5\u65f6\u5168\u5c40\u53d8\u91cf autocommit \u7684\u503c\u3002\u5ba2\u6237\u7aef\u53ef\u4ee5\u4fee\u6539\u81ea\u5df1\u7684\u4f1a\u8bdd\u53d8\u91cf\u800c\u4e0d\u4f1a\u5f71\u54cd\u5168\u5c40\u53d8\u91cf\u4ee5\u53ca\u5176\u5b83\u5ba2\u6237\u7aef\u7684\u4f1a\u8bdd\u53d8\u91cf\u3002</p> <p>\u53ef\u4ee5\u5728\u8fd0\u884c\u671f\u95f4\u901a\u8fc7 SQL \u8bbe\u7f6e\u7cfb\u7edf\u53d8\u91cf\u7684\u503c\uff0c\u9ed8\u8ba4\u4e3a SESSION \u4f5c\u7528\u8303\u56f4\uff1a <pre><code>set [GLOBAL|SESSION] var_name = value;\n</code></pre></p> <p>\u4ee5 autocommit \u4e3a\u4f8b\uff0c\u5982\u679c\u5728\u8fd0\u884c\u671f\u95f4\u901a\u8fc7 SQL \u4fee\u6539 GLOBAL autocommit \u5e76\u4e0d\u4f1a\u5bf9\u5f53\u524d\u5ba2\u6237\u7aef\u7684 SESSION autocommit \u53d8\u91cf\u7684\u503c\u9020\u6210\u5f71\u54cd\uff0c\u53ea\u4f1a\u5bf9\u540e\u7eed\u5efa\u7acb\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u7684 SESSION autocommit \u4ea7\u751f\u5f71\u54cd\u3002</p> <p>\u6709\u4e9b\u7cfb\u7edf\u53d8\u91cf\u8bbe\u7f6e\u540e\u7acb\u5373\u751f\u6548\uff0c\u6709\u4e9b\u5219\u9700\u8981\u5728\u542f\u52a8\u9009\u9879\u4e2d\u914d\u7f6e\u91cd\u542f\u6570\u636e\u5e93\u751f\u6548\u3002</p> <p>\u67e5\u770b\u7cfb\u7edf\u53d8\u91cf\u8bed\u6cd5\uff0c\u5982\u679c\u4e0d\u6307\u5b9a GLOBAL \u7684\u8bdd\u5219\u9ed8\u8ba4\u4e3a SESSION \u4f5c\u7528\u8303\u56f4\u3002 <pre><code>show [GLOBAL|SESSION] variables [like pattern];\n</code></pre> \u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a  1. \u5982\u679c\u4f7f\u7528 GLOBAL \u4fee\u9970\u7b26\uff0c\u5219\u663e\u793a\u5168\u5c40\u53d8\u91cf\u7684\u503c\u3002\u5982\u679c\u7cfb\u7edf\u53d8\u91cf\u6ca1\u6709 GLOBAL \u4f5c\u7528\u8303\u56f4\uff0c\u5219\u4e0d\u663e\u793a\u3002 2. \u5982\u679c\u4f7f\u7528 SESSION \u4fee\u9970\u7b26\uff0c\u5219\u5c55\u793a\u4f1a\u8bdd\u53d8\u91cf\u7684\u503c\u3002\u5982\u679c\u7cfb\u7edf\u53d8\u91cf\u6ca1\u6709 SESSION \u4f5c\u7528\u8303\u56f4\uff0c\u5219\u663e\u793a GLOBAL \u4f5c\u7528\u8303\u56f4\u7684\u503c\u3002</p>"},{"location":"DataBase/MySQL/MySQL%20%E5%8F%98%E9%87%8F/#_4","title":"\u72b6\u6001\u53d8\u91cf","text":"<p>\u5b98\u65b9\u6587\u6863\uff1ahttps://dev.mysql.com/doc/refman/8.4/en/server-status-variable-reference.html</p> <p>\u72b6\u6001\u53d8\u91cf\u662f\u7528\u6765\u663e\u793a\u6570\u636e\u5e93\u7684\u8fd0\u884c\u72b6\u6001\u7684\uff0c\u5b83\u4eec\u7684\u503c\u53ea\u80fd\u7531\u6570\u636e\u5e93\u81ea\u5df1\u8bbe\u7f6e\uff0c\u4e0d\u80fd\u624b\u52a8\u8bbe\u7f6e\u3002\u72b6\u6001\u53d8\u91cf\u4e5f\u6709\u4f5c\u7528\u8303\u56f4\uff08scope\uff09GLOBAL \u548c SESSION\u3002</p> <p>\u67e5\u770b\u72b6\u6001\u53d8\u91cf\u7684\u8bed\u6cd5\uff0c\u5982\u679c\u4e0d\u6307\u5b9a GLOBAL \u7684\u8bdd\u5219\u9ed8\u8ba4\u4e3a SESSION \u4f5c\u7528\u8303\u56f4\u3002 <pre><code>show [GLOBAL|SESSION] status [like pattern];\n</code></pre> \u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a</p> <ul> <li> <p>\u5982\u679c\u4f7f\u7528 GLOBAL \u4fee\u9970\u7b26\uff0c\u5219\u663e\u793a\u5168\u5c40\u53d8\u91cf\u7684\u503c\u3002\u5982\u679c\u72b6\u6001\u53d8\u91cf\u6ca1\u6709 GLOBAL \u4f5c\u7528\u8303\u56f4\uff0c\u5219\u4e0d\u663e\u793a\u3002</p> </li> <li> <p>\u5982\u679c\u4f7f\u7528 SESSION \u4fee\u9970\u7b26\uff0c\u5219\u5c55\u793a\u4f1a\u8bdd\u53d8\u91cf\u7684\u503c\u3002\u5982\u679c\u72b6\u6001\u53d8\u91cf\u6ca1\u6709 SESSION \u4f5c\u7528\u8303\u56f4\uff0c\u5219\u663e\u793a GLOBAL \u4f5c\u7528\u8303\u56f4\u7684\u503c\u3002</p> </li> </ul>"},{"location":"DataBase/MySQL/MySQL%20%E5%A4%87%E4%BB%BD/","title":"MySQL \u5907\u4efd","text":""},{"location":"DataBase/MySQL/MySQL%20%E5%A4%87%E4%BB%BD/#_1","title":"\u5907\u4efd\u7684\u8981\u6c42","text":"<p>\u5bf9\u4e8e\u5927\u6570\u636e\u6765\u8bf4\u7269\u7406\u5907\u4efd\u662f\u5fc5\u987b\u7684\uff1a\u903b\u8f91\u5907\u4efd\u592a\u6162\u5e76\u4e14\u53d7\u5230\u8d44\u6e90\u9650\u5236\uff0c\u4ece\u903b\u8f91\u5907\u4efd\u4e2d\u6062\u590d\u6570\u636e\u9700\u8981\u5f88\u957f\u65f6\u95f4\u3002\u5bf9\u4e8e\u8f83\u5c0f\u7684\u6570\u636e\u5e93\uff0c\u903b\u8f91\u5907\u4efd\u53ef\u4ee5\u5f88\u597d\u7684\u80dc\u4efb\u3002</p> <p>\u9075\u5faa 3-2-1 \u539f\u5219\u3002\u81f3\u5c11 3 \u5206\u6570\u636e\u526f\u672c\uff0c\u901a\u5e38\u662f\u4e00\u4efd\u539f\u59cb\u6570\u636e\u548c\u4e24\u4efd\u5907\u4efd\u6570\u636e\uff1b\u81f3\u5c11 1 \u4e2a\u5f02\u5730\u5907\u4efd\uff0c\u4e25\u683c\u7684\u8981\u6c42\u662f\u81f3\u5c11 30km \u4ee5\u5916\u7684\u53e6\u4e00\u4e2a\u57ce\u5e02\uff1b2 \u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a\u5b58\u50a8\u5728\u4e24\u5757\u4e0d\u540c\u7684\u8bbe\u5907\u4e0a\u3002</p> <p>\u5b9a\u671f\u4ece\u5907\u4efd\u4e2d\u62bd\u53d6\u6570\u636e\u8fdb\u884c\u6062\u590d\u6d4b\u8bd5\uff0c\u786e\u4fdd\u5907\u4efd\u6d41\u7a0b\u6ca1\u6709\u95ee\u9898\uff0c\u4ee5\u53ca\u80fd\u591f\u5728\u53d1\u751f\u6545\u969c\u65f6\u80fd\u88ab\u6210\u529f\u6062\u590d\u3002</p>"},{"location":"DataBase/MySQL/MySQL%20%E5%A4%87%E4%BB%BD/#mysqldump","title":"mysqldump \u903b\u8f91\u5907\u4efd","text":""},{"location":"DataBase/MySQL/MySQL%20%E5%A4%87%E4%BB%BD/#mysqldump_1","title":"mysqldump \u547d\u4ee4","text":"<p>\u547d\u4ee4\u7528\u6cd5\uff1a <pre><code>mysqldump --source-data=2 --single-transaction -h localhost -u root -p --all-databases | gzip &gt; test.sql.gz\n\n--source-data=2\uff1a\u5bfc\u51fa\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u540d\u79f0\u548c\u4f4d\u7f6e\u4fe1\u606f\uff0c\u5e76\u4e14\u5728\u5bfc\u51fa\u6587\u4ef6\u4e2d\u4ee5\u6ce8\u91ca\u7684\u5f62\u5f0f\u5c55\u793a\u3002\n--single-transaction\uff1a\u5bfc\u51fa\u8fc7\u7a0b\u5728\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u3002\n--all-databases\uff1a\u5bfc\u51fa\u5168\u90e8\u6570\u636e\u5e93\uff0c\u4f1a\u5305\u542b\u7cfb\u7edf\u5e93\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528 --databases tb1 tb2 \u6307\u5b9a\u5bfc\u51fa\u6570\u636e\u5e93\u7684\u540d\u79f0\u3002\n--ignore-table\uff1a\u5ffd\u7565\u6307\u5b9a\u7684\u8868\uff0c\u9700\u8981\u6307\u5b9a\u6570\u636e\u5e93\u540d\uff1a--ignore-table=database_name.table_name\u3002\n</code></pre></p> <p>\u5bfc\u51fa\u6307\u5b9a\u8868\u7684\u6570\u636e\uff1a <pre><code>mysqldump -u &lt;user&gt; -p &lt;dbname&gt; &lt;tablename1&gt; &lt;tablename2&gt; &gt; tablename.sql\n</code></pre></p> <p>\u5728\u6570\u636e\u5e93\u6267\u884c\u6307\u5b9a\u7684 SQL \u6587\u4ef6\uff1a <pre><code>mysql -u &lt;user&gt; -p &lt;db&gt; &lt; a.sql\n</code></pre></p>"},{"location":"DataBase/MySQL/MySQL%20%E5%A4%87%E4%BB%BD/#_2","title":"\u8fde\u63a5\u51ed\u8bc1\u6587\u4ef6","text":"<p>MySQL \u8fde\u63a5\u51ed\u8bc1\u5355\u72ec\u653e\u5728\u6587\u4ef6\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u7f6e\u4e8e /data/database/db_name \u76ee\u5f55\u4e0b\uff0c\u6587\u4ef6\u540d\u4e3a <code>.bak.cnf</code>\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a <pre><code>[client]\nuser=root\npassword=pwd\n</code></pre></p> <p>\u8bbe\u7f6e\u6587\u4ef6\u7684\u6743\u9650\uff0c\u53ea\u6709\u81ea\u5df1\u53ef\u8bfb\uff08r:4\uff09\u53ef\u5199(w:2)\uff1a <pre><code>chmod 600 .bak.cnf\n</code></pre></p>"},{"location":"DataBase/MySQL/MySQL%20%E5%A4%87%E4%BB%BD/#_3","title":"\u5907\u4efd\u811a\u672c\u6587\u4ef6","text":"<p>\u811a\u672c\u6587\u4ef6\u653e\u7f6e\u5728 /data/database/db_name \u76ee\u5f55\u4e0b\uff0c\u6587\u4ef6\u540d\u4e3a bak.sh\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a <pre><code>#!/bin/bash\n\nsource /etc/profile\n\nnumber=31\nbackup_dir=/data/database/db_name\ncre_file=/data/database/db_name/.bak.cnf\ndd=`date +%Y-%m-%d-%H-%M-%S`\ndatabase_name=db_name\n\nif [ ! -d $backup_dir ];\nthen\n    mkdir -p $backup_dir;\nfi\n\nmysqldump --single_transaction --master-data=2 --defaults-file=$cre_file $database_name | gzip &gt; $backup_dir/$database_name-$dd.gz\n\necho \"dump file: $backup_dir/$database_name-$dd.gz\" &gt;&gt; $backup_dir/dump.log\n\ndelfile=`ls -l -crt  $backup_dir/*.gz | awk '{print $9 }' | head -1`\n\ncount=`ls -l -crt  $backup_dir/*.gz | awk '{print $9 }' | wc -l`\n\nif [ $count -gt $number ]\nthen\n  rm $delfile\n  echo \"delete $delfile\" &gt;&gt; $backup_dir/dump.log\nfi\n</code></pre></p>"},{"location":"DataBase/MySQL/MySQL%20%E5%A4%87%E4%BB%BD/#crontab","title":"crontab \u914d\u7f6e","text":"<p>\u8bbe\u7f6e\u4e3a\u6bcf\u5929\u51cc\u6668 2 \u70b9\u6267\u884c\uff0c\u4f7f\u7528 <code>crontab -e</code> \u547d\u4ee4\uff0c\u65b0\u589e\u4e00\u884c\u914d\u7f6e\uff1a <pre><code>0 2 * * * bash /data/database/db_name/bak.sh\n</code></pre></p>"},{"location":"DataBase/MySQL/MySQL%20%E5%A4%87%E4%BB%BD/#xtrabackup","title":"XtraBackup \u7269\u7406\u5907\u4efd","text":""},{"location":"DataBase/MySQL/MySQL%20%E5%A4%87%E4%BB%BD/#_4","title":"\u5907\u4efd\u51c6\u5907\u5de5\u4f5c","text":"<p>\u5907\u4efd\u8f6f\u4ef6\u5b89\u88c5\uff1a <pre><code>wget https://repo.percona.com/apt/percona-release_latest.$(lsb_release -sc)_all.deb \ndpkg -i percona-release_latest.bookworm_all.deb \napt update \napt install percona-xtrabackup-80\n</code></pre></p> <p>\u521b\u5efa\u5907\u4efd\u8d26\u53f7\u5e76\u6388\u6743\uff1a <pre><code>CREATE USER 'bkpuser'@'localhost' IDENTIFIED BY '123456'; \nGRANT BACKUP_ADMIN, PROCESS, RELOAD, LOCK TABLES, REPLICATION CLIENT ON *.* TO 'bkpuser'@'localhost'; \nGRANT SELECT ON performance_schema.log_status TO 'bkpuser'@'localhost';\nGRANT SELECT ON performance_schema.keyring_component_status TO bkpuser@'localhost'; \nGRANT SELECT ON performance_schema.replication_group_members TO bkpuser@'localhost'; \nFLUSH PRIVILEGES;\n</code></pre></p>"},{"location":"DataBase/MySQL/MySQL%20%E5%A4%87%E4%BB%BD/#_5","title":"\u672c\u5730\u76f4\u63a5\u5168\u91cf\u7269\u7406\u5907\u4efd","text":"<p>\u5907\u4efd\u547d\u4ee4\uff1a <pre><code>xtrabackup --user=bkpuser --password=123456 \\\n    --backup \\\n    --target-dir=/data/bkps/\n\n--backup \u9009\u9879\u521b\u5efa\u5907\u4efd\u3002\n--target-dir \u9009\u9879\u6307\u5b9a\u5907\u4efd\u5b58\u653e\u7684\u76ee\u5f55\u3002\n--compress \u9009\u9879\u5f00\u542f\u538b\u7f29\u5907\u4efd\uff0c\u80fd\u5927\u91cf\u51cf\u5c11\u5907\u4efd\u6587\u4ef6\u5360\u7528\u78c1\u76d8\u7a7a\u95f4\u5927\u5c0f\uff0c\u9ed8\u8ba4\u4f7f\u7528 zstd \u7b97\u6cd5\u3002\n--compress-threads \u6307\u5b9a\u5e76\u884c\u538b\u7f29\u7684\u7ebf\u7a0b\u6570\u91cf\u3002\n</code></pre></p> <p>\u5907\u4efd\u7684\u6587\u4ef6\u4e0d\u662f\u540c\u4e00\u65f6\u523b\u72b6\u6001\u4e00\u81f4\u7684\uff0c\u56e0\u4e3a\u5907\u4efd\u7a0b\u5e8f\u8fd0\u884c\u9700\u8981\u65f6\u95f4\u5e76\u4e14\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u6e90\u6587\u4ef6\u53ef\u80fd\u4f1a\u53d1\u751f\u53d8\u5316\u3002</p> <p>\u89e3\u538b\u7f29\uff0c\u5982\u679c\u521b\u5efa\u5907\u4efd\u7684\u65f6\u5019\u4f7f\u7528\u4e86 <code>--compress</code> \u9009\u9879\uff0c\u90a3\u4e48\u5728\u8fdb\u884c prepare \u4e4b\u524d\u9700\u8981\u5148\u8fdb\u884c decomprss\u3002 <pre><code>xtrabackup --decompress --target-dir=/data/bkps/\n\n--remove-original \u89e3\u538b\u7f29\u9ed8\u8ba4\u4e0d\u4f1a\u5220\u9664\u538b\u7f29\u6587\u4ef6\uff0c\u6dfb\u52a0\u8be5\u9009\u9879\u5220\u9664\u539f\u59cb\u538b\u7f29\u6587\u4ef6\u3002\n</code></pre></p> <p>\u51c6\u5907\uff0c\u5bf9\u4e8e\u5907\u4efd\u8fd8\u539f\u6765\u8bf4\uff0c\u9700\u8981\u5148 <code>prepare</code> \u5907\u4efd\u6587\u4ef6\uff0c\u4f7f\u6570\u636e\u8fbe\u5230 <code>a single instant in time</code>\u3002\uff08\u8fd8\u539f\u53ef\u4ee5\u5728\u4efb\u4f55\u670d\u52a1\u5668\u4e0a\u6267\u884c\uff0c\u524d\u63d0\u662f\u5b89\u88c5 XtraBackup\uff09\u3002 <pre><code>xtrabackup --prepare --target-dir=/data/bkps\n</code></pre></p> <p>\u6062\u590d\uff0c\u5c06\u51c6\u5907\u597d\u7684\u6570\u636e\u8fd8\u539f\u5230 mysql \u670d\u52a1\u5668\u3002\u53ef\u4ee5\u65b0\u5b89\u88c5\u4e00\u4e2a MySQL\uff0c\u7136\u540e\u5c06\u6570\u636e\u76ee\u5f55\u6e05\u7a7a\uff0c\u518d\u5c06\u51c6\u5907\u597d\u7684\u6062\u590d\u6587\u4ef6\u590d\u5236\u5230\u6570\u636e\u76ee\u5f55\u5373\u53ef\u3002</p> <ul> <li>\u6062\u590d\u4e4b\u540e\u7528\u6237\u8d26\u53f7\u548c\u6743\u9650\u4f53\u7cfb\u5c06\u4e0e\u5907\u4efd\u65f6\u523b\u5b8c\u5168\u4e00\u81f4\uff0c\u5373\u65b0\u5b89\u88c5\u7684 MySQL \u670d\u52a1\u5668\u7684\u7528\u6237\u548c\u6743\u9650\u4f53\u7cfb\u5c06\u79fb\u9664\uff08\u56e0\u4e3a\u6570\u636e\u76ee\u5f55\u6e05\u7a7a\u4e86\uff09\u3002</li> <li>\u6062\u590d\u4e4b\u540e\u9700\u8981\u6ce8\u610f Linux \u7cfb\u7edf\u7684\u6587\u4ef6\u6743\u9650\uff0c\u4fee\u6539\u4e3a mysql \u7528\u6237\u3002</li> <li>\u6062\u590d\u4e0d\u4f1a\u8fd8\u539f MySQL \u914d\u7f6e\u6587\u4ef6\uff0c\u5982 /etc/my.cnf\uff0c\u9700\u8981\u786e\u4fdd\u65b0\u5b89\u88c5\u7684 MySQL \u670d\u52a1\u5668\u914d\u7f6e\u4e0e\u5907\u4efd\u65f6\u7684\u914d\u7f6e\u517c\u5bb9\u3002</li> </ul>"},{"location":"DataBase/MySQL/MySQL%20%E5%A4%87%E4%BB%BD/#_6","title":"\u8fdc\u7a0b\u5168\u91cf\u7269\u7406\u5907\u4efd","text":"<p>\u5728 192.168.31.14 \u670d\u52a1\u5668\u4e0a\u6267\u884c\u5907\u4efd\u4efb\u52a1\uff0c\u5e76\u4e14\u5c06\u5907\u4efd\u6587\u4ef6\u5b58\u50a8\u5230 192.168.31.14 \u670d\u52a1\u5668\u3002\u6240\u6709\u547d\u4ee4\u5747\u5728 192.168.31.14 \u670d\u52a1\u5668\u6267\u884c\u3002\u9700\u8981\u5728 192.168.31.14 \u670d\u52a1\u5668\u5b89\u88c5 XtraBackup\u3002</p> <p>\u5907\u4efd\u3002 <pre><code>ssh root@192.168.31.13 \"xtrabackup --user=bkpuser --password=123456  --compress --compress-threads=4 --backup --stream=xbstream\" \\\n    &gt; backup.xbstream \\\n    2&gt; backup.log\n</code></pre> <code>--stream</code> \u538b\u7f29\u6587\u4ef6\u4f1a\u4ee5\u6d41\u7684\u5f62\u5f0f\u8ffd\u52a0\u5230\u6807\u51c6\u8f93\u51fa\uff0c\u5e76\u4e14\u6307\u5b9a\u4e86\u6d41\u7684\u683c\u5f0f\u3002</p> <p>\u505c\u6b62 Docker mysql\uff0c\u5e76\u5220\u9664 Docker mysql \u7684\u6570\u636e\u76ee\u5f55\u3002</p> <p>\u89e3\u538b\u7f29 <pre><code>xbstream --extract &lt; backup.xbstream -C /root/restore/ \nxtrabackup --decompress --remove-original --target-dir=/root/restore/\n</code></pre></p> <p>prepare <pre><code>xtrabackup --prepare --target-dir=/root/restore/\n</code></pre></p> <p>\u8fd8\u539f <pre><code>xtrabackup --copy-back --target-dir=/root/restore/ --datadir=/root/mysql-data\n</code></pre></p>"},{"location":"DataBase/MySQL/MySQL%20%E5%A4%87%E4%BB%BD/#qa","title":"QA","text":"<p>XtraBackup \u5907\u4efd\u8fd8\u539f\u6570\u636e\u4e2d\u6587\u4e71\u7801\u95ee\u9898\u3002 \u9700\u8981\u914d\u7f6e\u6240\u6709\u6570\u636e\u5e93\u5b57\u7b26\u96c6\u76f8\u5173\u7684\u53d8\u91cf\u503c\u4e00\u81f4\u3002</p>"},{"location":"DataBase/MySQL/MySQL%20%E5%AE%89%E8%A3%85/","title":"MySQL \u5b89\u88c5","text":"","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E5%AE%89%E8%A3%85/#docker","title":"\u4f7f\u7528 Docker \u5b89\u88c5","text":"<pre><code>\u5b89\u88c5\u547d\u4ee4\uff1a\ndocker run --name mysql -v /my/own/datadir:/var/lib/mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=pwd -d mysql:tag\n</code></pre>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E5%AE%89%E8%A3%85/#apt","title":"APT \u5b89\u88c5","text":"<p>\u4e0b\u8f7d\u5b89\u88c5\u8f6f\u4ef6\u5305\uff1a <pre><code>wget https://dev.mysql.com/get/mysql-apt-config_0.8.26-1_all.deb \ndpkg -i mysql-apt-config_0.8.26-1_all.deb \napt update\n</code></pre></p> <p>\u5b89\u88c5 MySQL \u670d\u52a1\u5668\u3001\u5ba2\u6237\u7aef\u4ee5\u53ca\u6570\u636e\u5e93\u901a\u7528\u7684\u6587\u4ef6\u5305\uff1a <pre><code>apt install mysql-server\n</code></pre></p> <p>\u505c\u6b62 MySQL \u670d\u52a1\uff1a <pre><code>systemctl stop mysql\n</code></pre></p> <p>\u67e5\u770b\u5b89\u88c5\u4e86\u54ea\u4e9b MySQL \u5305\uff0c\u7136\u540e\u4f7f\u7528 apt remove \u547d\u4ee4\u9010\u4e2a\u5378\u8f7d\uff1a <pre><code>apt list --installed\n</code></pre></p> <p>\u5220\u9664\u6570\u636e\u76ee\u5f55\uff1a <pre><code>rm -rf /var/lib/mysql\n</code></pre></p> <p>\u5220\u9664 Systemd \u670d\u52a1\u914d\u7f6e\u6587\u4ef6\uff1a <pre><code>rm -rf /lib/systemd/system/mysql.service \nrm -rf /etc/systemd/system/mysql.service \nsystemctl daemon-reload\n</code></pre></p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E5%AE%89%E8%A3%85/#_1","title":"\u4e8c\u8fdb\u5236\u5305\u5b89\u88c5","text":"","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E5%AE%89%E8%A3%85/#_2","title":"\u73af\u5883\u51c6\u5907","text":"<p>\u5b89\u88c5\u5fc5\u8981\u7684\u5e93\uff1a <pre><code>apt install libaio1 libnuma1 libncurses6\n</code></pre></p> <p>\u521b\u5efa\u7528\u6237\u548c\u7ec4\uff1a <pre><code>groupadd mysql \nuseradd -r -g mysql -s /bin/false mysql\n\n-r\uff1a\u521b\u5efa\u7cfb\u7edf\u7528\u6237  \n-g\uff1a\u6307\u5b9a\u7528\u6237\u7684\u521d\u59cb\u7ec4  \n-s\uff1a/bin/false \u7981\u6b62\u7528\u6237\u767b\u5f55\u4efb\u4f55\u670d\u52a1\uff0c\u76f8\u5bf9 /sbin/nologin \u66f4\u4e3a\u4e25\u683c\u3002  \n</code></pre></p> <p>\u4e0b\u8f7d\u548c\u89e3\u538b\u7f29\u5b89\u88c5\u5305\uff1a <pre><code>wget https://downloads.mysql.com/archives/get/p/23/file/mysql-8.0.33-linux-glibc2.28-x86_64.tar.gz \ntar -zxvf mysql-8.0.33-linux-glibc2.28-x86_64.tar.gz -C /usr/local/\n</code></pre></p> <p>\u914d\u7f6e\u73af\u5883\u53d8\u91cf\uff1a <pre><code>export PATH=$PATH:/usr/local/mysql/bin\n</code></pre></p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E5%AE%89%E8%A3%85/#_3","title":"\u521d\u59cb\u5316\u76ee\u5f55","text":"<p>\u65b0\u5efa\u76ee\u5f55\uff1a <pre><code>cd /usr/local/mysql \nmkdir mysql-files \nchown mysql:mysql mysql-files \nchmod 750 mysql-files\n</code></pre></p> <p>\u521b\u5efa\u914d\u7f6e\u6587\u4ef6\uff1a<code>/etc/mysql/my.cnf</code> <pre><code>[mysqld] \nbasedir=/usr/local/mysql/ \ndatadir=/usr/local/mysql/mysql-files\n</code></pre></p> <p>\u521d\u59cb\u5316\u6570\u636e\u76ee\u5f55 <code>Initializing the Data Directory</code>\uff0c\u4f7f\u7528\u4e8c\u8fdb\u5236\u5b89\u88c5\u5305\u7684\u5b89\u88c5\u65b9\u5f0f\u5fc5\u987b\u624b\u52a8\u521d\u59cb\u5316\u6570\u636e\u76ee\u5f55\uff0c\u5305\u62ec\u521d\u59cb\u5316\u7cfb\u7edf\u76f8\u5173\u7684\u8868\uff0c\u4f7f\u7528 ATP \u5b89\u88c5\u65b9\u5f0f\u5219\u4f1a\u81ea\u52a8\u8fdb\u884c\u3002\u6267\u884c\u521d\u59cb\u5316\u6570\u636e\u76ee\u5f55\u547d\u4ee4\uff0c\u521d\u59cb\u5316\u5b8c\u6210\u540e root \u7528\u6237\u7684\u5bc6\u7801\u4f1a\u8f93\u51fa\u7684\u63a7\u5236\u53f0\uff1a <pre><code>mysqld --initialize --user=mysql\n</code></pre></p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E5%AE%89%E8%A3%85/#_4","title":"\u542f\u52a8\u548c\u5173\u95ed","text":"<p>\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 <code>mysqld</code> \u547d\u4ee4\u542f\u52a8 MySQL \u670d\u52a1\u5668\u3002<code>mysqld_safe</code> \u662f\u4e00\u4e2a\u542f\u52a8\u811a\u672c\u4f1a\u95f4\u63a5\u8c03\u7528 <code>mysqld</code>\uff0c\u5e76\u4e14\u542f\u52a8\u4e00\u4e2a\u76d1\u63a7\u8fdb\u7a0b\uff0c\u76d1\u63a7 <code>mysqld</code> \u6302\u4e86\u4e4b\u540e\u8fdb\u884c\u91cd\u542f\u3002\u542f\u52a8\u670d\u52a1\u5668\uff1a <pre><code>mysqld_safe --user=mysql &amp;\n</code></pre></p> <p>\u66f4\u65b0\u5bc6\u7801\uff1a <pre><code>ALTER USER 'root'@'localhost' IDENTIFIED BY 'root-password'; \nflush privileges;\n</code></pre></p> <p>\u5173\u95ed MySQL \u670d\u52a1\u5668\uff1a <pre><code>./bin/mysqladmin -u root -p shutdown\n</code></pre></p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E5%AE%89%E8%A3%85/#_5","title":"\u5bfc\u5165\u6d4b\u8bd5\u6570\u636e","text":"<p>\u6d4b\u8bd5\u6570\u636e\u4ed3\u5e93\u5730\u5740\uff1ahttps://github.com/datacharmer/test_db</p> <p>mysql \u6267\u884c SQL \u5bfc\u5165\u6570\u636e\u7684\u8bed\u6cd5\uff1a <pre><code>mysql -h localhost -P 3306 -u root -p dbname &lt; file.sql\n</code></pre></p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E5%AE%89%E8%A3%85/#_6","title":"\u5bc6\u7801\u590d\u6742\u5ea6\u548c\u8fc7\u671f\u7b56\u7565","text":"","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E5%AE%89%E8%A3%85/#_7","title":"\u590d\u6742\u5ea6\u8bbe\u7f6e","text":"<p>\u5bc6\u7801\u590d\u6742\u5ea6\u63d2\u4ef6\u4f4d\u4e8e\u5b89\u88c5\u76ee\u5f55\u4e0b\u7684 plugins \u76ee\u5f55\uff0c\u6587\u4ef6\u540d\uff1a<code>validate_password.so</code>\u3002</p> <p>\u542f\u7528\u63d2\u4ef6\u4e0d\u4f1a\u5f71\u54cd\u5148\u524d\u7684\u7528\u6237\uff0c\u4f46\u662f\u5982\u679c\u5148\u524d\u7684\u7528\u6237\u66f4\u65b0\u5bc6\u7801\u5219\u4f1a\u6536\u5230\u5f71\u54cd\u3002</p> <p>\u5b89\u88c5\uff1a <pre><code>-- \u67e5\u770b\u5b89\u88c5\u7684\u63d2\u4ef6\nshow PLUGINS;\n\n-- \u542f\u7528\u63d2\u4ef6\uff0c\u91cd\u542f\u4e0d\u4f1a\u5931\u6548\nINSTALL PLUGIN validate_password SONAME 'validate_password.so';\n</code></pre></p> <p>\u67e5\u770b\u590d\u6742\u5ea6\u914d\u7f6e\uff1a <pre><code>-- \u67e5\u770b\u5bc6\u7801\u590d\u6742\u5ea6\u914d\u7f6e\nSHOW VARIABLES LIKE 'validate_password%';\n\n-- \u5bc6\u7801\u4e0d\u80fd\u4e0e\u7528\u6237\u540d\u76f8\u540c\nvalidate_password_check_user_name   ON\n-- \u6307\u5b9a\u5b57\u5178\u6587\u4ef6\uff0c\u5982\u679c\u5bc6\u7801\u4e0e\u5b57\u5178\u4e2d\u7684\u5355\u8bcd\u5339\u914d\uff0c\u5bc6\u7801\u5c06\u88ab\u62d2\u7edd\nvalidate_password_dictionary_file   \n-- \u5bc6\u7801\u6700\u5c0f\u957f\u5ea6\nvalidate_password_length    8\n-- \u5bc6\u7801\u81f3\u5c11\u5305\u542b\u4e00\u4e2a\u5927\u5199\u548c\u4e00\u4e2a\u5c0f\u5199\u5b57\u6bcd\nvalidate_password_mixed_case_count  1\n-- \u5bc6\u7801\u81f3\u5c11\u5305\u542b\u4e00\u4e2a\u6570\u5b57\nvalidate_password_number_count  1\n-- MEDIUM\uff1a\u68c0\u67e5\u957f\u5ea6\uff0c\u5927\u5c0f\u5199\uff0c\u6570\u5b57\uff0c\u7279\u6b8a\u5b57\u7b26\uff1bLOW\uff1a\u68c0\u67e5\u957f\u5ea6\uff1bSTRONG\uff1a\u5728 MEDIUM \u57fa\u7840\u4e0a\uff0c\u589e\u52a0\u5b57\u5178\u6587\u4ef6\u68c0\u67e5\nvalidate_password_policy    MEDIUM\n-- \u81f3\u5c11\u5305\u542b\u4e00\u4e2a\u7279\u6b8a\u5b57\u7b26\nvalidate_password_special_char_count    1\n</code></pre></p> <p>\u8c03\u6574\u5bc6\u7801\u590d\u6742\u5ea6\u914d\u7f6e\uff1a <pre><code>-- \u6839\u636e\u9700\u8981\u8c03\u6574\u7b56\u7565\uff08\u53ef\u9009\uff09\uff0c\u91cd\u542f\u4e0d\u4f1a\u5931\u6548\nSET PERSIST validate_password.policy = 'STRONG';\nSET PERSIST validate_password.length = 12;\n</code></pre></p>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E5%AE%89%E8%A3%85/#_8","title":"\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e","text":"<p>\u901a\u8fc7\u7cfb\u7edf\u53d8\u91cf <code>default_password_lifetime</code> \u6765\u63a7\u5236\uff0c\u901a\u8fc7\u7cfb\u7edf\u7528\u6237\u8868\u7684 <code>password_last_changed</code> \u548c\u5f53\u524d\u65f6\u95f4\u6765\u5224\u65ad\u5bc6\u7801\u662f\u5426\u8fc7\u671f\u3002</p> <p>\u67e5\u770b\u503c\uff1a <pre><code>show variables like 'default_password_lifetime';\n</code></pre></p> <p>\u8bbe\u7f6e\u5bc6\u7801\u8fc7\u671f\u65f6\u95f4\uff1a <pre><code>-- \u7981\u7528\u5bc6\u7801\u8fc7\u671f\u673a\u5236\uff0c\u91cd\u542f\u4e0d\u4f1a\u5931\u6548\nSET PERSIST default_password_lifetime = 0;\n\n-- \u8bbe\u7f6e\u5bc6\u7801 90 \u5929\u8fc7\u671f\uff0c\u91cd\u542f\u4e0d\u4f1a\u5931\u6548\nSET PERSIST default_password_lifetime = 90;\n</code></pre></p> <p>\u7cfb\u7edf\u53d8\u91cf <code>default_password_lifetime</code> \u662f\u5168\u5c40\u7684\u5bc6\u7801\u8fc7\u671f\u7b56\u7565\uff0c\u8fd8\u53ef\u4ee5\u9488\u5bf9\u5355\u4e2a\u7528\u6237\u8fdb\u884c\u8bbe\u7f6e\u3002\u9488\u5bf9\u5355\u4e2a\u7528\u6237\u7684\u8bbe\u7f6e\u4f18\u5148\u7ea7\u9ad8\u4e8e\u7cfb\u7edf\u53d8\u91cf\u3002 <pre><code>-- \u8bbe\u7f6e test \u7528\u6237\u5bc6\u7801\u7684\u8fc7\u671f\u7b56\u7565\u4e3a 60 \u5929\nALTER USER 'test'@'localhost' PASSWORD EXPIRE INTERVAL 60 DAY;\n\n-- \u8bbe\u7f6e root \u7528\u6237\u7684\u5bc6\u7801\u8fc7\u671f\u7b56\u7565\u4e3a\u6c38\u4e0d\u8fc7\u671f\nALTER USER 'root'@'%' PASSWORD EXPIRE NEVER;\n</code></pre></p> <p>\u64cd\u4f5c\u624b\u518c\uff1a <pre><code>-- \u67e5\u770b\u7528\u6237\u5bc6\u7801\u8fc7\u671f\u76f8\u5173\u7684\u5b57\u6bb5\nSELECT user, host, password_last_changed, password_lifetime, password_expired FROM mysql.user;\n\n-- \u66f4\u65b0\u6240\u6709\u7528\u6237\u7684\u6700\u8fd1\u5bc6\u7801\u4fee\u6539\u65f6\u95f4\nUPDATE mysql.user SET password_last_changed = NOW();\n\n-- \u8bbe\u7f6e  root \u7528\u6237\u5bc6\u7801\u6c38\u4e0d\u8fc7\u671f\nALTER USER 'root'@'%' PASSWORD EXPIRE NEVER;\n\n-- \u5168\u5c40\u8bbe\u7f6e\u7528\u6237\u5bc6\u7801 90 \u5929\u8fc7\u671f\nSET PERSIST default_password_lifetime = 90;\n\n-- \u67e5\u770b\u5168\u5c40\u8fc7\u671f\u65f6\u95f4\nshow variables like 'default_password_lifetime';\n</code></pre></p> <p>\u603b\u7ed3\uff1a</p> <ol> <li>\u7cfb\u7edf\u53d8\u91cf <code>default_password_lifetime</code> \u5168\u5c40\u8bbe\u7f6e\u7528\u6237\u7684\u5bc6\u7801\u8fc7\u671f\u7b56\u7565\uff0c\u901a\u8fc7 <code>password_last_changed</code> \u548c\u5f53\u524d\u65f6\u95f4\u6765\u5224\u65ad\u7528\u6237\u5bc6\u7801\u662f\u5426\u8fc7\u671f\u3002</li> <li>\u8bed\u53e5 <code>ALTER USER PASSWORD EXPIRE</code> \u9488\u5bf9\u5355\u4e2a\u7528\u6237\u8bbe\u7f6e\u5bc6\u7801\u8fc7\u671f\u7b56\u7565\uff0c\u901a\u8fc7 <code>password_lifetime</code> \u548c\u5f53\u524d\u65f6\u95f4\u6765\u5224\u65ad\u7528\u6237\u5bc6\u7801\u662f\u5426\u8fc7\u671f\u3002\u4f18\u5148\u7ea7\u9ad8\u4e8e\u7cfb\u7edf\u53d8\u91cf\u3002</li> </ol>","tags":["MySQL"]},{"location":"DataBase/MySQL/MySQL%20%E7%B4%A2%E5%BC%95/","title":"MySQL \u7d22\u5f15","text":"<p>\u7d22\u5f15\u7684\u57fa\u672c\u64cd\u4f5c \u67e5\u8be2\u7d22\u5f15 <pre><code>SHOW INDEX FROM table_name;\n</code></pre></p> <p>\u6dfb\u52a0\u7d22\u5f15 <pre><code>ALTER TABLE table_name ADD INDEX index_name (column1, column2);\n</code></pre></p> <p>\u5220\u9664\u7d22\u5f15 <pre><code>ALTER TABLE table_name DROP INDEX index_name;\n</code></pre></p> <p>InnoDB \u5b58\u50a8\u5f15\u64ce\u652f\u6301\u4ee5\u4e0b\u51e0\u79cd\u5e38\u89c1\u7684\u7d22\u5f15\uff1a - B+ \u6811\u7d22\u5f15\u3002 - \u5168\u6587\u7d22\u5f15\u3002 - \u54c8\u5e0c\u7d22\u5f15\u3002</p> <p>\u4ec0\u4e48\u662f\u54c8\u5e0c\u7d22\u5f15\uff0c\u4f18\u52a3\u3002</p> <p>Explain \u89e3\u91ca\u3002</p> <p>\u8c03\u4f18\u7684\u6d41\u7a0b\u3002</p> <p>\u5982\u679c\u7d22\u5f15\u547d\u4e2d\u4e86\uff0c\u67e5\u8be2\u4ecd\u7136\u5f88\u6162\u3002</p>"},{"location":"DataBase/PG/PG%20Tips/","title":"PG Tips","text":"<p>\u521b\u5efa\u7528\u6237\u548c\u5e93 <pre><code>CREATE USER vaultwarden WITH ENCRYPTED PASSWORD 'yourpassword';\nCREATE DATABASE vaultwarden OWNER vaultwarden;\n</code></pre></p>"},{"location":"DataBase/PG/PG%20%E5%AE%89%E8%A3%85/","title":"PG \u5b89\u88c5","text":"<p>\u914d\u7f6e\u4ed3\u5e93\uff1a <pre><code># \u521b\u5efa\u76ee\u5f55\u4fdd\u5b58\u516c\u94a5\ninstall -d /usr/share/postgresql-common/pgdg\n\n# \u4e0b\u8f7d\u516c\u94a5\ncurl -o /usr/share/postgresql-common/pgdg/apt.postgresql.org.asc --fail https://www.postgresql.org/media/keys/ACCC4CF8.asc\n\n# \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c/etc/os-release \u5305\u542b VERSION_CODENAME \u73af\u5883\u53d8\u91cf\n. /etc/os-release\n\n# \u8bbe\u7f6e PostgreSQL \u5b98\u65b9 APT \u4ed3\u5e93\u6e90\nsh -c \"echo 'deb [signed-by=/usr/share/postgresql-common/pgdg/apt.postgresql.org.asc] https://apt.postgresql.org/pub/repos/apt $VERSION_CODENAME-pgdg main' &gt; /etc/apt/sources.list.d/pgdg.list\"\n\n# \u66f4\u65b0\u5305\u7d22\u5f15 \napt update\n</code></pre></p> <p>\u67e5\u770b\u8f6f\u4ef6\u7684\u4fe1\u606f\uff1a <pre><code>apt show postgresql-18\n</code></pre></p> <p>\u5b89\u88c5\uff1a <pre><code>apt install postgresql-18\n</code></pre></p> <p>PG \u76f8\u5173\u7684\u8fdb\u7a0b\uff1a <pre><code>postgres 1900217       1  0 00:00 ?        00:00:00 /usr/lib/postgresql/18/bin/postgres -D /var/lib/postgresql/18/main -c config_file=/etc/postgresql/18/main/postgresql.conf\npostgres 1900218 1900217  0 00:00 ?        00:00:00 postgres: 18/main: io worker 0\npostgres 1900219 1900217  0 00:00 ?        00:00:00 postgres: 18/main: io worker 1\npostgres 1900220 1900217  0 00:00 ?        00:00:00 postgres: 18/main: io worker 2\npostgres 1900221 1900217  0 00:00 ?        00:00:00 postgres: 18/main: checkpointer \npostgres 1900222 1900217  0 00:00 ?        00:00:00 postgres: 18/main: background writer \npostgres 1900224 1900217  0 00:00 ?        00:00:00 postgres: 18/main: walwriter \npostgres 1900225 1900217  0 00:00 ?        00:00:00 postgres: 18/main: autovacuum launcher \npostgres 1900226 1900217  0 00:00 ?        00:00:00 postgres: 18/main: logical replication launcher \n\n- PostgreSQL 18 \u4e3b\u8fdb\u7a0b\uff08\u7531\u7528\u6237 `postgres` \u542f\u52a8\uff09\n- \u542f\u52a8\u53c2\u6570\uff1a\n    - `-D /var/lib/postgresql/18/main`  \u6570\u636e\u76ee\u5f55\n    - `-c config_file=/etc/postgresql/18/main/postgresql.conf`  \u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\n- `io worker 0/1/2`  I/O worker \u7ebf\u7a0b\uff0c\u7528\u4e8e\u5f02\u6b65\u5199\u5165/\u8bfb\u53d6\u78c1\u76d8\u6570\u636e\n- `checkpointer`  \u5b9a\u671f\u628a\u810f\u9875\u5199\u5165\u78c1\u76d8\n- `background writer`  \u80cc\u666f\u7f13\u51b2\u5199\u5165\n- `walwriter`  WAL \u65e5\u5fd7\u5199\u5165\u8fdb\u7a0b\n- `autovacuum launcher`  \u81ea\u52a8\u6e05\u7406\u8868/\u7d22\u5f15\n- `logical replication launcher`  \u903b\u8f91\u590d\u5236\u542f\u52a8\u8fdb\u7a0b\n</code></pre></p> <p>\u672c\u5730\u767b\u5f55\u8fdb\u5165\u6570\u636e\u5e93\uff1a <pre><code># \u5207\u6362\u5230\u7cfb\u7edf postgres \u7528\u6237\uff0c\u4f7f\u7528 Unix socket \u8fdb\u884c\u8ba4\u8bc1\u767b\u5f55\nsu postgres\npsql\n\n# \u8bbe\u7f6e PG postgres \u7528\u6237\u5bc6\u7801\nalter user postgres with password 'xxxx'; \n\n# \u7136\u540e\u4f7f\u7528 Linux root \u7528\u6237\u8fdb\u884c\u64cd\u4f5c\uff0c\u4f7f\u7528 TCP/IP socket \u901a\u4fe1\uff0c\u4f7f\u7528 PG postgres \u7528\u6237\u8fdb\u884c\u767b\u5f55\npsql -h 127.0.0.1 -p 5432 -U postgres\n</code></pre></p> <p>\u67e5\u770b\u6570\u636e\u5e93\u5217\u8868\uff1a <pre><code>\\l\n\\list\nselect * from pg_database;\n</code></pre></p> <p>\u9ed8\u8ba4\u7684\u8fde\u63a5\u914d\u7f6e\uff1a <pre><code># DO NOT DISABLE!\n# If you change this first entry you will need to make sure that the\n# database superuser can access the database using some other method.\n# Noninteractive access to all databases is required during automatic\n# maintenance (custom daily cronjobs, replication, and similar tasks).\n#\n# Database administrative login by Unix domain socket\nlocal   all             postgres                                peer\n# local \u53ea\u5141\u8bb8 Unix socket \u8fde\u63a5\uff1ball \u6240\u6709\u7684\u6570\u636e\u5e93\uff1bpostgres PG \u7684\u7ba1\u7406\u7528\u6237\uff1bpeer \u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u7528\u6237\u8ba4\u8bc1\uff0c\u540c\u6837\u662f postgres \u7528\u6237\n\n# TYPE  DATABASE        USER            ADDRESS                 METHOD\n\n# \"local\" is for Unix domain socket connections only\nlocal   all             all                                     peer\n# \u672c\u5730\u7684\u7684\u7cfb\u7edf\u7cfb\u7edf\u7528\u6237\u4e5f\u53ef\u4ee5\u901a\u8fc7 Unix socket \u767b\u5f55\uff0c\u524d\u63d0\u662f PG \u548c Linux \u90fd\u6709\u5bf9\u5e94\u7684\u7528\u6237\uff0c\u4f7f\u7528\u7684\u662f \u64cd\u4f5c\u7cfb\u7edf\u7684\u7528\u6237\u8ba4\u8bc1\n\n# IPv4 local connections:\nhost    all             all             127.0.0.1/32            scram-sha-256\n# \u672c\u5730 IPv4 \u5bc6\u7801\u8ba4\u8bc1\u767b\u5f55\n\n# IPv6 local connections:\nhost    all             all             ::1/128                 scram-sha-256\n# \u672c\u5730 IPv6 \u5bc6\u7801\u8ba4\u8bc1\u767b\u5f55\n\n# Allow replication connections from localhost, by a user with the\n# replication privilege.\nlocal   replication     all                                     peer\nhost    replication     all             127.0.0.1/32            scram-sha-256\nhost    replication     all             ::1/128                 scram-sha-256\n</code></pre></p> <p>\u914d\u7f6e\u76d1\u542c\u6240\u6709\u5730\u5740\uff0c\u7136\u540e\u914d\u7f6e\u6240\u6709\u7528\u6237\u90fd\u80fd\u901a\u8fc7\u7f51\u7edc\u8fde\u63a5\uff1a <pre><code>/etc/postgresql/18/main/postgresql.conf\nlisten_address = '*'\n\n/etc/postgresql/18/main/pg_hba.conf\nhost    all             all        192.168.31.0/24       scram-sha-256\n\n\u91cd\u542f\u670d\u52a1\nsystemctl restart postgresql\n</code></pre></p> <p>\u914d\u7f6e\u5bc6\u7801\u590d\u6742\u5ea6\u6821\u9a8c\u914d\u7f6e\uff1a <pre><code>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 /etc/postgresql/18/main/postgresql.conf\nshared_preload_libraries = 'passwordcheck'              # (change requires restart)\n\n\u91cd\u542f\u670d\u52a1\nsystemctl restart postgresql\n\n\u786e\u8ba4 passwordcheck \u6269\u5c55\u5df2\u52a0\u8f7d\nSHOW shared_preload_libraries;\n\n\u9ed8\u8ba4\u957f\u5ea6\u6700\u5c0f\u4e3a 8\uff0c\u9700\u8981\u540c\u65f6\u5305\u542b\u5b57\u6bcd\u548c\u975e\u5b57\u6bcd\uff0c\u5bc6\u7801\u4e0d\u80fd\u5305\u542b\u7528\u6237\u540d\n</code></pre></p> <p>\u914d\u7f6e\u5bc6\u7801\u8fc7\u671f\u65f6\u95f4\uff1a <pre><code>-- \u67e5\u770b\u7528\u6237\u5217\u8868\uff0c\u5176\u4e2d\u5305\u542b\u8fc7\u671f\u65f6\u95f4\u5b57\u6bb5\nSELECT * FROM pg_catalog.pg_user;\n\n-- \u8bbe\u7f6e\u5bc6\u7801\u8fc7\u671f\u65f6\u95f4\nALTER ROLE myuser VALID UNTIL '2025-02-08';\n</code></pre></p>"},{"location":"DataBase/PG/PG%20%E6%B8%85%E7%90%86%20WAL%20%E6%97%A5%E5%BF%97/","title":"PG \u6e05\u7406 WAL \u65e5\u5fd7","text":""},{"location":"DataBase/PG/PG%20%E6%B8%85%E7%90%86%20WAL%20%E6%97%A5%E5%BF%97/#pg-wal","title":"PG \u6e05\u7406 WAL \u65e5\u5fd7","text":"<p>\u5982\u679c PG WAL \u65e5\u5fd7\u5360\u7528\u8fc7\u591a\u78c1\u76d8\u7a7a\u95f4\u53ef\u4ee5\u624b\u52a8\u6e05\u7406\u3002</p> <p>\u5148\u627e\u5230 PG \u8fdb\u7a0b <pre><code>ps -ef | grep postgres\nls -l /proc/pg_pid\n</code></pre></p> <p>\u8fdb\u5165 pg \u547d\u4ee4\u6240\u5728\u7684\u76ee\u5f55 <pre><code>./pg_controldata /var/lib/postgresql/13/main/\n</code></pre></p> <p>\u8f93\u51fa <pre><code>Latest checkpoint location: 7EE/3A9CFE0\n\nLatest checkpoint's REDO location: 7EE/2B0E5F0\n\nLatest checkpoint's REDO WAL file: 00000001000007EE00000002\n</code></pre></p> <p>\u6e05\u9664 00000001000007EE00000002 \u4e4b\u524d\u7684\u6587\u4ef6\uff0c\u6ce8\u610f\u6709\u4e2a\u7a7a\u683c\u5728 wal \u5b58\u50a8\u8def\u5f84\u540e\u9762\u3002 <pre><code>./pg_archivecleanup -d /var/lib/postgresql/13/main/pg_wal/ 00000001000007EE00000002\n</code></pre></p>"},{"location":"DataBase/PG/PG%20%E6%B8%85%E7%90%86%20WAL%20%E6%97%A5%E5%BF%97/#pg","title":"PG \u67e5\u770b\u6570\u636e\u5e93\u548c\u8868\u78c1\u76d8\u7a7a\u95f4\u5360\u7528","text":"<p>\u67e5\u770b\u6bcf\u4e2a\u5e93\u6570\u636e\u5360\u7528\u7684\u78c1\u76d8\u7a7a\u95f4 <pre><code>select datname, pg_size_pretty (pg_database_size(datname)) AS size from pg_database;\n</code></pre></p> <p>\u67e5\u770b\u5e93\u4e2d\u6bcf\u4e2a\u8868\u5360\u7528\u7684\u78c1\u76d8\u7a7a\u95f4 <pre><code>select relname, pg_size_pretty(pg_relation_size(relid)) from pg_stat_user_tables where schemaname='public' order by pg_relation_size(relid) desc;\n</code></pre></p>"},{"location":"DataBase/PG/PG%20%E6%B8%85%E7%90%86%20WAL%20%E6%97%A5%E5%BF%97/#pg_dump","title":"pg_dump \u5bfc\u51fa\u6570\u636e","text":"<p>pg_dump \u547d\u4ee4\u7684\u7528\u6cd5 <pre><code>pg_dump \u628a\u4e00\u4e2a\u6570\u636e\u5e93\u8f6c\u50a8\u4e3a\u7eaf\u6587\u672c\u6587\u4ef6\u6216\u8005\u662f\u5176\u5b83\u683c\u5f0f.\n\n\u7528\u6cd5:\n  pg_dump [\u9009\u9879]... [\u6570\u636e\u5e93\u540d\u5b57]\n\n\u4e00\u822c\u9009\u9879:\n  -f, --file=FILENAME          \u8f93\u51fa\u6587\u4ef6\u6216\u76ee\u5f55\u540d\n  -F, --format=c|d|t|p         \u8f93\u51fa\u6587\u4ef6\u683c\u5f0f (\u5b9a\u5236, \u76ee\u5f55, tar\n                               \u660e\u6587 (\u9ed8\u8ba4\u503c))\n  -j, --jobs=NUM               \u6267\u884c\u591a\u4e2a\u5e76\u884c\u4efb\u52a1\u8fdb\u884c\u5907\u4efd\u8f6c\u50a8\u5de5\u4f5c\n  -v, --verbose                \u8be6\u7ec6\u6a21\u5f0f\n  -V, --version                \u8f93\u51fa\u7248\u672c\u4fe1\u606f\uff0c\u7136\u540e\u9000\u51fa\n  -Z, --compress=0-9           \u88ab\u538b\u7f29\u683c\u5f0f\u7684\u538b\u7f29\u7ea7\u522b\n  --lock-wait-timeout=TIMEOUT  \u5728\u7b49\u5f85\u8868\u9501\u8d85\u65f6\u540e\u64cd\u4f5c\u5931\u8d25\n  --no-sync                    \u4e0d\u7528\u7b49\u5f85\u53d8\u5316\u5b89\u5168\u5199\u5165\u78c1\u76d8\n  -?, --help                   \u663e\u793a\u6b64\u5e2e\u52a9, \u7136\u540e\u9000\u51fa\n\n\u63a7\u5236\u8f93\u51fa\u5185\u5bb9\u9009\u9879:\n  -a, --data-only              \u53ea\u8f6c\u50a8\u6570\u636e,\u4e0d\u5305\u62ec\u6a21\u5f0f\n  -b, --blobs                  \u5728\u8f6c\u50a8\u4e2d\u5305\u62ec\u5927\u5bf9\u8c61\n  -B, --no-blobs               \u6392\u9664\u8f6c\u50a8\u4e2d\u7684\u5927\u578b\u5bf9\u8c61\n  -c, --clean                  \u5728\u91cd\u65b0\u521b\u5efa\u4e4b\u524d\uff0c\u5148\u6e05\u9664\uff08\u5220\u9664\uff09\u6570\u636e\u5e93\u5bf9\u8c61\n  -C, --create                 \u5728\u8f6c\u50a8\u4e2d\u5305\u62ec\u547d\u4ee4,\u4ee5\u4fbf\u521b\u5efa\u6570\u636e\u5e93\n  -E, --encoding=ENCODING      \u8f6c\u50a8\u4ee5ENCODING\u5f62\u5f0f\u7f16\u7801\u7684\u6570\u636e\n  -n, --schema=PATTERN         dump the specified schema(s) only\n  -N, --exclude-schema=PATTERN do NOT dump the specified schema(s)\n  -O, --no-owner               \u5728\u660e\u6587\u683c\u5f0f\u4e2d, \u5ffd\u7565\u6062\u590d\u5bf9\u8c61\u6240\u5c5e\u8005\n  -s, --schema-only            \u53ea\u8f6c\u50a8\u6a21\u5f0f, \u4e0d\u5305\u62ec\u6570\u636e\n  -S, --superuser=NAME         \u5728\u660e\u6587\u683c\u5f0f\u4e2d\u4f7f\u7528\u6307\u5b9a\u7684\u8d85\u7ea7\u7528\u6237\u540d\n  -t, --table=PATTERN          dump the specified table(s) only\n  -T, --exclude-table=PATTERN  do NOT dump the specified table(s)\n  -x, --no-privileges          \u4e0d\u8981\u8f6c\u50a8\u6743\u9650 (grant/revoke)\n  --binary-upgrade             \u53ea\u80fd\u7531\u5347\u7ea7\u5de5\u5177\u4f7f\u7528\n  --column-inserts             \u4ee5\u5e26\u6709\u5217\u540d\u7684INSERT\u547d\u4ee4\u5f62\u5f0f\u8f6c\u50a8\u6570\u636e\n  --disable-dollar-quoting     \u53d6\u6d88\u7f8e\u5143 (\u7b26\u53f7) \u5f15\u53f7, \u4f7f\u7528 SQL \u6807\u51c6\u5f15\u53f7\n  --disable-triggers           \u5728\u53ea\u6062\u590d\u6570\u636e\u7684\u8fc7\u7a0b\u4e2d\u7981\u7528\u89e6\u53d1\u5668\n  --enable-row-security        \u542f\u7528\u884c\u5b89\u5168\u6027\uff08\u53ea\u8f6c\u50a8\u7528\u6237\u80fd\u591f\u8bbf\u95ee\u7684\u5185\u5bb9\uff09\n  --exclude-table-data=PATTERN do NOT dump data for the specified table(s)\n  --extra-float-digits=NUM     \u8986\u76d6extra_float_digits\u7684\u9ed8\u8ba4\u8bbe\u7f6e\n  --if-exists                  \u5f53\u5220\u9664\u5bf9\u8c61\u65f6\u4f7f\u7528IF EXISTS\n  --include-foreign-data=PATTERN\n                               include data of foreign tables on foreign\n                               servers matching PATTERN\n  --inserts                    \u4ee5INSERT\u547d\u4ee4\uff0c\u800c\u4e0d\u662fCOPY\u547d\u4ee4\u7684\u5f62\u5f0f\u8f6c\u50a8\u6570\u636e\n  --load-via-partition-root    \u901a\u8fc7\u6839\u8868\u52a0\u8f7d\u5206\u533a\n  --no-comments                \u4e0d\u8f6c\u50a8\u6ce8\u91ca\n  --no-publications            \u4e0d\u8f6c\u50a8\u53d1\u5e03\n  --no-security-labels         \u4e0d\u8f6c\u50a8\u5b89\u5168\u6807\u7b7e\u7684\u5206\u914d\n  --no-subscriptions           \u4e0d\u8f6c\u50a8\u8ba2\u9605\n  --no-synchronized-snapshots  \u5728\u5e76\u884c\u5de5\u4f5c\u96c6\u4e2d\u4e0d\u4f7f\u7528\u540c\u6b65\u5feb\u7167\n  --no-tablespaces             \u4e0d\u8f6c\u50a8\u8868\u7a7a\u95f4\u5206\u914d\u4fe1\u606f\n  --no-unlogged-table-data     \u4e0d\u8f6c\u50a8\u6ca1\u6709\u65e5\u5fd7\u7684\u8868\u6570\u636e\n  --on-conflict-do-nothing     \u5c06ON CONFLICT DO NOTHING\u6dfb\u52a0\u5230INSERT\u547d\u4ee4\n  --quote-all-identifiers      \u6240\u6709\u6807\u8bc6\u7b26\u52a0\u5f15\u53f7\uff0c\u5373\u4f7f\u4e0d\u662f\u5173\u952e\u5b57\n  --rows-per-insert=NROWS      \u6bcf\u4e2a\u63d2\u5165\u7684\u884c\u6570\uff1b\u610f\u5473\u7740--inserts\n  --section=SECTION            \u5907\u4efd\u547d\u540d\u7684\u8282 (\u6570\u636e\u524d, \u6570\u636e, \u53ca \u6570\u636e\u540e)\n  --serializable-deferrable    \u7b49\u5230\u5907\u4efd\u53ef\u4ee5\u65e0\u5f02\u5e38\u8fd0\u884c\n  --snapshot=SNAPSHOT          \u4e3a\u8f6c\u50a8\u4f7f\u7528\u7ed9\u5b9a\u7684\u5feb\u7167\n  --strict-names               \u8981\u6c42\u6bcf\u4e2a\u8868\u548c(\u6216)schema\u5305\u62ec\u6a21\u5f0f\u4ee5\u5339\u914d\u81f3\u5c11\u4e00\u4e2a\u5b9e\u4f53\n  --use-set-session-authorization\n                               \u4f7f\u7528 SESSION AUTHORIZATION \u547d\u4ee4\u4ee3\u66ff\n                               ALTER OWNER \u547d\u4ee4\u6765\u8bbe\u7f6e\u6240\u6709\u6743\n\n\u8054\u63a5\u9009\u9879:\n  -d, --dbname=DBNAME      \u5bf9\u6570\u636e\u5e93 DBNAME\u5907\u4efd\n  -h, --host=\u4e3b\u673a\u540d        \u6570\u636e\u5e93\u670d\u52a1\u5668\u7684\u4e3b\u673a\u540d\u6216\u5957\u63a5\u5b57\u76ee\u5f55\n  -p, --port=\u7aef\u53e3\u53f7        \u6570\u636e\u5e93\u670d\u52a1\u5668\u7684\u7aef\u53e3\u53f7\n  -U, --username=\u540d\u5b57      \u4ee5\u6307\u5b9a\u7684\u6570\u636e\u5e93\u7528\u6237\u8054\u63a5\n  -w, --no-password        \u6c38\u8fdc\u4e0d\u63d0\u793a\u8f93\u5165\u53e3\u4ee4\n  -W, --password           \u5f3a\u5236\u53e3\u4ee4\u63d0\u793a (\u81ea\u52a8)\n  --role=ROLENAME          \u5728\u8f6c\u50a8\u524d\u8fd0\u884cSET ROLE\n\n\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\u6570\u636e\u5e93\u540d\u5b57, \u90a3\u4e48\u4f7f\u7528 PGDATABASE \u73af\u5883\u53d8\u91cf\u7684\u6570\u503c.\n</code></pre></p>"},{"location":"DataBase/PG/PG%20%E6%B8%85%E7%90%86%20WAL%20%E6%97%A5%E5%BF%97/#pg_1","title":"PG \u65e5\u5fd7\u5360\u7528\u78c1\u76d8\u8fc7\u9ad8\u5904\u7406\uff0c\u6848\u4f8b","text":"<p>\u78c1\u76d8\u5360\u7528\u8fc7\u9ad8\uff0c\u6392\u67e5\u5230 PG \u6570\u636e\u5b58\u50a8\u76ee\u5f55\u5360\u7528\u5f88\u9ad8\u3002 <pre><code># pwd\n/var/lib/pgsql/13/data\n# du -sh ./*\n62G     ./base\n4.0K    ./current_logfiles\n620K    ./global\n54G     ./log\n</code></pre></p> <p>base \u76ee\u5f55\u5b58\u653e\u7684\u662f\u6570\u636e\u3002 log \u76ee\u5f55\u5b58\u653e\u7684\u662f PG \u9519\u8bef\u65e5\u5fd7\uff0cPG \u914d\u7f6e\u5f00\u542f\u4e86\u9519\u8bef\u65e5\u5fd7\u8bb0\u5f55\u3002</p> <p>\u67e5\u770b\u9519\u8bef\u65e5\u5fd7\u76ee\u5f55\uff0c\u53d1\u73b0\u9519\u8bef\u65e5\u5fd7\u6bcf\u5929\u90fd\u5f88\u5927\u3002 <pre><code># ls -lh\ntotal 54G\n-rw------- 1 postgres postgres 8.1G Apr  6 00:00 postgresql-Fri.log\n-rw------- 1 postgres postgres 8.0G Apr  8 23:59 postgresql-Mon.log\n-rw------- 1 postgres postgres 8.1G Apr  6 23:59 postgresql-Sat.log\n-rw------- 1 postgres postgres 8.1G Apr  7 23:59 postgresql-Sun.log\n-rw------- 1 postgres postgres 8.0G Apr  4 23:59 postgresql-Thu.log\n-rw------- 1 postgres postgres 5.2G Apr  9 15:31 postgresql-Tue.log\n-rw------- 1 postgres postgres 8.1G Apr  4 00:00 postgresql-Wed.log\n</code></pre></p> <p>\u67e5\u770b\u65e5\u5fd7\u5185\u5bb9\uff0c\u57fa\u672c\u4e0a\u90fd\u662f\u91cd\u590d\u7684\u8be5\u6761\u9519\u8bef\u65e5\u5fd7\u3002\u540e\u7eed\u548c\u76f8\u5173\u7684\u4e1a\u52a1\u540c\u4e8b\u4e86\u89e3\u5230\uff0c\u4e1a\u52a1\u4e0a\u6bcf 5 \u79d2\u67e5\u8be2 GPS \u6570\u636e\u76f4\u63a5\u63d2\u5165\u5230\u6570\u636e\u5e93\uff0c\u91cd\u590d\u7684\u6570\u636e\u6ca1\u6709\u4efb\u4f55\u5904\u7406\uff0c\u76f4\u63a5\u63d2\u5165\uff0c\u5bfc\u81f4\u9519\u8bef\u65e5\u5fd7\u8fc7\u591a\u3002 <pre><code>2024-04-09 15:40:08.396 CST [2255299] \u9519\u8bef:  \u91cd\u590d\u952e\u8fdd\u53cd\u552f\u4e00\u7ea6\u675f\"xxx_xxxxxx\"\n2024-04-09 15:40:08.396 CST [2255299] \u8be6\u7ec6\u4fe1\u606f:  \u952e\u503c\"xxxxxxxxxxxxxxxx\" \u5df2\u7ecf\u5b58\u5728\n</code></pre></p> <p>\u89e3\u51b3\u529e\u6cd5\u3002 \u793a\u4f8b\u8868 <pre><code>CREATE TABLE test ( \n    id SERIAL PRIMARY KEY, \n    name VARCHAR(100), \n    age INT, \n    CONSTRAINT unique_name_age UNIQUE (name, age) \n);\n</code></pre></p> <p>\u63d2\u5165\u6570\u636e\u7684\u65f6\u5019\u4f7f\u7528 on conflict do nothing \u8bed\u53e5\u6765\u6307\u5b9a\u51fa\u73b0\u51b2\u7a81\u65f6\u4ec0\u4e48\u4e5f\u4e0d\u505a\u3002 <pre><code>INSERT INTO test(name, age) VALUES ('John', 25) ON CONFLICT (name, age) DO NOTHING;\n</code></pre></p>"},{"location":"DataBase/Redis/Redis%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/","title":"Redis \u5206\u5e03\u5f0f\u9501","text":"<p>set key value NX EX seconds  \u5b58\u5728\u7684\u95ee\u9898 - \u4e0d\u53ef\u91cd\u5165\uff0c\u8981\u5b9e\u73b0\u91cd\u5165\u9700\u8981\u81ea\u5df1\u5b9e\u73b0 Lock \u63a5\u53e3\u5b9e\u73b0\u3002 - \u4e0d\u53ef\u5c1d\u8bd5\u83b7\u53d6\u6216\u8005\u7b49\u5f85\u6307\u5b9a\u65f6\u95f4\u83b7\u53d6\uff0c\u8981\u5b9e\u73b0\u9700\u8981\u81ea\u5df1\u5b9e\u73b0 Lock \u6bd4\u5b9e\u73b0\u91cd\u5165\u8981\u56f0\u96be\u3002 - \u8d85\u65f6\u91ca\u653e\uff0c\u53ef\u80fd\u5bfc\u81f4\u91ca\u653e\u5176\u5b83\u7ebf\u7a0b\u83b7\u53d6\u7684\u9501\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4f7f\u7528 Redission</p> <p>\u8d85\u65f6\u7eed\u9501\u7684\u539f\u7406\u662f\u4ec0\u4e48</p>"},{"location":"DataBase/Redis/Redis%20%E5%AE%89%E8%A3%85/","title":"Redis \u5b89\u88c5","text":""},{"location":"DataBase/Redis/Redis%20%E5%AE%89%E8%A3%85/#debian","title":"Debian","text":"<p>\u67e5\u770b\u8981\u5b89\u88c5\u7684\u7248\u672c\uff1a <pre><code>apt show redis-server\n</code></pre></p> <p>\u5b89\u88c5 Redis\uff1a <pre><code>apt update\napt install redis-server\n</code></pre></p> <p>\u67e5\u770b\u72b6\u6001\uff1a <pre><code>systemctl enable redis-server --now\nsystemctl status redis-server\n</code></pre></p> <p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 <code>/etc/redis/reids.conf</code>\uff0c\u8bbe\u7f6e\u5bc6\u7801\u3002\u7136\u540e\u6267\u884c <code>systemctl restart redis-server</code> \u547d\u4ee4\u91cd\u542f <code>redis-server</code> \u4f7f\u4fee\u6539\u751f\u6548\u3002 <pre><code>requirepass &lt;password&gt;\n</code></pre></p> <p>\u8fde\u63a5\u6d4b\u8bd5\u3002 <pre><code># redis-cli\n127.0.0.1:6379&gt; set name jacky\n(error) NOAUTH Authentication required.\n127.0.0.1:6379&gt; auth &lt;password&gt;\nOK\n127.0.0.1:6379&gt; set name jacky\nOK\n127.0.0.1:6379&gt; get name\n\"jacky\"\n</code></pre></p> <p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 <code>/etc/redis/reids.conf</code>\uff0c\u914d\u7f6e\u5141\u8bb8\u8fdc\u7a0b\u8fde\u63a5\u3002 <pre><code>bind 0.0.0.0 -::1\n# \u8868\u793a\u76d1\u542c\u6240\u6709\u7684 IPv4 \u5730\u5740\uff0c\u4e0d\u76d1\u542c IPv6 \u7684\u672c\u5730\u56de\u73af\u5730\u5740\n</code></pre></p> <p>Redis \u76f8\u5173\u7684\u6587\u4ef6\u8def\u5f84\uff1a</p> \u7c7b\u578b \u8def\u5f84 \u8bf4\u660e \u4e3b\u7a0b\u5e8f <code>/usr/bin/redis-server</code> Redis \u670d\u52a1\u7aef \u5ba2\u6237\u7aef <code>/usr/bin/redis-cli</code> Redis \u547d\u4ee4\u884c\u5ba2\u6237\u7aef \u5de5\u5177 <code>/usr/bin/redis-benchmark</code>\u3001<code>/usr/bin/redis-check-rdb</code> \u6027\u80fd\u6d4b\u8bd5\u4e0e\u68c0\u67e5\u5de5\u5177 \u914d\u7f6e\u6587\u4ef6 <code>/etc/redis/redis.conf</code> \u4e3b\u914d\u7f6e\u6587\u4ef6 \u6570\u636e\u76ee\u5f55 <code>/var/lib/redis</code> \u5b58\u50a8 <code>.rdb</code> \u6570\u636e\u5feb\u7167\u6587\u4ef6 \u65e5\u5fd7\u76ee\u5f55 <code>/var/log/redis</code> Redis \u8fd0\u884c\u65e5\u5fd7 systemd \u670d\u52a1 <code>/lib/systemd/system/redis-server.service</code> \u7528\u4e8e <code>systemctl</code> \u63a7\u5236 Redis \u6587\u6863 <code>/usr/share/doc/redis-server/</code> README\u3001\u7248\u6743\u7b49"},{"location":"DataBase/Redis/Redis%20%E5%AE%89%E8%A3%85/#windows","title":"Windows","text":"<p>\u4e0b\u8f7d\u5b89\u88c5\u6587\u4ef6 Redis-7.4.2-Windows-x64-msys2.zip</p> <p>\u89e3\u538b\u7f29\uff0c\u542f\u52a8\uff1a <pre><code>redis-server.exe redis.conf\n</code></pre></p>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/","title":"Redis \u6570\u636e\u7ed3\u6784","text":""},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_1","title":"\u901a\u7528\u64cd\u4f5c\u547d\u4ee4","text":""},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_2","title":"\u57fa\u7840\u547d\u4ee4","text":"<p>\u5220\u9664 KEY\uff1a <pre><code>DEL key [key ...]\uff1a\u5220\u9664\u6307\u5b9a\u7684 key\uff0c\u4e0d\u5173\u5fc3 key \u662f\u5426\u5b58\u5728\u4ee5\u53ca key \u5bf9\u5e94\u7684\u7c7b\u578b\u3002\n</code></pre></p> <p>\u662f\u5426\u5b58\u5728\u6307\u5b9a\u7684 KEY\uff1a <pre><code>EXISTS key [key ...]\uff1a\u5224\u65ad\u6307\u5b9a\u7684 key \u662f\u5426\u5b58\u5728\uff0c\u8fd4\u56de\u5b58\u5728 key \u7684\u6570\u91cf\u3002\u5982\u679c\u6307\u5b9a\u4e86\u591a\u6b21\u540c\u6837\u7684 key\uff0c\u5219\u8fd4\u56de\u7ed3\u679c\u4f1a\u8ba1\u6570\u591a\u6b21\u3002\n</code></pre></p> <p>\u67e5\u8be2 KEY\uff1a <pre><code>KEYS pattern\uff1a\u8fd4\u56de\u5339\u914d\u6a21\u5f0f\u7684\u6240\u6709 key\u3002\n</code></pre></p> <p>\u67e5\u8be2 KEY \u7684\u7c7b\u578b\uff1a <pre><code>TYPE key\uff1a\u8fd4\u56de key \u7684\u7c7b\u578b\u3002\n</code></pre></p> <p>\u6e05\u7a7a\u6240\u6709\u7684 KEY\uff1a <pre><code>FLUSHDB\uff1a\u5220\u9664\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u6240\u6709\u7684 key\u3002\n\nFLUSHALL\uff1a\u5220\u9664\u6240\u6709\u6570\u636e\u5e93\u7684 key\u3002\n</code></pre></p>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_3","title":"\u8fc7\u671f\u65f6\u95f4","text":"<p>Redis \u5b58\u50a8\u7684\u6570\u636e\uff0c\u5982\u679c\u6709\u4e9b\u6570\u636e\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u4e4b\u540e\u5c31\u4e0d\u518d\u4f7f\u7528\u4e86\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>DEL</code>  \u663e\u793a\u5730\u5220\u9664\u8fd9\u4e9b\u65e0\u7528\u7684\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 Redis \u7684\u8fc7\u671f\u65f6\u95f4\u7279\u6027\u6765\u8ba9\u4e00\u4e2a\u952e\u5728\u7ed9\u5b9a\u7684\u65f6\u9650\u4e4b\u540e\u81ea\u52a8\u5220\u9664\u3002</p> <p>\u5bf9\u4e8e\u5217\u8868\u3001\u96c6\u5408\u3001\u6563\u5217\u548c\u6709\u5e8f\u96c6\u5408\u8fd9\u6837\u7684\u5bb9\u5668\u7c7b\u578b\u7684\u6570\u636e\u7ed3\u6784\u6765\u8bf4\uff0c\u952e\u7684\u8fc7\u671f\u547d\u4ee4\u53ea\u80fd\u4e3a\u6574\u4e2a\u952e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u800c\u6ca1\u6709\u529e\u6cd5\u4e3a\u952e\u91cc\u7684\u5355\u4e2a\u5143\u7d20\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002\u8865\u5145\uff1a\u4e0d\u4e00\u5b9a\uff0c\u8981\u770b\u6570\u636e\u7c7b\u578b\u548c\u7248\u672c\u3002</p> <p>\u8fc7\u671f\u65f6\u95f4\u76f8\u5173\u547d\u4ee4\uff1a <pre><code>PERSIST key\uff1a\u79fb\u9664\u952e\u7684\u8fc7\u671f\u65f6\u95f4\n\nTTL key\uff1a\u67e5\u770b\u7ed9\u5b9a\u7684\u952e\u8ddd\u79bb\u8fc7\u671f\u8fd8\u6709\u591a\u5c11\u79d2\uff08time-to-live\uff0cttl\uff09\n\nEXPIRE key seconds\uff1a\u8bbe\u7f6e\u7ed9\u5b9a\u7684\u952e\u5728\u6307\u5b9a\u7684\u79d2\u6570\u4e4b\u540e\u8fc7\u671f\n\nEXPIREAT key timestamp\uff1a\u5c06\u7ed9\u5b9a\u7684\u952e\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u7ed9\u5b9a\u7684 UNIX \u65f6\u95f4\u6233\n\nPTTL key-nname\uff1a\u67e5\u770b\u7ed9\u5b9a\u7684\u952e\u8ddd\u79bb\u8fc7\u671f\u8fd8\u6709\u591a\u5c11\u6beb\u79d2\n\nPEXPIRE key milliseconds\uff1a\u8ba9\u7ed9\u5b9a\u7684\u952e\u5728\u6307\u5b9a\u7684\u6beb\u79d2\u6570\u4e4b\u540e\u8fc7\u671f\n\nPEXPIREAT key timestamp-millseconds\uff1a\u5c06\u4e00\u4e2a\u6beb\u79d2\u7ea7\u7ecf\u5ea6\u7684 UNIX \u65f6\u95f4\u6233\u8bbe\u7f6e\u4e3a\u7ed9\u5b9a\u952e\u7684\u8fc7\u671f\u65f6\u95f4\n</code></pre></p>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_4","title":"\u5b57\u7b26\u4e32","text":"<p>\u5b57\u7b26\u4e32\u53ef\u4ee5\u5b58\u50a8\u4ee5\u4e0b 3 \u949f\u7c7b\u578b\u7684\u503c\u3002  </p> <ul> <li> <p>\u5b57\u8282\u4e32 byte string\u3002  </p> </li> <li> <p>\u6574\u6570\u3002  </p> </li> <li> <p>\u6d6e\u70b9\u6570\u3002</p> </li> </ul>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#set","title":"<code>SET</code> \u547d\u4ee4\u8bed\u6cd5","text":"<pre><code>SET key value [NX | XX] [GET] [EX\u00a0seconds | PX\u00a0milliseconds | EXAT\u00a0unix-time-seconds | PXAT\u00a0unix-time-milliseconds | KEEPTTL]\n</code></pre> <ul> <li> <p><code>EX seconds</code> \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u6b63\u6574\u6570\uff0c\u5355\u4f4d\u79d2\u3002</p> </li> <li> <p><code>PX milliseconds</code> \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u6b63\u6574\u6570\uff0c\u5355\u4f4d\u6beb\u79d2\u3002</p> </li> <li> <p><code>EXAT timestamp-seconds</code> \u8bbe\u7f6e key \u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u5230\u671f\uff0c\u79d2\u7ea7\u65f6\u95f4\u6233\u3002</p> </li> <li> <p><code>PXAT timestamp-milliseconds</code> \u8bbe\u7f6e key \u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u5230\u671f\uff0c\u6beb\u79d2\u7ea7\u65f6\u95f4\u6233\u3002</p> </li> <li> <p><code>NX</code> \u4ec5\u5f53\u952e\u4e0d\u5b58\u5728\u65f6\u624d\u6267\u884c\u547d\u4ee4\u3002</p> </li> <li> <p><code>XX</code> \u4ec5\u5f53\u952e\u5b58\u5728\u65f6\u624d\u6267\u884c\u547d\u4ee4\u3002</p> </li> <li> <p><code>KEEPTTL</code> \u4fdd\u7559\u952e\u7684\u8fc7\u671f\u65f6\u95f4\u5c5e\u6027\uff0c\u5e38\u7528\u5728\u5f53\u952e\u5df2\u7ecf\u5b58\u5728\u65f6\u66f4\u65b0\u952e\u7684\u503c\uff0c\u4f46\u662f\u4e0d\u4fee\u6539\u539f\u6765\u952e\u7684\u8fc7\u671f\u65f6\u95f4\u5c5e\u6027\u3002</p> </li> <li> <p><code>GET</code> \u8fd4\u56de\u952e\u539f\u6765\u7684\u503c\uff0c\u5982\u679c\u4e4b\u524d\u4e0d\u5b58\u5728\u5219\u8fd4\u56de <code>nil</code>\u3002</p> </li> </ul>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_5","title":"\u5b57\u7b26\u4e32\u5e38\u7528\u547d\u4ee4","text":"<pre><code>GET key\uff1a\u83b7\u53d6\u952e\u7684\u503c\n\nMSET key value [key value ...]\uff1a\u540c\u65f6\u8bbe\u7f6e\u591a\u4e2a\u952e\u503c\n\nMGET key [key ...]\uff1a\u540c\u65f6\u83b7\u53d6\u591a\u4e2a\u952e\u7684\u503c\n\nGETRANGE key start end\uff1a\u83b7\u53d6\u503c\u7684\u6307\u5b9a\u53d6\u952e\uff0c0 \u8868\u793a\u7b2c\u4e00\u4e2a\u5b57\u7b26\uff0c-1 \u8868\u793a\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\uff0c-2 \u8868\u793a\u5012\u6570\u7b2c\u4e8c\u4e2a\u5b57\u7b26\n\nGETDEL key\uff1a\u83b7\u53d6\u503c\u5e76\u5220\u9664\u952e\n\nAPPEND key value\uff1a\u5728\u952e\u7684\u503c\u540e\u9762\u8ffd\u52a0 value\uff0c\u5373\u4f7f\u5373\u4f7f\u952e\u4e0d\u5b58\u5728\u4e5f\u4e0d\u5f71\u54cd\n</code></pre> <p>\u5f53\u7528\u6237\u5c06\u4e00\u4e2a\u503c\u5b58\u50a8\u5230 Redis \u5b57\u7b26\u4e32\u91cc\u9762\u7684\u65f6\u5019\uff0c\u5982\u679c\u8fd9\u4e2a\u503c\u53ef\u4ee5\u88ab\u89e3\u91ca\u4e3a\u5341\u8fdb\u5236\u6574\u6570\u6216\u8005\u6d6e\u70b9\u6570\uff0c\u90a3\u4e48 Redis \u4f1a\u5bdf\u89c9\u5230\u8fd9\u4e00\u70b9\uff0c\u5e76\u5141\u8bb8\u7528\u6237\u5bf9\u8fd9\u4e2a\u5b57\u7b26\u4e32\u6267\u884c\u5404\u79cd <code>INCT *</code> \u548c <code>DECR *</code> \u64cd\u4f5c\u3002</p> <p>\u5982\u679c\u7528\u6237\u5bf9\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u952e\u6216\u8005\u4e00\u4e2a\u4fdd\u5b58\u4e86\u7a7a\u4e32\u7684\u952e\u6267\u884c\u81ea\u589e\u6216\u81ea\u51cf\u64cd\u4f5c\uff0c\u90a3\u4e48 Redis \u5728\u6267\u884c\u64cd\u4f5c\u7684\u65f6\u5019\u4f1a\u5c06\u8fd9\u4e2a\u952e\u503c\u5f53\u4f5c\u662f 0 \u6765\u5904\u7406\u3002\u5982\u679c\u5c1d\u8bd5\u5bf9\u4e00\u4e2a\u503c\u65e0\u6cd5\u88ab\u89e3\u91ca\u4e3a\u6574\u6570\u6216\u8005\u6d6e\u70b9\u6570\u7684\u5b57\u7b26\u4e32\u6267\u884c\u81ea\u589e\u6216\u81ea\u51cf\u64cd\u4f5c\uff0c\u90a3\u4e48 Redis \u5c06\u8fd4\u56de\u4e00\u4e2a\u9519\u8bef\u3002</p>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_6","title":"\u81ea\u589e\u548c\u81ea\u51cf\u547d\u4ee4","text":"<pre><code>INCR key: \u5c06\u952e\u5b58\u50a8\u7684\u503c\u52a0\u4e0a 1\uff0c\u53ea\u80fd\u7528\u4e8e\u6574\u6570\n\nDECR key\uff1a\u5c06\u952e\u5b58\u50a8\u7684\u503c\u51cf\u53bb 1\uff0c\u53ea\u80fd\u7528\u4e8e\u6574\u6570\n\nINCRBY key amount\uff1a\u5c06\u952e\u5b58\u50a8\u7684\u503c\u52a0\u4e0a\u6574\u6570 amount\uff0c\u53ea\u80fd\u7528\u4e8e\u6574\u6570\n\nDECRBY key amount\uff1a\u5c06\u952e\u5b58\u50a8\u7684\u503c\u51cf\u53bb\u6574\u6570 amount\uff0c\u53ea\u80fd\u7528\u4e8e\u6574\u6570\n\nINCRBYFLOAT key amount\uff1a\u5c06\u952e\u5b58\u50a8\u7684\u503c\u52a0\u4e0a amount\uff0camount \u53ef\u4ee5\u662f\u6d6e\u70b9\u6570\n</code></pre>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_7","title":"\u5217\u8868","text":"<p>Redis \u5217\u8868\u5141\u8bb8\u7528\u6237\u4ece\u5e8f\u5217\u7684\u4e24\u7aef\u63a8\u5165\u6216\u5f39\u51fa\u5143\u7d20\uff0c\u83b7\u53d6\u5217\u8868\u5143\u7d20\uff0c\u4ee5\u53ca\u6267\u884c\u5404\u79cd\u5e38\u89c1\u7684\u5217\u8868\u64cd\u4f5c\u3002</p>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_8","title":"\u5217\u8868\u5e38\u7528\u547d\u4ee4","text":"<pre><code>RPUSH key val [val ...]\uff1a\u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u503c\u63a8\u5165\u5217\u8868\u7684\u53f3\u7aef\u3002\n\nLPUSH key val [val ...]\uff1a\u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u503c\u63a8\u5165\u5217\u8868\u7684\u5de6\u7aef\u3002\n\nRPOP key\uff1a\u79fb\u9664\u5e76\u8fd4\u56de\u5217\u8868\u6700\u53f3\u7aef\u7684\u5143\u7d20\u3002\n\nLPOP key\uff1a\u79fb\u9664\u5e76\u8fd4\u56de\u5217\u8868\u6700\u5de6\u7aef\u7684\u5143\u7d20\u3002\n\nLINDEX key offset\uff1a\u8fd4\u56de\u5217\u8868\u4e2d\u504f\u79fb\u91cf\u4e3a offset \u7684\u5143\u7d20\uff0c0 \u8868\u793a\u6700\u5de6\u8fb9\u7684\u5143\u7d20\uff0c-1 \u8868\u793a\u6700\u53f3\u8fb9\u7684\u5143\u7d20\u3002\n\nLRANGE key start end\uff1a\u8fd4\u56de\u5217\u8868\u4e2d\u4ece start \u504f\u79fb\u91cf\u5230 end \u504f\u79fb\u91cf\u8303\u56f4\u5185\u7684\u5143\u7d20\uff0c\u5305\u62ec start \u548c end\uff0c0 \u8868\u793a\u6700\u5de6\u8fb9\u7684\u5143\u7d20\uff0c-1 \u8868\u793a\u6700\u53f3\u8fb9\u7684\u5143\u7d20\u3002\n\nLTRIM key start end\uff1a\u5bf9\u5217\u8868\u8fdb\u884c\u4fee\u526a\uff0c\u53ea\u4fdd\u7559\u4ece start \u504f\u79fb\u91cf\u5230 end \u504f\u79fb\u91cf\u8303\u56f4\u5185\u7684\u5143\u7d20\uff0c\u5305\u62ec start \u548c end\uff0c0 \u8868\u793a\u6700\u5de6\u8fb9\u7684\u5143\u7d20\uff0c-1 \u8868\u793a\u6700\u53f3\u8fb9\u7684\u5143\u7d20\u3002\n</code></pre>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_9","title":"\u963b\u585e\u5f0f\u547d\u4ee4","text":"<pre><code>BLPOP/BRPOP key [key ...] timeout\n</code></pre> <ul> <li> <p>\u4ece\u7b2c\u4e00\u4e2a\u975e\u7a7a\u5217\u8868\u4e2d\u5f39\u51fa\u4f4d\u4e8e\u6700\u5de6/\u53f3\u7aef\u7684\u5143\u7d20\u3002</p> </li> <li> <p>\u662f LPOP \u7684\u963b\u585e\u7248\u672c\uff0c\u5f53\u6ca1\u6709\u5143\u7d20\u53ef\u4ee5\u4ece\u7ed9\u5b9a\u7684\u5217\u8868\u4e2d\u5f39\u51fa\u65f6\uff0c\u4f1a\u963b\u585e\u8fde\u63a5\u3002</p> </li> <li> <p><code>timeout</code> \u4e3a\u963b\u585e\u7b49\u5f85\u7684\u65f6\u95f4\uff0c0 \u8868\u793a\u4e00\u76f4\u7b49\u5f85\uff0c\u6b63\u6574\u6570\u8868\u793a\u7b49\u5f85\u7684\u79d2\u6570\u3002</p> </li> </ul>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_10","title":"\u96c6\u5408","text":"<p>Redis \u96c6\u5408\u4ee5\u65e0\u987b\u7684\u65b9\u5f0f\u6765\u5b58\u50a8\u591a\u4e2a\u5404\u4e0d\u76f8\u540c\u7684\u5143\u7d20\uff0c\u652f\u6301\u5feb\u901f\u7684\u5bf9\u96c6\u5408\u6267\u884c\u6dfb\u52a0\u5143\u7d20\u3001\u79fb\u9664\u5143\u7d20\u53ca\u68c0\u67e5\u5143\u7d20\u662f\u5426\u5728\u96c6\u5408\u4e2d\u3002</p>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_11","title":"\u96c6\u5408\u5e38\u7528\u547d\u4ee4","text":"<pre><code>SADD key item [item ...]\uff1a\u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u5143\u7d20\u6dfb\u52a0\u5230\u96c6\u5408\u4e2d\uff0c\u5e76\u8fd4\u56de\u88ab\u6dfb\u52a0\u5143\u7d20\u4e2d\u539f\u672c\u4e0d\u5b58\u5728\u4e8e\u96c6\u5408\u91cc\u9762\u7684\u6570\u91cf\u3002\n\nSREM key item [item ...]\uff1a\u4ece\u96c6\u5408\u91cc\u9762\u79fb\u9664\u4e00\u4e2a\u6216\u591a\u4e2a\u5143\u7d20\uff0c\u5e76\u8fd4\u56de\u88ab\u79fb\u9664\u5143\u7d20\u7684\u6570\u91cf\u3002\n\nSISMEMBER key item\uff1a\u68c0\u67e5\u5143\u7d20 item \u662f\u5426\u5b58\u5728\u4e8e\u96c6\u5408\u91cc\u9762\u3002\n\nSCARD key\uff1a\u8fd4\u56de\u96c6\u5408\u5305\u542b\u7684\u5143\u7d20\u6570\u91cf\n\nSMEMBERS key\uff1a\u8fd4\u56de\u96c6\u5408\u5305\u542b\u7684\u6240\u6709\u5143\u7d20\n\nSPOP key\uff1a\u968f\u673a\u7684\u79fb\u9664\u96c6\u5408\u4e2d\u7684\u5143\u7d20\uff0c\u5e76\u8fd4\u56de\u88ab\u79fb\u9664\u7684\u5143\u7d20\u3002\n\nSMOVE src-key dst-key item\uff1a\u5982\u679c\u96c6\u5408 sre-key \u5305\u542b\u5143\u7d20 item\uff0c\u90a3\u4e48\u4ece\u96c6\u5408 src-key \u91cc\u9762\u79fb\u9664 item\uff0c\u5e76\u5c06\u5143\u7d20 item \u6dfb\u52a0\u5230 dst-key \u4e2d\uff1b\u5982\u679c item \u88ab\u6210\u529f\u79fb\u9664\uff0c\u90a3\u4e48\u547d\u4ee4\u8fd4\u56de 1\uff0c\u5426\u5219\u8fd4\u56de 0\u3002 \n</code></pre>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_12","title":"\u96c6\u5408\u8fd0\u7b97\u547d\u4ee4","text":"<pre><code>SDIFF key [key ...]\uff1a\u8fd4\u56de\u5b58\u5728\u4e8e\u7b2c\u4e00\u4e2a\u96c6\u5408\u4f46\u4e0d\u5b58\u5728\u4e8e\u5176\u5b83\u96c6\u5408\u7684\u5143\u7d20\u3002\n\nSDIFFSTORE dst-key key [key ...]\uff1a\u5c06\u5b58\u5728\u4e8e\u7b2c\u4e00\u4e2a\u96c6\u5408\u4f46\u662f\u4e0d\u5b58\u5728\u4e8e\u5176\u5b83\u96c6\u5408\u7684\u5143\u7d20\uff0c\u5b58\u50a8\u5230\u96c6\u5408 dst-key\u3002 \n\nSINTER key [key ...]\uff1a\u8fd4\u56de\u540c\u65f6\u5b58\u5728\u4e8e\u6240\u6709\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u3002\n\nSINTERSTORE dst-key key [key ...]\uff1a\u5c06\u540c\u65f6\u5b58\u5728\u4e8e\u6240\u6709\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u5b58\u50a8\u5230 dst-key\u3002\n\nSUNION key [key ...]\uff1a\u8fd4\u56de\u6240\u6709\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u3002\n\nSUNIONSTORE dst-key key [key ...]\uff1a\u5c06\u6240\u6709\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u5b58\u50a8\u5230 dst-key\u3002\n</code></pre>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_13","title":"\u6563\u5217","text":"<p>Redis \u7684\u6563\u5217\u53ef\u4ee5\u5c06\u591a\u4e2a\u952e\u503c\u5bf9\u5b58\u50a8\u5230\u4e00\u4e2a Redis \u952e\u91cc\u9762\u3002</p>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_14","title":"\u6563\u5217\u5e38\u7528\u547d\u4ee4","text":"<pre><code>HSET key field valie [field valie ...]\uff1a\u8bbe\u7f6e\u6563\u5217\u91cc\u9762\u6307\u5b9a\u7684\u952e\u503c\u5bf9\uff0c\u5982\u679c\u952e\u5df2\u7ecf\u5728\u6563\u5217\u91cc\u9762\u5b58\u5728\u5219\u8986\u76d6\u503c\u3002\n\nHDEL key field [field ...]\uff1a\u5220\u9664\u6563\u5217\u91cc\u6307\u5b9a\u7684\u952e\u3002\n\nHEXISTS key field\uff1a\u5224\u65ad\u6563\u5217\u91cc\u9762\u662f\u5426\u5305\u542b\u6307\u5b9a\u7684\u952e\u3002\n\nHGET key field\uff1a\u83b7\u53d6\u6563\u5217\u91cc\u9762\u6307\u5b9a\u7684\u952e\u5bf9\u5e94\u7684\u503c\u3002\n\nHMGET key field [field ...]\uff1a\u4ece\u6563\u5217\u91cc\u9762\u83b7\u53d6\u4e00\u4e2a\u6216\u591a\u4e2a\u952e\u5bf9\u5e94\u7684\u503c.\n\nHGETALL key\uff1a\u83b7\u53d6\u6563\u5217\u91cc\u9762\u6240\u6709\u7684\u952e\u503c\u5bf9\u3002\n\nHKEYS key\uff1a\u83b7\u53d6\u6563\u5217\u91cc\u9762\u6240\u6709\u7684\u952e\u3002\n\nKVALS key\uff1a\u83b7\u53d6\u6563\u5217\u4fe9\u9762\u6240\u6709\u7684\u503c\u3002\n\nHLEN key\uff1a\u83b7\u53d6\u6563\u5217\u91cc\u9762\u5305\u542b\u952e\u7684\u6570\u91cf\u3002\n</code></pre>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_15","title":"\u6563\u5217\u66f4\u9ad8\u7ea7\u7684\u64cd\u4f5c\u547d\u4ee4","text":"<pre><code>HINCRBY key field increment\uff1a\u5c06\u6563\u5217\u91cc\u9762\u6307\u5b9a\u7684\u952e\u5bf9\u5e94\u7684\u503c\u52a0\u4e0a\u4e00\u4e2a\u6574\u6570\uff0c\u5982\u679c\u952e\u4e0d\u5b58\u5728\u5219\u521b\u5efa\u952e\uff0c\u503c\u9ed8\u8ba4\u4e3a 0\uff0c\u7136\u540e\u76f8\u52a0\u3002\n\nHINCRBYFLOAT key field increment\uff1a\u5c06\u6563\u5217\u91cc\u9762\u6307\u7684\u952e\u5bf9\u5e94\u7684\u503c\u52a0\u4e0a\u4e00\u4e2a\u6d6e\u70b9\u6570\u3002\n</code></pre>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_16","title":"\u6709\u5e8f\u96c6\u5408","text":"<p>\u548c\u6563\u5217\u5b58\u50a8\u7740\u952e\u503c\u4e4b\u95f4\u7684\u6620\u5c04\u7c7b\u4f3c\uff0c\u6709\u5e8f\u96c6\u5408\u4e5f\u5b58\u50a8\u7740\u6210\u5458\u4e0e\u5206\u503c\u4e4b\u95f4\u7684\u6620\u5c04\uff0c\u5e76\u63d0\u4f9b\u4e86\u5206\u503c\u5904\u7406\u547d\u4ee4\uff0c\u4ee5\u53ca\u6839\u636e\u5206\u503c\u5927\u5c0f\u6709\u5e8f\u5730\u83b7\u53d6\u6216\u626b\u63cf\u6210\u5458\u548c\u5206\u503c\u7684\u547d\u4ee4\u3002</p> <p>\u5728\u6709\u5e8f\u96c6\u5408\u4e2d\u6709\u4e09\u4e2a\u6982\u5ff5\uff0c\u5143\u7d20\u3001\u5206\u503c\u548c\u6392\u540d\u3002\u7c7b\u4f3c\u8003\u8bd5\u7684\u6210\u7ee9\u5355\uff0c\u6210\u7ee9\u5355\u7684\u59d3\u540d\u5bf9\u5e94\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u5143\u7d20\uff0c\u6210\u7ee9\u5355\u7684\u6210\u7ee9\u5bf9\u5e94\u6709\u5e8f\u96c6\u5408\u5143\u7d20\u7684\u5206\u503c\uff0c\u6210\u7ee9\u5355\u7684\u6392\u540d\u5bf9\u5e94\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u6392\u540d\u3002</p> <p>\u6709\u5e8f\u96c6\u5408 <code>ZADD</code> \u7528\u547d\u4ee4\uff1a <pre><code>ZADD key [NX | XX] score member [score member ...]\n</code></pre></p> <ul> <li> <p>\u6dfb\u52a0\u6307\u5b9a\u7684\u4e00\u4e2a\u6216\u591a\u4e2a member \u548c score \u5230\u6709\u5e8f\u96c6\u5408\u4e2d\u3002\u4e0d\u52a0\u9009\u9879\uff0c\u5982\u679c member \u5df2\u7ecf\u5b58\u5728\u4e0e\u96c6\u5408\u4e2d\uff0c\u5219\u66f4\u65b0 score \u5e76\u91cd\u65b0\u63d2\u5165 member \u4f7f\u6392\u5e8f\u6b63\u786e\u3002</p> </li> <li> <p><code>NX</code> \u4ec5\u5f53 member \u4e0d\u5b58\u5728\u65f6\u65b0\u589e\u3002\u5982\u679c member \u5df2\u7ecf\u5b58\u5728\u65e0\u64cd\u4f5c\u3002</p> </li> <li> <p><code>XX</code> \u4ec5\u5f53 member \u5b58\u5728\u65f6\u66f4\u65b0 score\u3002\u5982\u679c member \u4e0d\u5b58\u5728\u5219\u65e0\u64cd\u4f5c\u3002</p> </li> </ul>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_17","title":"\u6709\u5e8f\u96c6\u5408\u5e38\u7528\u547d\u4ee4","text":"<pre><code>ZREM key member [member ...]\uff1a\u4ece\u6709\u5e8f\u96c6\u5408\u4e2d\u5220\u9664\u7ed9\u5b9a\u7684\u6210\u5458\uff0c\u5e76\u8fd4\u56de\u88ab\u79fb\u9664\u6210\u5458\u7684\u6570\u91cf\u3002\n\nZCARD key\uff1a\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u5305\u542b\u7684\u6210\u5458\u6570\u91cf\u3002\n\nZINCRBY key increment member\uff1a\u5c06\u6709\u5e8f\u96c6\u5408\u4e2d member \u6210\u5458\u7684\u5206\u503c\u52a0\u4e0a increment\u3002\n\nZSOCRE key member\uff1a\u8fd4\u56de\u6210\u5458 member \u7684\u5206\u503c\u3002\n</code></pre>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_18","title":"\u6709\u5e8f\u96c6\u5408\u901a\u8fc7\u5206\u503c\u64cd\u4f5c\u7684\u547d\u4ee4","text":"<pre><code>ZCOUNT key min max\uff1a\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u5206\u503c\u4ecb\u4e8e min \u548c max \u4e4b\u95f4\u7684\u6210\u5458\u6570\u91cf\u3002\n\nZRANGEBYSCORE key min max [WITHSCORES] [LIMIT\u00a0offset count]\uff1a\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u5206\u503c\u4ecb\u4e8e min \u548c max \u4e4b\u95f4\u7684\u6240\u6709\u5143\u7d20\u3002\u5982\u679c\u6307\u5b9a\u4e86 WITHSCORES \u9009\u9879\uff0c\u90a3\u4e48\u6210\u5458\u7684\u5206\u503c\u4e5f\u4e00\u8d77\u8fd4\u56de\u3002\n\nZREVRANGEBYSCORE key min max [WITHSCORES] [LIMIT\u00a0offset count]\uff1a\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u5206\u503c\u4ecb\u4e8e min \u548c max \u4e4b\u95f4\u7684\u6240\u6709\u5143\u7d20\uff0c\u5e76\u6309\u7167\u5206\u503c\u4ece\u5927\u5230\u5c0f\u7684\u987a\u5e8f\u8fd4\u56de\u3002\u5982\u679c\u6307\u5b9a\u4e86 WITHSCORES \u9009\u9879\uff0c\u90a3\u4e48\u6210\u5458\u7684\u5206\u503c\u4e5f\u4e00\u8d77\u8fd4\u56de\u3002\n\nZRANGESTORE dst src min max [BYSCORE | BYLEX] [REV] [LIMIT\u00a0offset count]\uff1a\n\nZREMRANGEBYSCORE key min max\uff1a\u79fb\u9664\u96c6\u5408\u4e2d\u5206\u503c\u4ecb\u4e8e min \u548c max \u4e4b\u95f4\u7684\u6240\u6709\u6210\u5458\u3002\n</code></pre>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_19","title":"\u6709\u5e8f\u96c6\u5408\u901a\u8fc7\u6392\u540d\u64cd\u4f5c\u7684\u547d\u4ee4","text":"<pre><code>ZRANK key member\uff1a\u8fd4\u56de\u6210\u5458 member \u5728\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u6392\u540d\uff0c\u6309\u7167\u5206\u503c\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u6392\u540d\u4ece 0 \u5f00\u59cb\u3002\u6ce8\u610f\u8fd4\u56de\u7684\u662f\u7b2c\u51e0\u540d\uff0c\u4e0d\u662f\u5206\u503c\u3002\u5982\u679c\u5206\u503c\u76f8\u7b49\uff0c\u5219\u5148\u63d2\u5165\u7684\u6570\u636e\u6392\u540d\u6570\u503c\u8f83\u5c0f\u3002\n\nZREVRANK key member\uff1a\u8fd4\u56de\u6210\u5458 member \u5728\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u6392\u540d\uff0c\u6309\u7167\u5206\u503c\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff0c\u6392\u540d\u4ece 0 \u5f00\u59cb\u3002\u6ce8\u610f\u8fd4\u56de\u7684\u662f\u7b2c\u51e0\u540d\uff0c\u4e0d\u662f\u5206\u503c\u3002\u5982\u679c\u5206\u503c\u76f8\u7b49\uff0c\u5219\u540e\u63d2\u5165\u7684\u6570\u636e\u6392\u540d\u6570\u503c\u8f83\u5c0f\u3002\n\nZRANGE key start stop [WITHSCORES]\uff1a\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u6392\u540d\u4ecb\u4e8e start \u548c stop \u4e4b\u95f4\u7684\u6210\u5458\uff0c\u6309\u7167\u5206\u503c\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u6392\u540d\u4ece 0 \u5f00\u59cb\u3002\u5982\u679c\u6307\u5b9a\u4e86 WITHSCORES \u9009\u9879\uff0c\u90a3\u4e48\u6210\u5458\u7684\u5206\u503c\u4e5f\u4e00\u8d77\u8fd4\u56de\u3002\n\nZREVRANGE key start stop [WITHSCORES]\uff1a\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u6392\u540d\u4ecb\u4e8e start \u548c stop \u4e4b\u95f4\u7684\u6210\u5458\uff0c\u6309\u7167\u5206\u503c\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff0c\u6392\u540d\u4ece 0 \u5f00\u59cb\u3002\u5982\u679c\u6307\u5b9a\u4e86 WITHSCORES \u9009\u9879\uff0c\u90a3\u4e48\u6210\u5458\u7684\u5206\u503c\u4e5f\u4e00\u8d77\u8fd4\u56de\u3002\n\nZREMRANGEBYRANK key start stop\uff1a\u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u6392\u540d\u4ecb\u4e8e start \u548c stop \u4e4b\u95f4\u7684\u6240\u6709\u6210\u5458\u3002\n</code></pre>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_20","title":"\u6709\u5e8f\u96c6\u5408\u5e76\u96c6\u64cd\u4f5c","text":"<p>\u6709\u5e8f\u96c6\u5408\u7684\u5e76\u96c6\uff0c\u5e76\u5c06\u7ed3\u679c\u5b58\u50a8\u5230\u4e00\u4e2a\u6709\u5e8f\u96c6\u5408\u4e2d\u3002 <pre><code>ZUNIONSTORE destination numkeys key [key ...] [WEIGHTS\u00a0weight [weight ...]] [AGGREGATE\u00a0&lt;SUM | MIN | MAX&gt;]\n</code></pre></p> <ul> <li> <p>\u8ba1\u7b97\u7ed9\u5b9a\u6709\u5e8f\u7ed3\u5408\u7684\u5e76\u96c6\uff0c\u5e76\u5c06\u7ed3\u679c\u5b58\u50a8\u5230\u6307\u5b9a\u7684\u6709\u5e8f\u96c6\u5408 destination \u4e2d\u3002\u9700\u8981\u660e\u786e\u7ed9\u51fa\u6307\u5b9a\u6709\u5e8f\u96c6\u5408\u7684\u6570\u91cf\u3002</p> </li> <li> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5143\u7d20\u7684\u7ed3\u679c\u5206\u6570\u662f\u5404\u4e2a\u6709\u5e8f\u96c6\u5408\u4e2d\u5206\u6570\u7684\u548c\u3002</p> </li> <li> <p>\u4f7f\u7528 <code>WEIGHTS</code> \u9009\u9879\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u8f93\u5165\u7684\u6709\u5e8f\u96c6\u5408\u6307\u5b9a\u4e58\u6cd5\u56e0\u5b50\uff0c\u6bcf\u4e2a\u5143\u7d20\u7684\u5206\u503c\u5728\u4f20\u9012\u7ed9\u805a\u5408\u51fd\u6570\u4e4b\u524d\u90fd\u4e58\u4ee5\u6307\u5b9a\u7684\u56e0\u5b50\uff0c\u9ed8\u8ba4\u503c\u4e3a 1\u3002</p> </li> <li> <p><code>AGGEGATE</code> \u9009\u9879\u53ef\u4ee5\u6307\u5b9a\u5982\u4f55\u805a\u5408\u5e76\u96c6\u7ed3\u679c\u7684\u5206\u6570\uff0c\u9ed8\u8ba4\u4e3a <code>SUM</code>\u3002\u5f53\u6307\u5b9a\u4e3a <code>MIN</code> \u6216 <code>MAX</code> \u662f\uff0c\u751f\u6210\u7684\u96c6\u5408\u5c06\u88ab\u5305\u542b\u5143\u7d20\u5728\u8f93\u5165\u4e2d\u5b58\u5728\u7684\u6700\u5c0f\u6216\u6700\u5927\u503c\u3002</p> </li> </ul> <p>\u7c7b\u4f3c <code>ZUNIONSTORE</code> \u547d\u4ee4\uff0c\u53ea\u662f <code>ZUNION</code> \u5c06\u5e76\u96c6\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002 <pre><code>ZUNION numkeys key [key ...] [WEIGHTS\u00a0weight [weight ...]] [AGGREGATE\u00a0&lt;SUM | MIN | MAX&gt;] [WITHSCORES]\n</code></pre></p>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_21","title":"\u6709\u5e8f\u96c6\u5408\u4ea4\u96c6\u64cd\u4f5c","text":"<p>\u6709\u5e8f\u96c6\u5408\u7684\u4ea4\u96c6\uff0c\u5e76\u5c06\u7ed3\u679c\u5b58\u50a8\u5230\u4e00\u4e2a\u6709\u5e8f\u96c6\u5408\u4e2d\u3002 <pre><code>ZINTERSTORE destination numkeys key [key ...] [WEIGHTS\u00a0weight [weight ...]] [AGGREGATE\u00a0&lt;SUM | MIN | MAX&gt;]\n</code></pre></p> <ul> <li> <p>\u8ba1\u7b97\u7ed9\u5b9a\u6709\u5e8f\u7ed3\u5408\u7684\u4ea4\u96c6\uff0c\u5e76\u5c06\u7ed3\u679c\u5b58\u50a8\u5230\u6307\u5b9a\u7684\u6709\u5e8f\u96c6\u5408 destination \u4e2d\u3002\u9700\u8981\u660e\u786e\u7ed9\u51fa\u6307\u5b9a\u6709\u5e8f\u96c6\u5408\u7684\u6570\u91cf\u3002</p> </li> <li> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5143\u7d20\u7684\u7ed3\u679c\u5206\u6570\u662f\u5404\u4e2a\u6709\u5e8f\u96c6\u5408\u4e2d\u5206\u6570\u7684\u548c\u3002</p> </li> <li> <p>\u4f7f\u7528 <code>WEIGHTS</code> \u9009\u9879\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u8f93\u5165\u7684\u6709\u5e8f\u96c6\u5408\u6307\u5b9a\u4e58\u6cd5\u56e0\u5b50\uff0c\u6bcf\u4e2a\u5143\u7d20\u7684\u5206\u503c\u5728\u4f20\u9012\u7ed9\u805a\u5408\u51fd\u6570\u4e4b\u524d\u90fd\u4e58\u4ee5\u6307\u5b9a\u7684\u56e0\u5b50\uff0c\u9ed8\u8ba4\u503c\u4e3a 1\u3002</p> </li> <li> <p><code>AGGEGATE</code> \u9009\u9879\u53ef\u4ee5\u6307\u5b9a\u5982\u4f55\u805a\u5408\u5e76\u96c6\u7ed3\u679c\u7684\u5206\u6570\uff0c\u9ed8\u8ba4\u4e3a <code>SUM</code>\u3002\u5f53\u6307\u5b9a\u4e3a <code>MIN</code> \u6216 <code>MAX</code> \u662f\uff0c\u751f\u6210\u7684\u96c6\u5408\u5c06\u88ab\u5305\u542b\u5143\u7d20\u5728\u8f93\u5165\u4e2d\u5b58\u5728\u7684\u6700\u5c0f\u6216\u6700\u5927\u503c\u3002</p> </li> </ul> <p>\u7c7b\u4f3c ZINTERSTORE \u547d\u4ee4\uff0c\u53ea\u662f <code>ZINTER</code> \u5c06\u4ea4\u96c6\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002 <pre><code>ZINTER numkeys key [key ...] [WEIGHTS\u00a0weight [weight ...]] [AGGREGATE\u00a0&lt;SUM | MIN | MAX&gt;] [WITHSCORES]\n</code></pre></p>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_22","title":"\u6709\u5e8f\u96c6\u5408\u7684\u5dee\u96c6\u64cd\u4f5c","text":"<pre><code>ZDIFFSTORE destination numkeys key [key ...]\uff1a\u5c06\u5b58\u5728\u4e8e\u7b2c\u4e00\u4e2a\u6709\u5e8f\u96c6\u5408\u4f46\u662f\u4e0d\u5b58\u5728\u4e8e\u5176\u5b83\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u5b58\u50a8\u5230 destination \u6709\u7ed3\u5408\u4e2d\u3002\n\nZDIFF numkeys key [key ...] [WITHSCORES]\uff1a\u5c06\u5b58\u5728\u4e8e\u7b2c\u4e00\u4e2a\u6709\u5e8f\u96c6\u5408\u4f46\u662f\u4e0d\u5b58\u5728\u4e8e\u5176\u5b83\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\n</code></pre>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_23","title":"\u5730\u7406\u5750\u6807\u7d22\u5f15","text":"<p>\u7528\u6765\u5b58\u50a8\u5143\u7d20\u7684\u5730\u7406\u5750\u6807\uff0c\u5e76\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5750\u6807\u8ba1\u7b97\u7684\u51fd\u6570\u3002</p> <p>\u5b9e\u9645\u4e0a Geo Index \u7684\u6570\u636e\u7ed3\u6784\u5c31\u662f\u4e00\u4e2a\u6709\u5e8f\u96c6\u5408\uff0cRedis \u4f1a\u5c06\u4f20\u5165\u7684\u7ecf\u7eac\u5ea6\u8f6c\u6362\u6210 Geohash \u4f5c\u4e3a\u5206\u503c\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528\u6709\u5e8f\u96c6\u5408\u7684\u4e00\u4e9b\u547d\u4ee4\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>Resdis \u7684 Geohash \u91c7\u7528 52 \u6bd4\u7279\u7684\u7cbe\u5ea6\uff0c\u80fd\u7cbe\u786e\u5230\u7c73\u7ea7\u3002</p>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_24","title":"\u5730\u7406\u5750\u6807\u5e38\u7528\u547d\u4ee4","text":"<pre><code>GEOADD key [NX | XX] longitude latitude member [longitude latitude member ...]\uff1a\u6dfb\u52a0\u5143\u7d20\u5750\u6807\nZREM key member [member ...]\uff1a\u4ece\u6709\u5e8f\u96c6\u5408\u4e2d\u5220\u9664\u7ed9\u5b9a\u7684\u6210\u5458\uff0c\u5e76\u8fd4\u56de\u88ab\u79fb\u9664\u6210\u5458\u7684\u6570\u91cf\u3002\nGEODIST key member1 member2 [m | km | ft | mi]\uff1a\u83b7\u53d6\u4e24\u4e2a\u5143\u7d20\u4e4b\u95f4\u7684\u8ddd\u79bb\nGEOPOS key [member [member ...]]\uff1a\u83b7\u53d6\u5143\u7d20\u7684\u5750\u6807\nGEOHASH key [member [member ...]]\uff1a\u83b7\u53d6\u5143\u7d20\u7684 Geohash\n</code></pre> <p>Redisson \u4ee3\u7801\u793a\u4f8b\u83b7\u53d6\u5317\u4eac\u5230\u4e0a\u6d77\u7684\u8ddd\u79bb\uff1a <pre><code>RGeo&lt;String&gt; geo = client.getGeo(\"test\");  \ngeo.add(new GeoEntry(116.731059,39.91088, \"beijing\"),  \n        new GeoEntry(121.480324,31.236485, \"shanghai\"));  \n\nDouble dist = geo.dist(\"beijing\", \"shanghai\", GeoUnit.KILOMETERS);  \nSystem.out.println(\"beijing to shanghai: \" + dist + \"km\");    // beijing to shanghai: 1055.7237km\n</code></pre></p>"},{"location":"DataBase/Redis/Redis%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_25","title":"\u641c\u7d22\u9644\u8fd1\u7684\u5143\u7d20","text":"<pre><code>GEOSEARCH key &lt;FROMMEMBER\u00a0member | FROMLONLAT\u00a0longitude latitude&gt;\n  &lt;BYRADIUS\u00a0radius &lt;m | km | ft | mi&gt; | BYBOX\u00a0width height &lt;m | km |ft | mi&gt;&gt; \n  [ASC | DESC] [COUNT\u00a0count [ANY]] [WITHCOORD] [WITHDIST] [WITHHASH]\n</code></pre> <ul> <li> <p><code>ASC</code> \u6309\u7167\u8ddd\u79bb\u4e2d\u5fc3\u70b9\u4f4d\u7531\u8fd1\u53ca\u8fdc\u6392\u5e8f\u3002</p> </li> <li> <p><code>DESC</code> \u6309\u7167\u8ddd\u79bb\u4e2d\u5fc3\u70b9\u7531\u8fdc\u53ca\u8fd1\u6392\u5e8f\u3002</p> </li> <li> <p><code>WITHCOORD</code> \u540c\u65f6\u8fd4\u5339\u914d\u5143\u7d20\u7684\u56de\u7ecf\u7eac\u5ea6\u3002</p> </li> <li> <p><code>WITHDIST</code> \u540c\u65f6\u8fd4\u56de\u8ddd\u79bb\uff0c\u5355\u4f4d\u4e0e\u67e5\u8be2\u65f6\u6307\u5b9a\u7684\u534a\u5f84\u6216\u8005\u5bbd\u9ad8\u76f8\u540c\u3002</p> </li> <li> <p><code>WITHHASH</code> \u540c\u65f6\u8fd4\u56de\u5143\u7d20\u7684 Geohash\u3002</p> </li> </ul> <p>Geohash \u7684\u4f5c\u7528 \u5982\u679c\u8981\u6c42\u8ba1\u7b97\u8ddd\u79bb\u67d0\u4e2a\u70b9\u6700\u8fd1\u7684 10 \u4e2a\u70b9\u7684\u65f6\u5019\uff0c\u8981\u4e0e\u6570\u636e\u5e93\u4e2d\u6240\u6709\u7684\u6570\u636e\u90fd\u53bb\u8ba1\u7b97\u4e00\u4e0b\u8ddd\u79bb\u7136\u540e\u518d\u83b7\u53d6\u6700\u8fd1\u7684 10 \u4e2a\uff0c\u8fd9\u79cd\u505a\u6cd5\u592a\u4e0d\u660e\u667a\u4e86\u3002</p> <p>\u90a3\u4e48\uff0c\u53ef\u4ee5\u6839\u636e\u7ecf\u5ea6\u6216\u8005\u7ef4\u5ea6\u7684\u76f8\u4f3c\u6027\u5148\u8fc7\u6ee4\u6389\u5927\u90e8\u5206\u70b9\u3002\u7ecf\u5ea6\u76f8\u8fd1\uff0c\u7eac\u5ea6\u53ef\u80fd\u5dee\u5f88\u8fdc\uff0c\u6216\u8005\u53cd\u8fc7\u6765\u7eac\u5ea6\u76f8\u8fd1\u7ecf\u5ea6\u5dee\u5f88\u8fdc\uff0c\u90fd\u4e0d\u592a\u597d\u8fc7\u6ee4\u3002\u4f7f\u7528 Geohash \u5c31\u662f\u5c06\u7ecf\u5ea6\u548c\u7ef4\u5ea6\u5f52\u7eb3\u8fd1\u4e00\u4e2a\u5b57\u6bb5\uff0c\u6bd4\u8f83\u4e00\u4e2a\u5b57\u6bb5\u7684\u76f8\u4f3c\u6027\u5c31\u80fd\u786e\u7acb\u4e24\u4e2a\u70b9\u4f4d\u7684\u5927\u81f4\u8ddd\u79bb\uff0c\u8fc7\u6ee4\u6389\u5927\u90e8\u5206\u70b9\u3002\u7136\u540e\u518d\u6839\u636e\u7cbe\u786e\u7684\u5750\u6807\u7b97\u51fa\u7cbe\u786e\u8ddd\u79bb\u3002</p>"},{"location":"DataBase/Redis/Reids%20Tips/","title":"Reids Tips","text":""},{"location":"DataBase/Redis/Reids%20Tips/#key","title":"\u6e05\u7a7a\u6240\u6709\u7684 Key","text":"<pre><code># \u6e05\u7a7a\u5f53\u524d\u5e93\nflushdb\n\n# \u6e05\u7a7a\u6240\u6709\u5e93\nflushall\n</code></pre>"},{"location":"English/Daily%20life%20sentences/","title":"Daily life sentences","text":"<p>Translate what i say.  \u7ffb\u8bd1\u6211\u8bf4\u7684\u8bdd\u3002</p> <p>What did you eat for lunch?  \u4f60\u4e2d\u5348\u5403\u7684\u4ec0\u4e48\uff1f</p> <p>What are yout planning to eat for lunch today? \u4f60\u4e2d\u5348\u6253\u7b97\u5403\u4ec0\u4e48\uff1f</p>"},{"location":"English/Last%2C%20the%20last%2C%20the%20latest/","title":"Last, the last, the latest","text":""},{"location":"English/Last%2C%20the%20last%2C%20the%20latest/#last","title":"Last","text":"<p>When we say last week, last month or last year we are speaking about the week, month or year immediately before the current one. \u5f53\u6211\u4eec\u4f7f\u7528 last week\uff0clast month \u6216\u8005 last year \u7684\u65f6\u5019\uff0c\u6307\u7684\u662f\u5f53\u524d\u5468\uff0c\u6708\u6216\u5e74\u7684\u524d\u4e00\u4e2a\u5468\uff0c\u6708\u6216\u5e74\u3002</p> <p>Let's say it's now Augest 2017. Therefore, last month was July and last year was 2016. \u5982\u679c\u8bf4\u73b0\u5728\u662f 2017 \u5e74 8 \u6708\u4efd\uff0c\u90a3\u4e48 last month \u662f\u6307 7 \u6708\u4efd\uff0clast year \u662f\u6307 2016 \u5e74\u3002 <pre><code>- I saw Jack last week. He sends his regards.\n- \u6211\u4e0a\u5468\u770b\u5230\u4e86 Jack\uff0c\u4ed6\u81f4\u4ee5\u95ee\u5019\u3002\n\n- I turned forty last year. I had a big party with the whole family.\n- \u53bb\u5e74\u6211\u56db\u5341\u5c81\uff0c\u6211\u548c\u5bb6\u4eba\u5f00\u4e86\u4e00\u4e2a\u5927\u7684\u6d3e\u5bf9\u3002\n</code></pre></p>"},{"location":"English/Last%2C%20the%20last%2C%20the%20latest/#the-last","title":"The Last","text":"<p>We use the last week to talk about the period of seven days up to the monent of speaking. \u6211\u4eec\u4f7f\u7528 the last week \u6307\u7684\u662f\u76f4\u5230\u5f53\u524d\u65f6\u95f4\u4e3a\u6b62\u7684\u524d\u4e03\u5929\u65f6\u95f4\u3002</p> <p>Let's say today is Wednesday 9 August. The last week is therefore the period from Wednesday 2 August until today. \u5982\u679c\u8bf4\u4eca\u5929\u662f 8 \u6708 9 \u53f7\u5468\u4e09\uff0c\u90a3\u4e48 The last week \u6307\u7684\u662f 8 \u6708 2 \u53f7\u5468\u4e09\u5230\u4eca\u5929\u7684\u65f6\u95f4\u3002</p> <pre><code>- I've been ill for the last week.\n- I got ill seven days ago and I'm still ill.\n- \u8fc7\u53bb\u4e00\u5468\u751f\u75c5\u4e86\u3002\n</code></pre> <p>Likewise, we use the last month to talk about the period of thirty days up to the moment of speaking, and the last year to talk about a period of twelve months until now. \u540c\u6837\uff0cthe last month \u6307\u7684\u662f\u76f4\u5230\u5f53\u524d\u8fc7\u53bb\u7684 30 \u5929\uff0cthe last year \u6307\u7684\u662f\u76f4\u5230\u5f53\u524d\u8fc7\u53bb\u7684 12 \u4e2a\u6708\u3002</p> <pre><code>- I've been wokring in this country for the last year, and I like it very much. I plan to stay for another year.\n- \u6211\u5728\u8fd9\u4e2a\u56fd\u5bb6\u5de5\u4f5c\u4e86\u4e00\u5e74\uff0c\u6211\u975e\u5e38\u559c\u6b22\u8fd9\u91cc\u3002\u6211\u6253\u7b97\u518d\u4f4f\u4e00\u5e74\u3002\n\nWe can also say the last hour:\n- The shop hasn't had any customers in the last hour.\n\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 the last hour\uff1a\n- \u8fd9\u4e2a\u5546\u5e97\u5728\u8fc7\u53bb\u4e00\u4e2a\u5c0f\u65f6\u6ca1\u6709\u4efb\u4f55\u987e\u5ba2\u3002\n</code></pre> <p>last week PAST Mon Tues Wed Thurs Fri Sat Sun Mon Tues Wed Thurs NOW</p> <p>the last week PAST Mon Tues Wed Thurs Fri Sat Sun Mon Tues Wed Thurs NOW</p>"},{"location":"English/Last%2C%20the%20last%2C%20the%20latest/#the-last-three-the-last-few","title":"The last Three, the last few","text":"<p>We can say the last three, the last four, etc. We also say the last few: \u6211\u4eec\u53ef\u4ee5\u8bf4\u6700\u540e\u4e09\u4e2a\uff0c\u6700\u540e\u56db\u4e2a\uff0c\u7b49\u7b49\u3002\u6211\u4eec\u8fd8\u8bf4\u6700\u540e\u51e0\u4e2a\uff1a <pre><code>- They've been on holiday for the last two weeks, so I haven't seen my colleagues.\n- \u4ed6\u4eec\u8fc7\u53bb\u4e24\u5468\u4e00\u76f4\u5728\u5ea6\u5047\uff0c\u6240\u4ee5\u6211\u6ca1\u6709\u89c1\u5230\u6211\u7684\u540c\u4e8b\u3002\n\n- Sorry I didn't come to visit, I've been busy for the last few weeks.\n- \u5bf9\u4e0d\u8d77\uff0c\u6211\u6ca1\u6709\u6765\u62dc\u8bbf\uff0c\u8fc7\u53bb\u51e0\u5468\u6211\u4e00\u76f4\u5f88\u5fd9\u3002\n</code></pre></p> <p>The last can also mean the final. The last \u6709\u65f6\u4e5f\u53ef\u4ee5\u8868\u793a\u6700\u540e\u4e00\u4e2a\u3002</p> <p>I'm going to Spain in the last week of August. = the fourth week in August. \u6211\u5c06\u5728 8 \u6708\u7684\u6700\u540e\u4e00\u5468\u53bb\u897f\u73ed\u7259\u3002</p> <p>Chelsea lost the last match of the season. = the final match of the season. \u5207\u5c14\u897f\u8f93\u6389\u4e86\u672c\u8d5b\u5b63\u7684\u6700\u540e\u4e00\u573a\u6bd4\u8d5b\u3002</p>"},{"location":"English/Last%2C%20the%20last%2C%20the%20latest/#the-latest","title":"The latest","text":"<p>We use the latest, his latest, etc. to express that something is new or the most recent in a series: <pre><code>- Andy Taylor is the latest person to leave the company. That makes a total of six so far this year.\n- Andy Taylor \u662f\u6700\u65b0\u79bb\u5f00\u516c\u53f8\u7684\u4eba\uff0c\u4eca\u5e74\u5230\u76ee\u524d\u4e3a\u6b62\u603b\u5171\u6709 6 \u4e2a\u79bb\u5f00\u7684\u4e86\u3002\n\n- Have you heard Adele's latest song? It's great!\n  her latest song = her new song\n- \u4f60\u6709\u542c\u8fc7 Adele \u6700\u65b0\u7684\u6b4c\u66f2\u5417\uff0c\u975e\u5e38\u68d2\uff01\n</code></pre></p> <p>Be careful - don't confuse the latest and the last: <pre><code>- I like her latest song. It's much better than her last song.\n  her latest song = her new song\n  her last song = her previous song(the one before the new one)\n- \u6211\u559c\u6b22\u5979\u6700\u65b0\u7684\u6b4c\u66f2\uff0c\u6bd4\u4e0a\u4e00\u9996\u66f4\u597d\u3002\n</code></pre></p>"},{"location":"English/Timeline/","title":"Timeline","text":""},{"location":"English/Timeline/#_1","title":"\u611f\u609f","text":"<ol> <li> <p>\u65e0\u6b32\u901f\uff0c\u65e0\u89c1\u5c0f\u5229\u3002\u6b32\u901f\u5219\u4e0d\u8fbe\uff0c\u89c1\u5c0f\u5229\u5219\u5927\u4e8b\u4e0d\u6210\u3002\u8981\u52e4\u594b\uff0c\u575a\u6301\u4e0d\u61c8\u7684\u52aa\u529b\uff0c\u505a\u4e8b\u60c5\u5c31\u8981\u8fd9\u6837\uff0c\u4e0d\u8981\u7740\u6025\uff0c\u4e0d\u8981\u7126\u8651\uff0c\u4e00\u6b65\u4e00\u6b65\u6765\uff0c\u8d35\u5728\u575a\u6301\u3002</p> </li> <li> <p>\u6e29\u6545\u800c\u77e5\u65b0\uff0c\u53ef\u4ee5\u4e3a\u5e08\u77e3\u3002\u4e00\u672c\u597d\u4e66\u5e94\u8be5\u591a\u8bfb\u51e0\u904d\uff0c\u4e86\u89e3\u4e86\u540e\u9762\u7684\u5185\u5bb9\u540e\uff0c\u518d\u53bb\u8bfb\u524d\u9762\u7684\u90e8\u5206\u53ef\u4ee5\u6709\u4e0d\u540c\u7684\u89c6\u89d2\uff0c\u7406\u89e3\u4f5c\u8005\u4e3a\u4ec0\u4e48\u8fd9\u6837\u5199\u3002</p> </li> <li> <p>\u4e25\u4e8e\u5f8b\u5df1\uff0c\u5bbd\u4ee5\u5f85\u4eba\u3002</p> </li> <li> <p>\u751f\u6d3b\u4e3a\u4e86\u6709\u8da3\uff0c\u4ec0\u4e48\u90fd\u53ef\u4ee5\u6709\u8da3\uff0c\u629b\u53bb\u865a\u4f2a\u7684\u5916\u8863\uff0c\u8ba9\u6211\u4eec\u5766\u8bda\u7684\u9762\u5bf9\u3002\u4fdd\u6301\u4e50\u89c2\u6c89\u7a33\u7684\u5fc3\u6001\u3002</p> </li> <li> <p>\u6700\u8fd1\u4e00\u76f4\u6709\u4e2a\u89c2\u70b9\u5728\u8111\u6d77\u4e2d\uff1a\u6570\u636e\u7684\u4f20\u8f93\u3001\u5b58\u50a8\u3001\u8ba1\u7b97\u548c\u5c55\u793a\uff0c\u57fa\u672c\u4e0a\u5c31\u662f\u5f53\u524d\u8f6f\u4ef6\u5f00\u53d1\u524d\u540e\u7aef\u4eba\u5458\u6240\u505a\u7684\u4e8b\u60c5\uff0c\u60f3\u60f3\u81ea\u5df1\u5de5\u4f5c\u4e2d\u63a5\u89e6\u5230\u7684\u6240\u6709\u4e1c\u897f\u57fa\u672c\u90fd\u53ef\u4ee5\u5f52\u7c7b\u5230\u5176\u4e2d\u4e00\u73af\u3002\u4e0b\u9762\u662f\u5f15\u7528\u522b\u4eba\u7684\u5f52\u7eb3\uff1a <pre><code>\u8f6f\u4ef6\u7684\u672c\u8d28\u662f\u4fe1\u606f\u5904\u7406\uff0c\u4ee5\u53ca\u5bf9\u4fe1\u606f\u5904\u7406\u7684\u81ea\u52a8\u5316\u3002\u5728\u8f6f\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u6570\u636e\u662f\u4fe1\u606f\u7684\u8f7d\u4f53\uff0c\u662f\u5bf9\u5ba2\u89c2\u4e8b\u7269\u6240\u8574\u542b\u4fe1\u606f\u7684\u62bd\u8c61\u63cf\u8ff0\u3002\n\u8f6f\u4ef6\u5bf9\u6570\u636e\u7684\u5904\u7406\u5305\u62ec\uff1aDefine\uff08\u5b9a\u4e49\uff09\uff0cTransfer\uff08\u4f20\u9012\uff09\uff0cTransform\uff08\u8f6c\u6362\uff09\uff0cStore\uff08\u5b58\u50a8\uff09\uff0cRetirval\uff08\u68c0\u7d22\uff09\uff0cShow\uff08\u5c55\u793a\uff09\u3002\n\n\u5728\u8f6f\u4ef6\u5f00\u53d1\u4e2d\uff0c\u63a5\u89e6\u5230\u7684\u6240\u6709\u7cfb\u7edf\u3001\u8bed\u8a00\u3001\u7ec4\u4ef6\u3001\u6846\u67b6 \u2026 \u65e0\u4e00\u4e0d\u662f\u56f4\u7ed5\u7740\u8fd9\u4e9b\u8bdd\u9898\u5c55\u5f00\u7684\u3002\n</code></pre></p> </li> <li> <p>\u6392\u67e5\u95ee\u9898\u7684\u4e00\u822c\u601d\u8def\uff1a\u9996\u5148\u68b3\u7406\u7b80\u5355\u7684\u4e8b\u4ef6\u6d41\u7a0b\uff0c\u5927\u6982\u53ef\u4ee5\u5206\u4e3a\u51e0\u6b65\uff0c\u8981\u4e00\u6b65\u4e00\u6b65\u7684\u6821\u9a8c\u95ee\u9898\u51fa\u5728\u54ea\u4e2a\u8fc7\u7a0b\u4e0a\u3002\u5207\u5fcc\u4e00\u4e0a\u6765\u5c31\u50cf\u65e0\u5934\u82cd\u8747\u4e00\u6837\u624e\u8fdb\u53bb\uff0c\u4e00\u901a\u4e71\u6363\u9f13\uff0c\u6d6a\u8d39\u65f6\u95f4\u548c\u7cbe\u529b\u3002\u5148\u89c4\u5212\u60f3\u597d\uff0c\u505a\u597d\u524d\u671f\u51c6\u5907\u5de5\u4f5c\uff0c\u518d\u53bb\u505a\u3002</p> </li> <li> <p>\u5e72\u5927\u4e8b\u800c\u60dc\u8eab\uff0c\u89c1\u5c0f\u5229\u800c\u4ea1\u547d\uff1a\u975e\u82f1\u96c4\u4e5f\u3002\u51fa\u81ea\u300a\u4e09\u56fd\u6f14\u4e49\u00b7\u7b2c\u4e8c\u5341\u4e00\u56de\u2014\u2014\u66f9\u64cd\u716e\u9152\u8bba\u82f1\u96c4\u300b\uff0c\u66f9\u64cd\u5bf9\u8881\u7ecd\u7684\u8bc4\u4ef7\u3002\u543e\u7b49\u7686\u4e3a\u788c\u788c\u5c0f\u4eba\uff0c\u5954\u6ce2\u4e00\u751f\u3002</p> </li> <li> <p>\u4e4b\u524d\u770b\u5218\u6b22\u7684\u4e00\u6bb5\u91c7\u8bbf\uff0c\u4e3b\u6301\u4eba\u95ee\uff1a\u5bb6\u91cc\u7684\u5bb6\u52a1\u90fd\u662f\u8c01\u505a\uff1f\u8c01\u6709\u7a7a\u8c01\u5c31\u505a\uff0c\u8fd9\u4e8b\u4e5f\u633a\u7b80\u5355\uff0c\u5c31\u8fd9\u4e48\u5c0f\u4e00\u4e2a\u5bb6\uff0c\u597d\u50cf\u73b0\u5728\u4e5f\u6ca1\u4ec0\u4e48\u592a\u591a\u4e8b\u3002</p> </li> </ol>"},{"location":"English/Timeline/#_2","title":"\u597d\u73a9\u7684\u60f3\u6cd5","text":"<ol> <li>\u8f93\u5165\u4e00\u4e32\u6570\u5b57\uff0c\u67e5\u627e\u6570\u5b57\u5728 <code>\u03c0</code> \u4e2d\u51fa\u73b0\u7684\u4f4d\u6570\uff0c\u4ee5\u53ca\u51fa\u73b0\u4e86\u591a\u5c11\u6b21\u3002\u6d89\u53ca\u5230\u7684\u5185\u5bb9\uff1a\u5982\u4f55\u8ba1\u7b97 \u03c0 \u7684\u503c\u3001\u5b58\u50a8 \u03c0 \u7684\u503c\u3001\u5b57\u7b26\u4e32\u67e5\u627e\u7b97\u6cd5\u3001\u505a\u4e00\u4e2a\u7f51\u9875\u5c55\u793a\u3002<ul> <li>\u5df2\u7ecf\u6709\u7f51\u7ad9\u505a\u597d\u4e86\uff0c\u53c2\u8003\uff1ahttps://www.angio.net/pi/\u3002</li> </ul> </li> </ol>"},{"location":"English/Would%20%E5%92%8C%20Want/","title":"Would \u548c Want","text":"<p>Would \u548c Want \u90fd\u53ef\u4ee5\u8868\u793a\u613f\u671b\u6216\u8005\u610f\u56fe\u3002</p> <p>\u4e00\u822c\u60c5\u51b5\u4e0b Would \u8bed\u6c14\u8f83\u4e3a\u67d4\u548c\u5ba2\u6c14\uff0c\u8868\u8fbe\u5efa\u8bae\u3001\u9080\u8bf7\u548c\u8bf7\u6c42\u7b49\u3002Want \u8868\u793a\u76f4\u63a5\u7684\u613f\u671b\u6216\u9700\u6c42\u3002</p> <p>\u6211\u60f3\u8981\u4e00\u4e9b\u5496\u5561\u3002 - I would like some coffee. - I want some coffee.</p> <p>\u4f60\u60f3\u548c\u6211\u4eec\u4e00\u8d77\u5417\uff1f - Would you like join us? - Do you want to come with us?</p> <p>\u5982\u679c\u6211\u6709\u65f6\u95f4\uff0c\u6211\u4f1a\u53bb\u3002 I would go if i had time.</p> <p>\u6211\u60f3\u53bb\u516c\u56ed\u3002 I want go to the park.</p>"},{"location":"English/%E4%BE%A0%E5%AE%A2%E8%A1%8C-%E6%9D%8E%E7%99%BD/","title":"\u4fa0\u5ba2\u884c \u674e\u767d","text":"<p>\u8d75\u5ba2\u7f26\u80e1\u7f28\uff0c\u5434\u94a9\u971c\u96ea\u660e\u3002</p> <p>\u94f6\u978d\u7167\u767d\u9a6c\uff0c\u98d2\u6c93\u5982\u6d41\u661f\u3002</p> <p>\u5341\u6b65\u6740\u4e00\u4eba\uff0c\u5343\u91cc\u4e0d\u7559\u884c\u3002</p> <p>\u4e8b\u4e86\u62c2\u8863\u53bb\uff0c\u6df1\u85cf\u8eab\u4e0e\u540d\u3002</p> <p>\u95f2\u8fc7\u4fe1\u9675\u996e\uff0c\u8131\u5251\u819d\u524d\u6a2a\u3002</p> <p>\u5c06\u7099\uff08zh\u00ec\uff09\u5556\u6731\u4ea5(h\u00e0i)\uff0c\u6301\u89de\u529d\u4faf\u5b34(y\u0101ng)\u3002</p> <p>\u4e09\u676f\u5410\u7136\u8bfa\uff0c\u4e94\u5cb3\u5012\u4e3a\u8f7b\u3002</p> <p>\u773c\u82b1\u8033\u70ed\u540e\uff0c\u610f\u6c14\u7d20\u9713\u751f\u3002</p> <p>\u6551\u8d75\u6325\u91d1\u69cc\uff0c\u90af\u90f8\u5148\u9707\u60ca\u3002</p> <p>\u5343\u79cb\u4e8c\u58ee\u58eb\uff0c\u70dc\uff08xu\u01cen\uff09\u8d6b\u5927\u6881\u57ce\u3002</p> <p>\u7eb5\u6b7b\u4fa0\u9aa8\u9999\uff0c\u4e0d\u60ed\u4e16\u4e0a\u82f1\u3002</p> <p>\u8c01\u80fd\u4e66\u9601\u4e0b\uff0c\u767d\u9996\u592a\u7384\u7ecf\u3002</p>"},{"location":"English/%E5%A4%A7%E8%A7%82%E6%A5%BC%E9%95%BF%E8%81%94-%E5%AD%99%E9%AB%AF/","title":"\u5927\u89c2\u697c\u957f\u8054 \u5b59\u9aef","text":"<p>\u4e0a\u8054\uff1a\u4e94\u767e\u91cc\u6ec7\u6c60\u5954\u6765\u773c\u5e95\uff0c\u62ab\u895f\u5cb8\u5e3b\uff0c\u559c\u832b\u832b\u7a7a\u9614\u65e0\u8fb9\u3002\u770b\uff1a\u4e1c\u9aa7\u795e\u9a8f\uff0c\u897f\u7fe5\u7075\u4eea\uff0c\u5317\u8d70\u873f\u8712\uff0c\u5357\u7fd4\u7f1f\u7d20\u3002\u9ad8\u4eba\u97f5\u58eb\u4f55\u59a8\u9009\u80dc\u767b\u4e34\u3002\u8d81\u87f9\u5c7f\u87ba\u6d32\uff0c\u68b3\u88f9\u5c31\u98ce\u9b1f\u96fe\u9b13\uff1b\u66f4\u82f9\u5929\u82c7\u5730\uff0c\u70b9\u7f00\u4e9b\u7fe0\u7fbd\u4e39\u971e\uff0c\u83ab\u8f9c\u8d1f\uff1a\u56db\u56f4\u9999\u7a3b\uff0c\u4e07\u9877\u6674\u6c99\uff0c\u4e5d\u590f\u8299\u84c9\uff0c\u4e09\u6625\u6768\u67f3\u3002</p> <p>\u4e0b\u8054\uff1a\u6570\u5343\u5e74\u5f80\u4e8b\u6ce8\u5230\u5fc3\u5934\uff0c\u628a\u9152\u51cc\u865a\uff0c\u53f9\u6eda\u6eda\u82f1\u96c4\u8c01\u5728\uff1f\u60f3\uff1a\u6c49\u4e60\u697c\u8239\uff0c\u5510\u6807\u94c1\u67f1\uff0c\u5b8b\u6325\u7389\u65a7\uff0c\u5143\u8de8\u9769\u56ca\u3002\u4f1f\u70c8\u4e30\u529f\u8d39\u5c3d\u79fb\u5c71\u5fc3\u529b\u3002\u5c3d\u73e0\u5e18\u753b\u680b\uff0c\u5377\u4e0d\u53ca\u66ae\u96e8\u671d\u4e91\uff1b\u4fbf\u65ad\u78a3\u6b8b\u7891\uff0c\u90fd\u4ed8\u4e0e\u82cd\u70df\u843d\u7167\u3002\u53ea\u8d62\u5f97\uff1a\u51e0\u6775\u758f\u949f\uff0c\u534a\u6c5f\u6e14\u706b\uff0c\u4e24\u884c\u79cb\u96c1\uff0c\u4e00\u6795\u6e05\u971c\u3002</p>"},{"location":"English/%E6%A1%83%E8%8A%B1%E5%BA%B5%E6%AD%8C-%E5%94%90%E5%AF%85/","title":"\u6843\u82b1\u5eb5\u6b4c \u5510\u5bc5","text":"<p>\u6843\u82b1\u575e\u91cc\u6843\u82b1\u5eb5\uff0c\u6843\u82b1\u5eb5\u91cc\u6843\u82b1\u4ed9\u3002\u6843\u82b1\u4ed9\u4eba\u79cd\u6843\u6811\uff0c\u53c8\u6458\u6843\u82b1\u5356\u9152\u94b1\u3002</p> <p>\u9152\u9192\u53ea\u5728\u82b1\u524d\u5750\uff0c\u9152\u9189\u8fd8\u6765\u82b1\u4e0b\u7720\u3002\u534a\u9192\u534a\u9189\u65e5\u590d\u65e5\uff0c\u82b1\u843d\u82b1\u5f00\u5e74\u590d\u5e74\u3002</p> <p>\u4f46\u613f\u8001\u6b7b\u82b1\u9152\u95f4\uff0c\u4e0d\u613f\u97a0\u8eac\u8f66\u9a6c\u524d\u3002\u8f66\u5c18\u9a6c\u8db3\u5bcc\u8005\u8da3\uff0c\u9152\u76cf\u82b1\u679d\u8d2b\u8005\u7f18\u3002</p> <p>\u82e5\u5c06\u5bcc\u8d35\u6bd4\u8d2b\u8d31\uff0c\u4e00\u5728\u5e73\u5730\u4e00\u5728\u5929\u3002\u82e5\u5c06\u8d2b\u8d31\u6bd4\u8f66\u9a6c\uff0c\u4ed6\u5f97\u9a71\u9a70\u6211\u5f97\u95f2\u3002</p> <p>\u522b\u4eba\u7b11\u6211\u592a\u75af\u766b\uff0c\u6211\u7b11\u4ed6\u4eba\u770b\u4e0d\u7a7f\u3002\u4e0d\u89c1\u4e94\u9675\u8c6a\u6770\u5893\uff0c\u65e0\u82b1\u65e0\u9152\u9504\u4f5c\u7530\u3002</p>"},{"location":"English/%E6%BB%A1%E6%B1%9F%E7%BA%A2-%E5%B2%B3%E9%A3%9E/","title":"\u6ee1\u6c5f\u7ea2 \u5cb3\u98de","text":"<p>\u6012\u53d1\u51b2\u51a0\uff0c\u51ed\u680f\u5904\u3001\u6f47\u6f47\u96e8\u6b47\u3002\u62ac\u671b\u773c\uff0c\u4ef0\u5929\u957f\u5578\uff0c\u58ee\u6000\u6fc0\u70c8\u3002\u4e09\u5341\u529f\u540d\u5c18\u4e0e\u571f\uff0c\u516b\u5343\u91cc\u8def\u4e91\u548c\u6708\u3002\u83ab\u7b49\u95f2\uff0c\u767d\u4e86\u5c11\u5e74\u5934\uff0c\u7a7a\u60b2\u5207\uff01(\u680f \u901a\uff1a\u9611)</p> <p>\u9756\u5eb7\u803b\uff0c\u72b9\u672a\u96ea\u3002\u81e3\u5b50\u6068\uff0c\u4f55\u65f6\u706d\uff01\u9a7e\u957f\u8f66\uff0c\u8e0f\u7834\u8d3a\u5170\u5c71\u7f3a\u3002\u58ee\u5fd7\u9965\u9910\u80e1\u864f\u8089\uff0c\u7b11\u8c08\u6e34\u996e\u5308\u5974\u8840\u3002\u5f85\u4ece\u5934\u3001\u6536\u62fe\u65e7\u5c71\u6cb3\uff0c\u671d\u5929\u9619\u3002(\u58ee\u5fd7 \u4e00\u4f5c\uff1a\u58ee\u58eb\uff1b\u5c71\u7f3a \u4e00\u4f5c\uff1a\u5c71\u9619)</p>"},{"location":"Java/GeoJSON%20%E5%92%8C%20WKT/","title":"GeoJSON \u548c WKT","text":"<p>\u90fd\u662f\u5730\u7406\u7a7a\u95f4\u6570\u636e\u683c\u5f0f\uff0c\u7528\u6765\u8868\u793a\u5730\u7406\u8981\u7d20\u3002</p> <p>GeoJSON \u662f\u57fa\u4e8e JSON \u7684\u5730\u7406\u7a7a\u95f4\u6570\u636e\u683c\u5f0f\u3002\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a - \u652f\u6301\u591a\u79cd\u51e0\u4f55\u7c7b\u578b\u3002 - \u53ef\u4ee5\u5305\u542b\u5c5e\u6027\u6570\u636e\uff0c\u7528\u4e8e\u63cf\u8ff0\u5730\u7406\u8981\u7d20\u7684\u7279\u5f81\u3002</p> <p>\u793a\u4f8b\uff0c\u5728\u7ebf\u9884\u89c8\u7f51\u7ad9 https://geojson.io/ \uff1a <pre><code>{\n  \"type\": \"Feature\",\n  \"geometry\": {\n    \"type\": \"Point\",\n    \"coordinates\": [102.0, 0.5]\n  },\n  \"properties\": {\n    \"name\": \"Example Point\"\n  }\n}\n</code></pre></p> <p>WKT \u662f\u4e00\u79cd\u6587\u672c\u683c\u5f0f\uff0c\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a - \u7b80\u5355\u660e\u4e86\uff0c\u4ec5\u5305\u542b\u51e0\u4f55\u4fe1\u606f\uff0c\u4e0d\u5305\u542b\u5c5e\u6027\u6570\u636e\u3002</p> <p>\u793a\u4f8b\uff0c\u5728\u7ebf\u9884\u89c8\u7f51\u7ad9 https://wktmap.com/ \uff1a <pre><code>POLYGON ((-64.8 32.3, -65.5 18.3, -80.3 25.2, -64.8 32.3))\n</code></pre></p> <p>\u5bf9\u6bd4\u53ef\u4ee5\u53d1\u73b0\uff0cWKT \u53ea\u5305\u542b GeoJSON <code>geometry</code> \u5c5e\u6027\u90e8\u5206\u7684\u4fe1\u606f\uff0c\u4e24\u8005\u53ef\u4ee5\u4e92\u76f8\u8f6c\u6362\u3002 GeoJSON \u548c WKT \u90fd\u652f\u6301\u7684\u51e0\u4f55\u7c7b\u578b\uff1a</p> \u51e0\u4f55\u7c7b\u578b \u200bGeoJSON \u200bWKT \u70b9 <code>Point</code> <code>POINT</code> \u7ebf <code>LineString</code> <code>LINESTRING</code> \u9762 <code>Polygon</code> <code>POLYGON</code> \u591a\u70b9 <code>MultiPoint</code> <code>MULTIPOINT</code> \u591a\u7ebf <code>MultiLineString</code> <code>MULTILINESTRING</code> \u591a\u9762 <code>MultiPolygon</code> <code>MULTIPOLYGON</code> \u51e0\u4f55\u96c6\u5408 <code>GeometryCollection</code> <code>GEOMETRYCOLLECTION</code>"},{"location":"Java/JVM%20%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4%E5%88%92%E5%88%86/","title":"JVM \u5185\u5b58\u7a7a\u95f4\u5212\u5206","text":"<p>Java \u865a\u62df\u673a\u5728\u6267\u884c Java \u7a0b\u5e8f\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u628a\u5b83\u6240\u7ba1\u7406\u7684\u5185\u5b58\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u4e0d\u540c\u7684\u6570\u636e\u533a\u57df\u3002\u8fd9\u4e9b\u533a\u57df\u6709\u5404\u81ea\u7684\u7528\u9014\uff0c\u4ee5\u53ca\u521b\u5efa\u548c\u9500\u6bc1\u65f6\u95f4\uff0c\u6709\u7684\u533a\u57df\u968f\u7740\u865a\u62df\u673a\u8fdb\u7a0b\u7684\u542f\u52a8\u800c\u5b58\u5728\uff0c\u6709\u4e9b\u533a\u57df\u5219\u4f9d\u8d56\u7528\u6237\u7ebf\u7a0b\u7684\u542f\u52a8\u548c\u7ed3\u675f\u800c\u5efa\u7acb\u548c\u9500\u6bc1\u3002</p> <p>\u7531\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\u7684\u533a\u57df\uff1a  </p> <ul> <li>Method Area \u65b9\u6cd5\u533a\u3002  </li> <li>Head \u5806\u3002</li> </ul> <p>\u7ebf\u7a0b\u9694\u79bb\u7684\u533a\u57df\uff1a  </p> <ul> <li>VM Stack \u865a\u62df\u673a\u6808\u3002  </li> <li>Native Method Stack \u672c\u5730\u65b9\u6cd5\u6808\u3002  </li> <li>Program Counter Register \u7a0b\u5e8f\u8ba1\u6570\u5668\u3002</li> </ul>"},{"location":"Java/JVM%20%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4%E5%88%92%E5%88%86/#_1","title":"\u65b9\u6cd5\u533a","text":"<p>\u65b9\u6cd5\u533a\u4e3b\u8981\u5b58\u50a8\u7c7b\u7684\u5143\u6570\u636e\u3001\u5e38\u91cf\u3001\u9759\u6001\u53d8\u91cf\u5373\u65f6\u7f16\u8bd1\u540e\u7684\u5b57\u8282\u7801\u7f13\u5b58\u7b49\u6570\u636e\u3002</p> <p>\u5728 JDK 8 \u4e4b\u524d\u65b9\u6cd5\u533a\u7684\u5b9e\u73b0\u79f0\u4e3a\u6c38\u4e45\u4ee3\uff08PermGen\uff09\u4ece\u3002 JDK 8 \u5f00\u59cb\uff0c\u6c38\u4e45\u4ee3\u88ab\u79fb\u9664\uff0c\u65b9\u6cd5\u533a\u7684\u5b9e\u73b0\u8be5\u4e3a\u5143\u7a7a\u95f4\uff08Metaspace\uff09\uff0c\u5143\u7a7a\u95f4\u4f7f\u7528\u672c\u5730\u5185\u5b58\uff08Native Memory\uff09\uff0c\u4e0d\u518d\u53d7 JVM \u5806\u5185\u5b58\u7684\u9650\u5236\u3002</p> <p>\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u5728 JDK 7 \u4e4b\u524d\u4e5f\u662f\u5728\u65b9\u6cd5\u533a\u7684\uff0c\u4f46\u662f\u4ece JDK 7 \u53ca\u4e4b\u540e\uff0c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u88ab\u79fb\u5230\u4e86\u5806\u4e2d\u3002\u8fd9\u6837\u53ef\u4ee5\u5145\u5206\u5229\u7528 JVM \u7684\u5783\u573e\u56de\u6536\u673a\u5236\uff0c\u53ca\u65f6\u6e05\u7406\u4e0d\u518d\u4f7f\u7528\u7684\u5b57\u7b26\u4e32\u5e38\u91cf\u3002</p> <p>\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u7528\u4e8e\u5b58\u50a8\u5b57\u7b26\u4e32\u5e38\u91cf\u5982 <code>a = \"hello\"</code> \u548c\u901a\u8fc7 <code>new String(\"hello\").intern();</code> \u65b9\u6cd5\u663e\u793a\u52a0\u5165\u7684\u5b57\u7b26\u4e32\u3002</p>"},{"location":"Java/JVM%20%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4%E5%88%92%E5%88%86/#_2","title":"\u5806","text":"<p>\u5806\u4e3b\u8981\u5b58\u50a8\u5bf9\u8c61\u5b9e\u4f8b\u548c\u6570\u7ec4\u3002</p> <p>\u4f7f\u7528 jmap \u76d1\u63a7\u5806\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u9ed8\u8ba4\u8f93\u51fa\u7684\u5355\u4f4d\u4e3a B\u3002 <pre><code># jmap -heap 170260\nHeap Configuration:\n   MinHeapFreeRatio         = 40 // \u5f53\u5806\u7684\u7a7a\u95f2\u5185\u5b58\u4f4e\u4e8e 40% \u65f6\uff0cJVM \u4f1a\u5c1d\u8bd5\u6269\u5c55\u5806\n   MaxHeapFreeRatio         = 70 // \u5f53\u5806\u7684\u7a7a\u95f2\u5185\u5b58\u9ad8\u4e8e 70% \u65f6\uff0cJVM \u4f1a\u5c1d\u8bd5\u6536\u7f29\u5806\n   MaxHeapSize              = 448790528 (428.0MB) // \u5806\u7684\u6700\u5927\u5927\u5c0f\n   NewSize                  = 9764864 (9.3125MB) // \u65b0\u751f\u4ee3\u7684\u521d\u59cb\u5927\u5c0f\n   MaxNewSize               = 149553152 (142.625MB) // \u65b0\u751f\u4ee3\u7684\u6700\u5927\u5927\u5c0f\n   OldSize                  = 19595264 (18.6875MB) // \u8001\u5e74\u4ee3\u7684\u521d\u59cb\u5927\u5c0f\n   NewRatio                 = 2 // \u65b0\u751f\u4ee3\u4e0e\u8001\u5e74\u4ee3\u7684\u6bd4\u4f8b\uff0c\u8001\u5e74\u4ee3\u65f6\u65b0\u751f\u4ee3\u7684 2 \u500d\n   SurvivorRatio            = 8 // \u65b0\u751f\u4ee3 Eden \u548c Survivor \u7684\u6bd4\u4f8b\uff0cEden \u5360\u533a 8\uff0cSurvivor \u533a\u5360 2\n   MetaspaceSize            = 21807104 (20.796875MB) // \u5143\u7a7a\u95f4\u7684\u521d\u59cb\u5927\u5c0f\n   CompressedClassSpaceSize = 1073741824 (1024.0MB) // \u538b\u7f29\u7c7b\u7a7a\u95f4\u5927\u5c0f\n   MaxMetaspaceSize         = 17592186044415 MB // \u5143\u7a7a\u95f4\u7684\u6700\u5927\u5927\u5c0f\uff0c\u7406\u8bba\u4e0a\u65e0\u9650\u5927\uff08\u5f53\u7136\u53d7\u9650\u7269\u7406\u5185\u5b58\u7684\u9650\u5236\uff09\n   G1HeapRegionSize         = 0 (0.0MB) // G1 \u5783\u573e\u56de\u6536\u5668\u7684 Region \u5927\u5c0f\uff0c\u4e3a 0 \u8868\u793a\u672a\u4f7f\u7528 G1 \u5783\u573e\u56de\u6536\u5668\n\nHeap Usage:\nNew Generation (Eden + 1 Survivor Space): // \u65b0\u751f\u4ee3\u7684\u5927\u5c0f\uff0cFrom Space \u548c To Space \u90fd\u5c5e\u4e8e Survivor\n   capacity = 8847360 (8.4375MB)\n   used     = 817776 (0.7798919677734375MB)\n   free     = 8029584 (7.6576080322265625MB)\n   9.2431640625% used\nEden Space:\n   capacity = 7929856 (7.5625MB)\n   used     = 817776 (0.7798919677734375MB)\n   free     = 7112080 (6.7826080322265625MB)\n   10.312621061466942% used\nFrom Space:\n   capacity = 917504 (0.875MB)\n   used     = 0 (0.0MB)\n   free     = 917504 (0.875MB)\n   0.0% used\nTo Space:\n   capacity = 917504 (0.875MB)\n   used     = 0 (0.0MB)\n   free     = 917504 (0.875MB)\n   0.0% used\ntenured generation: // \u8001\u5e74\u4ee3\u7684\u5927\u5c0f\n   capacity = 19595264 (18.6875MB)\n   used     = 0 (0.0MB)\n   free     = 19595264 (18.6875MB)\n   0.0% used\n\n1162 interned Strings occupying 80544 bytes. // \u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u67091163 \u4e2a\u5b57\u7b26\u4e32\uff0c\u5360\u7528 80544 \u4e2a\u5b57\u8282\n</code></pre></p> <p>\u4f7f\u7528 jstac \u76d1\u63a7\u5806\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u9ed8\u8ba4\u8f93\u51fa\u5355\u4f4d\u4e3a KB\u3002 <pre><code># jstat -gc 170260\n S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT   \n896.0  896.0   0.0    0.0    7744.0   798.6    19136.0      0.0     4480.0 779.1  384.0   76.0       0    0.000   0      0.000    0.000\n</code></pre></p> \u5b57\u6bb5 \u5168\u7a0b \u542b\u4e49 <code>S0C</code> Survivor 0 Capacity Survivor 0 \u533a\uff08From Survivor\uff09\u7684\u5bb9\u91cf\uff08\u5355\u4f4d\uff1aKB\uff09\u3002 <code>S1C</code> Survivor 1 Capacity Survivor 1 \u533a\uff08To Survivor\uff09\u7684\u5bb9\u91cf\uff08\u5355\u4f4d\uff1aKB\uff09\u3002 <code>S0U</code> Survivor 0 Utilization Survivor 0 \u533a\uff08From Survivor\uff09\u5df2\u4f7f\u7528\u7684\u5185\u5b58\uff08\u5355\u4f4d\uff1aKB\uff09\u3002 <code>S1U</code> Survivor 1 Utilization Survivor 1 \u533a\uff08To Survivor\uff09\u5df2\u4f7f\u7528\u7684\u5185\u5b58\uff08\u5355\u4f4d\uff1aKB\uff09\u3002 <code>EC</code> Eden Capacity Eden \u533a\u7684\u5bb9\u91cf\uff08\u5355\u4f4d\uff1aKB\uff09\u3002 <code>EU</code> Eden Utilization Eden \u533a\u5df2\u4f7f\u7528\u7684\u5185\u5b58\uff08\u5355\u4f4d\uff1aKB\uff09\u3002 <code>OC</code> Old Capacity \u8001\u5e74\u4ee3\uff08Old Generation\uff09\u7684\u5bb9\u91cf\uff08\u5355\u4f4d\uff1aKB\uff09\u3002 <code>OU</code> Old Utilization \u8001\u5e74\u4ee3\uff08Old Generation\uff09\u5df2\u4f7f\u7528\u7684\u5185\u5b58\uff08\u5355\u4f4d\uff1aKB\uff09\u3002 <code>MC</code> Metaspace Capacity \u5143\u7a7a\u95f4\uff08Metaspace\uff09\u7684\u5bb9\u91cf\uff08\u5355\u4f4d\uff1aKB\uff09\u3002 <code>MU</code> Metaspace Utilization \u5143\u7a7a\u95f4\uff08Metaspace\uff09\u5df2\u4f7f\u7528\u7684\u5185\u5b58\uff08\u5355\u4f4d\uff1aKB\uff09\u3002 <code>CCSC</code> Compressed Class Space Capacity \u538b\u7f29\u7c7b\u7a7a\u95f4\uff08Compressed Class Space\uff09\u7684\u5bb9\u91cf\uff08\u5355\u4f4d\uff1aKB\uff09\u3002 <code>CCSU</code> Compressed Class Space Utilization \u538b\u7f29\u7c7b\u7a7a\u95f4\uff08Compressed Class Space\uff09\u5df2\u4f7f\u7528\u7684\u5185\u5b58\uff08\u5355\u4f4d\uff1aKB\uff09\u3002 <code>YGC</code> Young Generation GC Count \u5e74\u8f7b\u4ee3\uff08Young Generation\uff09\u5783\u573e\u56de\u6536\u7684\u6b21\u6570\u3002 <code>YGCT</code> Young Generation GC Time \u5e74\u8f7b\u4ee3\uff08Young Generation\uff09\u5783\u573e\u56de\u6536\u7684\u603b\u65f6\u95f4\uff08\u5355\u4f4d\uff1a\u79d2\uff09\u3002 <code>FGC</code> Full GC Count Full GC\uff08\u5168\u5c40\u5783\u573e\u56de\u6536\uff09\u7684\u6b21\u6570\u3002 <code>FGCT</code> Full GC Time Full GC\uff08\u5168\u5c40\u5783\u573e\u56de\u6536\uff09\u7684\u603b\u65f6\u95f4\uff08\u5355\u4f4d\uff1a\u79d2\uff09\u3002 <code>GCT</code> GC Time \u6240\u6709\u5783\u573e\u56de\u6536\u7684\u603b\u65f6\u95f4\uff08\u5355\u4f4d\uff1a\u79d2\uff09\u3002"},{"location":"Java/JVM%20%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/","title":"JVM \u547d\u4ee4\u884c\u5de5\u5177","text":""},{"location":"Java/JVM%20%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#java","title":"Java \u8fdb\u7a0b\u542f\u52a8\u53c2\u6570","text":"<p>Java \u7a0b\u5e8f\u542f\u52a8\u65f6\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u884c\u6307\u5b9a\u591a\u79cd\u53c2\u6570\uff0c\u5206\u4e3a\u4e24\u5927\u7c7b JVM \u53c2\u6570\u548c\u7a0b\u5e8f\u53c2\u6570\u3002</p>"},{"location":"Java/JVM%20%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#jvm","title":"\u5e38\u7528JVM \u53c2\u6570","text":"<p>\u6807\u51c6\u53c2\u6570  </p> <ul> <li><code>-cp</code> \u6307\u5b9a\u7c7b\u8def\u5f84\u3002  </li> <li><code>-D&lt;property&gt;=&lt;value&gt;</code> \u8bbe\u7f6e\u7cfb\u7edf\u5c5e\u6027\u3002</li> </ul> <p>\u975e\u6807\u51c6\u53c2\u6570  </p> <ul> <li><code>-Xms -Xmx</code> \u8bbe\u7f6e\u5806\u7684\u6700\u5c0f\u503c\u548c\u6700\u5927\u503c\u3002  </li> <li><code>-Xss</code> \u8bbe\u7f6e\u6bcf\u4e2a\u7ebf\u7a0b\u6808\u533a\u7684\u5927\u5c0f\u3002</li> </ul> <p>\u9ad8\u7ea7\u53c2\u6570 </p> <ul> <li><code>-XX:+UseG1GC</code> \u542f\u52a8 G1 \u5783\u573e\u56de\u6536\u5668\u3002  </li> <li><code>-XX:+HeapDumpOnOutOfMemoryError</code> \u5728\u5806\u5185\u5b58\u6ea2\u51fa\u65f6\u751f\u6210\u5806\u8f6c\u50a8\u6587\u4ef6\uff0c\u9ed8\u8ba4\u5b58\u50a8\u5728\u5f53\u524d\u76ee\u5f55\u3002  </li> <li><code>-XX:HeapDumpPath=/tmp/dump.hprof</code> \u6307\u5b9a\u5806\u8f6c\u50a8\u6587\u4ef6\u7684\u4f4d\u7f6e\u3002</li> </ul>"},{"location":"Java/JVM%20%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#_1","title":"\u7a0b\u5e8f\u53c2\u6570","text":"<p>\u4f20\u9012\u7ed9 main \u65b9\u6cd5\u7684\u53c2\u6570\uff0c\u5b58\u50a8\u5728 main \u65b9\u6cd5\u7684 args \u6570\u7ec4\u4e2d\u3002\u6ce8\u610f\uff0c\u548c C \u8bed\u8a00\u4e0d\u4e00\u6837\uff0cargs \u6570\u7ec4\u4e0d\u5305\u542b\u7a0b\u5e8f\u540d\u3002</p>"},{"location":"Java/JVM%20%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#_2","title":"\u793a\u4f8b","text":"<pre><code>java -Xmx128m -XX:+HeapDumpOnOutOfMemoryError -Dname=jacky com.otto.reflective.App arg1 arg2\n</code></pre>"},{"location":"Java/JVM%20%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#jps","title":"JPS","text":"<p>jsp \u547d\u4ee4\u7684\u7528\u6cd5 <pre><code>usage: jps [-q] [-mlvV] [&lt;hostid&gt;]\n\n-q \u53ea\u8f93\u51fa Java \u8fdb\u7a0bID\u3002\n\n-m \u8f93\u51fa\u7a0b\u5e8f\u548c\u7a0b\u5e8f\u53c2\u6570\u3002\n-l \u8f93\u51fa\u5168\u7c7b\u540d\uff0c\u5982\u679c\u662f jar \u5305\u8f93\u51fa jar \u8def\u5f84\u3002\n-v \u8f93\u51fa JVM \u53c2\u6570\u3002\n-V \u663e\u793a\u901a\u8fc7 .hotspotrc\u00a0\u6587\u4ef6\u6216\u00a0-XX:Flags=\u00a0\u6307\u5b9a\u7684 JVM \u53c2\u6570\u3002\n</code></pre></p> <p>\u8f93\u51fa\u793a\u4f8b\uff0c\u8bb0\u4f4f\u9ed8\u8ba4\u4f7f\u7528 jsp -lm \u5c31\u57fa\u672c\u591f\u7528\u4e86\u3002 <pre><code>% jps -q\n3418\n\n% jps -l\n3418 com.otto.reflective.App\n\n% jps -m\n3418 App arg1 arg2\n\n% jps -v\n3418 App -Xmx128m -XX:+HeapDumpOnOutOfMemoryError -Dname=jacky\n\n% jps -lvm\n3418 com.otto.reflective.App arg1 arg2 -Xmx128m -XX:+HeapDumpOnOutOfMemoryError -Dname=jacky\n\n% jps -lm\n3418 com.otto.reflective.App arg1 arg2\n</code></pre></p>"},{"location":"Java/Java%20Tips/","title":"Java Tips","text":""},{"location":"Java/Java%20Tips/#java-jar","title":"Java Jar \u5305\u90e8\u7f72\u811a\u672c","text":"<pre><code>#!/bin/bash\n\nAPP_NAME=&lt;jar_file&gt;\nAPP_JVM_OPTS=&lt;jvm_options&gt;\n\nSPRING_PROFILES_ACTIVE=&lt;env&gt;\n\nusage() {\n    echo \"Usage: sh run.sh [start|stop|restart|status]\"\n    exit 1\n}\n\nis_exist() {\n    pid=`ps -ef | grep ${APP_NAME} | grep -v grep | awk '{print $2}'`\n    if [ -z \"${pid}\" ]; then \n        return 1\n    else \n        return 0\n    fi\n}\n\nstart() {\n    is_exist\n    if [ $? -eq \"0\" ]; then\n        echo \"${APP_NAME} is already running, pid=${pid}\"\n    else \n        nohup java $APP_JVM_OPTS -jar $APP_NAME --spring.profiles.active=${SPRING_PROFILES_ACTIVE} &gt;/dev/null 2&gt;&amp;1 &amp;\n    fi\n}\n\nstop() {\n    is_exist\n    if [ $? -eq \"0\" ]; then \n        kill -9 $pid\n    else \n        echo \"$APP_NAME is not running\"\n    fi\n}\n\nstatus() {\n    is_exist\n    if [ $? -eq \"0\" ]; then\n        echo \"${APP_NAME} is running. pid is ${pid}\"\n    else \n        echo \"$APP_NAME is not running\"\n    fi\n}\n\nrestart() {\n    stop\n    start\n}\n\ncase \"$1\" in\n    \"start\") start ;;\n    \"stop\") stop ;;\n    \"status\") status ;;\n    \"restart\") restart ;;\n    *) usage;;\nesac\n</code></pre>"},{"location":"Java/Java%20Tips/#_1","title":"\u5982\u4f55\u7b80\u5316\u5e03\u5c14\u8868\u8fbe\u5f0f","text":"<p>\u539f\u6587\u94fe\u63a5\uff1ahttps://testing.googleblog.com/2024/04/isbooleantoolongandcomplex.html \u539f\u59cb\u8868\u8fbe\u5f0f\uff1a <pre><code>if ((!pepperoniService.empty() || sausages.size() &gt; 0)\n    &amp;&amp; (useOnionFlag.get() || hasMushroom(ENOKI, PORTOBELLO)) &amp;&amp; hasCheese()) {\n    ...\n}\n</code></pre></p> <p>\u5c06\u8868\u8fbe\u5f0f\u8fdb\u884c\u903b\u8f91\u62c6\u5206\uff1a <pre><code>boolean hasGoodMeat = !pepperoniService.empty() || sausages.size() &gt; 0;\nboolean hasGoodVeggies = useOnionFlag.get() || hasMushroom(ENOKI, PORTOBELLO);\nboolean isPizzaFantastic = hasGoodMeat &amp;&amp; hasGoodVeggies &amp;&amp; hasCheese();\nif (isPizzaFantastic) {\n  ...\n}\n</code></pre></p> <p>\u5c06\u5224\u65ad\u903b\u8f91\u5355\u72ec\u62c6\u5206\u4e3a\u4e00\u4e2a\u65b9\u6cd5\u3002 <pre><code>boolean isPizzaFantastic() {\n  if (!hasCheese()) {\n    return false;\n  }\n  if (pepperoniService.empty() &amp;&amp; sausages.size() == 0) {\n    return false;\n  }\n  return useOnionFlag.get() || hasMushroom(ENOKI, PORTOBELLO);\n}\n</code></pre></p>"},{"location":"Java/Java%20Tips/#_2","title":"\u6587\u672c\u6587\u4ef6\u8f6c\u7801","text":"<p>\u5c06\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u4ee5 <code>.cue</code> \u7ed3\u5c3e\u7684\u6587\u4ef6\uff0c\u4ece <code>GBK</code> \u8f6c\u5230 <code>UTF-8</code>\u3002</p> <p>Java \u7248\u672c\uff1a <pre><code>    private static final String DIR = \"\";\n\n    public static void main(String[] args) throws IOException {\n        Files.walk(Paths.get(DIR)).forEach(path -&gt; {\n            String fileName = path.toAbsolutePath().toString();\n            if (fileName.endsWith(\".cue\") || fileName.endsWith(\".CUE\")) {\n                try {\n                    Files.writeString(path, Files.readString(path, Charset.forName(\"GBK\")), StandardCharsets.UTF_8);\n                } catch (IOException e) {\n                    throw new RuntimeException(e);\n                }\n            }\n        });\n    }\n</code></pre></p> <p>Python \u7248\u672c\uff1a <pre><code>import os\n\nfor root, dirs, files in os.walk(\"\"):\n    for file in files:\n        if file.endswith(\".cue\"):\n            current_path = os.path.join(root, file)\n            try:\n                # \u4f7f\u7528 GBK \u7f16\u7801\u5c1d\u8bd5\u8bfb\u53d6\n                with open(current_path, \"r\", encoding=\"GBK\") as f:\n                    content = f.read()\n                    print(f\"Content from {current_path}:\\n{content}\\n{'=' * 50}\\n\")\n\n                    # \u5c06\u5185\u5bb9\u4fdd\u5b58\u4e3a UTF-8 \u7f16\u7801\n                with open(current_path, \"w\", encoding=\"UTF-8\") as f:\n                    f.write(content)\n                print(f\"Successfully converted {current_path} from GBK to UTF-8.\")\n            except UnicodeDecodeError:\n                print(f\"Failed to decode {current_path} with GBK encoding. Trying GB18030...\\n\")\n                try:\n                    with open(current_path, \"r\", encoding=\"GB18030\") as f:\n                        content = f.read()\n                        print(f\"Content from {current_path}:\\n{content}\\n{'=' * 50}\\n\")\n\n                    # \u5c06\u5185\u5bb9\u4fdd\u5b58\u4e3a UTF-8 \u7f16\u7801\n                    with open(current_path, \"w\", encoding=\"UTF-8\") as f:\n                        f.write(content)\n                    print(f\"Successfully converted {current_path} from GB18030 to UTF-8.\")\n                except UnicodeDecodeError:\n                    print(f\"Failed to decode {current_path} with GB18030 encoding.\\n\")\n</code></pre></p>"},{"location":"Java/Java%20Tips/#http-401-403","title":"HTTP 401 \u548c 403 \u7684\u533a\u522b","text":"<p>401 Unauthorized \u8868\u793a\u5ba2\u6237\u7aef\u9700\u8981\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\u624d\u80fd\u83b7\u53d6\u8bf7\u6c42\u7684\u54cd\u5e94\u3002</p> <p>403 Forbidden \u8868\u793a\u5ba2\u6237\u7aef\u6ca1\u6709\u8bbf\u95ee\u5185\u5bb9\u7684\u6743\u9650\uff0c\u4e5f\u5c31\u662f\u8bf4\u5b83\u662f\u672a\u7ecf\u6388\u6743\u7684\uff0c\u56e0\u6b64\u670d\u52a1\u5668\u62d2\u7edd\u63d0\u4f9b\u8bf7\u6c42\u7684\u8d44\u6e90\u3002</p> <p>403 \u8868\u793a\u670d\u52a1\u5668\u77e5\u9053\u5ba2\u6237\u7aef\u7684\u8eab\u4efd\uff0c\u800c 401 \u670d\u52a1\u5668\u4e0d\u77e5\u9053\u5ba2\u6237\u7aef\u7684\u8eab\u4efd\u3002</p>"},{"location":"Java/Java%20Tips/#_3","title":"\u914d\u7f6e\u5141\u8bb8\u8de8\u57df","text":"<p>Spring Boot \u540e\u7aef\u914d\u7f6e\u5904\u7406\uff1a <pre><code>@Configuration\npublic class WebConfig implements WebMvcConfigurer {\n    @Override\n    public void addCorsMappings(CorsRegistry registry) {\n        registry.addMapping(\"/**\") // \u5141\u8bb8\u6240\u6709\u8def\u5f84\n                .allowedOriginPatterns(\"*\") // \u5141\u8bb8\u6240\u6709\u6765\u6e90\n                .allowedMethods(\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\") // \u5141\u8bb8\u7684 HTTP \u65b9\u6cd5\n                .allowedHeaders(\"*\") // \u5141\u8bb8\u6240\u6709\u8bf7\u6c42\u5934\n                .allowCredentials(true) // \u5141\u8bb8\u643a\u5e26\u51ed\u8bc1\uff08\u5982 cookies\uff09\n                .maxAge(3600); // \u9884\u68c0\u8bf7\u6c42\u7684\u7f13\u5b58\u65f6\u95f4\uff08\u79d2\uff09\n    }\n}\n</code></pre></p> <p>\u5982\u679c\u6709 Filter \u62e6\u622a\u8bf7\u6c42\u9700\u8981\u5728 Filter \u4e2d\u653e\u884c\uff1a <pre><code>// \u5982\u679c\u662f OPTIONS \u8bf7\u6c42\uff0c\u76f4\u63a5\u653e\u884c  \nif (\"OPTIONS\".equalsIgnoreCase(request.getMethod())) {  \n    filterChain.doFilter(servletRequest, servletResponse);  \n    return;  \n}\n</code></pre></p>"},{"location":"Java/Java%20Tips/#mybatisplus-sql","title":"MybatisPlus \u914d\u7f6e SQL \u8f93\u51fa\u5230\u63a7\u5236\u53f0","text":"<pre><code># myabtis  \nmybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl\n</code></pre>"},{"location":"Java/Java%20Tips/#java","title":"Java \u65e5\u671f\u65f6\u95f4","text":"<p>\u83b7\u53d6\u6307\u5b9a\u7684\u65f6\u95f4\uff1a <pre><code>// \u65f6\u95f4\u622a\u53d6\nLocalDateTime now = LocalDateTime.now();\n// 2025-03-21 21:42:31.062\nSystem.out.println(now.format(dtf));\n// \u83b7\u53d6\u5f53\u524d\u79d2\u7684\u8d77\u59cb\u65f6\u95f4 2025-03-21 21:42:31.000\nSystem.out.println(now.truncatedTo(ChronoUnit.SECONDS).format(dtf));\n// \u83b7\u53d6\u5f53\u524d\u5206\u949f\u7684\u8d77\u59cb\u65f6\u95f4 2025-03-21 21:42:00.000\nSystem.out.println(now.truncatedTo(ChronoUnit.MINUTES).format(dtf));\n// \u83b7\u53d6\u5f53\u524d\u5c0f\u65f6\u7684\u8d77\u59cb\u65f6\u95f4 2025-03-21 21:00:00.000\nSystem.out.println(now.truncatedTo(ChronoUnit.HOURS).format(dtf));\n// \u83b7\u53d6\u5f53\u5929\u4e2d\u5348\u7684\u8d77\u59cb\u65f6\u95f4 2025-03-21 12:00:00.000\nSystem.out.println(now.truncatedTo(ChronoUnit.HALF_DAYS).format(dtf));\n// \u83b7\u53d6\u5f53\u5929\u7684\u8d77\u59cb\u65f6\u95f4 2025-03-21 00:00:00.000\nSystem.out.println(now.truncatedTo(ChronoUnit.DAYS).format(dtf));\n// \u83b7\u53d6\u5f53\u6708\u7b2c\u4e00\u5929\u7684\u8d77\u59cb\u65f6\u95f4 2025-03-01 00:00:00.000\nSystem.out.println(now\n        .with(TemporalAdjusters.firstDayOfMonth())\n        .truncatedTo(ChronoUnit.DAYS)\n        .format(dtf)\n);\n// \u83b7\u53d6\u5f53\u5e74\u7b2c\u4e00\u5929\u7684\u8d77\u59cb\u65f6\u95f4 2025-01-01 00:00:00.000\nSystem.out.println(now\n        .with(TemporalAdjusters.firstDayOfYear())\n        .truncatedTo(ChronoUnit.DAYS)\n        .format(dtf)\n);\n</code></pre></p> <p>\u83b7\u53d6\u4e24\u4e2a LocalDateTime \u4e4b\u95f4\u7684\u95f4\u9694\uff1a <pre><code>Duration duration = Duration.between(startTime, endTime);\nduration.toDays();\nduration.toHours();\nduration.toMinutes();\nduration.getSeconds();\n</code></pre></p>"},{"location":"Java/Java%20Tips/#_4","title":"\u9632\u6b62\u63a5\u53e3\u91cd\u590d\u8bf7\u6c42","text":"<p>\u524d\u7aef\u6ca1\u6709\u505a\u9632\u6296\uff0c\u6216\u8005\u8bf4\u56e0\u4e3a\u7f51\u7edc\u6296\u52a8\u95ee\u9898\uff0c\u540c\u4e00\u65f6\u95f4\u91cd\u590d\u8bf7\u6c42\u591a\u6b21\u63a5\u53e3\u3002\u6bd4\u5982\u7528\u6237\u4e0b\u5355\u63a5\u53e3\uff0c\u540c\u4e00\u65f6\u95f4\u53c2\u6570\u4e00\u6837\u8bf7\u6c42\u4e86\u4e24\u6b21\u3002</p> <p>\u524d\u6bb5\u9632\u6296\uff0c\u7981\u7528\u6309\u94ae\u3002</p> <p>\u540e\u7aef\u5904\u7406 1. \u540e\u6bb5\u57fa\u4e8e\u4e1a\u52a1\u903b\u8f91\u5224\u65ad\uff0c\u540c\u4e00\u4e2a\u7528\u6237 5 \u79d2\u4e4b\u5185\u53ea\u80fd\u4e0b\u4e00\u5355\u3002Redis \u91cc\u9762\u7f13\u5b58\u4e00\u4e2a key \u5c31\u597d\u4e86\u3002 2. \u524d\u7aef\u751f\u6210\u4e00\u4e2a requestId\uff0c\u524d\u6bb5\u9700\u8981\u4fdd\u8bc1\u4e0b\u5355\u754c\u9762\u591a\u6b21\u70b9\u51fb\u4e0b\u5355\u6309\u94ae requestId \u662f\u540c\u6837\u7684\u3002\u540e\u7aef\u5c31\u5148\u5224\u65ad\u662f\u5426\u5904\u7406\u8fc7\u8fd9\u4e2a requestId\uff0c\u5df2\u7ecf\u5904\u7406\u8fc7\u5c31\u4e0d\u518d\u5904\u7406\uff0c\u5426\u5219 Redis \u7f13\u5b58 requestId \u7136\u540e\u5904\u7406\u8bf7\u6c42\u3002 3. \u5982\u679c\u662f\u4fee\u6539\u4e1a\u52a1\u6570\u636e\uff0c\u90a3\u4e48\u9700\u8981\u4f7f\u7528\u5206\u5e03\u5f0f\u9501\u8fdb\u884c\u5904\u7406\uff0c\u9632\u6b62\u591a\u4e2a\u7528\u6237\u540c\u65f6\u4fee\u6539\u4e1a\u52a1\u6570\u636e\uff0c\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4\u3002</p>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/","title":"Java \u5e76\u53d1","text":"<p>\u4e3a\u4ec0\u4e48\u9700\u8981\u5e76\u53d1\uff0c\u7528\u6765\u89e3\u51b3\u4ec0\u4e48\u95ee\u9898\uff1f  </p> <ul> <li>\u63d0\u9ad8\u8d44\u6e90\u7684\u5229\u7528\u7387\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u7ebf\u7a0b\u5fc5\u987b\u7b49\u5f85\u78c1\u76d8\u6216\u8005\u7f51\u7edc\u7684 I/O \u800c\u963b\u585e\uff0c\u6b64\u65f6 CPU \u7a7a\u95f2\u7684\u65f6\u95f4\u7247\u5c31\u53ef\u4ee5\u8fd0\u884c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u63d0\u9ad8\u8d44\u6e90\u7684\u5229\u7528\u7387\u3002</li> <li>\u516c\u5e73\u6027\uff0c\u591a\u4e2a\u7528\u6237\u548c\u7a0b\u5e8f\u5171\u4eab\u8ba1\u7b97\u673a\u8d44\u6e90\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u7a0b\u5e8f\u4e00\u76f4\u8fd0\u884c\uff0c\u7136\u540e\u518d\u542f\u52a8\u4e0b\u4e00\u4e2a\u7a0b\u5e8f\u3002</li> <li>\u73b0\u4ee3\u7684 CPU \u5f80\u5f80\u5177\u6709\u591a\u4e2a\u6838\u5fc3\uff0c\u5929\u7136\u5177\u5907\u5e76\u884c\u8fd0\u7b97\u7684\u80fd\u529b\u3002\u5e76\u53d1\u7f16\u7a0b\u591f\u5145\u5206\u53d1\u6325\u5904\u7406\u5668\u7684\u5f3a\u5927\u80fd\u529b\u3002</li> </ul> <p>\u5e76\u53d1\u5e26\u6765\u7684\u4e3b\u8981\u6311\u6218\u662f\u4ec0\u4e48\uff1f</p> <ul> <li>\u539f\u5b50\u6027\uff0c\u6211\u4eec\u5e0c\u671b\u4e00\u4e9b\u5217\u6307\u4ee4\u80fd\u591f\u539f\u5b50\u5730\u6267\u884c\uff0c\u5728\u5e76\u53d1\u60c5\u51b5\u4e0b\uff0c\u7531\u4e8e CPU \u8c03\u5ea6\u5e26\u6765\u4e86\u4e0d\u786e\u5b9a\u6027\u3002</li> <li>\u53ef\u89c6\u6027\uff0c\u7531\u4e8e CPU \u7684\u7f13\u5b58\u548c Java \u7684\u5185\u5b58\u6a21\u578b\uff0c\u5bfc\u81f4\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u5171\u4eab\u53d8\u91cf\u7684\u4fee\u6539\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u4e0d\u4e00\u5b9a\u80fd\u8fc7\u591f\u53ca\u65f6\u770b\u5230\u3002</li> <li>\u6709\u5e8f\u6027\uff0c\u5728\u6267\u884c\u7a0b\u5e8f\u65f6\uff0c\u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\uff0c\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u53ef\u80fd\u4f1a\u5bf9\u6307\u4ee4\u505a\u91cd\u6392\u5e8f\u3002</li> </ul>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#_1","title":"\u57fa\u7840\u77e5\u8bc6","text":""},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#_2","title":"\u539f\u5b50\u64cd\u4f5c","text":"<p>\u5047\u8bbe\u53ea\u6709\u4e00\u4e2a\u903b\u8f91 CPU\uff0c\u90a3\u4e48\u539f\u5b50\u64cd\u4f5c\u5c31\u662f\u4e0d\u80fd\u88ab\u7ebf\u7a0b\u8c03\u5ea6\u673a\u5236\u4e2d\u65ad\u7684\u64cd\u4f5c\uff0c\u4e00\u65e6\u64cd\u4f5c\u5f00\u59cb\u90a3\u4e48\u5b83\u4e00\u5b9a\u53ef\u4ee5\u5728\u53ef\u80fd\u53d1\u751f\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u4e4b\u524d\u6267\u884c\u5b8c\u6bd5\u3002</p>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#monitor","title":"\u76d1\u89c6\u5668 Monitor","text":"<p>Java \u6bcf\u4e2a\u5bf9\u8c61\u90fd\u6709\u4e00\u4e2a\u76d1\u89c6\u5668\uff08monitor\uff09\uff0c\u76d1\u89c6\u5668\u76f8\u5f53\u4e8e\u9501\u3002\u76d1\u89c6\u5668\u5177\u6709 ownership \u548c entry count \u4e24\u4e2a\u5c5e\u6027\uff0c\u8868\u793a\u9501\u7684\u6301\u6709\u8005\u548c\u91cd\u5165\u6b21\u6570\u3002</p> <p>\u76d1\u89c6\u5668\u7528\u6765\u5b9e\u73b0\u8bed\u6cd5\u5c42\u9762\u7684\u9501 synchronized\uff0c\u7531 JVM \u5904\u7406\u9501\u7684\u83b7\u53d6\uff0c\u7b49\u5f85\u961f\u5217\u3002ReentrantLock \u4e3a API \u5c42\u9762\u7684\u9501\uff0cJava \u63d0\u4f9b\u4e86 CAS\u3001LockSupport \u548c AQS \u6765\u652f\u6301 ReentrantLock\uff0c\u6765\u5b9e\u73b0\u66f4\u5f3a\u5927\u7684\u9501\u3002AQS \u5185\u90e8\u901a\u8fc7\u6210\u5458\u53d8\u91cf\u6765\u7ef4\u62a4\u9501\u7684\u72b6\u6001\u3001\u7b49\u5f85\u961f\u5217\u7b49\u4fe1\u606f\u3002</p>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#_3","title":"\u7ebf\u7a0b\u7684\u72b6\u6001","text":"<ul> <li>New \u65b0\u5efa\u7684\u7ebf\u7a0b\u8fd8\u6ca1\u6709\u5f00\u59cb\u6267\u884c\u3002</li> <li>Runnable \u53ef\u8fd0\u884c\uff0c\u5df2\u7ecf\u5728\u8fd0\u884c\u6216\u8005\u53ef\u4ee5\u8fd0\u884c\u4f46\u662f\u8fd8\u6ca1\u6709\u83b7\u5f97 CPU \u65f6\u95f4\u3002</li> <li>Blocked \u963b\u585e\uff0c\u5728\u7b49\u5f85 monitor \u9501\u800c\u8fdb\u5165 syncrhonized \u65b9\u6cd5\u65f6\u7684\u72b6\u6001\u3002</li> <li>Waiting \u7b49\u5f85\uff0cObject.wait \u4e0d\u6307\u5b9a\u65f6\u95f4\u3001Thread.join \u4e0d\u6307\u5b9a\u65f6\u95f4\u3001 LockSupport.park\uff0c\u90fd\u4f1a\u8ba9\u7ebf\u7a0b\u5904\u4e8e\u8be5\u72b6\u6001\u3002\u8be5\u72b6\u6001\u8be5\u5728\u7b49\u5f85\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u7684\u7279\u5b9a\u884c\u4e3a\uff0c\u6bd4\u5982 Object.notify/notifyAll\u3001\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u7ed3\u675f\u3001\u53e6\u4e00\u4e2a\u7ebf\u7a0b unpark \u8c03\u7528\u3002 </li> <li>Timed waiting \u8ba1\u65f6\u7b49\u5f85\uff0c\u7b49\u5f85\u6307\u5b9a\u7684\u65f6\u95f4\uff0c\u5bf9 Thread.sleep\u3001Object.wait \u6307\u5b9a\u65f6\u95f4\u3001Thread.join \u6307\u5b9a\u65f6\u95f4\u3001LockSupport.parkNanos\u3001LockSupport.parkUntil \u65b9\u6cd5\u7684\u8c03\u7528\u90fd\u4f1a\u4f7f\u7ebf\u7a0b\u8fdb\u5165\u8be5\u72b6\u6001\u3002</li> <li>Terminated \u7ec8\u6b62\uff0c\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\u3002</li> </ul> <p>\u83b7\u53d6\u7ebf\u7a0b\u72b6\u6001\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>    static volatile int done = 0;\n\n    public static void main(String[] args) {\n        Thread b = new Thread(\"B\") {\n            @Override\n            public void run() {\n                Thread currentThread = Thread.currentThread();\n                System.out.println(\"hello, i'm \" + currentThread.getName() \n                                    + \", and my state is \" + currentThread.getState());\n                done = 1;\n            }\n        };\n\n        System.out.println(\"B start before state is \" + b.getState());\n        b.start();\n        while (done == 0)\n            ;\n        System.out.println(\"B start after state is \" + b.getState());\n    }\n</code></pre></p> <p>\u8fd0\u884c\u8f93\u51fa\uff1a <pre><code>B start before state is NEW\nhello, i'm B. And my state is RUNNABLE\nB start after state is TERMINATED\n</code></pre></p>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#_4","title":"\u7ebf\u7a0b\u4e2d\u65ad","text":"<p>java.lang.Thread \u4e2d\u65ad\u5e38\u7528\u7684\u65b9\u6cd5\uff1a <pre><code>1. void interrupt() \u5411\u7ebf\u7a0b\u53d1\u9001\u4e2d\u65ad\u8bf7\u6c42\uff0c\u7ebf\u7a0b\u7684\u4e2d\u65ad\u72b6\u6001\u5c06\u88ab\u8bbe\u7f6e\u4e3a true\u3002\n\n2. static boolean interrupted() \u6d4b\u8bd5\u5f53\u524d\u7ebf\u7a0b\u662f\u5426\u88ab\u4e2d\u65ad\uff0c\u9759\u6001\u65b9\u6cd5\uff0c\u4f1a\u628a\u5f53\u524d\u7ebf\u7a0b\u7684\u4e2d\u65ad\u72b6\u6001\u91cd\u7f6e\u4e3a false\u3002\n\n3. boolean isInterrupted() \u6d4b\u8bd5\u7ebf\u7a0b\u662f\u5426\u88ab\u4e2d\u65ad\uff0c\u4e0d\u4f1a\u6539\u53d8\u7ebf\u7a0b\u7684\u91cd\u7f6e\u72b6\u6001\u3002\n\n4. static Thread currentThread() \u8fd4\u56de\u5f53\u524d\u6b63\u5728\u6267\u884c\u7684\u7ebf\u7a0b\u3002\n</code></pre></p> <p>void interrupt() \u662f\u4e00\u4e2a\u660e\u786e\u7684\u6307\u793a\uff0c\u544a\u8bc9\u7ebf\u7a0b\u5e94\u8be5\u505c\u6b62\u5f53\u524d\u6240\u505a\u7684\u4e8b\u60c5\u3002\u8981\u4f7f\u4e2d\u65ad\u673a\u5236\u6b63\u5e38\u5de5\u4f5c\uff0c\u7ebf\u7a0b\u672c\u8eab\u5fc5\u987b\u8981\u652f\u6301\u4e2d\u65ad\uff0c\u6362\u53e5\u8bdd\u8bf4\u8981\u7531\u7a0b\u5e8f\u5458\u51b3\u5b9a\u5982\u4f55\u54cd\u5e94\u4e2d\u65ad\u3002</p> <p>\u5982\u679c\u7ebf\u7a0b\u8c03\u7528\u7684\u65b9\u6cd5\u9700\u8981\u6355\u83b7\u5904\u7406 InteruptedException\uff0c\u5982\u4e0b\u9762\u4ee3\u7801\uff0c\u90a3\u4e48\u5f53\u7ebf\u7a0b\u963b\u585e\u5728 sleep() \u65b9\u6cd5\u4e0a\u65f6\uff0c\u6b64\u65f6\u5bf9\u7ebf\u7a0b\u8c03\u7528 interrupt() \u65b9\u6cd5\uff0c\u7ebf\u7a0b\u5c06\u7acb\u523b\u4ece sleep() \u963b\u585e\u8fd4\u56de\u5e76\u6355\u83b7 InteruptedException\uff08\u6216\u8005\u4efb\u4f55\u8981\u6c42\u629b\u51fa InterruptedException \u7684\u8c03\u7528\uff09\u3002 <pre><code>for (int i = 0; i &lt; importantInfo.length; i++) {\n    // Pause for 4 seconds\n    try {\n        Thread.sleep(4000);\n    } catch (InterruptedException e) {\n        // We've been interrupted: no more messages.\n        return;\n    }\n    // Print a message\n    System.out.println(importantInfo[i]);\n}\n</code></pre></p> <p>\u5982\u679c\u7ebf\u7a0b\u6ca1\u6709\u8c03\u7528\u629b\u51fa InterruptedException \u7684\u65b9\u6cd5\uff0c\u90a3\u4e48\u5982\u679c\u60f3\u8981\u4f7f\u4e2d\u65ad\u673a\u5236\u6b63\u5e38\u5de5\u4f5c\uff0c\u5c31\u8981\u5728\u4ee3\u7801\u4e2d\u4e0d\u65ad\u8c03\u7528 Thread.interrupted() \u68c0\u67e5\u662f\u5426\u5df2\u6536\u5230\u4e2d\u65ad\uff1a <pre><code>for (int i = 0; i &lt; inputs.length; i++) {\n    heavyCrunch(inputs[i]);\n    if (Thread.interrupted()) {\n        // We've been interrupted: no more crunching.\n        return;\n    }\n}\n</code></pre> \u66f4\u590d\u6742\u4e1a\u52a1\u7684\u60c5\u51b5\u4e0b\uff0c\u6700\u597d\u662f\u68c0\u6d4b\u5230\u4e2d\u65ad\u540e\u629b\u51fa InterruptedException\uff0c\u8fd9\u6837\u53ef\u4ee5\u5728\u5916\u90e8\u7684\u8c03\u7528\u5c06\u5904\u7406\u4e2d\u65ad\u7684\u4ee3\u7801\u653e\u5728\u4e00\u4e2a catch \u5b50\u53e5\u4e2d\u3002</p> <p>\u4e2d\u65ad\u673a\u5236\u662f\u4f7f\u7528\u5185\u90e8 interrupted \u6807\u5fd7\u6765\u5b9e\u73b0\u7684\uff0c\u901a\u8fc7 interrupt() \u65b9\u6cd5\u5c06\u8bbe\u7f6e\u8be5\u6807\u5fd7\u3002\u5f53\u7ebf\u7a0b\u5185\u90e8\u4f7f\u7528\u9759\u6001\u65b9\u6cd5 static boolean interrupted() \u65b9\u6cd5\u68c0\u67e5\u4e2d\u65ad\u65f6\uff0c\u4f1a\u83b7\u53d6\u4e2d\u65ad\u72b6\u6001\u7136\u540e\u4f1a\u6e05\u9664\u4e2d\u65ad\u72b6\u6001\u3002\u800c\u7ebf\u7a0b\u901a\u8fc7 boolean isInterrupted() \u65b9\u6cd5\u67e5\u8be2\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u7684\u4e2d\u65ad\u72b6\u6001\u65f6\uff0c\u4e0d\u4f1a\u66f4\u6539\u4e2d\u65ad\u72b6\u6001\u3002 <pre><code>    // Thread \u7684\u6210\u5458\u53d8\u91cf\n    volatile boolean interrupted;\n</code></pre></p> <p>\u901a\u8fc7 InterruptedException \u5982 sleep() \u65b9\u6cd5\uff0c\u5728\u6355\u83b7\u8be5\u5f02\u5e38\u540e\u7ebf\u7a0b\u7684\u4e2d\u65ad\u72b6\u6001\u5c06\u81ea\u52a8\u6e05\u9664\u3002\u4f46\u662f\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u8bbe\u7f6e\u4e2d\u65ad\u3002</p> <p>\u5982\u679c\u7ebf\u7a0b\u963b\u585e\u5728\u9501\u6216\u8005 I/O \u7b49\u5f85\u65f6\uff0c\u4e5f\u4e0d\u4f1a\u5bf9 interrupt() \u4e2d\u65ad\u8fdb\u884c\u54cd\u5e94\u3002</p> <p>\u5f53\u7136 Java \u4e5f\u63d0\u4f9b\u4e86 ReentrantLock \u963b\u585e\u53ef\u4ee5\u88ab\u4e2d\u65ad\u7684\u80fd\u529b\uff0c\u901a\u8fc7 lockIntettuptibly() \u65b9\u6cd5\u83b7\u53d6\u9501\uff0c\u8be5\u65b9\u6cd5\u8981\u6c42\u629b\u51fa InterruptedException \u5f02\u5e38\u3002</p>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#_5","title":"\u7ebf\u7a0b\u76f8\u5173\u7684\u65b9\u6cd5","text":""},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#waitnotify","title":"wait/notify \u65b9\u6cd5","text":"<p>java.lang.Object wait/notify \u76f8\u5173\u7684\u65b9\u6cd5\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u6761\u4ef6\u53d8\u91cf\u7684\u6548\u679c\uff08\u9700\u8981\u642d\u914d synchronized\uff09\uff0c\u5efa\u8bae\u4f7f\u7528 Lock/Condtion \u6765\u5b9e\u73b0\u6761\u4ef6\u53d8\u91cf\u3002</p> <p>wait \u7684\u4f7f\u7528\u6a21\u677f\uff1a <pre><code>synchronized (obj) {\n    while (&lt;condition does not hold&gt;)\n        obj.wait();\n    ... // Perform action appropriate to condition\n}\n</code></pre></p> <p>wait/notify \u4e3a\u4ec0\u4e48\u9700\u8981 synchronized \u6216\u8005\u8bf4\u4e3a\u4ec0\u4e48\u9700\u8981\u9501\uff1f\u56e0\u4e3a\u5b83\u4eec\u662f\u4f7f\u7528\u5728\u6761\u4ef6\u53d8\u91cf\u7684\u573a\u666f\u4e0b\uff0cwait \u7b49\u5f85\u4e00\u4e2a\u6761\u4ef6\u6210\u7acb\uff0c\u90a3\u4e48\u5fc5\u7136\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u8981\u4fee\u6539\u6761\u4ef6\u7684\u72b6\u6001\u624d\u80fd\u4f7f\u6761\u4ef6\u6210\u7acb\uff0c\u6240\u4ee5\u6761\u4ef6\u672c\u8eab\u5c31\u662f\u4e34\u754c\u8d44\u6e90\uff0c\u9700\u8981\u7528\u9501\u6765\u4fdd\u62a4\u4e34\u754c\u8d44\u6e90\uff08\u539f\u5b50\u6027\u3001\u53ef\u89c6\u6027\uff09\u3002\u56e0\u6b64\uff0cwait \u8c03\u7528\u4f1a\u91ca\u653e\u9501\uff0c\u8c03\u7528\u8fd4\u56de\u65f6\u4f1a\u81ea\u52a8\u83b7\u53d6\u9501\u3002</p> <p>while \u5faa\u73af\u5224\u65ad\u662f\u4e3a\u4e86\u89e3\u51b3\u865a\u5047\u5524\u9192\u6216\u8005\u591a\u7ebf\u7a0b\u7ade\u4e89\u540c\u4e00\u4e2a\u6761\u4ef6\uff0cnotifyAll \u5168\u90e8\u5524\u9192\u65f6\uff0c\u91cd\u65b0\u68c0\u67e5\u6761\u4ef6\uff0c\u56e0\u4e3a\u6761\u4ef6\u53ef\u80fd\u88ab\u5176\u5b83\u7ebf\u7a0b\u4fee\u6539\u3002</p> <p>\u5982\u679c wait/notify \u7684\u8c03\u7528\u7ebf\u7a0b\u4e0d\u662f\u5bf9\u8c61 monitor \u7684\u6301\u6709\u8005\uff0c\u90a3\u4e48\u65b9\u6cd5\u4f1a\u629b\u51fa IllegalMonitorStateException\u3002</p> <p>\u76f8\u5173\u65b9\u6cd5\u4ecb\u7ecd\uff1a <pre><code>final void wait() \u7ebf\u7a0b\u8fdb\u5165 Waiting \u72b6\u6001\uff0c\u76f4\u5230\u5b83\u5f97\u5230\u901a\u77e5\u3002\n\nfinal void wait(long millis)\nfinal void wait(long millis, int nanos)\n\u4e0e wait() \u7c7b\u4f3c\uff0c\u4f1a\u8fdb\u5165 Timed waiting \u72b6\u6001\uff0c\u76f4\u5230\u5b83\u5f97\u5230\u901a\u77e5\u6216\u8005\u7ecf\u8fc7\u4e86\u6307\u5b9a\u7684\u65f6\u95f4\u3002\n\nfinal void nitofy() \u968f\u673a\u9009\u62e9\u4e00\u4e2a\u5728\u8fd9\u4e2a\u5bf9\u8c61\u76d1\u89c6\u5668\u4e0a\u7b49\u5f85\u7684\u7ebf\u7a0b\uff0c\u89e3\u9664\u5176\u7b49\u5f85\u72b6\u6001\u3002\nfinal void notifyAll() \u89e3\u9664\u5728\u8fd9\u4e2a\u5bf9\u8c61\u76d1\u89c6\u5668\u4e0a\u7b49\u5f85\u7684\u6240\u6709\u7ebf\u7a0b\uff0c\u4e4b\u540e\u8fd9\u4e9b\u7ebf\u7a0b\u4f1a\u4e00\u76f4\u5c1d\u8bd5\u83b7\u53d6\u9501\uff0c\u7136\u540e\u4ece wait \u8c03\u7528\u8fd4\u56de\u6267\u884c\u3002\n</code></pre></p> <p>wait \u4f1a\u91ca\u653e\u9501\uff0cwait \u8fd4\u56de\u7684\u65f6\u5019\u4f1a\u81ea\u52a8\u91cd\u65b0\u83b7\u53d6\u9501\u3002\u90a3\u4e48\u5982\u679c\u8ba1\u65f6\u7ed3\u675f\u8fd4\u56de\u6216\u8005 wait \u7b49\u5f85\u8fc7\u7a0b\u4e2d\u88ab\u4e2d\u65ad\u8fd4\u56de\uff0c\u662f\u7acb\u9a6c\u8fd4\u56de\u5e76\u4e14\u81ea\u52a8\u83b7\u53d6\u9501\u5417\uff1f</p> <p>wait \u8fd4\u56de\u65f6\u7ebf\u7a0b\u4f1a\u91cd\u65b0\u83b7\u53d6\u5bf9\u8c61\u7684\u9501\uff0c\u4e0b\u9762\u65e0\u8bba\u54ea\u79cd\u60c5\u51b5\uff0c\u90fd\u4f1a\u5728\u5c1d\u8bd5\u83b7\u53d6\u5e76\u4e14\u83b7\u53d6\u9501\u4e4b\u540e\u53d1\u751f\u3002</p> <ul> <li>\u8ba1\u65f6\u7b49\u5f85\u7ed3\u675f\u8fd4\u56de\u3002</li> <li>\u5916\u90e8\u4e2d\u65ad\uff0c\u629b\u51fa IntrruptedException \u8fd4\u56de\u3002</li> <li>\u88ab notify \u6216 notifyAll \u5524\u9192\u3002</li> </ul>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#join","title":"join \u65b9\u6cd5","text":"<p>\u76f8\u5173\u7684\u65b9\u6cd5\uff1a <pre><code>final void join() \u7ebf\u7a0b\u8fdb\u5165 Waiting \u72b6\u6001\uff0c\u76f4\u5230\u5b83\u7b49\u5f85\u7684\u7ebf\u7a0b\u7ed3\u675f\u8fd0\u884c\u3002\n\nfinal void join(long millis)\nfinal void join(long millis, int nanos)\n\u4e0e join() \u7c7b\u4f3c\uff0c\u4f1a\u8fdb\u5165 Timed waiting \u72b6\u6001\uff0c\u76f4\u5230\u5b83\u7b49\u5f85\u7684\u7ebf\u7a0b\u7ed3\u675f\u8fd0\u884c\u6216\u8005\u7ecf\u8fc7\u4e86\u6307\u5b9a\u7684\u65f6\u95f4\u3002\n</code></pre></p> <p>\u5b9e\u73b0 10 \u4e2a\u7ebf\u7a0b\u5148\u540e\u8fd0\u884c\uff0c\u4e3b\u7ebf\u7ebf\u7a0b main\uff0c0\uff0c1\uff0c2\u2026\u2026\uff1a <pre><code>    public static void main(String[] args) {\n        Thread previous = Thread.currentThread();\n        for(int i = 0; i &lt; 10; i ++) {\n            Thread thread = new Thread(new Runner(previous), String.valueOf(i));\n            thread.start();\n            previous = thread;\n        }\n        System.out.println(Thread.currentThread().getName() + \" done!\");\n    }\n\n    static class Runner implements Runnable {\n\n        private Thread thread;\n\n        public Runner(Thread thread) {\n            this.thread = thread;\n        }\n\n        @Override\n        public void run() {\n            try {\n                thread.join();\n            } catch (InterruptedException e) {\n                throw new RuntimeException(e);\n            }\n            System.out.println(Thread.currentThread().getName() + \" done!\");\n        }\n    }\n</code></pre></p> <p>join \u65b9\u6cd5\u7684\u903b\u8f91\uff0c\u7cbe\u7b80\u7248\uff1a <pre><code>    public final void join() throws InterruptedException {\n        synchronized (this) {\n            while (isAlive()) {\n                wait(0);\n            }\n        }\n    }\n</code></pre> \u53ef\u4ee5\u770b\u5230\u5982\u679c\u7ebf\u7a0b\u5df2\u7ecf\u7ed3\u675f\u4e86\uff0c\u76f4\u63a5\u8fd4\u56de\u3002\u5426\u5219\uff0c\u4e5f\u662f\u4f7f\u7528\u4e86 wait/notify \u673a\u5236\uff0c\u5f53\u7ebf\u7a0b\u7ec8\u6b62\u65f6\uff0c\u4f1a\u8c03\u7528\u81ea\u8eab\u7684 notifyAll \u65b9\u6cd5\uff0c\u5524\u9192\u6240\u6709\u7b49\u5f85\u5728\u8be5\u7ebf\u7a0b\u76d1\u89c6\u5668\u4e0a\u7684\u5bf9\u8c61\u3002</p> <p>join \u5e76\u4e0d\u4f1a\u653e\u5f03\u5f53\u524d\u7ebf\u7a0b\u5728\u8c03\u7528 jion \u4e4b\u524d\u5df2\u7ecf\u6301\u6709\u7684\u9501\u3002</p>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#_6","title":"\u4f7f\u7528\u7ebf\u7a0b\u7684\u65b9\u6cd5","text":"<ul> <li>\u5b9e\u73b0 Runnable \u63a5\u53e3\u3002</li> <li>\u5b9e\u73b0 Callable \u63a5\u53e3\u3002</li> <li>\u7ee7\u627f Thread \u7c7b\u3002</li> </ul> <p>\u5b9e\u73b0 Runnable \u548c Callable \u63a5\u53e3\u7684\u7c7b\u53ea\u80fd\u5f53\u4f5c\u4e00\u4e2a\u53ef\u4ee5\u5728\u7ebf\u7a0b\u4e2d\u8fd0\u884c\u7684\u4efb\u52a1\uff0c\u4e0d\u662f\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u7ebf\u7a0b\uff0c\u56e0\u4e3a\u6700\u540e\u8fd8\u9700\u8981\u901a\u8fc7 Thread \u6765\u542f\u52a8\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\u3002</p> <p>\u901a\u8fc7\u7ee7\u627f Thread \u8c03\u7528 start() \u65b9\u6cd5\u6765\u542f\u52a8\u7ebf\u7a0b\uff1a <pre><code>    static volatile int done = 0;\n\n    public static void main(String[] args) {\n        System.out.println(\"main thread start!\");\n\n        new Thread(\"B\") {\n            @Override\n            public void run() {\n                System.out.println(\"hello, i'm \" + Thread.currentThread().getName());\n                done = 1;\n            }\n        }.start();\n\n        while (done == 0)\n            ;\n        System.out.println(\"main thread end!\");\n    }\n</code></pre></p> <p>\u5b9e\u73b0 Runnable \u63a5\u53e3\uff1a <pre><code>    static volatile int done = 0;  \n\n    public static void main(String[] args) {  \n        System.out.println(\"main thread start!\");  \n\n        new Thread(new Runnable() {  \n            @Override  \n            public void run() {  \n                System.out.println(\"hello, i'm \" + Thread.currentThread().getName());  \n                done = 1;  \n            }  \n        }, \"B\").start();  \n        while (done == 0)  \n            ;  \n        System.out.println(\"main thread end!\");  \n    }  \n</code></pre></p> <p>\u5b9e\u73b0 Callable \u63a5\u53e3\uff1a <pre><code>    public static void main(String[] args) throws ExecutionException, InterruptedException {\n        System.out.println(\"main thread start!\");\n\n        FutureTask&lt;String&gt; futureTask = new FutureTask&lt;&gt;(new Callable&lt;String&gt;() {\n            @Override\n            public String call() throws Exception {\n                return \"hello, i'm B\";\n            }\n        });\n        Thread thread = new Thread(futureTask);\n        thread.start();\n        System.out.println(futureTask.get());\n        System.out.println(\"main thread end!\");\n    }\n</code></pre></p>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#volatile","title":"volatile","text":"<p><code>volatile</code> \u53ef\u4ee5\u8bf4\u662f JVM \u63d0\u4f9b\u7684\u8f7b\u91cf\u7ea7\u7ebf\u7a0b\u540c\u6b65\u673a\u5236\u3002\u5982\u679c\u5c06\u4e00\u4e2a\u57df\u58f0\u660e\u4e3a <code>volatile</code> \u7684\uff0c\u90a3\u4e48\u53ea\u8981\u5bf9\u8fd9\u4e2a\u57df\u4ea7\u751f\u4e86\u5199\u64cd\u4f5c\uff0c\u90a3\u4e48\u6240\u6709\u540e\u7eed\u7684\u8bfb\u64cd\u4f5c\u90fd\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u4fee\u6539\uff0c\u5373\u4f7f\u4f7f\u7528\u4e86\u672c\u5730\u7f13\u5b58\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c<code>volatile</code> \u4fdd\u8bc1\u53ef\u89c6\u6027\u3002</p> <p>\u539f\u5b50\u64cd\u4f5c\u53ef\u4ee5\u5e94\u7528\u4e8e\u9664 <code>long</code> \u548c <code>double</code> \u4e4b\u5916\u7684\u6240\u6709\u57fa\u672c\u7c7b\u578b\u4e4b\u4e0a\u7684\u201c\u7b80\u5355\u64cd\u4f5c\u201d\u3002\u5bf9\u4e8e\u8bfb\u548c\u5199\u5165\u9664 <code>long</code> \u548c <code>double</code> \u4e4b\u5916\u7684\u57fa\u672c\u7c7b\u578b\u53d8\u91cf\u7684\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u5b83\u4eec\u662f\u539f\u5b50\u7684\u3002\u4f46\u662f JVM \u5bf9\u4e8e 64 \u4f4d\u7684 <code>long</code> \u548c <code>double</code> \u7684\u8bfb\u53d6\u548c\u5199\u5165\u5f53\u4f5c\u4e24\u4e2a\u5206\u79bb\u7684 32 \u4f4d\u64cd\u4f5c\u6765\u6267\u884c\uff0c\u5982\u679c\u53d1\u751f\u4e86\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u9519\u8bef\uff08\u79f0\u4e3a\u5b57\u6495\u88c2\uff09\u3002\u5f53\u5b9a\u4e49 <code>long</code> \u548c <code>double</code> \u53d8\u91cf\u65f6\uff0c\u5982\u679c\u4f7f\u7528 <code>volatile</code> \u5173\u952e\u5b57\uff0c\u8bfb\u548c\u5199\u5c31\u4f1a\u83b7\u5f97\u539f\u5b50\u6027\u4fdd\u8bc1\u3002</p> <p><code>volatile</code> \u8fd8\u6709\u4e00\u4e2a\u8bed\u4e49\u662f\u7981\u6b62\u6307\u4ee4\u91cd\u6392\u5e8f\u4f18\u5316\u3002\u5148\u770b\u4e0b\u9762\u7684 <code>Double Check Lock</code> \u5355\u4f8b\u5b9e\u73b0\u4ee3\u7801\uff1a <pre><code>public class Singleton {  \n    private volatile static Singleton INSTANCE = null;  \n    public static Singleton instance() {  \n        if(INSTANCE == null) {  \n            synchronized (Singleton.class) {  \n                if(INSTANCE == null) {  \n                    INSTANCE = new Singleton();  \n                }  \n            }  \n        }  \n        return INSTANCE;  \n    }  \n}\n</code></pre></p> <p>\u8bed\u53e5 <code>INSTANCE = new Singleton();</code> \u4f1a\u5305\u542b\u81f3\u5c11\u4e09\u6b65\u64cd\u4f5c\uff1a</p> <ol> <li>\u7ed9 <code>Singleton</code> \u7684\u5b9e\u4f8b\u5206\u914d\u5185\u5b58\u3002</li> <li>\u8c03\u7528 <code>Singleton()</code> \u7684\u6784\u9020\u51fd\u6570\uff0c\u521d\u59cb\u5316\u6210\u5458\u53d8\u91cf\u3002</li> <li>\u5c06 <code>INSTANCE</code> \u6307\u5411\u5206\u914d\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u6b64\u65f6 <code>INSTANCE</code> \u5c31\u4e0d\u662f <code>null</code> \u4e86\u3002</li> </ol> <p>\u5982\u679c <code>INSTANCE</code> \u4e0d\u4f7f\u7528 <code>volatile</code> \u4fee\u9970\uff0c\u5c31\u6709\u53ef\u80fd\u53d1\u751f\u6307\u4ee4\u91cd\u6392\u5e8f\uff0c\u90a3\u4e48\u6b65\u9aa4 2 \u548c 3 \u7684\u987a\u5e8f\u5c31\u6709\u53ef\u80fd\u98a0\u5012\u3002\u5982\u679c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5207\u6362\u7ebf\u7a0b\uff0c\u65b0\u7684\u7ebf\u7a0b\u5224\u65ad <code>INSTANCE</code> \u4e0d\u4e3a\u7a7a\uff0c\u4e0d\u9700\u8981\u83b7\u53d6\u9501\u5c31\u62ff\u5230\u672a\u521d\u59cb\u5316\u5b8c\u6210\u7684\u5bf9\u8c61\u4e86\uff0c\u4f7f\u7528 <code>volatile</code> \u5c31\u80fd\u907f\u514d\u8fd9\u79cd\u95ee\u9898\u3002</p>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#synchronized","title":"synchronized \u540c\u6b65","text":"<p>\u5173\u952e\u5b57 synchronized \u53ef\u4ee5\u4fdd\u8bc1\u5728\u540c\u4e00\u65f6\u523b\uff0c\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u6267\u884c\u67d0\u4e00\u4e2a\u65b9\u6cd5\u6216\u8005\u67d0\u4e00\u4e2a\u4ee3\u7801\u5757\u3002\u5f53\u4e00\u4e2a\u5bf9\u8c61\u88ab\u4e00\u4e2a\u7ebf\u7a0b\u4fee\u6539\u7684\u65f6\u5019\uff0c\u5b83\u80fd\u591f\u963b\u6b62\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u89c2\u5bdf\u5230\u5bf9\u8c61\u5185\u90e8\u4e0d\u4e00\u81f4\u7684\u72b6\u6001\uff0c\u5e76\u4e14\u8fd8\u53ef\u4ee5\u4fdd\u8bc1\u8fdb\u5165\u540c\u6b65\u65b9\u6cd5\u6216\u8005\u4ee3\u7801\u5757\u7684\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u80fd\u770b\u5230\u7531\u540c\u4e00\u4e2a\u9501\u4fdd\u62a4\u7684\u4e4b\u524d\u6240\u6709\u7684\u4fee\u6539\u7ed3\u679c\u3002</p> <p>synchronized \u9501\u662f\u975e\u516c\u5e73\u7684\uff0c\u53ef\u91cd\u5165\u7684\u3002</p> <p>synchronized \u4ee3\u7801\u5757\u7ecf\u8fc7\u7f16\u8bd1\u4e4b\u540e\uff0c\u4f1a\u5728\u540c\u6b65\u5757\u7684\u524d\u540e\u5206\u522b\u5f62\u6210 monitorenter \u548c monitorexit \u8fd9\u4e24\u4e2a\u5b57\u8282\u7801\u6307\u4ee4\u3002</p> <p>\u6e90\u7801\uff1a <pre><code>    public int add(int a, int b) {\n        synchronized(this) {\n            return a + b;\n        }\n    }\n</code></pre></p> <p>\u83b7\u53d6\u5b57\u8282\u7801 <code>javap -c class_file</code>\uff1a <pre><code>       // ...\n       3: monitorenter\n       4: iload_1\n       5: iload_2\n       6: iadd\n       7: aload_3\n       8: monitorexit\n       9: ireturn\n      10: astore        4\n      12: aload_3\n      13: monitorexit\n      // ...\n</code></pre></p> <p>monitorenter \u548c monitorexit \u8fd9\u4e24\u4e2a\u5b57\u8282\u7801\u6307\u4ee4\u90fd\u9700\u8981\u4e00\u4e2a reference \u7c7b\u578b\u7684\u53c2\u6570\u6765\u6307\u5b9a\u8981\u9501\u5b9a\u548c\u89e3\u9501\u7684\u5bf9\u8c61\uff0c\u6ce8\u610f\uff0c\u662f\u5f15\u7528\u7c7b\u578b\u4e0d\u80fd\u662f\u57fa\u672c\u7c7b\u578b\u3002\u5982\u679c\u6ca1\u6709\u660e\u786e\u6307\u5b9a\uff0c\u90a3\u4e48\u5c31\u6839\u636e synchronized \u4fee\u9970\u7684\u662f\u5b9e\u4f8b\u65b9\u6cd5\u8fd8\u662f\u9759\u6001\u65b9\u6cd5\uff0c\u53bb\u53d6\u5bf9\u5e94\u7684\u5bf9\u8c61\u7684\u5b9e\u4f8b\u6216\u8005 Class \u5bf9\u8c61\u6765\u4f5c\u4e3a\u9501\u5bf9\u8c61\u3002</p> <p>\u6bcf\u4e2a\u5bf9\u8c61\u90fd\u4e0e\u4e00\u4e2a\u76d1\u89c6\u5668\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u9501\uff09\u5173\u8054\uff0c\u5f53\u76d1\u89c6\u5668\u5177\u6709\u6240\u6709\u8005\u65f6\uff0c\u76d1\u89c6\u5668\u5c31\u662f\u88ab\u9501\u5b9a\u7684\u3002</p> <p>\u6267\u884c monitorenter \u7684\u7ebf\u7a0b\u4f1a\u5c1d\u8bd5\u5c06\u81ea\u5df1\u8bbe\u7f6e\u4e3a reference \u5bf9\u8c61\u76d1\u89c6\u5668\u7684\u6240\u6709\u8005\uff08ownership\uff09\uff1a</p> <ul> <li>\u5982\u679c\u76d1\u89c6\u5668\u7684 entry count \u4e3a 0\uff0c\u5219\u7ebf\u7a0b\u5c06\u8fdb\u5165\u76d1\u89c6\u5668\u5e76\u5c06 entry count \u8bbe\u7f6e\u4e3a 1\u3002\u8fd9\u6837\u7ebf\u7a0b\u5c31\u662f\u76d1\u89c6\u5668\u7684\u6240\u6709\u8005\u3002</li> <li>\u5982\u679c\u7ebf\u7a0b\u5df2\u662f\u76d1\u89c6\u5668\u7684\u6240\u6709\u8005\uff0c\u5b83\u5c06\u91cd\u65b0\u8fdb\u5165\u76d1\u89c6\u5668\uff0c\u5e76\u589e\u52a0 entry count\u3002</li> <li>\u5982\u679c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u5df2\u7ecf\u62e5\u6709\u76d1\u89c6\u5668\uff0c\u5219\u8be5\u7ebf\u7a0b\u5c06\u963b\u585e\uff0c\u76f4\u5230\u76d1\u89c6\u5668\u7684 entry count \u4e3a 0\uff0c\u7136\u540e\u518d\u6b21\u5c1d\u8bd5\u83b7\u53d6\u76d1\u89c6\u5668\u7684\u6240\u6709\u6743\u3002</li> </ul> <p>\u6267\u884c monitorexit \u7684\u7ebf\u7a0b\u5fc5\u987b\u662f\u76d1\u89c6\u5668\u7684\u6240\u6709\u8005\uff0c\u5426\u5219\u4f1a\u629b\u51fa IllegalMonitorStateException \u5f02\u5e38\u3002\u8be5\u64cd\u4f5c\u4f1a\u51cf\u5c11\u76d1\u89c6\u5668\u7684 entry count\uff0c\u5982\u679c\u51cf\u5c11\u5230 0 \u5219\u9000\u51fa\u76d1\u89c6\u5668\u3002\u6b64\u65f6\uff0c\u5176\u5b83\u7ebf\u7a0b\u53ef\u4ee5\u5c1d\u8bd5\u9501\u5b9a\u76d1\u89c6\u5668\u3002</p> <p>synchronized \u8bed\u6cd5\u7684\u4f7f\u7528\u65b9\u5f0f\uff1a <pre><code>    void incrAmount(int amount) {\n        synchronized (this) {\n            ...\n        }\n    }\n\n    synchronized void incrAmount(int amount) {  \n        ...\n    }\n\n    void incrAmount(int amount) {\n        synchronized (App.class) {\n            ...\n        }\n    }\n\n    synchronized static void incrAmount(int amount) {  \n        ...  \n    }\n</code></pre></p>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#lock","title":"Lock \u540c\u6b65","text":""},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#cas","title":"CAS","text":"<p>\u53c2\u8003\u5e76\u53d1\u63a7\u5236\u7684\u7b14\u8bb0\uff0cCAS \u662f\u5b9e\u73b0\u9501\u7684\u5fc5\u8981\u5e95\u5c42\u6307\u4ee4\u3002</p> <p>Java \u4f7f\u7528 Unsafe \u5c01\u88c5\u4e86 CAS \u7684\u64cd\u4f5c\u3002</p> <p>\u6ce8\u610f\u4e00\u65b9\u9762 CAS \u63d0\u4f9b\u4e86\u539f\u5b50\u6027\u64cd\u4f5c\uff0c\u4e0d\u53ef\u5206\u5272\u3002\u53e6\u4e00\u65b9\u9762 CAS \u4e5f\u5177\u6709\u4e92\u65a5\u6027\uff0c\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u80fd\u591f\u5bf9\u76f8\u540c\u7684\u5730\u5740\u6267\u884c CAS \u64cd\u4f5c\u3002</p>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#locksupport","title":"LockSupport","text":"<p>\u4ec0\u4e48\u7ebf\u7a0b\u7684\u963b\u585e\uff08\u6307\u9501\u7b49\u5f85\u963b\u585e\uff09\u548c\u5524\u9192\uff1f\u672c\u8d28\u4e0a\u5e94\u8be5\u662f\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u505c\u6b62\u8c03\u5ea6\u8be5\u7ebf\u7a0b\uff08\u5c06\u5f53\u524d\u7ebf\u7a0b\u8bbe\u7f6e\u4e3a\u505c\u6b62\u8c03\u5ea6\u5e76\u7acb\u5373\u5207\u6362\u6267\u884c\u7684\u7ebf\u7a0b\uff09\u548c\u5c06\u7ebf\u7a0b\u91cd\u65b0\u52a0\u5165\u8c03\u5ea6\u961f\u5217\u3002\u5728[[\u5e76\u53d1\u63a7\u5236]]\u4e2d\u4ecb\u7ecd\u8fc7 park \u548c unpark \u7cfb\u7edf\u8c03\u7528\uff0cJava \u4f7f\u7528 LockSupport \u6765\u63d0\u4f9b\u540c\u6837\u7684\u529f\u80fd\uff0c\u5e95\u5c42\u5e94\u8be5\u4e5f\u662f\u901a\u8fc7 JNI \u8c03\u7528\u7cfb\u7edf\u8c03\u7528\u3002</p> <p>\u901a\u8fc7 CAS \u64cd\u4f5c\u548c park/unpark \u7cfb\u7edf\u8c03\u7528\uff0c\u80fd\u591f\u5b9e\u73b0\u7b80\u5355\u7684\u975e\u53ef\u91cd\u5165\u9501\uff1a <pre><code> class FIFOMutex {\n   private final AtomicBoolean locked = new AtomicBoolean(false);\n   private final Queue&lt;Thread&gt; waiters = new ConcurrentLinkedQueue&lt;&gt;();\n\n   public void lock() {\n     boolean wasInterrupted = false;\n     // publish current thread for unparkers\n     waiters.add(Thread.currentThread());\n     // Block while not first in queue or cannot acquire lock\n     while (waiters.peek() != Thread.currentThread() || !locked.compareAndSet(false, true)) {\n       LockSupport.park(this);\n       // ignore interrupts while waiting\n       if (Thread.interrupted())\n         wasInterrupted = true;\n     }\n     waiters.remove();\n     // ensure correct interrupt status on return\n     if (wasInterrupted)\n       Thread.currentThread().interrupt();\n   }\n\n   public void unlock() {\n     locked.set(false);\n     LockSupport.unpark(waiters.peek());\n   }\n\n   static {\n     // Reduce the risk of \"lost unpark\" due to classloading\n     Class&lt;?&gt; ensureLoaded = LockSupport.class;\n   }\n }\n</code></pre></p> <p>LockSupport.park \u65b9\u6cd5\u7528\u6765\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\uff0cLockSupport.unpark(Thread thread) \u7528\u6765\u5524\u9192\u4e00\u4e2a\u88ab\u963b\u585e\u7684\u7ebf\u7a0b\u3002\u5982\u679c\u5148\u5bf9\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c unpark\uff0c\u5219\u7d27\u63a5\u4e0b\u6765\u7684 park \u8c03\u7528\u5c06\u76f4\u63a5\u8fd4\u56de\u3002</p> <p>public static void park() \u5c06\u505c\u6b62\u5f53\u524d\u7ebf\u7a0b\u7684 CPU \u8c03\u5ea6\uff0c\u76f4\u5230\u4e0b\u5217\u4efb\u4f55\u60c5\u51b5\u53d1\u751f\uff1a</p> <ul> <li>\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u4e86 unpark \u5524\u9192\u3002</li> <li>\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u65ad\u4e86 park \u7684\u7ebf\u7a0b\uff0c\u5bf9\u7ebf\u7a0b\u8c03\u7528 interrupt \u4f1a\u4f7f\u7ebf\u7a0b\u4ece park \u8fd4\u56de\u3002</li> <li>\u865a\u5047\u5524\u9192\u3002</li> </ul> <p>park \u8c03\u7528\u7684\u8fd4\u56de\u5e76\u4e0d\u4f1a\u544a\u8bc9\u7ebf\u7a0b\u662f\u90a3\u79cd\u60c5\u51b5\u8fd4\u56de\uff0c\u6240\u4ee5\u5e94\u8be5\u603b\u662f\u91cd\u65b0\u68c0\u67e5\u5bfc\u81f4\u7ebf\u7a0b\u6682\u505c\u7684\u6761\u4ef6\u3002  ## AbstractQueuedSynchronizer \u961f\u5217\u540c\u6b65\u5668 AbstractQueuedSynchronizer \u662f\u7528\u6765\u6784\u5efa\u9501\u548c\u5176\u5b83\u540c\u6b65\u7ec4\u4ef6\u7684\u57fa\u7840\u6846\u67b6\u3002</p> <p>\u9501\u662f\u9762\u5411\u4f7f\u7528\u8005\u7684\uff0c\u5b83\u5b9a\u4e49\u4e86\u4f7f\u7528\u8005\u4e0e\u9501\u4ea4\u4e92\u7684\u63a5\u53e3\uff0c\u9690\u85cf\u4e86\u5b9e\u73b0\u7ec6\u8282\u3002\u961f\u5217\u540c\u6b65\u5668\u9762\u5411\u7684\u662f\u9501\u548c\u5176\u5b83\u540c\u6b65\u7ec4\u4ef6\u7684\uff0c\u5b83\u7b80\u5316\u4e86\u9501\u548c\u5176\u5b83\u540c\u6b65\u7ec4\u4ef6\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u63d0\u4f9b\u4e86\u72b6\u6001\u7ba1\u7406\u3001\u7ebf\u7a0b\u6392\u961f\u3001\u7b49\u5f85\u548c\u5524\u9192\u7b49\u5e95\u5c42\u64cd\u4f5c\u3002</p> <p>\u5b83\u4f7f\u7528\u4e00\u4e2a int \u6210\u5458\u53d8\u91cf\u8868\u793a\u540c\u6b65\u72b6\u6001\uff1a <pre><code>private volatile int state;   // \u6ce8\u610f state \u4f7f\u7528 volatile \u4fee\u9970\nprotected final int getState() {\n    return state;\n}\n\n// state \u4ece 0 \u5230 1 \u7684\u8fc7\u7a0b\u6c38\u8fdc\u662f cas \u8bbe\u7f6e\u7684\uff0c\u6240\u4ee5\u6c38\u8fdc\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u80fd\u5bf9 state \u8fdb\u884c\u66f4\u65b0\uff0c\u4e0d\u9700\u8981\u540c\u6b65\nprotected final void setState(int newState) {   \n    state = newState;\n}\n\nprotected final boolean compareAndSetState(int expect, int update) {\n    return U.compareAndSetInt(this, STATE, expect, update);\n}\n</code></pre></p> <p>\u901a\u8fc7\u5185\u7f6e\u7684 FIFO \u961f\u5217\u6765\u5b8c\u6210\u7ebf\u7a0b\u7684\u6392\u961f\u5de5\u4f5c\uff1a <pre><code>    abstract static class Node {\n        volatile Node prev;       // initially attached via casTail\n        volatile Node next;       // visibly nonnull when signallable\n        Thread waiter;            // visibly nonnull when enqueued\n        volatile int status;      // written by owner, atomic bit ops by others\n        // \u2026\u2026\n    }\n\n    private transient volatile Node head;\n\n    private transient volatile Node tail;\n\n    private boolean casTail(Node c, Node v) {  \n        return U.compareAndSetReference(this, TAIL, c, v);  \n    }\n</code></pre></p> <p>AQS \u4f7f\u7528\u961f\u5217\u6765\u7ef4\u62a4\u6392\u961f\u7684\u7ebf\u7a0b\uff0c\u5e76\u53d1\u6570\u636e\u7ed3\u6784\u7684\u5b9e\u73b0\u4e00\u822c\u4f1a\u7528\u5230\u9501\uff0c\u4f46\u662f AQS \u672c\u8eab\u5c31\u662f\u5b9e\u73b0\u9501\u7684\u57fa\u7840\u7ec4\u4ef6\uff0c\u5728\u7528\u9501\u53bb\u5b9e\u73b0\u5e76\u53d1\u961f\u5217\u5c31\u6b7b\u5faa\u73af\u4e86\u3002\u6240\u4ee5 AQS \u4f7f\u7528 CAS \u548c volatile \u8bed\u4e49\u6765\u5b9e\u73b0\u5e76\u53d1\u961f\u5217\u7684\u6b63\u786e\u6027\uff0c\u975e\u5e38\u5389\u5bb3\uff01\u9700\u8981\u6ce8\u610f\u7684\u662f\u53ea\u6709\u5165\u961f\u662f\u5b58\u5728\u7ade\u6001\u6761\u4ef6\u7684\uff0c\u51fa\u961f\u7531\u83b7\u53d6\u9501\u7684\u7ebf\u7a0b\u8d1f\u8d23\uff0c\u4e0d\u5b58\u5728\u7ade\u4e89\u3002</p> <p>\u961f\u5217\u540c\u6b65\u5668\u7684\u6d89\u53ca\u662f\u57fa\u4e8e\u6a21\u677f\u65b9\u6cd5\uff0c\u4f7f\u7528\u8005\u9700\u8981\u7ee7\u627f\u540c\u6b65\u5668\u5e76\u91cd\u5199\u6307\u5b9a\u7684\u65b9\u6cd5\uff0c\u968f\u540e\u5c06\u540c\u6b65\u5668\u7ec4\u5408\u5728\u81ea\u5b9a\u4e49\u540c\u6b65\u7ec4\u4ef6\u7684\u5b9e\u73b0\u4e2d\uff0c\u5e76\u8c03\u7528\u540c\u6b65\u5668\u63d0\u4f9b\u7684\u6a21\u677f\u65b9\u6cd5\uff0c\u800c\u8fd9\u4e9b\u6a21\u677f\u65b9\u6cd5\u5c06\u4f1a\u8c03\u7528\u4f7f\u7528\u8005\u91cd\u5199\u7684\u65b9\u6cd5\u3002</p> <p>\u961f\u5217\u540c\u6b65\u5668\u53ef\u91cd\u5199\u7684\u65b9\u6cd5\uff1a <pre><code>    /**\n     * \u5c1d\u8bd5\u4ee5\u72ec\u5360\u7684\u65b9\u5f0f\u83b7\u53d6\u9501\u3002\u8fd9\u4e2a\u65b9\u6cd5\u5e94\u8be5\u67e5\u8be2\u72b6\u6001\u662f\u5426\u5141\u8bb8\u4ee5\u72ec\u5360\u6a21\u5f0f\u83b7\u53d6\u5b83\uff0c\u5982\u679c\u5141\u8bb8\u5219\u5c1d\u8bd5 CAS \u8bbe\u7f6e\u540c\u6b65\u72b6\u6001\u3002\n     * \u8fd9\u4e2a\u65b9\u6cd5\u5e94\u8be5\u59cb\u7ec8\u7531\u6267\u884c acquire \u7684\u7ebf\u7a0b\u8fdb\u884c\u8c03\u7528\uff0c\u5982\u679c\u8fd4\u56de false \u5219 acquire \u53ef\u80fd\u4f1a\u5c06\u7ebf\u7a0b\u6392\u961f\u3002\n     * \u961f\u5217\u540c\u6b65\u5668\u63d0\u4f9b\u4e86 acquire \u65b9\u6cd5\uff0c\u6392\u961f\uff0c\u6761\u4ef6\u5224\u65ad\u7b49\u5de5\u4f5c\uff0c\u5c06\u5c1d\u8bd5\u83b7\u53d6\u9501\u7684\u64cd\u4f5c\u4ea4\u7ed9\u81ea\u5b9a\u4e49\u540c\u6b65\u7ec4\u4ef6\u5b9e\u73b0\u3002\n     */ \n    protected boolean tryAcquire(int arg) {\n        throw new UnsupportedOperationException();\n    }\n\n    /**\n     * \u72ec\u5360\u5f0f\u91ca\u653e\u540c\u6b65\u72b6\u6001\u3002\n     */ \n    protected boolean tryRelease(int arg) {\n        throw new UnsupportedOperationException();\n    }\n\n\n    /**\n     * \u5c1d\u8bd5\u5728\u5171\u4eab\u6a21\u5f0f\u4e0b\u83b7\u53d6\u9501\u3002\u8fd4\u56de\u5927\u4e8e\u7b49\u4e8e 0 \u7684\u503c\u8868\u793a\u83b7\u53d6\u6210\u529f\uff0c\u53cd\u4e4b\u83b7\u53d6\u5931\u8d25\u3002\n     */\n    protected int tryAcquireShared(int arg) {\n        throw new UnsupportedOperationException();\n    }\n\n    /**\n     * \u5c1d\u8bd5\u5728\u5171\u4eab\u6a21\u5f0f\u4e0b\u91ca\u653e\u9501\u3002\n     */\n    protected boolean tryReleaseShared(int arg) {\n        throw new UnsupportedOperationException();\n    }\n\n    /**\n     * \u8fd4\u56de\u5f53\u524d\u540c\u6b65\u7ec4\u4ef6\u662f\u5426\u5728\u72ec\u5360\u6a21\u5f0f\u4e0b\u88ab\u7ebf\u7a0b\u5360\u7528\u3002\n     */\n    protected boolean isHeldExclusively() {\n        throw new UnsupportedOperationException();\n    }\n</code></pre></p> <p>\u961f\u5217\u540c\u6b65\u5668\u7684\u6a21\u677f\u65b9\u6cd5\u57fa\u672c\u5206\u4e3a 3 \u7c7b\uff1a\u72ec\u5360\u5f0f\u83b7\u53d6\u4e0e\u91ca\u653e\u540c\u6b65\u72b6\u6001\u3001\u5171\u4eab\u5f0f\u83b7\u53d6\u4e0e\u91ca\u653e\u540c\u6b65\u72b6\u6001\u548c\u67e5\u8be2\u540c\u6b65\u961f\u5217\u4e2d\u7b49\u5f85\u7ebf\u7a0b\u7684\u60c5\u51b5\u3002 <pre><code>    /**\n     * \u72ec\u5360\u6a21\u5f0f\u83b7\u53d6\u540c\u6b65\u72b6\u6001\uff0c\u5ffd\u7565\u4e2d\u65ad\u3002\u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u8bbe\u7f6e\u540c\u6b65\u72b6\u6001\u6210\u529f\uff0c\u5219\u8fd4\u56de\uff1b\u5426\u5219\u7ebf\u7a0b\u4f1a\u8fdb\u5165\u540c\u6b65\u961f\u5217\u7b49\u5f85\u3002\n     */\n    public final void acquire(int arg) {\n        if (!tryAcquire(arg))\n            acquire(null, arg, false, false, false, 0L);\n    }\n\n    /**\n     * \u4e0e acquire \u76f8\u540c\uff0c\u4f46\u662f\u8be5\u65b9\u6cd5\u54cd\u5e94\u4e2d\u65ad\u3002\n     */\n    public final void acquireInterruptibly(int arg)\n        throws InterruptedException {\n        if (Thread.interrupted() ||\n            (!tryAcquire(arg) &amp;&amp; acquire(null, arg, false, true, false, 0L) &lt; 0))\n            throw new InterruptedException();\n    }\n\n    /**\n     * \u5728 acquireInterruptibly \u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u8d85\u65f6\u9650\u5236\uff0c\u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u5728\u8d85\u65f6\u65f6\u95f4\u5185\u6ca1\u6709\u8bbe\u7f6e\u72b6\u6001\u6210\u529f\uff0c\u90a3\u4e48\u5c06\u8fd4\u56de false\u3002\n     */\n    public final boolean tryAcquireNanos(int arg, long nanosTimeout)\n        throws InterruptedException {\n        if (!Thread.interrupted()) {\n            if (tryAcquire(arg))\n                return true;\n            if (nanosTimeout &lt;= 0L)\n                return false;\n            int stat = acquire(null, arg, false, true, true,\n                               System.nanoTime() + nanosTimeout);\n            if (stat &gt; 0)\n                return true;\n            if (stat == 0)\n                return false;\n        }\n        throw new InterruptedException();\n    }\n\n    public final boolean release(int arg) {\n        if (tryRelease(arg)) {\n            signalNext(head);\n            return true;\n        }\n        return false;\n    }\n\n    public final void acquireShared(int arg) {\n        if (tryAcquireShared(arg) &lt; 0)\n            acquire(null, arg, true, false, false, 0L);\n    }\n\n    public final void acquireSharedInterruptibly(int arg)\n        throws InterruptedException {\n        if (Thread.interrupted() ||\n            (tryAcquireShared(arg) &lt; 0 &amp;&amp;\n             acquire(null, arg, true, true, false, 0L) &lt; 0))\n            throw new InterruptedException();\n    }\n\n    public final boolean tryAcquireSharedNanos(int arg, long nanosTimeout)\n            throws InterruptedException {\n        if (!Thread.interrupted()) {\n            if (tryAcquireShared(arg) &gt;= 0)\n                return true;\n            if (nanosTimeout &lt;= 0L)\n                return false;\n            int stat = acquire(null, arg, true, true, true,\n                               System.nanoTime() + nanosTimeout);\n            if (stat &gt; 0)\n                return true;\n            if (stat == 0)\n                return false;\n        }\n        throw new InterruptedException();\n    }\n\n    public final boolean releaseShared(int arg) {\n        if (tryReleaseShared(arg)) {\n            signalNext(head);\n            return true;\n        }\n        return false;\n    }\n\n    // \u83b7\u53d6\u7b49\u5f85\u5728\u540c\u6b65\u961f\u5217\u4e0a\u7684\u7ebf\u7a0b\u96c6\u5408\n    public final Collection&lt;Thread&gt; getQueuedThreads() {\n        ArrayList&lt;Thread&gt; list = new ArrayList&lt;&gt;();\n        for (Node p = tail; p != null; p = p.prev) {\n            Thread t = p.waiter;\n            if (t != null)\n                list.add(t);\n        }\n        return list;\n    }\n</code></pre></p> <p>AQS \u7ee7\u627f\u4e86 AbstractOwnableSynchronizer \u7c7b\uff0cAbstractOwnableSynchronizer \u4e3b\u8981\u7684\u4f5c\u7528\u662f\u8bbe\u7f6e\u9501\u7684\u5f53\u524d\u6301\u6709\u7ebf\u7a0b\uff0c\u914d\u5408 AQS \u7684 state \u5b9e\u73b0\u9501\u7684\u53ef\u91cd\u5165\u529f\u80fd\u3002 <pre><code>public abstract class AbstractOwnableSynchronizer  \n    implements java.io.Serializable {  \n\n    /** Use serial ID even though all fields transient. */  \n    private static final long serialVersionUID = 3737899427754241961L;  \n\n    protected AbstractOwnableSynchronizer() { }  \n\n    private transient Thread exclusiveOwnerThread;  \n\n    protected final void setExclusiveOwnerThread(Thread thread) {  \n        exclusiveOwnerThread = thread;  \n    }  \n\n    protected final Thread getExclusiveOwnerThread() {  \n        return exclusiveOwnerThread;  \n    }  \n}\n</code></pre></p> <p>\u5728 ReentrantLock.NonfairSync#initialTryLock \u65b9\u6cd5\u4e2d\u53ef\u4ee5\u770b\u5230\u5bf9 AbstractOwnableSynchronizer \u7684\u4f7f\u7528\uff0c\u5982\u679c CAS \u6210\u529f\u5373\u83b7\u53d6\u9501\u6210\u529f\uff0c\u5219\u8c03\u7528 setExclusiveOwnerThread \u65b9\u6cd5\u8bbe\u7f6e\u9501\u7684\u6301\u6709\u7ebf\u7a0b\u3002 <pre><code>        final boolean initialTryLock() {\n            Thread current = Thread.currentThread();\n            if (compareAndSetState(0, 1)) { // first attempt is unguarded\n                setExclusiveOwnerThread(current);\n                return true;\n            } else if (getExclusiveOwnerThread() == current) {\n                int c = getState() + 1;\n                if (c &lt; 0) // overflow\n                    throw new Error(\"Maximum lock count exceeded\");\n                setState(c);\n                return true;\n            } else\n                return false;\n        }\n</code></pre></p>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#lock_1","title":"Lock \u63a5\u53e3","text":"<p>ReentrantLock \u7684\u4f5c\u7528\u548c synchronized \u5f88\u76f8\u4f3c\uff0c\u5b83\u4eec\u90fd\u5177\u5907\u53ef\u91cd\u5165\u7684\u7279\u6027\u3002\u4f46\u662f\u5b83\u4eec\u6709\u5982\u4e0b\u533a\u522b\uff1a</p> <ul> <li>\u4e00\u4e2a\u533a\u522b\u662f RenntranLock \u4e3a API \u5c42\u9762\u7684\u4e92\u65a5\u9501\uff0c\u9700\u8981 lock() \u548c unlock() \u914d\u5408 try/finally \u8bed\u5757\u6765\u5b8c\u6210\uff0c\u800c synchronized \u5219\u662f\u8bed\u6cd5\u5c42\u9762\u7684\u3002</li> <li>\u53e6\u4e00\u4e2a\u533a\u522b\u662f\uff0cReentranLock \u5177\u5907\u4e00\u4e9b\u9ad8\u7ea7\u529f\u80fd\uff1a\u9501\u5b9a\u53ef\u4e2d\u65ad lockIntettuptibly()\u3001\u53ef\u662f\u8bbe\u7f6e\u7b49\u5f85\u65f6\u95f4\u3001\u53ef\u5b9e\u73b0\u516c\u5e73\u9501\uff0c\u4ee5\u53ca\u9501\u53ef\u4ee5\u7ed1\u5b9a\u591a\u4e2a\u6761\u4ef6\u3002</li> </ul> <p>ReentrantLock \u5b9e\u73b0\u4e86 Lock \u63a5\u53e3\uff1a <pre><code>public interface Lock {  \n    void lock();  \n    void lockInterruptibly() throws InterruptedException;  \n\n    boolean tryLock();  \n    boolean tryLock(long time, TimeUnit unit) throws InterruptedException;  \n\n    void unlock(); \n\n    Condition newCondition();  \n}\n</code></pre></p> <p>ReentrantLock \u4fdd\u62a4\u4ee3\u7801\u5757\u7684\u57fa\u672c\u7ed3\u6784\uff1a <pre><code>myLock.lock();\ntry {\n     // critical section\n} finally {\n    myLock.unlock();\n}\n</code></pre></p> <p>\u4e3a\u4ec0\u4e48 myLock.lock() \u8bed\u53e5\u6ca1\u6709\u653e\u5728 try \u4ee3\u7801\u5757\u4e2d\uff1f</p> <p>\u56e0\u4e3a\u5982\u679c\u5728\u83b7\u53d6\u9501\uff08\u81ea\u5b9a\u4e49\u9501\u7684\u5b9e\u73b0\uff09\u65f6\u53d1\u751f\u4e86 \u5f02\u5e38\uff0c\u5f02\u5e38\u629b\u51fa\u7684\u540c\u65f6\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u9501\u65e0\u6545\u91ca\u653e\u3002</p>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#reentrantlock","title":"ReentrantLock","text":"<p>Sync \u7ee7\u627f AQS\uff0cNonfairSync \u548c FairSync \u7ee7\u627f Sync\uff0cSync\u3001NonfairSync \u548c FairSync \u5747\u4e3a ReentrantLock \u7684\u5185\u90e8\u7c7b\u3002 </p> <p>ReentrantLock \u9ed8\u8ba4\u662f\u975e\u516c\u5e73\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u6784\u9020\u51fd\u6570\u6307\u5b9a\u4e3a\u516c\u5e73\u9501\u3002 <pre><code>    public ReentrantLock() {\n        sync = new NonfairSync();\n    }\n\n    public ReentrantLock(boolean fair) {\n        sync = fair ? new FairSync() : new NonfairSync();\n    }\n</code></pre></p> <p>ReentrantLock \u9996\u6b21\u52a0\u9501\u7684\u903b\u8f91\uff1a <pre><code>// \u8c03\u7528 sync.lock() \u65b9\u6cd5\uff0csync \u9ed8\u8ba4\u662f NonfairSync \u7684\u5b9e\u4f8b\npublic void lock() {  \n    sync.lock();  \n}\n\n// Sync \u7c7b\u7684 lock \u65b9\u6cd5\uff0c\u5148\u5c1d\u8bd5 initialTryLock()\n@ReservedStackAccess  \nfinal void lock() {  \n    if (!initialTryLock())  \n        acquire(1);  \n}\n\n// NonfairSync \u5b9e\u73b0\u4e86 Sync \u5b9a\u4e49\u7684 initialTryLock \u65b9\u6cd5\nfinal boolean initialTryLock() {  \n    Thread current = Thread.currentThread();  \n    if (compareAndSetState(0, 1)) { // CAS \u5c1d\u8bd5\u83b7\u53d6\u9501\uff0c\u5047\u8bbe\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u76f4\u63a5\u83b7\u53d6\u6210\u529f\n        setExclusiveOwnerThread(current);  // \u83b7\u9501\u6210\u529f\u7684\u7ebf\u7a0b\u76f4\u63a5\u8bbe\u7f6e\u9501\u7684\u5360\u6709\u7ebf\u7a0b\u4e3a\u5f53\u524d\u7ebf\u7a0b\n        return true;  // \u8fd4\u56de true\uff0c\u8fdb\u800c\u4ece ReentrantLock.lock() \u8fd4\u56de\uff0c\u7ee7\u7eed\u6267\u884c\u540e\u7eed\u4ee3\u7801 \n    } else if (getExclusiveOwnerThread() == current) {  // CAS \u83b7\u53d6\u9501\u5931\u8d25\uff0c\u5224\u65ad\u9501\u7684\u6301\u6709\u8005\u662f\u4e0d\u662f\u5f53\u524d\u7ebf\u7a0b\n        int c = getState() + 1;  // \u5982\u679c\u9501\u7684\u6301\u6709\u8005\u662f\u5f53\u524d\u7ebf\u7a0b\u5c06 state + 1\n        if (c &lt; 0) // overflow  \n            throw new Error(\"Maximum lock count exceeded\");  \n        setState(c);  // \u8bbe\u7f6e state \u7684\u503c\uff0c\u56e0\u4e3a\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u9501\uff0c\u6240\u4ee5\u8fd9\u91cc\u4fee\u6539 state \u7684\u503c\u4e0d\u9700\u8981\u989d\u5916\u7684\u9501\u6765\u4fdd\u62a4\n        return true;  // \u8fd4\u56de true\uff0c\u8fdb\u800c\u4ece ReentrantLock.lock() \u8fd4\u56de\n    } else  \n        return false;  // \u8868\u793a\u5f53\u524d\u9501\u5df2\u88ab\u5176\u5b83\u7ebf\u7a0b\u6301\u6709\n}\n</code></pre></p> <p>\u5982\u679c\u9501\u5df2\u7ecf\u88ab\u5176\u5b83\u7ebf\u7a0b\u6301\u6709\uff0c\u83b7\u53d6\u9501\u548c\u91ca\u653e\u9501\u7684\u903b\u8f91\uff1a <pre><code>// \u8c03\u7528 sync.lock() \u65b9\u6cd5\uff0csync \u9ed8\u8ba4\u662f NonfairSync \u7684\u5b9e\u4f8b\npublic void lock() {  \n    sync.lock();  \n}\n\n// Sync \u7c7b\u7684 lock \u65b9\u6cd5\uff0c\u5148\u5c1d\u8bd5 initialTryLock()\n@ReservedStackAccess  \nfinal void lock() {  \n    if (!initialTryLock())  // \u5982\u679c\u9501\u5df2\u7ecf\u88ab\u6301\u6709\uff0c\u8fd4\u56de false\uff0c\u8fdb\u5165 acquire\n        acquire(1);  \n}\n\n// AQS \u7684 acquire \u65b9\u6cd5\npublic final void acquire(int arg) {  \n    if (!tryAcquire(arg))  // \u518d\u6b21\u5c1d\u8bd5\u83b7\u53d6\u9501  \n        acquire(null, arg, false, false, false, 0L);  \n}\n\n// NofairSync \u7684 tryAcquire \u65b9\u6cd5\nprotected final boolean tryAcquire(int acquires) {  \n    if (getState() == 0 &amp;&amp; compareAndSetState(0, acquires)) {  // \u5982\u679c\u6b64\u65f6\u9501\u5df2\u7ecf\u88ab\u88ab\u91ca\u653e\u5e76\u4e14 CAS \u83b7\u53d6\u6210\u529f\u7684\u8bdd\n        setExclusiveOwnerThread(Thread.currentThread());  // \u8bbe\u7f6e\u9501\u7684\u6301\u6709\u7ebf\u7a0b\u4e3a\u5f53\u524d\u7ebf\u7a0b\n        return true;  // \u8fd4\u56de true\uff0c\u4ece AQS \u7684 acquire \u8fd4\u56de\uff0c\u8fdb\u800c\u4ece ReentrantLock.lock() \u8fd4\u56de\n    }  \n    return false;  // \u5982\u679c\u9501\u7ee7\u7eed\u88ab\u5176\u5b83\u7ebf\u7a0b\u6301\u6709\uff0c\u8fd4\u56de false\uff0c\u8fdb\u5165 AQS \u7684 acquire \u65b9\u6cd5\n}\n\n// AQS \u7684 acquire \u65b9\u6cd5\uff0c\u4e3b\u8981\u662f\u8fdb\u884c\u7b49\u5f85\u961f\u5217\u7684\u5904\u7406\nfinal int acquire(Node node, int arg, boolean shared,  \n                  boolean interruptible, boolean timed, long time) {  \n    Thread current = Thread.currentThread();  \n    byte spins = 0, postSpins = 0;   // retries upon unpark of first thread  \n    boolean interrupted = false, first = false;  // first \u8868\u793a\u5f53\u524d\u8282\u70b9\u662f\u5426\u662f\u7b2c\u4e00\u4e2a\u8fdb\u5165\u7b49\u5f85\u961f\u5217\u7684\u8282\u70b9\u7ebf\u7a0b\n    Node pred = null;               // predecessor of node when enqueued  \u5f53\u524d\u8282\u70b9\u7684\u524d\u9a71\u8282\u70b9\n\n    for (;;) {  \n        if (!first &amp;&amp; (pred = (node == null) ? null : node.prev) != null &amp;&amp; !(first = (head == pred))) {  \n            if (pred.status &lt; 0) {  \n                cleanQueue();           // predecessor cancelled  \n                continue;  \n            } else if (pred.prev == null) {  \n                Thread.onSpinWait();    // ensure serialization  \n                continue;  \n            }  \n        }  \n        if (first || pred == null) {  // \u8fdb\u5165\u8fd9\u91cc\n            boolean acquired;  \n            try {  \n                if (shared)  \n                    acquired = (tryAcquireShared(arg) &gt;= 0);  \n                else  \n                    acquired = tryAcquire(arg); // \u518d\u6b21\u8fdb\u5165 NonfairSync \n            } catch (Throwable ex) {  \n                cancelAcquire(node, interrupted, false);  \n                throw ex;  \n            }  \n            if (acquired) {  // \u5982\u679c\u83b7\u53d6\u9501\u6210\u529f\n                if (first) {  // \u5982\u679c\u9501\u4f20\u9012\u7ed9\u5f53\u524d\u7684\u5934\u8282\u70b9\uff0c\u8fdb\u884c\u7ef4\u62a4\u961f\u5217\u7684\u64cd\u4f5c\uff0c\u961f\u5217\u7684\u5e76\u53d1\u64cd\u4f5c\uff0c\u5934\u8282\u70b9\u7684\u91ca\u653e\u7531\u9501\u6765\u4fdd\u62a4\n                    node.prev = null;  \n                    head = node;  \n                    pred.next = null;  \n                    node.waiter = null;  \n                    if (shared)  \n                        signalNextIfShared(node);  \n                    if (interrupted)  \n                        current.interrupt();  \n                }  \n                return 1;  \n            }  \n        }  \n        Node t;  \n        if ((t = tail) == null) {           // initialize queue  \u7b2c\u4e00\u6b21\u5faa\u73af\u8fdb\u5165\u8fd9\u91cc\uff0c\u521d\u59cb\u5316\u961f\u5217\n            if (tryInitializeHead() == null)  // \u521d\u59cb\u5316\u961f\u5217\uff0chead tail\n                return acquireOnOOME(shared, arg);  \n        } else if (node == null) {          // allocate; retry before enqueue // \u7b2c\u4e8c\u6b21\u5faa\u73af\u8fdb\u5165\u8fd9\u91cc\uff0c\u521d\u59cb\u5f53\u524d\u8282\u70b9\n            try {  \n                node = (shared) ? new SharedNode() : new ExclusiveNode();  \n            } catch (OutOfMemoryError oome) {  \n                return acquireOnOOME(shared, arg);  \n            }  \n        } else if (pred == null) {          // try to enqueue  //\u7b2c\u4e09\u6b21\u5faa\u73af\u8fdb\u5165\u8fd9\u91cc\uff0c\u8bbe\u7f6e\u8282\u70b9\u7684\u524d\u9a71\uff0c\u5e76\u8bbe\u7f6e\u5f53\u524d\u8282\u70b9\u4e3a\u5c3e\u8282\u70b9\n            node.waiter = current;  \n            node.setPrevRelaxed(t);         // avoid unnecessary fence  \n            if (!casTail(t, node))  // \u961f\u5217\u7684\u5e76\u53d1\u64cd\u4f5c\uff0c\u5c3e\u8282\u70b9\u7684\u6dfb\u52a0\u7531 CAS \u64cd\u4f5c\u6765\u786e\u4fdd\u539f\u5b50\u6027\n                node.setPrevRelaxed(null);  // back out  \n            else  \n                t.next = node;  \n        } else if (first &amp;&amp; spins != 0) {  \n            --spins;                        // reduce unfairness on rewaits  \n            Thread.onSpinWait();  \n        } else if (node.status == 0) {  // \u8bbe\u7f6e\u8282\u70b9\u7684\u72b6\u6001\u4e3a WAITING\n            node.status = WAITING;          // enable signal and recheck  \n        } else {  // \u6700\u540e\u8fdb\u5165 park\n            long nanos;  \n            spins = postSpins = (byte)((postSpins &lt;&lt; 1) | 1);  \n            if (!timed)  \n                LockSupport.park(this);  \n            else if ((nanos = time - System.nanoTime()) &gt; 0L)  \n                LockSupport.parkNanos(this, nanos);  \n            else  \n                break;  \n            node.clearStatus();  \n            if ((interrupted |= Thread.interrupted()) &amp;&amp; interruptible)  \n                break;  \n        }  \n    }  \n    return cancelAcquire(node, interrupted, interruptible);  \n}\n\n// AQS \u521d\u59cb\u5316\u7b49\u5f85\u961f\u5217\nprivate Node tryInitializeHead() {  \n    for (Node h = null, t;;) {  \n        if ((t = tail) != null)  \n            return t;  \n        else if (head != null)  \n            Thread.onSpinWait();  \n        else {  \n            if (h == null) {  \n                try {  \n                    h = new ExclusiveNode();  // \u521d\u59cb\u5316\u5934\u8282\u70b9\n                } catch (OutOfMemoryError oome) {  \n                    return null;  \n                }  \n            }  \n            if (U.compareAndSetReference(this, HEAD, null, h))  // \u5934\u8282\u70b9\u8bbe\u7f6e\u4e3a HEAD\n                return tail = h;  // \u5c3e\u8282\u70b9\u4e5f\u6307\u5411 HEAD\n        }  \n    }  \n}\n\n// ReentrantLock \u7684 unlock \u65b9\u6cd5\npublic void unlock() {  \n    sync.release(1);  \n}\n\n// \u8fdb\u5165\u5230 AQS \u91cc\u9762\npublic final boolean release(int arg) {  \n    if (tryRelease(arg)) {  \n        signalNext(head);  \n        return true;  \n    }  \n    return false;  \n}\n\n// Sync \u7684 tryRelease\n@ReservedStackAccess  \nprotected final boolean tryRelease(int releases) {  \n    int c = getState() - releases;  \n    if (getExclusiveOwnerThread() != Thread.currentThread())  \n        throw new IllegalMonitorStateException();  \n    boolean free = (c == 0);  \n    if (free)  \n        setExclusiveOwnerThread(null);  \n    setState(c);  \n    return free;  \n}\n\n// AQS \u7684\u5524\u9192\u64cd\u4f5c\uff0c\u5524\u9192\u4e0b\u4e00\u4e2a\u8282\u70b9\nprivate static void signalNext(Node h) {  \n    Node s;  \n    if (h != null &amp;&amp; (s = h.next) != null &amp;&amp; s.status != 0) {  \n        s.getAndUnsetStatus(WAITING);  \n        LockSupport.unpark(s.waiter);  \n    }  \n}\n</code></pre></p> <p>\u516c\u5e73\u9501\u548c\u975e\u516c\u5e73\u9501\u7684\u533a\u522b\uff1a <pre><code>static final class NonfairSync extends Sync {  \n    private static final long serialVersionUID = 7316153563782823691L;  \n\n    final boolean initialTryLock() {  \n        Thread current = Thread.currentThread();  \n        if (compareAndSetState(0, 1)) { // first attempt is unguarded  \u975e\u516c\u5e73\u9501\u8fdb\u6765\u5c31\u5c1d\u8bd5\u83b7\u53d6\u9501\uff0c\u4e0d\u7ba1\u5f53\u524d\u7684\u72b6\u6001\u5982\u4f55\n            setExclusiveOwnerThread(current);  \n            return true;  \n        } else if (getExclusiveOwnerThread() == current) {  \n            int c = getState() + 1;  \n            if (c &lt; 0) // overflow  \n                throw new Error(\"Maximum lock count exceeded\");  \n            setState(c);  \n            return true;  \n        } else  \n            return false;  \n    }  \n\n    /**  \n     * Acquire for non-reentrant cases after initialTryLock prescreen     */    \n    protected final boolean tryAcquire(int acquires) {  // \u81ea\u65cb\u83b7\u53d6\u9501\u7684\u65f6\u5019\u5148\u5224\u65ad state \u72b6\u6001\uff0c\u7136\u540e\u518d\u5c1d\u8bd5\u83b7\u53d6\u9501\n        if (getState() == 0 &amp;&amp; compareAndSetState(0, acquires)) {  \n            setExclusiveOwnerThread(Thread.currentThread());  \n            return true;  \n        }  \n        return false;  \n    }  \n}\n\nstatic final class FairSync extends Sync {  \n    private static final long serialVersionUID = -3000897897090466540L;  \n\n    /**  \n     * Acquires only if reentrant or queue is empty.     */    \n    final boolean initialTryLock() {  \n        Thread current = Thread.currentThread();  \n        int c = getState();  \n        if (c == 0) {  // \u516c\u5e73\u9501\u9996\u6b21\u83b7\u53d6\u9501\u7684\u65f6\u5019\u5224\u65ad\u72b6\u6001\n            if (!hasQueuedThreads() &amp;&amp; compareAndSetState(0, 1)) {  // \u7136\u540e\u8fd8\u8981\u5224\u65ad\u662f\u5426\u6709\u7b49\u5f85\u7ebf\u7a0b\n                setExclusiveOwnerThread(current);  \n                return true;  \n            }  \n        } else if (getExclusiveOwnerThread() == current) {  \n            if (++c &lt; 0) // overflow  \n                throw new Error(\"Maximum lock count exceeded\");  \n            setState(c);  \n            return true;  \n        }  \n        return false;  \n    }  \n\n    /**  \n     * Acquires only if thread is first waiter or empty     */    \n    protected final boolean tryAcquire(int acquires) {  \n        if (getState() == 0 &amp;&amp; !hasQueuedPredecessors() &amp;&amp;  // \u81ea\u65cb\u83b7\u53d6\u9501\u7684\u65f6\u5019\u4e5f\u662f\u8981\u5224\u65ad\u72b6\u6001\uff0c\u5224\u65ad\u7b49\u5f85\u7ebf\u7a0b\n            compareAndSetState(0, acquires)) {  \n            setExclusiveOwnerThread(Thread.currentThread());  \n            return true;  \n        }  \n        return false;  \n    }  \n}\n</code></pre></p>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#reentrantreadwritelock","title":"ReentrantReadWriteLock","text":"<p>Sync\u3001ReadLock\u3001WriteLock\u3001NonfairSync \u548c FairSync \u5747\u4e3a ReentrantReadWriteLock \u7684\u5185\u90e8\u7c7b\u3002  ReadWriteLock \u63a5\u53e3\u7684\u5b9a\u4e49\uff1a <pre><code>public interface ReadWriteLock {\n    Lock readLock();\n\n    Lock writeLock();\n}\n</code></pre></p> <p>\u8bfb\u5199\u9501\u7684\u7ecf\u5178\u7528\u6cd5\uff1a <pre><code>class RWDictionary {\n    private final Map&lt;String, Data&gt; m = new TreeMap&lt;&gt;();\n    private final ReentrantReadWriteLock rwl = new ReentrantReadWriteLock();\n    private final Lock r = rwl.readLock();\n    private final Lock w = rwl.writeLock();\n\n    public Data get(String key) {\n        r.lock();\n        try {\n            return m.get(key);\n        } finally {\n            r.unlock();\n        }\n    }\n\n    public List&lt;String&gt; allKeys() {\n        r.lock();\n        try {\n            return new ArrayList&lt;&gt;(m.keySet());\n        } finally {\n            r.unlock();\n        }\n    }\n\n    public Data put(String key, Data value) {\n        w.lock();\n        try {\n            return m.put(key, value);\n        } finally {\n            w.unlock();\n        }\n    }\n\n    public void clear() {\n        w.lock();\n        try {\n            m.clear();\n        } finally {\n            w.unlock();\n        }\n    }\n}\n</code></pre></p> <ul> <li> <p>\u5f53\u8bfb\u5199\u9501\u5904\u4e8e\u5199\u52a0\u9501\u72b6\u6001\u65f6\uff0c\u6240\u6709\u8bd5\u56fe\u52a0\u9501\u7684\u7ebf\u7a0b\u90fd\u4f1a\u88ab\u963b\u585e\u3002</p> </li> <li> <p>\u5f53\u8bfb\u5199\u9501\u5904\u4e8e\u8bfb\u52a0\u901f\u72b6\u6001\u65f6\uff0c\u6240\u6709\u8bd5\u56fe\u4ee5\u8bfb\u6a21\u5f0f\u83b7\u53d6\u9501\u7684\u7ebf\u7a0b\u90fd\u4f1a\u6210\u529f\uff0c\u4f46\u662f\u4efb\u4f55\u5e0c\u671b\u4ee5\u5199\u6a21\u5f0f\u52a0\u9501\u7684\u7ebf\u7a0b\u90fd\u4f1a\u88ab\u963b\u585e\u76f4\u5230\u6240\u6709\u7684\u7ebf\u7a0b\u90fd\u91ca\u653e\u5b83\u4eec\u7684\u8bfb\u9501\u4e3a\u6b62\u3002</p> </li> </ul> <p>\u8bfb\u5199\u9501\u7684\u72b6\u6001\u8bbe\u8ba1 AQS \u4e2d\u53ea\u6709\u4e00\u4e2a int \u7c7b\u578b\u7684 state \u53d8\u91cf\u8868\u793a\u9501\u7684\u72b6\u6001\uff0cReentrantReadWriteLock \u4f7f\u7528 state \u53d8\u91cf\u7684\u9ad8 16 \u4f4d\u8868\u793a\u8bfb\u9501\u7684\u83b7\u53d6\uff08\u6216\u8005\u91cd\u5165\uff09\u7684\u6b21\u6570\uff0c\u4f7f\u7528 state \u53d8\u91cf\u7684\u4f4e 16 \u4f4d\u8868\u793a\u5199\u9501\u7684\u83b7\u53d6\uff08\u6216\u8005\u91cd\u5165\uff09\u6b21\u6570\u3002</p> <p>ReentrantReadWriteLock \u4e2d\u7684\u4ee3\u7801\u5b9e\u73b0\uff1a <pre><code>// \u4f20\u5165 state \u83b7\u53d6\u8bfb\u9501\u7684\u83b7\u53d6\uff08\u6216\u8005\u91cd\u5165\uff09\u7684\u6b21\u6570\nstatic int sharedCount(int c)    { return c &gt;&gt;&gt; 16; }  // \u65e0\u7b26\u53f7\u53f3\u79fb\uff0c\u4f7f\u7528 0 \u586b\u5145\u9ad8\u4f4d\n\n// \u4f20\u5165 state \u83b7\u53d6\u5199\u9501\u7684\u83b7\u53d6\uff08\u6216\u8005\u91cd\u5165\uff09\u7684\u6b21\u6570\nstatic int exclusiveCount(int c) { return c &amp; 0x0000ffff; }\n</code></pre></p> <p>\u8bfb\u5199\u9501\u7684\u521d\u59cb\u5316 <pre><code>    /** Inner class providing readlock */\n    private final ReentrantReadWriteLock.ReadLock readerLock;\n    /** Inner class providing writelock */\n    private final ReentrantReadWriteLock.WriteLock writerLock;\n    /** Performs all synchronization mechanics */\n    final Sync sync;\n\n    public ReentrantReadWriteLock() {\n        this(false); // \u9ed8\u8ba4\u975e\u516c\u5e73\u9501\n    }\n\n    public ReentrantReadWriteLock(boolean fair) {\n        sync = fair ? new FairSync() : new NonfairSync();\n        readerLock = new ReadLock(this);\n        writerLock = new WriteLock(this);\n    }\n</code></pre></p> <p>\u5199\u9501\u7684\u52a0\u9501\u903b\u8f91\uff1a <pre><code>// WriteLock \u7684 lock \u65b9\u6cd5\npublic void lock() {  \n    sync.acquire(1);  \n}\n\n// \u8fdb\u5165\u5230 AQS \u7684 acquire \u65b9\u6cd5\npublic final void acquire(int arg) {  \n    if (!tryAcquire(arg))  \n        acquire(null, arg, false, false, false, 0L);  \n}\n\n// \u8fdb\u5165 Sync \u7684 tryAcquire \u65b9\u6cd5\nprotected final boolean tryAcquire(int acquires) {  \n    /*  \n     * Walkthrough:     \n     * 1. If read count nonzero or write count nonzero     \n     *    and owner is a different thread, fail.     \n     * 2. If count would saturate, fail. (This can only     \n     *    happen if count is already nonzero.)     \n     * 3. Otherwise, this thread is eligible for lock if     \n     *    it is either a reentrant acquire or     \n     *    queue policy allows it. If so, update state     \n     *    and set owner.     \n     * */    \n    Thread current = Thread.currentThread();  \n    int c = getState();  \n    int w = exclusiveCount(c);  // \u83b7\u53d6\u5199\u9501\u7684\u503c\n    if (c != 0) {  // \u6709\u9501\u7684\u60c5\u51b5\u4e0b\n        // (Note: if c != 0 and w == 0 then shared count != 0)  \n        // w == 0 \u5224\u65ad\u662f\u5426\u6709\u8bfb\u9501\uff0c\u5982\u679c\u6ca1\u6709\u8bfb\u9501\u8868\u793a\u6709\u5199\u9501\uff0c\u7136\u540e\u5224\u65ad\u662f\u5426\u662f\u5f53\u524d\u7ebf\u7a0b\u6301\u6709\n        if (w == 0 || current != getExclusiveOwnerThread())\n            return false;  \n        if (w + exclusiveCount(acquires) &gt; MAX_COUNT)  // \u5982\u679c\u524d\u9762\u4e00\u4e2a if \u6ca1\u6709\u8fdb\u5165\u8868\u660e\u5f53\u524d\u7ebf\u7a0b\u6301\u6709\u5199\u9501\n            throw new Error(\"Maximum lock count exceeded\");  \n        // Reentrant acquire  \n        setState(c + acquires);  // \u524d\u9762\u4e2a\u4e24\u4e2a\u90fd\u8fc7\u4e86\uff0c\u8868\u793a\u6ca1\u6709\u95ee\u9898\uff0c\u66f4\u65b0 state \u7684\u503c\u8fd4\u56de true\n        return true;    \n    }  \n\n    // writerShouldBlock \u65b9\u6cd5\uff0cFairSync \u9501\u5224\u65ad\u662f\u5426\u6709\u524d\u9a71\u8282\u70b9\uff0cNonfairSync \u76f4\u63a5\u8fd4\u56de false\n    // CAS \u8fdb\u884c\u5c1d\u8bd5\u83b7\u53d6\u9501\n    if (writerShouldBlock() || !compareAndSetState(c, c + acquires))  \n        return false;  // \u83b7\u53d6\u9501\u5931\u8d25\n    setExclusiveOwnerThread(current); // \u83b7\u53d6\u9501\u6210\u529f  \n    return true;\n}\n\n// \u8fdb\u5165 acquire \u4e4b\u540e\u7684\u903b\u8f91\u548c ReentrantLock \u4e00\u6837\u4e86\n</code></pre></p> <p>\u5199\u9501\u7684\u91ca\u653e\u903b\u8f91\u548c ReentrantLock \u4e00\u81f4\u3002</p> <p>Sync \u8bfb\u9501\u76f8\u5173\u7684\u53d8\u91cf\uff1a <pre><code>        /**\n         * A counter for per-thread read hold counts.\n         * Maintained as a ThreadLocal; cached in cachedHoldCounter.\n         */\n        // \u8bb0\u5f55\u6bcf\u4e2a\u83b7\u53d6\u8bfb\u9501\u7684\u7ebf\u7a0b\u91cd\u5165\u7684\u6b21\u6570\n        static final class HoldCounter {\n            int count;          // \u9ed8\u8ba4\u521d\u59cb\u5316\u4e3a 0\n            // Use id, not reference, to avoid garbage retention\n            final long tid = LockSupport.getThreadId(Thread.currentThread());\n        }\n\n        /**\n         * ThreadLocal subclass. Easiest to explicitly define for sake\n         * of deserialization mechanics.\n         */\n        // \u81ea\u5b9a\u4e49 ThreadLock \u7f13\u5b58 HoldCounter\n        static final class ThreadLocalHoldCounter\n            extends ThreadLocal&lt;HoldCounter&gt; {\n            public HoldCounter initialValue() {\n                return new HoldCounter();\n            }\n        }\n\n        /**\n         * The number of reentrant read locks held by current thread.\n         * Initialized only in constructor and readObject.\n         * Removed whenever a thread's read hold count drops to 0.\n         */\n        private transient ThreadLocalHoldCounter readHolds;\n\n        /**\n         * The hold count of the last thread to successfully acquire\n         * readLock. This saves ThreadLocal lookup in the common case\n         * where the next thread to release is the last one to\n         * acquire. This is non-volatile since it is just used\n         * as a heuristic, and would be great for threads to cache.\n         *\n         * &lt;p&gt;Can outlive the Thread for which it is caching the read\n         * hold count, but avoids garbage retention by not retaining a\n         * reference to the Thread.\n         *\n         * &lt;p&gt;Accessed via a benign data race; relies on the memory\n         * model's final field and out-of-thin-air guarantees.\n         */\n\n        private transient HoldCounter cachedHoldCounter;\n\n        // \u6307\u5411\u7b2c\u4e00\u4e2a\u83b7\u53d6\u8bfb\u9501\u7684\u7ebf\u7a0b\n        private transient Thread firstReader;\n        // \u7b2c\u4e00\u4e2a\u83b7\u53d6\u8bfb\u9501\u7684\u7ebf\u7a0b\u91cd\u5165\u7684\u6b21\u6570\n        private transient int firstReaderHoldCount;\n</code></pre></p> <p>\u8bfb\u9501\u7684\u52a0\u9501\u903b\u8f91\uff1a <pre><code>// ReadLock \u7684 lock \u65b9\u6cd5\npublic void lock() {  \n    sync.acquireShared(1);  \n}\n\n// \u8fdb\u5165 AQS \u7684 acquireShared \u65b9\u6cd5\npublic final void acquireShared(int arg) {  \n    if (tryAcquireShared(arg) &lt; 0)  \n        acquire(null, arg, true, false, false, 0L);  \n}\n\n// \u8fdb\u5165 Sync \u7684 tryAcquireShared \u65b9\u6cd5\n@ReservedStackAccess  \nprotected final int tryAcquireShared(int unused) {  \n    /*  \n     * Walkthrough:     \n     * 1. If write lock held by another thread, fail.     \n     * 2. Otherwise, this thread is eligible for     \n     *    lock wrt state, so ask if it should block     \n     *    because of queue policy. If not, try     \n     *    to grant by CASing state and updating count.     \n     *    Note that step does not check for reentrant     \n     *    acquires, which is postponed to full version     \n     *    to avoid having to check hold count in     \n     *    the more typical non-reentrant case.     \n     * 3. If step 2 fails either because thread     \n     *    apparently not eligible or CAS fails or count     \n     *    saturated, chain to version with full retry loop.     \n     * */    \n    Thread current = Thread.currentThread();  \n    int c = getState();  \n    // \u5199\u9501\u88ab\u6301\u6709\u4f46\u662f\u4e0d\u662f\u5f53\u524d\u7ebf\u7a0b\n    if (exclusiveCount(c) != 0 &amp;&amp;  getExclusiveOwnerThread() != current)  \n        return -1;  \n    int r = sharedCount(c);  // \u83b7\u53d6\u8bfb\u9501\u83b7\u53d6\u6b21\u6570\n    // \u5c1d\u8bd5\u83b7\u53d6\u9501\n    if (!readerShouldBlock() &amp;&amp;  \n        r &lt; MAX_COUNT &amp;&amp;  \n        compareAndSetState(c, c + SHARED_UNIT)) {  \n        if (r == 0) {  // \u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u662f\u7b2c\u4e00\u4e2a\u83b7\u53d6\u8bfb\u9501\u7684\u7ebf\u7a0b\n            firstReader = current;  \n            firstReaderHoldCount = 1;  \n        } else if (firstReader == current) {  // \u7b2c\u4e00\u4e2a\u83b7\u53d6\u8bfb\u9501\u7684\u7ebf\u7a0b\u53c8\u83b7\u53d6\u8bfb\u9501\u6210\u529f\n            firstReaderHoldCount++;  \n        } else {  // \u5f53\u524d\u7ebf\u7a0b\u83b7\u53d6\u8bfb\u9501\u6210\u529f\uff0c\u5f53\u524d\u7ebf\u7a0b\u4e0d\u662f\u7b2c\u4e00\u4e2a\u83b7\u53d6\u8bfb\u9501\u6210\u529f\u7684\u7ebf\u7a0b\n            HoldCounter rh = cachedHoldCounter;  \n            // \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u7684 HoldCounter\n            if (rh == null || rh.tid != LockSupport.getThreadId(current))  \n                cachedHoldCounter = rh = readHolds.get();  \n            else if (rh.count == 0)  \n                readHolds.set(rh);  \n            rh.count++;  // \u5f53\u524d\u7ebf\u7a0b\u83b7\u53d6\u8bfb\u9501\u7684\u6b21\u6570\u52a0 1\n        }  \n        return 1;  \n    }  \n    // \u6ca1\u6709\u83b7\u53d6\u8bfb\u9501\u6210\u529f\n    return fullTryAcquireShared(current);  \n}\n\nfinal int fullTryAcquireShared(Thread current) {  \n    /*  \n     * This code is in part redundant with that in     \n     * tryAcquireShared but is simpler overall by not     \n     * complicating tryAcquireShared with interactions between     \n     * retries and lazily reading hold counts.     */    \n    HoldCounter rh = null;  \n    for (;;) {  // \u901a\u8fc7 for \u5faa\u73af\u4e00\u76f4\u5c1d\u8bd5\u83b7\u53d6\u9501\n        int c = getState();  \n        if (exclusiveCount(c) != 0) {  \n            if (getExclusiveOwnerThread() != current)  \n                return -1;  \n            // else we hold the exclusive lock; blocking here  \n            // would cause deadlock.        \n        } else if (readerShouldBlock()) {  \n            // Make sure we're not acquiring read lock reentrantly  \n            if (firstReader == current) {  \n                // assert firstReaderHoldCount &gt; 0;  \n            } else {  \n                if (rh == null) {  \n                    rh = cachedHoldCounter;  \n                    if (rh == null ||  \n                        rh.tid != LockSupport.getThreadId(current)) {  \n                        rh = readHolds.get();  \n                        if (rh.count == 0)  \n                            readHolds.remove();  \n                    }  \n                }  \n                if (rh.count == 0)  \n                    return -1;  \n            }  \n        }  \n        if (sharedCount(c) == MAX_COUNT)  \n            throw new Error(\"Maximum lock count exceeded\");  \n        if (compareAndSetState(c, c + SHARED_UNIT)) {  \n            if (sharedCount(c) == 0) {  \n                firstReader = current;  \n                firstReaderHoldCount = 1;  \n            } else if (firstReader == current) {  \n                firstReaderHoldCount++;  \n            } else {  \n                if (rh == null)  \n                    rh = cachedHoldCounter;  \n                if (rh == null ||  \n                    rh.tid != LockSupport.getThreadId(current))  \n                    rh = readHolds.get();  \n                else if (rh.count == 0)  \n                    readHolds.set(rh);  \n                rh.count++;  \n                cachedHoldCounter = rh; // cache for release  \n            }  \n            return 1;  \n        }  \n    }  \n}\n\n// ReentrantReadWriteLock\npublic void unlock() {  \n    sync.releaseShared(1);  \n}\n\n// AQS \npublic final boolean releaseShared(int arg) {  \n    if (tryReleaseShared(arg)) {  \n        signalNext(head);  \n        return true;    }  \n    return false;  \n}\n\n// Sync\n@ReservedStackAccess  \nprotected final boolean tryReleaseShared(int unused) {  \n    Thread current = Thread.currentThread();  \n    if (firstReader == current) {  \n        // assert firstReaderHoldCount &gt; 0;  \n        if (firstReaderHoldCount == 1)  \n            firstReader = null;  \n        else            \n            firstReaderHoldCount--;  \n    } else {  \n        HoldCounter rh = cachedHoldCounter;  \n        if (rh == null ||  \n            rh.tid != LockSupport.getThreadId(current))  \n            rh = readHolds.get();  \n        int count = rh.count;  \n        if (count &lt;= 1) {  \n            readHolds.remove();  \n            if (count &lt;= 0)  \n                throw unmatchedUnlockException();  \n        }  \n        --rh.count;  \n    }  \n    for (;;) {  \n        int c = getState();  \n        int nextc = c - SHARED_UNIT;  \n        if (compareAndSetState(c, nextc))  \n            // Releasing the read lock has no effect on readers,  \n            // but it may allow waiting writers to proceed if            \n            // both read and write locks are now free.            \n            return nextc == 0;  \n    }  \n}\n</code></pre></p>"},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#futurecallable","title":"Future/Callable","text":""},{"location":"Java/Java%20%E5%B9%B6%E5%8F%91/#_7","title":"\u7ebf\u7a0b\u6c60","text":""},{"location":"Java/Java%20%E6%89%93%E5%8C%85/","title":"Java \u6253\u5305","text":""},{"location":"Java/Java%20%E6%89%93%E5%8C%85/#jar","title":"jar","text":"<p><code>jar</code> \u547d\u4ee4\u662f Java \u63d0\u4f9b\u7684\uff0c\u7528\u4e8e\u521b\u5efa\u3001\u66f4\u65b0\u3001\u67e5\u770b\u548c\u63d0\u53d6 JAR \u6587\u4ef6\u3002</p> <p>\u521b\u5efa JAR \u6587\u4ef6 <pre><code>jar cvfm my.jar META-INF/MANIFEST.MF -C classes . -C resources .\n\nc: \u521b\u5efa\u65b0\u7684 JAR \u6587\u4ef6\u3002\nv: \u5728\u6807\u51c6\u8f93\u51fa\u4e2d\u751f\u6210\u8be6\u7ec6\u8f93\u51fa\u3002\nf: \u6307\u5b9a JAR \u6587\u4ef6\u7684\u540d\u79f0\u3002\nm: \u6307\u5b9a MANIFEST.MF \u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u5305\u542b\u4e86 JAR \u6587\u4ef6\u7684\u4e00\u4e9b\u5143\u6570\u636e\u3002\n-C: \u5207\u6362\u5230\u6307\u5b9a\u7684\u76ee\u5f55\uff0c[.] \u8868\u793a\u5c06\u8be5\u76ee\u5f55\u4e2d\u7684\u6240\u6709\u6587\u4ef6\u6dfb\u52a0\u5230 JAR \u4e2d\u3002\n</code></pre></p> <p>\u67e5\u770b JAR \u6587\u4ef6 <pre><code>jar tf my.jar\n\nt: \u5217\u51fa JAR \u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u3002\n</code></pre></p> <p>\u63d0\u53d6 JAR \u6587\u4ef6 <pre><code>jar xf my.jar\n\nx: \u4ece JAR \u6587\u4ef6\u4e2d\u63d0\u53d6\u6587\u4ef6\u3002\n</code></pre></p> <p>\u66f4\u65b0 JAR \u6587\u4ef6 <pre><code>jar uf my.jar META-INF/MANIFEST.MF\njar uf my.jar -C classes .\n\nu: \u6dfb\u52a0\u6587\u4ef6\u5230 JAR\uff0c\u5982\u679c\u6587\u4ef6\u5df2\u7ecf\u5b58\uff0c\u5219\u66f4\u65b0\u3002\n</code></pre></p>"},{"location":"Java/Java%20%E6%89%93%E5%8C%85/#java","title":"Java \u6253\u5305","text":"<p>\u76ee\u5f55\u6811 <pre><code>.\n\u251c\u2500\u2500 lib\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 logback-classic-1.5.18.jar\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 logback-core-1.5.18.jar\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 slf4j-api-2.0.17.jar\n\u251c\u2500\u2500 META-INF\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 MANIFEST.MF\n\u251c\u2500\u2500 resources\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 logback.xml\n\u2514\u2500\u2500 src\n\u00a0 \u00a0 \u2514\u2500\u2500 com\n\u00a0 \u00a0 \u00a0 \u00a0 \u2514\u2500\u2500 jacky\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u2514\u2500\u2500 Main.java\n</code></pre></p> <p>MANIFEST.MF \u6587\u4ef6\u793a\u4f8b\uff1a <pre><code>Main-Class: com.jacky.Main  \nClass-Path: lib/logback-classic-1.5.18.jar lib/logback-core-1.5.18.jar lib/slf4j-api-2.0.17.jar\n</code></pre> <code>Class-Path</code> \u5982\u679c\u6709\u591a\u4e2a\u4f9d\u8d56\u9700\u8981\u624b\u52a8\u6307\u5b9a\u6bcf\u4e00\u4e2a\uff0c\u4e0d\u80fd\u4f7f\u7528\u901a\u914d\u7b26\uff0c\u591a\u4e2a\u4f7f\u7528\u7a7a\u683c\u9694\u5f00\u3002\u6ce8\u610f\u6700\u540e\u4e00\u884c\u662f\u7a7a\u884c\u3002 <code>Class-Path</code> \u6307\u5b9a\u7684\u7c7b\u8def\u5f84\uff0c\u9879\u76ee\u76ee\u5f55\u662f jar \u5305\u6240\u5728\u7684\u76ee\u5f55\u3002</p> <p>\u7f16\u8bd1\u548c\u6267\u884c <pre><code>javac -cp \"lib/*\" -d classes src/com/jacky/Main.java\njava -cp \"lib/*:classes\" com.jacky.App\n</code></pre></p> <p>\u7f16\u8bd1\u3001\u6253\u5305\u548c\u6267\u884c <pre><code>javac -cp \"lib/*\" -d classes -encoding UTF-8 src/com/jacky/*.java\njar cvfm my.jar META-INF/MANIFEST.MF -C classes/ . -C resources/ .\njava -jar my.jar\n</code></pre></p>"},{"location":"Java/Java%20%E6%89%93%E5%8C%85/#spring-boot","title":"Spring Boot \u6253\u5305","text":"<p>Spring Boot \u914d\u7f6e\u6253\u5305\uff0c\u5982\u679c\u9879\u76ee\u7ee7\u627f\u4e86 spring-boot-starter-parent\uff0c\u65e0\u9700\u989d\u5916\u914d\u7f6e repackage\uff0c\u7b80\u5316 pom.xml\u3002 <pre><code>    &lt;build&gt;\n        &lt;finalName&gt;${project.artifactId}&lt;/finalName&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.4.1&lt;/version&gt;\n                &lt;executions&gt;\n                    &lt;execution&gt;\n                        &lt;goals&gt;\n                            &lt;goal&gt;repackage&lt;/goal&gt;\n                        &lt;/goals&gt;\n                    &lt;/execution&gt;\n                &lt;/executions&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n</code></pre></p> <p>\u4e00\u4e2a\u597d\u7528\u7684\u53cd\u7f16\u8bd1\u811a\u672c \u9700\u8981\u4e0b\u8f7d cfr jar \u5305\uff0c\u5982\u679c\u4f7f\u7528 jd-gui \u8fdb\u884c\u53cd\u7f16\u8bd1\u7684\u8bdd\u5185\u90e8\u7c7b\u5904\u7406\u4e0d\u4e86\uff0c\u4f7f\u7528 cfr \u80fd\u591f\u5904\u7406\u5185\u90e8\u7c7b\u7684\u53cd\u7f16\u8bd1\u3002 <pre><code>#!/bin/bash\n\n# \u6307\u5b9a\u641c\u7d22\u76ee\u5f55\nsearch_dir=\"/Users/jacky/Desktop\"\n# \u8f93\u51fa\u76ee\u5f55\noutput_dir=\"decompiled_classes\"\nmkdir -p \"$output_dir\"\n\n# \u4f7f\u7528 find \u547d\u4ee4\u9012\u5f52\u67e5\u627e .class \u6587\u4ef6\u5e76\u53cd\u7f16\u8bd1\nfind \"$search_dir\" -type f -name \"*.class\" | while read -r class_file; do\n    # \u83b7\u53d6\u76f8\u5bf9\u8def\u5f84\n    relative_path=\"${class_file#$search_dir/}\"\n    # \u521b\u5efa\u5bf9\u5e94\u7684\u76ee\u5f55\u7ed3\u6784\n    mkdir -p \"$output_dir/$(dirname \"$relative_path\")\"\n    # \u4f7f\u7528 CFR \u53cd\u7f16\u8bd1\u5668\u793a\u4f8b\uff0c\u6216\u66ff\u6362\u4e3a\u5176\u4ed6\u53cd\u7f16\u8bd1\u5668\n    java -jar cfr.jar \"$class_file\" &gt; \"$output_dir/${relative_path%.class}.java\"\ndone\n</code></pre></p> <p>\u53ef\u80fd\u4f1a\u751f\u6210\u5185\u90e8\u7c7b\u7684\u6587\u4ef6\uff0c\u5220\u9664\u547d\u4ee4\u3002 <pre><code>find /Users/jacky/Desktop -type f -name '*$*.java' -exec rm -rf {} \\;\n</code></pre></p> <p>\u53cd\u7f16\u8bd1 jar \u6587\u4ef6 <pre><code>java -jar cfr.jar /path/to/your/file.jar --outputdir /path/to/output/directory\n</code></pre></p>"},{"location":"Java/Java%20%E8%BF%9E%E6%8E%A5%20Redis/","title":"Java \u8fde\u63a5 Redis","text":"<p>\u4f7f\u7528 Redisson \u8fde\u63a5 Redis\u3002</p> <p>\u4f9d\u8d56\uff1a <pre><code>&lt;dependency&gt;  \n    &lt;groupId&gt;org.redisson&lt;/groupId&gt;  \n    &lt;artifactId&gt;redisson&lt;/artifactId&gt;  \n    &lt;version&gt;3.52.0&lt;/version&gt;  \n&lt;/dependency&gt;\n</code></pre></p> <p>\u4ee3\u7801\uff1a <pre><code>private static final Logger log = LoggerFactory.getLogger(App.class);  \n\npublic static void main(String[] args) {  \n    Config config = new Config();  \n    // redis \u8fde\u63a5\u914d\u7f6e\u4fe1\u606f\n    config.useSingleServer()  \n            .setAddress(\"redis://192.168.31.157:6379\")  \n            .setDatabase(1)  \n            .setPassword(\"xxxx\");  \n\n    // \u8bbe\u7f6e key String \u5e8f\u5217\u5316\uff0cvalue JSON \u5e8f\u5217\u5316\n    config.setCodec(new CompositeCodec(StringCodec.INSTANCE, \n            StringCodec.INSTANCE,  \n            new JsonJacksonCodec()));\n\n    // \u521b\u5efa\u5ba2\u6237\u7aef\n    RedissonClient redissonClient = Redisson.create(config);  \n\n    // \u5b57\u7b26\u4e32\u7c7b\u578b\u6d4b\u8bd5\n    RBucket&lt;Map&gt; name = redissonClient.getBucket(\"people\");\n    Map map = new HashMap();\n    map.put(\"name\", \"jacky\");\n    map.put(\"age\", \"22\");\n    name.set(map);\n    log.info(\"hello name: {}\", name.get());\n\n    // \u5217\u8868\u7c7b\u578b\u6d4b\u8bd5\n    RList&lt;String&gt; list = redissonClient.getList(\"pet\");\n    list.add(\"dog\");\n    list.add(\"bird\");\n    log.info(\"hello ped: {}\", list.readAll());  \n\n    redissonClient.shutdown();  \n}\n\n// Redis \u5b58\u50a8\u5185\u5bb9\n// 127.0.0.1:6379[1]&gt; get people\n// \"{\\\"@class\\\":\\\"java.util.HashMap\\\",\\\"name\\\":\\\"jacky\\\",\\\"age\\\":\\\"22\\\"}\"\n// 127.0.0.1:6379[1]&gt; lrange pet 0 -1\n// 1) \"\\\"dog\\\"\"\n// 2) \"\\\"bird\\\"\"\n</code></pre></p>"},{"location":"Java/String.intern%28%29/","title":"String.intern()","text":"<p>\u4ee3\u7801\u91cc\u7684\u89e3\u91ca <pre><code>    /**\n     * Returns a canonical representation for the string object.\n     * &lt;p&gt;\n     * A pool of strings, initially empty, is maintained privately by the\n     * class {@code String}.\n     * &lt;p&gt;\n     * When the intern method is invoked, if the pool already contains a\n     * string equal to this {@code String} object as determined by\n     * the {@link #equals(Object)} method, then the string from the pool is\n     * returned. Otherwise, this {@code String} object is added to the\n     * pool and a reference to this {@code String} object is returned.\n     * &lt;p&gt;\n     * It follows that for any two strings {@code s} and {@code t},\n     * {@code s.intern() == t.intern()} is {@code true}\n     * if and only if {@code s.equals(t)} is {@code true}.\n     * &lt;p&gt;\n     * All literal strings and string-valued constant expressions are\n     * interned. String literals are defined in section 3.10.5 of the\n     * &lt;cite&gt;The Java&amp;trade; Language Specification&lt;/cite&gt;.\n     *\n     * @return  a string that has the same contents as this string, but is\n     *          guaranteed to be from a pool of unique strings.\n     */\n    public native String intern();\n</code></pre></p> <p>intern \u65b9\u6cd5\u7684\u4f5c\u7528\u662f\u5c06\u5b57\u7b26\u4e32\u6dfb\u52a0\u5230\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\uff0c\u5982\u679c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u5df2\u7ecf\u5305\u542b\u8be5\u5b57\u7b26\u4e32\uff0c\u90a3\u4e48\u76f4\u63a5\u8fd4\u56de\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u7684\u5b57\u7b26\u4e32\u5f15\u7528\uff1b\u5982\u679c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u6ca1\u6709\u8be5\u5b57\u7b26\u4e32\uff0c\u5219\u5c06\u5b57\u7b26\u4e32\u590d\u5236\u5230\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\uff0c\u5e76\u8fd4\u56de\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u7684\u5f15\u7528\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f new String(\"hello\") \u6c38\u8fdc\u662f\u5728\u5806\u4e2d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\uff0c\u548c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u6ca1\u6709\u5173\u7cfb\uff08\u867d\u7136 JDK 7 \u53ca\u4e4b\u540e\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e5f\u5728\u5806\u4e2d\uff09\u3002</p> <p>\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\u5982 <code>\"hello\"\u3001\"world\"</code> \u548c\u5b57\u7b26\u4e32\u5e38\u91cf\u8868\u8fbe\u5f0f\uff08\u53ef\u4ee5\u5728\u7f16\u8bd1\u65f6\u786e\u5b9a\u503c\u7684\u5b57\u7b26\u4e32\u8868\u8fbe\u5f0f\uff09\u5982 <code>\"hello\" + \"world\"</code> \u90fd\u4f1a\u88ab\u5185\u90e8\u5316\uff0c\u5b58\u50a8\u5728\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u3002</p> <p>\u793a\u4f8b1 <pre><code>String s1 = \"hello\"; // \"hello\" \u88ab\u6dfb\u52a0\u5230\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\nString s2 = \"hello\"; // \u4ece\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u83b7\u53d6\u5f15\u7528\nString s3 = new String(\"hello\"); // \u5728\u5806\u4e2d\u521b\u5efa\u4e00\u4e2a\u65b0\u5bf9\u8c61\n\nSystem.out.println(s1 == s2); // true\uff0c\u5f15\u7528\u76f8\u540c\nSystem.out.println(s1 == s3); // false\uff0c\u5f15\u7528\u4e0d\u540c\n</code></pre></p> <p>\u793a\u4f8b2 <pre><code>String s1 = new String(\"hello\"); // \u5728\u5806\u4e2d\u521b\u5efa\u4e00\u4e2a\u65b0\u5bf9\u8c61\nString s2 = s1.intern(); // \u5c06 \"hello\" \u6dfb\u52a0\u5230\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\uff0c\u5e76\u8fd4\u56de\u5f15\u7528\nString s3 = \"hello\"; // \u4ece\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u83b7\u53d6\u5f15\u7528\n\nSystem.out.println(s1 == s2); // false\uff0cs1 \u662f\u5806\u4e2d\u7684\u5bf9\u8c61\uff0cs2 \u662f\u5e38\u91cf\u6c60\u4e2d\u7684\u5f15\u7528\nSystem.out.println(s2 == s3); // true\uff0c\u5f15\u7528\u76f8\u540c\n</code></pre></p>"},{"location":"Java/%E5%8F%8D%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/","title":"\u53cd\u5c04\u548c\u52a8\u6001\u4ee3\u7406","text":""},{"location":"Java/%E5%8F%8D%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/#_1","title":"\u5206\u6790\u7c7b\u7684\u80fd\u529b","text":""},{"location":"Java/%E5%8F%8D%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/#_2","title":"\u83b7\u53d6\u7c7b\u7684\u4fe1\u606f","text":"<p>\u5728 java.lang.reflect \u5305\u4e2d\u6709\u4e09\u4e2a\u7c7b Field\u3001Method \u548c Constructor \u5206\u522b\u7528\u4e8e\u63cf\u8ff0\u7c7b\u7684\u5b57\u6bb5\u3001\u65b9\u6cd5\u548c\u6784\u9020\u51fd\u6570\u3002</p> <ul> <li><code>Class getDeclaringClass()</code> \u8fd4\u56de\u5b9a\u4e49\u4e86\u6784\u9020\u51fd\u6570\u3001\u65b9\u6cd5\u6216\u5b57\u6bb5\u7684\u7c7b\u3002</li> <li><code>Class[] getExceptionTypes()</code> \u5728 Constructor \u548c Method \u7c7b\u4e2d\u3002\u8fd4\u56de\u6784\u9020\u51fd\u6570\u6216\u8005\u65b9\u6cd5\u6240\u629b\u51fa\u7684\u5f02\u5e38\u7c7b\u578b\u3002</li> <li><code>int getModifiers()</code> \u8fd4\u56de\u4e00\u4e2a\u6574\u6570\uff0c\u63cf\u8ff0\u6784\u9020\u51fd\u6570\u3001\u65b9\u6cd5\u6216\u8005\u5b57\u6bb5\u7684\u4fee\u9970\u7b26\u3002\u4f7f\u7528 Modifier \u7c7b\u4e2d\u7684\u65b9\u6cd5\u6765\u5206\u6790\u8fd9\u4e2a\u8fd4\u56de\u503c\u3002</li> <li><code>String getName()</code> \u8fd4\u56de\u8868\u793a\u6784\u9020\u51fd\u6570\u3001\u65b9\u6cd5\u6216\u5b57\u6bb5\u540d\u79f0\u7684\u5b57\u7b26\u4e32\u3002</li> <li><code>Class[] getParameterTypes()</code> \u5728 Constructor \u548c Method \u7c7b\u4e2d\u3002\u8fd4\u56de\u6784\u9020\u51fd\u6570\u6216\u8005\u65b9\u6cd5\u53c2\u6570\u7684\u7c7b\u578b\u3002</li> <li><code>Class getReturnType()</code> \u5728 Method \u7c7b\u4e2d\u3002\u8fd4\u56de\u8868\u793a\u8fd4\u56de\u7c7b\u578b\u7684 Class \u5bf9\u8c61\u3002</li> </ul> <p>java.lang.Class \u7c7b\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u51fd\u6570\u83b7\u53d6\u7c7b\u7684\u4fe1\u606f\u3002</p> <ul> <li><code>String getPackageName()</code> \u8fd4\u56de\u7c7b\u578b\u7684\u5305\u540d\u3002\u5982\u679c\u662f\u6570\u7ec4\u7c7b\u578b\u5219\u8fd4\u56de\u6570\u7ec4\u5143\u7d20\u6240\u5c5e\u7684\u5305\uff0c\u5982\u679c\u662f\u57fa\u672c\u7c7b\u578b\u5219\u8fd4\u56de <code>java.lang</code>\u3002</li> <li><code>Constructor[] getConstructors()</code> \u8fd4\u56de\u5f53\u524d\u7c7b\u4e2d\u6240\u6709 public \u6784\u9020\u51fd\u6570\uff0c\u5305\u62ec\u4ece\u7236\u7c7b\u7ee7\u627f\u7684 public \u6784\u9020\u51fd\u6570\u3002</li> <li><code>Constructor[] getDeclaredConstructors()</code> \u53cd\u56de\u5f53\u524d\u7c7b\u58f0\u660e\u7684\u6240\u6709\u6784\u9020\u51fd\u6570\uff0c\u4e0d\u8bba\u5176\u8bbf\u95ee\u4fee\u9970\u7b26\uff0c\u4f46\u4e0d\u5305\u62ec\u4ece\u7236\u7c7b\u7ee7\u627f\u7684\u6784\u9020\u51fd\u6570\u3002</li> <li><code>Method[] getMethods()</code> \u8fd4\u56de\u5f53\u524d\u7c7b\u58f0\u660e\u7684\u6240\u6709 public \u65b9\u6cd5\uff0c\u5305\u62ec\u4ece\u7236\u7c7b\u7ee7\u627f\u7684 public \u65b9\u6cd5\u3002</li> <li><code>Method[] getDeclaredMethods()</code> \u53cd\u56de\u5f53\u524d\u7c7b\u58f0\u660e\u7684\u6240\u6709\u65b9\u6cd5\uff0c\u4e0d\u8bba\u5176\u8bbf\u95ee\u4fee\u9970\u7b26\uff0c\u4f46\u4e0d\u5305\u62ec\u4ece\u7236\u7c7b\u7ee7\u627f\u7684\u65b9\u6cd5\u3002</li> <li><code>Field[] getFields()</code> \u8fd4\u56de\u5f53\u524d\u7c7b\u58f0\u660e\u7684\u6240\u6709 public \u5b57\u6bb5\uff0c\u5305\u62ec\u4ece\u7236\u7c7b\u7ee7\u627f\u7684 public \u5b57\u6bb5\u3002</li> <li><code>Field[] getDeclaredFields()</code> \u53cd\u56de\u5f53\u524d\u7c7b\u58f0\u660e\u7684\u6240\u6709\u5b57\u6bb5\uff0c\u4e0d\u8bba\u5176\u8bbf\u95ee\u4fee\u9970\u7b26\uff0c\u4f46\u4e0d\u5305\u62ec\u4ece\u7236\u7c7b\u7ee7\u627f\u7684\u5b57\u6bb5\u3002</li> </ul> <p>\u6253\u5370\u7c7b\u7684\u6784\u9020\u51fd\u6570\uff0c\u65b9\u6cd5\u548c\u5b57\u6bb5\u3002 <pre><code>package com.otto.reflective;  \n\nimport java.lang.reflect.Constructor;  \nimport java.lang.reflect.Field;  \nimport java.lang.reflect.Method;  \nimport java.lang.reflect.Modifier;  \nimport java.util.Scanner;  \n\npublic class ReflectiveTest {  \n\n    public static final String TEST_FIELD = \"hello world\";  \n\n    public static void main(String[] args) throws ReflectiveOperationException{  \n        String name;  \n        if (args.length &gt; 0)  \n            name = args[0];  \n        else {  \n            System.out.println(\"Enter class name(e.g. java.util.Date): \");  \n            name = new Scanner(System.in).next();  \n        }  \n\n        Class clz = Class.forName(name);  \n\n        // \u83b7\u53d6\u7c7b\u7684\u4fee\u9970\u7b26\uff0c\u4f8b\u5982 public final        \n        String modifiers = Modifier.toString(clz.getModifiers());  \n        if (modifiers.length() &gt; 0)  \n            System.out.print(modifiers + \" \");  \n\n        // \u83b7\u53d6\u7c7b\u7684\u7236\u7c7b  \n        Class superClz = clz.getSuperclass();  \n        System.out.print(\"class \" + name);  \n        if (superClz != null &amp;&amp; superClz != Object.class)  \n            System.out.print(\" extends \" + superClz.getName());  \n\n        System.out.print(\"\\n{\\n\");  \n\n        printConstructors(clz);  \n        System.out.println();  \n\n        printMethods(clz);  \n        System.out.println();  \n\n        printFields(clz);  \n        System.out.println(\"}\");  \n    }  \n\n    public static void printConstructors(Class clz) {  \n        Constructor[] constructors = clz.getDeclaredConstructors();  \n\n        for (Constructor c : constructors) {  \n            // \u83b7\u53d6\u6784\u9020\u51fd\u6570\u540d\u79f0  \n            String name = c.getName();  \n            System.out.print(\"  \");  \n\n            // \u6253\u5370\u6784\u9020\u51fd\u6570\u7684\u4fee\u9970\u7b26  \n            String modifiers = Modifier.toString(c.getModifiers());  \n            if (modifiers.length() &gt; 0)  \n                System.out.print(modifiers + \" \");  \n\n            // \u6253\u5370\u53c2\u6570\u5217\u8868  \n            System.out.print(name + \"(\");  \n            Class[] paramTypes = c.getParameterTypes();  \n            for (int j = 0; j &lt; paramTypes.length; j ++){  \n                if (j &gt; 0)  \n                    System.out.print(\", \");  \n                System.out.print(paramTypes[j].getName());  \n            }  \n            System.out.println(\");\");  \n        }  \n    }  \n\n    public static void printMethods(Class clz) {  \n        Method[] methods = clz.getDeclaredMethods();  \n\n        for (Method m : methods){  \n            // \u83b7\u53d6\u65b9\u6cd5\u8fd4\u56de\u7c7b\u578b\u548c\u65b9\u6cd5\u540d\u79f0  \n            Class retType = m.getReturnType();  \n            String name = m.getName();  \n            System.out.print(\"  \");  \n\n            // \u6253\u5370\u65b9\u6cd5\u4fee\u9970\u7b26  \n            String modifiers = Modifier.toString(m.getModifiers());  \n            if (modifiers.length() &gt; 0)  \n                System.out.print(modifiers + \"  \");  \n\n            // \u6253\u5370\u65b9\u6cd5\u8fd4\u56de\u7c7b\u578b\u548c\u65b9\u6cd5\u540d\u79f0  \n            System.out.print(retType.getName() + \" \" + name + \"(\");  \n\n            // \u6253\u5370\u65b9\u6cd5\u53c2\u6570\u7c7b\u578b\u5217\u8868  \n            Class[] paramTypes = m.getParameterTypes();  \n            for (int j = 0; j &lt; paramTypes.length; j ++) {  \n                if (j &gt; 0)  \n                    System.out.print(\", \");  \n                System.out.print(paramTypes[j].getName());  \n            }  \n            System.out.println(\");\");  \n        }  \n    }  \n\n    public static void printFields(Class clz) {  \n        Field[] fields = clz.getDeclaredFields();  \n\n        for (Field f : fields) {  \n            // \u83b7\u53d6\u5c5e\u6027\u7c7b\u578b\u548c\u5c5e\u6027\u540d\u79f0  \n            Class type = f.getType();  \n            String name = f.getName();  \n            System.out.print(\"  \");  \n\n            // \u6253\u5370\u5c5e\u6027\u4fee\u9970\u7b26  \n            String modifiers = Modifier.toString(f.getModifiers());  \n            if (modifiers.length() &gt; 0)  \n                System.out.print(modifiers + \" \");  \n\n            // \u6253\u5370\u5c5e\u6027\u540d\u79f0  \n            System.out.println(type.getName() + \" \" + name + \";\");  \n        }  \n    }  \n}\n</code></pre></p> <p>Java 8 \u5f00\u59cb\uff0c\u53cd\u5c04 API \u63d0\u4f9b\u4e86\u83b7\u53d6\u53c2\u6570\u540d\u79f0\u7684\u529f\u80fd\uff0c\u4f46\u662f\u9700\u8981\u5728\u7f16\u8bd1\u65f6\u5f00\u542f --parameters \u9009\u9879 <pre><code>package com.otto.reflective;\n\nimport java.lang.reflect.Method;\nimport java.lang.reflect.Modifier;\nimport java.lang.reflect.Parameter;\n\npublic class ParameterNameTest {\n    public static void main(String[] args) throws NoSuchMethodException {\n        Class clz = ParameterNameTest.class;\n\n        Method m = clz.getDeclaredMethod(\"testMethod\", String.class);\n\n        Parameter[] parameters = m.getParameters();\n        String paramType = parameters[0].getType().getName();\n        String paramName = parameters[0].getName();\n\n        String modifier = Modifier.toString(m.getModifiers());\n\n        System.out.println(modifier + \" \"\n                + m.getReturnType().getName() + \" \"\n                + m.getName()\n                + \"(\" + paramType + \" \" + paramName + \")\"\n        ); // private void testMethod(java.lang.String testParam)\n    }\n\n    private void testMethod(String testParam) {\n\n    }\n}\n</code></pre></p>"},{"location":"Java/%E5%8F%8D%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/#_3","title":"\u52a8\u6001\u5730\u64cd\u4f5c\u5bf9\u8c61","text":"<p>\u7528\u4e8e\u6d4b\u8bd5\u7684\u7c7b <pre><code>package com.otto.reflective;\n\npublic class ReflectiveObjectTest {\n\n    public String field1 = \"hello\";\n\n    private int field2 = 1;\n\n    public ReflectiveObjectTest() {\n    }\n\n    private ReflectiveObjectTest(String field1, int field2) {\n        this.field1 = field1;\n        this.field2 = field2;\n    }\n\n    private void printMsg(String msg) {\n        System.out.println(String.format(\"(%s, %d) got message: %s\", field1, field2, msg));\n    }\n}\n</code></pre></p> <p>\u6d4b\u8bd5\u4ee3\u7801 <pre><code>package com.otto.reflective;  \n\nimport java.lang.reflect.Constructor;  \nimport java.lang.reflect.Field;  \nimport java.lang.reflect.Method;  \n\npublic class App {  \n    public static void main(String[] args) throws Exception{  \n\n        Class clz = ReflectiveObjectTest.class;  \n\n        // \u83b7\u53d6\u9ed8\u8ba4\u7684\u6784\u9020\u51fd\u6570\u751f\u6210\u5bf9\u8c61  \n        ReflectiveObjectTest obj1 = (ReflectiveObjectTest) clz.getDeclaredConstructor().newInstance();  \n\n        // \u83b7\u53d6\u5c5e\u6027 field1 \u7684\u503c  \n        Field f1 = clz.getDeclaredField(\"field1\");  \n        System.out.println(f1.get(obj1));    // hello  \n\n        // \u83b7\u53d6\u5c5e\u6027 field2 \u7684\u503c  \n        Field f2 = clz.getDeclaredField(\"field2\");  \n            // \u8bbe\u7f6e\u5c5e\u6027\u7684\u53ef\u8bbf\u95ee\u6807\u5fd7  \n        f2.setAccessible(true);  \n        System.out.println(f2.get(obj1));    // 1  \n        // \u4fee\u6539 field2 \u7684\u503c  \n        f2.set(obj1, 2);  \n        System.out.println(f2.get(obj1));    // 2  \n\n        // \u83b7\u53d6\u6709\u53c2\u7684\u6784\u9020\u51fd\u6570  \n        Constructor declaredConstructor = clz.getDeclaredConstructor(String.class, int.class);  \n            // \u8bbe\u7f6e\u6784\u9020\u51fd\u6570\u7684\u53ef\u8bbf\u95ee\u6807\u5fd7  \n        declaredConstructor.setAccessible(true);  \n        // \u4f7f\u7528\u6709\u53c2\u7684\u6784\u9020\u51fd\u6570\u751f\u6210\u5bf9\u8c61  \n        ReflectiveObjectTest obj2 = (ReflectiveObjectTest) declaredConstructor.newInstance(\"nihao\", 2);  \n\n        // \u83b7\u53d6\u6709\u53c2\u7684\u65b9\u6cd5  \n        Method m = clz.getDeclaredMethod(\"printMsg\", String.class);  \n        // \u8bbe\u7f6e\u65b9\u6cd5\u7684\u53ef\u8bbf\u95ee\u6807\u5fd7  \n        m.setAccessible(true);  \n        // \u4f7f\u7528\u53cd\u5c04\u6267\u884c\u65b9\u6cd5  \n        m.invoke(obj2, \"-_-\");  // (nihao, 2) got message: -_-  \n    }  \n}\n</code></pre></p> <p>\u53cd\u5c04\u673a\u5236\u7684\u9ed8\u8ba4\u884c\u4e3a\u53d7\u9650\u4e0e Java \u7684\u8bbf\u95ee\u63a7\u5236\u3002\u4e0d\u8fc7\uff0c\u53ef\u4ee5\u8c03\u7528 Constructor\u3001Method \u548c Field \u5bf9\u8c61\u7684 setAccessible \u65b9\u6cd5\u8986\u76d6 Java \u7684\u8bbf\u95ee\u63a7\u5236\u3002</p>"},{"location":"Java/%E5%8F%8D%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/#type","title":"Type \u7c7b\u578b","text":"<p><code>java.lang.reflect.Type</code> \u7c7b\u578b\u6709\u4e09\u4e2a\u5b50\u63a5\u53e3\u548c\u4e00\u4e2a\u5b9e\u73b0\u7c7b\uff1a</p>"},{"location":"Java/%E5%8F%8D%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/#class","title":"Class","text":"<p><code>java.lang.Class</code> \u7c7b\u5b9e\u73b0\u4e86 <code>Type</code> \u63a5\u53e3\u3002</p>"},{"location":"Java/%E5%8F%8D%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/#typevariable","title":"TypeVariable","text":"<p><code>java.lang.reflect.TypeVariable</code> \u8868\u793a\u7c7b\u578b\u53d8\u91cf\uff0c\u5b83\u7528\u6765\u53cd\u6620\u5728 JVM \u7f16\u8bd1\u8be5\u6cdb\u578b\u524d\u7684\u4fe1\u606f\u3002\u4f8b\u5982 <code>List&lt;T&gt;</code> \u5176\u4e2d <code>T</code> \u5c31\u662f\u7c7b\u578b\u53d8\u91cf\u3002\u8be5\u63a5\u53e3\u4e2d\u5e38\u7528\u7684\u4e09\u4e2a\u65b9\u6cd5\uff1a</p> <ul> <li><code>Type[] getBounds</code> \u83b7\u53d6\u7c7b\u578b\u53d8\u91cf\u7684\u4e0a\u8fb9\u754c\uff0c\u5982\u679c\u672a\u58f0\u660e\u4e0a\u8fb9\u754c\u5219\u9ed8\u8ba4\u4e3a <code>Object</code>\u3002\u4f8b\u5982 <code>class Test&lt;K extends Person&gt;</code> \u4e2d\u7c7b\u578b\u53d8\u91cf <code>K</code> \u7684\u4e0a\u8fb9\u754c\u5c31\u662f <code>Person</code>\u3002</li> <li><code>D getGenericDeclaration()</code> \u83b7\u53d6\u58f0\u660e\u7c7b\u578b\u53d8\u91cf\u7684\u539f\u59cb\u7c7b\u578b\u3002\u4f8b\u5982 <code>class Test&lt;K&gt;</code> \u4e2d\u7684\u539f\u59cb\u662f <code>Test</code>\u3002</li> <li><code>String getName()</code> \u83b7\u53d6\u5728\u6e90\u7801\u4e2d\u5b9a\u4e49\u7684\u540d\u5b57\u3002\u4f8b\u5982 <code>class Test&lt;K&gt;</code> \u4e3a K\u3002</li> </ul>"},{"location":"Java/%E5%8F%8D%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/#parameterizedtype","title":"ParameterizedType","text":"<p><code>java.lang.reflect.ParameterizedType</code> \u8868\u793a\u53c2\u6570\u5316\u7c7b\u578b\uff0c\u4f8b\u5982 <code>List&lt;String&gt;</code> \u662f\u4e00\u4e2a\u53c2\u6570\u5316\u7c7b\u578b\u3002</p> <ul> <li><code>Type getRawType()</code> \u8fd4\u56de\u53c2\u6570\u5316\u7c7b\u578b\u4e2d\u7684\u539f\u59cb\u7c7b\u578b\uff0c\u4f8b\u5982 <code>List&lt;String</code>&gt; \u7684\u539f\u59cb\u7c7b\u578b\u4e3a <code>List</code>\u3002</li> <li><code>Type[] getActualTypeArguments()</code> \u83b7\u53d6\u53c2\u6570\u5316\u7c7b\u578b\u7684\u7c7b\u578b\u53d8\u91cf\u6216\u662f\u5b9e\u9645\u7c7b\u578b\u5217\u8868\uff0c\u4f8b\u5982 <code>Map&lt;String, Integer&gt;</code> \u7684\u5b9e\u9645\u6cdb\u578b\u5217\u8868 <code>String</code> \u548c <code>Integer</code>\u3002</li> </ul>"},{"location":"Java/%E5%8F%8D%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/#genericarraytype","title":"GenericArrayType","text":"<p><code>java.lang.reflect.GenericArrayType</code> \u8868\u793a\u7684\u662f\u6570\u7ec4\u7c7b\u578b\u4e14\u7ec4\u6210\u5143\u7d20\u662f <code>Parameterized</code> \u6216 <code>TypeVariable</code>\u3002\u4f8b\u5982 <code>List&lt;String&gt;[]</code> \u6216 <code>T[]</code>\u3002</p>"},{"location":"Java/%E5%8F%8D%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/#wildcardtype","title":"WildcardType","text":"<p><code>java.lang.reflect.WildcardType</code> \u8868\u793a\u7684\u662f\u901a\u914d\u7b26\u6cdb\u578b\uff0c\u4f8b\u5982\uff1a<code>? extends Number</code> \u548c <code>? super Integer</code>\u3002</p> <ul> <li>Type[] getUpperBounds() \u8fd4\u56de\u6cdb\u578b\u53d8\u91cf\u7684\u4e0a\u754c\u3002</li> <li>Type[] getLowerBounds() \u8fd4\u56de\u6cdb\u578b\u53d8\u91cf\u7684\u4e0b\u754c\u3002</li> </ul> <pre><code>import java.lang.reflect.*;\nimport java.util.List;\nimport java.util.Map;\n\npublic class TypeTest&lt;A, B&gt; {\n\n    public A a;\n\n    public List&lt;B&gt; b;\n\n    public List&lt;String&gt; c;\n\n    public List&lt;Map&lt;A, B&gt;&gt; d;\n\n    public static void main(String[] args) throws NoSuchFieldException, NoSuchMethodException {\n        // TypeTest&lt;A, B&gt;\n        for (TypeVariable&lt;?&gt; typeVariable : TypeTest.class.getTypeParameters()) {\n            System.out.println(typeVariable); // A B\n        }\n\n        // A a\n        System.out.println(\"-------------------------a\");\n        Field field = TypeTest.class.getField(\"a\");\n        System.out.println(field.getGenericType()); // A\n        System.out.println(field.getGenericType() instanceof TypeVariable); // true\n\n        // List&lt;B&gt; b\n        System.out.println(\"-------------------------b\");\n        Field field1 = TypeTest.class.getDeclaredField(\"b\");\n        System.out.println(field1.getGenericType()); // java.util.List&lt;B&gt;\n        System.out.println(field1.getGenericType() instanceof ParameterizedType); // true\n\n        ParameterizedType pType = (ParameterizedType) field1.getGenericType();\n        System.out.println(pType.getTypeName());\n        System.out.println(pType.getRawType());\n        System.out.println(pType.getOwnerType());\n        for (Type t : pType.getActualTypeArguments()) {\n            System.out.println(t instanceof TypeVariable);\n            System.out.println(t instanceof ParameterizedType);\n            System.out.println(t instanceof Class);\n            System.out.println(t);\n        }\n\n        // public List&lt;String&gt; c;\n        System.out.println(\"-------------------------c\");\n        Field field2 = TypeTest.class.getDeclaredField(\"c\");\n        System.out.println(field2.getGenericType());\n        System.out.println(field2.getGenericType() instanceof ParameterizedType);\n\n        ParameterizedType pType2 = (ParameterizedType) field2.getGenericType();\n        System.out.println(pType2.getTypeName());\n        System.out.println(pType2.getRawType());\n        System.out.println(pType2.getOwnerType());\n        for (Type t : pType2.getActualTypeArguments()) {\n            System.out.println(t instanceof TypeVariable);\n            System.out.println(t instanceof ParameterizedType);\n            System.out.println(t instanceof Class);\n            System.out.println(t);\n        }\n\n        // public List&lt;Map&lt;A, B&gt;&gt; d;\n        System.out.println(\"-------------------------d\");\n        Field field3 = TypeTest.class.getDeclaredField(\"d\");\n        System.out.println(field3.getGenericType());\n        System.out.println(field3.getGenericType() instanceof ParameterizedType);\n\n        ParameterizedType pType3 = (ParameterizedType) field3.getGenericType();\n        System.out.println(pType3.getTypeName());\n        System.out.println(pType3.getRawType());\n        System.out.println(pType3.getOwnerType());\n        for (Type t : pType3.getActualTypeArguments()) {\n            System.out.println(t instanceof TypeVariable);\n            System.out.println(t instanceof ParameterizedType);\n            System.out.println(t instanceof Class);\n            System.out.println(t);\n        }\n    }\n}\n</code></pre>"},{"location":"Java/%E5%8F%8D%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/#_4","title":"\u9759\u6001\u4ee3\u7406","text":"<p>\u9759\u6001\u4ee3\u7406\u6307\u7684\u662f\u624b\u52a8\u7f16\u5199\u4ee3\u7406\u7c7b\u4ee3\u7801\uff0c\u4ee3\u7406\u7c7b\u4e0e\u76ee\u6807\u7c7b\u5b9e\u73b0\u76f8\u540c\u7684\u63a5\u53e3\uff0c\u901a\u8fc7\u5728\u4ee3\u7406\u7c7b\u4e2d\u8c03\u7528\u76ee\u6807\u5bf9\u8c61\u7684\u65b9\u6cd5\u5b9e\u73b0\u589e\u5f3a\u5904\u7406\u3002 <pre><code>public interface Subject {  \n\n    void request();  \n}\n\npublic class RealSubject implements Subject{  \n    @Override  \n    public void request() {  \n        System.out.println(\"RealSubject: Handling request\");  \n    }  \n}\n\npublic class SubjectLogProxy implements Subject{  \n\n    private Subject subject;  \n\n    public SubjectLogProxy(Subject subject) {  \n        this.subject = subject;  \n    }  \n\n    @Override  \n    public void request() {  \n        System.out.println(\"Proxy: Before request\");  \n        subject.request();  \n        System.out.println(\"Proxy: After request\");  \n    }  \n\n    public static void main(String[] args) {  \n        RealSubject realSubject = new RealSubject();  \n        SubjectLogProxy proxy = new SubjectLogProxy(realSubject);  \n        proxy.request();  \n    }  \n}\n</code></pre></p> <p>\u7f3a\u70b9\uff1a\u4e0d\u591f\u7075\u6d3b\uff0c\u6bcf\u65b0\u589e\u4e00\u4e2a\u63a5\u53e3\uff0c\u5c31\u8981\u521b\u5efa\u4e00\u4e2a\u4ee3\u7406\u7c7b\uff0c\u7c7b\u7684\u6570\u91cf\u5267\u589e\u3002</p>"},{"location":"Java/%E5%8F%8D%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/#_5","title":"\u52a8\u6001\u4ee3\u7406","text":"<p>\u52a8\u6001\u4ee3\u7406\u662f\u5728\u8fd0\u884c\u65f6\u7531 JVM \u6839\u636e\u63d0\u4f9b\u7684\u63a5\u53e3\u4fe1\u606f\u548c\u589e\u5f3a\u903b\u8f91\uff0c\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u4ee3\u7406\u7c7b\u7684\u5b57\u8282\u7801\u5e76\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u7701\u53bb\u4e86\u624b\u52a8\u4e3a\u6bcf\u4e00\u4e2a\u63a5\u53e3\u5199\u4ee3\u7406\u7c7b\u7684\u9ebb\u70e6\u3002 <pre><code>public class DynamicLogProxy implements InvocationHandler {  \n    private Object target;  \n\n    public DynamicLogProxy(Object target) {  \n        this.target = target;  \n    }  \n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        // \u5982\u679c\u662f\u4ece Object \u7ee7\u627f\u7684\u65b9\u6cd5\uff0c\u76f4\u63a5\u8c03\u7528\u4e0d\u505a\u589e\u5f3a\u5904\u7406\n        if (Object.class.equals(method.getDeclaringClass())) {\n            return method.invoke(target, args);\n        }\n        System.out.println(\"Before method: \" + method.getName());\n        Object result = method.invoke(target, args);\n        System.out.println(\"After method: \" + method.getName());\n        return result;\n    }\n\n    public static Object newInstance(Object target) {  \n        DynamicLogProxy handler = new DynamicLogProxy(target);  \n        return Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), handler);  \n    }  \n\n    public static void main(String[] args) {\n        System.setProperty(\"jdk.proxy.ProxyGenerator.saveGeneratedFiles\", \"true\");\n        RealSubject realSubject = new RealSubject();\n        Subject p = (Subject) DynamicLogProxy.newInstance(realSubject);\n        p.request();\n\n        p.toString();\n    }\n}\n</code></pre></p> <p>\u6dfb\u52a0\u7cfb\u7edf\u5c5e\u6027\uff0c\u4fdd\u5b58\u52a8\u6001\u4ee3\u7406\u751f\u6210\u7684\u5b57\u8282\u7801\uff1a <pre><code>System.setProperty(\"jdk.proxy.ProxyGenerator.saveGeneratedFiles\", \"true\");\n</code></pre></p> <p>\u5982\u4e0b\uff0c <pre><code>public final class $Proxy0 extends Proxy implements Subject {  \n    private static final Method m0;  \n    private static final Method m1;  \n    private static final Method m2;  \n    private static final Method m3;  \n\n    static {  \n        ClassLoader var0 = $Proxy0.class.getClassLoader();  \n        // \u4ee3\u7406\u65b9\u6cd5\u8d4b\u503c\n        try {  \n            m0 = Class.forName(\"java.lang.Object\", false, var0).getMethod(\"hashCode\");  \n            m1 = Class.forName(\"java.lang.Object\", false, var0).getMethod(\"equals\", Class.forName(\"java.lang.Object\", false, var0));  \n            m2 = Class.forName(\"java.lang.Object\", false, var0).getMethod(\"toString\");  \n            m3 = Class.forName(\"com.jacky.Subject\", false, var0).getMethod(\"request\");  \n        } catch (NoSuchMethodException var2) {  \n            throw new NoSuchMethodError(((Throwable)var2).getMessage());  \n        } catch (ClassNotFoundException var3) {  \n            throw new NoClassDefFoundError(((Throwable)var3).getMessage());  \n        }  \n    } \n\n    public $Proxy0(InvocationHandler var1) {  \n        super(var1);  \n    }  \n\n    // \u7701\u7565\u4e86 toString \u548c equals \u65b9\u6cd5\uff0c\u4ee3\u7801\u903b\u8f91\u548c hashCode \u7c7b\u4f3c\n    \u2026\u2026\n\n    // \u53ef\u4ee5\u770b\u5230\uff0ctoString\u3001equals \u548c hashCode \u65b9\u6cd5\u4e5f\u4f1a\u8d70\u4ee3\u7406\u589e\u5f3a\u903b\u8f91\n    public final int hashCode() {  \n        try {  \n            return (Integer)super.h.invoke(this, m0, (Object[])null);  \n        } catch (RuntimeException | Error var2) {  \n            throw var2;  \n        } catch (Throwable var3) {  \n            throw new UndeclaredThrowableException(var3);  \n        }  \n    }   \n\n    // \u5b9e\u73b0\u4ee3\u7406\u63a5\u53e3\u7684\u65b9\u6cd5\n    public final void request() {  \n        try {  \n            super.h.invoke(this, m3, (Object[])null);  \n        } catch (RuntimeException | Error var2) {  \n            throw var2;  \n        } catch (Throwable var3) {  \n            throw new UndeclaredThrowableException(var3);  \n        }  \n    }    \n}\n</code></pre></p> <p>Tips\uff1a 1. \u5982\u679c\u88ab\u4ee3\u7406\u7c7b\u5b9e\u73b0\u4e86\u591a\u4e2a\u63a5\u53e3\uff0c\u90a3\u4e48\u52a8\u6001\u4ee3\u7406\u5185\u90e8\u751f\u6210\u7684\u5b57\u8282\u7801\u4e5f\u4f1a\u5b9e\u73b0\u591a\u4e2a\u63a5\u53e3\u3002 2. \u52a8\u6001\u4ee3\u7406\u751f\u6210\u7684\u5b57\u8282\u7801\u4f1a\u88ab\u7f13\u5b58\u8d77\u6765\uff0c\u4ee5\u4fbf\u540e\u7eed\u6709\u76f8\u540c\u7684\u63a5\u53e3\u7ec4\u5408\u53ef\u4ee5\u4e0d\u7528\u91cd\u590d\u751f\u6210\u3002</p>"},{"location":"Java/%E5%8F%8D%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/#qa","title":"QA","text":"<p>\u9a8c\u8bc1\u6240\u6709\u7684\u7c7b\u90fd\u662f\u5728\u5bf9\u5176\u7b2c\u4e00\u6b21\u4f7f\u7528\u65f6\u52a8\u6001\u52a0\u8f7d\u5230 JVM \u4e2d\u7684\u3002</p> <p>\u51c6\u5907\u4ee3\u7801 <pre><code>package com.otto.reflective;\n\nimport java.util.Scanner;\n\npublic class App \n{\n    public static void main( String[] args )\n    {\n        Scanner scanner = new Scanner(System.in);\n        while (scanner.hasNext()) {\n            String next = scanner.next();\n            switch (next) {\n                case \"one\" :\n                    new TestLoadOne().testPrint();\n                    break;\n                case \"two\":\n                    new TestLoadTwo().testPrint();\n                    break;\n                case \"exit\":\n                    System.exit(0);\n                default:\n                    break;\n            }\n        }\n    }\n}\n</code></pre></p> <p>\u4f7f\u7528 arthas \u8c03\u8bd5\u67e5\u770b\u5df2\u7ecf\u52a0\u8f7d\u7684\u7c7b\uff0c\u67e5\u770b App\u3001TestLoadOne \u548c TestLoadTwo \u7684\u52a0\u8f7d\u65f6\u673a\u3002 <pre><code>java -jar arthas-boot.jar\n&gt; sc *otto*\n</code></pre></p> <p>\u7ed3\u8bba\uff1a\u7a0b\u5e8f\u542f\u52a8\u540e\u9ed8\u8ba4\u4f1a\u52a0\u8f7d App \u7c7b\uff0c\u8f93\u5165 one \u4e4b\u540e\u52a0\u8f7d TestLoadOne \u7c7b\uff0c\u8f93\u5165 two \u4e4b\u540e\u52a0\u8f7d TestLoadTwo \u7c7b\u3002</p> <p>\u83b7\u53d6\u7c7b\u7684\u6240\u6709\u65b9\u6cd5\uff0c\u4e0d\u5305\u62ec Object \u7ee7\u627f\u800c\u6765\u7684\u65b9\u6cd5\u3002 <pre><code>  private Method[] getClassMethods(Class&lt;?&gt; clazz) {\n    Map&lt;String, Method&gt; uniqueMethods = new HashMap&lt;&gt;();\n    Class&lt;?&gt; currentClass = clazz;\n    while (currentClass != null &amp;&amp; currentClass != Object.class) {\n      // \u7531\u4e8e getMethods() \u65b9\u6cd5\u53ea\u4f1a\u8fd4\u56de public \u4fee\u9970\u7684\u65b9\u6cd5\uff0c\n      // \u6240\u4ee5\u8fd9\u91cc\u4f7f\u7528 getDeclaredMethods() + \u5faa\u73af\u7684\u65b9\u5f0f\u83b7\u53d6\u6240\u6709\u7684\u65b9\u6cd5\n      addUniqueMethods(uniqueMethods, currentClass.getDeclaredMethods());\n\n      // \u83b7\u53d6\u6240\u6709\u5b9e\u73b0\u63a5\u53e3\u7684\u65b9\u6cd5\u63a5\u53e3\u90fd\u662f public \u7684\n      Class&lt;?&gt;[] interfaces = currentClass.getInterfaces();\n      for (Class&lt;?&gt; anInterface : interfaces) {\n        addUniqueMethods(uniqueMethods, anInterface.getMethods());\n      }\n\n      currentClass = currentClass.getSuperclass();\n    }\n\n    Collection&lt;Method&gt; methods = uniqueMethods.values();\n\n    return methods.toArray(new Method[0]);\n  }\n\n  private void addUniqueMethods(Map&lt;String, Method&gt; uniqueMethods, Method[] methods) {\n    for (Method currentMethod : methods) {\n      // \u6865\u63a5\u65b9\u6cd5\u662f\u7f16\u8bd1\u5668\u5728\u7c7b\u578b\u64e6\u9664\u65f6\u786e\u4fdd\u7c7b\u578b\u5b89\u5168\u751f\u6210\u7684\u65b9\u6cd5\uff0c\u5ffd\u7565\u6389\n      if (!currentMethod.isBridge()) { \n        String signature = getSignature(currentMethod);\n        if (!uniqueMethods.containsKey(signature)) {\n          uniqueMethods.put(signature, currentMethod);\n        }\n      }\n    }\n  }\n\n  // \u751f\u6210\u65b9\u6cd5\u7b7e\u540d\uff0c\u7c7b\u4f3c \n  private String getSignature(Method method) {\n    StringBuilder sb = new StringBuilder();\n    Class&lt;?&gt; returnType = method.getReturnType();\n    sb.append(returnType.getName()).append('#');\n    sb.append(method.getName());\n    Class&lt;?&gt;[] parameters = method.getParameterTypes();\n    for (int i = 0; i &lt; parameters.length; i++) {\n      sb.append(i == 0 ? ':' : ',').append(parameters[i].getName());\n    }\n    return sb.toString();\n  }\n</code></pre></p>"},{"location":"Java/%E7%BB%99%E8%A7%86%E9%A2%91%E5%92%8C%E5%9B%BE%E7%89%87%E6%B7%BB%E5%8A%A0%E6%B0%B4%E5%8D%B0/","title":"\u7ed9\u89c6\u9891\u548c\u56fe\u7247\u6dfb\u52a0\u6c34\u5370","text":"<p>\u7ed9\u56fe\u7247\u6dfb\u52a0\u6c34\u5370\u6bd4\u8f83\u7b80\u5355\uff0cJava \u5185\u7f6e\u7684 API \u76f4\u63a5\u5c31\u80fd\u5904\u7406\u3002 <pre><code> public static void main(String[] args) throws Exception {\n        // \u52a0\u8f7d\u539f\u59cb\u56fe\u7247\n        File originalFile = new File(\"/Users/jacky/Desktop/a.png\");\n        BufferedImage originalImage = ImageIO.read(originalFile);\n\n        // \u521b\u5efa\u4e00\u4e2a\u65b0\u7684BufferedImage\uff0c\u7528\u4e8e\u7ed8\u5236\u6c34\u5370\n        BufferedImage watermarkedImage = new BufferedImage(\n                originalImage.getWidth(), originalImage.getHeight(), BufferedImage.TYPE_INT_ARGB);\n        Graphics2D g2d = (Graphics2D) watermarkedImage.getGraphics();\n\n        // \u7ed8\u5236\u539f\u59cb\u56fe\u7247\n        g2d.drawImage(originalImage, 0, 0, null);\n\n        // \u8bbe\u7f6e\u6c34\u5370\u6587\u672c\u7684\u5b57\u4f53\u548c\u989c\u8272\n        g2d.setFont(new Font(\"Arial\", Font.BOLD, 30));\n        g2d.setColor(new Color(0, 0, 0, 128)); // \u534a\u900f\u660e\u767d\u8272\n\n        // \u8bbe\u7f6e\u6c34\u5370\u7684\u900f\u660e\u5ea6\n        g2d.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_OVER, 0.5f));\n\n        // \u6c34\u5370\u6587\u672c\n        String watermarkText = \"\u6d4b\u8bd5\u6c34\u5370\";\n\n        // \u6c34\u5370\u95f4\u8ddd\u8bbe\u7f6e\n        int horizontalSpacing = 300; // \u6c34\u5e73\u95f4\u8ddd\n        int verticalSpacing = 150;   // \u5782\u76f4\u95f4\u8ddd\n\n        // \u5728\u6574\u4e2a\u56fe\u7247\u4e0a\u91cd\u590d\u7ed8\u5236\u6c34\u5370\n        for (int y = 0; y &lt; originalImage.getHeight(); y += verticalSpacing) {\n            for (int x = 0; x &lt; originalImage.getWidth(); x += horizontalSpacing) {\n                // \u4fdd\u5b58\u5f53\u524d\u56fe\u5f62\u4e0a\u4e0b\u6587\n                Graphics2D g2dCopy = (Graphics2D) g2d.create();\n\n                // \u5c06\u5750\u6807\u7cfb\u5e73\u79fb\u5230\u5f53\u524d\u6c34\u5370\u4f4d\u7f6e\n                g2dCopy.translate(x, y);\n\n                // \u65cb\u8f6c\u5750\u6807\u7cfb 45 \u5ea6\uff08\u5411\u5de6\u503e\u659c\uff09\n                g2dCopy.rotate(Math.toRadians(-45)); // \u8d1f\u6570\u8868\u793a\u5411\u5de6\u503e\u659c\n\n                // \u7ed8\u5236\u6c34\u5370\u6587\u672c\n                g2dCopy.drawString(watermarkText, 0, 0);\n\n                // \u91ca\u653e\u56fe\u5f62\u4e0a\u4e0b\u6587\n                g2dCopy.dispose();\n            }\n        }\n\n        // \u91ca\u653e\u56fe\u5f62\u4e0a\u4e0b\u6587\n        g2d.dispose();\n\n        // \u4fdd\u5b58\u5e26\u6709\u6c34\u5370\u7684\u56fe\u7247\n        File outputFile = new File(\"/Users/jacky/Desktop/aa.png\");\n        ImageIO.write(watermarkedImage, \"png\", outputFile);\n    }\n</code></pre></p> <p>\u7ed9\u89c6\u9891\u6dfb\u52a0\u6c34\u5370\u9700\u8981\u4f9d\u8d56\u7b2c\u4e09\u65b9\u5e93\uff0c\u6216\u8005\u4f7f\u7528 ffmpeg \u5904\u7406\u3002\u5efa\u8bae\u672c\u5730\u5b89\u88c5 ffmpeg + https://github.com/bramp/ffmpeg-cli-wrapper \u5904\u7406\u3002</p> <p>ffmpeg \u7ed9\u56fe\u7247\u6dfb\u52a0\u6c34\u5370\uff0c\u4f7f\u7528 drawtext \u5728 x=10 y=10 \u7684\u5730\u65b9\u6dfb\u52a0\u6c34\u5370\u3002 <pre><code>ffmpeg -i a.png -vf \"drawtext=text='\u6d4b\u8bd5\u6c34\u5370':x=10:y=10:fontsize=24:fontcolor=black\" a.png\n</code></pre></p> <p>\u7ed9\u89c6\u9891\u6dfb\u52a0\u6c34\u5370\u3002 <pre><code>ffmpeg -i a.mov -vf \"drawtext=text='\u6d4b\u8bd5\u6c34\u5370':x=10:y=10:fontsize=240:fontcolor=red\" aa.mov\n</code></pre></p>"},{"location":"Java/Gradle/Gradle%20Tips/","title":"Gradle Tips","text":""},{"location":"Java/Gradle/Gradle%20Tips/#gradle-jdk","title":"\u914d\u7f6e Gradle \u5355\u72ec\u7684 JDK \u73af\u5883","text":"<p>\u5168\u5c40\u914d\u7f6e\u6587\u4ef6 <code>~/.gradle/gradle.properties</code>\uff0c\u9879\u76ee\u914d\u7f6e\u6587\u4ef6 <code>project_dir/gradle.properties</code>\uff1a <pre><code>org.gradle.java.home=D:\\\\App\\\\jdk-21.0.7+6\n</code></pre></p>"},{"location":"Java/Gradle/Gradle%20Tips/#_1","title":"\u914d\u7f6e\u63a7\u5236\u53f0\u663e\u793a\u8be6\u7ec6\u7684\u4efb\u52a1\u4fe1\u606f","text":"<pre><code>\u547d\u4ee4\u884c\u589e\u52a0\u53c2\u6570\n--console=verbose\n\n\u6216\u8005\u5728\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u589e\u52a0\u914d\u7f6e\norg.gradle.console=verbose\n</code></pre>"},{"location":"Java/Gradle/Gradle%20Tips/#_2","title":"\u589e\u91cf\u6784\u5efa\u548c\u7f13\u5b58","text":"<p>\u6a21\u62df\u6267\u884c\u4efb\u52a1\uff0c\u4f46\u662f\u5b9e\u9645\u4e0d\u6267\u884c\uff0c\u5e38\u7528\u6765\u67e5\u770b\u4efb\u52a1\u7684\u6267\u884c\u987a\u5e8f\uff1a <pre><code>./gradlew :app:bootJar -m\n</code></pre></p> <p>\u589e\u91cf\u6784\u5efa \u7b80\u5355\u7406\u89e3\u5c31\u662f Gradle \u4f1a\u7f13\u5b58\u4efb\u52a1\u7684\u6267\u884c\u7ed3\u679c\uff0c\u5982\u679c\u91cd\u65b0\u6267\u884c\u4efb\u52a1\u4f46\u662f\u4efb\u52a1\u7684\u8f93\u51fa\u6ca1\u6709\u53d8\u5316\u7684\u8bdd\uff0c\u76f4\u63a5\u590d\u7528\u4e0a\u6b21\u7684\u6267\u884c\u7ed3\u679c\u3002</p> <p>\u6784\u5efa\u7f13\u5b58 \u9ed8\u8ba4\u662f\u542f\u7528\u7684\uff0c\u5728\u9879\u76ee\u7684\u914d\u7f6e\u7684 Gradle \u914d\u7f6e\u6587\u4ef6\u4e2d <pre><code>org.gradle.caching=true\n</code></pre></p> <p>\u53ef\u4ee5\u5148\u6a21\u62df\u6267\u884c\u4efb\u52a1\u770b\u4e00\u4e0b\u4efb\u52a1\u7684\u4f9d\u8d56\u5173\u7cfb <code>-m</code>\uff0c\u7136\u540e\u5728\u5177\u4f53\u6267\u884c\u4efb\u52a1\u7684\u65f6\u5019\u4f7f\u7528 <code>--console=verbose</code> \u8f93\u51fa\u6bcf\u4e2a\u4efb\u52a1\u7684\u6807\u7b7e\uff0c\u67e5\u770b\u662f\u5426\u91cd\u65b0\u6267\u884c\u8fd8\u662f\u7f13\u5b58\u7684\u3002</p> <p>\u6ce8\u610f\uff0c\u589e\u91cf\u6784\u5efa\u548c\u6784\u5efa\u7f13\u5b58\u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u4e1c\u897f\uff1a <pre><code># \u589e\u91cf\u6784\u5efa\n&gt; Task :app:compileJava UP-TO-DATE\n# \u8f93\u5165\u672a\u53d8\uff0c\u8df3\u8fc7\u6267\u884c\n\n# \u6784\u5efa\u7f13\u5b58\n&gt; Task :app:compileJava FROM-CACHE\n# \u4ece\u7f13\u5b58\u83b7\u53d6\u8f93\u51fa\n</code></pre></p>"},{"location":"Java/Gradle/Gradle%20Tips/#lombok","title":"\u914d\u7f6e lombok \u4f9d\u8d56","text":"<pre><code>compileOnly(\"org.projectlombok:lombok\")\nannotation processor pathannotationProcessor(\"org.projectlombok:lombok\")\n</code></pre>"},{"location":"Java/Gradle/Gradle%20%E6%9E%84%E5%BB%BA%20Spring%20Boot%20%E9%A1%B9%E7%9B%AE/","title":"Gradle \u6784\u5efa Spring Boot \u9879\u76ee","text":"<p><pre><code>gradle init --type java-application --dsl kotlin --test-framework junit-jupiter --package com.jacky.gradle --project-name gradle-demo --no-split-project --java-version 21\n</code></pre> --no-split-project \u4f5c\u7528\uff1a\u4e0d\u521b\u5efa\u591a\u9879\u76ee\u7ed3\u6784 \u6548\u679c\uff1a\u751f\u6210\u5355\u9879\u76ee\u7ed3\u6784\uff0c\u6240\u6709\u4ee3\u7801\u90fd\u5728\u6839\u76ee\u5f55\u4e0b \u66ff\u4ee3\u9009\u9879\uff1a\u7701\u7565\u6b64\u53c2\u6570\u4f1a\u521b\u5efa\u591a\u9879\u76ee\u7ed3\u6784\uff08\u6839\u9879\u76ee + app \u5b50\u9879\u76ee\uff09</p> <p>\u914d\u7f6e\u6587\u4ef6 <code>libs.versions.toml</code>\uff0c\u65b0\u589e\u914d\u7f6e\uff1a <pre><code>[versions]  \nspring-boot = \"4.0.0\"  \ndependency-management = \"1.1.7\"  \n\n[plugins]  \n# spring boot \u63d2\u4ef6\nspring-boot = { id = \"org.springframework.boot\", version.ref = \"spring-boot\" }  \n# spring boot \u4f9d\u8d56\u7ba1\u7406\u63d2\u4ef6\nspring-dependency-management = { id = \"io.spring.dependency-management\", version.ref = \"dependency-management\" }\n</code></pre></p> <p>\u914d\u7f6e\u6587\u4ef6 <code>build.gradle.kts</code>\uff0c\u65b0\u589e\u914d\u7f6e\uff1a <pre><code>plugins {  \n    alias(libs.plugins.spring.boot)  \n    alias(libs.plugins.spring.dependency.management)  \n}\n\ndependencies {  \n    // \u5f15\u5165 spring-boot-starter-web \u4f9d\u8d56\n    implementation(\"org.springframework.boot:spring-boot-starter-web\")  \n}\n\ntasks.bootJar {  \n    // \u8bbe\u7f6e\u6253\u5305\u7684 jar \u5305\u540d\u79f0\n    archiveBaseName.set(\"gradle-demo\")  \n    // \u8bbe\u7f6e\u6253 jar \u5305\u7684\u65f6\u5019\u5148\u6267\u884c\u5355\u5143\u6d4b\u8bd5\n    dependsOn(tasks.test)  \n}\n</code></pre></p> <p>\u67e5\u770b\u4efb\u52a1\u5217\u8868 <pre><code>gradlew tasks     # \u5217\u51fa\u6240\u6709\u7684\u53ef\u7528\u4efb\u52a1\ngradlew build     # \u6784\u5efa\u9879\u76ee\ngradlew run       # \u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\ngradlew test      # \u8fd0\u884c\u6d4b\u8bd5\n</code></pre></p> <p>\u5efa\u8bae\u4f7f\u7528 <code>gradlew bootRun</code> \u8fd0\u884c\u9879\u76ee\u3002</p> <p>\u547d\u4ee4\u884c\u4f20\u9012\u53c2\u6570 <pre><code>./gradlew bootRun --args=\"--spring.application.name='my app' --server.port=8090\"\n</code></pre></p> <p>\u6216\u8005 <code>bootRun</code> \u4efb\u52a1\u8fdb\u884c\u914d\u7f6e\uff0c\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 <code>build.gradle.kts</code>\uff1a <pre><code>tasks.bootRun {  \n    args = listOf(  \n        \"--server.port=8090\"  \n    )  \n}\n</code></pre></p>"},{"location":"Java/MyBatis/MyBatis%20%E5%8F%8D%E5%B0%84%E5%B7%A5%E5%85%B7%E7%AE%B1/","title":"MyBatis \u53cd\u5c04\u5de5\u5177\u7bb1","text":""},{"location":"Java/MyBatis/MyBatis%20%E5%8F%8D%E5%B0%84%E5%B7%A5%E5%85%B7%E7%AE%B1/#reflector","title":"Reflector","text":"<p>\u6bcf\u4e2a <code>Reflector</code> \u5bf9\u8c61\u5bf9\u5e94\u4e00\u4e2a\u7c7b,\u5728 <code>Reflector</code> \u4e2d\u7f13\u5b58\u4e86\u53cd\u5c04\u64cd\u4f5c\u9700\u8981\u4f7f\u7528\u7684\u7c7b\u7684\u5143\u4fe1\u606f\u3002</p> <p>\u5b57\u6bb5\u548c\u5c5e\u6027</p> <p>\u5728\u89e3\u6790 <code>Reflector</code> \u7684\u6e90\u7801\u4e4b\u524d\uff0c\u5148\u533a\u5206\u4e00\u4e0b\u201c\u5b57\u6bb5\u201d\u548c\u201c\u5c5e\u6027\u201d\u7684\u533a\u522b\u3002\u7c7b\u4e2d\u5b9a\u4e49\u7684\u6210\u5458\u53d8\u91cf\u79f0\u4e3a\u5b57\u6bb5\uff0c\u800c\u5c5e\u6027\u53ea\u4e0e\u65b9\u6cd5\u6709\u5173\u3002\u5982\u679c\u7c7b\u5b58\u5728 <code>getA()</code> \u548c <code>setA(String)</code> \u65b9\u6cd5\uff0c\u5c31\u8ba4\u4e3a\u7c7b\u4e2d\u5b58\u5728\u5c5e\u6027 <code>a</code>\uff0c\u548c\u5b9e\u9645\u7c7b\u4e2d\u5b58\u4e0d\u5b58\u5728\u5b57\u6bb5 <code>a</code> \u65e0\u5173\u3002</p> <p>Reflector \u7c7b\u4e2d\u5404\u4e2a\u5b57\u6bb5\u7684\u542b\u4e49\u3002 <pre><code>  // \u5bf9\u5e94\u7684 Class \u7c7b\u578b\n  private final Class&lt;?&gt; type;\n\n  // \u53ef\u8bfb\u5c5e\u6027\u7684\u96c6\u5408\uff0c\u5b58\u5728\u76f8\u5e94\u7684 getter \u65b9\u6cd5\n  private final String[] readablePropertyNames;\n  // \u53ef\u5199\u5c5e\u6027\u7684\u96c6\u5408\uff0c\u5b58\u5728\u76f8\u5e94\u7684 setter \u65b9\u6cd5\n  private final String[] writablePropertyNames;\n\n  // \u7f13\u5b58\u4e86\u5c5e\u6027\u540d\u79f0\u548c\u5bf9\u5e94\u7684 setter \u65b9\u6cd5\uff0cInvoker \u662f Method \u7684\u5c01\u88c5\n  private final Map&lt;String, Invoker&gt; setMethods = new HashMap&lt;&gt;();\n  // \u7f13\u5b58\u4e86\u5c5e\u6027\u540d\u79f0\u548c\u5bf9\u5e94\u7684 getter \u65b9\u6cd5\n  private final Map&lt;String, Invoker&gt; getMethods = new HashMap&lt;&gt;();\n\n  // \u7f13\u5b58\u4e86\u5c5e\u6027\u540d\u79f0\u548c setter \u65b9\u6cd5\u63a5\u6536\u7684\u53c2\u6570\u7c7b\u578b\n  private final Map&lt;String, Class&lt;?&gt;&gt; setTypes = new HashMap&lt;&gt;();\n  // \u7f13\u5b58\u4e86\u5c5e\u6027\u540d\u79f0\u548c getter \u65b9\u6cd5\u8fd4\u56de\u7684\u53c2\u6570\u7c7b\u578b\n  private final Map&lt;String, Class&lt;?&gt;&gt; getTypes = new HashMap&lt;&gt;();\n\n  // \u9ed8\u8ba4\u7684\u6784\u9020\u51fd\u6570\n  private Constructor&lt;?&gt; defaultConstructor;\n</code></pre></p> <p>\u4f7f\u7528\u65b9\u6cd5\u793a\u4f8b\uff1a <pre><code>Reflector reflector = new Reflector(TestEntity.class);\n</code></pre></p> <p><code>Reflector</code> \u7684\u6784\u9020\u51fd\u6570 <pre><code>  public Reflector(Class&lt;?&gt; clazz) {\n    type = clazz; // \u521d\u59cb\u5316 type \u5b57\u6bb5\n    addDefaultConstructor(clazz); // \u67e5\u627e\u9ed8\u8ba4\u7684\u6784\u9020\u51fd\u6570\ud83c\udf55\n    Method[] classMethods = getClassMethods(clazz); // \u83b7\u53d6\u7c7b\u7684\u6240\u6709\u65b9\u6cd5 \ud83c\udf54\n    if (isRecord(type)) { // \u5224\u65ad\u662f\u5426\u662f record \u7c7b\u7c7b\u578b\uff0c\u7528\u7684\u5c11\u5ffd\u7565\n      addRecordGetMethods(classMethods);\n    } else {\n      addGetMethods(classMethods); // \u5904\u7406\u6240\u6709\u7684 getter \u65b9\u6cd5 \ud83c\udf5f\n      addSetMethods(classMethods); // \u5904\u7406\u6240\u6709\u7684 setter \u65b9\u6cd5\n      addFields(clazz);\n    }\n    readablePropertyNames = getMethods.keySet().toArray(new String[0]);\n    writablePropertyNames = setMethods.keySet().toArray(new String[0]);\n    for (String propName : readablePropertyNames) {\n      caseInsensitivePropertyMap.put(propName.toUpperCase(Locale.ENGLISH), propName);\n    }\n    for (String propName : writablePropertyNames) {\n      caseInsensitivePropertyMap.put(propName.toUpperCase(Locale.ENGLISH), propName);\n    }\n  }\n</code></pre></p> <p>\u67e5\u627e\u9ed8\u8ba4\u7684\u6784\u9020\u51fd\u6570\ud83c\udf55\uff1a <pre><code>  // \u67e5\u627e\u9ed8\u8ba4\u7684\u6784\u9020\u51fd\u6570\uff0c\u5982\u679c\u5b58\u5728\u53c2\u6570\u5217\u8868\u4e3a 0 \u7684\u5c31\u8d4b\u503c\u7ed9 defaultConstructor\n  // \u5426\u5219 defaultConstructor \u4e3a null\n  private void addDefaultConstructor(Class&lt;?&gt; clazz) {\n    Constructor&lt;?&gt;[] constructors = clazz.getDeclaredConstructors();\n    Arrays.stream(constructors)\n    .filter(constructor -&gt; constructor.getParameterTypes().length == 0)\n    .findAny()\n    .ifPresent(constructor -&gt; this.defaultConstructor = constructor);\n  }\n</code></pre></p> <p>\u83b7\u53d6\u7c7b\u7684\u6240\u6709\u65b9\u6cd5\ud83c\udf54\uff1a <pre><code> // \u83b7\u53d6\u7c7b\u7684\u6240\u6709\u65b9\u6cd5\uff0c\u672c\u8eab\u5b9a\u4e49\u7684\u4ee5\u53ca\u7236\u7c7b\u7236\u63a5\u53e3\u5b9a\u4e49\u7684\n private Method[] getClassMethods(Class&lt;?&gt; clazz) {\n    // \u7f13\u5b58\u65b9\u6cd5\u7b7e\u540d\u548c Method \u5bf9\u8c61\n    Map&lt;String, Method&gt; uniqueMethods = new HashMap&lt;&gt;();\n    Class&lt;?&gt; currentClass = clazz;\n    // \u7531\u4e8e\u8bed\u6cd5\u89c4\u5b9a\uff0c\u4e00\u4e2a\u7c7b\u53ea\u80fd\u7ee7\u627f\u4e00\u4e2a\u7c7b\uff0c\u6240\u4ee5\u8fd9\u91cc\u5faa\u73af\u5411\u4e0a\u904d\u5386\u76f4\u5230 Object\n    while (currentClass != null &amp;&amp; currentClass != Object.class) {\n      // getDeclaredMethods \u83b7\u53d6\u5f53\u524d\u7c7b\u4e2d\u5b9a\u4e49\u7684\u6240\u6709\u65b9\u6cd5\n      addUniqueMethods(uniqueMethods, currentClass.getDeclaredMethods());\n\n      // we also need to look for interface methods -\n      // because the class may be abstract\n      // \u5982\u679c\u662f\u5b9e\u73b0\u7684\u63a5\u53e3\uff0c\u76f4\u63a5\u4f7f\u7528 getMethods \u83b7\u53d6\u6574\u4e2a\u63a5\u53e3\u6811\u7684\u6240\u6709\u65b9\u6cd5\n      // \u56e0\u4e3a\u63a5\u53e3\u7684\u65b9\u6cd5\u90fd\u662f public \u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u4e00\u6b21\u6027\u83b7\u53d6\n      Class&lt;?&gt;[] interfaces = currentClass.getInterfaces();\n      for (Class&lt;?&gt; anInterface : interfaces) {\n        addUniqueMethods(uniqueMethods, anInterface.getMethods());\n      }\n\n      // \u5411\u4e0a\u904d\u5386\u7236\u7c7b\n      currentClass = currentClass.getSuperclass();\n    }\n\n    Collection&lt;Method&gt; methods = uniqueMethods.values();\n\n    return methods.toArray(new Method[0]);\n  }\n\n  private void addUniqueMethods(Map&lt;String, Method&gt; uniqueMethods, Method[] methods) {\n    for (Method currentMethod : methods) {\n      if (!currentMethod.isBridge()) { // \u5ffd\u7565\u6cdb\u578b\u6865\u63a5\u65b9\u6cd5\n        String signature = getSignature(currentMethod);\n        // check to see if the method is already known\n        // if it is known, then an extended class must have\n        // overridden a method\n        // \u5982\u679c\u65b9\u6cd5\u7b7e\u540d\u5df2\u7ecf\u5b58\u5728\uff0c\u5219\u5ffd\u7565\n        if (!uniqueMethods.containsKey(signature)) {\n          uniqueMethods.put(signature, currentMethod);\n        }\n      }\n    }\n  }\n\n  // \u83b7\u53d6\u65b9\u6cd5\u7b7e\u540d\uff1a\u8fd4\u56de\u7c7b\u578b#\u65b9\u6cd5\u540d:\u53c2\u65701\u7c7b\u578b,\u53c2\u65702\u7c7b\u578b\n  // \u65b9\u6cd5\u7b7e\u540d\u4e0d\u5305\u62ec\u8fd4\u56de\u503c\u7c7b\u578b\n  private String getSignature(Method method) {\n    StringBuilder sb = new StringBuilder();\n    Class&lt;?&gt; returnType = method.getReturnType();\n    // Class.getName() \u4e0d\u4f1a\u5305\u542b\u6cdb\u578b\u4fe1\u606f\n    sb.append(returnType.getName()).append('#');\n    sb.append(method.getName());\n    Class&lt;?&gt;[] parameters = method.getParameterTypes();\n    for (int i = 0; i &lt; parameters.length; i++) {\n      sb.append(i == 0 ? ':' : ',').append(parameters[i].getName());\n    }\n    return sb.toString();\n  }\n</code></pre></p> <p>\u5904\u7406 getter \u65b9\u6cd5\ud83c\udf5f\uff1a <pre><code>  private void addGetMethods(Method[] methods) {\n    // \u7f13\u5b58\u5c5e\u6027\u5bf9\u5e94\u7684\u65b9\u6cd5\uff0ckey \u4e3a\u5c5e\u6027\u540d\uff0cvalue \u4e3a\u65b9\u6cd5\u5217\u8868\n    // \u4f7f\u7528\u5217\u8868\u7f13\u5b58\u65b9\u6cd5\uff0c\u662f\u56e0\u4e3a\u8003\u8651\u5230\u5c5e\u6027\u540d\u79f0\u76f8\u540c\u7684\u65b9\u6cd5\uff08isA \u548c getA\uff09\n    Map&lt;String, List&lt;Method&gt;&gt; conflictingGetters = new HashMap&lt;&gt;();\n    Arrays.stream(methods)\n    // \u4fdd\u7559 getXXX \u6216\u8005 isXXX \u5e76\u4e14\u53c2\u6570\u5217\u8868\u4e3a\u7a7a\u7684 getter \u65b9\u6cd5\n    .filter(m -&gt; m.getParameterTypes().length == 0 &amp;&amp; PropertyNamer.isGetter(m.getName()))\n    // \u5c06 getAbc \u6216\u8005 isAbc \u8f6c\u6362\u6210 abc\uff0c\u5e76\u4e14\u7f13\u5b58\u5230 map \u91cc\u9762 \n    .forEach(m -&gt; addMethodConflict(conflictingGetters, PropertyNamer.methodToProperty(m.getName()), m));\n    // \u89e3\u51b3\u91cd\u8f7d\u7684 getter \u65b9\u6cd5\n    resolveGetterConflicts(conflictingGetters);\n  }\n\n  private void resolveGetterConflicts(Map&lt;String, List&lt;Method&gt;&gt; conflictingGetters) {\n    for (Entry&lt;String, List&lt;Method&gt;&gt; entry : conflictingGetters.entrySet()) {\n      // \u4ece\u51b2\u7a81\u7684\u5c5e\u6027\u65b9\u6cd5\u4e2d\u9009\u51fa\u4e00\u4e2a\n      Method winner = null;\n      String propName = entry.getKey();\n      boolean isAmbiguous = false;\n      for (Method candidate : entry.getValue()) {\n        // \u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u5e76\u4e0d\u4f1a\u5b58\u5728 isA \u548c getA \u65b9\u6cd5\u540c\u65f6\u5b58\u5728\u7684\u60c5\u51b5\n        if (winner == null) {\n          winner = candidate;\n          continue; \n        }\n        Class&lt;?&gt; winnerType = winner.getReturnType();\n        // \u5019\u9009\u65b9\u6cd5\n        Class&lt;?&gt; candidateType = candidate.getReturnType();\n        if (candidateType.equals(winnerType)) { \n          // \u5982\u679c\u8fd4\u56de\u7c7b\u578b\u76f8\u540c\u5e76\u4e14\u4e0d\u662f boolean \u8fd4\u56de\u7c7b\u578b\u7684\u8bdd\u5c31\u5b58\u5728\u6b67\u4e49\n          // \u6bd4\u5982 String getA() \u548c String isA()\n          if (!boolean.class.equals(candidateType)) {\n            isAmbiguous = true;\n            break;\n          }\n          // \u5982\u679c\u8fd4\u56de\u7c7b\u578b\u76f8\u540c\uff0c\u5e76\u4e14\u90fd\u662f boolean \u8fd4\u56de\u7c7b\u578b\uff0c\u5219\u67e5\u627e is \u5f00\u5934\u7684\u65b9\u6cd5\n          // \u6bd4\u5982 boolean getA() \u548c boolean isA() \u5219\u4f7f\u7528 isA()\n          if (candidate.getName().startsWith(\"is\")) {\n            winner = candidate;\n          }\n        } \n        // \u5982\u679c\u8fd4\u56de\u7c7b\u578b\u4e0d\u540c\uff0c\u4f46\u662f\u5b58\u5728\u7236\u5b50\u5173\u7cfb\uff0c\u5219\u4f7f\u7528\u7236\u7c7b\u578b\u65b9\u6cd5\n        else if (candidateType.isAssignableFrom(winnerType)) {\n          // OK getter type is descendant\n        } else if (winnerType.isAssignableFrom(candidateType)) {\n          winner = candidate;\n        } \n        // \u5b58\u5728\u5c5e\u6027\u76f8\u540c\uff0c\u4f46\u662f\u8fd4\u56de\u7c7b\u578b\u4e0d\u4e00\u6837\uff0c\u4e14\u8fd4\u56de\u7c7b\u578b\u4e0d\u4e00\u81f4\n        // \u6bd4\u5982 String getA() \u548c Integer isA()\n        else {\n          isAmbiguous = true;\n          break;\n        }\n      }\n      addGetMethod(propName, winner, isAmbiguous);\n    }\n  }\n\n  private void addGetMethod(String name, Method method, boolean isAmbiguous) {\n    MethodInvoker invoker = isAmbiguous ? new AmbiguousMethodInvoker(method, MessageFormat.format(\n        \"Illegal overloaded getter method with ambiguous type for property ''{0}'' in class ''{1}''. This breaks the JavaBeans specification and can cause unpredictable results.\",\n        name, method.getDeclaringClass().getName())) : new MethodInvoker(method);\n    // \u7f13\u5b58\u5c5e\u6027\u548c\u5bf9\u5e94\u7684 MethodInvoker\n    getMethods.put(name, invoker);\n    Type returnType = TypeParameterResolver.resolveReturnType(method, type);\n    // \u7f13\u5b58\u5c5e\u6027\u548c getter \u7684\u8fd4\u56de\u7c7b\u578b\n    getTypes.put(name, typeToClass(returnType));\n  }\n\n  public static Type resolveReturnType(Method method, Type srcType) {\n    Type returnType = method.getGenericReturnType();\n    Class&lt;?&gt; declaringClass = method.getDeclaringClass();\n    return resolveType(returnType, srcType, declaringClass);\n  }\n\n  private static Type resolveType(Type type, Type srcType, Class&lt;?&gt; declaringClass) {\n    if (type instanceof TypeVariable) {\n      return resolveTypeVar((TypeVariable&lt;?&gt;) type, srcType, declaringClass);\n    } \n    else if (type instanceof ParameterizedType) {\n      return resolveParameterizedType((ParameterizedType) type, srcType, declaringClass);\n    } \n    else if (type instanceof GenericArrayType) {\n      return resolveGenericArrayType((GenericArrayType) type, srcType, declaringClass);\n    } \n    else if (type instanceof WildcardType) {\n      return resolveWildcardType((WildcardType) type, srcType, declaringClass);\n    } \n    else {\n      return type;\n    }\n  }\n</code></pre></p> <p>\u5982\u679c\u5b58\u5728\u5c5e\u6027\u76f8\u540c\u4f46\u662f\u8fd4\u56de\u7c7b\u578b\u4e0d\u540c\u7684\u60c5\u51b5\uff0c\u4f1a\u6784\u9020\u4e00\u4e2a <code>AmbiguousMethodInvoker</code> \u5426\u5219\u662f <code>MethodInvoker</code>\uff1a <pre><code>public interface Invoker {  \n  Object invoke(Object target, Object[] args) throws IllegalAccessException, InvocationTargetException;  \n\n  Class&lt;?&gt; getType();  \n}\n\npublic class MethodInvoker implements Invoker {\n\n  private final Class&lt;?&gt; type;\n  private final Method method;\n\n  public MethodInvoker(Method method) {\n    this.method = method;\n\n    // setter \u65b9\u6cd5 type \u5b58\u50a8\u53c2\u6570\u7c7b\u578b\n    if (method.getParameterTypes().length == 1) {\n      type = method.getParameterTypes()[0];\n    } \n    // getter \u65b9\u6cd5\u5b58\u50a8\u8fd4\u56de\u7c7b\u578b\n    else {\n      type = method.getReturnType();\n    }\n  }\n\n  @Override\n  public Object invoke(Object target, Object[] args) throws IllegalAccessException, InvocationTargetException {\n    try {\n      return method.invoke(target, args);\n    } catch (IllegalAccessException e) {\n      if (Reflector.canControlMemberAccessible()) {\n        method.setAccessible(true);\n        return method.invoke(target, args);\n      }\n      throw e;\n    }\n  }\n\n  @Override\n  public Class&lt;?&gt; getType() {\n    return type;\n  }\n}\n\npublic class AmbiguousMethodInvoker extends MethodInvoker {\n  private final String exceptionMessage;\n\n  public AmbiguousMethodInvoker(Method method, String exceptionMessage) {\n    super(method);\n    this.exceptionMessage = exceptionMessage;\n  }\n\n  @Override\n  public Object invoke(Object target, Object[] args) throws IllegalAccessException, InvocationTargetException {\n    throw new ReflectionException(exceptionMessage);\n  }\n}\n</code></pre></p>"},{"location":"Java/MyBatis/MyBatis%20%E5%8F%8D%E5%B0%84%E5%B7%A5%E5%85%B7%E7%AE%B1/#reflectorfactory","title":"ReflectorFactory","text":"<p>\u5de5\u5382\u63a5\u53e3\uff0c\u53ea\u6709\u4e00\u4e2a\u5b9e\u73b0\u7c7b <code>DefaultReflectorFactory</code>\uff1a <pre><code>public interface ReflectorFactory {\n    boolean isClassCacheEnabled();\n\n    void setClassCacheEnabled(boolean var1);\n\n    Reflector findForClass(Class&lt;?&gt; var1);\n}\n\npublic class DefaultReflectorFactory implements ReflectorFactory { \n    // \u662f\u5426\u5f00\u542f\u7f13\u5b58\n    private boolean classCacheEnabled = true;  \n    // \u7f13\u5b58 Class \u548c Reflector\n    private final ConcurrentMap&lt;Class&lt;?&gt;, Reflector&gt; reflectorMap = new ConcurrentHashMap();  \n\n    public DefaultReflectorFactory() {  \n    }  \n\n    public boolean isClassCacheEnabled() {  \n        return this.classCacheEnabled;  \n    }  \n\n    public void setClassCacheEnabled(boolean classCacheEnabled) {  \n        this.classCacheEnabled = classCacheEnabled;  \n    }  \n\n    public Reflector findForClass(Class&lt;?&gt; type) {  \n        return this.classCacheEnabled ? \n        (Reflector)MapUtil.computeIfAbsent(this.reflectorMap, type, Reflector::new) : new Reflector(type);  \n    }  \n}\n</code></pre></p>"},{"location":"Java/MyBatis/MyBatis%20%E5%8F%8D%E5%B0%84%E5%B7%A5%E5%85%B7%E7%AE%B1/#objectfatory","title":"ObjectFatory","text":"<p>\u63a5\u53e3\u4e3b\u8981\u5b9a\u4e49\u4e86\u4e24\u4e2a\u521b\u5efa\u5bf9\u8c61\u7684\u65b9\u6cd5\uff1a <pre><code>  &lt;T&gt; T create(Class&lt;T&gt; type);\n  &lt;T&gt; T create(Class&lt;T&gt; type, List&lt;Class&lt;?&gt;&gt; constructorArgTypes, List&lt;Object&gt; constructorArgs);\n</code></pre></p> <p>DefaultObjectFactory \u662f\u8be5\u63a5\u53e3\u7684\u552f\u4e00\u5b9e\u73b0\u7c7b\uff1a <pre><code>public class DefaultObjectFactory implements ObjectFactory, Serializable {\n\n  private static final long serialVersionUID = -8855120656740914948L;\n\n  @Override\n  public &lt;T&gt; T create(Class&lt;T&gt; type) {\n    return create(type, null, null);\n  }\n\n  @SuppressWarnings(\"unchecked\")\n  @Override\n  public &lt;T&gt; T create(Class&lt;T&gt; type, List&lt;Class&lt;?&gt;&gt; constructorArgTypes, List&lt;Object&gt; constructorArgs) {\n    Class&lt;?&gt; classToCreate = resolveInterface(type);\n    // we know types are assignable\n    return (T) instantiateClass(classToCreate, constructorArgTypes, constructorArgs);\n  }\n\n  private &lt;T&gt; T instantiateClass(Class&lt;T&gt; type, List&lt;Class&lt;?&gt;&gt; constructorArgTypes, List&lt;Object&gt; constructorArgs) {\n    try {\n      Constructor&lt;T&gt; constructor;\n      if (constructorArgTypes == null || constructorArgs == null) {\n        // \u5982\u679c\u6ca1\u6709\u53c2\u6570\u5217\u8868\uff0c\u76f4\u63a5\u8c03\u7528\u9ed8\u8ba4\u7684\u6784\u9020\u51fd\u6570\u751f\u6210\u5bf9\u8c61\n        constructor = type.getDeclaredConstructor();\n        try {\n          return constructor.newInstance();\n        } catch (IllegalAccessException e) {\n          if (Reflector.canControlMemberAccessible()) {\n            constructor.setAccessible(true);\n            return constructor.newInstance();\n          }\n          throw e;\n        }\n      }\n      // \u5982\u679c\u4f20\u9012\u4e86\u53c2\u6570\u7c7b\u578b\u5217\u8868\uff0c\u5219\u67e5\u627e\u5bf9\u5e94\u7684\u6784\u9020\u51fd\u6570\u751f\u6210\u5bf9\u8c61\n      constructor = type.getDeclaredConstructor(constructorArgTypes.toArray(new Class[0]));\n      try {\n        return constructor.newInstance(constructorArgs.toArray(new Object[0]));\n      } catch (IllegalAccessException e) {\n        if (Reflector.canControlMemberAccessible()) {\n          constructor.setAccessible(true);\n          return constructor.newInstance(constructorArgs.toArray(new Object[0]));\n        }\n        throw e;\n      }\n    } catch (Exception e) {\n      String argTypes = Optional.ofNullable(constructorArgTypes).orElseGet(Collections::emptyList).stream()\n          .map(Class::getSimpleName).collect(Collectors.joining(\",\"));\n      String argValues = Optional.ofNullable(constructorArgs).orElseGet(Collections::emptyList).stream()\n          .map(String::valueOf).collect(Collectors.joining(\",\"));\n      throw new ReflectionException(\"Error instantiating \" + type + \" with invalid types (\" + argTypes + \") or values (\"\n          + argValues + \"). Cause: \" + e, e);\n    }\n  }\n\n  // \u5982\u679c\u4f20\u9012\u4e86\u8fd9\u4e9b\u63a5\u53e3\u7c7b\u578b\uff0c\u5219\u5904\u7406\u4e00\u4e0b\u4f7f\u7528\u9ed8\u8ba4\u7684\u5b9e\u73b0\u7c7b\n  protected Class&lt;?&gt; resolveInterface(Class&lt;?&gt; type) {\n    Class&lt;?&gt; classToCreate;\n    if (type == List.class || type == Collection.class || type == Iterable.class) {\n      classToCreate = ArrayList.class;\n    } else if (type == Map.class) {\n      classToCreate = HashMap.class;\n    } else if (type == SortedSet.class) { // issue #510 Collections Support\n      classToCreate = TreeSet.class;\n    } else if (type == Set.class) {\n      classToCreate = HashSet.class;\n    } else {\n      classToCreate = type;\n    }\n    return classToCreate;\n  }\n}\n</code></pre></p>"},{"location":"Java/MyBatis/MyBatis%20%E5%8F%8D%E5%B0%84%E5%B7%A5%E5%85%B7%E7%AE%B1/#property","title":"Property \u5de5\u5177\u96c6","text":""},{"location":"Java/MyBatis/MyBatis%20%E5%8F%8D%E5%B0%84%E5%B7%A5%E5%85%B7%E7%AE%B1/#propertytokenizer","title":"PropertyTokenizer","text":"<p>\u7528\u6765\u89e3\u6790\u5c5e\u6027\u8868\u8fbe\u5f0f\uff0c\u5982 <code>user.name</code>\uff0c<code>user.orders[0].amount</code>\uff0c<code>userList[0].name</code> \u7b49\u3002 <pre><code>public class PropertyTokenizer implements Iterator&lt;PropertyTokenizer&gt; {\n  private String name;  // . \u5206\u5272\u7684\u7b2c\u4e00\u90e8\u5206\uff0c\u4e0d\u5305\u542b\u7d22\u5f15\n  private final String indexedName;  // . \u5206\u5272\u7684\u7b2c\u4e00\u90e8\u5206\uff0c\u5305\u542b\u7d22\u5f15\n  private String index;  // \u7d22\u5f15\u503c\n  private final String children; // . \u5206\u5272\u7684\u5269\u4f59\u90e8\u5206 \n  public PropertyTokenizer(String fullname) {\n    int delim = fullname.indexOf('.');\n    if (delim &gt; -1) {\n      name = fullname.substring(0, delim);\n      children = fullname.substring(delim + 1);\n    } else {\n      name = fullname;\n      children = null;\n    }\n    indexedName = name;\n    delim = name.indexOf('[');\n    if (delim &gt; -1) {\n      index = name.substring(delim + 1, name.length() - 1);\n      name = name.substring(0, delim);\n    }\n  }\n\n  @Override\n  public boolean hasNext() {\n    return children != null;\n  }\n\n  @Override\n  public PropertyTokenizer next() {\n    return new PropertyTokenizer(children);\n  }\n}\n</code></pre></p> <p>\u793a\u4f8b\uff1a <pre><code>String b = \"user.orders[0].amount\";  \n\nPropertyTokenizer pt = new PropertyTokenizer(b);  \nSystem.out.println(\"name: \" + pt.getName() + \", indexedName: \" + pt.getIndexedName() + \", index: \" + pt.getIndex() + \", children: \" + pt.getChildren());  \nwhile (pt.hasNext()) {  \n    pt = pt.next();  \n    System.out.println(\"name: \" + pt.getName() + \", indexedName: \" + pt.getIndexedName() + \", index: \" + pt.getIndex() + \", children: \" + pt.getChildren());  \n}\n\n// \u8f93\u51fa\n// name: user, indexedName: user, index: null, children: orders[0].amount\n// name: orders, indexedName: orders[0], index: 0, children: amount\n// name: amount, indexedName: amount, index: null, children: null\n</code></pre></p>"},{"location":"Java/MyBatis/MyBatis%20%E5%8F%8D%E5%B0%84%E5%B7%A5%E5%85%B7%E7%AE%B1/#propertynamer","title":"PropertyNamer","text":"<p>\u63d0\u4f9b\u9759\u6001\u65b9\u6cd5\uff0c\u5b8c\u6210\u65b9\u6cd5\u540d\u5230\u5c5e\u6027\u540d\u79f0\u7684\u8f6c\u6362\u3002 <pre><code>public final class PropertyNamer {\n\n  private PropertyNamer() {\n    // Prevent Instantiation of Static Class\n  }\n\n  // \u65b9\u6cd5\u540d\u79f0\u8f6c\u6362\u6210\u5c5e\u6027\u540d\u79f0\n  public static String methodToProperty(String name) {\n    if (name.startsWith(\"is\")) {\n      name = name.substring(2);\n    } else if (name.startsWith(\"get\") || name.startsWith(\"set\")) {\n      name = name.substring(3);\n    } else {\n      throw new ReflectionException(\n          \"Error parsing property name '\" + name + \"'.  Didn't start with 'is', 'get' or 'set'.\");\n    }\n\n    if (name.length() == 1 || name.length() &gt; 1 &amp;&amp; !Character.isUpperCase(name.charAt(1))) {\n      name = name.substring(0, 1).toLowerCase(Locale.ENGLISH) + name.substring(1);\n    }\n\n    return name;\n  }\n\n  public static boolean isProperty(String name) {\n    return isGetter(name) || isSetter(name);\n  }\n\n  public static boolean isGetter(String name) {\n    return name.startsWith(\"get\") &amp;&amp; name.length() &gt; 3 || name.startsWith(\"is\") &amp;&amp; name.length() &gt; 2;\n  }\n\n  public static boolean isSetter(String name) {\n    return name.startsWith(\"set\") &amp;&amp; name.length() &gt; 3;\n  }\n}\n</code></pre></p>"},{"location":"Java/MyBatis/MyBatis%20%E5%8F%8D%E5%B0%84%E5%B7%A5%E5%85%B7%E7%AE%B1/#propertycopier","title":"PropertyCopier","text":"<p>\u4e3b\u8981\u5b9e\u73b0\u5bf9\u4e24\u4e2a\u540c\u7c7b\u578b\u5bf9\u8c61\u4e4b\u95f4\u7684\u5c5e\u6027\u62f7\u8d1d\u3002 <pre><code>public final class PropertyCopier {\n\n  private PropertyCopier() {\n    // Prevent Instantiation of Static Class\n  }\n\n  // \u5c5e\u6027\u590d\u5236\n  public static void copyBeanProperties(Class&lt;?&gt; type, Object sourceBean, Object destinationBean) {\n    Class&lt;?&gt; parent = type;\n    while (parent != null) {\n      final Field[] fields = parent.getDeclaredFields();\n      for (Field field : fields) {\n        try {\n          try {\n            field.set(destinationBean, field.get(sourceBean));\n          } catch (IllegalAccessException e) {\n            if (!Reflector.canControlMemberAccessible()) {\n              throw e;\n            }\n            field.setAccessible(true);\n            field.set(destinationBean, field.get(sourceBean));\n          }\n        } catch (Exception e) { \n          // Nothing useful to do, will only fail on final fields, which will be ignored.\n        }\n      }\n      parent = parent.getSuperclass();\n    }\n  }\n}\n</code></pre></p>"},{"location":"Java/MyBatis/MyBatis%20%E5%8F%8D%E5%B0%84%E5%B7%A5%E5%85%B7%E7%AE%B1/#metaclass","title":"MetaClass","text":"<p>\u662f MyBatis \u5bf9\u7c7b\u7ea7\u522b\u7684\u5143\u6570\u636e\u5c01\u88c5\u5bf9\u5904\u7406\uff0c\u5bf9\u5916\u63d0\u4f9b\u7684\u5de5\u5177\u7c7b\u3002\u6210\u5458\u53d8\u91cf\u548c\u6784\u9020\u65b9\u6cd5\uff1a <pre><code>  private final ReflectorFactory reflectorFactory;\n  private final Reflector reflector;\n\n  private MetaClass(Class&lt;?&gt; type, ReflectorFactory reflectorFactory) {\n    this.reflectorFactory = reflectorFactory;\n    this.reflector = reflectorFactory.findForClass(type);\n  }\n\n  public static MetaClass forClass(Class&lt;?&gt; type, ReflectorFactory reflectorFactory) {\n    return new MetaClass(type, reflectorFactory);\n  }\n</code></pre></p> <p><code>findProperty(String)</code> \u65b9\u6cd5\u67e5\u627e\u5c5e\u6027\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\u4e0d\u652f\u6301\u7d22\u5f15\u67e5\u627e\u3002 <pre><code>public String findProperty(String name) {  \n  StringBuilder prop = buildProperty(name, new StringBuilder());  \n  return prop.length() &gt; 0 ? prop.toString() : null;  \n}\n\nprivate StringBuilder buildProperty(String name, StringBuilder builder) {  \n  PropertyTokenizer prop = new PropertyTokenizer(name);  // \u89e3\u6790\u5c5e\u6027\u540d\u79f0\n  if (prop.hasNext()) { // \u5982\u679c\u662f\u8868\u8fbe\u5f0f\u5219\u9012\u5f52\u67e5\u627e \n    String propertyName = reflector.findPropertyName(prop.getName());  // \u5148\u67e5\u627e\u540d\u79f0\n    if (propertyName != null) {  \n      builder.append(propertyName);  \n      builder.append(\".\");  \n      MetaClass metaProp = metaClassForProperty(propertyName);  \n      // \u89e3\u6790 children \u8fdb\u884c\u9012\u5f52\u67e5\u627e\n      metaProp.buildProperty(prop.getChildren(), builder); \n    }  \n  } else {  // \u5982\u679c\u76f4\u63a5\u662f\u5c5e\u6027\u540d\u79f0\uff0c\u76f4\u63a5\u67e5\u627e\n    String propertyName = reflector.findPropertyName(name);  \n    if (propertyName != null) {  \n      builder.append(propertyName);  \n    }  \n  }  \n  return builder;  \n}\n\npublic MetaClass metaClassForProperty(String name) {  \n  Class&lt;?&gt; propType = reflector.getGetterType(name);  \n  return MetaClass.forClass(propType, reflectorFactory);  \n}\n</code></pre></p> <p>hasGetter(String) hasSetter(String) \u65b9\u6cd5\uff0c\u5224\u65ad\u662f\u5426\u5b58\u5728\u5bf9\u5e94\u7684\u5c5e\u6027\uff0c\u652f\u6301\u7d22\u5f15\u9012\u5f52\u67e5\u8be2\u3002 <pre><code>  public boolean hasSetter(String name) {\n    PropertyTokenizer prop = new PropertyTokenizer(name);\n    if (!prop.hasNext()) { // \u9012\u5f52\u51fa\u53e3\n      return reflector.hasSetter(prop.getName());\n    }\n    if (reflector.hasSetter(prop.getName())) {\n      MetaClass metaProp = metaClassForProperty(prop.getName());\n      return metaProp.hasSetter(prop.getChildren());\n    }\n    return false;\n  }\n\n  public boolean hasGetter(String name) {\n    PropertyTokenizer prop = new PropertyTokenizer(name);\n    if (!prop.hasNext()) { // \u9012\u5f52\u51fa\u53e3\n      return reflector.hasGetter(prop.getName());\n    }\n    if (reflector.hasGetter(prop.getName())) {\n      MetaClass metaProp = metaClassForProperty(prop);\n      return metaProp.hasGetter(prop.getChildren());\n    }\n    return false;\n  }\n\n  private MetaClass metaClassForProperty(PropertyTokenizer prop) {\n    Class&lt;?&gt; propType = getGetterType(prop);\n    return MetaClass.forClass(propType, reflectorFactory);\n  }\n\n  private Class&lt;?&gt; getGetterType(PropertyTokenizer prop) {\n    // \u83b7\u53d6\u5c5e\u6027\u7c7b\u578b\n    Class&lt;?&gt; type = reflector.getGetterType(prop.getName());\n    // \u5982\u679c\u4f7f\u7528\u4e86\u7d22\u5f15\u5e76\u4e14\u662f Collection \u5b50\u7c7b\n    if (prop.getIndex() != null &amp;&amp; Collection.class.isAssignableFrom(type)) {\n      // \u5c5e\u6027\u7684\u8fd4\u56de\u7c7b\u578b\n      Type returnType = getGenericGetterType(prop.getName());\n      if (returnType instanceof ParameterizedType) {\n        Type[] actualTypeArguments = ((ParameterizedType) returnType).getActualTypeArguments();\n        if (actualTypeArguments != null &amp;&amp; actualTypeArguments.length == 1) {\n          returnType = actualTypeArguments[0];\n          if (returnType instanceof Class) {\n            type = (Class&lt;?&gt;) returnType;\n          } else if (returnType instanceof ParameterizedType) {\n            type = (Class&lt;?&gt;) ((ParameterizedType) returnType).getRawType();\n          }\n        }\n      }\n    }\n    return type;\n  }\n\n  private Type getGenericGetterType(String propertyName) {\n    try {\n      Invoker invoker = reflector.getGetInvoker(propertyName);\n      if (invoker instanceof MethodInvoker) {\n        Field declaredMethod = MethodInvoker.class.getDeclaredField(\"method\");\n        declaredMethod.setAccessible(true);\n        Method method = (Method) declaredMethod.get(invoker);\n        return TypeParameterResolver.resolveReturnType(method, reflector.getType());\n      }\n      if (invoker instanceof GetFieldInvoker) {\n        Field declaredField = GetFieldInvoker.class.getDeclaredField(\"field\");\n        declaredField.setAccessible(true);\n        Field field = (Field) declaredField.get(invoker);\n        return TypeParameterResolver.resolveFieldType(field, reflector.getType());\n      }\n    } catch (NoSuchFieldException | IllegalAccessException e) {\n      // Ignored\n    }\n    return null;\n  }\n</code></pre></p>"},{"location":"Java/MyBatis/MyBatis%20%E5%8F%8D%E5%B0%84%E5%B7%A5%E5%85%B7%E7%AE%B1/#objectwrapper","title":"ObjectWrapper","text":"<pre><code>public interface ObjectWrapper {\n  // \u5982\u679c\u5c01\u88c5\u7684\u662f\u666e\u901a\u7684 Bean \u5bf9\u8c61\uff0c\u5219\u8c03\u7528\u76f8\u5e94\u5c5e\u6027\u7684 getter \u65b9\u6cd5\n  // \u5982\u679c\u5c01\u88c5\u7684\u662f\u96c6\u5408\u7c7b\uff0c\u5219\u83b7\u53d6\u6307\u5b9a key \u6216\u4e0b\u6807\u5bf9\u5e94\u7684 value \u503c\n  Object get(PropertyTokenizer prop);\n\n  // \u5982\u679c\u5c01\u88c5\u7684\u662f\u666e\u901a\u7684 Bean \u5bf9\u8c61\uff0c\u5219\u8c03\u7528\u76f8\u5e94\u5c5e\u6027\u7684 setter \u65b9\u6cd5\n  // \u5982\u679c\u5c01\u88c5\u7684\u662f\u96c6\u5408\u7c7b\uff0c\u5219\u8bbe\u7f6e\u6307\u5b9a key \u6216\u4e0b\u6807\u5bf9\u5e94\u7684 value \u503c\n  void set(PropertyTokenizer prop, Object value);\n\n  // \u67e5\u627e\u5c5e\u6027\u8868\u8fbe\u5f0f\u6307\u5b9a\u7684\u5c5e\u6027\n  String findProperty(String name, boolean useCamelCaseMapping);\n\n  // \u67e5\u627e\u53ef\u8bfb\u5c5e\u6027\u7684\u540d\u79f0\u96c6\u5408\n  String[] getGetterNames();\n\n  // \u67e5\u627e\u53ef\u5199\u5c5e\u6027\u7684\u540d\u79f0\u96c6\u5408\n  String[] getSetterNames();\n\n  // \u89e3\u6790\u5c5e\u6027\u8868\u8fbe\u5f0f\u6307\u5b9a\u5c5e\u6027 setter \u65b9\u6cd5\u7684\u53c2\u6570\u7c7b\u578b\n  Class&lt;?&gt; getSetterType(String name);\n\n  // \u89e3\u6790\u5c5e\u6027\u8868\u8fbe\u5f0f\u6307\u5b9a\u8f93\u51fa getter \u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u7c7b\u578b\n  Class&lt;?&gt; getGetterType(String name);\n\n  // \u5224\u65ad\u5c5e\u6027\u8868\u8fbe\u5f0f\u6307\u5b9a\u5c5e\u6027\u662f\u5426\u6709 setter/getter \u65b9\u6cd5\n  boolean hasSetter(String name);\n  boolean hasGetter(String name);\n\n  // \u4e3a\u5c5e\u6027\u8868\u8fbe\u5f0f\u6307\u5b9a\u7684\u5c5e\u6027\u521b\u5efa\u76f8\u5e94\u7684 MetaObject\n  MetaObject instantiatePropertyValue(String name, PropertyTokenizer prop, ObjectFactory objectFactory);\n\n  // \u5224\u65ad\u5c01\u88c5\u5bf9\u8c61\u662f\u5426\u4e3a Collection \u7c7b\u578b\n  boolean isCollection();\n\n  // \u8c03\u7528 Collection \u5bf9\u8c61\u7684 add \u65b9\u6cd5\n  void add(Object element);\n\n  // \u8c03\u7528 Collection \u5bf9\u8c61\u7684 addAll \u65b9\u6cd5\n  &lt;E&gt; void addAll(List&lt;E&gt; element);\n}\n</code></pre> <p>ObjectWrapperFactory \u8d1f\u8d23\u521b\u5efa ObjectWrapper \u5bf9\u8c61\u3002</p> <p>ObjectWrapper  </p> <ul> <li>BaseWrapper  <ul> <li>BeanWrapper  </li> <li>MapWrapper  </li> </ul> </li> <li>CollectionWrapper  </li> </ul> <p>BaseWrapper \u662f\u4e00\u4e2a\u5b9e\u73b0\u4e86 ObjectWrapper \u63a5\u53e3\u7684\u62bd\u8c61\u7c7b\uff0c\u5176\u4e2d\u5c01\u88c5\u4e86 MetaObject \u5bf9\u8c61\uff0c\u5e76\u63d0\u4f9b\u4e86\u4e09\u4e2a\u5e38\u7528\u7684\u65b9\u6cd5\u4f9b\u5b50\u7c7b\u4f7f\u7528\uff1a <pre><code>  protected Object resolveCollection(PropertyTokenizer prop, Object object) {\n    if (\"\".equals(prop.getName())) {\n      return object;\n    }\n    return metaObject.getValue(prop.getName());\n  }\n\n  // \u89e3\u6790\u5c5e\u6027\u8868\u8fbe\u5f0f\u7684\u7d22\u5f15\u4fe1\u606f\uff0c\u83b7\u53d6\u6307\u5b9a\u7684\u9879\n  protected Object getCollectionValue(PropertyTokenizer prop, Object collection) {\n    if (collection == null) {\n      throw new ReflectionException(\"Cannot get the value '\" + prop.getIndexedName() + \"' because the property '\"\n          + prop.getName() + \"' is null.\");\n    }\n    if (collection instanceof Map) {\n      return ((Map) collection).get(prop.getIndex());\n    }\n    int i = Integer.parseInt(prop.getIndex());\n    if (collection instanceof List) {\n      return ((List) collection).get(i);\n    } else if (collection instanceof Object[]) {\n      return ((Object[]) collection)[i];\n    } else if (collection instanceof char[]) {\n      return ((char[]) collection)[i];\n    } else if (collection instanceof boolean[]) {\n      return ((boolean[]) collection)[i];\n    } else if (collection instanceof byte[]) {\n      return ((byte[]) collection)[i];\n    } else if (collection instanceof double[]) {\n      return ((double[]) collection)[i];\n    } else if (collection instanceof float[]) {\n      return ((float[]) collection)[i];\n    } else if (collection instanceof int[]) {\n      return ((int[]) collection)[i];\n    } else if (collection instanceof long[]) {\n      return ((long[]) collection)[i];\n    } else if (collection instanceof short[]) {\n      return ((short[]) collection)[i];\n    } else {\n      throw new ReflectionException(\"Cannot get the value '\" + prop.getIndexedName() + \"' because the property '\"\n          + prop.getName() + \"' is not Map, List or Array.\");\n    }\n  }\n\n  // \u89e3\u6790\u5c5e\u6027\u8868\u8fbe\u5f0f\u7684\u7d22\u5f15\u4fe1\u606f\uff0c\u8bbe\u7f6e\u6307\u5b9a\u7684\u9879\n  protected void setCollectionValue(PropertyTokenizer prop, Object collection, Object value) {\n    if (collection == null) {\n      throw new ReflectionException(\"Cannot set the value '\" + prop.getIndexedName() + \"' because the property '\"\n          + prop.getName() + \"' is null.\");\n    }\n    if (collection instanceof Map) {\n      ((Map) collection).put(prop.getIndex(), value);\n    } else {\n      int i = Integer.parseInt(prop.getIndex());\n      if (collection instanceof List) {\n        ((List) collection).set(i, value);\n      } else if (collection instanceof Object[]) {\n        ((Object[]) collection)[i] = value;\n      } else if (collection instanceof char[]) {\n        ((char[]) collection)[i] = (Character) value;\n      } else if (collection instanceof boolean[]) {\n        ((boolean[]) collection)[i] = (Boolean) value;\n      } else if (collection instanceof byte[]) {\n        ((byte[]) collection)[i] = (Byte) value;\n      } else if (collection instanceof double[]) {\n        ((double[]) collection)[i] = (Double) value;\n      } else if (collection instanceof float[]) {\n        ((float[]) collection)[i] = (Float) value;\n      } else if (collection instanceof int[]) {\n        ((int[]) collection)[i] = (Integer) value;\n      } else if (collection instanceof long[]) {\n        ((long[]) collection)[i] = (Long) value;\n      } else if (collection instanceof short[]) {\n        ((short[]) collection)[i] = (Short) value;\n      } else {\n        throw new ReflectionException(\"Cannot set the value '\" + prop.getIndexedName() + \"' because the property '\"\n            + prop.getName() + \"' is not Map, List or Array.\");\n      }\n    }\n  }\n</code></pre></p> <p>BeanWrapper \u7ee7\u627f\u4e86 BaseWrapper\uff0c\u5c01\u88c5\u4e86 JavaBean \u4ee5\u53ca\u8be5\u5bf9\u8c61\u7684 MetaClass \u5bf9\u8c61\uff0c\u8fd8\u6709\u4ece BaseWrapper \u7ee7\u627f\u800c\u6765\u7684 MetaObject \u5bf9\u8c61\u3002</p> <p>BeanWrapper \u7684 get/set \u4f1a\u6839\u636e\u6307\u5b9a\u7684\u8868\u8fbe\u5f0f\u83b7\u53d6\u548c\u8bbe\u7f6e\u76f8\u5e94\u7684\u5c5e\u6027\u503c\u3002 <pre><code>  @Override\n  public Object get(PropertyTokenizer prop) {\n    if (prop.hasNext()) {\n      return getChildValue(prop);\n    } else if (prop.getIndex() != null) {\n      return getCollectionValue(prop, resolveCollection(prop, object));\n    } else {\n      return getBeanProperty(prop, object);\n    }\n  }\n\n  protected Object getChildValue(PropertyTokenizer prop) {\n    MetaObject metaValue = metaObject.metaObjectForProperty(prop.getIndexedName());\n    if (metaValue == SystemMetaObject.NULL_META_OBJECT) {\n      return null;\n    }\n    // \n    return metaValue.getValue(prop.getChildren());\n  }\n\n  private Object getBeanProperty(PropertyTokenizer prop, Object object) {\n    try {\n      Invoker method = metaClass.getGetInvoker(prop.getName());\n      try {\n        return method.invoke(object, NO_ARGUMENTS);\n      } catch (Throwable t) {\n        throw ExceptionUtil.unwrapThrowable(t);\n      }\n    } catch (RuntimeException e) {\n      throw e;\n    } catch (Throwable t) {\n      throw new ReflectionException(\n          \"Could not get property '\" + prop.getName() + \"' from \" + object.getClass() + \".  Cause: \" + t.toString(), t);\n    }\n  }\n</code></pre></p>"},{"location":"Java/MyBatis/MyBatis%20%E5%8F%8D%E5%B0%84%E5%B7%A5%E5%85%B7%E7%AE%B1/#metaobject","title":"MetaObject","text":"<p>ObjectWrapper \u63d0\u4f9b\u83b7\u53d6/\u8bbe\u7f6e\u5bf9\u8c61\u4e2d\u6307\u5b9a\u5c5e\u6027\u3001\u68c0\u6d4b getter/setter \u7b49\u5e38\u7528\u529f\u80fd\u3002\u4f46\u662f\u5177\u4f53\u7684\u5c5e\u6027\u89e3\u6790\u8fd8\u662f\u80fd\u770b\u5230 MetaObject \u8eab\u5f71\uff0c\u8fd9\u4e9b\u529f\u80fd\u7531 MetaObject \u6765\u8d1f\u8d23\u3002</p> <p>MetaObject \u7684\u5c5e\u6027\u548c\u6784\u9020\u51fd\u6570\uff1a <pre><code>public class MetaObject {\n\n  private final Object originalObject;\n  private final ObjectWrapper objectWrapper;\n  private final ObjectFactory objectFactory;\n  private final ObjectWrapperFactory objectWrapperFactory;\n  private final ReflectorFactory reflectorFactory;\n\n  private MetaObject(Object object, ObjectFactory objectFactory, ObjectWrapperFactory objectWrapperFactory,\n      ReflectorFactory reflectorFactory) {\n    this.originalObject = object;\n    this.objectFactory = objectFactory;\n    this.objectWrapperFactory = objectWrapperFactory;\n    this.reflectorFactory = reflectorFactory;\n\n    if (object instanceof ObjectWrapper) {\n      this.objectWrapper = (ObjectWrapper) object;\n    } else if (objectWrapperFactory.hasWrapperFor(object)) {\n      this.objectWrapper = objectWrapperFactory.getWrapperFor(this, object);\n    } else if (object instanceof Map) {\n      this.objectWrapper = new MapWrapper(this, (Map) object);\n    } else if (object instanceof Collection) {\n      this.objectWrapper = new CollectionWrapper(this, (Collection) object);\n    } else {\n      this.objectWrapper = new BeanWrapper(this, object);\n    }\n  }\n}\n</code></pre></p> <p>MetaObject \u548c ObjectWrapper \u4e2d\u5173\u4e8e\u7c7b\u7684\u65b9\u6cd5\u90fd\u662f\u76f4\u63a5\u8c03\u7528 MetaClass \u65b9\u6cd5\u5b9e\u73b0\u7684\u3002\u5176\u5b83\u5173\u4e8e\u7c7b\u7684\u65b9\u6cd5\u662f\u548c ObjectWrapper \u914d\u5408\u5b9e\u73b0\u3002</p>"},{"location":"Java/MyBatis/MyBatis%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/","title":"MyBatis \u5feb\u901f\u5165\u95e8","text":"<p>MyBatis \u5b98\u7f51\uff1ahttps://mybatis.org/mybatis-3/zh_CN/index.html</p>"},{"location":"Java/MyBatis/MyBatis%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/#_1","title":"\u51c6\u5907\u6570\u636e","text":"<p>DDL <pre><code>DROP TABLE IF EXISTS `user`;\nCREATE TABLE `user` (\n  `username` varchar(100) NOT NULL COMMENT '\u59d3\u540d',\n  `age` int NOT NULL COMMENT '\u5e74\u9f84',\n  `create_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u6570\u636e\u521b\u5efa\u65f6\u95f4'\n) ENGINE=InnoDB COMMENT='\u7528\u6237\u4fe1\u606f\u8868';\n\nINSERT INTO `user` \nVALUES \n    ('jacky',22,'2025-02-14 10:52:01'),\n    ('otto',18,'2025-02-14 10:52:01'),\n    ('zhangsan',25,'2025-02-14 10:52:01');\n</code></pre></p> <p>\u5b9e\u4f53\u7c7b <pre><code>package com.otto.mybatis.entity;\n\nimport java.time.LocalDateTime;\n\npublic class User {\n\n    private String username;\n\n    private Integer age;\n\n    private LocalDateTime createAt;\n\n    // ...\n}\n</code></pre></p>"},{"location":"Java/MyBatis/MyBatis%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/#jdbc","title":"\u76f4\u63a5\u4f7f\u7528 JDBC \u67e5\u8be2\u6570\u636e","text":"<p>\u6dfb\u52a0\u4f9d\u8d56 <pre><code>&lt;dependency&gt;  \n    &lt;groupId&gt;com.mysql&lt;/groupId&gt;  \n    &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;  \n    &lt;version&gt;8.0.33&lt;/version&gt;  \n&lt;/dependency&gt;\n</code></pre></p> <p>\u4ee3\u7801 <pre><code>public class JDBCTest {\n    public static void main(String[] args) {\n        String url = \"jdbc:mysql://192.168.199.129:3306/test\";\n        String user = \"test\";\n        String password = \"xxxx\";\n\n        try (Connection conn = DriverManager.getConnection(url, user, password);\n             PreparedStatement pstmt = conn.prepareStatement(\"SELECT * FROM user WHERE username = ?\")) {\n            pstmt.setString(1, \"jacky\"); // \u8bbe\u7f6e\u53c2\u6570\u503c\n            ResultSet rs = pstmt.executeQuery();\n            while (rs.next()) {\n                String username = rs.getString(\"username\");\n                Integer age = rs.getInt(\"age\");\n                System.out.println(\"username: \" + username + \", age: \" + age);\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre></p>"},{"location":"Java/MyBatis/MyBatis%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/#mybatis","title":"\u4f7f\u7528 MyBatis","text":"<p>\u6dfb\u52a0\u4f9d\u8d56 <pre><code>&lt;dependency&gt;  \n    &lt;groupId&gt;com.mysql&lt;/groupId&gt;  \n    &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;  \n    &lt;version&gt;8.0.33&lt;/version&gt;  \n&lt;/dependency&gt;  \n\n&lt;dependency&gt;  \n    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;  \n    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;  \n    &lt;version&gt;3.5.19&lt;/version&gt;  \n&lt;/dependency&gt;\n</code></pre></p> <p>\u6dfb\u52a0 MyBatis \u914d\u7f6e\u6587\u4ef6 /resourse/mybatis-config.xml <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n&lt;!DOCTYPE configuration\n        PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"\n        \"https://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;\n&lt;configuration&gt;\n    &lt;!--\u914d\u7f6e\u6253\u5370 SQL \u5230\u6807\u51c6\u8f93\u51fa--&gt;\n    &lt;settings&gt;\n        &lt;setting name=\"logImpl\" value=\"STDOUT_LOGGING\"/&gt;\n    &lt;/settings&gt;\n\n    &lt;environments default=\"development\"&gt;\n        &lt;environment id=\"development\"&gt;\n            &lt;transactionManager type=\"JDBC\"/&gt;\n            &lt;dataSource type=\"POOLED\"&gt;\n                &lt;property name=\"driver\" value=\"com.mysql.cj.jdbc.Driver\"/&gt;\n                &lt;property name=\"url\" value=\"jdbc:mysql://192.168.199.129:3306/test\"/&gt;\n                &lt;property name=\"username\" value=\"xxx\"/&gt;\n                &lt;property name=\"password\" value=\"xxxxxx\"/&gt;\n            &lt;/dataSource&gt;\n        &lt;/environment&gt;\n    &lt;/environments&gt;\n\n    &lt;mappers&gt;\n        &lt;mapper resource=\"mapper/UserMapper.xml\"/&gt;\n    &lt;/mappers&gt;\n\n&lt;/configuration&gt;\n</code></pre></p> <p>\u521b\u5efa SQL xml \u6587\u4ef6\uff0c/resource/mapper/UserMapper.xml\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\u4e0d\u5efa\u8bae\u5728 SQL \u672b\u5c3e\u589e\u52a0\u5206\u53f7 <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n&lt;!DOCTYPE mapper\n        PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n        \"https://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;\n&lt;mapper namespace=\"UserMapper\"&gt;\n    &lt;select id=\"selectAll\" resultType=\"com.otto.mybatis.entity.User\"&gt;\n        select username, age, create_at as createAt from user where username = #{username} and age = #{age}\n    &lt;/select&gt;\n&lt;/mapper&gt;\n</code></pre></p> <p>\u67e5\u8be2\u6570\u636e\u4ee3\u7801 <pre><code>public class MyBatisTest {\n    public static void main(String[] args) throws IOException {\n        // XML \u4e2d\u6784\u5efa SqlSessionFactory\n        String resource = \"mybatis-config.xml\";\n        InputStream inputStream = Resources.getResourceAsStream(resource);\n        SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);\n\n        // \u4ece SqlSessionFactory \u4e2d\u83b7\u53d6 SqlSession\n        try(SqlSession sqlSession = sqlSessionFactory.openSession()) {\n\n            Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();\n            params.put(\"username\", \"jacky\");\n            params.put(\"age\", 22);\n            List&lt;User&gt; userList = sqlSession.selectList(\"UserMapper.selectAll\", params);\n            System.out.println(\"query result: ==&gt; \" + userList);\n        }\n    }\n}\n</code></pre></p> <p>Tips:  SqlSessionFactory \u5b9e\u4f8b\u7684\u4f5c\u7528\u57df\u5e94\u8be5\u662f\u5168\u5c40\u7684\uff0c\u4e14\u4e3a\u5355\u4f8b\u3002 SqlSession \u7684\u5b9e\u4f8b\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u56e0\u6b64\u662f\u4e0d\u80fd\u88ab\u5171\u4eab\u7684\uff0c\u6240\u4ee5\u5b83\u7684\u6700\u4f73\u7684\u4f5c\u7528\u57df\u662f\u8bf7\u6c42\u6216\u65b9\u6cd5\u4f5c\u7528\u57df\u3002SqlSession \u7684\u5173\u95ed\u5f88\u91cd\u8981\uff0c\u4e3a\u4e86\u786e\u4fdd\u5173\u95ed\u53ef\u4ee5\u4f7f\u7528 AutoCloseable \u8fdb\u884c\u5173\u95ed\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\u4e2d\u53c2\u6570\u5982\u679c\u6709\u591a\u4e2a\u5360\u4f4d\u7b26\u53c2\u6570\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528 Map \u4f20\u9012\u53c2\u6570\uff0c\u4f7f\u7528\u5360\u4f4d\u7b26\u540d\u79f0\u4f5c\u4e3a\u952e\uff0c\u5b9e\u9645\u7684\u53c2\u6570\u4f5c\u4e3a\u503c\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\u53ea\u662f\u67e5\u8be2\u64cd\u4f5c\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u8fdb\u884c commit \u6216\u8005 rollback \u64cd\u4f5c\u3002\u5982\u679c\u8fdb\u884c\u6570\u636e\u4fee\u6539\uff0c\u9700\u8981\u624b\u52a8 commit \u5e76\u4e14\u6355\u83b7\u5f02\u5e38\uff0c\u5728\u5f02\u5e38\u5904\u7406\u4ee3\u7801\u5757\u4e2d\u8fdb\u884c rollback\u3002 </p> <p>\u4e5f\u53ef\u4ee5\u5728\u83b7\u53d6 SqlSession \u7684\u65f6\u5019\u8bbe\u7f6e\u81ea\u52a8\u63d0\u4ea4 sqlSessionFactory.openSession(true)\uff0c\u90a3\u4e48\u6bcf\u4e2a sql \u90fd\u4f1a\u5f53\u6210\u4e00\u4e2a\u4e8b\u52a1\u5e76\u81ea\u52a8\u63d0\u4ea4\uff0c\u56e0\u6b64\u4e5f\u4e0d\u9700\u8981\u8fdb\u884c\u624b\u52a8\u56de\u6eda\u3002\u5982\u679c\u4f60\u6709\u4e00\u8fde\u4e32\u7684\u64cd\u4f5c\u9700\u8981\u4e8b\u52a1\u6267\u884c\uff0c\u90a3\u4e48\u8fd8\u662f\u624b\u52a8\u63d0\u4ea4\u548c\u5904\u7406\u56de\u6eda\u903b\u8f91\u6bd4\u8f83\u597d\u3002</p>"},{"location":"Java/MyBatis/MyBatis%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/#mapper","title":"\u4f7f\u7528 Mapper \u4ee3\u7406\u5f00\u53d1","text":"<p>\u914d\u7f6e Maven \u6253\u5305\u4ee3\u7801\u5305\u91cc\u9762\u7684 xml \u6587\u4ef6\u3002 <pre><code>    &lt;build&gt;\n        &lt;resources&gt;\n            &lt;resource&gt;\n                &lt;directory&gt;src/main/resources&lt;/directory&gt;\n            &lt;/resource&gt;\n\n            &lt;resource&gt;\n                &lt;directory&gt;src/main/java&lt;/directory&gt;\n                &lt;filtering&gt;true&lt;/filtering&gt;\n                &lt;includes&gt;\n                    &lt;include&gt;**/*.xml&lt;/include&gt;\n                &lt;/includes&gt;\n            &lt;/resource&gt;\n        &lt;/resources&gt;\n    &lt;/build&gt;\n</code></pre></p> <p>\u4fee\u6539 MyBatis \u914d\u7f6e\u6587\u4ef6\uff0c\u589e\u52a0\u626b\u63cf\u76ee\u5f55\u3002 <pre><code>&lt;mappers&gt;  \n    &lt;mapper resource=\"mapper/UserMapper.xml\"/&gt;  \n    &lt;package name=\"com.otto.mybatis.mapper\"/&gt;  \n&lt;/mappers&gt;\n</code></pre></p> <p>\u65b0\u589e com.otto.mybatis.mapper.UserMapper.java \u6587\u4ef6 <pre><code>public interface UserMapper {  \n    List&lt;User&gt; selectAll(@Param(\"username\") String username, @Param(\"age\") Integer age);  \n}\n</code></pre></p> <p>\u65b0\u589e com.otto.mybatis.mapper.UserMapper.xml \u6587\u4ef6 <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;  \n&lt;!DOCTYPE mapper  \n        PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"  \n        \"https://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;  \n&lt;mapper namespace=\"com.otto.mybatis.mapper.UserMapper\"&gt;  \n    &lt;select id=\"selectAll\" resultType=\"com.otto.mybatis.entity.User\"&gt;  \n        select username, age, create_at as createAt from user where username = #{username} and age = #{age}  \n    &lt;/select&gt;  \n&lt;/mapper&gt;\n</code></pre></p> <p>\u6d4b\u8bd5\u4f7f\u7528 UserMapper \u4ee3\u7406\u6267\u884c SQL\u3002 <pre><code>UserMapper userMapper = sqlSession.getMapper(UserMapper.class);  \nList&lt;User&gt; userList = userMapper.selectAll(\"jacky\", 22);  \nSystem.out.println(\"query result: ==&gt; \" + userList);\n</code></pre></p>"},{"location":"Java/MyBatis/MyBatis%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/#xml-sqlsessionfactory","title":"\u4e0d\u4f7f\u7528 XML \u6784\u5efa SqlSessionFactory","text":"<p>\u4f7f\u7528\u5355\u4f8b\u6a21\u5f0f\u6784\u5efa SqlSessionFactory <pre><code>public class MyBatisConfig {  \n\n    private static SqlSessionFactory FACTORY_INSTANCE = null;  \n\n    public static SqlSessionFactory sqlSessionFactory() {  \n        if (FACTORY_INSTANCE == null) {  \n            synchronized (MyBatisConfig.class) {  \n                if (FACTORY_INSTANCE == null) {  \n                    // \u914d\u7f6e\u6570\u636e\u6e90  \n                    PooledDataSource dataSource = new PooledDataSource();  \n                    dataSource.setDriver(\"com.mysql.cj.jdbc.Driver\");  \n                    dataSource.setUrl(\"jdbc:mysql://192.168.199.129:3306/test_db\");  \n                    dataSource.setUsername(\"xxx\");  \n                    dataSource.setPassword(\"xxxxx\");  \n                    // \u914d\u7f6e\u4e8b\u52a1\u7ba1\u7406\u5668  \n                    JdbcTransactionFactory transactionFactory = new JdbcTransactionFactory();  \n                    // \u914d\u7f6e\u73af\u5883  \n                    Environment environment = new Environment(\"development\", transactionFactory, dataSource);  \n                    // \u914d\u7f6e MyBatis                    \n                    Configuration configuration = new Configuration(environment);  \n                    // \u8bbe\u7f6e\u65e5\u5fd7\u5b9e\u73b0\u4e3a\u6807\u51c6\u8f93\u51fa  \n                    configuration.setLogImpl(org.apache.ibatis.logging.stdout.StdOutImpl.class);  \n                    // \u5982\u679c Mapper \u63a5\u53e3\u90fd\u5728\u540c\u4e00\u4e2a\u5305\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u5305\u626b\u63cf  \n                    configuration.addMappers(\"com.otto.mybatis.mapper\");  \n                    // \u6784\u5efa SqlSessionFactory                    \n                    FACTORY_INSTANCE =  new SqlSessionFactoryBuilder().build(configuration);  \n                }  \n            }  \n        }  \n        return FACTORY_INSTANCE;  \n    }  \n}\n</code></pre></p> <p>\u8fdb\u4e00\u6b65\u7b80\u5316\u8c03\u7528\u4ee3\u7801 <pre><code>public class MyBatisTest {\n    public static void main(String[] args) throws IOException {\n        // \u4ece SqlSessionFactory \u4e2d\u83b7\u53d6 SqlSession\n        try(SqlSession sqlSession = MyBatisConfig.sqlSessionFactory().openSession()) {\n\n            UserMapper userMapper = sqlSession.getMapper(UserMapper.class);\n\n            List&lt;User&gt; userList = userMapper.selectAll(\"jacky\", 22);\n            System.out.println(\"query result: ==&gt; \" + userList);\n        }\n    }\n}\n</code></pre></p>"},{"location":"Java/MyBatis/MyBatis%20%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/","title":"MyBatis \u65e5\u5fd7\u6a21\u5757","text":"<p>\u5728 MyBatis \u7684\u65e5\u5fd7\u6a21\u5757\u4e2d\uff0c\u5b9a\u4e49\u4e86 Log \u63a5\u53e3 <pre><code>public interface Log {  \n\n  boolean isDebugEnabled();  \n\n  boolean isTraceEnabled();  \n\n  void error(String s, Throwable e);  \n\n  void error(String s);  \n\n  void debug(String s);  \n\n  void trace(String s);  \n\n  void warn(String s);  \n}\n</code></pre></p> <p>MyBatis \u540c\u65f6\u4e3a Log4j\u3001Sl4j \u7b49\u7b2c\u4e09\u65b9\u65e5\u5fd7\u7ec4\u4ef6\u63d0\u4f9b\u4e86 Adapter\uff0c\u6bd4\u5982 Sl4j <pre><code>public class Slf4jImpl implements Log {  \n\n  private Log log;  \n\n  public Slf4jImpl(String clazz) {  \n    Logger logger = LoggerFactory.getLogger(clazz);  \n\n    if (logger instanceof LocationAwareLogger) {  \n      try {  \n        // check for slf4j &gt;= 1.6 method signature  \n        logger.getClass().getMethod(\"log\", Marker.class, String.class, int.class, String.class, Object[].class,  \n            Throwable.class);  \n        log = new Slf4jLocationAwareLoggerImpl((LocationAwareLogger) logger);  \n        return;  \n      } catch (SecurityException | NoSuchMethodException e) {  \n        // fail-back to Slf4jLoggerImpl  \n      }  \n    }  \n\n    // Logger is not LocationAwareLogger or slf4j version &lt; 1.6  \n    log = new Slf4jLoggerImpl(logger);  \n  }  \n\n  @Override  \n  public boolean isDebugEnabled() {  \n    return log.isDebugEnabled();  \n  }  \n\n  @Override  \n  public boolean isTraceEnabled() {  \n    return log.isTraceEnabled();  \n  }  \n\n  @Override  \n  public void error(String s, Throwable e) {  \n    log.error(s, e);  \n  }  \n\n  @Override  \n  public void error(String s) {  \n    log.error(s);  \n  }  \n\n  @Override  \n  public void debug(String s) {  \n    log.debug(s);  \n  }  \n\n  @Override  \n  public void trace(String s) {  \n    log.trace(s);  \n  }  \n\n  @Override  \n  public void warn(String s) {  \n    log.warn(s);  \n  }  \n\n}\n</code></pre></p> <p>MyBatis \u8fd8\u63d0\u4f9b\u4e86 LogFactory \u5de5\u5382\uff0c\u6765\u83b7\u53d6 Log \u5bf9\u8c61\u3002 <pre><code>public final class LogFactory {  \n\n  /**  \n   * Marker to be used by logging implementations that support markers.   */  public static final String MARKER = \"MYBATIS\";  \n\n  private static final ReentrantLock lock = new ReentrantLock();  \n  private static Constructor&lt;? extends Log&gt; logConstructor;  \n\n  static {  \n    tryImplementation(LogFactory::useSlf4jLogging);  \n    tryImplementation(LogFactory::useCommonsLogging);  \n    tryImplementation(LogFactory::useLog4J2Logging);  \n    tryImplementation(LogFactory::useLog4JLogging);  \n    tryImplementation(LogFactory::useJdkLogging);  \n    tryImplementation(LogFactory::useNoLogging);  \n  }\n\n  private static void tryImplementation(Runnable runnable) {\n    if (logConstructor == null) {\n      try {\n        runnable.run();\n      } catch (Throwable t) {\n        // ignore\n      }\n    }\n  }\n\n  public static Log getLog(Class&lt;?&gt; clazz) {\n    return getLog(clazz.getName());\n  }\n\n  public static Log getLog(String logger) {\n    try {\n      return logConstructor.newInstance(logger);\n    } catch (Throwable t) {\n      throw new LogException(\"Error creating logger for logger \" + logger + \".  Cause: \" + t, t);\n    }\n  }\n\n  \u2026\u2026\n\n  public static void useCustomLogging(Class&lt;? extends Log&gt; clazz) {\n    setImplementation(clazz);\n  }\n\n  public static void useSlf4jLogging() {\n    setImplementation(org.apache.ibatis.logging.slf4j.Slf4jImpl.class);\n  }\n\n  private static void setImplementation(Class&lt;? extends Log&gt; implClass) {\n    lock.lock();\n    try {\n      Constructor&lt;? extends Log&gt; candidate = implClass.getConstructor(String.class);\n      Log log = candidate.newInstance(LogFactory.class.getName());\n      if (log.isDebugEnabled()) {\n        log.debug(\"Logging initialized using '\" + implClass + \"' adapter.\");\n      }\n      logConstructor = candidate;\n    } catch (Throwable t) {\n      throw new LogException(\"Error setting Log implementation.  Cause: \" + t, t);\n    } finally {\n      lock.unlock();\n    }\n  }\n</code></pre></p> <p>Logfactory \u4f1a\u4f9d\u6b21\u5c1d\u8bd5\u52a0\u8f7d\u5404\u4e2a\u65e5\u5fd7\u7ec4\u4ef6\uff0c\u52a0\u8f7d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u7684\uff0c\u4f7f\u7528 ReentrantLock \u4fdd\u8bc1\u3002</p> <p>\u6240\u4ee5\u5982\u679c\u5728\u5e94\u7528\u542f\u52a8\u9636\u6bb5\u7c7b\u8def\u5f84\u4e0b\u6709 Sl4j \u65e5\u5fd7\u6846\u67b6\u7ec4\u4ef6\u7684\u8bdd\uff0c\u90a3\u4e48 LogFactory \u5c31\u4f1a\u4f7f\u7528 Slf4jImpl \u9002\u914d\u5668\u6765\u8f93\u51fa\u6846\u67b6\u65e5\u5fd7\u3002</p> <p>MyBatis \u7684\u94fe\u63a5\u3001\u9884\u5904\u7406\u548c\u83b7\u53d6\u8fd4\u56de\u7ed3\u679c\u90fd\u6709\u65e5\u5fd7\u8f93\u51fa\uff0c\u4f46\u662f\u53ea\u6709\u5728 DEBUG \u7ea7\u522b\u542f\u7528\u65f6\u624d\u4f1a\u8f93\u51fa\u3002ConnectionLogger \u7684\u4ee3\u7801\u7247\u6bb5\u5982\u4e0b\uff1a <pre><code>if (\"prepareStatement\".equals(method.getName()) || \"prepareCall\".equals(method.getName())) {  \n  if (isDebugEnabled()) {  \n    debug(\" Preparing: \" + removeExtraWhitespace((String) params[0]), true);  \n  }  \n  PreparedStatement stmt = (PreparedStatement) method.invoke(connection, params);  \n  return PreparedStatementLogger.newInstance(stmt, statementLog, queryStack);  \n}\n</code></pre></p> <p>\u6240\u4ee5\u5982\u679c\u4f60\u4f7f\u7528 Sl4j + Logback \u7684\u8bdd\uff0c\u60f3\u8981\u8f93\u51fa MyBatis \u65e5\u5fd7\u53ef\u4ee5\u914d\u7f6e\u5bf9\u5e94 Mapper \u5305\u7684\u7ea7\u522b\u4e3a DEBUG\uff1a <pre><code>&lt;logger name=\"com.jacky.mapper\" level=\"DEBUG\"/&gt;\n</code></pre></p> <p>\u6216\u8005\u914d\u7f6e MyBatis \u7684\u914d\u7f6e\u7c7b\uff0c\u4ee3\u7801\u5982\u4e0b\uff0c <pre><code>public static SqlSessionFactory sqlSessionFactory() {  \n    if (FACTORY_INSTANCE == null) {  \n        synchronized (MyBatisConfig.class) {  \n            if (FACTORY_INSTANCE == null) {  \n                \u2026\u2026              \n                Configuration configuration = new Configuration(environment);  \n                // \u8bbe\u7f6e\u65e5\u5fd7\u5b9e\u73b0\u4e3a\u6807\u51c6\u8f93\u51fa  \n                configuration.setLogImpl(org.apache.ibatis.logging.stdout.StdOutImpl.class);  \n                // \u5982\u679c Mapper \u63a5\u53e3\u90fd\u5728\u540c\u4e00\u4e2a\u5305\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u5305\u626b\u63cf  \n                configuration.addMappers(\"com.jacky.mapper\");  \n                // \u6784\u5efa SqlSessionFactory                \n                FACTORY_INSTANCE =  new SqlSessionFactoryBuilder().build(configuration);  \n            }  \n        }  \n    }  \n    return FACTORY_INSTANCE;  \n}\n</code></pre></p> <p>Configuration \u7684 setLogImpl \u4f1a\u8bbe\u7f6e LogFactory \u7684\u65e5\u5fd7\u5b9e\u73b0\u7c7b <pre><code>public void setLogImpl(Class&lt;? extends Log&gt; logImpl) {  \n  if (logImpl != null) {  \n    this.logImpl = logImpl;  \n    LogFactory.useCustomLogging(this.logImpl);  \n  }  \n}\n</code></pre></p> <p>StdOutImpl \u7684 DEBUG \u9ed8\u8ba4\u662f\u5f00\u542f\u7684\uff1a <pre><code>public class StdOutImpl implements Log {  \n\n  public StdOutImpl(String clazz) {  \n    // Do Nothing  \n  }  \n\n  @Override  \n  public boolean isDebugEnabled() {  \n    return true;  \n  }  \n\n  @Override  \n  public boolean isTraceEnabled() {  \n    return true;  \n  }  \n\n  @Override  \n  public void error(String s, Throwable e) {  \n    System.err.println(s);  \n    e.printStackTrace(System.err);  \n  }  \n\n  @Override  \n  public void error(String s) {  \n    System.err.println(s);  \n  }  \n\n  @Override  \n  public void debug(String s) {  \n    System.out.println(s);  \n  }  \n\n  @Override  \n  public void trace(String s) {  \n    System.out.println(s);  \n  }  \n\n  @Override  \n  public void warn(String s) {  \n    System.out.println(s);  \n  }  \n}\n</code></pre></p> <p>\u5982\u679c\u5728\u9879\u76ee\u7684\u7c7b\u8def\u5f84\u4e0b\u6709 Sl4j + Logback\uff0c\u4f46\u540c\u65f6\u53c8\u624b\u52a8\u914d\u7f6e\u4e86 Configuration \u7684 logImpl \u4e3a StdOutImpl\uff0c\u90a3\u4e48\u6700\u7ec8 MyBatis \u4f7f\u7528\u7684\u662f StdOutImpl\u3002 \u524d\u8005\u662f\u5728\u7c7b\u52a0\u8f7d\u9636\u6bb5\u8bbe\u7f6e\u7684\uff0cstatic \u4ee3\u7801\u7247\u6bb5\uff1b\u540e\u8005\u4e00\u822c\u662f\u8fd0\u884c\u65f6\u8bbe\u7f6e\u7684\uff0c\u4f1a\u8986\u76d6\u6389 LogFactory \u7684 logConstructor \u5c5e\u6027\u3002MyBatis \u5185\u90e8\u8fdb\u884c\u65e5\u5fd7\u6253\u5370\u65f6\uff0c\u4e00\u822c\u662f\u5728\u8fd0\u884c\u65f6\u8c03\u7528 LogFactory.getLog \u65b9\u6cd5\u83b7\u53d6\u3002</p>"},{"location":"Java/Spring/RestTemplate/","title":"RestTemplate","text":""},{"location":"Java/Spring/RestTemplate/#spring-boot-resttemplate","title":"Spring Boot \u914d\u7f6e RestTemplate \u8df3\u8fc7\u8bc1\u4e66\u6821\u9a8c","text":"<pre><code>@Bean  \n@Primary  \nRestTemplate restTemplate() {  \n    return new RestTemplate();  \n}  \n\n@Bean  \npublic RestTemplate unTrustedRestTemplate() throws NoSuchAlgorithmException, KeyManagementException {  \n    SSLContext sslContext = SSLContext.getInstance(\"TLS\");  \n    sslContext.init(null, new TrustManager[]{new X509TrustManager() {  \n        @Override  \n        public void checkClientTrusted(X509Certificate[] chain, String authType) {  \n        }  \n\n        @Override  \n        public void checkServerTrusted(X509Certificate[] chain, String authType) {  \n        }  \n\n        @Override  \n        public X509Certificate[] getAcceptedIssuers() {  \n            return new X509Certificate[0];  \n        }  \n    }}, new java.security.SecureRandom());  \n\n    // \u521b\u5efa\u81ea\u5b9a\u4e49\u7684 RequestFactory    \n    SimpleClientHttpRequestFactory requestFactory = new SimpleClientHttpRequestFactory() {  \n        @Override  \n        protected void prepareConnection(HttpURLConnection connection, String httpMethod) throws IOException {  \n            super.prepareConnection(connection, httpMethod);  \n\n            if (connection instanceof javax.net.ssl.HttpsURLConnection) {  \n                // \u8df3\u8fc7\u8bc1\u4e66\u6821\u9a8c  \n                HttpsURLConnection httpsConnection = (HttpsURLConnection) connection;  \n                httpsConnection.setHostnameVerifier((hostname, session) -&gt; true);  \n                httpsConnection.setSSLSocketFactory(sslContext.getSocketFactory());  \n            }  \n        }  \n    };  \n\n    return new RestTemplate(requestFactory);  \n}\n</code></pre>"},{"location":"Java/Spring/Spring%20Tips/","title":"Spring Tips","text":""},{"location":"Java/Spring/Spring%20Tips/#_1","title":"\u6587\u4ef6\u4e0a\u4f20\u5b9e\u65f6\u5904\u7406","text":"<p>Spring boot \u9ed8\u8ba4\u7684 MultipartFile \u4f1a\u5c06\u6587\u4ef6\u5168\u90e8\u63a5\u6536\u7f13\u5b58\u5728\u672c\u5730\u8def\u5f84\uff0c\u7136\u540e\u518d\u8fdb\u5165 Controller \u8fdb\u884c\u5904\u7406\u3002\u8fd9\u65f6\u5982\u679c\u6587\u4ef6\u8fc7\u5927\u672c\u5730\u8def\u5f84\u653e\u4e0d\u4e0b\u7684\u8bdd\u5c31\u4f1a\u5931\u8d25\u3002</p> <p>\u4f7f\u7528 Apache Commons FileUpload Streaming \u8fdb\u884c\u5904\u7406\uff0c\u4f46\u662f\u9700\u8981\u914d\u7f6e\u3002 <pre><code>spring:  \n  servlet:  \n    multipart:  \n      enabled: false\n</code></pre></p>"},{"location":"Java/Spring/Spring%20Tips/#eureka","title":"\u8bbe\u7f6e\u5fae\u670d\u52a1\u4e0d\u6ce8\u518c\u5230 Eureka","text":"<p>\u8bbe\u7f6e\u5fae\u670d\u52a1\u4e0d\u6ce8\u518c\u5230 Eureka \u6ce8\u518c\u4e2d\u5fc3\uff0c\u4f46\u662f\u80fd\u591f\u8c03\u7528\u6ce8\u518c\u4e2d\u5fc3\u5fae\u670d\u52a1\u7684\u63a5\u53e3\u3002 <pre><code>eureka:  \n  client:  \n    register-with-eureka: false  # \u4e0d\u6ce8\u518c\u81ea\u8eab  \n    fetch-registry: true         # \u4ecd\u7136\u83b7\u53d6\u6ce8\u518c\u8868\u4fe1\u606f\n</code></pre></p>"},{"location":"Java/Spring/Spring%20Tips/#spring-boot-deubg","title":"Spring Boot \u5168\u5c40 deubg \u65e5\u5fd7","text":"<pre><code>debug: true\n</code></pre>"},{"location":"Java/Spring/%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C/","title":"\u53c2\u6570\u6821\u9a8c","text":"<p>\u8bf7\u6c42\u8def\u5f84\u4e0d\u5b58\u5728 \u9ed8\u8ba4\u72b6\u6001\u7801 404\uff0c\u53ef\u4ee5\u5904\u7406\u7684\u5f02\u5e38\u4fe1\u606f\uff1a<code>NoResourceFoundException</code>\u3002</p> <p>\u8bf7\u6c42\u65b9\u6cd5\u4e0d\u652f\u6301 \u9ed8\u8ba4\u72b6\u6001\u7801 405\uff0c\u53ef\u4ee5\u5904\u7406\u7684\u5f02\u5e38\u4fe1\u606f\uff1a<code>HttpRequestMethodNotSupportedException</code>\u3002</p> <p>\u8bf7\u6c42\u4f53\u8fc7\u5927</p> <p>\u8bf7\u6c42\u4f53\u4e0d\u5b58\u5728 \u4f7f\u7528\u4e86 @ReuqestBody \u6ce8\u89e3\uff0c\u4f46\u662f\u8bf7\u6c42\u4f53\u4e3a\u7a7a\u3002\u9ed8\u8ba4\u72b6\u6001\u7801 400\uff0c\u53ef\u4ee5\u5904\u7406\u7684\u5f02\u5e38\u4fe1\u606f\uff1a<code>HttpMessageNotReadableException</code>\u3002</p> <p>\u8bf7\u6c42\u4f53 JSON \u8bed\u6cd5\u9519\u8bef HttpMessageNotReadableException</p> <p>\u8bf7\u6c42\u4f53 JSON \u7c7b\u578b\u4e0d\u5339\u914d HttpMessageNotReadableException</p> <p>\u8ba4\u8bc1\u5931\u8d25  401</p> <p>\u9274\u6743\u5931\u8d25  403</p> <p><code>@Valid</code> \u662f JSR-303 \u6807\u51c6\u6ce8\u89e3\uff0c\u9002\u7528\u4e8e\u57fa\u672c\u7684\u6821\u9a8c\u9700\u6c42\uff0c\u4e0d\u652f\u6301\u5206\u7ec4\u6821\u9a8c\u3002 <code>@Validated</code> \u662f Spring \u6269\u5c55\u6ce8\u89e3\uff0c\u652f\u6301\u5206\u7ec4\u6821\u9a8c\uff0c\u9002\u7528\u4e8e\u9700\u8981\u9488\u5bf9\u4e0d\u540c\u573a\u666f\u5e94\u7528\u4e0d\u540c\u6821\u9a8c\u89c4\u5219\u7684\u60c5\u51b5\u3002</p> <p>\u5e38\u7528\u7684\u6ce8\u89e3\u5982\u4e0b\uff0c\u4e00\u822c\u5f02\u5e38\u4fe1\u606f\u4e3a MethodArgumentNotValidException\uff1a <pre><code>The annotated element must not be null. Accepts any type.\n@NotNull\n\nThe annotated element must not be null and must contain at least one non-whitespace character. Accepts CharSequence.\n@NotBlank\n\nThe annotated element must not be null nor empty.\nSupported types are:\n    CharSequence (length of character sequence is evaluated)\n    Collection (collection size is evaluated)\n    Map (map size is evaluated)\n    Array (array length is evaluated)\n@NotEmpty\n\nThe annotated element must be a number whose value must be higher or equal to the specified minimum.\nSupported types are:\n    BigDecimal\n    BigInteger\n    byte, short, int, long, and their respective wrappers\n    Note that double and float are not supported due to rounding errors (some providers might provide some approximative support).\nnull elements are considered valid.\n@Min\n\nThe annotated element must be a number whose value must be lower or equal to the specified maximum.\nSupported types are:\n    BigDecimal\n    BigInteger\n    byte, short, int, long, and their respective wrappers\n    Note that double and float are not supported due to rounding errors (some providers might provide some approximative support).\nnull elements are considered valid.\n@Max\n\nThe string has to be a well-formed email address. Exact semantics of what makes up a valid email address are left to Jakarta Bean Validation providers. Accepts CharSequence.\nnull elements are considered valid.\n@Email\n\nThe annotated CharSequence must match the specified regular expression. The regular expression follows the Java regular expression conventions see java.util.regex.Pattern.\nAccepts CharSequence. \nnull elements are considered valid.\n@Pattern\n\nThe annotated element size must be between the specified boundaries (included).\nSupported types are:\n    CharSequence (length of character sequence is evaluated)\n    Collection (collection size is evaluated)\n    Map (map size is evaluated)\n    Array (array length is evaluated)\nnull elements are considered valid.\n@Size\n</code></pre></p> <p>\u5f15\u5165\u4f9d\u8d56 <pre><code>&lt;dependency&gt;  \n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;  \n    &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;  \n&lt;/dependency&gt;\n</code></pre></p> <p>\u6dfb\u52a0\u6ce8\u89e3 <pre><code>@PostMapping(\"/dto\")  \npublic void dto(@RequestBody @Valid TestDTO dto) {  \n}\n</code></pre></p> <p>\u6821\u9a8c\u4e0d\u901a\u8fc7\uff0c\u9ed8\u8ba4\u72b6\u6001\u7801 400\uff0c\u53ef\u4ee5\u5904\u7406\u7684\u5f02\u5e38\u4fe1\u606f\uff1a<code>MethodArgumentNotValidException</code>\u3002</p> <pre><code>1. DispatcherServlet.doDispatch()\n2. AbstractHandlerMethodAdapter.handle()\n3. RequestMappingHandlerAdapter.handleInternal()\n4. RequestMappingHandlerAdapter.invokeHandlerMethod()\n5. ServletInvocableHandlerMethod.invokeAndHandle()\n6. InvocableHandlerMethod.invokeForRequest()\n   \u2193\n   // \u53c2\u6570\u89e3\u6790\u9636\u6bb5\n7. HandlerMethodArgumentResolverComposite.resolveArgument()\n8. RequestResponseBodyMethodProcessor.resolveArgument()\n   \u2193\n   // \u53cd\u5e8f\u5217\u5316\u9636\u6bb5\n9. AbstractMessageConverterMethodArgumentResolver.readWithMessageConverters()\n10. MappingJackson2HttpMessageConverter.read() // JSON\u8f6c\u5bf9\u8c61\n   \u2193\n   // \u6821\u9a8c\u9636\u6bb5\n11. DataBinder.validateIfApplicable()\n12. LocalValidatorFactoryBean.validate() // \u6267\u884cBean Validation\n13. \u5982\u679c\u6709\u9519\u8bef: throw MethodArgumentNotValidException\n   \u2193\n   // \u65b9\u6cd5\u6267\u884c\n14. \u5982\u679c\u6821\u9a8c\u901a\u8fc7: \u6267\u884c\u63a7\u5236\u5668\u65b9\u6cd5\u4f53\n</code></pre> <p>HTTP \u72b6\u6001\u7801\u548c\u4e1a\u52a1\u72b6\u6001\u7801</p> <p>\u4e1a\u52a1\u72b6\u6001\u7801 0-1000 \u4e0d\u5206\u7ed9\u4e1a\u52a1\u670d\u52a1\u4f7f\u7528\uff0c\u5168\u5c40\u3002\u9ed8\u8ba4\u8ddf\u968f http \u72b6\u6001\u7801\u3002\u8bf7\u6c42\u5931\u8d25\u9ed8\u8ba4\u4e3a 0\u3002 \u540e\u7eed\u6309\u7167 1000 \u4e3a\u5355\u4f4d\u5206\u914d\u7ed9\u4e1a\u52a1\u670d\u52a1\u4f7f\u7528\uff0c\u7528\u4e8e\u4e1a\u52a1\u903b\u8f91\u6821\u9a8c\uff0c\u6b64\u65f6 http \u72b6\u6001\u7801\u5e94\u8be5\u4e3a 200\u3002</p> <p>\u5168\u5c40\u5f02\u5e38\u5904\u7406\u7684\u65f6\u5019\uff0c\u7b80\u5355\u7684\u5f02\u5e38\u53ef\u4ee5\u4e0d\u6253\u5370\u5f02\u5e38\u4fe1\u606f\uff0c\u53ea\u6253\u5370\u8bf7\u6c42\u65b9\u6cd5\u548cURI\u3002 \u5982\u679c\u6d89\u53ca\u5230\u53c2\u6570\u6821\u9a8c\uff0c\u8bf7\u6c42\u4f53\u53cd\u5e8f\u5217\u5316\u7b49\u53ef\u4ee5\u589e\u52a0\u6253\u5370\u5f02\u5e38\u4fe1\u606f\uff0c\u800c\u4e0d\u5fc5\u6253\u5370\u5f02\u5e38\u6808\u3002 \u4e1a\u52a1\u5f02\u5e38\u6216\u8005\u672a\u77e5\u7684\u5f02\u5e38\u5904\u7406\u53ef\u4ee5\u589e\u52a0\u989d\u5916\u6253\u5370\u5f02\u5e38\u6808\u3002</p>"},{"location":"Java/Spring/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/","title":"\u6587\u4ef6\u4e0a\u4f20","text":"<p>Spring Boot \u6587\u4ef6\u4e0a\u4f20 \u4f9d\u8d56\uff1a <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre></p> <p>\u914d\u7f6e\uff1a <pre><code>spring:\n  servlet:\n    multipart:\n      enabled: true                   # \u662f\u5426\u542f\u7528multipart\u4e0a\u4f20\uff0c\u9ed8\u8ba4true\n      max-file-size: 1MB              # \u5355\u4e2a\u6587\u4ef6\u6700\u5927\u5927\u5c0f\uff0c\u9ed8\u8ba41MB\n      max-request-size: 10MB          # \u6574\u4e2a\u8bf7\u6c42\u6700\u5927\u5927\u5c0f\uff0c\u9ed8\u8ba410MB\n      file-size-threshold: 0B         # \u6587\u4ef6\u5927\u5c0f\u9608\u503c\uff0c\u8d85\u8fc7\u6b64\u503c\u4f1a\u5199\u5165\u78c1\u76d8\uff0c\u9ed8\u8ba40B\n      location: \"\"                    # \u4e34\u65f6\u6587\u4ef6\u5b58\u50a8\u4f4d\u7f6e\uff0c\u9ed8\u8ba4\u7cfb\u7edf\u4e34\u65f6\u76ee\u5f55\n      resolve-lazily: false           # \u662f\u5426\u5ef6\u8fdf\u89e3\u6790\uff0c\u9ed8\u8ba4false\n</code></pre></p>"},{"location":"Java/Spring/%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E5%8C%96/","title":"\u65e5\u671f\u65f6\u95f4\u5e8f\u5217\u5316","text":""},{"location":"Java/Spring/%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E5%8C%96/#jaskson","title":"Jaskson","text":"<p>Spring Boot \u9ed8\u8ba4\u4f7f\u7528 Jackson \u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u3002 <pre><code>- jackson-core\uff1a\u63d0\u4f9b JSON \u89e3\u6790\u548c\u751f\u6210\u7684\u5e95\u5c42\u652f\u6301\u3002\n- jackson-databind\uff1a\u63d0\u4f9b Java \u5bf9\u8c61\u4e0e JSON \u7684\u8f6c\u6362\u3002\n- jackson-annotations\uff1a\u63d0\u4f9b\u7528\u4e8e\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u7684\u6ce8\u89e3\u3002\n- jackson-datatype-jsr310\uff1a\u652f\u6301 Java 8 \u65f6\u95f4 API\u3002\n</code></pre></p> <p>\u4ee3\u7801\u7ed3\u6784 <pre><code>\u251c\u2500\u2500 lib\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 jackson-annotations-2.19.0.jar\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 jackson-core-2.19.0.jar\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 jackson-databind-2.19.0.jar\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 jackson-datatype-jsr310-2.19.0.jar\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 com\n        \u2514\u2500\u2500 jacky\n            \u251c\u2500\u2500 App.java\n            \u2514\u2500\u2500 entity\n                \u2514\u2500\u2500 User.java\n</code></pre></p> <p><code>App.java</code> \u4ee3\u7801 <pre><code>public class App {  \n    public static void main(String[] args) throws JsonProcessingException {  \n        User user = new User();  \n\n        user.setId(1);  \n        user.setName(\"jacky\");  \n        user.setBirthday(LocalDate.now());  \n        user.setLastLogin(new Date());  \n        user.setCreateTime(LocalDateTime.now());  \n        user.setDeleted(false);  \n\n        ObjectMapper om = new ObjectMapper();  \n        om.registerModule(new JavaTimeModule()); // \u6ce8\u518c\u8be5\u6a21\u5757\u4ee5\u652f\u6301 LocalDate \u548c LocalDateTime \u7c7b\u578b  \n        System.out.printf(om.writeValueAsString(user));  \n    }  \n}\n</code></pre></p> <p>\u8f93\u51fa <pre><code>{\"id\":1,\"name\":\"jacky\",\"birthday\":[2025,5,15],\"lastLogin\":1747321286831,\"createTime\":[2025,5,15,23,1,26,831291000],\"deleted\":false}\n</code></pre></p> <p>\u66f4\u65b0\u5b9e\u4f53\u7c7b \u4f7f\u7528 <code>@JsonFormat</code> \u6ce8\u89e3\u914d\u7f6e\u65e5\u671f\u65f6\u95f4\u7684\u5e8f\u5217\u5316\u683c\u5f0f\u3002  <pre><code>public class User {  \n\n    private Integer id;  \n\n    private String name;  \n\n    @JsonFormat(pattern = \"yyyy-MM-dd\")  \n    private LocalDate birthday;  \n\n    @JsonFormat(pattern = \"yyyy-MM-dd HH:mm:ss\")\n    private Date lastLogin;  \n\n    @JsonFormat(pattern = \"yyyy-MM-dd HH:mm:ss\")  \n    private LocalDateTime createTime;  \n\n    private Boolean isDeleted;\n    \u2026\u2026\n}\n</code></pre></p> <p>\u8f93\u51fa <pre><code>{\"id\":1,\"name\":\"jacky\",\"birthday\":\"2025-05-16\",\"lastLogin\":\"2025-05-16 13:57:31\",\"createTime\":\"2025-05-16 21:57:31\",\"deleted\":false}\n</code></pre></p> <p>\u914d\u7f6e ObjectMapper App.java \u4ee3\u7801 <pre><code>public class App {  \n    public static void main(String[] args) throws JsonProcessingException {  \n        \u2026\u2026\n        ObjectMapper om = new ObjectMapper();  \n        om.setDateFormat(new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\"));\n        JavaTimeModule module = new JavaTimeModule();  \n        DateTimeFormatter dtFormatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\");  \n        module.addSerializer(LocalDateTime.class, new LocalDateTimeSerializer(dtFormatter));  \n\n        DateTimeFormatter dFormater = DateTimeFormatter.ofPattern(\"yyyy-MM-dd\");  \n        module.addSerializer(LocalDate.class, new LocalDateSerializer(dFormater));  \n\n        om.registerModule(module); // \u6ce8\u518c\u8be5\u6a21\u5757\u4ee5\u652f\u6301 LocalDate \u548c LocalDateTime \u7c7b\u578b  \n        System.out.printf(om.writeValueAsString(user));  \n    }  \n}\n</code></pre></p> <p>\u8f93\u51fa <pre><code>{\"id\":1,\"name\":\"jacky\",\"birthday\":\"2025-05-16\",\"lastLogin\":\"2025-05-16 22:04:57\",\"createTime\":\"2025-05-16 22:04:57\",\"deleted\":false}\n</code></pre></p>"},{"location":"Java/Spring/%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E5%8C%96/#spring-boot","title":"Spring Boot","text":"<p>\u5b9e\u4f53 <code>DTEntity</code> \u5305\u542b\u65e5\u671f\u65f6\u95f4\u5c5e\u6027\uff1a <pre><code>public class DTEntity {  \n\n    private Date testDate;  \n\n    private LocalDate testLocalDate;  \n\n    private LocalDateTime testLocalDateTime;\n}\n</code></pre></p> <p>\u9ed8\u8ba4\u5e8f\u5217\u5316\u683c\u5f0f <pre><code>{\n\u00a0 \"testDate\": \"2025-05-13T14:31:20.137+00:00\",\n\u00a0 \"testLocalDate\": \"2025-05-13\",\n\u00a0 \"testLocalDateTime\": \"2025-05-13T22:31:20.137036\"\n}\n</code></pre></p> <p>Date \u7c7b\u578b\u5168\u5c40\u914d\u7f6e <pre><code>spring.jackson.date-format=yyyy-MM-dd HH:mm:ss  \nspring.jackson.time-zone=GMT+8\n</code></pre></p> <p>\u6548\u679c <pre><code>{\n\u00a0 \"testDate\": \"2025-05-13 22:37:22\",\n\u00a0 \"testLocalDate\": \"2025-05-13\",\n\u00a0 \"testLocalDateTime\": \"2025-05-13T22:37:22.337772\"\n}\n</code></pre></p> <p>LocalDate \u548c LocalDateTime \u7c7b\u578b\u5168\u5c40\u914d\u7f6e <pre><code>@Configuration  \npublic class DTConfig {  \n\n        private static final String DATE_FORMAT = \"yyyy-MM-dd\";  \n        private static final String DATETIME_FORMAT = \"yyyy-MM-dd HH:mm:ss\";  \n\n        @Bean  \n        public JavaTimeModule javaTimeModule() {  \n            JavaTimeModule module = new JavaTimeModule();  \n            module.addSerializer(LocalDateTime.class, new LocalDateTimeSerializer(  \n                    DateTimeFormatter.ofPattern(DATETIME_FORMAT)));  \n            module.addDeserializer(LocalDateTime.class, new LocalDateTimeDeserializer(  \n                    DateTimeFormatter.ofPattern(DATETIME_FORMAT)));  \n            module.addSerializer(LocalDate.class, new LocalDateSerializer(  \n                    DateTimeFormatter.ofPattern(DATE_FORMAT)));  \n            module.addDeserializer(LocalDate.class, new LocalDateDeserializer(  \n                    DateTimeFormatter.ofPattern(DATE_FORMAT)));  \n            return module;  \n        }  \n}\n</code></pre></p> <p>\u6548\u679c <pre><code>{\n\u00a0 \"testDate\": \"2025-05-16 22:49:00\",\n\u00a0 \"testLocalDate\": \"2025-05-16\",\n\u00a0 \"testLocalDateTime\": \"2025-05-16 22:49:00\"\n}\n</code></pre></p> <p>\u9488\u5bf9 <code>@RequestParam</code> \u6216\u8005\u76f4\u63a5\u4f7f\u7528\u5bf9\u8c61\u63a5\u6536\u53c2\u6570\u7684 LocalDateTime \u7c7b\u578b <pre><code>@Configuration  \npublic class DTConfig implements WebMvcConfigurer {  \n    DateTimeFormatter formatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\");  \n\n    @Override  \n    public void addFormatters(FormatterRegistry registry) {  \n        // \u6ce8\u518cLocalDateTime\u8f6c\u6362\u5668\n        registry.addConverter(new Converter&lt;String, LocalDateTime&gt;() {\n            @Override\n            public LocalDateTime convert(String source) {\n                return LocalDateTime.parse(source, formatter);\n            }\n        });\n    }\n}\n</code></pre></p>"},{"location":"Java/Spring/%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E7%AD%96%E7%95%A5/","title":"\u8d44\u6e90\u52a0\u8f7d\u7b56\u7565","text":"<p>\u53c2\u8003\u8d44\u6599\uff1ahttps://docs.spring.io/spring-framework/reference/core/resources.html</p>"},{"location":"Java/Spring/%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E7%AD%96%E7%95%A5/#url","title":"URL \u4ecb\u7ecd","text":"<p>URL Uniform Resource Locator \u662f\u7edf\u4e00\u8d44\u6e90\u5b9a\u4f4d\u7b26\uff0c\u7528\u4e8e\u6807\u8bc6\u4e92\u8054\u7f51\u4e0a\u8d44\u6e90\u4f4d\u7f6e\u7684\u5b57\u7b26\u4e32\u3002</p> <p>\u683c\u5f0f\u4e3a <code>scheme:://host[:port]/path?queryString#fragment</code> \uff0c\u4f8b\u5982 <code>https://www.example.com:8080/path/to/resource?param1=value1&amp;m2=value2#section1</code> <pre><code>\u534f\u8bae\uff1ahttps\n\n\u4e3b\u673a\uff1a[www.example.com](http://www.example.com)\n\n\u7aef\u53e3\u53f7\uff1a8080\n\n\u8def\u5f84\uff1a/path/to/resource\n\n\u67e5\u8be2\u5b57\u7b26\u4e32\uff1a?param1=value1&amp;m2=value2\n\n\u7247\u6bb5\uff1a#section1\n</code></pre></p> <p>java.net.URL \u57fa\u672c\u5b9e\u73b0\u53ea\u9650\u4e8e\u7f51\u7edc\u5f62\u5f0f\u53d1\u5e03\u7684\u8d44\u6e90\u7684\u67e5\u627e\u548c\u5b9a\u4f4d\uff0c\u5bf9\u4e8e low-level \u8d44\u6e90\u7684\u8bbf\u95ee\u6709\u4e9b\u9650\u5236\uff0c\u4e0d\u80fd\u591f\u6ee1\u8db3\u9700\u8981\u3002</p> <p>\u4f8b\u5982\uff0c\u6ca1\u6709\u6807\u51c6\u5316\u7684 URL \u5b9e\u73b0\u80fd\u591f\u4ece\u7c7b\u8def\u5f84\u6216\u8005\u76f8\u5bf9\u4e8e ServletContext \u83b7\u53d6\u8d44\u6e90\u3002\u867d\u7136\u80fd\u591f\u5b9e\u73b0 URL \u6765\u83b7\u53d6\u8d44\u6e90\uff0c\u4f46\u662f\u76f8\u5bf9\u6765\u8bf4\u590d\u6742\uff0c\u5e76\u4e14 URL \u5b9a\u4e49\u7684\u62bd\u8c61\u4e0d\u591f\u5b8c\u5584\u3002\u56e0\u6b64 Spring \u5b9a\u4e49\u4e86\u4e00\u4e2a\u66f4\u5f3a\u5927\u7684\u63a5\u53e3 Resource\u3002</p>"},{"location":"Java/Spring/%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E7%AD%96%E7%95%A5/#resource","title":"Resource \u63a5\u53e3","text":"<p><code>org.springframework.core.io.Resource</code> \u65e8\u5728\u6210\u4e3a\u4e00\u4e2a\u66f4\u5f3a\u5927\u7684\u63a5\u53e3\uff0c\u7528\u4e8e\u62bd\u8c61\u5bf9 low-level \u8d44\u6e90\u7684\u8bbf\u95ee\u3002</p> <pre><code>public interface InputStreamSource {\n    InputStream getInputStream() throws IOException;\n}\n\npublic interface Resource extends InputStreamSource {\n    boolean exists();\n\n    default boolean isReadable() {\n        return this.exists();\n    }\n\n    default boolean isOpen() {\n        return false;\n    }\n\n    default boolean isFile() {\n        return false;\n    }\n\n    URL getURL() throws IOException;\n\n    URI getURI() throws IOException;\n\n    File getFile() throws IOException;\n\n    default ReadableByteChannel readableChannel() throws IOException {\n        return Channels.newChannel(this.getInputStream());\n    }\n\n    default byte[] getContentAsByteArray() throws IOException {\n        return FileCopyUtils.copyToByteArray(this.getInputStream());\n    }\n\n    default String getContentAsString(Charset charset) throws IOException {\n        return FileCopyUtils.copyToString(new InputStreamReader(this.getInputStream(), charset));\n    }\n\n    long contentLength() throws IOException;\n\n    long lastModified() throws IOException;\n\n    Resource createRelative(String relativePath) throws IOException;\n\n    @Nullable\n    String getFilename();\n\n    String getDescription();\n}\n</code></pre> <p>Resource \u5b9e\u73b0\u4f1a\u5c3d\u53ef\u80fd\u7684\u5305\u88c5\u73b0\u6709\u7684\u5b9e\u73b0\u7c7b\u3002\u4f8b\u5982 UrlResource \u5c31\u662f\u5305\u88c5\u4e86\u4e00\u4e2a URL\uff0c\u5e76\u4f7f\u7528 URL \u6765\u5b8c\u6210\u5176\u5de5\u4f5c\u3002</p> <p>Spring \u5185\u7f6e\u5e38\u7528\u7684 Resource\uff1a</p> <ul> <li> <p>UrlResource \u901a\u8fc7 java.net.URL \u8fdb\u884c\u5177\u4f53\u7684\u8d44\u6e90\u67e5\u627e\u5b9a\u4f4d\u7684\u5b9e\u73b0\u7c7b\uff0c\u5185\u90e8\u59d4\u6d3e URL \u8fdb\u884c\u5177\u4f53\u7684\u8d44\u6e90\u64cd\u4f5c\u3002</p> </li> <li> <p>ClassPathResource \u8868\u793a\u4ece\u7c7b\u8def\u5f84\u83b7\u53d6\u8d44\u6e90\uff0c\u5185\u90e8\u5b9e\u73b0\u57fa\u4e8e Class.getResourceAsStream \u8fdb\u884c\u5177\u4f53\u7684\u8d44\u6e90\u64cd\u4f5c\u3002</p> </li> <li> <p>ByteArrayReource \u7ed9\u5b9a\u5b57\u8282\u6570\u7ec4\u7684 Resource \u5b9e\u73b0\uff0c\u5185\u90e8\u521b\u5efa ByteArrayIntputStream\u3002</p> </li> <li> <p>FileSystemResource \u5bf9\u4e8e java.io.File \u7c7b\u7684\u5c01\u88c5\u3002</p> </li> </ul>"},{"location":"Java/Spring/%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E7%AD%96%E7%95%A5/#resourceloader","title":"ResourceLoader \u63a5\u53e3","text":"<p>Resource \u5bf9\u63a5\u8d44\u6e90\u8fdb\u884c\u4e86\u5b9a\u4e49\uff0c\u90a3\u4e48 ResourceLoader \u5c31\u662f\u5bf9\u8d44\u6e90\u7684\u52a0\u8f7d\u8fdb\u884c\u4e86\u5b9a\u4e49\u3002\u6240\u6709\u7684 ApplicationContext \u90fd\u76f4\u63a5\u6216\u8005\u95f4\u63a5\u5b9e\u73b0\u4e86 ResourceLoader \u63a5\u53e3\u3002</p> <pre><code>public interface ResourceLoader {\n    String CLASSPATH_URL_PREFIX = \"classpath:\";\n\n    Resource getResource(String location);\n\n    @Nullable\n    ClassLoader getClassLoader();\n}\n</code></pre> <p>\u5f53\u8c03\u5728\u7279\u5b9a\u7684 application context \u4e0b\u8c03\u7528 getResource \u65f6\uff0c\u5982\u679c location \u6ca1\u6709\u6307\u5b9a\u7279\u5b9a\u7684\u524d\u7f00\u65f6\uff0capplication context \u5c06\u8fd4\u56de\u9002\u5408\u7279\u5b9a application context \u7684 Resource \u7c7b\u578b\u3002</p> <pre><code>Resource template = ctx.getResource(\"some/resource/path/myTemplate.txt\");\n</code></pre> <p>\u5f53 ClassPathXmlApplicationContext \u8c03\u7528 getResource \u65f6\uff0c\u4e0a\u8ff0\u4ee3\u7801\u8fd4\u56de\u7684\u662f ClassPathResource\uff1bFileSystemXmlApplicationContext \u8fd4\u56de FileSystemResource\uff1bWebApplicationContext \u8fd4\u56de ServletContextResource\u3002\u6240\u6709 getResource \u5c06\u4f1a\u4e3a\u7279\u5b9a\u7684 application context \u8fd4\u56de\u9002\u5408\u7684\u5bf9\u8c61\u3002</p> <p>\u53e6\u4e00\u65b9\u9762\uff0c\u53ef\u4ee5\u6307\u5b9a\u7279\u5b9a\u7684\u524d\u7f00 classpath: \u6765\u5f3a\u5236\u83b7\u5f97 ClassPathResource \u800c\u4e0d\u5fc5\u5173\u5fc3 application context\uff1a</p> <pre><code>Resource template = ctx.getResource(\"classpath:some/resource/path/myTemplate.txt\");\n</code></pre> <p>\u540c\u6837\u83b7\u5f97 UrlResource \u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>Resource template = ctx.getResource(\"https://www.example.com/resource/path/myTemplate.txt\");\n</code></pre> <p>\u5c06 location \u8f6c\u6362\u4e3a Resource \u5bf9\u8c61\u7684\u7b56\u7565</p> Prefix Example Explaination classpath: classpath:com/myapp/config.xml \u4ece\u7c7b\u8def\u5f84\u52a0\u8f7d file: file:///data/config.xml \u4ece\u6587\u4ef6\u7cfb\u7edf\u52a0\u8f7d URL https: https://myserver/logo.png \u52a0\u8f7d\u4e3a URL none /data/config.xml \u53d6\u51b3\u4e8e application context"},{"location":"Operations/Docker/Docker%20Tips/","title":"Docker Tips","text":""},{"location":"Operations/Docker/Docker%20Tips/#_1","title":"\u5b89\u88c5","text":"<pre><code>curl -fsSL https://get.docker.com -o get-docker.sh \nsh get-docker.sh\n</code></pre>"},{"location":"Operations/Docker/Docker%20Tips/#_2","title":"\u955c\u50cf\u64cd\u4f5c","text":"<p>\u67e5\u770b\u955c\u50cf\u8be6\u7ec6\u4fe1\u606f <pre><code>docker image inspect image_name\n</code></pre></p> <p>\u5bfc\u51fa\u955c\u50cf <pre><code>docker image save mysql -o mysql.tar\n</code></pre></p> <p>\u5bfc\u5165\u955c\u50cf <pre><code>docker image load -i mysql.tar\n</code></pre></p> <p>\u955c\u50cf\u62c9\u53d6\u4ee3\u7406\u914d\u7f6e\uff0c\u865a\u62df\u673a\u8d70\u5bbf\u4e3b\u673a\u7684\u79d1\u5b66\u4e0a\u7f51\u3002 <pre><code># \u670d\u52a1\u6587\u4ef6 /usr/lib/systemd/system/docker.service \u6dfb\u52a0\u73af\u5883\u53d8\u91cf\n[Service]\nEnvironment=\"HTTP_PROXY=http://192.168.3.209:7897\"\nEnvironment=\"HTTPS_PROXY=http://192.168.3.209:7897\"\n\n# \u91cd\u542f\u670d\u52a1\nsystemctl daemon-reload\nsystemctl restart docker\n</code></pre></p>"},{"location":"Operations/Docker/Docker%20Tips/#_3","title":"\u7f51\u7edc\u6a21\u5f0f","text":"<p><code>Docker</code> \u5b89\u88c5\u65f6\u9ed8\u8ba4\u4f1a\u521b\u5efa\u4e09\u4e2a\u7f51\u7edc\uff0c\u540c\u65f6\u5728\u5bbf\u4e3b\u673a\u4e0a\u521b\u5efa\u4e00\u4e2a\u865a\u62df\u7f51\u5361 <code>docker0</code>\u3002 <pre><code># docker network list\nNETWORK ID     NAME      DRIVER    SCOPE\nb092ef563276   bridge    bridge    local\ne8eb78a7d5ff   host      host      local\ne1290a9d96db   none      null      local\n</code></pre></p> <ul> <li><code>host</code> \u4f7f\u7528\u662f\u5bbf\u4e3b\u673a\u7684\u7f51\u7edc\u3002  </li> <li><code>bridge</code> \u5bb9\u5668\u4f7f\u7528\u72ec\u7acb\u7684 network namespace\uff0c\u5e76\u8fde\u63a5\u5230 <code>docker0</code> \u865a\u62df\u7f51\u5361\u3002\u9ed8\u8ba4\u3002  </li> <li><code>none</code> \u5bb9\u5668\u6709\u72ec\u7acb\u7684 network namespace\uff0c\u4f46\u662f\u4e0d\u8fdb\u884c\u4efb\u4f55\u7f51\u7edc\u8bbe\u7f6e\u3002</li> </ul>"},{"location":"Operations/Docker/Docker%20Tips/#docker-compose","title":"docker compose","text":"<p>docker compose up \u4f1a\u9ed8\u8ba4\u521b\u5efa\u4e00\u4e2a bridge \u7f51\u7edc\uff0c\u540d\u79f0\u662f\u76ee\u5f55\u540d\u79f0\u52a0\u4e0a <code>_default</code>\u3002</p> <p>docker compose restart container_name \u53ea\u4f1a\u91cd\u542f\u67d0\u4e2a\u5bb9\u5668\uff0c\u4e0d\u4f1a\u91cd\u65b0\u52a0\u8f7d\u4fee\u6539\u7684 yml \u914d\u7f6e\u6587\u4ef6\u3002</p> <p>\u5982\u679c\u591a\u4e2a\u5bb9\u5668\u4f4d\u4e8e\u540c\u4e00\u4e2a\u7f51\u7edc\u4e0b\u9762\uff0c\u4e00\u4e2a\u5bb9\u5668\u4e00\u4e2a\u4f7f\u7528\u53e6\u4e00\u4e2a\u5bb9\u5668\u7684\u540d\u79f0\u6765\u8bbf\u95ee\u8fde\u63a5\u3002<code>curl c_name:80</code>\u3002</p> <p>\u505c\u6b62\u670d\u52a1 <pre><code># \u505c\u6b62\u670d\u52a1\uff0c\u4f46\u662f\u4e0d\u4f1a\u5220\u9664\ndocker compose stop\n\n# \u505c\u6b62\u670d\u52a1\uff0c\u4f1a\u5220\u9664\u5bb9\u5668\u548c\u5377\ndocker compose down -v\n</code></pre></p>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/","title":"\u5b89\u88c5 Kubernetes \u96c6\u7fa4","text":"<p>\u6ce8\u610f\u5b89\u88c5\u7684 Kubernetes \u7248\u672c\u4e3a\uff1a1.25\uff0c\u5176\u5b83\u7248\u672c\u6b64\u5b89\u88c5\u6559\u7a0b\u53ef\u80fd\u4e0d\u9002\u7528\u3002</p>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#_1","title":"\u51c6\u5907\u73af\u5883","text":"<p>\u5b98\u65b9\u7684\u5b89\u88c5\u8981\u6c42\u5982\u4e0b\uff1a</p> <ul> <li>\u4e00\u53f0\u6216\u591a\u53f0\u8fd0\u884c <code>deb/rmp</code> \u517c\u5bb9\u7684 Linux \u64cd\u4f5c\u7cfb\u7edf\u3002</li> <li>\u6bcf\u53f0\u673a\u5668 <code>2GiB</code> \u6216\u8005\u66f4\u591a\u7684\u5185\u5b58\u3002</li> <li>\u8fd0\u884c <code>control-plane</code> \u7684\u8282\u70b9\u81f3\u5c11\u9700\u8981 2CPUs\u3002\uff08\u8865\u5145\uff1a\u5b98\u7f51\u5c31\u662f\u8fd9\u4e48\u5199\u7684\uff0c\u6211\u7684\u7406\u89e3\u53ef\u80fd\u662f\u4e24\u4e2a\u6838\u5fc3\u3002\u5177\u4f53\u914d\u7f6e\u4e3a Hyper-V \u4e2d\u201c\u865a\u62df\u5904\u7406\u5668\u7684\u6570\u91cf\u201d\u3002\uff09</li> <li>\u96c6\u7fa4\u8282\u70b9\u4e4b\u95f4\u7684\u7f51\u7edc\u9700\u8981\u5b8c\u5168\u8054\u901a\u3002</li> </ul>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#_2","title":"\u914d\u7f6e\u4fe1\u606f","text":"<p>\u6211\u51c6\u5907\u5b89\u88c5\u5728 Hyper-V \u7ba1\u7406\u7684\u4e09\u53f0 Linux \u865a\u62df\u673a\u4e0a\uff0c\u865a\u62df\u673a\u5747\u4e3a Debian \u64cd\u4f5c\u7cfb\u7edf\u3002\u5177\u4f53\u914d\u7f6e\u5982\u4e0b\u8868\u683c\uff0c\u5982\u65e0\u7279\u522b\u8bf4\u660e\uff0c\u540e\u7eed\u6240\u6709\u7684\u5b89\u88c5\u914d\u7f6e \u5728\u4e09\u53f0\u673a\u5668\u4e0a\u90fd\u8981\u8fdb\u884c\u3002</p> HOSTNAME IP RAM CPUs DESCRIPTION suomea01 192.168.31.11 16GiB 2 \u4e3b\u8282\u70b9\uff0c\u89d2\u8272\u4e3a control-plane\u3002 suomea02 192.168.31.12 16GiB 1 \u5de5\u4f5c\u8282\u70b9\u3002 suomea03 192.168.31.13 16GiB 1 \u5de5\u4f5c\u8282\u70b9\u3002"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#host","title":"\u914d\u7f6e Host \u4fe1\u606f","text":"<p>\u7f16\u8f91 <code>/etc/hosts</code> \u6587\u4ef6\uff0c\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\uff1a <pre><code>192.168.31.11     suomea01\n192.168.31.12     suomea02\n192.168.31.13     suomea03\n</code></pre></p>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#cri","title":"\u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6\uff08CRI\uff09","text":"<p>\u6bcf\u4e2a\u8282\u70b9\u90fd\u8981\u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6\uff0c\u8fd9\u6837 Pod \u624d\u80fd\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\uff0c\u6240\u4ee5\u4e0b\u9762\u7684\u64cd\u4f5c\u9700\u8981\u5728\u6bcf\u4e2a\u673a\u5668\u4e0a\u6267\u884c\u3002</p>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#_3","title":"\u914d\u7f6e\u7f51\u7edc","text":"<p>\u9700\u8981\u505a\u4e24\u4ef6\u4e8b\u60c5\uff1a </p> <p>\u4e00\u3001\u52a0\u8f7d br_netfilter \u6a21\u5757 <pre><code>cat &lt;&lt;EOF | tee /etc/modules-load.d/k8s.conf\noverlay\nbr_netfilter\nEOF\n\nmodprobe overlay\nmodprobe br_netfilter\n</code></pre> \u4e8c\u3001\u914d\u7f6e iptables\uff0c\u80fd\u591f\u8ba9 iptables \u68c0\u6d4b\u5230\u6865\u63a5\u7684\u7f51\u7edc\u6d41\u91cf\u3002 <pre><code># sysctl params required by setup, params persist across reboots\ncat &lt;&lt;EOF | tee /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.ipv4.ip_forward                 = 1\nEOF\n\n# Apply sysctl params without reboot\nsysctl --system\n</code></pre></p>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#containerd","title":"\u5b89\u88c5 Containerd","text":"<p>\u5b89\u88c5\u547d\u4ee4\uff1a <pre><code>apt install containerd\n</code></pre></p> <p>\u751f\u6210 <code>Containerd</code> \u7684\u914d\u7f6e\u6587\u4ef6\uff1a <pre><code>containerd config default | tee /etc/containerd/config.toml\n</code></pre></p> <p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff0c\u4fee\u6539\u6216\u8005\u6dfb\u52a0\u7684\u5730\u65b9\u6709\u4e24\u5904\uff0c\u5982\u4e0b\uff1a <pre><code>[plugins]\n  [plugins.\"io.containerd.grpc.v1.cri\"]\n    \u00b7\u00b7\u00b7\n    sandbox_image = \"registry.aliyuncs.com/google_containers/pause:3.2\"\n          \u00b7\u00b7\u00b7\n          [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options]\n            SystemdCgroup = true\n</code></pre></p> <p>\u91cd\u542f <code>Containerd</code>\uff1a <pre><code>systemctl restart containerd\n</code></pre></p>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#k8s","title":"\u5b89\u88c5 K8S \u96c6\u7fa4","text":""},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#swap","title":"\u5173\u95ed swap","text":"<p>Kubernetes 1.8\u5f00\u59cb\u8981\u6c42\u5173\u95ed\u7cfb\u7edf\u7684Swap\uff0c\u5982\u679c\u4e0d\u5173\u95ed\uff0c\u9ed8\u8ba4\u914d\u7f6e\u4e0bkubelet\u5c06\u65e0\u6cd5\u542f\u52a8\u3002</p> <p>\u6ca1\u6709\u5173\u95ed swap \u5206\u533a\u7684\u60c5\u51b5\u4e0b\uff0ckubeadm init \u96c6\u7fa4\u65f6\u7684\u544a\u8b66\u4fe1\u606f\uff1a swap is enabled; production deployments should disable swap unless testing the NodeSwap feature gate of the kubelet</p> <p>\u6ca1\u6709\u5173\u95ed swap \u5206\u533a\u7684\u60c5\u51b5\u4e0b\uff0ckubelet \u542f\u52a8\u7684\u9519\u8bef\u4fe1\u606f\uff08\u9ed8\u8ba4\u914d\u7f6e\u4e0b\u4f1a\u542f\u52a8 kubelet \u5931\u8d25\uff0c\u8fdb\u800c\u5bfc\u81f4 control-plane \u8282\u70b9\u521d\u59cb\u5316\u5931\u8d25\uff09\uff1a \"command failed\" err=\"failed to run Kubelet: running with swap on is not supported, please disable swap! or set --fail-swap-on flag to false. \u00b7\u00b7\u00b7</p> <p>\u4e34\u65f6\u5173\u95ed swap \u5206\u533a\u4f7f\u7528 <code>swapoff -a</code> \u547d\u4ee4\uff1b\u6ce8\u91ca\u6389 <code>/etc/fstab</code> \u6587\u4ef6\u4e2d\u6302\u8f7d swap \u5206\u533a\u7684\u884c\uff0c\u8fd9\u6837\u4e0b\u6b21\u5f00\u673a\u65f6\u5c31\u4e0d\u4f1a\u81ea\u52a8\u6302\u8f7d swap \u5206\u533a\u4e86\u3002</p>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#selinux","title":"\u5173\u95ed SELinux","text":""},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#kubeletkubeadm-kubectl","title":"\u5b89\u88c5 kubelet\u3001kubeadm \u548c kubectl","text":"<p>kubeadm\uff1a\u7528\u6765\u521d\u59cb\u5316\u542f\u52a8\u96c6\u7fa4\u3002 kubelet\uff1a\u96c6\u7fa4\u7684\u7ec4\u4ef6\uff0c\u8fd0\u884c\u5728\u6240\u6709\u7684\u8282\u70b9\u4e0a\u9762\u5e76\u8d1f\u8d23 Pod \u548c\u5bb9\u5668\u7684\u7ba1\u7406\u3002 kubectl\uff1a\u548c\u96c6\u7fa4\u4ea4\u4e92\u7684\u547d\u4ee4\u884c\u5de5\u5177\u3002  </p> <p>\u4e0b\u8f7d\u5e76\u6dfb\u52a0\u516c\u94a5\uff1a <pre><code>curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -\n</code></pre></p> <p>\u914d\u7f6e\u955c\u50cf\uff0c\u65b0\u5efa\u6587\u4ef6 <code>/etc/apt/sources.list.d/kubernetes.list</code> \u5185\u5bb9\u5982\u4e0b\uff1a <pre><code>deb https://mirrors.tuna.tsinghua.edu.cn/kubernetes/apt kubernetes-xenial main\n</code></pre></p> <p>\u5b89\u88c5\uff1a <pre><code>apt install kubeadm kubectl kubelet\n</code></pre></p> <p>\u7f16\u8f91 ~/.bashrc\uff0c\u914d\u7f6e\u76f8\u5173\u547d\u4ee4\u7684\u81ea\u52a8\u8865\u5168\uff0c\u7136\u540e\u4f7f\u7528 <code>source ~/.bashrc</code> \u4f7f\u914d\u7f6e\u751f\u6548\u3002 <pre><code>source &lt;(kubectl completion bash)\nsource &lt;(kubeadm completion bash)\nsource &lt;(crictl completion bash)\n</code></pre></p>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#crictl","title":"\u914d\u7f6e crictl","text":"<p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 /etc/crictl.yaml\uff1a <pre><code>runtime-endpoint: unix:///run/containerd/containerd.sock\nimage-endpoint: unix:///run/containerd/containerd.sock\ntimeout: 10\ndebug: false\n</code></pre></p>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#control-plane","title":"\u521d\u59cb\u5316\u96c6\u7fa4\u914d\u7f6e\uff08\u4ec5\u5728 control-plane \u8282\u70b9\uff09","text":"<p>\u4f7f\u7528 <code>kubeadm version</code> \u547d\u4ee4\u67e5\u770b\u5373\u5c06\u8981\u5b89\u88c5 K8S \u7684\u7248\u672c\uff1b\u7528 <code>kubeadm config images list</code> \u547d\u4ee4\u67e5\u770b\u521d\u59cb\u5316\u96c6\u7fa4\u9700\u8981\u7684\u955c\u50cf\u5217\u8868\uff1b</p> <p>\u751f\u6210\u96c6\u7fa4\u521d\u59cb\u5316\u914d\u7f6e\u6587\u4ef6\uff1a <pre><code>kubeadm config print init-defaults &gt; k8s.yaml\n</code></pre></p> <p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff0c\u4e3b\u8981\u4fee\u6539\u4ee5\u4e0b\u51e0\u4e2a\u5730\u65b9\uff1a <pre><code>apiVersion: kubeadm.k8s.io/v1beta3\n\u00b7\u00b7\u00b7\nkind: InitConfiguration\nlocalAPIEndpoint:\n  # 1. \u4fee\u6539\u4e3a control-plane \u6240\u5728\u673a\u5668\u7684 IP\n  advertiseAddress: 192.168.31.11\n  bindPort: 6443\nnodeRegistration:\n  \u00b7\u00b7\u00b7\n  # 2. \u4fee\u6539\u4e3a control-plane \u6240\u5728\u673a\u5668\u7684 hostname\n  name: suomea01\n  taints: null\n---\napiServer:\n  timeoutForControlPlane: 4m0s\n\u00b7\u00b7\u00b7\n# 3. \u4f7f\u7528\u963f\u91cc\u4e91\u7684\u955c\u50cf\nimageRepository: registry.aliyuncs.com/google_containers\nkind: ClusterConfiguration\n\u00b7\u00b7\u00b7\nnetworking:\n  dnsDomain: cluster.local\n  serviceSubnet: 10.96.0.0/12\n</code></pre></p> <p>\u521d\u59cb\u5316\u96c6\u7fa4\uff1a <pre><code>kubeadm init --config=k8s.yaml\n</code></pre></p> <p>\u5982\u679c\u521d\u59cb\u5316\u6210\u529f\u7684\u8bdd\u5c31\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u4fe1\u606f\uff0c\u7136\u540e\u6309\u7167\u6307\u793a\u64cd\u4f5c\u5373\u53ef\u3002 <pre><code>Your Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nAlternatively, if you are the root user, you can run:\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 192.168.31.11:6443 --token abcdef.0123456789abcdef \\\n--discovery-token-ca-cert-hash sha256:*****************************************\n</code></pre></p>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#calico-control-plane","title":"\u5b89\u88c5 Calico \u7f51\u7edc\u63d2\u4ef6\uff08\u4ec5\u5728 control-plane \u8282\u70b9\uff09","text":"<p>\u4e0b\u8f7d\u914d\u7f6e\u6587\u4ef6\uff1a <pre><code>curl https://projectcalico.docs.tigera.io/manifests/calico.yaml -O\n</code></pre></p> <p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff0c<code>value</code> \u7684\u503c\u4e3a <code>k8s.yaml</code> \u914d\u7f6e\u6587\u4ef6 <code>networking.serviceSubnet</code> \u5c5e\u6027\u7684\u503c\u3002 <pre><code>- name: CALICO_IPV4POOL_CIDR\n  value: 10.96.0.0/12\n</code></pre></p> <p>\u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6\uff1a <pre><code>kubectl apply -f calico.yaml\n</code></pre></p> <p>\u7136\u540e\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u67e5\u770b\u6240\u6709 Pod \u7684\u72b6\u6001\uff0c\u5f53 Status \u5168\u90e8\u4e3a Running \u65f6\uff0c\u5373 K8S \u96c6\u7fa4\u5b89\u88c5\u6210\u529f\u3002 <pre><code>kubectl get pod --all-namespaces\n</code></pre></p>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#_4","title":"\u4e00\u4e9b\u53ef\u80fd\u7528\u5230\u7684\u547d\u4ee4","text":""},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#_5","title":"\u91cd\u7f6e\u96c6\u7fa4","text":"<p>\u96c6\u7fa4\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u51fa\u73b0\u9519\u8bef\u5bfc\u81f4\u5931\u8d25\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u91cd\u7f6e\uff1a <pre><code>kubeadm reset\n</code></pre></p>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kubernetes%20%E9%9B%86%E7%BE%A4/#pod","title":"\u5f3a\u5236\u5220\u9664 Pod","text":"<p>\u4f7f\u7528 kubectl delete \u6e05\u9664\u8d44\u6e90\u7684\u4f7f\u7528\uff0c\u53ef\u80fd\u5bfc\u81f4 Pod \u4e00\u53ea\u5904\u4e8e Terminating \u72b6\u6001\uff0c\u65e0\u6cd5\u5220\u9664\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u5f3a\u5236\u5220\u9664 Pod\uff1a <pre><code>kubectl -n ns_name delete pod pod_name --force --grace-period=0\n</code></pre></p>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kuboard%20%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2/","title":"\u5b89\u88c5 Kuboard \u96c6\u7fa4\u7ba1\u7406\u754c\u9762","text":"<p>\u5728 K8S \u4e2d\u5b89\u88c5 Kuboard\uff0c\u53c2\u8003 https://kuboard.cn/install/v3/install-in-k8s.html\u3002\u5b89\u88c5\u73af\u5883\u53c2\u8003\uff1a\u5b89\u88c5 Kubeneters \u96c6\u7fa4\u3002</p> <p>\u4e4b\u6240\u4ee5\u5355\u72ec\u8bb0\u5f55 Kuboard \u7684\u5b89\u88c5\uff0c\u662f\u56e0\u4e3a\u6839\u636e\u5b98\u65b9\u7684\u5b89\u88c5\u6587\u6863\u8fdb\u884c\u64cd\u4f5c\u4f1a\u9047\u5230\u4e24\u4e2a\u95ee\u9898\uff1a  </p> <ul> <li>\u62c9\u53d6\u955c\u50cf\u975e\u5e38\u6162\uff0c\u5b98\u65b9\u6709\u89e3\u51b3\u65b9\u6848\uff1a\u91c7\u7528\u534e\u4e3a\u4e91\u955c\u50cf\u4ee3\u66ff\u3002</li> <li>kuboard pod \u542f\u52a8\u5931\u8d25\u3002</li> </ul>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kuboard%20%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2/#_1","title":"\u5b89\u88c5\u524d\u7684\u51c6\u5907","text":""},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kuboard%20%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2/#yaml","title":"\u4e0b\u8f7d yaml \u6e05\u5355\u6587\u4ef6","text":"<pre><code>wget https://addons.kuboard.cn/kuboard/kuboard-v3-swr.yaml\n</code></pre>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kuboard%20%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2/#kuboard","title":"\u4fee\u6539 Kuboard \u7684\u542f\u52a8\u53c2\u6570","text":"<p>\u5220\u9664 ConfigMap kuboard-v3-config \u7684\u914d\u7f6e\u9879 <code>KUBOARD_SERVER_NODE_PORT: '30080'</code>\uff0c\u7136\u540e\u65b0\u589e\u5982\u4e0b\u914d\u7f6e\u9879\uff1a <pre><code>KUBOARD_ENDPOINT: 'http://192.168.31.11:30080'\n</code></pre></p>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kuboard%20%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2/#kuboard_1","title":"\u542f\u52a8 Kuboard","text":""},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kuboard%20%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2/#_2","title":"\u542f\u52a8\u547d\u4ee4","text":"<pre><code>kubectl apply -f kuboard-v3-swr.yaml\n</code></pre>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Kuboard%20%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2/#_3","title":"\u8bbf\u95ee\u5730\u5740","text":"<p>http://192.168.31.11:30080</p>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Nginx%20Ingress/","title":"\u5b89\u88c5 Nginx Ingress","text":"<p>\u5b89\u88c5 Nginx Ingress \u4e3b\u8981\u53c2\u8003\u5b98\u65b9\u7684\u5b89\u88c5\u6587\u6863\uff0c\u57fa\u4e8e\u5b98\u7f51\u7684 yaml \u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u4e86\u4ee5\u4e0b\u4fee\u6539\uff1a</p> <ul> <li>\u5b89\u88c5\u65b9\u5f0f\u8bbe\u7f6e\u4e3a DaemonSet\uff0c\u4ee5 hostNetwork \u7684\u65b9\u5f0f\u8fd0\u884c\u5728\u6240\u6709\u7684\u8282\u70b9\u4e0a\uff0c\u5305\u62ec\u4e3b\u8282\u70b9\uff08\u589e\u52a0\u5bb9\u5fcd\uff09\u3002</li> <li>\u5220\u9664\u4e86 Service\uff0c\u57fa\u4e8e DaemonSet hostNetwork \u6a21\u5f0f\u7684\u8bdd\u53ef\u4ee5\u7701\u7565 Service\u3002</li> <li>\u5220\u9664\u4e86 webhook \u670d\u52a1\u90e8\u5206\u3002\u8be5\u90e8\u5206\u4e3b\u8981\u7528\u6765\u6821\u9a8c ingress \u7684\u914d\u7f6e\uff0c\u5982\u679c\u914d\u7f6e\u9519\u8bef\u7684\u8bdd\u914d\u7f6e\u4e0d\u4f1a\u751f\u6548\u3002</li> </ul>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Nginx%20Ingress/#yaml","title":"\u5b89\u88c5 yaml","text":"<pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  labels:\n    app.kubernetes.io/instance: ingress-nginx\n    app.kubernetes.io/name: ingress-nginx\n  name: ingress-nginx\n---\napiVersion: v1\nautomountServiceAccountToken: true\nkind: ServiceAccount\nmetadata:\n  labels:\n    app.kubernetes.io/component: controller\n    app.kubernetes.io/instance: ingress-nginx\n    app.kubernetes.io/name: ingress-nginx\n    app.kubernetes.io/part-of: ingress-nginx\n    app.kubernetes.io/version: 1.5.1\n  name: ingress-nginx\n  namespace: ingress-nginx\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  labels:\n    app.kubernetes.io/component: controller\n    app.kubernetes.io/instance: ingress-nginx\n    app.kubernetes.io/name: ingress-nginx\n    app.kubernetes.io/part-of: ingress-nginx\n    app.kubernetes.io/version: 1.5.1\n  name: ingress-nginx\n  namespace: ingress-nginx\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - namespaces\n  verbs:\n  - get\n- apiGroups:\n  - \"\"\n  resources:\n  - configmaps\n  - pods\n  - secrets\n  - endpoints\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - services\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - networking.k8s.io\n  resources:\n  - ingresses\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - networking.k8s.io\n  resources:\n  - ingresses/status\n  verbs:\n  - update\n- apiGroups:\n  - networking.k8s.io\n  resources:\n  - ingressclasses\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resourceNames:\n  - ingress-nginx-leader\n  resources:\n  - configmaps\n  verbs:\n  - get\n  - update\n- apiGroups:\n  - \"\"\n  resources:\n  - configmaps\n  verbs:\n  - create\n- apiGroups:\n  - coordination.k8s.io\n  resourceNames:\n  - ingress-nginx-leader\n  resources:\n  - leases\n  verbs:\n  - get\n  - update\n- apiGroups:\n  - coordination.k8s.io\n  resources:\n  - leases\n  verbs:\n  - create\n- apiGroups:\n  - \"\"\n  resources:\n  - events\n  verbs:\n  - create\n  - patch\n- apiGroups:\n  - discovery.k8s.io\n  resources:\n  - endpointslices\n  verbs:\n  - list\n  - watch\n  - get\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    app.kubernetes.io/instance: ingress-nginx\n    app.kubernetes.io/name: ingress-nginx\n    app.kubernetes.io/part-of: ingress-nginx\n    app.kubernetes.io/version: 1.5.1\n  name: ingress-nginx\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - configmaps\n  - endpoints\n  - nodes\n  - pods\n  - secrets\n  - namespaces\n  verbs:\n  - list\n  - watch\n- apiGroups:\n  - coordination.k8s.io\n  resources:\n  - leases\n  verbs:\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes\n  verbs:\n  - get\n- apiGroups:\n  - \"\"\n  resources:\n  - services\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - networking.k8s.io\n  resources:\n  - ingresses\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - events\n  verbs:\n  - create\n  - patch\n- apiGroups:\n  - networking.k8s.io\n  resources:\n  - ingresses/status\n  verbs:\n  - update\n- apiGroups:\n  - networking.k8s.io\n  resources:\n  - ingressclasses\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - discovery.k8s.io\n  resources:\n  - endpointslices\n  verbs:\n  - list\n  - watch\n  - get\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  labels:\n    app.kubernetes.io/component: controller\n    app.kubernetes.io/instance: ingress-nginx\n    app.kubernetes.io/name: ingress-nginx\n    app.kubernetes.io/part-of: ingress-nginx\n    app.kubernetes.io/version: 1.5.1\n  name: ingress-nginx\n  namespace: ingress-nginx\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: ingress-nginx\nsubjects:\n- kind: ServiceAccount\n  name: ingress-nginx\n  namespace: ingress-nginx\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  labels:\n    app.kubernetes.io/instance: ingress-nginx\n    app.kubernetes.io/name: ingress-nginx\n    app.kubernetes.io/part-of: ingress-nginx\n    app.kubernetes.io/version: 1.5.1\n  name: ingress-nginx\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: ingress-nginx\nsubjects:\n- kind: ServiceAccount\n  name: ingress-nginx\n  namespace: ingress-nginx\n---\napiVersion: v1\ndata:\n  allow-snippet-annotations: \"true\"\nkind: ConfigMap\nmetadata:\n  labels:\n    app.kubernetes.io/component: controller\n    app.kubernetes.io/instance: ingress-nginx\n    app.kubernetes.io/name: ingress-nginx\n    app.kubernetes.io/part-of: ingress-nginx\n    app.kubernetes.io/version: 1.5.1\n  name: ingress-nginx-controller\n  namespace: ingress-nginx\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  labels:\n    app.kubernetes.io/component: controller\n    app.kubernetes.io/instance: ingress-nginx\n    app.kubernetes.io/name: ingress-nginx\n    app.kubernetes.io/part-of: ingress-nginx\n    app.kubernetes.io/version: 1.5.1\n  name: ingress-nginx-controller\n  namespace: ingress-nginx\nspec:\n  minReadySeconds: 0\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      app.kubernetes.io/component: controller\n      app.kubernetes.io/instance: ingress-nginx\n      app.kubernetes.io/name: ingress-nginx\n  template:\n    metadata:\n      labels:\n        app.kubernetes.io/component: controller\n        app.kubernetes.io/instance: ingress-nginx\n        app.kubernetes.io/name: ingress-nginx\n    spec:\n      tolerations:\n      - key: node-role.kubernetes.io/control-plane\n        operator: Exists\n        effect: NoSchedule\n      hostNetwork: true\n      containers:\n      - args:\n        - /nginx-ingress-controller\n        - --election-id=ingress-nginx-leader\n        - --controller-class=k8s.io/ingress-nginx\n        - --ingress-class=nginx\n        - --configmap=$(POD_NAMESPACE)/ingress-nginx-controller\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        - name: LD_PRELOAD\n          value: /usr/local/lib/libmimalloc.so\n        image: registry.aliyuncs.com/google_containers/nginx-ingress-controller:v1.5.1\n        imagePullPolicy: IfNotPresent\n        lifecycle:\n          preStop:\n            exec:\n              command:\n              - /wait-shutdown\n        livenessProbe:\n          failureThreshold: 5\n          httpGet:\n            path: /healthz\n            port: 10254\n            scheme: HTTP\n          initialDelaySeconds: 10\n          periodSeconds: 10\n          successThreshold: 1\n          timeoutSeconds: 1\n        name: controller\n        ports:\n        - containerPort: 80\n          name: http\n          protocol: TCP\n        - containerPort: 443\n          name: https\n          protocol: TCP\n        - containerPort: 8443\n          name: webhook\n          protocol: TCP\n        readinessProbe:\n          failureThreshold: 3\n          httpGet:\n            path: /healthz\n            port: 10254\n            scheme: HTTP\n          initialDelaySeconds: 10\n          periodSeconds: 10\n          successThreshold: 1\n          timeoutSeconds: 1\n        resources:\n          requests:\n            cpu: 100m\n            memory: 90Mi\n        securityContext:\n          allowPrivilegeEscalation: true\n          capabilities:\n            add:\n            - NET_BIND_SERVICE\n            drop:\n            - ALL\n          runAsUser: 101\n      dnsPolicy: ClusterFirst\n      nodeSelector:\n        kubernetes.io/os: linux\n      serviceAccountName: ingress-nginx\n      terminationGracePeriodSeconds: 300\n---\napiVersion: networking.k8s.io/v1\nkind: IngressClass\nmetadata:\n  labels:\n    app.kubernetes.io/component: controller\n    app.kubernetes.io/instance: ingress-nginx\n    app.kubernetes.io/name: ingress-nginx\n    app.kubernetes.io/part-of: ingress-nginx\n    app.kubernetes.io/version: 1.5.1\n  name: nginx\nspec:\n  controller: k8s.io/ingress-nginx\n</code></pre>"},{"location":"Operations/K8S/%E5%AE%89%E8%A3%85%20Nginx%20Ingress/#yaml_1","title":"\u6d4b\u8bd5 yaml","text":"<p>\u6d4b\u8bd5\u914d\u7f6e\u57df\u540d nginx-ingress.suomea.com\uff0c\u672c\u5730\u53ef\u4ee5\u914d\u7f6e hosts \u6587\u4ef6\u5c06\u8be5\u57df\u540d\u6307\u5411 192.168.31.11\u3001192.168.31.12\u3001192.168.31.13 \u4efb\u610f\u4e00\u53f0\u673a\u5668\u3002 \u7136\u540e Ingress \u914d\u7f6e\u8def\u5f84 /nginx \u8bbf\u95ee nginx \u670d\u52a1\uff0c/httpd \u8bbf\u95ee httpd \u670d\u52a1\u3002 <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: nginx\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:latest\n        ports:\n        - containerPort: 80\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx\nspec:\n  selector:\n    app: nginx\n  clusterIP: None\n  type: ClusterIP\n  ports:\n  - port: 80\n    targetPort: 80\n\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: httpd\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: httpd\n  template:\n    metadata:\n      labels:\n        app: httpd\n    spec:\n      containers:\n      - name: httpd\n        image: httpd:latest\n        ports:\n        - containerPort: 80\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: httpd\nspec:\n  selector:\n    app: httpd\n  clusterIP: None\n  type: ClusterIP\n  ports:\n  - port: 80\n    targetPort: 80\n\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: minimal-ingress\n  annotations:\n    nginx.ingress.kubernetes.io/rewrite-target: /\nspec:\n  rules:\n  - host: nginx-ingress.suomea.com\n    http:\n      paths:\n      - path: /httpd\n        pathType: Prefix\n        backend:\n          service:\n            name: httpd\n            port:\n              number: 80\n      - path: /nginx\n        pathType: Prefix\n        backend:\n          service:\n            name: nginx\n            port:\n              number: 80\n</code></pre></p>"},{"location":"Operations/Linux/Bash/","title":"Bash","text":""},{"location":"Operations/Linux/Bash/#for","title":"for","text":"<p>\u8bed\u6cd5 <pre><code>for variable [in words]; do\n    commands\ndone\n</code></pre></p> <p>\u793a\u4f8b <pre><code># for i in A B C D; do echo $i; done\nA\nB\nC\nD\n\n# for i in {A..D}; do echo $i; done\nA\nB\nC\nD\n\n# for i in B*.zip; do echo $i; done\nBest Selection Songs.zip\nBest Selection Songs001.zip\n</code></pre></p>"},{"location":"Operations/Linux/LVM/","title":"LVM","text":""},{"location":"Operations/Linux/LVM/#lvm","title":"LVM \u4ecb\u7ecd","text":"<p>\u78c1\u76d8 \u67e5\u770b\u78c1\u76d8\u7684\u5206\u533a\u7c7b\u578b <pre><code>parted /dev/sda print\n</code></pre></p> <p>\u5206\u533a <pre><code>fdisk /dev/sda\n</code></pre></p> <p>PV \u5b9e\u9645\u7684\u5206\u533a\uff0c\u4f46\u662f\u8981\u8c03\u6574\u7c7b\u578b\u4e3a 8E00\uff08LVM \u7684\u8bc6\u522b\u7801\uff09\uff0c\u7136\u540e\u4f7f\u7528 pvcreate \u547d\u4ee4\u5c06\u5206\u533a\u8f6c\u6362\u4e3a LVM \u6700\u5e95\u5c42\u7684\u5b9e\u4f53\u5377\u3002</p> <p>Note</p> <p>GPT \u5206\u533a\u7c7b\u578b\u4ee3\u7801\uff0c8300 \u7528\u4f5c Linux \u6587\u4ef6\u7cfb\u7edf\uff0c8e00 \u7528\u4f5c Linux LVM\u3002\u5bf9\u5e94 MBR \u5206\u533a\u7c7b\u578b\u4ee3\u7801\u4e3a 83 \u548c 8e\u3002</p> <p>pvcreate \u5c06\u5206\u533a\u521b\u5efa\u4e3a PV pvscan \u5c55\u793a PV \u5217\u8868 pcdisplay \u663e\u793a\u7cfb\u7edf\u6240\u6709\u7684 PV \u72b6\u6001 pvremove \u5c06\u5206\u533a\u7684 PV \u5c5e\u6027\u79fb\u9664</p> <p>VG \u5377\u7fa4\u7ec4\uff0c\u5c06\u591a\u4e2a PV \u6574\u5408\u6210 VG\u3002</p> <p>vgcreate \u521b\u5efa VG vgscan vgdisplay vgextend \u5728 VG \u5185\u589e\u52a0\u989d\u5916\u7684 PV vgreduce \u5728 VG \u5185\u79fb\u9664 PV vgremove \u5220\u9664\u4e00\u4e2a VG</p> <p>PE PE \u662f LVM \u7684\u6700\u5c0f\u5b58\u50a8\u5355\u4f4d\u3002</p> <p>LV \u903b\u8f91\u5377\uff0cVG \u88ab\u5212\u5206\u4e3a\u4e00\u4e2a\u6216\u8005\u591a\u4e2a LV\u3002</p> <p>lvcreate lvscan lvdisplay lvextend lvreduce lvremove lvresize</p>"},{"location":"Operations/Linux/LVM/#lvm_1","title":"LVM \u6269\u5bb9","text":"<p>fdisk \u8fdb\u884c\u5206\u533a</p> <p>\u5982\u679c\u78c1\u76d8\u5b9e\u9645\u5269\u4f59\u6709 50GB\uff0c\u4f46\u662f fdisk \u8f93\u51fa\u5269\u4f59\u7a7a\u95f4\u660e\u663e\u5c11\u4e8e 50GB \u53ef\u4ee5\u4f7f\u7528 parted /dev/vda \u5bf9\u5206\u533a\u4fe1\u606f\u8fdb\u884c\u4fee\u590d\u3002</p> <p>\u521b\u5efa PV <pre><code>pvcreate /dev/vda4\n</code></pre></p> <p>\u52a0\u5165 VG <pre><code>vgextend &lt;vgname&gt; &lt;pvname&gt;\n</code></pre></p> <p>\u6269\u5c55 LV <pre><code>lvextend -l +100%FREE lvpath\n</code></pre></p> <p>\u6269\u5c55\u6587\u4ef6\u7cfb\u7edf blkid \u67e5\u770b LV \u7684\u6587\u4ef6\u7cfb\u7edf\u3002 \u5982\u679c ext \u7cfb\u5217\u4f7f\u7528  <pre><code>resize2fs &lt;lvpath&gt;\n</code></pre></p> <p>\u5982\u679c nfs \u6587\u4ef6\u7cfb\u7edf\u4f7f\u7528 <pre><code>xfs_growfs &lt;lvpath&gt;\n</code></pre></p>"},{"location":"Operations/Linux/Linux%20Tips/","title":"Linux Tips","text":"<p>\u8bb0\u5f55 Linux \u5b89\u88c5\u548c\u914d\u7f6e\u7684\u76f8\u5173\u6280\u5de7\uff0c\u4e3b\u8981\u57fa\u4e8e Debian \u8fdb\u884c\u64cd\u4f5c\u3002</p>"},{"location":"Operations/Linux/Linux%20Tips/#ip","title":"\u914d\u7f6e\u9759\u6001 IP","text":"<p>\u5907\u4efd\u7f51\u5361\u914d\u7f6e\u6587\u4ef6 <pre><code>cp /etc/network/interfaces /etc/network/interfaces.bak\n</code></pre></p> <p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 <pre><code># The primary network interface\nauto eth0\nallow-hotplug eth0\n# 1. \u4fee\u6539\u4e3a static\niface eth0 inet static\n# 2. \u914d\u7f6e\u9759\u6001 IP\naddress 192.168.31.12\n# 3. \u914d\u7f6e\u5b50\u7f51\u63a9\u7801\nnetmask 255.255.255.0\n# 4. \u914d\u7f6e\u7f51\u5173\u5730\u5740\ngateway 192.168.31.1\n</code></pre></p> <p>\u91cd\u542f\u7f51\u7edc <pre><code>systemctl restart networking\n</code></pre></p>"},{"location":"Operations/Linux/Linux%20Tips/#linux","title":"Linux \u6587\u4ef6\u6743\u9650","text":"<pre><code>drwx------  8 root root      4096 Nov  9 22:18 .\ndrwxr-xr-x 19 root root      4096 Nov  9 22:35 ..\n-rw-r--r--  1 root root  87473664 Nov  1 21:30 a.tar.gz\n</code></pre> <p>r: \u4ee3\u8868\u53ef\u8bfb  4 w: \u4ee3\u8868\u53ef\u5199  2 x: \u4ee3\u8868\u53ef\u6267\u884c 1</p> <p>chgrp: \u6539\u53d8\u6587\u4ef6\u6240\u5c5e\u7684\u7fa4\u7ec4 chown: \u6539\u53d8\u6587\u4ef6\u62e5\u6709\u8005 chmod: \u6539\u53d8\u6587\u4ef6\u7684\u6743\u9650</p>"},{"location":"Operations/Linux/Linux%20Tips/#ssh","title":"\u914d\u7f6e SSH \u514d\u5bc6\u767b\u5f55","text":"<p>\u5047\u8bbe\u4ece Win \u514d\u5bc6\u767b\u5f55\u5230 Linux\u3002</p> <p>Win \u751f\u6210\u5bc6\u94a5\u8981\u5bf9 <pre><code>ssh-keygen -t rsa\n</code></pre></p> <p>\u590d\u5236 Win \u7535\u8111\u7684\u516c\u94a5\uff0c\u5185\u5bb9\u4f4d\u4e8e ~/.ssh/id_rsa.pub \u6587\u4ef6\u3002  </p> <p>\u65b0\u5efa Linux ~/.ssh/authorized_keys \u6587\u4ef6\uff0c\u5c06 Win \u7684\u516c\u94a5\u5185\u5bb9\u7c98\u8d34\u8fdb\u6765\u3002  </p> <p>\u8bbe\u7f6e authorized_keys \u6587\u4ef6\u7684\u6743\u9650\uff0c\u53ea\u80fd\u81ea\u5df1\u8bfb\u5199\uff1a<code>chmod 0600 ~/.ssh/auhtorized_keys</code></p>"},{"location":"Operations/Linux/Linux%20Tips/#_1","title":"\u8bbe\u7f6e\u4f1a\u8bdd\u8d85\u65f6\u81ea\u52a8\u9000\u51fa","text":"<p>\u53ef\u4ee5\u5728 /etc/profile \u6587\u4ef6\u8bbe\u7f6e\u53d8\u91cf $TMOUT\uff0c\u5355\u4f4d\u4e3a\u79d2\u3002</p>"},{"location":"Operations/Linux/Linux%20Tips/#_2","title":"\u7cfb\u7edf\u4fe1\u606f\u67e5\u8be2","text":""},{"location":"Operations/Linux/Linux%20Tips/#_3","title":"\u67e5\u8be2\u673a\u5668\u4e0a\u6b21\u542f\u52a8\u65f6\u95f4","text":"<pre><code>who -b\n</code></pre>"},{"location":"Operations/Linux/Linux%20Tips/#_4","title":"\u67e5\u770b\u64cd\u4f5c\u7cfb\u7edf\u4fe1\u606f","text":"<pre><code>cat /etc/os-release\n</code></pre> <p>\u6216\u8005 <pre><code>ls-release -a\n</code></pre></p>"},{"location":"Operations/Linux/Linux%20Tips/#cpu","title":"\u67e5\u770b CPU \u4fe1\u606f","text":"<pre><code>lscpu\n</code></pre> <p>\u6216\u8005 <pre><code>cat /proc/cpuinfo\n</code></pre></p>"},{"location":"Operations/Linux/Linux%20Tips/#cpu_1","title":"\u67e5\u770b CPU \u6e29\u5ea6","text":"<p>\u76f4\u63a5\u67e5\u770b CPU \u6e29\u5ea6 <pre><code># cat /sys/class/thermal/thermal_zone0/temp \n27800\n# cat /sys/class/thermal/thermal_zone1/temp \n20000\n# cat /sys/class/thermal/thermal_zone2/temp \n51000\n# cat /sys/class/thermal/thermal_zone3/temp \n44000\n</code></pre></p>"},{"location":"Operations/Linux/Linux%20Tips/#_5","title":"\u67e5\u770b\u8fdb\u7a0b\u5360\u7528\u7684\u5185\u5b58","text":"<p>\u4f7f\u7528 ps \u547d\u4ee4\uff0c\u67e5\u770b\u6307\u5b9a\u8fdb\u7a0b\u7684\u5185\u5b58\u5360\u7528\uff0crss Resident Set Size \u8868\u793a\u5360\u7528\u7269\u7406\u5185\u5b58\u5927\u5c0f\uff0c\u4e0d\u5305\u62ec Swap\uff0c\u5355\u4f4d KB\u3002 <pre><code># ps -o pid,rss,comm -p 170260\n    PID   RSS COMMAND\n 170260 29016 java\n</code></pre></p> <p>\u4f7f\u7528 top \u547d\u4ee4\uff0c\u53ef\u4ee5\u6307\u5b9a\u8fdb\u7a0b ID\u3002\u4f7f\u7528 Shift + M \u53ef\u4ee5\u6309\u7167\u5185\u5b58\u4f7f\u7528\u6392\u5e8f\u3002RES  Resident Set Size \u8868\u793a\u5360\u7528\u7269\u7406\u5185\u5b58\u5927\u5c0f\uff0c\u4e0d\u5305\u62ec Swap\uff0c\u5355\u4f4d KB\u3002 <pre><code># top -p 170260\n\u2026\u2026\n    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                                                                    \n 170260 root      20   0 2384596  29016  15980 S   0.3   1.7   0:02.49 java\n</code></pre></p> <p>\u4f7f\u7528\u00a0<code>/proc/&lt;PID&gt;/status</code>\u00a0\u6587\u4ef6\u67e5\u8be2\u8fdb\u7a0b\u4fe1\u606f\uff0c\u5305\u62ec\u5185\u5b58\u5360\u7528\u3002 <pre><code># cat /proc/170260/status | grep VmRSS\nVmRSS:     29016 kB  \n</code></pre></p>"},{"location":"Operations/Linux/Linux%20Tips/#intel","title":"\u67e5\u770b Intel \u6838\u663e\u5360\u7528\u60c5\u51b5","text":"<p>\u5b89\u88c5\u5fc5\u8981\u7684\u5de5\u5177\u5305 <pre><code>apt install intel_gpu_tools\n</code></pre></p> <p>\u67e5\u770b\u5360\u7528\u60c5\u51b5 <pre><code>intel_gpu_top\n</code></pre></p>"},{"location":"Operations/Linux/Linux%20Tips/#debian","title":"Debian \u955c\u50cf\u5b89\u88c5\u5305","text":"<pre><code>debian-12.10.0-amd64-DVD-1.iso 4G\ndebian-12.10.0-amd64-netinst.iso 633M\n</code></pre> <p>DVD \u7684\u5b89\u88c5\u5305\u5305\u542b\u4e86\u5927\u91cf\u7684\u8f6f\u4ef6\u548c\u5de5\u5177\u5305\uff0c\u5b89\u88c5\u7684\u65f6\u5019\u4e0d\u9700\u8981\u8054\u7f51\u3002netinst \u53ea\u5305\u542b\u57fa\u672c\u7684\u5b89\u88c5\u7a0b\u5e8f\u548c\u6838\u5fc3\u7ec4\u4ef6\uff0c\u5b89\u88c5\u989d\u5916\u7684\u7ec4\u4ef6\u9700\u8981\u8054\u7f51\u3002</p>"},{"location":"Operations/Linux/Linux%20Tips/#ls","title":"ls","text":"<p>\u5e38\u7528\u7684\u9009\u9879 <pre><code>-t sort by modification time, newest first\n\n-S sort by file size, largest first\n\n-r reverse order while sorting\n\n-h with -l and/or -s, print human readable sizes (e.g., 1K 234M 2G)\n\n--time-style with -l, show times using style STYLE: full-iso, long-iso, iso, locale, or +FORMAT; FORMAT is interpreted like in 'date'\n</code></pre></p> <p>\u53ef\u4ee5\u7f16\u8f91 <code>~/.bashrc</code> \u8bbe\u7f6e\u522b\u540d\u3002 <pre><code>alias ll='ls -l --time-stype=long-iso'\n</code></pre></p> <p>\u6587\u4ef6\u7684\u65f6\u95f4\uff1a <pre><code>- mtime\uff0cmodification time \u5f53\u6587\u4ef6\u7684\u5185\u5bb9\u53d8\u66f4\u65f6\uff0c\u5c31\u4f1a\u66f4\u65b0\u8fd9\u4e2a\u65f6\u95f4\u3002\n- ctime\uff0cstatus time\u00a0\u5f53\u6587\u4ef6\u7684\u72b6\u6001\u6539\u53d8\u65f6\u5c31\u4f1a\u66f4\u65b0\u8fd9\u4e2a\u65f6\u95f4\u3002\u6743\u9650\u548c\u5c5e\u6027\u6539\u53d8\u65f6\u4f1a\u66f4\u65b0\u8fd9\u4e2a\u65f6\u95f4\u3002\n- atime\uff0caccess time\u00a0\u5f53\u6587\u4ef6\u7684\u5185\u5bb9\u88ab\u8bfb\u53d6\u65f6\uff0c\u66f4\u65b0\u8fd9\u4e2a\u65f6\u95f4\u3002(\u6839\u636e\u5185\u6838\u53c2\u6570\u914d\u7f6e\uff0c\u8fd9\u4e2a\u65f6\u95f4\u4e0d\u4e00\u5b9a\u88ab\u66f4\u65b0)\n</code></pre> ls -l \u5c55\u793a\u7684\u65f6\u95f4\u5c31\u662f mtime</p>"},{"location":"Operations/Linux/Linux%20Tips/#tar","title":"tar","text":"<p>tar \u7528\u4e8e\u521b\u5efa\u3001\u67e5\u770b\u548c\u89e3\u5305\u5f52\u6863\u6587\u4ef6\uff08archive files\uff09\uff0c\u5f52\u6863\u6587\u4ef6\u901a\u5e38\u4ee5\u00a0.tar\u00a0\u4e3a\u6269\u5c55\u540d\uff0c\u53ef\u4ee5\u5c06\u591a\u4e2a\u6587\u4ef6\u548c\u76ee\u5f55\u6253\u5305\u6210\u4e00\u4e2a\u6587\u4ef6\uff0c\u4fbf\u4e8e\u4f20\u8f93\u6216\u5907\u4efd\u3002 tar \u672c\u8eab\u5e76\u4e0d\u538b\u7f29\u6587\u4ef6\uff0c\u4f46\u53ef\u4ee5\u4e0e\u5176\u4ed6\u538b\u7f29\u5de5\u5177\u7ed3\u5408\u4f7f\u7528\uff0c\u751f\u6210\u538b\u7f29\u7684\u5f52\u6863\u6587\u4ef6 tar.gz\u3001tar.bz2\u3001tar.xz \u7b49\u3002\u7528\u6cd5 <pre><code>tar [\u9009\u9879] [\u5f52\u6863\u6587\u4ef6\u540d] [\u6587\u4ef6\u6216\u76ee\u5f55\u5217\u8868]\n\n-c \u521b\u5efa\u5f52\u6863\u6587\u4ef6\u3002\n-x \u89e3\u5305\u5f52\u6863\u6587\u4ef6\u3002\n\n-z \u4f7f\u7528 gzip \u538b\u7f29\u6216\u89e3\u538b\u7f29\uff08tar.gz \u6216 tgz\uff09\u3002\n-j \u4f7f\u7528 bzip2 \u538b\u7f29\u6216\u89e3\u538b\u7f29\uff08tar.bz2\uff09\u3002\n-J \u4f7f\u7528 xz \u538b\u7f29\u6216\u89e3\u538b\u7f29 \uff08tar.xz\uff09\u3002\n\n-f \u6307\u5b9a\u751f\u6210\u6216\u8005\u5904\u7406\u7684\u5f52\u6863\u6587\u4ef6\u540d\u79f0\u3002\n\n-v \u6253\u5370\u6b63\u5728\u5904\u7406\u7684\u6587\u4ef6\u3002\n-C \u6307\u5b9a\u89e3\u538b\u7f29\u5904\u7406\u540e\u7684\u76ee\u5f55\u3002\n</code></pre></p> <p>\u793a\u4f8b <pre><code>tar -Jxvf mysql-8.4.4-linux-glibc2.28-x86_64.tar.xz -C /usr/local/\n</code></pre></p>"},{"location":"Operations/Linux/Linux%20Tips/#_6","title":"\u67e5\u770b\u786c\u76d8\u6e29\u5ea6","text":"<p>\u5b89\u88c5\u5de5\u5177 <pre><code>apt install smartmontools\n</code></pre></p> <p>\u67e5\u770b\u6e29\u5ea6 <pre><code>smartctl -a /dev/sda | grep Temperature\n</code></pre></p>"},{"location":"Operations/Linux/Linux%20Tips/#base64","title":"base64","text":"<p>\u67e5\u770b\u7528\u6cd5 <pre><code>man base64\n</code></pre></p> <p>\u7f16\u7801 <pre><code>echo -n hello | base64\n</code></pre></p> <p>\u89e3\u7801 <pre><code>echo -n aGVsbG8= | base64 -d\n</code></pre></p>"},{"location":"Operations/Linux/Linux%20Tips/#unix-socket-tcpip-socket","title":"Unix Socket \u548c TCP/IP Socket","text":"<p>Unix Socket \u53eb\u505a\u672c\u5730\u5957\u63a5\u5b57\uff0c\u4f7f\u7528\u6587\u4ef6\u7cfb\u7edf\u8def\u5f84\u4f5c\u4e3a\u901a\u4fe1\u7aef\u70b9\uff0c\u53ea\u80fd\u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\u4f7f\u7528\u3002\u5730\u5740\u7c7b\u578b\u4e3a AF_UNIX\u3002</p> <p>\u4e0d\u7ecf\u8fc7 TCP/IP \u76f4\u63a5\u5185\u6838\u8fdb\u884c\u901a\u4fe1\uff0c\u7cfb\u7edf\u8c03\u7528\u5c11\u5ef6\u8fdf\u4f4e\u3002\u5b89\u5168\u6027\u4f9d\u8d56\u6587\u4ef6\u6743\u9650\u3002</p> <p>\u8fdb\u7a0b A \u6253\u5f00 socket \u6587\u4ef6\u53d1\u9001\u6570\u636e\uff0c\u5185\u5b58\u5728\u5185\u5b58\u4e2d\u628a\u6570\u636e\u4f20\u7ed9\u540c\u4e00\u673a\u5668\u4e0a\u7684\u8fdb\u7a0b B\u3002</p> <p>TCP/IP Socket \u53eb\u505a\u7f51\u7edc\u5957\u63a5\u5b57\uff0c\u53ef\u4ee5\u5728\u540c\u4e00\u53f0\u673a\u5668\u6216\u8005\u8de8\u673a\u5668\u901a\u4fe1\uff0c\u4f7f\u7528 IP \u52a0\u4e0a\u7aef\u53e3\u53f7\u4f5c\u4e3a\u901a\u4fe1\u7aef\u70b9\u3002\u5730\u5740\u7c7b\u578b\u4e3a AF_INET/AF_INET6\u3002</p> <p>\u4f7f\u7528 TCP \u6216\u8005 UDP\uff0c\u7ecf\u8fc7\u5185\u6838\u7f51\u7edc\u6808\uff0c\u9700\u8981\u7f51\u7edc\u534f\u8bae\u5f00\u9500\uff0c\u6027\u80fd\u7565\u4f4e\u4e8e Unix Socket\u3002</p>"},{"location":"Operations/Linux/Linux%20Tips/#_7","title":"\u67e5\u770b\u8ba4\u8bc1\u6210\u529f\u6216\u8005\u5931\u8d25\u7684\u65e5\u5fd7","text":"<p>\u67e5\u770b\u5f53\u524d\u6d3b\u8dc3\u7684\u4f1a\u8bdd\uff1a <pre><code>who\n</code></pre></p> <p>\u67e5\u770b\u5f53\u524d\u7528\u6237\uff1a <pre><code>whoami\n</code></pre></p> <p>\u67e5\u770b\u767b\u5f55\u6210\u529f\u7684\u65e5\u5fd7 last\uff0c\u65e5\u5fd7\u4fdd\u5b58\u5728 /var/log/wtmp\uff1b\u67e5\u770b\u767b\u5f55\u5931\u8d25\u7684\u65e5\u5fd7 lastb\uff0c\u65e5\u5fd7\u4fdd\u5b58\u5728 /var/log/btmp\u3002 <pre><code>last | lastb\n-n \u663e\u793a\u6700\u8fd1\u51e0\u6b21\u7684\u65e5\u5fd7\n-s YYYY-MM-DD/\"YYYY-MM-DD hh:mm:ss\" \u5c55\u793a\u6307\u5b9a\u65e5\u671f/\u65e5\u671f\u65f6\u95f4\u5230\u5f53\u524d\u65f6\u95f4\u7684\u65e5\u5fd7\n</code></pre></p> <p>\u5982\u679c\u542f\u7528\u4e86\u5ba1\u8ba1\u8fdb\u7a0b\uff0c\u67e5\u770b\u767b\u5f55\u4e8b\u4ef6\uff1a <pre><code>ausearch -m USER_LOGIN\n</code></pre></p>"},{"location":"Operations/Linux/PT/","title":"FFmpeg","text":""},{"location":"Operations/Linux/PT/#_1","title":"\u5bb9\u5668","text":"<p>\u89c6\u9891\u6587\u4ef6\u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u5bb9\u5668\uff0c\u5305\u62ec\u97f3\u9891\u3001\u89c6\u9891\u548c\u5b57\u5e55\u7b49\u4fe1\u606f\u3002 \u5bb9\u5668\u7684\u683c\u5f0f <pre><code>- MP4\uff1a\u4e00\u79cd\u901a\u7528\u7684\u591a\u5a92\u4f53\u5bb9\u5668\u683c\u5f0f\uff0c\u652f\u6301\u89c6\u9891\u3001\u97f3\u9891\u3001\u5b57\u5e55\u548c\u9759\u6001\u56fe\u50cf\u7b49\u591a\u79cd\u6570\u636e\u3002\n\n- AVI\uff1a\u662fWindows\u5e73\u53f0\u4e0a\u5e7f\u6cdb\u4f7f\u7528\u7684\u97f3\u9891/\u89c6\u9891\u6587\u4ef6\u683c\u5f0f\u3002\n\n- MKV\uff1aMatroska\u591a\u5a92\u4f53\u5bb9\u5668\u683c\u5f0f\uff0c\u53ef\u5bb9\u7eb3\u51e0\u4e4e\u4efb\u4f55\u7c7b\u578b\u7684\u97f3\u9891\u3001\u89c6\u9891\u3001\u5b57\u5e55\u548c\u9644\u52a0\u5143\u6570\u636e\u3002\n\n- MOV\uff1a\u7531\u82f9\u679c\u516c\u53f8\u5f00\u53d1\u7684QuickTime\u5bb9\u5668\u683c\u5f0f\uff0c\u5e38\u7528\u4e8e\u5b58\u50a8\u89c6\u9891\u548c\u97f3\u9891\u6570\u636e\u3002\n\n- FLV\uff1aFlash\u89c6\u9891\uff0c\u4e3b\u8981\u7528\u4e8e\u6d41\u5f0f\u4f20\u8f93\u5a92\u4f53\u5185\u5bb9\u3002\n\n- WMV\uff1aWindows Media Video\uff0c\u4e00\u79cd\u7531\u5fae\u8f6f\u5f00\u53d1\u7684\u89c6\u9891\u5bb9\u5668\u683c\u5f0f\u3002\n\n- RMVB\uff1aRealMedia Variable Bitrate\uff0c\u7531RealNetworks\u5f00\u53d1\u7684\u6d41\u5a92\u4f53\u683c\u5f0f\uff0c\u901a\u5e38\u7528\u4e8e\u5728\u7ebf\u89c6\u9891\u64ad\u653e\u3002\n\n- WEBM\uff1a\u4e00\u79cd\u5f00\u653e\u3001\u514d\u8d39\u7684\u591a\u5a92\u4f53\u5bb9\u5668\u683c\u5f0f\uff0c\u4e3b\u8981\u7528\u4e8e\u7f51\u7edc\u89c6\u9891\u3002\n</code></pre></p> <p>\u67e5\u770b ffmpeg \u652f\u6301\u7684\u683c\u5f0f <code>ffmpeg -formats</code></p>"},{"location":"Operations/Linux/PT/#_2","title":"\u7f16\u7801","text":"<p>\u97f3\u89c6\u9891\u90fd\u8981\u7ecf\u8fc7\u7f16\u7801\u5b58\u50a8\uff0c\u5c31\u662f\u6587\u672c\u7f16\u7801\u7684 UTF8\u3002 \u89c6\u9891\u7f16\u7801 <pre><code>- H.264/AVC\uff1a\u76ee\u524d\u6700\u4e3a\u666e\u904d\u7684\u89c6\u9891\u7f16\u7801\u6807\u51c6\u4e4b\u4e00\uff0c\u7528\u4e8e\u538b\u7f29\u9ad8\u8d28\u91cf\u89c6\u9891\uff0c\u9002\u7528\u4e8e\u5404\u79cd\u5e94\u7528\u573a\u666f\uff0c\u5982\u5728\u7ebf\u89c6\u9891\u3001\u84dd\u5149\u5149\u76d8\u7b49\u3002\n\n- H.265/HEVC\uff1a\u9ad8\u6548\u89c6\u9891\u7f16\u7801\u6807\u51c6\uff0c\u76f8\u8f83\u4e8eH.264\uff0c\u5728\u76f8\u540c\u753b\u8d28\u4e0b\u53ef\u4ee5\u5b9e\u73b0\u66f4\u9ad8\u7684\u538b\u7f29\u7387\uff0c\u9002\u7528\u4e8e\u9ad8\u6e05\u548c\u8d85\u9ad8\u6e05\u89c6\u9891\u3002\n\n- VP9\uff1a\u7531Google\u5f00\u53d1\u7684\u5f00\u653e\u5f0f\u89c6\u9891\u7f16\u7801\u683c\u5f0f\uff0c\u7528\u4e8e\u7f51\u7edc\u89c6\u9891\uff0c\u5177\u6709\u9ad8\u538b\u7f29\u7387\u548c\u9ad8\u753b\u8d28\u7684\u7279\u70b9\u3002\n\n- AV1\uff1a\u7531Alliance for Open Media (AOMedia)\u5f00\u53d1\u7684\u5f00\u653e\u5f0f\u89c6\u9891\u7f16\u7801\u683c\u5f0f\uff0c\u65e8\u5728\u63d0\u4f9b\u66f4\u9ad8\u7684\u538b\u7f29\u6548\u7387\u548c\u66f4\u597d\u7684\u89c6\u89c9\u8d28\u91cf\uff0c\u9002\u7528\u4e8e\u7f51\u7edc\u89c6\u9891\u7b49\u573a\u666f\u3002\n\n- MPEG-2\uff1a\u65e9\u671f\u5e7f\u6cdb\u7528\u4e8eDVD\u3001\u6570\u5b57\u7535\u89c6\u7b49\u5e94\u7528\u7684\u89c6\u9891\u7f16\u7801\u6807\u51c6\u3002\n\n- MPEG-4 Part 2\uff1a\u5305\u62ecXvid\u3001DivX\u7b49\u7f16\u7801\u5668\uff0c\u7528\u4e8e\u538b\u7f29\u89c6\u9891\u4ee5\u53ca\u6d41\u5f0f\u4f20\u8f93\u5a92\u4f53\u5185\u5bb9\u3002\n\n- VC-1\uff1a\u7531\u5fae\u8f6f\u5f00\u53d1\u7684\u9ad8\u538b\u7f29\u7387\u89c6\u9891\u7f16\u7801\u6807\u51c6\uff0c\u901a\u5e38\u7528\u4e8e\u84dd\u5149\u5149\u76d8\u3001\u9ad8\u6e05DVD\u7b49\u3002\n\n- Theora\uff1a\u5f00\u6e90\u7684\u89c6\u9891\u7f16\u7801\u683c\u5f0f\uff0c\u4e3b\u8981\u7528\u4e8e\u7f51\u7edc\u89c6\u9891\u3002\n</code></pre></p> <p>\u97f3\u9891\u7f16\u7801 <pre><code>- MP3 \u662f\u4e00\u79cd\u5e38\u89c1\u7684\u97f3\u9891\u7f16\u7801\u683c\u5f0f\uff0c\u5168\u79f0\u4e3a MPEG-1 Audio Layer III\u3002\u5b83\u662f\u4e00\u79cd\u6709\u635f\u538b\u7f29\u7684\u97f3\u9891\u683c\u5f0f\uff0c\u65e8\u5728\u901a\u8fc7\u53bb\u9664\u4eba\u8033\u542c\u4e0d\u5230\u7684\u97f3\u9891\u4fe1\u53f7\u7684\u90e8\u5206\u6765\u51cf\u5c0f\u6587\u4ef6\u5927\u5c0f\uff0c\u4ece\u800c\u5b9e\u73b0\u9ad8\u5ea6\u538b\u7f29\uff0c\u540c\u65f6\u4fdd\u7559\u8db3\u591f\u7684\u97f3\u8d28\u4ee5\u4f9b\u5927\u591a\u6570\u4eba\u4eab\u53d7\u3002\n\n- FLAC\uff1aFree Lossless Audio Codec \u662f\u4e00\u79cd\u5f00\u6e90\u7684\u65e0\u635f\u97f3\u9891\u7f16\u7801\u683c\u5f0f\uff0c\u7531 Xiph.Org Foundation \u5f00\u53d1\u3002\n\n- APE\uff1aMonkey's Audio \u662f\u4e00\u79cd\u7531 Matthew T. Ashland \u5f00\u53d1\u7684\u65e0\u635f\u97f3\u9891\u7f16\u7801\u683c\u5f0f\u3002\n\n- AAC\uff1aAdvanced Audio Coding\uff0c\u662f\u4e00\u79cd\u9ad8\u6548\u7684\u6709\u635f\u538b\u7f29\u97f3\u9891\u683c\u5f0f\uff0c\u5e38\u7528\u4e8eiTunes\u97f3\u4e50\u3001YouTube\u7b49\u3002\n\n- WAV\uff1aWaveform Audio File Format\uff0c\u662f\u4e00\u79cd\u65e0\u635f\u97f3\u9891\u683c\u5f0f\uff0c\u901a\u5e38\u7528\u4e8e\u5b58\u50a8\u97f3\u9891\u6570\u636e\uff0c\u4fdd\u7559\u4e86\u539f\u59cb\u97f3\u9891\u7684\u9ad8\u8d28\u91cf\u3002\n\n- FLAC\uff1aFree Lossless Audio Codec\uff0c\u662f\u4e00\u79cd\u81ea\u7531\u5f00\u653e\u7684\u65e0\u635f\u97f3\u9891\u7f16\u7801\u683c\u5f0f\uff0c\u53ef\u4ee5\u5b9e\u73b0\u65e0\u635f\u538b\u7f29\uff0c\u4fdd\u7559\u97f3\u9891\u7684\u539f\u59cb\u8d28\u91cf\u3002\n\n- OGG\uff1aOgg Vorbis\uff0c\u662f\u4e00\u79cd\u5f00\u653e\u3001\u81ea\u7531\u7684\u6709\u635f\u97f3\u9891\u7f16\u7801\u683c\u5f0f\uff0c\u5e38\u7528\u4e8e\u97f3\u4e50\u6d41\u5a92\u4f53\u7b49\u573a\u666f\u3002\n\n- WMA\uff1aWindows Media Audio\uff0c\u662f\u5fae\u8f6f\u5f00\u53d1\u7684\u4e00\u79cd\u6709\u635f\u97f3\u9891\u7f16\u7801\u683c\u5f0f\uff0c\u5e38\u7528\u4e8eWindows\u5e73\u53f0\u7684\u97f3\u9891\u6587\u4ef6\u3002\n\n- Opus\uff1a\u4e00\u79cd\u5f00\u653e\u3001\u514d\u8d39\u7684\u97f3\u9891\u7f16\u7801\u683c\u5f0f\uff0c\u65e8\u5728\u63d0\u4f9b\u9ad8\u8d28\u91cf\u7684\u97f3\u9891\u7f16\u7801\uff0c\u9002\u7528\u4e8e\u5404\u79cd\u5e94\u7528\uff0c\u5982VoIP\u901a\u8bdd\u3001\u7f51\u7edc\u97f3\u9891\u6d41\u7b49\u3002\n\n- PCM\uff1aPulse-code Modulation\uff0c\u662f\u4e00\u79cd\u539f\u59cb\u7684\u6570\u5b57\u97f3\u9891\u7f16\u7801\u683c\u5f0f\uff0c\u901a\u5e38\u4e0d\u8fdb\u884c\u538b\u7f29\uff0c\u7528\u4e8e\u5b58\u50a8\u97f3\u9891\u6570\u636e\u6216\u4f5c\u4e3a\u5176\u4ed6\u7f16\u7801\u683c\u5f0f\u7684\u57fa\u7840\u3002\n</code></pre></p> <p>\u67e5\u770b ffmpeg \u652f\u6301\u7684\u7f16\u7801 <code>ffmpeg -codecs</code></p>"},{"location":"Operations/Linux/PT/#_3","title":"\u7f16\u7801\u5668","text":"<p>\u987e\u540d\u601d\u4e49\uff0c\u5b9e\u73b0\u4e86\u7f16\u7801\u683c\u5f0f\u7684\u5e93\u6587\u4ef6\u3002 \u67e5\u770b ffmpeg \u5df2\u5b89\u88c5\u7684\u7f16\u7801\u5668 <code>ffmpeg -encoders</code></p>"},{"location":"Operations/Linux/PT/#_4","title":"\u6587\u4ef6\u540d\u89e3\u6790","text":"<p>The.Beekeeper.2024.2160p.UHD.Blu-ray.Remux.HEVC.TrueHD7.1.Atmos.iso <pre><code>- The Beekeeper: \u8fd9\u53ef\u80fd\u662f\u89c6\u9891\u7684\u6807\u9898\uff0c\u6307\u793a\u89c6\u9891\u5185\u5bb9\u6216\u8005\u662f\u7535\u5f71\u3001\u7535\u89c6\u8282\u76ee\u7684\u540d\u79f0\u3002\n\n- 2024: \u8fd9\u53ef\u80fd\u662f\u6307\u89c6\u9891\u7684\u53d1\u5e03\u5e74\u4efd\uff0c\u4e5f\u53ef\u80fd\u662f\u67d0\u4e2a\u4e8b\u4ef6\u7684\u5e74\u4efd\uff0c\u6216\u8005\u662f\u67d0\u4e2a\u7248\u672c\u7684\u5e74\u4efd\u3002\n\n- 2160p: \u8fd9\u8868\u793a\u89c6\u9891\u7684\u5206\u8fa8\u7387\uff0c\u901a\u5e38\u6307\u7684\u662f4K\u5206\u8fa8\u7387\u3002\n\n- UHD: \u8fd9\u662fUltra High Definition\u7684\u7f29\u5199\uff0c\u8868\u793a\u89c6\u9891\u662f\u8d85\u9ad8\u6e05\u7684\u3002\n\n- Blu-ray Remux: \u8fd9\u8868\u660e\u89c6\u9891\u662f\u4ece\u84dd\u5149\u5149\u76d8\u4e2d\u91cd\u65b0\u590d\u5236\u800c\u6765\u7684\uff0c\u901a\u5e38\u4fdd\u7559\u4e86\u539f\u59cb\u89c6\u9891\u7684\u8d28\u91cf\u548c\u7279\u6027\u3002Remux \u8868\u793a\u91cd\u5236\uff0c\u4e00\u822c\u4ec5\u4ec5\u5220\u9664\u539f\u76d8\u91cc\u9762\u7684\u591a\u4f59\u5185\u5bb9\uff0c\u5982\u82b1\u7d6e\uff0c\u4ec5\u4fdd\u7559\u4e3b\u8981\u7684\u89c6\u9891\u3001\u97f3\u8f68\u548c\u90e8\u5206\u8bed\u8a00\u5b57\u5e55\uff0c\u753b\u8d28\u548c\u97f3\u8d28\u6ca1\u6709\u505a\u4efb\u4f55\u4fee\u6539\u3002\u5982\u679c\u6709WEB-DL/WEBRip \u8868\u793a\u5728\u7ebf\u9ad8\u6e05\u7535\u5f71\uff0c\u4e00\u822c\u662f\u6d41\u5a92\u4f53\u5e73\u53f0\u7684\u683c\u5f0f\uff0c\u4f1a\u6709\u538b\u7f29\u548c\u89c2\u611f\u7684\u635f\u5931\u3002BDRip \u91c7\u7528\u66f4\u5389\u5bb3\u7684\u538b\u7f29\u7b97\u6cd5\u5c06\u97f3\u89c6\u9891\u8fdb\u884c\u6709\u635f\u538b\u7f29\u3002\n\n- HEVC: \u8fd9\u662fHigh Efficiency Video Coding\u7684\u7f29\u5199\uff0c\u6307\u7684\u662f\u89c6\u9891\u4f7f\u7528\u7684\u7f16\u89e3\u7801\u683c\u5f0f\u3002\n\n- TrueHD 7.1 Atmos: \u8fd9\u6307\u51fa\u4e86\u89c6\u9891\u7684\u97f3\u9891\u7f16\u89e3\u7801\u683c\u5f0f\u548c\u58f0\u9053\u5e03\u5c40\uff0c\u5176\u4e2dTrueHD 7.1\u8868\u793a\u97f3\u9891\u683c\u5f0f\uff0c\u800cAtmos\u8868\u793a\u97f3\u9891\u7684\u7acb\u4f53\u58f0\u97f3\u6548\u3002\n\n- .iso: \u8fd9\u53ef\u80fd\u662f\u6307\u6587\u4ef6\u7684\u7c7b\u578b\u6216\u8005\u6587\u4ef6\u6269\u5c55\u540d\uff0c\"iso\"\u901a\u5e38\u8868\u793a\u5149\u76d8\u955c\u50cf\u6587\u4ef6\u3002\n</code></pre></p> <p>\u5408\u5e76 B \u7ad9\u89c6\u9891\uff0c\u5408\u96c6\u89c6\u9891\u7684\u4e00\u4e2a\u7ae0\u8282\u89c6\u9891\u76ee\u5f55\u5982\u4e0b\uff1a <pre><code>c_509967785\n\u251c\u2500\u2500 80\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 audio.m4s     // \u97f3\u9891\u4fe1\u606f\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 index.json    // \n\u2502\u00a0\u00a0 \u2514\u2500\u2500 video.m4s     // \u89c6\u9891\u4fe1\u606f\n\u251c\u2500\u2500 danmaku.xml       // \u5f39\u5e55\u4fe1\u606f\n\u2514\u2500\u2500 entry.json        // \u7ae0\u8282\u89c6\u9891\u63cf\u8ff0\u4fe1\u606f\uff0c\u53ef\u4ee5\u7528\u6765\u63d0\u53d6\u89c6\u9891\u6807\u9898\n</code></pre></p> <p>\u4f7f\u7528 ffmpeg \u5408\u5e76\u547d\u4ee4 <pre><code>ffmpeg -i video.m4s -i audio.m4s -c copy -loglevel quit output.mp4\n</code></pre></p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>import java.io.BufferedReader;  \nimport java.io.File;  \nimport java.io.IOException;  \nimport java.io.InputStreamReader;  \nimport java.nio.file.Files;  \nimport java.nio.file.Path;  \nimport java.nio.file.Paths;  \n\npublic class BSiteMerge {  \n\n    private static final String ENTRY_FILE = \"entry.json\";  \n    private static final String VIDEO_FILE = \"80/video.m4s\";  \n    private static final String AUDIO_FILE = \"80/audio.m4s\";  \n\n    private static final String ROOT_DIR = \"/Volumes/New Volume/\u5b66\u4e60\u8d44\u6599/1852212560\";  \n    private static final String OUTPUT_DIR = \"/Volumes/New Volume/\u5b66\u4e60\u8d44\u6599/k1\";  \n\n    public static void main(String[] args) throws Exception{  \n        Files.list(Paths.get(ROOT_DIR)).forEach(part -&gt; {  \n\n            Path entryPath = part.resolve(ENTRY_FILE);  \n            String partName = getPartName(entryPath);  \n\n            Path videoPath = part.resolve(VIDEO_FILE);  \n            Path audioPath = part.resolve(AUDIO_FILE);  \n\n            String outputFile = OUTPUT_DIR + File.separator + partName + \".mp4\";  \n            ProcessBuilder builder = new ProcessBuilder(\"ffmpeg\",  \n                    \"-i\", videoPath.toString(),  \n                    \"-i\", audioPath.toString(),  \n                    \"-c\", \"copy\",  \n                    \"-loglevel\", \"quiet\",  \n                    outputFile);  \n            try {  \n                // \u6267\u884c\u547d\u4ee4  \n                Process process = builder.start();  \n\n                // \u6253\u5370 FFmpeg \u8f93\u51fa\uff08\u53ef\u9009\uff09  \n                BufferedReader reader = new BufferedReader(  \n                        new InputStreamReader(process.getInputStream())  \n                );  \n                String line;  \n                while ((line = reader.readLine()) != null) {  \n                    System.out.println(line);  \n                }  \n\n                // \u7b49\u5f85\u8fdb\u7a0b\u5b8c\u6210  \n                int exitCode = process.waitFor();  \n                if (exitCode == 0) {  \n                    System.out.println(\"\u89c6\u9891\u548c\u97f3\u9891\u5408\u5e76\u6210\u529f\uff0c\u8f93\u51fa\u6587\u4ef6\uff1a\" + outputFile);  \n                } else {  \n                    System.err.println(\"\u5408\u5e76\u5931\u8d25\uff0c\u9000\u51fa\u4ee3\u7801\uff1a\" + exitCode);  \n                }  \n            } catch (IOException | InterruptedException e) {  \n                e.printStackTrace();  \n            }  \n\n        });  \n    }  \n\n\n\n    public static String getPartName(Path path) {  \n        try {  \n            String entryContent = Files.readString(path);  \n            // \u67e5\u627e \"part\" \u7684\u4f4d\u7f6e  \n            String key = \"\\\"part\\\":\";  \n            int startIndex = entryContent.indexOf(key);  \n\n            // \u5b9a\u4f4d\u503c\u7684\u5f00\u59cb\u548c\u7ed3\u675f  \n            startIndex += key.length();  \n            int endIndex = entryContent.indexOf(\",\", startIndex);  \n\n            // \u63d0\u53d6\u503c\u5e76\u53bb\u9664\u591a\u4f59\u7684\u5f15\u53f7  \n            return entryContent.substring(startIndex + 1, endIndex - 1).trim();  \n        } catch (IOException e) {  \n            throw new RuntimeException(e);  \n        }  \n    }  \n}\n</code></pre></p>"},{"location":"Operations/Linux/Paperless%20%E5%AE%89%E8%A3%85/","title":"Paperless \u5b89\u88c5","text":"<p>\u51c6\u5907 Redis</p> <p>\u51c6\u5907 PG <pre><code>create user paperless with password 'xxxx';\ncreate database paperless owner paperless;\n\n-- \u4e3a Paperless \u7684\u641c\u7d22\u529f\u80fd\u542f\u7528\u6269\u5c55\uff08\u91cd\u8981\uff01\uff09 \nCREATE EXTENSION IF NOT EXISTS pg_trgm; \nCREATE EXTENSION IF NOT EXISTS unaccent;\n</code></pre></p> <p>\u51c6\u5907\u76ee\u5f55 <pre><code>mkdir -p /data/paperless/{data,media,export,consumer}\n</code></pre></p> <p>docker-compose.yml <pre><code>services:\n  webserver:\n    image: ghcr.io/paperless-ngx/paperless-ngx:latest\n    container_name: paperless\n    network_mode: host\n    restart: unless-stopped\n    volumes:\n      - ./data:/usr/src/paperless/data\n      - ./media:/usr/src/paperless/media\n      - ./export:/usr/src/paperless/export\n      - ./consume:/usr/src/paperless/consume\n    environment:\n      PAPERLESS_ENABLE_OCR: false\n      PAPERLESS_REDIS: redis://:xxxx@localhost:6379\n      PAPERLESS_REDIS_PREFIX: paperless\n      PAPERLESS_DBENGINE: postgresql\n      PAPERLESS_DBHOST: localhost\n      PAPERLESS_DBPORT: 5432\n      PAPERLESS_DBNAME: paperless\n      PAPERLESS_DBUSER: paperless\n      PAPERLESS_DBPASS: xxxx\n</code></pre></p> <p>\u542f\u52a8\uff1a <pre><code>docker compose up -d\n</code></pre></p> <p>\u505c\u6b62\u5e76\u5220\u9664\u5bb9\u5668\uff1a <pre><code>docker compose down \n</code></pre></p>"},{"location":"Operations/Linux/VIM/","title":"VIM","text":""},{"location":"Operations/Linux/VIM/#_1","title":"\u914d\u7f6e","text":"<p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff0c\u5168\u5c40\uff1a/etc/vim/vimrc\uff0c\u4e2a\u4eba\uff1a~/.vimrc\u3002 <pre><code>set nu \nsyntax on \nset nobackup \nset tabstop=4 \nset shiftwidth=4 \nset expandtab \nset autoindent \nset noswapfile\n</code></pre></p>"},{"location":"Operations/Linux/VIM/#_2","title":"\u5feb\u901f\u64cd\u4f5c","text":"<p>\u5c55\u793a\u884c\u53f7\uff1a<code>set nu</code></p> <p>\u53d6\u6d88\u884c\u53f7\uff1a<code>set nonu</code></p> <p>\u5149\u6807\u8df3\u5230\u884c\u5c3e\uff1a<code>shift + $</code></p> <p>\u5149\u6807\u8df3\u5230\u884c\u9996\uff1a<code>shift + ^</code></p> <p>\u5149\u6807\u8df3\u5230\u6587\u4ef6\u5f00\u5934\uff1a<code>gg</code>/<code>1g</code></p> <p>\u5149\u6807\u8df3\u5230\u6587\u4ef6\u7ed3\u5c3e\uff1a<code>shift + g</code></p>"},{"location":"Operations/Linux/VIM/#_3","title":"\u66ff\u6362","text":"<p><code>:n1,n2s/word1/word2/g</code> \u5728 n1 \u884c\u548c n2 \u884c\u4e4b\u95f4\uff0c\u66ff\u6362 <code>word1</code> \u4e3a <code>word2</code>\u3002</p> <p><code>:1,$s/word1/word2/g</code> \u5728 \u7b2c\u4e00\u884c\u4e0e\u6700\u540e\u4e00\u884c\u4e4b\u95f4\u5bfb\u627e <code>word1</code> \u66ff\u6362\u4e3a <code>word2</code>\uff0c\u7b49\u540c\u4e8e <code>:%s/word1/word2/g</code>\u3002</p> <p><code>:s/word1/word2</code> \u5f53\u524d\u884c\u7684\u7b2c\u4e00\u4e2a <code>word1</code> \u66ff\u6362\u4e3a <code>word2</code>\u3002 </p> <p><code>:s/word1/word2/g</code>  \u5f53\u524d\u884c\u7684\u6240\u6709\u7684 <code>word1</code> \u66ff\u6362\u4e3a <code>word2</code>\u3002</p> <p><code>:%s/word1/word2</code> \u6bcf\u4e00\u884c\u7684\u7b2c\u4e00\u4e2a <code>word1</code> \u66ff\u6362\u4e3a <code>word2</code>\u3002</p>"},{"location":"Operations/Linux/VIM/#_4","title":"\u6362\u884c","text":"<p>\u6267\u884c\u5982\u4e0b\u547d\u4ee4 <pre><code># echo hello &gt; test.txt\n# ls -lh\n-rw-r--r-- 1 root root    6 Mar  1 14:55 test.txt\n</code></pre></p> <p>\u5206\u6790\u8f93\u51fa\u7ed3\u679c\u80fd\u591f\u770b\u5230\uff0c\u53ea\u8f93\u51fa\u4e86 <code>hello</code> 5 \u4e2a\u5b57\u7b26\uff0c\u4f46\u662f <code>test.txt</code> \u6587\u4ef6\u7684\u5927\u5c0f\u4e3a 6 \u4e2a\u5b57\u8282\u3002</p> <p>\u4f7f\u7528\u547d\u4ee4 od \u67e5\u770b\u53ef\u4ee5\u770b\u5230 echo \u547d\u4ee4\u9ed8\u8ba4\u52a0\u4e86\u4e00\u4e2a\u6362\u884c\u7b26\uff0c\u5373 <code>0x0a</code>\u3002</p> <pre><code># od -x test.txt \n0000000 6568 6c6c 0a6f\n0000006\n</code></pre> <p>echo \u6709\u4e2a -n \u9009\u9879\u80fd\u591f\u63a7\u5236\u4e0d\u8f93\u51fa\u6362\u884c\u7b26\u3002 <pre><code>-n     do not output the trailing newline\n</code></pre></p> <pre><code># echo -n hello &gt; a.txt\n# ls -l\n-rw-r--r-- 1 root root        5 Mar  1 14:59 a.txt\n-rw-r--r-- 1 root root        6 Mar  1 14:55 test.txt\n\n# od -x a.txt \n0000000 6568 6c6c 006f\n0000005\n</code></pre> <p>\u540c\u6837 VIM \u5728\u7f16\u8f91\u4fdd\u5b58\u6587\u4ef6\u7684\u65f6\u5019\u4f1a\u5728\u6700\u540e\u4e00\u884c\u9ed8\u8ba4\u589e\u52a0\u6362\u884c\u7b26\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u4fdd\u5b58\u6587\u4ef6\u53ef\u53d6\u6d88\u6700\u540e\u4e00\u884c\u7684\u6362\u884c\u7b26\u3002 <pre><code>:set bin noeol\n:wq\n</code></pre></p>"},{"location":"Operations/Linux/VIM/#_5","title":"\u5728\u591a\u884c\u884c\u9996\u63d2\u5165\u5b57\u7b26","text":"<ol> <li>\u4f7f\u7528 Ctrl + v \u8fdb\u5165\u53ef\u662f\u5757\u6a21\u5f0f\u3002</li> <li>\u4f7f\u7528\u4e0a\u4e0b\u952e\u9009\u62e9\u8981\u7f16\u8f91\u7684\u884c\u3002</li> <li>\u4f7f\u7528 Shift + i \u8fdb\u5165\u63d2\u5165\u6a21\u5f0f\u3002</li> <li>\u8f93\u51fa\u8981\u63d2\u5165\u7684\u5b57\u7b26\u3002</li> <li>\u6309\u952e <code>Esc</code> \u5b8c\u6210\u63d2\u5165\u64cd\u4f5c\u3002</li> </ol>"},{"location":"Operations/Linux/VIM/#_6","title":"\u7ec8\u7aef\u7c98\u8d34\u7f29\u8fdb\u95ee\u9898","text":"<p>\u5c06\u591a\u884c\u6587\u672c copy \u5230 vim \u65f6\uff0c\u4f1a\u51fa\u73b0\u9664\u9996\u884c\u5916\u5176\u4f59\u884c\u7684\u6587\u672c\u7f29\u8fdb\u4e0d\u5bf9\u5176\u3002</p> <p>\u542f\u7528 vim \u7684 paste \u6a21\u5f0f\uff0c\u544a\u8bc9\u7f16\u8f91\u5668\u4e0d\u5bf9\u7c98\u8d34\u7684\u6587\u672c\u505a\u6362\u884c\u3001\u7f29\u8fdb\u3001\u81ea\u52a8\u8865\u5168\u7b49\u5904\u7406\u3002 <pre><code>:set paste\n</code></pre></p> <p>\u9000\u51fa\u7f29\u8fdb\u6a21\u5f0f\uff1a <pre><code>:set nopaste\n</code></pre></p>"},{"location":"Operations/Linux/curl/","title":"Curl","text":""},{"location":"Operations/Linux/curl/#linux","title":"Linux","text":"<pre><code>curl -X POST \"http://localhost:8080/api\" \\\n  -H \"Content-Type: application/json\" \\\n  -H \"a: b\" \\\n  -d '{\"key1\":\"value1\"}'\n</code></pre>"},{"location":"Operations/Linux/curl/#windows","title":"Windows","text":"<p>\u8bf7\u6c42\u643a\u5e26\u8bf7\u6c42\u5934 <pre><code>curl \"http://172.31.8.118:17001/sys/role/check?id=aaa\" ^\n-H \"x-access-token: xxxxx\"\n</code></pre></p>"},{"location":"Operations/Linux/fail2ban/","title":"Fail2ban","text":""},{"location":"Operations/Linux/fail2ban/#fail2ban","title":"fail2ban","text":""},{"location":"Operations/Linux/fail2ban/#_1","title":"\u4ecb\u7ecd","text":"<p>\u5b89\u88c5\uff1a <pre><code>apt install fail2ban\n</code></pre></p> <p>\u6309\u7167\u4e0b\u9762\u7684\u987a\u5e8f\u52a0\u8f7d\u914d\u7f6e\uff0c\u540e\u8005\u8986\u76d6\u524d\u8005\uff1a</p> <ol> <li><code>jail.conf</code> \u57fa\u7840\u9ed8\u8ba4\u914d\u7f6e\u3002</li> <li><code>jail.loca</code>l \u7528\u6237\u81ea\u5b9a\u4e49\u914d\u7f6e\u3002</li> <li><code>jail.d/*.conf</code> \u66f4\u7ec6\u7c92\u5ea6\u7684\u914d\u7f6e\u3002</li> </ol> <p>\u65e5\u5fd7\u76d1\u63a7 fail2ban \u6839\u636e\u00a0<code>paths-*.conf</code>\u786e\u5b9a\u65e5\u5fd7\u8def\u5f84\uff08\u5982\u00a0<code>/var/log/auth.log</code>\uff09\u3002\u901a\u8fc7\u00a0<code>inotify</code>\u6216\u00a0<code>polling</code>\u5b9e\u65f6\u76d1\u542c\u65e5\u5fd7\u53d8\u5316\uff0c\u4f1a\u8bb0\u5f55\u6587\u4ef6\u7684 inode \u548c\u504f\u79fb\u91cf\u3002\u4e5f\u53ef\u4ee5\u901a\u8fc7 logpath \u6307\u5b9a\u65e5\u5fd7\u8def\u5f84\u3002</p> <p>\u5982\u679c\u914d\u7f6e\u4e86\u65e5\u5fd7\u8f6e\u8f6c\uff0c\u90a3\u4e48\u9700\u8981\u5728\u8f6e\u8f6c\u91cc\u9762\u914d\u7f6e fail2ban \u91cd\u65b0\u52a0\u8f7d\u65e5\u5fd7\u3002</p> <p>\u5982\u679c\u670d\u52a1\u65e5\u5fd7\u901a\u8fc7 journald \u7ba1\u7406\uff0cfail2ban \u4e5f\u53ef\u4ee5\u914d\u7f6e\u76d1\u63a7\uff1a <pre><code>[sshd]\nenabled   = true\nbackend   = systemd                  # \u4f7f\u7528 systemd \u540e\u7aef\njournalmatch = _SYSTEMD_UNIT=sshd.service  # \u53ea\u76d1\u63a7 sshd \u670d\u52a1\u7684\u65e5\u5fd7\n</code></pre></p> <p>\u89c4\u5219\u5339\u914d \u8bfb\u53d6\u65b0\u589e\u65e5\u5fd7\u884c\u540e\uff0c\u8c03\u7528\u00a0<code>filter.d/</code>\u4e2d\u7684\u89c4\u5219\uff08\u5982\u00a0<code>sshd.conf</code>\uff09\u8fdb\u884c\u6b63\u5219\u5339\u914d\u3002\u82e5\u5339\u914d\u6210\u529f\uff0c\u89e6\u53d1\u5bf9\u5e94 Jail \u7684\u8ba1\u6570\u5668\uff08\u8bb0\u5f55\u5728\u00a0<code>/var/lib/fail2ban/fail2ban.sqlite3</code>\uff09\u3002</p> <p>\u76d1\u7981\u5224\u5b9a \u6839\u636e\u00a0<code>jail.conf</code>\u3001<code>jail.local</code>\u6216\u00a0<code>jail.d/*.conf</code>\u4e2d\u7684\u53c2\u6570\uff08\u5982\u00a0<code>maxretry=3</code>\uff09\u5224\u65ad\u662f\u5426\u5c01\u7981 IP\u3002\u82e5\u8fbe\u5230\u9608\u503c\uff0c\u6267\u884c\u00a0<code>action.d/</code>\u4e2d\u5b9a\u4e49\u7684\u52a8\u4f5c\u3002</p> <p>\u6267\u884c\u5c01\u7981 \u52a8\u4f5c\u811a\u672c\uff08\u5982\u00a0<code>iptables.conf</code>\uff09\u6dfb\u52a0\u9632\u706b\u5899\u89c4\u5219\uff0c\u7981\u6b62 IP \u8bbf\u95ee\u6307\u5b9a\u7aef\u53e3\u3002\u53ef\u9009\u901a\u77e5\u64cd\u4f5c\uff08\u5982\u00a0<code>sendmail.conf</code>\u53d1\u9001\u544a\u8b66\u90ae\u4ef6\uff09\u3002</p>"},{"location":"Operations/Linux/fail2ban/#_2","title":"\u914d\u7f6e\u89e3\u5c01","text":"<p>\u767d\u540d\u5355\u914d\u7f6e\uff0c\u5c06\u53ef\u4fe1 IP \u52a0\u5165\u00a0<code>ignoreip</code>\uff0c\u907f\u514d\u88ab\u5c01\u7981\u3002 <pre><code># \u66f4\u65b0\u914d\u7f6e\n[DEFAULT]\nignoreip = 127.0.0.1/8 192.168.1.0/24\n\n# \u9700\u8981\u91cd\u542f\u670d\u52a1\nsystemctl restart fail2ban\n</code></pre></p> <p>\u89e3\u5c01\u64cd\u4f5c\uff1a <pre><code># \u89e3\u5c01\u6240\u6709 jail \u7684\u6240\u6709 IP\nfail2ban-client unban --all\n\n# \u91cd\u65b0\u52a0\u8f7d jail \u5e76\u89e3\u7981\u6240\u6709 IP\nfail2ban-client reload --unban &lt;JAIL&gt;\n\n# \u89e3\u5c01\u67d0\u4e2a ip\nfail2ban-client set &lt;JAIL&gt; unbanip 192.168.1.100\n</code></pre></p> <p>Tips\uff1a\u5982\u679c\u591a\u4e2a jail \u90fd\u5c01\u7981\u4e86\u4e00\u4e2a IP\uff0c\u90a3\u4e48\u89e3\u7981\u53ea\u4f1a\u5f71\u54cd\u5f53\u524d jail\u3002\u5982\u679c\u591a\u4e2a jail \u90fd\u662f port=all\uff0c\u90a3\u4e48\u4e5f\u9700\u8981\u90fd\u89e3\u7981\u624d\u80fd\u8bbf\u95ee\u8fdb\u6765\u3002</p>"},{"location":"Operations/Linux/fail2ban/#ssh","title":"SSH \u914d\u7f6e","text":"<p>\u65b0\u589e\u914d\u7f6e\u6587\u4ef6 /etc/fail2ban/jail.d/sshd.local\uff1a <pre><code>[sshd]\n# \u4f7f\u7528 journal \u65e5\u5fd7\nbackend=systemd\nenabled=true\n# 10m \u5185\uff0c5 \u6b21\uff0c\u5c01\u7981 12h\nmaxretry=5\nfindtime=10m\nbantime=12h\n</code></pre></p> <p>\u67e5\u770b\u5c5e\u6027\u4fe1\u606f\uff1a <pre><code>fail2ban-client get sshd bantime\nfail2ban-client get sshd findtime\nfail2ban-client get sshd maxretry\nfail2ban-client get sshd failregex\n</code></pre></p> <p>\u67e5\u770b\u76d1\u7981\u72b6\u6001\uff1a <pre><code>fail2ban-client status sshd\n</code></pre></p>"},{"location":"Operations/Linux/fail2ban/#nginx","title":"Nginx \u914d\u7f6e","text":"<p>\u5047\u8bbe Nginx \u65e5\u5fd7\u914d\u7f6e\uff1a <pre><code>log_format j_format escape=json  \n  '{\"time\":\"$time_iso8601\",'  \n   '\"remote_addr\":\"$remote_addr\",'  \n   '\"scheme\":\"$scheme\",'  \n   '\"status\":$status,'  \n   '\"request_method\":\"$request_method\",'  \n   '\"uri\":\"$uri\",'  \n   '\"args\":\"$args\",'  \n   '\"server_protocol\":\"$server_protocol\",'  \n   '\"body_bytes_sent\":$body_bytes_sent,'  \n   '\"request_time\":$request_time,'  \n   '\"http_referer\":\"$http_referer\",'  \n   '\"http_user_agent\":\"$http_user_agent\",'  \n   '\"http_token\":\"$http_token\",'  \n   '\"upstream_response_time\":\"$upstream_response_time\",'  \n   '\"service_name\":\"$service_name\",'  \n   '\"upstream_addr\":\"$upstream_addr\"}';\n\naccess_log  logs/access.json j_format;\n</code></pre></p> <p>\u5b9e\u73b0\u4e0b\u9762\u4e24\u4e2a\u9700\u6c42\uff1a 1. \u914d\u7f6e\u5982\u679c\u540c\u4e00\u4e2a IP 10 \u5206\u949f\u5185\u6709 20 \u4e2a 404 \u8bf7\u6c42\uff0c\u5c31\u5c01\u7981 12 \u5c0f\u65f6\u3002 2. \u914d\u7f6e\u5982\u679c\u540c\u4e00\u4e2a IP 10 \u5206\u949f\u5185\u6709 20 \u4e2a /login \u63a5\u53e3\u8c03\u7528\uff0c\u5c31\u5c01\u7981 12 \u4e2a\u5c0f\u65f6\u3002</p> <p>\u89c4\u5219\u5339\u914d\u914d\u7f6e\uff0c\u9700\u8981\u6ce8\u610f\u65f6\u95f4\u65f6\u95f4\u548c\u6587\u4ef6\u4fee\u6539\u65f6\u95f4\uff0c\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u65f6\u95f4\u7684\u8bdd\uff0c\u9ed8\u8ba4\u4f7f\u7528\u6587\u4ef6\u4fee\u6539\u65f6\u95f4\u6765\u505a\u5904\u7406\uff1a <pre><code># /etc/fail2ban/filter.d/nginx-404.conf\n[Definition]\nfailregex = ^{\"time\":\".*?\",\"remote_addr\":\"&lt;HOST&gt;\",.*?\"status\":404,.*?}$\n\n# \u65f6\u95f4\u6233\u914d\u7f6e\ndatestart = ^{\"time\":\"\ndatepattern = ^\"%%Y-%%m-%%dT%%H:%%M:%%S%%z\"\n\n# /etc/fail2ban/filter.d/nginx-login.conf\n[Definition]\nfailregex = ^{\"time\":\".*?\",\"remote_addr\":\"&lt;HOST&gt;\",.*?\"uri\":\"/login\",.*?}$\n\n# \u65f6\u95f4\u6233\u914d\u7f6e\ndatestart = ^{\"time\":\"\ndatepattern = ^\"%%Y-%%m-%%dT%%H:%%M:%%S%%z\"\n</code></pre></p> <p>\u76d1\u7981\u914d\u7f6e\uff1a <pre><code># /etc/fail2ban/jail.d/nginx.conf\n[nginx-404]\nenabled = true\n# \u8fd9\u91cc\u7aef\u53e3\u53f7\u9ed8\u8ba4 80,443 \u5982\u679c\u60f3\u8981\u5168\u90e8\u5c01\u7981\u76f4\u63a5 port=all\nport = http,https\nfilter = nginx-404\nlogpath = /usr/local/nginx/logs/access.json\nmaxretry = 20\nfindtime = 600\nbantime = 3600\n\n[nginx-login]\nenabled = true\nport = http,https\nfilter = nginx-login\nlogpath = /usr/local/nginx/logs/access.json\nmaxretry = 20\nfindtime = 600\nbantime = 3600\n</code></pre></p> <p>\u6d4b\u8bd5\u914d\u7f6e\uff1a <pre><code># \u914d\u7f6e\u6587\u4ef6\u662f\u5426\u6b63\u786e\nfail2ban-client --test\n\n# \u914d\u7f6e\u662f\u5426\u80fd\u6b63\u786e\u5339\u914d\nfail2ban-regex /usr/local/nginx/logs/access.json /etc/fail2ban/filter.d/nginx-404.conf \nfail2ban-regex /usr/local/nginx/logs/access.json /etc/fail2ban/filter.d/nginx-login.conf \n\n# fail2ban \u6d4b\u8bd5\u8f93\u51fa\u5339\u914d\u7684\u884c\ntail -n 1000 /usr/local/nginx/logs/access.json &gt; /tmp/test.log\nfail2ban-regex /tmp/test.log /etc/fail2ban/filter.d/nginx-404.conf --print-all-matched\n\n# grep \u6d4b\u8bd5\u8f93\u51fa\u5339\u914d\u7684\u884c\ntail -n 2000 /usr/local/nginx/logs/access.json | grep --color=always -E '^{\"time\":\".*?\",\"remote_addr\":\".*\",.*?\"status\":404,.*?}$'\n</code></pre></p> <p>\u52a0\u8f7d\u914d\u7f6e\uff1a <pre><code>fail2ban-client reload\nfail2ban-client status\n</code></pre></p> <p>\u53c2\u8003\u8fde\u63a5\uff1a 1. ssh \u767b\u5f55\u5931\u8d25\u9501\u5b9a https://zhuanlan.zhihu.com/p/597751230 2. nginx 401|403|404 \u9501\u5b9a https://www.8kiz.cn/archives/24353.html</p>"},{"location":"Operations/Linux/iptables/","title":"Iptables","text":"<p>\u67e5\u770b\u89c4\u5219\uff0c\u9ed8\u8ba4\u67e5\u770b filter \u8868\uff1a <pre><code>iptables -L -n -v --line-number\n</code></pre></p> <p>\u5220\u9664\u89c4\u5219\uff1a <pre><code>iptables -D INPUT [num]\n</code></pre></p> <p>\u63d2\u5165\u89c4\u5219\uff0c\u63d2\u5165\u5230\u7b2c\u4e94\u884c\uff0c\u53ea\u63a5\u53d7\u5efa\u7acb\u8fde\u63a5\u7684 tcp \u5305\u4e14\u7aef\u53e3\u53f7\u4e3a 18094\uff1a <pre><code>iptables -I INPUT 5 -m state --state NEW\u00a0 -p tcp\u00a0 --dport 18094\u00a0 -j ACCEPT\niptables -I INPUT 5 -m conntrack --ctstate NEW -p tcp --dport 18094 -j ACCEPT\n</code></pre></p> <p>\u4f7f\u7528 -A \u4e3a\u8ffd\u52a0\u5230\u6700\u540e\u4e00\u884c\uff0c\u4e24\u4e2a\u8bed\u53e5\u7b49\u6548\uff0c\u4e0b\u9762\u4e00\u4e2a\u66f4\u63a8\u8350\uff1a <pre><code>iptables -A INPUT -m state --state NEW\u00a0 -p tcp\u00a0 --dport 18094\u00a0 -j ACCEPT\niptables -A INPUT -m conntrack --ctstate NEW -p tcp --dport 18094 -j ACCEPT\n</code></pre></p> <p>\u5b9e\u4f8b\u5206\u6790 <pre><code># 1. \u5141\u8bb8\u5df2\u5efa\u7acb\u7684\u8fde\u63a5\u548c\u76f8\u5173\u7684\u6d41\u91cf\uff08\u653e\u884c\u8fd4\u56de\u5305\uff0c\u6bd4\u5982\u4f60\u8bbf\u95ee\u7f51\u7ad9\u540e\u7684\u54cd\u5e94\uff09\niptables -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT\n\n# \u6216\u8005\u65e7\u7248\u5199\u6cd5\uff08\u5982\u679c conntrack \u4e0d\u53ef\u7528\uff09\uff1a\niptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\n\n# 2. \u5141\u8bb8 ICMP (Ping) \u8bf7\u6c42\niptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT\n\n# \u6216\u8005\u5141\u8bb8\u6240\u6709 ICMP\uff08\u66f4\u5bbd\u677e\uff09\uff1a\niptables -A INPUT -p icmp -j ACCEPT\n\n# 3. \u5141\u8bb8\u672c\u5730\u56de\u73af\u63a5\u53e3 (lo) \u7684\u6240\u6709\u6d41\u91cf\niptables -A INPUT -i lo -j ACCEPT\n\n# 4. \u5141\u8bb8\u65b0\u7684 TCP \u8fde\u63a5\u8bbf\u95ee SSH\uff08\u7aef\u53e3 22\uff09\niptables -A INPUT -p tcp --dport 22 -m conntrack --ctstate NEW -j ACCEPT\n\n# 5. \u6dfb\u52a0\u515c\u5e95\u7b56\u7565\niptables -A INPUT -j REJECT --reject-with icmp-host-prohibited\n\n# iptables -L -n -v --line-numbers\nChain INPUT (policy ACCEPT 0 packets, 0 bytes)\nnum\u00a0\u00a0 pkts bytes target\u00a0\u00a0\u00a0\u00a0 prot opt in\u00a0\u00a0\u00a0\u00a0 out\u00a0\u00a0\u00a0\u00a0 source\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 destination\n1\u00a0\u00a0\u00a0\u00a0\u00a0 31M 5337M ACCEPT\u00a0\u00a0\u00a0\u00a0 all\u00a0 --\u00a0 *\u00a0\u00a0\u00a0\u00a0\u00a0 *\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0.0.0.0/0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0.0.0.0/0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 state RELATED,ESTABLISHED\n2\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 7\u00a0\u00a0 484 ACCEPT\u00a0\u00a0\u00a0\u00a0 icmp --\u00a0 *\u00a0\u00a0\u00a0\u00a0\u00a0 *\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0.0.0.0/0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0.0.0.0/0\n3\u00a0\u00a0\u00a0 1339K\u00a0\u00a0 80M ACCEPT\u00a0\u00a0\u00a0\u00a0 all\u00a0 --\u00a0 lo\u00a0\u00a0\u00a0\u00a0 *\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0.0.0.0/0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0.0.0.0/0\n4\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 73\u00a0 4072 ACCEPT\u00a0\u00a0\u00a0\u00a0 tcp\u00a0 --\u00a0 *\u00a0\u00a0\u00a0\u00a0\u00a0 *\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0.0.0.0/0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0.0.0.0/0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 state NEW tcp dpt:22\n\u00b7 \u00b7 \u00b7\n13\u00a0\u00a0 2864K 1098M REJECT\u00a0\u00a0\u00a0\u00a0 all\u00a0 --\u00a0 *\u00a0\u00a0\u00a0\u00a0\u00a0 *\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0.0.0.0/0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0.0.0.0/0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 reject-with icmp-host-prohibited\n\nChain FORWARD (policy ACCEPT 0 packets, 0 bytes)\nnum\u00a0\u00a0 pkts bytes target\u00a0\u00a0\u00a0\u00a0 prot opt in\u00a0\u00a0\u00a0\u00a0 out\u00a0\u00a0\u00a0\u00a0 source\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 destination\n1\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0 0 REJECT\u00a0\u00a0\u00a0\u00a0 all\u00a0 --\u00a0 *\u00a0\u00a0\u00a0\u00a0\u00a0 *\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0.0.0.0/0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0.0.0.0/0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 reject-with icmp-host-prohibited\n\nChain OUTPUT (policy ACCEPT 383K packets, 89M bytes)\nnum\u00a0\u00a0 pkts bytes target\u00a0\u00a0\u00a0\u00a0 prot opt in\u00a0\u00a0\u00a0\u00a0 out\u00a0\u00a0\u00a0\u00a0 source\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 destination\n</code></pre> \u5206\u6790\u4e00\u4e0b\u4e0a\u8ff0\u914d\u7f6e\u7684\u4fe1\u606f</p> <ol> <li>\u9ed8\u8ba4\u5c55\u793a\u7684\u662f filter \u8868\u7684\u94fe\uff0c\u5305\u542b\u4e09\u6761\u94fe\uff1aINPUT\u3001OUTPUT\u3001FORWARD</li> <li>INPUT \u4e0b\u5305\u542b 13 \u6761\u89c4\u5219\uff08\u7701\u7565\u4e86 5 \u5230 12 \u6761\u7684\u6570\u636e\uff09</li> <li>\u7b2c\u4e00\u6761\u4e3a\u63a5\u6536\u5168\u90e8\u5df2\u7ecf\u5efa\u7acb\u8fde\u63a5\u7684\u5305\u6216\u8005\u548c\u5f53\u524d\u4e3b\u673a\u53d1\u51fa\u7684\u5305\u6709\u8054\u7cfb\u7684\u5305\u3002</li> <li>\u7b2c\u4e8c\u6761\u4e3a\u63a5\u6536 icmp \u534f\u8bae\u7684\u5305\u3002</li> <li>\u7b2c\u4e09\u6761\u4e3a\u53d1\u9001\u5230\u672c\u5730\u56de\u73af\u7f51\u5361 lo \u7684\u5305\u5168\u90e8\u63a5\u53d7\u3002</li> <li>\u7b2c\u56db\u6761\u4e3a\u5efa\u7acb tcp \u8fde\u63a5\u4e14\u7aef\u53e3\u53f7\u4e3a 22 \u7684\u5305\u5168\u90e8\u63a5\u53d7\u3002</li> <li>\u7b2c\u5341\u4e09\u6761\u4e3a\u62d2\u7edd\u5168\u90e8\u7684\u5305\u3002</li> </ol> <p>\u5177\u4f53\u60c5\u51b5</p> <ol> <li>ssh \u767b\u5f55</li> </ol> <p>\u7b2c\u4e00\u6761\u4e0d\u6ee1\u8db3\uff1b\u7b2c\u4e8c\u6761\u4e0d\u6ee1\u8db3\uff1b\u7b2c\u4e09\u6761\u4e0d\u6ee1\u8db3\uff1b\u7b2c\u56db\u6761\u5efa\u7acb tcp 22 \u7aef\u53e3\u8fde\u63a5\u6ee1\u8db3\u653e\u884c\uff08\u7ed3\u675f\uff09\u3002\u5efa\u7acb\u8fde\u63a5\u4e4b\u540e\u540e\u7eed\u7684\u5305\u90fd\u6ee1\u8db3\u7b2c\u4e00\u6761\u5168\u90e8\u653e\u884c\u3002</p> <ol> <li>\u6bd4\u5982\u8bbf\u95ee 23 \u7aef\u53e3</li> </ol> <p>\u7b2c\u4e00\u6761\u4e0d\u6ee1\u8db3\uff1b------ \u6ee1\u8db3\u7b2c\u5341\u4e09\u6761\uff0c\u7b2c\u5341\u4e09\u6761\u4e3a\u4e22\u5f03\uff08\u7ed3\u675f\uff09</p> <p>\u8bbe\u7f6e\u9ed8\u8ba4\u7684\u7b56\u7565</p> <p>\u4e0a\u8ff0\u6709 13 \u6761\u89c4\u5219\uff0c\u5982\u679c\u8fdb\u6765\u7684\u5305\u90fd\u4e0d\u5339\u914d\u5168\u90e8\u7684\u5341\u4e09\u6761\u89c4\u5219\u7684\u8bdd\uff08\u4e0a\u8ff0\u7684\u6848\u4f8b\u4e2d\u4e0d\u4f1a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\uff0c\u56e0\u4e3a\u7b2c13\u6761\u89c4\u5219\u5339\u914d\u6240\u6709\u7684\u5305\u8fdb\u884c\u62d2\u7edd\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e\u9ed8\u8ba4\u7684\u7b56\u7565\u8fdb\u884c\u515c\u5e95\u3002</p> <pre><code>iptables -P INPUT DROP\n\niptables -P OUTPUT ACCEPT\n\niptables -P FORWARD ACCEPT\n</code></pre> <p>\u5b89\u88c5\u670d\u52a1 <pre><code>apt install iptables-persistent\n</code></pre></p> <p>\u624b\u52a8\u4fdd\u5b58\u3001\u6062\u590d\u89c4\u5219 <pre><code>netfilter-persistent save\niptables-restore &lt; /etc/iptables/rules.v4\n</code></pre></p> <p><code>iptables-persistent</code> \u5b83\u4f1a\u5728\u6bcf\u6b21\u7cfb\u7edf\u542f\u52a8\u65f6 \u200b\u200b\u81ea\u52a8\u6062\u590d\u4f60\u4e4b\u524d\u4fdd\u5b58\u7684\u89c4\u5219\u200b\u200b\uff0c\u65e0\u9700\u624b\u52a8\u64cd\u4f5c\u3002\u4f46\u662f\u4fdd\u5b58\u9700\u8981\u624b\u52a8\u4fdd\u5b58\u3002</p> <p>\u53c2\u8003\u8fde\u63a5\uff1a\u9e1f\u54e5\u7684 Linux \u79c1\u623f\u83dc -- Linux \u9632\u706b\u5899\u4e0e NAT \u670d\u52a1\u5668 (vbird.org)</p>"},{"location":"Operations/Linux/openvas/","title":"Openvas","text":"<p>docker compose \u6587\u4ef6 <pre><code>name: greenbone-community-edition\n\nservices:\n  vulnerability-tests:\n    image: registry.community.greenbone.net/community/vulnerability-tests\n    environment:\n      FEED_RELEASE: \"24.10\"\n    volumes:\n      - vt_data_vol:/mnt\n\n  notus-data:\n    image: registry.community.greenbone.net/community/notus-data\n    volumes:\n      - notus_data_vol:/mnt\n\n  scap-data:\n    image: registry.community.greenbone.net/community/scap-data\n    volumes:\n      - scap_data_vol:/mnt\n\n  cert-bund-data:\n    image: registry.community.greenbone.net/community/cert-bund-data\n    volumes:\n      - cert_data_vol:/mnt\n\n  dfn-cert-data:\n    image: registry.community.greenbone.net/community/dfn-cert-data\n    volumes:\n      - cert_data_vol:/mnt\n    depends_on:\n      - cert-bund-data\n\n  data-objects:\n    image: registry.community.greenbone.net/community/data-objects\n    environment:\n      FEED_RELEASE: \"24.10\"\n    volumes:\n      - data_objects_vol:/mnt\n\n  report-formats:\n    image: registry.community.greenbone.net/community/report-formats\n    environment:\n      FEED_RELEASE: \"24.10\"\n    volumes:\n      - data_objects_vol:/mnt\n    depends_on:\n      - data-objects\n\n  gpg-data:\n    image: registry.community.greenbone.net/community/gpg-data\n    volumes:\n      - gpg_data_vol:/mnt\n\n  redis-server:\n    image: registry.community.greenbone.net/community/redis-server\n    restart: on-failure\n    volumes:\n      - redis_socket_vol:/run/redis/\n\n  pg-gvm:\n    image: registry.community.greenbone.net/community/pg-gvm:stable\n    restart: on-failure\n    volumes:\n      - psql_data_vol:/var/lib/postgresql\n      - psql_socket_vol:/var/run/postgresql\n\n  gvmd:\n    image: registry.community.greenbone.net/community/gvmd:stable\n    restart: on-failure\n    volumes:\n      - gvmd_data_vol:/var/lib/gvm\n      - scap_data_vol:/var/lib/gvm/scap-data/\n      - cert_data_vol:/var/lib/gvm/cert-data\n      - data_objects_vol:/var/lib/gvm/data-objects/gvmd\n      - vt_data_vol:/var/lib/openvas/plugins\n      - psql_data_vol:/var/lib/postgresql\n      - gvmd_socket_vol:/run/gvmd\n      - ospd_openvas_socket_vol:/run/ospd\n      - psql_socket_vol:/var/run/postgresql\n    depends_on:\n      pg-gvm:\n        condition: service_started\n      scap-data:\n        condition: service_completed_successfully\n      cert-bund-data:\n        condition: service_completed_successfully\n      dfn-cert-data:\n        condition: service_completed_successfully\n      data-objects:\n        condition: service_completed_successfully\n      report-formats:\n        condition: service_completed_successfully\n\n  gsa:\n    image: registry.community.greenbone.net/community/gsa:stable\n    restart: on-failure\n    ports:\n      - 127.0.0.1:9392:80\n    volumes:\n      - gvmd_socket_vol:/run/gvmd\n    depends_on:\n      - gvmd\n  # Sets log level of openvas to the set LOG_LEVEL within the env\n  # and changes log output to /var/log/openvas instead /var/log/gvm\n  # to reduce likelyhood of unwanted log interferences\n  configure-openvas:\n    image: registry.community.greenbone.net/community/openvas-scanner:stable\n    volumes:\n      - openvas_data_vol:/mnt\n      - openvas_log_data_vol:/var/log/openvas\n    command:\n      - /bin/sh\n      - -c\n      - |\n        printf \"table_driven_lsc = yes\\nopenvasd_server = http://openvasd:80\\n\" &gt; /mnt/openvas.conf\n        sed \"s/127/128/\" /etc/openvas/openvas_log.conf | sed 's/gvm/openvas/' &gt; /mnt/openvas_log.conf\n        chmod 644 /mnt/openvas.conf\n        chmod 644 /mnt/openvas_log.conf\n        touch /var/log/openvas/openvas.log\n        chmod 666 /var/log/openvas/openvas.log\n\n  # shows logs of openvas\n  openvas:\n    image: registry.community.greenbone.net/community/openvas-scanner:stable\n    restart: on-failure\n    volumes:\n      - openvas_data_vol:/etc/openvas\n      - openvas_log_data_vol:/var/log/openvas\n    command:\n      - /bin/sh\n      - -c\n      - |\n        cat /etc/openvas/openvas.conf\n        tail -f /var/log/openvas/openvas.log\n    depends_on:\n      configure-openvas:\n        condition: service_completed_successfully\n\n  openvasd:\n    image: registry.community.greenbone.net/community/openvas-scanner:stable\n    restart: on-failure\n    environment:\n      # `service_notus` is set to disable everything but notus,\n      # if you want to utilize openvasd directly, remove `OPENVASD_MODE`\n      OPENVASD_MODE: service_notus\n      GNUPGHOME: /etc/openvas/gnupg\n      LISTENING: 0.0.0.0:80\n    volumes:\n      - openvas_data_vol:/etc/openvas\n      - openvas_log_data_vol:/var/log/openvas\n      - gpg_data_vol:/etc/openvas/gnupg\n      - notus_data_vol:/var/lib/notus\n    # enable port forwarding when you want to use the http api from your host machine\n    # ports:\n    #   - 127.0.0.1:3000:80\n    depends_on:\n      vulnerability-tests:\n        condition: service_completed_successfully\n      configure-openvas:\n        condition: service_completed_successfully\n      gpg-data:\n        condition: service_completed_successfully\n    networks:\n      default:\n        aliases:\n          - openvasd\n\n  ospd-openvas:\n    image: registry.community.greenbone.net/community/ospd-openvas:stable\n    restart: on-failure\n    hostname: ospd-openvas.local\n    cap_add:\n      - NET_ADMIN # for capturing packages in promiscuous mode\n      - NET_RAW # for raw sockets e.g. used for the boreas alive detection\n    security_opt:\n      - seccomp=unconfined\n      - apparmor=unconfined\n    command:\n      [\n        \"ospd-openvas\",\n        \"-f\",\n        \"--config\",\n        \"/etc/gvm/ospd-openvas.conf\",\n        \"--notus-feed-dir\",\n        \"/var/lib/notus/advisories\",\n        \"-m\",\n        \"666\",\n      ]\n    volumes:\n      - gpg_data_vol:/etc/openvas/gnupg\n      - vt_data_vol:/var/lib/openvas/plugins\n      - notus_data_vol:/var/lib/notus\n      - ospd_openvas_socket_vol:/run/ospd\n      - redis_socket_vol:/run/redis/\n      - openvas_data_vol:/etc/openvas/\n      - openvas_log_data_vol:/var/log/openvas\n    depends_on:\n      redis-server:\n        condition: service_started\n      gpg-data:\n        condition: service_completed_successfully\n      vulnerability-tests:\n        condition: service_completed_successfully\n      configure-openvas:\n        condition: service_completed_successfully\n\n  gvm-tools:\n    image: registry.community.greenbone.net/community/gvm-tools\n    volumes:\n      - gvmd_socket_vol:/run/gvmd\n      - ospd_openvas_socket_vol:/run/ospd\n    depends_on:\n      - gvmd\n      - ospd-openvas\n\nvolumes:\n  gpg_data_vol:\n  scap_data_vol:\n  cert_data_vol:\n  data_objects_vol:\n  gvmd_data_vol:\n  psql_data_vol:\n  vt_data_vol:\n  notus_data_vol:\n  psql_socket_vol:\n  gvmd_socket_vol:\n  ospd_openvas_socket_vol:\n  redis_socket_vol:\n  openvas_data_vol:\n  openvas_log_data_vol:\n</code></pre></p>"},{"location":"Operations/Linux/smb/","title":"Smb","text":""},{"location":"Operations/Linux/smb/#_1","title":"\u5b89\u88c5","text":"<p>\u6700\u5c0f\u5316\u5b89\u88c5\uff0c\u4ec5\u9700\u8981 smb \u6587\u4ef6\u5171\u4eab\u529f\u80fd\u3002 <pre><code>apt install --no-install-recommends samba samba-common-bin\n</code></pre></p> <p>\u5b89\u88c5\u7684\u4f9d\u8d56  </p> <ul> <li>samba \u6838\u5fc3\u7684\u5b88\u62a4\u8fdb\u7a0b\uff0c\u63d0\u4f9b smbd \u6587\u4ef6\u5171\u4eab\u670d\u52a1\u548c nmbd NetBIOS\u3002</li> <li>samba-common \u516c\u5171\u914d\u7f6e\u6587\u4ef6\u548c\u811a\u672c\u3002</li> <li>samba-common-bin \u7ba1\u7406\u547d\u4ee4\u3002</li> <li>samba-libs \u6838\u5fc3\u5e93\u3002</li> </ul> <p>\u76f8\u5173\u7684\u670d\u52a1</p> <ul> <li>smbd \u6587\u4ef6\u5171\u4eab\u6838\u5fc3\u670d\u52a1\u3002</li> <li>nmbd \u7528\u4e8e NetBIOS \u7f51\u7edc\u90bb\u5c45\u5e7f\u64ad\uff0c\u53ef\u4ee5\u505c\u7528\u3002</li> <li>winbind \u57df\u63a7/LDAP \u73af\u5883\u4f7f\u7528\u3002</li> <li>samba-ad-dc AD \u57df\u63a7\u5236\u5668\u529f\u80fd\u3002</li> <li>samba \u5305\u88c5\u670d\u52a1\uff0c\u4f1a\u540c\u65f6\u542f\u52a8\u5176\u5b83\u670d\u52a1\u3002</li> </ul> <p>\u505c\u6b62\u4e0d\u5fc5\u8981\u7684\u670d\u52a1 <pre><code>systemctl stop nmbd winbind samba-ad-dc samba\nsystemctl disable nmbd winbind samba-ad-dc samba\n</code></pre></p> <p>smbd \u9ed8\u8ba4\u4f1a\u76d1\u542c\u4e24\u4e2a\u7aef\u53e3\uff1a</p> <ul> <li>445/tcp \u73b0\u4ee3 SMB2/SMB3 \u76f4\u63a5\u4f7f\u7528\u3002</li> <li>139/tcp \u65e7 SMB1/NetBIOS \u6a21\u5f0f\u3002</li> </ul>"},{"location":"Operations/Linux/smb/#_2","title":"\u914d\u7f6e\u8fde\u63a5","text":"<p>\u914d\u7f6e\u6587\u4ef6 /etc/samba/smb.conf <pre><code>[disk1]\npath = /data/disk1\nbrowseable = yes\nwritable = yes\nguest ok = no\n\n[disk2]\npath = /data/disk2\nbrowseable = yes\nwritable = yes\nguest ok = no\n</code></pre></p>"},{"location":"Operations/Linux/smb/#_3","title":"\u72b6\u6001\u76d1\u63a7","text":"<p>smbstatus \u547d\u4ee4\u67e5\u770b\u8fde\u63a5\u72b6\u6001\u3002</p>"},{"location":"Operations/Linux/smb/#_4","title":"\u7528\u6237\u7ba1\u7406","text":"<p>\u6dfb\u52a0\u4e00\u4e2a smb \u7528\u6237</p> <ol> <li> <p>\u9996\u5148\u7cfb\u7edf\u4e2d\u8981\u5b58\u5728\u8fd9\u4e2a Linux \u7528\u6237\uff0c\u6ca1\u6709\u7684\u8bdd\u53ef\u4ee5\u65b0\u589e\u3002 <pre><code>useradd -M -s /sbin/nologin jacky\n\n-M \u4e0d\u521b\u5efa home \u76ee\u5f55\u3002\n-s /sbin/nologin \u7981\u6b62\u76f4\u63a5\u767b\u5f55\u7cfb\u7edf\u3002\n</code></pre></p> </li> <li> <p>\u6dfb\u52a0 smb \u7528\u6237\u3002 <pre><code>smbpasswd -a jacky\n</code></pre></p> </li> <li> <p>\u9a8c\u8bc1\u662f\u5426\u6dfb\u52a0\u6210\u529f\u3002 <pre><code>pdbedit -L\n</code></pre></p> </li> </ol>"},{"location":"Operations/Linux/vaultwarden%20%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/","title":"Vaultwarden \u5b89\u88c5\u914d\u7f6e","text":"<p>docker \u90e8\u7f72 <pre><code>docker run --detach --name vaultwarden \\\n  --env DOMAIN=\"https://xxxx\" \\\n  --env DATABASE_URL=postgresql://vaultwarden:password@xxxx:5432/vaultwarden \\\n  -e SMTP_HOST=smtp.qq.com \\\n  -e SMTP_FROM=xxxx@qq.com \\\n  -e SMTP_PORT=587 \\\n  -e SMTP_SECURITY=starttls \\\n  -e SMTP_USERNAME=xxxx@qq.com \\\n  -e SMTP_PASSWORD=xxxx \\\n  -e SIGNUPS_ALLOWED=false \\\n  --volume ./data/:/data/ \\\n  --restart unless-stopped \\\n  --publish 127.0.0.1:80:80 \\\n  vaultwarden/server:latest\n</code></pre> \u4f7f\u7528 PG \u6570\u636e\u5e93\uff0c\u53c2\u8003 github</p> <p>\u53d6\u6d88\u6ce8\u518c</p> <p>nginx https \u4ee3\u7406 <pre><code>openssl genrsa -out root.key 4096\n\nopenssl req -new -x509 -key root.key -sha256 -days 3650 -out root.crt \\\n  -subj \"/C=CN/ST=Shanghai/L=Shanghai\"\n\n\nopenssl req -new -newkey rsa:2048 -nodes -keyout vaultwarden.key -out vaultwarden.csr \\\n  -subj \"/C=CN/ST=Shanghai/L=Shanghai\"\n\nopenssl x509 -req -in vaultwarden.csr -CA root.crt -CAkey root.key -CAcreateserial \\\n  -out vaultwarden.crt -days 3650 -sha256 \\\n  -extfile &lt;(printf \"basicConstraints=CA:FALSE\\nkeyUsage=digitalSignature,keyEncipherment\\nextendedKeyUsage=serverAuth\\nsubjectAltName=DNS:localhost,IP:127.0.0.1,IP:xxxx\")\n</code></pre></p> <p>\u6d4f\u89c8\u5668\u5b89\u88c5\u63d2\u4ef6</p>"},{"location":"Operations/Linux/%E5%AE%89%E8%A3%85%20NFS/","title":"\u5b89\u88c5 NFS","text":"<p>\u5b89\u88c5 <pre><code>apt install nfs-kernel-server\nsystemctl enable nfs-kernel-server --now\n</code></pre></p> <p>\u914d\u7f6e <pre><code># vim /etc/exports\n# cat /etc/exports \n/data/disk1 *(rw,sync,no_subtree_check,insecure,fsid=0)\n</code></pre> 1. <code>fsid=0</code>\u200b\u200b\uff1a\u7ed5\u8fc7 macOS \u5bf9\u6587\u4ef6\u7cfb\u7edf\u8fb9\u754c\u7684\u4e25\u683c\u6821\u9a8c\uff0c\u907f\u514d\u56e0\u8def\u5f84\u5c42\u7ea7\u5bfc\u81f4\u7684\u6302\u8f7d\u5931\u8d25\u3002 2. \u200b\u200b<code>insecure</code>\u200b\u200b\uff1a\u5141\u8bb8 macOS \u4f7f\u7528\u975e\u7279\u6743\u7aef\u53e3\u8fde\u63a5\uff0c\u89e3\u51b3\u00a0<code>Operation not permitted</code>\u00a0\u9519\u8bef\u3002</p> <p>\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u76ee\u5f55 <pre><code>exportfs -ra\n</code></pre> - \u200b\u200b<code>exportfs</code>\u200b\u200b: NFS \u670d\u52a1\u7684\u7ba1\u7406\u5de5\u5177\uff0c\u7528\u4e8e\u63a7\u5236\u5bfc\u51fa\u7684\u5171\u4eab\u76ee\u5f55\u3002 - \u200b\u200b<code>-r</code>\u200b\u200b: \u91cd\u65b0\u5bfc\u51fa\uff08re-export\uff09\u6240\u6709\u5728\u00a0<code>/etc/exports</code>\u00a0\u4e2d\u5b9a\u4e49\u7684\u5171\u4eab\u76ee\u5f55\u3002 - \u200b\u200b<code>-a</code>\u200b\u200b: \u5bf9\u6240\u6709\u5171\u4eab\u76ee\u5f55\u8fdb\u884c\u64cd\u4f5c\uff08\u5305\u62ec\u5bfc\u51fa\u548c\u53d6\u6d88\u5bfc\u51fa\uff09\u3002</p> <p>\u7ec4\u5408\u00a0<code>-ra</code>\u00a0\u8868\u793a\uff1a\u200b\u200b\u91cd\u65b0\u52a0\u8f7d\u00a0<code>/etc/exports</code>\u00a0\u4e2d\u7684\u6240\u6709\u914d\u7f6e\uff0c\u7acb\u5373\u751f\u6548\u200b\u200b\u3002</p>"},{"location":"Operations/Linux/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/","title":"\u5b9a\u65f6\u4efb\u52a1","text":"<p>Linux \u6709\u4e24\u79cd\u65b9\u5f0f\u8bbe\u7f6e\u5b9a\u65f6\u4efb\u52a1\uff0c\u5206\u522b\u662f\u4f7f\u7528 crontab \u547d\u4ee4\u548c Systemd timer\u3002</p>"},{"location":"Operations/Linux/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/#crontab","title":"crontab","text":"<p><code>crontab</code> \u64cd\u4f5c\u7684\u5b9a\u65f6\u4efb\u52a1\u662f\u7531 <code>cron(crond)</code> \u8fd9\u4e2a\u7cfb\u7edf\u670d\u52a1\u6765\u63a7\u5236\u7684\uff0c\u8be5\u670d\u52a1\u662f\u9ed8\u8ba4\u542f\u52a8\u7684\u3002</p>"},{"location":"Operations/Linux/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/#crontab_1","title":"crontab \u7684\u8bed\u6cd5","text":"<p><pre><code>crontab [-u username] [-l|-e|-r]\n\u9009\u9879\u4e0e\u53c2\u6570\uff1a\n-u : \n-e : \u7f16\u8f91 crontab \u7684\u5de5\u4f5c\u5185\u5bb9\n-l : \u67e5\u770b crontab \u7684\u5de5\u4f5c\u5185\u5bb9\n-r : \u79fb\u9664\u6240\u6709\u7684 crontab \u7684\u5de5\u4f5c\u5185\u5bb9\uff0c\u82e5\u8981\u4ec5\u79fb\u9664\u4e00\u9879\uff0c\u4f7f\u7528 -e \u8fdb\u884c\u7f16\u8f91\u3002\n</code></pre> \u4f7f\u7528 <code>crontab -e</code> \u547d\u4ee4\u4f1a\u6253\u5f00\u4e00\u4e2a\u7f16\u8f91\u5668\uff0c\u5efa\u7acb\u5b9a\u65f6\u4efb\u52a1\uff0c\u5177\u4f53\u7684\u914d\u7f6e\u5185\u5bb9\u4f1a\u88ab\u8bb0\u5f55\u5230 <code>/var/spool/cron/</code> \u8fd9\u4e2a\u76ee\u5f55\u4e0b\u9762\uff0c\u800c\u4e14\u662f\u4ee5\u8d26\u53f7\u6765\u4f5c\u4e3a\u533a\u5206\u7684\u3002</p> <p>\u5177\u4f53\u6765\u8bf4\uff0c\u5982\u679c root \u7528\u6237\u4f7f\u7528 <code>crontab -e</code> \u547d\u4ee4\uff0c\u6dfb\u52a0\u4e86\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\uff1a <pre><code>* * * * * echo \"hello world!\" &gt;&gt; ~/cron.log\n</code></pre> \u90a3\u4e48\u8fd9\u4e2a\u4efb\u52a1\u7684\u7684\u914d\u7f6e\u4fe1\u606f\u4e5f\u5c31\u662f\u4e0a\u9762\u7684\u5185\u5bb9\u4f1a\u4fdd\u5b58\u5728 <code>/var/spool/cron/root</code> \u8fd9\u4e2a\u6587\u4ef6\u4e2d\uff0c\u800c\u5177\u4f53\u7684\u4efb\u52a1\u662f\u6bcf\u4e00\u5206\u949f\u90fd\u4f1a\u5f80 <code>/root/cron.log</code> \u8ffd\u52a0\u4e00\u884c <code>hello world!</code> \u6587\u672c\u3002</p>"},{"location":"Operations/Linux/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/#crontab_2","title":"crontab \u7684\u914d\u7f6e","text":"<p>crontab \u7684\u914d\u7f6e\u6309\u884c\u533a\u5206\uff0c\u6bcf\u4e00\u884c\u90fd\u662f\u4e00\u4e2a\u65b0\u7684\u5b9a\u65f6\u4efb\u52a1\u3002\u6bcf\u884c\u6709\u516d\u4e2a\u5b57\u6bb5\uff0c\u8fd9\u516d\u4e2a\u5b57\u6bb5\u7684\u610f\u4e49\u4e3a\uff1a</p> \u4ee3\u8868\u610f\u4e49 \u5206\u949f \u5c0f\u65f6 \u5929 \u6708 \u5468 \u6307\u4ee4 \u6570\u5b57\u8303\u56f4 0-59 0-23 1-31 1-12 0-7 \u6267\u884c\u7684\u6307\u4ee4 <p>\u9700\u8981\u6ce8\u610f\u201c\u5468\u201d\u7684\u503c\u4e3a <code>0</code> \u6216\u8005 <code>7</code> \u65f6\uff0c\u90fd\u4ee3\u8868\u201c\u661f\u671f\u5929\u201d\u7684\u610f\u601d\uff01\u53e6\u5916\u8fd8\u6709\u4e00\u4e9b\u8f85\u52a9\u5b57\u7b26\uff0c\u5982\u4e0b\uff1a</p> \u7279\u6b8a\u5b57\u7b26 \u4ee3\u8868\u610f\u601d * \u4ee3\u8868\u4efb\u4f55\u65f6\u523b\u90fd\u63a5\u53d7\u7684\u610f\u601d\uff01 , \u4ee3\u8868\u5206\u9694\u65f6\u6bb5\u7684\u610f\u601d\u3002\u6bd4\u5982\u8981\u4e0b\u8fbe\u7684\u5de5\u4f5c\u662f 3:00 \u4e0e 6:00 \u6267\u884c\u65f6\uff0c\u5c31\u4f1a\u662f <code>0 3,6 * * * command</code>\u3002 - \u4ee3\u8868\u4e00\u6bb5\u65f6\u95f4\u8303\u56f4\u3002\u6bd4\u5982\u8981\u4e0b\u8f7d\u7684\u5de5\u4f5c\u662f 8 \u70b9\u5230 12 \u70b9\u4e4b\u95f4\u7684\u6bcf\u5c0f\u65f6 20 \u5206\u949f\u90fd\u6267\u884c\u4e00\u6b21\uff0c\u5c31\u4f1a\u662f <code>20 8-12 * * * command</code>\u3002 /n n \u4ee3\u8868\u6570\u5b57\uff0c\u8868\u793a\u201c\u6bcf\u9694 n \u5355\u4f4d\u95f4\u9694\u201d\u7684\u610f\u601d\uff0c\u4f8b\u5982\u6bcf 5 \u5206\u949f\u8fdb\u884c\u4e00\u6b21\uff0c\u5c31\u4f1a\u662f\uff1a<code>*/5 * * * * command</code>\u3002 <p>\u51e0\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff1a 1. \u6bcf\u5c0f\u65f6\u7684\u7b2c 3 \u548c\u7b2c 15 \u5206\u6267\u884c\u3002 <pre><code>3,15 * * * * command\n</code></pre> 2. \u6bcf\u6708 1\u300110\u300122 \u65e5\u7684 4:25 \u5206\u6267\u884c\u3002 <pre><code>25 4 1,10,22 * * command\n</code></pre></p>"},{"location":"Operations/Linux/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/#_1","title":"\u7cfb\u7edf\u7ea7\u7684\u5b9a\u65f6\u4efb\u52a1","text":"<p>\u524d\u9762\u4ecb\u7ecd\u7684 <code>crontab -e</code> \u548c <code>/var/spool/cron/</code> \u662f\u914d\u7f6e\u548c\u5b58\u50a8\u7528\u6237\u76f8\u5173\u7684\u5b9a\u65f6\u4efb\u52a1\u7684\uff0c\u90a3\u4e48\u5982\u679c\u662f\u7cfb\u7edf\u7ea7\u522b\u7684\u5b9a\u65f6\u4efb\u52a1\u76f4\u63a5\u7f16\u8f91 <code>/etc/crontab</code> \u8fd9\u4e2a\u6587\u4ef6\u5c31\u884c\u4e86\u3002</p> <p>\u7531\u4e8e <code>cron</code> \u670d\u52a1\u7684\u6700\u4f4e\u4fa6\u6d4b\u9650\u5236\u662f <code>1</code> \u5206\u949f\uff0c\u6240\u4ee5 <code>cron</code> \u4f1a\u6bcf\u5206\u949f\u8bfb\u53d6\u4e00\u6b21 <code>/etc/crontab</code> \u6587\u4ef6\u4e0e <code>/var/spool/cron/</code> \u76ee\u5f55\u4e0b\u7684\u5185\u5bb9\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\uff0c<code>cron</code> \u9884\u8bbe\u6709\u4e09\u4e2a\u5730\u65b9\u4f1a\u6709\u6267\u884c\u811a\u672c\u914d\u7f6e\u6587\u4ef6\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>/etc/crontab</li> <li>/etc/cron.d/*</li> <li>/var/spool/cron/*</li> </ul> <p>\u5728\u8fd9\u4e09\u4e2a\u5730\u65b9\u4e2d\uff0c\u8ddf\u7cfb\u7edf\u8fd0\u4f5c\u6bd4\u8f83\u6709\u5173\u7cfb\u7684\u4e24\u4e2a\u914d\u7f6e\u662f\u653e\u5728 /etc/crontab \u6587\u4ef6\u5185\u4ee5\u53ca /etc/cron.d/* \u76ee\u5f55\u5185\u7684\u6587\u4ef6\uff0c\u53e6\u5916\u4e00\u4e2a\u5c31\u662f\u8ddf\u7528\u6237\u81ea\u5df1\u7684\u5de5\u4f5c\u6bd4\u8f83\u76f8\u5173\u7684\u914d\u7f6e\u4e86\u3002</p>"},{"location":"Operations/Linux/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/#_2","title":"\u9700\u8981\u6ce8\u610f\u7684","text":""},{"location":"Operations/Linux/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/#_3","title":"\u8d44\u6e90\u5206\u914d\u4e0d\u5747\u7684\u95ee\u9898","text":"<p>\u5f53\u5927\u91cf\u4f7f\u7528 <code>crontab</code> \u7684\u65f6\u5019\uff0c\u5982\u679c\u6bcf\u4e00\u4e2a\u6d41\u7a0b\u90fd\u5728\u540c\u4e00\u4e2a\u65f6\u95f4\u70b9\u542f\u52a8\u7684\u8bdd\uff0c\u90a3\u4e48\u5728\u8fd9\u4e2a\u65f6\u95f4\u70b9\u4ee5\u53ca\u4e4b\u540e\u7684\u4e00\u6bb5\u65f6\u95f4\u8303\u56f4\u5185\uff0c\u7cfb\u7edf\u4f1a\u53d8\u5f97\u76f8\u5f53\u7e41\u5fd9\u3002\u6211\u4eec\u5e94\u5f53\u907f\u514d\u8fd9\u79cd\u95ee\u9898\uff0c\u5c3d\u91cf\u4f7f\u7528\u201c,\u201d\u6765\u9519\u5f00 \u5927\u91cf\u7684\u4efb\u52a1\u3002</p>"},{"location":"Operations/Linux/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/#_4","title":"\u5468\u4e0e\u65e5\u6708\u4e0d\u53ef\u540c\u65f6\u5e76\u5b58","text":"<p>\u53ef\u4ee5\u5206\u522b\u4ee5\u5468\u6216\u8005\u65e5\u6708\u4e3a\u5355\u4f4d\u4f5c\u4e3a\u5faa\u73af\uff0c\u4f46\u662f\u4e0d\u53ef\u4ee5\u4f7f\u7528\u201c\u51e0\u6708\u51e0\u65e5\u5e76\u4e14\u662f\u661f\u671f\u51e0\u201d\u7684\u6a21\u5f0f\u3002\u5e94\u8be5\u4e5f\u5c3d\u91cf\u907f\u514d\u8fd9\u79cd\u590d\u6742\u7684\u6a21\u5f0f\u3002</p>"},{"location":"Operations/Linux/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/#systemd-timer","title":"Systemd timer","text":"<p>\u5f85\u7eed\u00b7\u00b7\u00b7</p> <p></p>"},{"location":"Operations/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/","title":"\u6587\u4ef6\u7cfb\u7edf","text":""},{"location":"Operations/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#_1","title":"\u6587\u4ef6\u5c5e\u6027","text":"<p><code>ls</code> \u547d\u4ee4\u5e38\u7528\u7684\u9009\u9879\u5982\u4e0b\uff1a <pre><code>ls - list directory contents\n       -a, --all\n              do not ignore entries starting with .\n       -h, --human-readable\n              with -l and -s, print sizes like 1K 234M 2G etc.\n       -i, --inode\n              print the index number of each file\n       -l     use a long listing format\n       -S     sort by file size, largest first\n       -t     sort by time, newest first; see --time\n</code></pre></p> <p>\u4f7f\u7528 <code>ls -al</code> \u547d\u4ee4\uff0c\u8f93\u5165\u5982\u4e0b\uff0c\u4ee5\u6700\u540e\u4e00\u884c\u6587\u4ef6 <code>logcli-linux-amd64.zip</code> \u4e3a\u4f8b\u4ecb\u7ecd\u8f93\u51fa\u5305\u62ec\u7684\u51e0\u4e2a\u90e8\u5206\u3002 <pre><code>root@suomea08:~# ls -la\ntotal 964136\ndrwx------  3 root root      4096 Jun 28 22:48 .\ndrwxr-xr-x 20 root root      4096 May 14 21:31 ..\n-rw-------  1 root root      9428 Jun 24 23:20 .bash_history\n-rw-r--r--  1 root root       571 Apr 11  2021 .bashrc\n-rw-r--r--  1 root root 194042837 May 14 21:13 jdk-8u202-linux-x64.tar.gz\n-rw-r--r--  1 root root  16554943 Jun 24 15:15 logcli-linux-amd64.zip\n\u2026\u2026\n</code></pre></p>"},{"location":"Operations/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#_2","title":"\u6587\u4ef6\u7c7b\u578b\u548c\u6743\u9650","text":"<p><code>-rw-r--r--</code></p>"},{"location":"Operations/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#_3","title":"\u7b2c\u4e00\u4e2a\u5b57\u7b26\u8868\u793a\u6587\u4ef6\u7684\u7c7b\u578b","text":"<ul> <li><code>d</code> \u8868\u793a\u76ee\u5f55\u3002</li> <li><code>-</code> \u8868\u793a\u6587\u4ef6\u3002</li> <li><code>l</code> \u8868\u793a\u94fe\u63a5\u6587\u4ef6\u3002</li> <li><code>b</code> \u8868\u793a\u8bbe\u5907\u6587\u4ef6\u91cc\u9762\u7684\u53ef\u4f9b\u5b58\u50a8\u7684\u63a5\u53e3\u8bbe\u5907\uff0c\u5982\u78c1\u76d8\uff08\u53ef\u4f7f\u7528 <code>ls -l /dev/sd*</code> \u9a8c\u8bc1\uff09\u3002</li> <li><code>c</code> \u8868\u793a\u8bbe\u5907\u6587\u4ef6\u91cc\u9762\u7684\u4e32\u884c\u7aef\u53e3\u8bbe\u5907\uff0c\u5982\u952e\u9f20\u3002</li> </ul>"},{"location":"Operations/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#_4","title":"\u6587\u4ef6\u7684\u6743\u9650","text":"<p>\u63a5\u4e0b\u6765\u7684\u5b57\u7b26\u4e2d\uff0c\u4ee5\u4e09\u4e2a\u4e3a\u4e00\u7ec4\uff0c\u4e14\u5747\u4e3a <code>[rwx]</code> \u7684\u4e09\u4e2a\u53c2\u6570\u7684\u7ec4\u5408\u3002\u8fd9\u4e2a\u4e09\u6743\u9650\u7684\u4f4d\u7f6e\u4e0d\u4f1a\u6539\u53d8\uff0c\u5982\u679c\u6ca1\u6709\u5bf9\u5e94\u7684\u6743\u9650\uff0c\u5c31\u4f1a\u51fa\u73b0\u51cf\u53f7 <code>-</code>\u3002</p> <p>\u5bf9\u4e8e\u6587\u6587\u4ef6\u6765\u8bf4\uff1a</p> <ul> <li><code>r</code> \u4ee3\u8868\u53ef\u8bfb\u3002</li> <li><code>w</code> \u4ee3\u8868\u53ef\u5199\uff0c\u4f46\u4e0d\u5305\u542b\u5220\u9664\u8be5\u6587\u4ef6\u3002</li> <li><code>x</code> \u8be5\u8868\u8be5\u6587\u4ef6\u5177\u6709\u53ef\u4ee5\u88ab\u7cfb\u7edf\u6267\u884c\u7684\u6743\u9650\u3002 </li> </ul> <p>\u5bf9\u76ee\u5f55\u6765\u8bf4\uff1a</p> <ul> <li><code>r</code> read contents in directory\uff0c\u8868\u793a\u8bfb\u53d6\u76ee\u5f55\u7ed3\u6784\u7684\u6743\u9650\uff0c\u53ef\u4ee5\u67e5\u8be2\u8be5\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u540d\u6570\u636e\u3002</li> <li><code>w</code> modify contents of directory\uff0c\u8868\u793a\u5177\u6709\u4fee\u6539\u76ee\u5f55\u7ed3\u6784\u5217\u8868\u7684\u6743\u9650\uff0c\u5305\u62ec\u4e00\u4e0b\u90e8\u5206\uff1a<ul> <li>\u5efa\u7acb\u65b0\u7684\u6587\u4ef6\u548c\u76ee\u5f55\u3002</li> <li>\u5220\u9664\u5df2\u7ecf\u5b58\u5728\u7684\u6587\u4ef6\u548c\u76ee\u5f55\uff0c\u4e0d\u8bba\u8be5\u6587\u4ef6\u548c\u76ee\u5f55\u7684\u6743\u9650\u5982\u4f55\u3002</li> <li>\u5c06\u5df2\u7ecf\u5b58\u5728\u7684\u6587\u4ef6\u6216\u76ee\u5f55\u8fdb\u884c\u66f4\u540d\u3002</li> <li>\u642c\u79fb\u8be5\u76ee\u5f55\u5185\u7684\u6587\u4ef6\u3001\u76ee\u5f55\u4f4d\u7f6e\u3002</li> </ul> </li> <li><code>x</code> access directory\uff0c\u8868\u793a\u80fd\u591f\u8fdb\u5165\u8be5\u76ee\u5f55\u6210\u4e3a\u5de5\u4f5c\u76ee\u5f55\u3002</li> </ul> <p>\u6bcf\u4e2a\u6587\u4ef6\u90fd\u53ef\u4ee5\u5bf9\u62e5\u6709\u8005\u3001\u6240\u5c5e\u7fa4\u7ec4\u548c\u5176\u4ed6\u4eba\u4e09\u4e2a\u89d2\u8272\u5206\u522b\u8bbe\u7f6e\u6743\u9650\u3002  </p> <ul> <li>\u7b2c\u4e00\u7ec4\u4e3a\u6587\u4ef6\u62e5\u6709\u8005\u53ef\u5177\u5907\u7684\u6743\u9650\u3002</li> <li>\u7b2c\u4e8c\u7ec4\u4e3a\u52a0\u5165\u6b64\u7fa4\u7ec4\u8d26\u53f7\u7684\u6743\u9650\u3002</li> <li>\u7b2c\u4e09\u7ec4\u4e3a\u975e\u672c\u4eba\u4e14\u6ca1\u6709\u52a0\u5165\u672c\u7fa4\u7ec4\u7684\u5176\u4ed6\u8d26\u53f7\u7684\u6743\u9650\u3002</li> </ul>"},{"location":"Operations/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#_5","title":"\u89d2\u8272\u5c5e\u6027\u4ecb\u7ecd","text":""},{"location":"Operations/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#_6","title":"\u94fe\u63a5","text":""},{"location":"Operations/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#_7","title":"\u62e5\u6709\u8005\u548c\u6240\u5c5e\u7fa4\u7ec4","text":""},{"location":"Operations/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#_8","title":"\u6587\u4ef6\u5927\u5c0f","text":""},{"location":"Operations/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#_9","title":"\u65e5\u671f","text":""},{"location":"Operations/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#_10","title":"\u6587\u4ef6\u540d","text":""},{"location":"Operations/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#ls","title":"LS \u53c2\u6570","text":""},{"location":"Operations/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#_11","title":"\u6587\u4ef6\u548c\u76ee\u5f55","text":""},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/","title":"ntp #Linux","text":""},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#_1","title":"\u65f6\u949f\u548c\u65f6\u533a","text":"<p>\u5730\u7403\u4e00\u5708\u662f 360 \u5ea6\u89d2\uff0c\u5171\u5212\u5206\u4e3a 24 \u548c\u65f6\u533a\uff0c\u4e00\u4e2a\u65f6\u533a\u5c31\u662f 15 \u5ea6\u89d2\u3002</p>"},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#gmt","title":"GMT","text":"<p>\u683c\u6797\u5a01\u6cbb\u65f6\u95f4\uff08Greewich Mean Time\uff0cGMT \u65f6\u95f4\uff09\u6807\u51c6\uff0c\u662f\u57fa\u4e8e\u592a\u9633\u901a\u8fc7\u683c\u6797\u5a01\u6cbb\u5929\u6587\u53f0\u5b50\u5348\u7ebf\u7684\u5e73\u5747\u4f4d\u7f6e\u6765\u5b9a\u4e49\u7684\uff0c\u662f\u4e00\u4e2a\u5929\u6587\u5b66\u4e0a\u7684\u6982\u5ff5\u3002</p> <p>\u5728 1880 \u5e74\u4ee3\u4e4b\u524d\u7684\u65f6\u95f4\u6807\u51c6\u662f\u4ee5 GMT \u65f6\u95f4\u4e3a\u4e3b\uff0c\u7136\u800c\u5730\u7403\u7684\u81ea\u8f6c\u8f68\u9053\u4e00\u4e2a\u516c\u8f6c\u8f68\u9053\u5e76\u975e\u6b63\u5706\uff0c\u52a0\u4e0a\u5730\u7403\u7684\u81ea\u8f6c\u901f\u5ea6\u6709\u9010\u5e74\u51cf\u5c11\u7684\u95ee\u9898\uff0c\u5bfc\u81f4\u6709\u7cbe\u5ea6\u95ee\u9898\u3002</p>"},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#utc","title":"UTC","text":"<p>UTC\uff08Coordinated Universal Time\uff09\u6807\u51c6\u4f7f\u7528\u539f\u5b50\u949f\u7684\u9707\u8361\u6765\u6d4b\u91cf\u65f6\u95f4\uff0c\u786e\u4fdd\u66f4\u9ad8\u7684\u7cbe\u5ea6\uff0cUTC \u662f\u56fd\u9645\u901a\u7528\u6807\u51c6\u3002</p> <p>\u4f7f\u7528\u539f\u5b50\u9707\u8361\u5468\u671f\u53ca\u65f6\u7684\u7269\u7406\u65f6\u949f\u4e5f\u88ab\u79f0\u4e3a\u539f\u5b50\u949f\uff08Automic Clock\uff09\u3002\u4e8b\u5b9e\u4e0a\u5728\u6211\u4eec\u8eab\u8fb9\u5c31\u6709\u5f88\u591a\u539f\u5b50\u949f\uff0c\u4f8b\u5982\uff0c\u77f3\u82f1\u8868\u3001\u4e3b\u677f\u4e0a\u7684\u7269\u7406\u65f6\u949f\u3002</p> <p>\u7531\u4e8e\u5730\u7403\u81ea\u8f6c\u51cf\u7f13\uff0cUTC \u5f15\u5165\u4e86\u95f0\u79d2\u6765\u4fdd\u6301\u4e0e\u5730\u7403\u81ea\u8f6c\u540c\u6b65\u3002\u8fd9\u4f7f\u5f97 UTC \u7684\u79d2\u6570\u53ef\u80fd\u4f1a\u4e0d\u89c4\u5f8b\u5730\u589e\u52a0\u4e00\u79d2\uff0c\u4ee5\u786e\u4fdd\u4e0e\u5730\u7403\u7684\u5b9e\u9645\u81ea\u8f6c\u540c\u6b65\u3002</p>"},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#rtc","title":"RTC","text":"<p>\u786c\u4ef6\u65f6\u949f\uff0cReal Time Clock\u3002\u7531\u7269\u7406\u5c42\u9762\u7684\u4e3b\u677f\u4e0a\u7535\u6c60\u4f9b\u7535\u7684\u65f6\u949f\uff0c\u8be5\u786c\u4ef6\u65f6\u949f\u53ef\u4ee5\u5728 BIOS \u4e2d\u8fdb\u884c\u8bbe\u7f6e\u3002</p>"},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#_2","title":"\u7cfb\u7edf\u65f6\u949f","text":"<p>\u7cfb\u7edf\u65f6\u949f\uff0cSystem Clock\u3002Linux \u5185\u6838\u4e2d\u7684\u65f6\u949f\uff0c\u5f53 Linux \u7cfb\u7edf\u542f\u52a8\u65f6\uff0c\u6839\u636e\u786c\u4ef6\u65f6\u949f\u548c /etc/adjtime \u4e2d\u7684\u5185\u5bb9\u6765\u8ba1\u7b97\u7cfb\u7edf\u65f6\u949f\u7684\u521d\u59cb\u503c\uff0c\u542f\u52a8\u5b8c\u6210\u540e\uff0c\u7cfb\u7edf\u65f6\u949f\u72ec\u7acb\u4e8e\u786c\u4ef6\u65f6\u949f\u8fd0\u884c\u3002</p>"},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#timedatectl","title":"timedatectl","text":"<p>\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b Linux \u7cfb\u7edf\u5185\u7684\u65f6\u95f4\u8bbe\u7f6e\u3002 <pre><code>timedatectl status\n</code></pre></p> <p>\u8fd4\u56de\u7684\u7ed3\u679c\u5982\u4e0b\u6240\u793a\u80fd\u591f\u67e5\u770b\u672c\u5730\u65f6\u95f4\uff08China Standard Time\uff0c\u4e2d\u56fd\u6807\u51c6\u65f6\u95f4 CST\uff09\u3001\u534f\u8c03\u4e16\u754c\u65f6\u3001<code>RTC</code> \u65f6\u95f4\u4ee5\u53ca\u65f6\u533a\u7b49\u4fe1\u606f\u3002 <pre><code>Local time: Sun 2024-02-18 20:19:51 CST\nUniversal time: Sun 2024-02-18 12:19:51 UTC\nRTC time: Sun 2024-02-18 12:19:51\nTime zone: Asia/Shanghai (CST, +0800)\nSystem clock synchronized: yes\nNTP service: active\nRTC in local TZ: no\n</code></pre></p>"},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#ntp","title":"NTP","text":"<p>\u7f51\u7edc\u65f6\u95f4\u534f\u8bae <code>Network Time Protocol</code>\uff0c\u662f <code>TCP/IP</code> \u534f\u8bae\u65cf\u91cc\u9762\u7684\u4e00\u4e2a\u5e94\u7528\u5c42\u534f\u8bae\uff0c\u7528\u6765\u4f7f\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u8fdb\u884c\u65f6\u949f\u540c\u6b65\uff0c\u63d0\u4f9b\u9ad8\u7cbe\u5ea6\u7684\u65f6\u95f4\u77eb\u6b63\u3002<code>NTP</code> \u4f7f\u7528 <code>UDP</code> \u62a5\u6587\u8fdb\u884c\u4f20\u8f93\u6570\u636e\uff0c\u4f7f\u7528\u7684\u7aef\u53e3\u53f7\u4e3a <code>123</code>\u3002 </p>"},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#ntp_1","title":"NTP \u5c42\u7ea7","text":"<p>NTP \u5141\u8bb8\u5ba2\u6237\u7aef\u4ece\u670d\u52a1\u5668\u8bf7\u6c42\u548c\u63a5\u6536\u65f6\u95f4\uff0c\u800c\u670d\u52a1\u5668\u4ece\u6743\u5a01\u65f6\u949f\u6e90\uff08\u5982\u539f\u5b50\u949f\u3001GPS\uff09\u63a5\u6536\u7cbe\u786e\u7684\u534f\u8c03\u4e16\u754c\u65f6 UTC\u3002</p> <p>NTP \u4ee5\u5c42\u7ea7\u6765\u7ec4\u7ec7\u6a21\u578b\u7ed3\u6784\uff0c\u5c42\u7ea7\u4e2d\u7684\u6bcf\u5c42\u88ab\u79f0\u4e3a <code>Stratum</code>\u3002</p> <p>\u901a\u5e38\u5c06\u4ece\u6743\u5a01\u65f6\u949f\u83b7\u5f97\u65f6\u949f\u540c\u6b65\u7684 NTP \u670d\u52a1\u5668\u7684\u5c42\u6570\u8bbe\u7f6e\u4e3a <code>Stratum 1</code>\uff0c\u5e76\u5c06\u5176\u4f5c\u4e3a\u4e3b\u65f6\u95f4\u670d\u52a1\u5668\uff0c\u4e3a\u7f51\u7edc\u4e2d\u5176\u4ed6\u7684\u8bbe\u7f6e\u63d0\u4f9b\u65f6\u949f\u540c\u6b65\u3002</p> <p><code>Stratum 2</code> \u5219\u4ece <code>Stratum 1</code> \u83b7\u53d6\u65f6\u95f4\uff0c<code>Stratum 3</code> \u4ece <code>Stratum 2</code> \u83b7\u53d6\u65f6\u95f4\u4ee5\u6b64\u7c7b\u63a8\u3002</p> <p>\u65f6\u949f\u5c42\u6570\u7684\u53d6\u503c\u8303\u56f4\u4e3a 1~16\uff0c\u53d6\u503c\u8d8a\u5c0f\u51c6\u786e\u5ea6\u8d8a\u9ad8\u3002\u5c42\u6570\u4e3a 1~15 \u7684\u65f6\u949f\u5904\u4e8e\u540c\u6b65\u72b6\u6001\uff0c\u5c42\u6570\u4e3a 16 \u7684\u65f6\u949f\u88ab\u8ba4\u4e3a\u662f\u672a\u540c\u6b65\u7684\uff0c\u4e0d\u80fd\u4f7f\u7528\u7684\u3002 </p>"},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#ntp_2","title":"NTP \u540c\u6b65\u539f\u7406","text":"<p>NTP \u6700\u5178\u578b\u7684\u6388\u65f6\u65b9\u5f0f\u662f Client/Server \u6a21\u5f0f\uff0c\u5982\u56fe\u3002  C/S \u62a5\u6587\u6d41\u7a0b\uff1a 1. \u5ba2\u6237\u7aef\u9996\u5148\u5411\u670d\u52a1\u7aef\u53d1\u9001\u4e00\u4e2a NTP \u62a5\u6587\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u8be5\u62a5\u6587\u79bb\u5f00\u5ba2\u6237\u7aef\u7684\u65f6\u95f4\u6233 <code>t1</code>\u3002</p> <ol> <li> <p>NTP \u8bf7\u6c42\u62a5\u6587\u5230\u8fbe NTP \u670d\u52a1\u5668\uff0c\u6b64\u65f6 NTP \u670d\u52a1\u5668\u7684\u65f6\u523b\u4e3a <code>t2</code>\u3002\u5f53\u670d\u52a1\u7aef\u63a5\u6536\u5230\u8be5\u62a5\u6587\u65f6\uff0cNTP \u670d\u52a1\u5668\u5904\u7406\u4e4b\u540e\uff0c\u4e8e <code>t3</code> \u65f6\u523b\u53d1\u51fa NTP \u5e94\u7b54\u62a5\u6587\u3002\u8be5\u5e94\u7b54\u62a5\u6587\u4e2d\u643a\u5e26 NTP \u5ba2\u6237\u7aef\u7684\u65f6\u95f4\u6233 <code>t1</code>\u3001\u5230\u8fbe NTP \u670d\u52a1\u5668\u7684\u65f6\u95f4\u6233 <code>t2</code> \u548c\u79bb\u5f00 NTP \u670d\u52a1\u5668\u7684\u65f6\u95f4\u6233 <code>t3</code>\u3002</p> </li> <li> <p>\u5ba2\u6237\u7aef\u5728\u63a5\u6536\u5230\u76f8\u5e94\u62a5\u6587\u65f6\uff0c\u8bb0\u5f55\u65f6\u95f4\u6233 <code>t4</code>\u3002</p> </li> </ol> <p>\u5ba2\u6237\u7aef\u6839\u636e\u4ee5\u4e0a\u56db\u4e2a\u65f6\u95f4\u6233\u80fd\u591f\u8ba1\u7b97\u51fa\u4e24\u4e2a\u5173\u952e\u53c2\u6570\uff1a <code>delay</code> NTP \u62a5\u6587\u4ece\u5ba2\u6237\u7aef\u5230\u670d\u52a1\u5668\u7684\u5f80\u8fd4\u5ef6\u8fdf\u3002     $delay = (t4 - t1) - (t3 - t2)$</p> <p><code>offset</code> \u5ba2\u6237\u7aef\u4e8e\u670d\u52a1\u5668\u7aef\u4e4b\u95f4\u7684\u65f6\u95f4\u5dee\u3002     $t2 = t1 + offset + delay/2$     $t4 = t3 - offset + delay / 2$</p> <p>NTP \u5ba2\u6237\u7aef\u6839\u636e\u8ba1\u7b97\u5f97\u5230 <code>offset</code> \u6765\u8c03\u6574\u81ea\u5df1\u5f97\u65f6\u949f\uff0c\u5b9e\u73b0\u4e8e NTP \u670d\u52a1\u5668\u7684\u65f6\u949f\u540c\u6b65\u3002</p> <p>NTP \u5ba2\u6237\u7aef\u901a\u5e38\u4f1a\u9009\u62e9\u591a\u4e2a\u540c\u6b65\u670d\u52a1\u5668\uff0c\u5e76\u901a\u8fc7\u4e00\u5b9a\u7684\u7b97\u6cd5\u6765\u786e\u5b9a\u6700\u51c6\u786e\u7684\u65f6\u95f4\u3002\u8fd9\u4e2a\u7b97\u6cd5\u88ab\u79f0\u4e3a\u65f6\u949f\u9009\u62e9\u7b97\u6cd5\uff0c\u5e38\u89c1\u7684\u7b97\u6cd5\u5305\u62ec\u6700\u5c0f\u5e73\u5747\u504f\u5dee\u7b97\u6cd5\uff08MAD\uff09\u548c\u6700\u5c0f\u504f\u5dee\u7b97\u6cd5\uff08MD\uff09\u7b49\u3002</p>"},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#mad","title":"\u65f6\u949f\u9009\u62e9\u7b97\u6cd5 MAD","text":"<p>\u6700\u5c0f\u5e73\u5747\u504f\u5dee\u7b97\u6cd5\uff0cMinimum Average Deviation\u3002 - \u5728MAD\u7b97\u6cd5\u4e2d\uff0cNTP\u5ba2\u6237\u7aef\u6536\u96c6\u6765\u81ea\u591a\u4e2a\u65f6\u95f4\u670d\u52a1\u5668\u7684\u65f6\u95f4\u4fe1\u606f\uff0c\u5e76\u8ba1\u7b97\u6bcf\u4e2a\u670d\u52a1\u5668\u65f6\u95f4\u4e0e\u672c\u5730\u65f6\u949f\u7684\u504f\u5dee\u3002 - \u5bf9\u4e8e\u6bcf\u4e2a\u670d\u52a1\u5668\uff0c\u5ba2\u6237\u7aef\u8ba1\u7b97\u4e0e\u672c\u5730\u65f6\u949f\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u5e73\u5747\u504f\u5dee\uff0c\u5e76\u9009\u62e9\u5177\u6709\u6700\u5c0f\u5e73\u5747\u504f\u5dee\u7684\u670d\u52a1\u5668\u4f5c\u4e3a\u65f6\u95f4\u6e90\u3002 - MAD\u7b97\u6cd5\u7684\u4f18\u52bf\u5728\u4e8e\u5b83\u8003\u8651\u4e86\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u5e73\u5747\u504f\u5dee\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u67d0\u4e00\u65f6\u523b\u7684\u504f\u5dee\u3002</p>"},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#md","title":"\u65f6\u949f\u9009\u62e9\u7b97\u6cd5 MD","text":"<p>\u6700\u5c0f\u504f\u5dee\u7b97\u6cd5\uff0cMinimum Deviation\u3002 - \u5728MD\u7b97\u6cd5\u4e2d\uff0cNTP\u5ba2\u6237\u7aef\u540c\u6837\u6536\u96c6\u6765\u81ea\u591a\u4e2a\u65f6\u95f4\u670d\u52a1\u5668\u7684\u65f6\u95f4\u4fe1\u606f\uff0c\u7136\u540e\u8ba1\u7b97\u6bcf\u4e2a\u670d\u52a1\u5668\u65f6\u95f4\u4e0e\u672c\u5730\u65f6\u949f\u7684\u504f\u5dee\u3002 - \u4e0eMAD\u7b97\u6cd5\u4e0d\u540c\u7684\u662f\uff0cMD\u7b97\u6cd5\u76f4\u63a5\u9009\u62e9\u5177\u6709\u6700\u5c0f\u504f\u5dee\u7684\u670d\u52a1\u5668\u4f5c\u4e3a\u65f6\u95f4\u6e90\uff0c\u800c\u4e0d\u662f\u8ba1\u7b97\u5e73\u5747\u504f\u5dee\u3002 - MD\u7b97\u6cd5\u66f4\u52a0\u7b80\u5355\uff0c\u56e0\u4e3a\u5b83\u53ea\u5173\u6ce8\u5f53\u524d\u65f6\u523b\u7684\u504f\u5dee\uff0c\u800c\u4e0d\u8003\u8651\u5386\u53f2\u6570\u636e\u3002</p>"},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#ntp_3","title":"NTP \u5b9e\u73b0","text":""},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#ntpd","title":"NTPd","text":"<p>\u6700\u5e38\u89c1\u7684 NTP \u5b9e\u73b0\u4e4b\u4e00\uff0c\u7531 NTP \u9879\u76ee\u56e2\u961f\u7ef4\u62a4\u3002</p>"},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#chrony","title":"Chrony","text":"<p>\u65e8\u5728\u63d0\u4f9b\u66f4\u5feb\u901f\u548c\u7cbe\u786e\u7684\u65f6\u95f4\u540c\u6b65\uff0c\u76f8\u6bd4\u4e8e\u4f20\u7edf\u7684 NTPd\uff0cChrony\u5728\u7cfb\u7edf\u542f\u52a8\u65f6\u80fd\u591f\u66f4\u5feb\u5730\u540c\u6b65\u65f6\u95f4\uff0c\u5e76\u5728\u7f51\u7edc\u4e0d\u7a33\u5b9a\u65f6\u8868\u73b0\u66f4\u4e3a\u7a33\u5b9a\u3002\u5b83\u4e5f\u53ef\u4ee5\u5728\u65ad\u5f00\u7f51\u7edc\u8fde\u63a5\u540e\u4fdd\u6301\u65f6\u95f4\u540c\u6b65\uff0c\u9002\u7528\u4e8e\u79fb\u52a8\u8bbe\u5907\u7b49\u573a\u666f\u3002</p>"},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#ntpd_1","title":"NTPd","text":""},{"location":"Operations/Linux/%E6%97%B6%E9%97%B4/#chrony_1","title":"Chrony","text":""},{"location":"Operations/Linux/%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6/","title":"\u67e5\u627e\u6587\u4ef6","text":""},{"location":"Operations/Linux/%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6/#find","title":"find","text":"<p>find \u547d\u4ee4\uff0c\u5728\u6307\u5b9a\u8def\u5f84\u4e0b\u6309\u7167\u6587\u4ef6\u540d\u3001\u6587\u4ef6\u5927\u5c0f\u3001\u6587\u4ef6\u7c7b\u578b\u7b49\u67e5\u627e\u6587\u4ef6\u3002 <pre><code>find [\u641c\u7d22\u8def\u5f84] [\u641c\u7d22\u6761\u4ef6] [\u64cd\u4f5c]\n</code></pre></p>"},{"location":"Operations/Linux/%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6/#_1","title":"\u6309\u7167\u6587\u4ef6\u540d\u79f0\u641c\u7d22","text":"<p>\u6bd4\u5982\u5728 / \u8def\u5f84\u4e0b\u67e5\u627e mysql \u5f00\u5934\u7684\u6587\u4ef6\uff0c-name \u57fa\u4e8e shell \u901a\u914d\u7b26\u8fdb\u884c\u5339\u914d\uff0c\u5982\u679c\u4f7f\u7528 -iname \u5219\u5ffd\u7565\u5927\u5c0f\u5199\uff1a <pre><code># find / -name \"mysql*\"\n/root/mysql-8.4.3-linux-glibc2.28-x86_64.tar.xz\n/srv/grafana/public/app/plugins/datasource/mysql\n</code></pre></p>"},{"location":"Operations/Linux/%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6/#_2","title":"\u6309\u7167\u6587\u4ef6\u7c7b\u578b\u641c\u7d22","text":"<p>\u53ef\u4ee5\u6309\u7167\u6587\u4ef6\u7c7b\u578b\u67e5\u627e\uff0c-type f \u8868\u793a\u666e\u901a\u6587\u4ef6\uff0c-type d \u8868\u793a\u76ee\u5f55\uff0c-type l \u8868\u793a\u7b26\u53f7\u94fe\u63a5\uff1a <pre><code>find /usr/local -type f -name \"*.txt\"\n</code></pre></p>"},{"location":"Operations/Linux/%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6/#_3","title":"\u6309\u7167\u6587\u4ef6\u5927\u5c0f\u641c\u7d22","text":"<p>\u53ef\u4ee5\u6309\u7167\u6587\u4ef6\u5927\u5c0f\u67e5\u627e\uff0c-size +10M \u8868\u793a\u5927\u4e8e 10M\uff0c-size -10M \u8868\u793a\u5c0f\u4e8e 10M\u3002c\uff08\u5b57\u8282\uff09\u3001k\u3001M\u3001G\u3002\u6ce8\u610f\uff0c\u7b49\u4e8e\u6307\u5b9a\u7684\u5927\u5c0f\u7684\u6587\u4ef6\u4e0d\u4f1a\u88ab\u5217\u51fa\u6765\uff1b\u53ef\u4ee5\u4f7f\u7528 -szie +10M -size -100M \u67e5\u8be2\u5927\u4e8e 10MB \u5c0f\u4e8e 100MB \u7684\u6587\u4ef6\u3002 <pre><code>find ./ -size +10M -size -100M -name \"*.gz\"\n</code></pre></p>"},{"location":"Operations/Linux/%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6/#_4","title":"\u6309\u7167\u6587\u4ef6\u7684\u66f4\u65b0\u65f6\u95f4\u641c\u7d22","text":"<p>\u6309\u7167\u4fee\u6539\u65f6\u95f4\u67e5\u627e\uff0c-mtime -7 \u8868\u793a\u6700\u8fd1 7 \u5929\u4fee\u6539\uff0c-mtime +30 \u8868\u793a\u8d85\u8fc7 30 \u5929\u3002</p>"},{"location":"Operations/Linux/%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6/#_5","title":"\u67e5\u627e\u6587\u4ef6\u4e4b\u540e\u6307\u5b9a\u547d\u4ee4","text":"<p>\u67e5\u627e\u6587\u4ef6\u540e\u6267\u884c\u5220\u9664\u64cd\u4f5c <pre><code>find /root/ -name \"*.tar.gz\" -exec rm {} \\;\n</code></pre></p> <p>\u67e5\u627e\u6587\u4ef6\u540e\u79fb\u52a8\u5230\u53e6\u4e00\u4e2a\u76ee\u5f55\uff1a <pre><code>find /root/ -name \"*.tar.gz\" -exec mv {} /backup/dir \\;\n</code></pre></p>"},{"location":"Operations/Linux/%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6/#which","title":"which","text":"<p>which \u67e5\u627e\u53ef\u6267\u884c\u547d\u4ee4\u7684\u8def\u5f84\uff0c\u57fa\u4e8e PATH \u73af\u5883\u53d8\u91cf\u8fdb\u884c\u641c\u5bfb\u3002 <pre><code># which ls\n/usr/bin/ls\n</code></pre></p>"},{"location":"Operations/Linux/%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6/#grep","title":"grep","text":"<p>grep \u547d\u4ee4\u80fd\u591f\u7ed3\u5408\u6b63\u5219\u8868\u8fbe\u5f0f\u5feb\u901f\u8fc7\u6ee4\u6587\u672c\u7684\u5185\u5bb9 <pre><code>grep [\u9009\u9879] \"\u641c\u7d22\u6a21\u5f0f\" [\u6587\u4ef6]\n</code></pre></p> <p>-i \u5ffd\u7565\u5927\u5c0f\u5199 -v \u53cd\u5411\u5339\u914d -n \u663e\u793a\u5339\u914d\u7684\u884c\u53f7 -c \u7edf\u8ba1\u5339\u914d\u7684\u884c\u6570 -o \u4ec5\u8f93\u51fa\u5339\u914d\u7684\u90e8\u5206\uff0c\u9ed8\u8ba4\u8f93\u51fa\u6574\u884c</p>"},{"location":"Operations/Linux/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/","title":"\u6b63\u5219\u8868\u8fbe\u5f0f","text":""},{"location":"Operations/Linux/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_1","title":"\u4ec0\u4e48\u5f0f\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>\u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u4e00\u7ec4\u5bf9\u6b63\u5728\u67e5\u627e\u7684\u6587\u672c\u7684\u63cf\u8ff0\u3002\u5728 Linux \u4e2d\u201c\u6b63\u5219\u8868\u8fbe\u5f0f\u201d\u548c\u201c\u6a21\u5f0f\u201d\u662f\u540c\u4e00\u6837\u4e1c\u897f\u3002</p> <p>\u76ee\u524d GNU/Linux \u4e2d\u6709\u4e24\u5957\u5e93\u53ef\u7528\u4e8e\u6b63\u5219\u8868\u8fbe\u5f0f\u7f16\u7a0b\uff1aPOSIX \u5e93\u548c PCRE \u5e93\u3002\u524d\u8005\u662f Linux \u81ea\u5e26\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5e93\uff0c\u540e\u8005\u662f Perl \u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5e93\u3002PCRE \u7684\u529f\u80fd\u66f4\u52a0\u5f3a\u5927\u3002</p> <p>\u5982\u679c\u53ea\u662f\u9700\u8981\u57fa\u672c\u7684\u5b57\u7b26\u4e32\u5339\u914d\u529f\u80fd\u4e14\u5e0c\u671b\u66f4\u597d\u7684\u6027\u80fd\uff0c\u53ef\u4ee5\u9009\u62e9\u4f7f\u7528 POSIX \u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u5982\u679c\u9700\u8981\u66f4\u5f3a\u5927\u3001\u66f4\u7075\u6d3b\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u529f\u80fd\uff0c\u5e76\u4e14\u80fd\u591f\u63a5\u53d7\u4e00\u4e9b\u6027\u80fd\u4e0a\u7684\u635f\u5931\uff0c\u90a3\u4e48 PCRE \u662f\u66f4\u597d\u7684\u9009\u62e9\u3002</p> <p>\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\uff0c\u67e5\u627e\u201ca \u5f00\u5934\u3001t \u7ed3\u5c3e\u201d\u7684\u5355\u8bcd\u3002 <pre><code>grep \"^a.*t$\" /usr/share/dict/words\n</code></pre></p>"},{"location":"Operations/Linux/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_2","title":"\u5b57\u7b26\u96c6","text":"<p>\u5728\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u201c.\u201d\u7528\u4e8e\u5339\u914d\u9664\u6362\u884c\u7b26\u4e4b\u5916\u7684\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\u4e0d\u80fd\u5339\u914d\u7a7a\u5b57\u7b26\u3002</p> <p>\u4f8b\u5982\u6a21\u5f0f <code>.at</code> \u80fd\u591f\u5339\u914d \u201caat\u201d\uff0c\u201ccat\u201d\uff0c\u201c#.at\u201d\uff0c\u5982\u679c\u60f3\u8981\u9650\u5b9a <code>at</code> \u4e4b\u524d\u7684\u4e00\u4e2a\u5b57\u7b26\u53ea\u80fd\u662f\u5c0f\u5199\u5b57\u6bcd\uff0c\u53ef\u4ee5\u4f7f\u7528\u6a21\u5f0f <code>[a-z]at</code>\u3002</p> <p>\u65b9\u62ec\u53f7 <code>[]</code> \u7528\u4e8e\u6307\u5b9a\u4e00\u4e2a\u5b57\u7b26\u96c6\uff0c\u65e0\u8bba\u62ec\u53f7\u4e2d\u6709\u591a\u5c11\u4e1c\u897f\uff0c\u5728\u5b9e\u9645\u5339\u914d\u65f6\u53ea\u80fd\u5339\u914d\u5176\u4e2d\u4e00\u4e2a\u5b57\u7b26\u3002  </p> <ul> <li><code>[abc]</code> \u80fd\u591f\u5339\u914d a\u3001b \u6216 c\u3002</li> <li><code>[a-zA-Z]</code> \u80fd\u591f\u5339\u914d\u6240\u6709\u7684\u5927\u5c0f\u5199\u82f1\u6587\u5b57\u6bcd\u3002</li> <li><code>[0-9]</code> \u80fd\u591f\u5339\u914d\u6570\u5b57\u3002</li> </ul> <p>POSIX \u8fd8\u63d0\u4f9b\u4e86\u9884\u5b9a\u4e49\u7684\u5b57\u7b26\u7c7b\u6765\u5339\u914d\u67d0\u4e9b\u7279\u5b9a\u7684\u5b57\u7b26\u4e32\u3002</p> \u7c7b \u5339\u914d\u5b57\u7b26 <code>[[:alnum:]]</code> \u6587\u5b57\u3001\u6570\u5b57\u5b57\u7b26 <code>[[:aplha:]]</code> \u5b57\u6bcd\u5b57\u7b26 <code>[[:lower:]]</code> \u5c0f\u5199\u5b57\u6bcd <code>[[:upper:]]</code> \u5927\u5199\u5b57\u6bcd <code>[[:digit:]]</code> \u5c0f\u6570 <code>[[:xdigit:]]</code> \u5341\u516d\u8fdb\u5236\u6570\u5b57 <code>[[:punct:]]</code> \u6807\u70b9\u7b26\u53f7 <code>[[:blank:]]</code> \u5236\u8868\u7b26\u548c\u7a7a\u683c <code>[[:space:]]</code> \u7a7a\u683c <code>[[:cntrl:]]</code> \u6240\u6709\u63a7\u5236\u7b26 <code>[[:print:]]</code> \u6240\u6709\u53ef\u6253\u5370\u7684\u5b57\u7b26 <code>[[:graph:]]</code> \u9664\u7a7a\u683c\u5916\u6240\u6709\u53ef\u6253\u5370\u7684\u5b57\u7b26"},{"location":"Operations/Linux/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_3","title":"\u4f4d\u7f6e\u5339\u914d","text":"<p>\u5b57\u7b26 <code>^</code> \u548c <code>$</code> \u5206\u522b\u7528\u4e8e\u5339\u914d\u884c\u9996\u548c\u884c\u5c3e\u3002</p> <p>\u6a21\u5f0f <code>^a[a-z]t$</code> \u7528\u4e8e\u5339\u914d\u6240\u6709\u4ee5 <code>a</code> \u5f00\u5934\u3001<code>t</code> \u7ed3\u5c3e\u3001<code>a</code> \u548c <code>t</code> \u4e4b\u95f4\u5305\u542b\u4e00\u4e2a\u5c0f\u5199\u5b57\u6bcd\u7684\u884c\u3002</p>"},{"location":"Operations/Linux/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_4","title":"\u5b57\u7b26\u8f6c\u4e49","text":"<p>\u4e00\u4e9b\u5b57\u7b26\u5728\u6a21\u5f0f\u4e2d\u6709\u7279\u6b8a\u7684\u542b\u4e49\uff0c\u5982 <code>.</code> \u7528\u4e8e\u5339\u914d\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\uff08\u9664\u6362\u884c\u7b26\uff09\u3002</p> <p>\u5982\u679c\u60f3\u8981\u5339\u914d\u5b57\u7b26 <code>.</code> \u5219\u9700\u8981\u4f7f\u7528\u6a21\u5f0f <code>\\.</code>\u3002 \u5982\u679c\u60f3\u8981\u5339\u914d\u5b57\u7b26 <code>[</code> \u5219\u9700\u8981\u4f7f\u7528\u6a21\u5f0f <code>\\[</code>\u3002</p> <p>\u5982\u679c\u60f3\u8981\u5339\u914d\u5b57\u7b26 <code>\\</code> \u5219\u9700\u8981\u4f7f\u7528\u6a21\u5f0f <code>\\\\</code>\u3002</p>"},{"location":"Operations/Linux/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_5","title":"\u91cd\u590d","text":"<p>\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d <code>*</code> \u8868\u793a\u5728\u5b83\u524d\u9762\u7684\u6a21\u5f0f\u5e94\u8be5\u91cd\u590d 0 \u6b21\u6216\u8005\u591a\u6b21\u3002\u6a21\u5f0f <code>^a.*t&amp;</code> \u7528\u4e8e\u5339\u914d\u6240\u6709\u4ee5 <code>a</code> \u5f00\u5934\u3001\u4ee5 <code>t</code> \u7ed3\u5c3e\u7684\u884c\u3002</p> <p>\u4e0e <code>*</code> \u7c7b\u4f3c\u7684\u4e24\u4e2a\u5143\u5b57\u7b26\u662f <code>+</code> \u548c <code>\uff1f</code> \u3002<code>+</code> \u6307\u5b9a\u91cd\u590d\u4e00\u6b21\u6216\u66f4\u591a\u6b21\uff1b<code>\uff1f</code> \u6307\u5b9a\u91cd\u590d 0 \u6b21\u6216\u8005\u4e00\u6b21\u3002</p> <p>\u4f7f\u7528\u82b1\u62ec\u53f7 <code>{}</code> \u53ef\u4ee5\u660e\u786e\u7684\u6307\u5b9a\u91cd\u590d\u7684\u6b21\u6570\u3002\u4f8b\u5982\uff0c<code>{3}</code> \u8868\u793a\u91cd\u590d 3 \u6b21\uff0c<code>{3,}</code> \u8868\u793a\u91cd\u590d 3 \u6b21\u6216\u8005\u66f4\u591a\u6b21\uff0c<code>{3,5}</code> \u8868\u793a\u91cd\u590d\u4e0d\u5c11\u4e8e 3 \u6b21\uff0c\u4e0d\u591a\u4e8e 12 \u6b21\u3002</p>"},{"location":"Operations/Linux/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_6","title":"\u5206\u7ec4","text":"<p>\u5206\u7ec4\u4e5f\u88ab\u79f0\u4e3a\u5b50\u8868\u8fbe\u5f0f\u3001\u6355\u83b7\u7ec4\u3002</p> <p>\u6a21\u5f0f <code>(or){2,}</code> \u7528\u4e8e\u5339\u914d\u6240\u6709 <code>or</code> \u91cd\u590d\u4e86\u4e24\u6b21\u6216\u8005\u66f4\u591a\u6b21\u7684\u884c\u3002\u5982\u679c\u53bb\u6389 <code>or</code> \u4e24\u8fb9\u7684\u62ec\u53f7\uff0c\u90a3\u4e48\u6a21\u5f0f\u5c06\u5339\u914d\uff1a\u5b57\u6bcd <code>o</code> \u540e\u9762\u7d27\u8ddf\u4e24\u4e2a\u6216\u8005\u66f4\u591a\u4e2a\u5b57\u6bcd <code>r</code> \u7684\u884c\u3002</p>"},{"location":"Operations/Linux/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_7","title":"\u53cd\u4e49","text":"<p>\u6a21\u5f0f <code>[^y]</code> \u5339\u914d\u9664\u4e86 <code>y</code> \u7684\u4efb\u4f55\u5b57\u7b26\u3002</p> <p>\u6a21\u5f0f <code>[^aeior]</code> \u5339\u914d\u9664\u4e86\u5b57\u6bcd a\u3001e\u3001i\u3001o\u3001u \u7684\u6240\u6709\u5b57\u7b26\u3002</p> <p>\u9700\u8981\u6ce8\u610f <code>^</code> \u6709\u4e24\u79cd\u7528\u6cd5\uff0c\u5728\u6a21\u5f0f\u7684\u5f00\u5934\u65f6\u662f\u5339\u914d\u884c\u7684\u5f00\u5934\uff1b\u51fa\u73b0\u5728\u5b57\u7b26\u96c6 <code>[]</code> \u5185\u7684\u5f00\u5934\u65f6\uff0c\u8868\u793a\u5426\u5b9a\u5b57\u7b26\u96c6\uff0c\u5373\u5339\u914d\u4e0d\u5728\u96c6\u5408\u4e2d\u7684\u5b57\u7b26\u3002</p>"},{"location":"Operations/Linux/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_8","title":"\u6216","text":"<p>\u6a21\u5f0f\u53ef\u4ee5\u4f7f\u7528 <code>|</code> \u8868\u793a\u6216\u7684\u610f\u601d\u3002</p> <p>\u6a21\u5f0f <code>^h|t$</code> \u53ef\u4ee5\u7528\u6765\u5339\u914d\u4ee5\u5b57\u6bcd <code>h</code> \u5f00\u5934\uff0c\u6216\u8005\u4ee5\u5b57\u6bcd <code>t</code> \u7ed3\u5c3e\u7684\u884c\u3002 </p>"},{"location":"Operations/Linux/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_9","title":"\u9006\u5411\u5f15\u7528","text":"<p>\u9006\u5411\u5f15\u7528\u65f6\u4e00\u79cd\u7279\u6b8a\u7684\u529f\u80fd\uff0c\u5141\u8bb8\u5728\u6a21\u5f0f\u4e2d\u5f15\u7528\u5148\u524d\u6355\u83b7\u7684\u5b50\u8868\u8fbe\u5f0f\u6240\u5339\u914d\u7684\u6587\u672c\u3002\u9006\u5411\u5f15\u7528\u4f7f\u7528 <code>\\</code> \u540e\u8ddf\u6570\u5b57\u6765\u5b9e\u73b0\uff0c\u5176\u4e2d\u6570\u5b57\u8868\u793a\u6355\u83b7\u7ec4\u7684\u7f16\u53f7\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\u5206\u7ec4\uff08\u6216\u8005\u79f0\u4e3a\u5b50\u8868\u8fbe\u5f0f\u3001\u6355\u83b7\u7ec4\uff09\u662f\u7531\u62ec\u53f7 <code>()</code> \u62ec\u8d77\u6765\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u4e00\u90e8\u5206\uff0c\u9006\u5411\u8868\u8fbe\u5f0f\u53ea\u80fd\u5f15\u7528\u5206\u7ec4\u7684\u7f16\u53f7\u3002</p> <p>\u6a21\u5f0f\uff1a<code>(\\w+)\\s+\\1</code> </p> <ul> <li><code>(\\w+)</code> \u662f\u7b2c\u4e00\u4e2a\u6355\u83b7\u7ec4\uff0c\u5339\u914d\u4e00\u4e2a\u6216\u591a\u4e2a\u5355\u8bcd\u5b57\u7b26\u3002</li> <li><code>\\s+</code> \u5339\u914d\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u7a7a\u767d\u5b57\u7b26\u3002</li> <li><code>\\1</code> \u662f\u5bf9\u7b2c\u4e00\u4e2a\u6355\u83b7\u7ec4\u7684\u9006\u5411\u5f15\u7528\uff0c\u7531\u4e8e <code>\\s+</code> \u5e76\u4e0d\u662f\u6355\u83b7\u7ec4\uff0c\u6240\u4ee5\u4e0d\u80fd\u51fa\u73b0 <code>\\2</code>\uff08Invalid back reference\uff09\u3002</li> </ul>"},{"location":"Operations/Linux/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#qa","title":"QA","text":"<p>1.\u5982\u679c\u8981\u5728\u547d\u4ee4 grep \u4e2d\u4f7f\u7528\u5143\u5b57\u7b26\uff1a<code>{}</code>\u3001<code>()</code>\u3001<code>|</code>\u3001<code>+</code>\u3001<code>?</code> \u6216\u8005\u5176\u5b83\u7279\u6b8a\u5b57\u7b26\u65f6\uff0c\u9700\u8981\u6307\u5b9a -E \u9009\u9879\u6765\u4f7f\u7528\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p> <p>2.\u4e00\u4e9b\u8f6c\u4e49\u5e8f\u5217\uff0c\u7531 <code>\\</code> \u5f00\u5934\u7684\u5b57\u7b26\u6216\u8005\u5b57\u7b26\u7ec4\u5408\u5177\u6709\u7279\u6b8a\u7684\u542b\u4e49\u3002</p> <p>3.shell \u901a\u914d\u7b26\u548c\u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u4e24\u4e2a\u4e1c\u897f\uff0cshell \u901a\u914d\u7b26\u4e3b\u8981\u7528\u6765\u5339\u914d\u6587\u4ef6\u540d\uff0c\u529f\u80fd\u6709\u9650\uff0c\u4e0d\u652f\u6301\u590d\u6742\u7684\u903b\u8f91\u3002 shell \u901a\u914d\u7b26\u652f\u6301\u7684\u5339\u914d\u6a21\u5f0f\u5982\u4e0b\uff1a</p> <ul> <li><code>*</code> \u5339\u914d\u4efb\u610f\u957f\u5ea6\u7684\u5b57\u7b26\u3002</li> <li><code>?</code> \u5339\u914d\u4efb\u610f\u5355\u4e2a\u5b57\u7b26\u3002</li> <li><code>[abc]</code> \u5339\u914d\u96c6\u5408\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\u3002</li> <li> <p><code>[!abc]</code> \u6216\u8005 <code>[^abc]</code> \u5339\u914d\u96c6\u5408\u4e2d\u672a\u5305\u542b\u7684\u5b57\u7b26\u3002</p> </li> <li> <p>\u8f6c\u4e49\u5e8f\u5217:</p> </li> </ul> \u8f6c\u4e49\u5e8f\u5217 \u542b\u4e49 <code>\\w</code> \u8868\u793a\u5355\u8bcd\u5b57\u7b26 word character <code>\\s</code> \u8868\u793a\u7a7a\u767d\u5b57\u7b26 whitespace character <code>\\d</code> \u8868\u793a\u6570\u5b57\u5b57\u7b26 digit character <code>\\b</code> \u8868\u793a\u5355\u8bcd\u8fb9\u754c word boundary <code>\\B</code> \u8868\u793a\u975e\u5355\u8bcd\u8fb9\u754c non-word boundary <code>\\A</code> \u8868\u793a\u5b57\u7b26\u4e32\u5f00\u59cb\u7684\u4f4d\u7f6e <code>\\Z</code> \u8868\u793a\u5b57\u7b26\u4e32\u7ed3\u675f\u7684\u4f4d\u7f6e <code>\\t</code> \u8868\u793a\u5236\u8868\u7b26 Tab <code>\\n</code> \u8868\u793a\u6362\u884c\u7b26 newline <code>r</code> \u8868\u793a\u56de\u8f66\u7b26 carriage return"},{"location":"Operations/Linux/%E7%9B%91%E6%8E%A7%E7%A1%AC%E7%9B%98%E6%B8%A9%E5%BA%A6%E6%95%B0%E6%8D%AE/","title":"\u76d1\u63a7\u786c\u76d8\u6e29\u5ea6\u6570\u636e","text":"<p>\u5b89\u88c5 smartmontools\uff0c\u80fd\u591f\u67e5\u770b\u78c1\u76d8\u7684 SMART \u6570\u636e\uff0c\u5f53\u7136\u4e5f\u80fd\u67e5\u770b\u78c1\u76d8\u7684\u6e29\u5ea6\u6570\u636e\u3002 \u83b7\u53d6 sda \u786c\u76d8\u7684\u6e29\u5ea6 <pre><code>smartctl -A /dev/sda | grep Temperature | awk '{print $10}'\n</code></pre></p> <p>\u4e24\u5757\u786c\u76d8\u7684\u76d1\u63a7\u811a\u672c\uff0ccrontab \u6bcf\u5206\u949f\u4e00\u6b21\uff0c\u6570\u636e\u8bb0\u5f55\u5230\u6587\u4ef6\u4e2d\u3002 <pre><code>#!/bin/bash\n\nTIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')\nDATE=$(date '+%Y%m%d')\nHOUR=$(date '+%H')\n\nDISKS=(\"sda\" \"sdb\")\n\nLOG_DIR=\"/data/disk2/minitor/disk\"\nmkdir -p \"$LOG_DIR\"\n\nfor DISK in \"${DISKS[@]}\"; do\n  TEMP=$(/usr/sbin/smartctl -A /dev/$DISK | grep Temperature | awk '{print $10}')\n  LOG_FILE=\"$LOG_DIR/${DISK}-${DATE}-${HOUR}.log\"\n  echo \"$TIMESTAMP $TEMP\" &gt;&gt; \"$LOG_FILE\"\ndone\n</code></pre></p> <p>\u4f7f\u7528 gnuplot \u5c06\u6e29\u5ea6\u6570\u636e\u7ed8\u5236\u6210\u56fe\u7247\uff0c\u6bcf\u5c0f\u65f6\u4e00\u5f20\u56fe\u7247\u3002\u4fdd\u5b58 15 \u5929\u7684\u6570\u636e\u3002gunplot \u5b89\u88c5\u7684\u4f9d\u8d56\u592a\u591a\uff0c\u6ca1\u6709\u5fc5\u8981\u3002\u81ea\u5df1\u4f7f\u7528 C \u8bed\u8a00\u5199\u4e00\u4e2a\uff0c\u547d\u4ee4\u884c\u5c55\u793a\u6e29\u5ea6\u66f2\u7ebf\u7684\u8f6f\u4ef6\u5f97\u4e86\u3002</p> <p>\u5c06\u56fe\u7247\u5b58\u50a8\u5230\u6307\u5b9a\u76ee\u5f55\uff0c\u4f7f\u7528 Nginx \u5171\u4eab\u56fe\u7247\u6587\u4ef6\uff0c\u540c\u65f6\u8bbe\u7f6e\u6d4f\u89c8\u5668\u9ed8\u8ba4\u6253\u5f00\u9884\u89c8\u3002</p> <p>\u5b8c\u6210 NAS \u786c\u76d8\u6e29\u5ea6\u7684\u76d1\u63a7\u3002</p> <p>\u540c\u6837\u53ef\u4ee5\u76d1\u63a7 CPU \u4f7f\u7528\u7387\u3001\u5185\u5b58\u4f7f\u7528\u7387\u3001\u78c1\u76d8\u8bfb\u5199\u6307\u6807\u3001\u7f51\u7edc\u8fde\u63a5\u6570\u91cf\u3001\u7f51\u7edc\u8bfb\u5199\u6307\u6807\u7b49\u3002</p>"},{"location":"Operations/Linux/%E7%A3%81%E7%9B%98%E6%8C%82%E8%BD%BD/","title":"\u78c1\u76d8\u6302\u8f7d","text":""},{"location":"Operations/Linux/%E7%A3%81%E7%9B%98%E6%8C%82%E8%BD%BD/#_1","title":"\u67e5\u770b\u7cfb\u7edf\u5757\u8bbe\u5907\u4fe1\u606f","text":"<p><code>lsblk</code> \u5217\u51fa\u6240\u6709\u5757\u8bbe\u5907\u53ca\u5176\u6302\u8f7d\u70b9\uff0c\u53ef\u663e\u793a\u672a\u6302\u8f7d\u7684\u8bbe\u5907\uff0c\u547d\u4ee4\u8f93\u51fa\uff1a <pre><code>NAME         MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS\nsda            8:0    0   3.6T  0 disk \n\u2514\u2500sda1         8:1    0   3.6T  0 part /data/disk2\nsdb            8:16   0   3.6T  0 disk \n\u251c\u2500sdb1         8:17   0    16M  0 part \n\u2514\u2500sdb2         8:18   0   3.6T  0 part /data/disk1\n</code></pre> \u547d\u4ee4\u9ed8\u8ba4\u8f93\u51fa\u5b57\u6bb5\u89e3\u91ca\uff1a  </p> <ul> <li>NAME\uff1a\u5c31\u662f\u88c5\u7f6e\u7684\u6587\u4ef6\u540d\uff0c\u4f1a\u7701\u7565 /dev \u7b49\u524d\u5bfc\u76ee\u5f55\uff01</li> <li>MAJ:MIN\uff1a\u5176\u5b9e\u6838\u5fc3\u8ba4\u8bc6\u7684\u88c5\u7f6e\u90fd\u662f\u901a\u8fc7\u8fd9\u4e24\u4e2a\u4ee3\u7801\u6765\u719f\u6089\u7684\uff01\u5206\u522b\u662f<code>\u4e3b\u8981:\u6b21\u8981</code>\u88c5\u7f6e\u4ee3\u7801\uff01</li> <li>RM\uff1a\u662f\u5426\u4e3a\u53ef\u5378\u9664\u88c5\u7f6e (removable device)\uff0c\u5982\u5149\u76d8\u3001USB \u78c1\u76d8\u7b49\u7b49</li> <li>SIZE\uff1a\u5bb9\u91cf\u3002</li> <li>RO\uff1a\u662f\u5426\u4e3a\u53ea\u8bfb\u88c5\u7f6e\u7684\u610f\u601d</li> <li>TYPE\uff1a\u662f\u78c1\u76d8 (disk)\u3001\u5206\u533a\u69fd (partition) \u8fd8\u662f\u53ea\u8bfb\u5b58\u50a8\u5668 (rom) \u7b49\u8f93\u51fa </li> <li>MOUTPOINT\uff1a\u6302\u8f7d\u70b9\u8def\u5f84\u3002</li> </ul>"},{"location":"Operations/Linux/%E7%A3%81%E7%9B%98%E6%8C%82%E8%BD%BD/#_2","title":"\u5206\u533a\u6302\u8f7d","text":""},{"location":"Operations/Linux/%E7%A3%81%E7%9B%98%E6%8C%82%E8%BD%BD/#_3","title":"\u67e5\u770b\u5206\u533a\u8868\u683c\u5f0f","text":"<p><code>parted</code> \u547d\u4ee4\u4e5f\u53ef\u4ee5\u7528\u6765\u8fdb\u884c\u5206\u533a\uff0c\u652f\u6301 <code>MBR</code> \u548c <code>GPT</code>\u3002 <pre><code># parted /dev/sdb print\nModel: External USB3.0 (scsi)\nDisk /dev/sdb: 1000GB\nSector size (logical/physical): 512B/4096B\nPartition Table: gpt\nDisk Flags: \n\nNumber  Start   End     Size    File system  Name                          Flags\n 1      17.4kB  16.8MB  16.8MB               Microsoft reserved partition  msftres\n</code></pre></p> <p>MBR \u5206\u533a\u8868\u4f7f\u7528 fdisk \u547d\u4ee4\u5206\u533a\uff0cGPT \u5206\u533a\u8868\u4f7f\u7528 gdisk \u5206\u533a\u3002\u6ce8\u610f\uff1a<code>msdos</code> \u662f Linux \u5de5\u5177\u4e2d\u5bf9 MBR \u5206\u533a\u8868\u7684\u79f0\u547c\u3002</p>"},{"location":"Operations/Linux/%E7%A3%81%E7%9B%98%E6%8C%82%E8%BD%BD/#gdisk","title":"gdisk \u5206\u533a","text":"<p>gdisk /dev/sdb <pre><code>? \u67e5\u770b\u5e2e\u52a9\u4fe1\u606f\nn \u65b0\u589e\u5206\u533a\nw \u4fdd\u5b58\u4fee\u6539\np \u6253\u5370\u5206\u533a\u8868\nd \u5220\u9664\u5206\u533a\n</code></pre></p>"},{"location":"Operations/Linux/%E7%A3%81%E7%9B%98%E6%8C%82%E8%BD%BD/#_4","title":"\u683c\u5f0f\u5316\u5206\u533a","text":"<p>\u5206\u533a\u5b8c\u6210\u4e4b\u540e\u67e5\u770b\u5757\u8bbe\u5907\u7684\u5c5e\u6027 <pre><code># blkid\n/dev/sda1: UUID=\"24b6f0e0-de6b-41f4-b2d5-1617ff9e70f3\" BLOCK_SIZE=\"4096\" TYPE=\"ext4\" PARTUUID=\"cfc6c386-01\"\n/dev/sda5: UUID=\"95b3dfa2-e338-45b0-b7fa-74473ccea59f\" TYPE=\"swap\" PARTUUID=\"cfc6c386-05\"\n/dev/sdb1: PARTLABEL=\"Linux filesystem\" PARTUUID=\"1d55968e-7323-44cf-bff2-ed10b195885e\"\n/dev/sdb2: PARTLABEL=\"Linux filesystem\" PARTUUID=\"f4f65b92-f38a-4d59-9fdd-7d72b4a18512\"\n/dev/sdb3: PARTLABEL=\"Linux filesystem\" PARTUUID=\"88fe2623-ff77-42f6-bac4-41259d84a921\"\n</code></pre></p> <p>\u683c\u5f0f\u5316\u78c1\u76d8\uff0c\u6587\u4ef6\u7cfb\u7edf\u683c\u5f0f\u4e3a ext4\u3002 <pre><code>mkfs.ext4 /dev/sdb1\nmkfs.ext4 /dev/sdb2\nmkfs.ext4 /dev/sdb3\n</code></pre></p>"},{"location":"Operations/Linux/%E7%A3%81%E7%9B%98%E6%8C%82%E8%BD%BD/#_5","title":"\u6302\u8f7d","text":"<p>\u6bd4\u5982\u6302\u8f7d /dev/sdb1 \u5230 /srv/nfs/data40 <pre><code># mount UUID=\"f4f72136-4edf-4abd-9fdd-83d49727f827\" /srv/nfs/data40/\n# df /srv/nfs/data40\nFilesystem     1K-blocks  Used Available Use% Mounted on\n/dev/sdb1       40973536    24  38859976   1% /srv/nfs/data40\n</code></pre></p> <p>\u5378\u9664 <pre><code># umount /dev/sdb1\n# df /srv/nfs/data40\nFilesystem     1K-blocks    Used Available Use% Mounted on\n/dev/sda1       19480400 2756488  15709028  15% /\n</code></pre></p>"},{"location":"Operations/Linux/%E7%A3%81%E7%9B%98%E6%8C%82%E8%BD%BD/#_6","title":"\u8bbe\u7f6e\u5f00\u673a\u6302\u8f7d","text":"<p>\u5f00\u59cb\u6302\u8f7d\u5728 /etc/fstab \u6587\u4ef6\u91cc\u9762\u8bbe\u7f6e\uff0c\u5148\u67e5\u770b\u4e00\u4e0b\u6587\u4ef6\u5185\u5bb9 <pre><code># cat /etc/fstab \n# /etc/fstab: static file system information.\n#\n# Use 'blkid' to print the universally unique identifier for a\n# device; this may be used with UUID= as a more robust way to name devices\n# that works even if disks are added and removed. See fstab(5).\n#\n# systemd generates mount units based on this file, see systemd.mount(5).\n# Please run 'systemctl daemon-reload' after making changes here.\n#\n# &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;\n# / was on /dev/sda1 during installation\nUUID=24b6f0e0-de6b-41f4-b2d5-1617ff9e70f3 /               ext4    errors=remount-ro 0       1\n# swap was on /dev/sda5 during installation\nUUID=95b3dfa2-e338-45b0-b7fa-74473ccea59f none            swap    sw              0       0\n/dev/sr0        /media/cdrom0   udf,iso9660 user,noauto     0       0\n</code></pre> \u7b2c\u4e00\u680f\uff1a\u78c1\u76d8\u88c5\u7f6e\u6587\u4ef6\u540d \u8fd9\u4e2a\u5b57\u6bb5\u53ef\u4ee5\u586b\u5199\u7684\u6570\u636e\u4e3b\u8981\u6709\u4e09\u4e2a\u9879\u76ee\uff1a </p> <ul> <li>\u6587\u4ef6\u7cfb\u7edf\u6216\u78c1\u76d8\u7684\u88c5\u7f6e\u6587\u4ef6\u540d\uff0c\u5982 /dev/vda2 \u7b49\u3002</li> <li>\u6587\u4ef6\u7cfb\u7edf\u7684 UUID \u540d\u79f0\uff0c\u5982 UUID=xxx\u3002</li> <li>\u6587\u4ef6\u7cfb\u7edf\u7684 LABEL \u540d\u79f0\uff0c\u4f8b\u5982 LABEL=xxx\u3002  </li> </ul> <p>\u56e0\u4e3a\u6bcf\u4e2a\u6587\u4ef6\u7cfb\u7edf\u90fd\u53ef\u4ee5\u6709\u4e0a\u9762\u4e09\u4e2a\u9879\u76ee\uff0c\u4f7f\u7528\u5176\u4e2d\u4efb\u4f55\u4e00\u4e2a\u90fd\u53ef\u4ee5\u3002\u4e0d\u8fc7\uff0c\u5982\u679c\u4e3a\u4e86\u4e00\u81f4\u6027\uff0c\u5efa\u8bae\u8bbe\u7f6e\u6210 UUID\u3002</p> <p>\u7b2c\u4e8c\u680f\uff1a\u6302\u8f7d\u70b9 mount point \u6587\u4ef6\u7cfb\u7edf\u7684\u8bbf\u95ee\u8def\u5f84\u3002</p> <p>\u7b2c\u4e09\u680f\uff1a\u78c1\u76d8\u5206\u533a\u69fd\u7684\u6587\u4ef6\u7cfb\u7edf \u5728\u624b\u52a8\u6302\u8f7d\u65f6\u53ef\u4ee5\u8ba9\u7cfb\u7edf\u81ea\u52a8\u6d4b\u8bd5\u6302\u8f7d\uff0c\u4f46\u5728\u8fd9\u4e2a\u6587\u4ef6\u5f53\u4e2d\u5fc5\u987b\u8981\u624b\u52a8\u5199\u5165\u6587\u4ef6\u7cfb\u7edf\u624d\u884c\uff01\u5305\u62ec xfs, ext4, vfat, reiserfs, nfs \u7b49\u7b49\u3002</p> <p>\u7b2c\u56db\u680f\uff1a\u6587\u4ef6\u7cfb\u7edf\u53c2\u6570 \u76f4\u63a5\u8bbe\u7f6e defaults \u5c31\u884c\u4e86\u3002</p> <p>\u7b2c\u4e94\u680f\uff1a\u80fd\u5426\u88ab dump \u5907\u4efd\u6307\u4ee4\u4f5c\u7528 dump \u662f\u4e00\u4e2a\u7528\u6765\u505a\u4e3a\u5907\u4efd\u7684\u6307\u4ee4\uff0c\u4e0d\u8fc7\u73b0\u5728\u6709\u592a\u591a\u7684\u5907\u4efd\u65b9\u6848\u4e86\uff0c\u6240\u4ee5\u8fd9\u4e2a\u9879\u76ee\u53ef\u4ee5\u4e0d\u8981\u7406\u4f1a\uff01\u76f4\u63a5\u8f93\u5165 0 \u5c31\u597d\u4e86\uff01</p> <p>\u7b2c\u516d\u680f\uff1a\u662f\u5426\u4ee5 fsck \u68c0\u9a8c\u6247\u533a \u65e9\u671f\u5f00\u673a\u7684\u6d41\u7a0b\u4e2d\uff0c\u4f1a\u6709\u4e00\u6bb5\u65f6\u95f4\u53bb\u68c0\u9a8c\u672c\u673a\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u770b\u770b\u6587\u4ef6\u7cfb\u7edf\u662f\u5426\u5b8c\u6574 (clean)\u3002 \u4e0d\u8fc7\u8fd9\u4e2a\u65b9\u5f0f\u4f7f\u7528\u7684\u4e3b\u8981\u662f\u900f\u8fc7 fsck \u53bb\u505a\u7684\uff0c\u6211\u4eec\u73b0\u5728\u7528\u7684 xfs \u6587\u4ef6\u7cfb\u7edf\u5c31\u6ca1\u6709\u529e\u6cd5\u9002\u7528\uff0c\u56e0\u4e3a xfs \u4f1a\u81ea\u5df1\u8fdb\u884c\u68c0\u9a8c\uff0c\u4e0d\u9700\u8981\u989d\u5916\u8fdb\u884c\u8fd9\u4e2a\u52a8\u4f5c\uff01\u6240\u4ee5\u76f4\u63a5\u586b 0 \u5c31\u597d\u4e86\u3002</p> <p>\u5f00\u673a\u6302\u8f7d\u793a\u4f8b \u6bd4\u5982\u8bbe\u7f6e\u5f00\u673a\u6302\u8f7d /dev/sdb1 \u5230 /srv/nfs/data40\uff1a <pre><code>UUID=\"f4f72136-4edf-4abd-9fdd-83d49727f827\" /srv/nfs/data40 ext4 defaults 0 0\n</code></pre> \u7f16\u8f91\u5b8c\u6210\u4e4b\u540e\uff0c\u4f7f\u7528 <code>mount -a</code> \u547d\u4ee4\u66f4\u65b0\u6302\u8f7d\u3002</p>"},{"location":"Operations/Linux/%E7%A3%81%E7%9B%98%E6%8C%82%E8%BD%BD/#debian-ntfs","title":"Debian \u6302\u8f7d ntfs \u6587\u4ef6\u7cfb\u7edf","text":"<p>ntfs \u662f\u5fae\u8f6f\u5f00\u53d1\u7684\u4e13\u6709\u6587\u4ef6\u7cfb\u7edf\uff0cDebian \u6302\u8f7d\u9700\u8981\u5b89\u88c5 ntfs-3g \u9a71\u52a8\uff0c\u652f\u6301 ntfs \u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>\u67e5\u770b\u662f\u5426\u5df2\u7ecf\u5b89\u88c5\u4e86\u8be5\u9a71\u52a8\uff1a <pre><code>dpkg -l | grep ntfs\n</code></pre></p> <p>\u5b89\u88c5\u9a71\u52a8\uff1a <pre><code>apt install ntfs-3g\n</code></pre></p> <p>\u4e34\u65f6\u6302\u8f7d\uff1a <pre><code>mount -t ntfs-3g /dev/sda1 /data/disk1\n</code></pre></p> <p>\u8bbe\u7f6e\u5f00\u673a\u6302\u8f7d\uff1a <pre><code>UUID=C060354A60354904 /data/disk1 ntfs-3g defaults 0 0 \n</code></pre></p>"},{"location":"Operations/Linux/%E7%B3%BB%E7%BB%9F%E5%8A%A0%E5%9B%BA/","title":"\u7cfb\u7edf\u52a0\u56fa","text":""},{"location":"Operations/Linux/%E7%B3%BB%E7%BB%9F%E5%8A%A0%E5%9B%BA/#_1","title":"\u8eab\u4efd\u9274\u522b","text":""},{"location":"Operations/Linux/%E7%B3%BB%E7%BB%9F%E5%8A%A0%E5%9B%BA/#pam","title":"PAM \u4ecb\u7ecd","text":"<p>\u200bPAM\u200b\u200b\uff08\u200b\u200bPluggable Authentication Modules\u200b\u200b\uff0c\u53ef\u63d2\u62d4\u8ba4\u8bc1\u6a21\u5757\uff09\u662f \u200b\u200bLinux/Unix \u7cfb\u7edf\u4e2d\u7684\u4e00\u4e2a\u6838\u5fc3\u5b89\u5168\u6846\u67b6\u200b\u200b\uff0c\u7528\u4e8e\u7edf\u4e00\u7ba1\u7406\u5404\u7c7b\u5e94\u7528\u7a0b\u5e8f\u7684\u8ba4\u8bc1\u673a\u5236\u3002\u5b83\u901a\u8fc7\u6a21\u5757\u5316\u8bbe\u8ba1\uff0c\u5141\u8bb8\u7cfb\u7edf\u7ba1\u7406\u5458\u7075\u6d3b\u914d\u7f6e\u8eab\u4efd\u9a8c\u8bc1\u3001\u6388\u6743\u3001\u5bc6\u7801\u7b56\u7565\u7b49\u529f\u80fd\uff0c\u800c\u65e0\u9700\u4fee\u6539\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u3002</p> <p><code>libpam.so</code> \u662f PAM \u6846\u67b6\u7684\u6838\u5fc3\u5e93\uff0c\u63d0\u4f9b\u4e86\u5e94\u7528\u7a0b\u5e8f\u4e0e PAM \u6a21\u5757\u4ea4\u4e92\u7684\u63a5\u53e3\u3002 \u7136\u540e\u5177\u4f53\u7684 PAM \u6a21\u5757\u5b9e\u73b0\u4e86\u4e0d\u540c\u7684\u4e1a\u52a1\u903b\u8f91\u529f\u80fd\u3002 \u5e94\u7528\u7a0b\u5e8f\u901a\u8fc7 PAM \u63d0\u4f9b\u7684 API \u4e0e\u5177\u4f53\u7684 PAM \u6a21\u5757\u8fdb\u884c\u4ea4\u4e92\u3002</p> <p>\u67e5\u770b\u5b89\u88c5\u7684\u5e93\uff1a <pre><code>find /lib /usr/lib -name 'pam_*.so'\n</code></pre></p> <p>PAM \u7684\u914d\u7f6e\u4f4d\u4e8e\u00a0<code>/etc/pam.d/</code>\u76ee\u5f55\uff0c\u6bcf\u4e2a\u670d\u52a1\uff08\u5982\u00a0<code>sshd</code>\u3001<code>sudo</code>\uff09\u6709\u72ec\u7acb\u7684\u914d\u7f6e\u6587\u4ef6\u3002</p> <p>\u5de5\u4f5c\u6d41\u7a0b\uff0c\u5f53\u6267\u884c <code>passwd</code> \u6307\u4ee4\u4e4b\u540e\uff1a</p> <ol> <li>\u6267\u884c <code>passwd</code> \u8fd9\u4e2a\u7a0b\u5e8f\uff0c\u5e76\u8f93\u5165\u5bc6\u7801\u3002</li> <li><code>passwd</code> \u4f1a\u8c03\u7528 PAM \u6a21\u5757\u8fdb\u884c\u9a8c\u8bc1\u3002</li> <li>PAM \u4f1a\u627e\u5230 <code>/etc/pam.d/passwd</code> \u914d\u7f6e\u6587\u4ef6\uff08\u914d\u7f6e\u6587\u4ef6\u7684\u8def\u5f84\u53ef\u80fd\u662f <code>passwd</code> \u8c03\u7528\u65b9\u6cd5\u7684\u65f6\u5019\u4f20\u7684\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff09\u3002</li> <li>\u89e3\u6790\u914d\u7f6e\u6587\u4ef6\uff0c\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u7684\u8bbe\u5b9a\u8fdb\u884c\u9a8c\u8bc1\u5206\u6790\u3002</li> <li>\u5c06\u9a8c\u8bc1\u7ed3\u679c\uff08\u6210\u529f\uff0c\u5931\u8d25\uff09\u56de\u4f20\u7ed9 <code>passwd</code>\u3002</li> <li><code>passwd</code> \u83b7\u53d6\u7ed3\u679c\u4e4b\u540e\uff0c\u51b3\u5b9a\u4e0b\u4e00\u4e2a\u52a8\u4f5c\u3002</li> </ol> <p>\u200b\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u200b\u200b\uff1a <pre><code># /etc/pam.d/passwd \u53ef\u4ee5\u770b\u51fa\u53ef\u4ee5\u5f15\u7528\u5176\u4ed6\u7684\u914d\u7f6e\u6587\u4ef6\n@include common-password\n\n# /etc/pam.d/common-password\npassword        requisite                       pam_pwquality.so retry=3 minlen=8 ucredit=-1 lcredit=-1 dcredit=-1\npassword        [success=1 default=ignore]      pam_unix.so obscure use_authtok try_first_pass sha512\npassword        requisite                       pam_deny.so\npassword        required                        pam_permit.so\n</code></pre> \u200b \u5177\u4f53\u7684\u6bcf\u884c\u914d\u7f6e \u7b2c\u4e00\u4e2a\u5b57\u6bb5\uff1a\u9a8c\u8bc1\u7c7b\u522b</p> <ul> <li>auth \u8ba4\u8bc1\uff0c\u4e3b\u8981\u7528\u6765\u68c0\u9a8c\u4f7f\u7528\u8005\u7684\u8eab\u4efd\u3002</li> <li>account \u8d26\u53f7\uff0c\u4e3b\u8981\u8fdb\u884c\u6388\u6743\u65f6\u68c0\u9a8c\u662f\u6216\u5426\u6709\u6b63\u786e\u7684\u6743\u9650\u3002</li> <li>session \u4f1a\u8bdd\u3002</li> <li>passwd \u5bc6\u7801\uff0c\u5bc6\u7801\u7684\u4fee\u6539\u53d8\u66f4\u4f7f\u7528\u3002</li> </ul> <p>\u7b2c\u4e8c\u4e2a\u5b57\u6bb5\uff1a\u63a7\u5236\u6807\u8bc6</p> <ul> <li>required \u9a8c\u8bc1\u6210\u529f success \u6216\u8005\u9a8c\u8bc1\u5931\u8d25 failure\uff0c\u90fd\u4f1a\u7ee7\u7eed\u540e\u7eed\u7684\u9a8c\u8bc1\u6d41\u7a0b\u3002</li> <li>requisite \u5931\u8d25 failure \u7acb\u523b\u8fd4\u56de\u539f\u7a0b\u5e8f\uff0c\u5e76\u7ec8\u6b62\u540e\u7eed\u9a8c\u8bc1\u6d41\u7a0b\u3002\u6210\u529f success \u7ee7\u7eed\u540e\u7eed\u7684\u6d41\u7a0b\u3002</li> <li>sufficient \u6210\u529f success \u7acb\u523b\u8fd4\u56de\u539f\u7a0b\u5e8f\uff0c\u5e76\u7ec8\u6b62\u540e\u7eed\u9a8c\u8bc1\u6d41\u7a0b\u3002\u5931\u8d25 failure \u7ee7\u7eed\u540e\u7eed\u7684\u6d41\u7a0b\u3002</li> <li>optional \u663e\u793a\u8baf\u606f\uff0c\u4e0d\u4f7f\u7528\u5728\u9a8c\u8bc1\u65b9\u9762\u7684\u3002</li> </ul> <p>\u7b2c\u4e09\u4e2a\u5b57\u6bb5\uff1a\u8c03\u7528\u7684 PAM \u6a21\u5757\u3002</p> <p>\u7b2c\u56db\u4e2a\u5b57\u6bb5\uff1a\u8c03\u7528 PAM \u6a21\u5757\u7684\u53c2\u6570\u3002</p>"},{"location":"Operations/Linux/%E7%B3%BB%E7%BB%9F%E5%8A%A0%E5%9B%BA/#_2","title":"\u5bc6\u7801\u5f3a\u5ea6\u914d\u7f6e","text":"<p>\u5bc6\u7801\u5f3a\u5ea6\u6821\u9a8c\u6a21\u5757\uff1alibpam-pwquality</p> <p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff1a <pre><code># \u67e5\u770b\u6709\u6ca1\u6709\u5df2\u7ecf\u914d\u7f6e\u8fc7\u4e86\ngrep pam-pwquality /etc/pam.d/*\n\n# \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 /etc/pam.d/common-password\uff0c\u786e\u4fdd\u5b58\u5728\u4e0b\u9762\u7684\u884c\npassword requisite pam_pwquality.so retry=3 \n\n# \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 /etc/security/pwquality.conf\uff0c\u8bbe\u7f6e\u5bc6\u7801\u590d\u6742\u5ea6\u7b56\u7565\nminlen = 8  # \u81f3\u5c11 8 \u4f4d\ndcredit = -1  # \u81f3\u5c11 1 \u4e2a\u6570\u5b57\nucredit = -1  # \u81f3\u5c11 1 \u4e2a\u5927\u5199\u5b57\u6bcd\nocredit = -1  # \u81f3\u5c11 1 \u4e2a\u7279\u6b8a\u5b57\u7b26\nenforce_for_root  # root \u7528\u6237\u4e5f\u8981\u9075\u5b88\u8fd9\u4e2a\u89c4\u5219\n</code></pre></p>"},{"location":"Operations/Linux/%E7%B3%BB%E7%BB%9F%E5%8A%A0%E5%9B%BA/#_3","title":"\u5bc6\u7801\u6709\u6548\u671f\u914d\u7f6e","text":"<p>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff1a <pre><code># /etc/login.defs\nPASS_MAX_DAYS 90 # \u5bc6\u7801\u6700\u957f\u4f7f\u7528 90 \u5929 \nPASS_MIN_DAYS 7 # \u5bc6\u7801\u6700\u77ed 7 \u5929\u5185\u4e0d\u80fd\u4fee\u6539 \nPASS_WARN_AGE 14 # \u5bc6\u7801\u8fc7\u671f\u524d 14 \u5929\u5f00\u59cb\u63d0\u9192\u7528\u6237\n</code></pre></p> <p>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u53ea\u5bf9\u65b0\u6dfb\u52a0\u7528\u6237\u751f\u6548\uff0c\u7cfb\u7edf\u73b0\u6709\u7528\u6237\u9700\u8981\u624b\u52a8\u66f4\u6539\u3002 <pre><code># \u5bc6\u7801 90 \u5929\u6709\u6548\uff0c7 \u5929\u5185\u4e0d\u80fd\u4fee\u6539\u5bc6\u7801\uff0c\u5230\u671f\u4e4b\u524d 14 \u5929\u63d0\u9192\uff0c\u8fc7\u671f\u4e4b\u540e\u5bbd\u9650 14 \u5929\nchage -M 90 -m 7 -W 14 -I 14 jacky\nchage -l jacky\n</code></pre></p>"},{"location":"Operations/Linux/%E7%B3%BB%E7%BB%9F%E5%8A%A0%E5%9B%BA/#_4","title":"\u767b\u5f55\u5931\u8d25\u9501\u5b9a\u8d26\u53f7","text":"<p>\u767b\u5f55\u5931\u8d25\u9501\u5b9a\u6a21\u5757\uff1alibpam-faillock</p> <p>faillock \u6709\u4e09\u4e2a\u9009\u9879\uff1a</p> <ul> <li>preauth \u9700\u8981\u5728\u8ba4\u8bc1\u4e4b\u524d\u8c03\u7528\uff0c\u68c0\u67e5\u8d26\u53f7\u662f\u5426\u9501\u5b9a\uff0c\u9501\u5b9a\u76f4\u63a5\u7ed3\u675f\u3002</li> <li>authfail \u9700\u8981\u5728\u8ba4\u8bc1\u5931\u8d25\u4e4b\u540e\u8c03\u7528\uff0c\u8bb0\u5f55\u5931\u8d25\u6b21\u6570\u3002</li> <li>authsucc \u9700\u8981\u5728\u8ba4\u8bc1\u6210\u529f\u4e4b\u540e\u8c03\u7528\uff0c\u7528\u6765\u6e05\u9664\u5931\u8d25\u7684\u8bb0\u5f55\uff0c\u5426\u5219 faillock \u65e0\u6cd5\u533a\u5206\u8fde\u7eed\u548c\u975e\u8fde\u7eed\u7684\u8ba4\u8bc1\u5931\u8d25\uff0c\u5bfc\u81f4\u8bef\u9501\u3002</li> </ul> <p>\u914d\u7f6e\uff1a <pre><code># \u67e5\u770b\u6709\u6ca1\u6709\u5df2\u7ecf\u914d\u7f6e\u8fc7\u4e86\ngrep pam_faillock /etc/pam.d/*\n\n# \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff0c\u914d\u7f6e faillock \u53c2\u6570 /etc/security/faillock.conf\n# \u751f\u6210\u5ba1\u8ba1\u65e5\u5fd7\uff1b\u4e0d\u63d0\u793a\u8d26\u53f7\u5df2\u7ecf\u88ab\u9501\u5b9a\uff1b\u8fde\u7eed\u5931\u8d25 3 \u6b21\uff1b\u5728 900 \u79d2\u7684\u65f6\u95f4\u7a97\u53e3\u5185\uff1b\n# \u9501\u5b9a 600 \u79d2\uff1b\u4e0a\u8ff0\u89c4\u5219\u5bf9 root \u7528\u6237\u4e5f\u751f\u6548\uff08\u4fdd\u7559 public key \u8ba4\u8bc1\u65b9\u5f0f\uff0c\u9632\u6b62\u767b\u5f55\u4e0d\u8fdb\u7cfb\u7edf\uff09\u3002\naudit\nsilent\ndeny = 3\nfail_interval = 900\nunlock_time = 600\neven_deny_root\n\n\n# \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u914d\u7f6e /etc/pam.d/common-auth\uff0c\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u6307\u5b9a\u53c2\u6570\uff0c\u8fd9\u91cc\u7684\u4f18\u5148\u7ea7\u66f4\u9ad8\n# requisite \u5931\u8d25\u4e0d\u8fdb\u884c\u540e\u7eed\u7684\u6d41\u7a0b\uff0cpreauth \u68c0\u67e5\u5931\u8d25\u6b21\u6570\uff0c\u5982\u679c\u8fbe\u5230\u9608\u503c\u76f4\u63a5\u7ec8\u6b62\u6d41\u7a0b\uff0c\u5426\u5219\u7ee7\u7eed\nauth    requisite                       pam_faillock.so preauth\n# success=1 \u8868\u793a\u6210\u529f\u4e4b\u540e\u8df3\u8fc7\u540e\u9762\u7684 1 \u6761\u8ba4\u8bc1\u6d41\u7a0b\nauth    [success=1 default=bad]      pam_unix.so nullok\n# \u5982\u679c\u80fd\u6267\u884c\u5230\u8fd9\u4e00\u884c\uff0c\u8868\u793a\u8ba4\u8bc1\u5df2\u7ecf\u5931\u8d25\uff0c\u8bb0\u5f55\u5931\u8d25\u6b21\u6570\uff0cdefault=die \u7ec8\u6b62\u6d41\u7a0b\uff0c\u5982\u679c\u8ba4\u8bc1\u6210\u529f\u4f1a\u8df3\u8fc7\nauth    [default=die]                   pam_faillock.so authfail   \n# \u5982\u679c\u80fd\u6267\u884c\u5230\u8fd9\u4e00\u884c\uff0c\u8868\u793a\u5df2\u7ecf\u8ba4\u8bc1\u6210\u529f\uff0c\u6e05\u9664\u5931\u8d25\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u8fd4\u56de\nauth    sufficient                      pam_faillock.so authsucc\nauth    requisite                       pam_deny.so\nauth    required                        pam_permit.so\n\n\n\n# \u67e5\u770b\u6240\u7528\u7528\u6237\nfaillock\n\n# \u67e5\u770b\u7279\u5b9a\u7528\u6237\nfaillock --user jacky\n\n# \u624b\u52a8\u89e3\u9501\nfaillock --user jacky --reset\n</code></pre></p>"},{"location":"Operations/Linux/%E7%B3%BB%E7%BB%9F%E5%8A%A0%E5%9B%BA/#_5","title":"\u4f1a\u8bdd\u8d85\u65f6\u81ea\u52a8\u9000\u51fa","text":"<pre><code># \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 /etc/profile\uff0c\u914d\u7f6e 900 \u79d2\u81ea\u52a8\u9000\u51fa\u4f1a\u8bdd\nexport TMOUT=900\n</code></pre>"},{"location":"Operations/Linux/%E7%B3%BB%E7%BB%9F%E5%8A%A0%E5%9B%BA/#_6","title":"\u5b89\u5168\u5ba1\u8ba1","text":"<p>\u5ba1\u8ba1\u670d\u52a1\u53ef\u4ee5\u8bb0\u5f55\u8c01\u5728\u4ec0\u4e48\u65f6\u95f4\u505a\u4e86\u4ec0\u4e48\u64cd\u4f5c\uff0c\u5f71\u54cd\u4e86\u54ea\u4e9b\u6587\u4ef6\u3002 <pre><code>apt install auditd\ndpkg -L auditd\n</code></pre></p> <p>auditd \u6838\u5fc3\u5b88\u62a4\u8fdb\u7a0b\u3002 auditctl \u7528\u6237\u7a7a\u95f4\u547d\u4ee4\uff0c\u7528\u4e8e\u6dfb\u52a0\u6216\u5220\u9664\u5ba1\u8ba1\u89c4\u5219\u3002 ausearch \u67e5\u8be2\u5ba1\u8ba1\u65e5\u5fd7\u3002 aureport \u5c06\u65e5\u5fd7\u6574\u7406\u4e3a\u53ef\u8bfb\u62a5\u8868\u3002</p> <p>\u5ba1\u8ba1\u65e5\u5fd7\u7684\u683c\u5f0f</p> <p>\u9ed8\u8ba4\u8bb0\u5f55\u54ea\u4e9b\u4e8b\u4ef6\uff0c\u5982\u4f55\u67e5\u8be2\uff1fausearch \u6709\u54ea\u4e9b\u53c2\u6570</p> <p>\u5ba1\u8ba1\u65e5\u5fd7\u4fdd\u5b58\u591a\u4e45\uff0c\u5982\u4f55\u914d\u7f6e\uff1f\u8981\u81f3\u5c11\u4fdd\u5b58 90 \u5929</p> <p>\u6dfb\u52a0\u76d1\u63a7\u6587\u4ef6\u7684\u89c4\u5219 <pre><code>auditctl -w /root/a.txt -p rwxa -k watch_a\n</code></pre></p> <p>-w \u76d1\u63a7\u6587\u4ef6\u7684\u8def\u5f84 -p rwxa \u76d1\u63a7\u6587\u4ef6\u7684\u8bfb\u3001\u5199\u3001\u6267\u884c\u3001\u5c5e\u6027\u53d8\u66f4\u3002 -k \u6dfb\u52a0\u6807\u7b7e\uff0c\u65b9\u4fbf\u641c\u7d22\u3002</p> <p>\u67e5\u770b\u6dfb\u52a0\u7684\u89c4\u5219 <pre><code>auditctl -l\n</code></pre></p> <p>\u67e5\u8be2\u65e5\u5fd7 <pre><code>ausearch -k watch_a\n</code></pre></p> <p>\u65e5\u5fd7\u751f\u6210\u62a5\u544a <pre><code>ausearch -k watch_a | aureport -f\n</code></pre></p>"},{"location":"Operations/Linux/%E8%99%9A%E6%8B%9F%E6%9C%BA/","title":"\u865a\u62df\u673a","text":"<p>\u53c2\u8003\u94fe\u63a5\uff1ahttps://linux.vbird.org/linux_server/rocky9/0130vmtuning.php</p>"},{"location":"Operations/Linux/%E8%99%9A%E6%8B%9F%E6%9C%BA/#_1","title":"\u73af\u5883\u5b89\u88c5","text":"<p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5KVM\u3001libvirt\u5b88\u62a4\u8fdb\u7a0b\u3001\u4ee5\u53ca\u6865\u63a5\u7f51\u7edc\u5de5\u5177 \u3002 <pre><code>apt install -y qemu-kvm libvirt-daemon-system  bridge-utils\n</code></pre></p> <p>libvirt-daemon-system \u4f1a\u9ed8\u8ba4\u521b\u5efa NAT \u7f51\u7edc\uff0c\u5982\u679c\u6ca1\u6709\u542f\u52a8\u7684\u8bdd\u9700\u8981\u624b\u52a8\u542f\u52a8\uff1a <pre><code>virsh net-list --all\nvirsh net-start default\nvirsh net-autostart default\n</code></pre></p> <p>\u9ed8\u8ba4\u65b0\u589e\u7684\u914d\u7f6e\uff1a <pre><code># iptables -L -n -v --line-numbers\nChain INPUT (policy ACCEPT 0 packets, 0 bytes)\nnum   pkts bytes target     prot opt in     out     source               destination         \n1        0     0 ACCEPT     udp  --  virbr0 *       0.0.0.0/0            0.0.0.0/0            udp dpt:53\n2        0     0 ACCEPT     tcp  --  virbr0 *       0.0.0.0/0            0.0.0.0/0            tcp dpt:53\n3        0     0 ACCEPT     udp  --  virbr0 *       0.0.0.0/0            0.0.0.0/0            udp dpt:67\n4        0     0 ACCEPT     tcp  --  virbr0 *       0.0.0.0/0            0.0.0.0/0            tcp dpt:67\n\nChain FORWARD (policy ACCEPT 0 packets, 0 bytes)\nnum   pkts bytes target     prot opt in     out     source               destination         \n1        0     0 ACCEPT     all  --  *      virbr0  0.0.0.0/0            192.168.122.0/24     ctstate RELATED,ESTABLISHED\n2        0     0 ACCEPT     all  --  virbr0 *       192.168.122.0/24     0.0.0.0/0           \n3        0     0 ACCEPT     all  --  virbr0 virbr0  0.0.0.0/0            0.0.0.0/0           \n4        0     0 REJECT     all  --  *      virbr0  0.0.0.0/0            0.0.0.0/0            reject-with icmp-port-unreachable\n5        0     0 REJECT     all  --  virbr0 *       0.0.0.0/0            0.0.0.0/0            reject-with icmp-port-unreachable\n\nChain OUTPUT (policy ACCEPT 10063 packets, 2716K bytes)\nnum   pkts bytes target     prot opt in     out     source               destination         \n1        0     0 ACCEPT     udp  --  *      virbr0  0.0.0.0/0            0.0.0.0/0            udp dpt:68\n</code></pre></p> <p>\u5b89\u88c5Cockpit\u53ca\u5176\u865a\u62df\u673a\u7ba1\u7406\u63d2\u4ef6 \u3002 <pre><code>apt install -y cockpit cockpit-machines\n</code></pre></p> <p>\u5c06\u60a8\u7684\u7ba1\u7406\u7528\u6237\u52a0\u5165<code>libvirt</code>\u548c<code>kvm</code>\u7528\u6237\u7ec4\uff0c\u8fd9\u6837\u60a8\u5c31\u53ef\u4ee5\u901a\u8fc7Cockpit\u6216<code>virt-manager</code>\u7ba1\u7406\u865a\u62df\u673a\uff0c\u800c\u65e0\u9700\u4e3a\u6bcf\u4e2a\u64cd\u4f5c\u90fd\u8f93\u5165\u5bc6\u7801 \u3002 <pre><code>sudo usermod -aG libvirt,kvm $LOGNAME\n</code></pre></p>"},{"location":"Operations/Linux/%E8%99%9A%E6%8B%9F%E6%9C%BA/#_2","title":"\u78c1\u76d8\u5b58\u50a8\u6c60","text":"<p>\u67e5\u8be2\u5b58\u50a8\u6c60\u5217\u8868 <pre><code># \u5217\u51fa\u6240\u6709\u5b58\u50a8\u6c60 \nvirsh pool-list --all \n\n# \u67e5\u770b\u5b58\u50a8\u6c60\u8be6\u7ec6\u4fe1\u606f\nvirsh pool-info vm_pool \n\n# \u68c0\u67e5\u5b58\u50a8\u6c60XML\u5b9a\u4e49\nvirsh pool-dumpxml vm_pool\n\n# \u505c\u7528\u5b58\u50a8\u6c60\nvirsh pool-destroy vm_pool\n\n# \u5220\u9664\u5b58\u50a8\u6c60\u5b9a\u4e49\nvirsh pool-undefine vm_pool\n\n# \u5237\u65b0\u5b58\u50a8\u6c60\uff08\u68c0\u6d4b\u65b0\u5b58\u50a8\u5377\uff09\nvirsh pool-refresh vm_pool\n</code></pre></p> <p>\u4f7f\u7528\u7269\u7406\u78c1\u76d8\u521b\u5efa\u5b58\u50a8\u6c60 <pre><code># \u6e05\u9664\u5206\u533a\u8868\u548c\u6587\u4ef6\u7cfb\u7edf\u7b7e\u540d\nwipefs -a /dev/sdb\n\n# \u521b\u5efa\u4e00\u4e2a\u5b58\u50a8\u6c60 \nvirsh pool-define-as vm_pool disk --source-dev /dev/sdb --target /var/lib/libvirt/images/vm_pool \nvirsh pool-define-as vm_pool dir --target /data/disk1 \nvirsh pool-build vm_pool \nvirsh pool-start vm_pool \nvirsh pool-autostart vm_pool\n</code></pre></p>"},{"location":"Operations/Linux/%E8%99%9A%E6%8B%9F%E6%9C%BA/#_3","title":"\u5377\u7684\u5e38\u89c1\u683c\u5f0f","text":"\u683c\u5f0f \u7279\u70b9 \u9002\u7528\u573a\u666f \u200b\u200braw\u200b\u200b \u539f\u59cb\u683c\u5f0f\uff0c\u6027\u80fd\u6700\u597d \u9ad8\u6027\u80fd\u9700\u6c42 \u200b\u200bqcow2\u200b\u200b \u652f\u6301\u5feb\u7167\u3001\u538b\u7f29\u3001\u52a0\u5bc6 \u901a\u7528\u865a\u62df\u5316 \u200b\u200bvmdk\u200b\u200b VMware\u517c\u5bb9\u683c\u5f0f \u8de8\u5e73\u53f0\u8fc1\u79fb \u200b\u200bvdi\u200b\u200b VirtualBox\u683c\u5f0f VirtualBox\u73af\u5883 <p>\u521b\u5efa\u5377 <pre><code>virsh vol-create-as vm_pool myvm.qcow2 20G --format qcow2\n</code></pre></p> <p>\u67e5\u8be2\u5377\u4fe1\u606f <pre><code># \u5217\u51fa\u5b58\u50a8\u6c60\u4e2d\u7684\u6240\u6709\u5377\nvirsh vol-list vm_pool\n\n# \u67e5\u770b\u5377\u8be6\u7ec6\u4fe1\u606f\nvirsh vol-info --pool vm_pool myvm.qcow2\n\n# \u67e5\u770b\u5377\u8def\u5f84\uff08\u7528\u4e8e\u865a\u62df\u673a\u914d\u7f6e\uff09\nvirsh vol-path --pool vm_pool myvm.qcow2\n</code></pre></p> <p>\u8c03\u6574\u5377\u5927\u5c0f <pre><code># \u5c06\u5377\u6269\u5c55\u523030GB\nvirsh vol-resize --pool vm_pool myvm.qcow2 30G\n\n# \u6ce8\u610f\uff1a\u6269\u5c55\u540e\u9700\u8981\u5728\u865a\u62df\u673a\u5185\u6269\u5c55\u6587\u4ef6\u7cfb\u7edf\n</code></pre></p>"},{"location":"Operations/Linux/%E8%99%9A%E6%8B%9F%E6%9C%BA/#_4","title":"\u865a\u62df\u673a","text":"<p>\u67e5\u770b\u865a\u62df\u673a\u5217\u8868 <pre><code>virsh list --all\n</code></pre></p> <p>\u5173\u95ed\u865a\u62df\u673a <pre><code># \u5173\u673a\nvirsh shutdown ubuntu-server\n\n# \u65ad\u7535\nvirsh destroy ubuntu-server\n\n# \u5220\u9664\u865a\u62df\u673a\nvirsh undefine ubuntu-server\n\n# \u6e05\u9664\u6240\u6709\u6587\u4ef6\nvirsh undefine test-vm --remove-all-storage\n</code></pre></p> <p>\u67e5\u770b\u865a\u62df\u673a\u7684 IP \u4fe1\u606f</p>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/","title":"\u8d26\u53f7\u7fa4\u7ec4","text":""},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#_1","title":"\u8d26\u53f7","text":"<p>Linux \u5e76\u4e0d\u4f1a\u76f4\u63a5\u8ba4\u8bc6\u8d26\u53f7\u540d\u79f0\uff0c\u53ea\u8ba4\u8bc6\u8d26\u53f7ID\uff08UID\uff09\u548c\u7fa4\u7ec4ID\uff08GID\uff09\u3002 Linux \u767b\u5f55\u8fdb\u5165 Shell \u7684\u6d41\u7a0b\uff1a  </p> <ol> <li>\u5148\u53bb /etc/passwd \u91cc\u9762\u67e5\u627e\u8d26\u53f7\uff0c\u5982\u679c\u6709\u7684\u8bdd\u5c06 UID \u548c GID \u4ee5\u53ca\u8d26\u53f7\u7684\u5bb6\u76ee\u5f55\u548c shell \u914d\u7f6e\u4e00\u8d77\u8bfb\u51fa\u6765\u3002</li> <li>\u6838\u5bf9\u5bc6\u7801\uff0c\u53bb /etc/shadow \u6587\u4ef6\u627e\u51fa\u5bc6\u7801\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5982\u679c\u6b63\u786e\u5c31\u80fd\u591f\u8fdb\u5165 shell\u3002</li> </ol>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#etcpasswd","title":"/etc/passwd \u7684\u6587\u4ef6\u7ed3\u6784\uff1a","text":"<p><pre><code># head -n 4 /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\n</code></pre> \u6bcf\u4e00\u884c\u5171\u6709\u4e03\u4e2a\u90e8\u5206\uff0c\u6bcf\u4e2a\u90e8\u5206\u4f7f\u7528\u5192\u53f7\u9694\u5f00\u3002</p> <ul> <li>\u8d26\u53f7\u3002</li> <li>\u5bc6\u7801\uff0c\u65e9\u671f\u7684 Unix \u5c06\u5bc6\u7801\u653e\u5728\u8fd9\u4e2a\u5b57\u6bb5\u4e0a\uff0c\u4f46\u662f\u7531\u4e8e\u8fd9\u4e2a\u6587\u4ef6\u7684\u8bfb\u6743\u9650\u6240\u6709\u4eba\u90fd\u6709\uff0c\u6240\u4ee5\u540e\u6765\u5c06\u5bc6\u7801\u6539\u5230 /etc/shadow \u6587\u4ef6\u4e2d\uff0c\u56e0\u6b64\u8fd9\u4e2a\u5b57\u6bb5\u76ee\u524d\u90fd\u662f \u201cx\u201d\u3002</li> <li> <p>\u8d26\u53f7\u7684 UID\u3002</p> <p>0\uff1a\u7cfb\u7edf\u7ba1\u7406\u5458\uff0c\u5982\u679c\u60f3\u8981\u8ba9\u5176\u5b83\u8d26\u53f7\u5177\u5907 root \u6743\u9650\uff0c\u53ea\u9700\u8981\u5c06\u8d26\u53f7\u7684 UID \u4fee\u6539\u4e3a 0 \u5373\u53ef\u3002</p> <p>1~499\uff1a\u7cfb\u7edf\u8d26\u53f7\uff0cUID \u9664\u4e86 0 \u4e4b\u5916\u5176\u5b83\u7684\u5e76\u6ca1\u6709\u4ec0\u4e48\u6743\u9650\u7279\u6027\u3002\u9ed8\u8ba4 500 \u4ee5\u4e0b\u7684\u6570\u5b57\u8ba9\u7ed9\u7cfb\u7edf\u4f5c\u4e3a\u4fdd\u7559\u8d26\u53f7\u53ea\u662f\u4e00\u4e2a\u4e60\u60ef\u3002</p> <p>\u7531\u4e8e\u7cfb\u7edf\u4e0a\u4e00\u4e9b\u542f\u52a8\u7684\u670d\u52a1\u6211\u4eec\u53ef\u80fd\u5e0c\u671b\u4ee5\u6bd4\u8f83\u5c0f\u7684\u6743\u9650\u53bb\u8fd0\u884c\uff0c\u4e0d\u5e0c\u671b\u4ee5 root \u7684\u8eab\u4efd\u53bb\u8fd0\u884c\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u533a\u95f4\u7684 UID \u521b\u5efa\u8d26\u53f7\uff0c\u8fd9\u4e9b\u8d26\u53f7\u901a\u5e38\u662f\u4e0d\u53ef\u767b\u5f55\u7684\u3002</p> <p>\u901a\u5e38\u6709\u7ec6\u5206\uff1a1~99 \u6709\u7cfb\u7edf\u81ea\u884c\u521b\u5efa\u7684\u8d26\u53f7\u3002100~499 \u7528\u6237\u6709\u7cfb\u7edf\u8d26\u53f7\u9700\u6c42\u65f6\u53ef\u4ee5\u4f7f\u7528\u7684 UID\u3002</p> <p>500~65535: \u7ed9\u4e00\u822c\u7684\u4f7f\u7528\u8005\uff08\u65b0\u7248\u672c\u7684\u5185\u6838\u652f\u6301\u7684 UID \u4e3a 4 \u5b57\u8282\u5927\u5c0f\uff09\u3002</p> </li> <li> <p>GID \u7528\u6237\u7684\u7ec4ID\uff0c\u4e0e /etc/group \u6587\u4ef6\u76f8\u5173\u3002</p> </li> <li>\u7528\u6237\u4fe1\u606f\u8bf4\u660e\u3002</li> <li>\u7528\u6237\u7684\u5bb6\u76ee\u5f55\uff0c\u767b\u5f55\u4e4b\u540e shell \u9ed8\u8ba4\u7684\u5de5\u4f5c\u76ee\u5f55\u3002</li> <li>shell\uff0c\u767b\u5f55\u4e4b\u540e\u53d6\u5f97\u7684 shell \u7528\u6765\u4e0e\u5185\u6838\u8fdb\u884c\u6c9f\u901a\u3002</li> </ul>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#etcshadow","title":"/etc/shadow \u6587\u4ef6\u7ed3\u6784\uff1a","text":"<pre><code># head -n 4 /etc/shadow\nroot:$y$j9T$lRTGiRgqLqrcjL2OoYzIf1$EiahK3dX/eO9tz6Y6ZTOvFZOHcWWeZA9rlXlKXVDyb.:19592:0:99999:7:::\ndaemon:*:19592:0:99999:7:::\nbin:*:19592:0:99999:7:::\nsys:*:19592:0:99999:7:::\n</code></pre> <ul> <li> <p>\u8d26\u53f7\u540d\u79f0</p> </li> <li> <p>\u5bc6\u7801\uff0c\u901a\u8fc7\u66f4\u65b0\u5bc6\u7801\u53ef\u4ee5\u8ba9\u767b\u5f55\u6682\u65f6\u5931\u6548\u3002</p> </li> <li> <p>\u6700\u8fd1\u66f4\u65b0\u5bc6\u7801\u7684\u65e5\u671f\uff0c\u4ece 1970.1.1 \u5230\u66f4\u65b0\u5bc6\u7801\u65e5\u671f\u7684\u5929\u6570\u3002</p> </li> <li> <p>\u5bc6\u7801\u4e0d\u53ef\u53d8\u52a8\u7684\u5929\u6570\uff08\u4ee5\u7b2c\u4e09\u4e2a\u5b57\u6bb5\u4e3a\u8d77\u59cb\uff09\uff0c\u8ddd\u79bb\u6700\u8fd1\u66f4\u65b0\u5bc6\u7801\u7684\u65e5\u671f\u30020 \u8868\u793a\u968f\u65f6\u53ef\u4ee5\u66f4\u65b0\u5bc6\u7801\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a 20 \u7684\u8bdd\uff0c\u8868\u793a\u66f4\u65b0\u5bc6\u7801\u4e4b\u540e\u7684 20 \u5929\u53ea\u80fd\u4e0d\u80fd\u518d\u6b21\u66f4\u65b0\u5bc6\u7801\u3002</p> </li> <li> <p>\u5bc6\u7801\u9700\u8981\u53d8\u66f4\u7684\u5929\u6570\uff08\u4ee5\u7b2c\u4e09\u4e2a\u5b57\u6bb5\u4e3a\u8d77\u59cb\uff09\u3002\u8bbe\u7f6e\u4e3a 20 \u7684\u8bdd\uff0c\u8868\u793a\u66f4\u65b0\u5bc6\u7801\u4e4b\u540e\u7684 20 \u5929\u5185\u5fc5\u987b\u8981\u66f4\u65b0\u5bc6\u7801\uff0c\u5426\u5219\u5bc6\u7801\u5c06\u4f1a\u8fc7\u671f\uff0c\u518d\u6b21\u767b\u5f55\u7684\u8bdd\u9700\u8981\u66f4\u65b0\u5bc6\u7801\u624d\u80fd\u767b\u5f55\u3002</p> </li> <li> <p>\u5bc6\u7801\u8fc7\u671f\u4e4b\u524d\u7684\u8b66\u544a\u5929\u6570\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a 7\uff0c\u8868\u793a\u5982\u679c\u8fd8\u6709 7 \u5929\u5c31\u8981\u8fc7\u671f\u7684\u8bdd\uff0c\u8fd9\u5929\u5185\u6bcf\u6b21\u767b\u5f55\u90fd\u4f1a\u63d0\u793a\u66f4\u65b0\u5bc6\u7801\u3002</p> </li> <li> <p>\u5bc6\u7801\u8fc7\u671f\u4e4b\u540e\u7684\u5bbd\u9650\u65e5\u671f\uff08\u7b2c\u4e94\u4e2a\u5b57\u6bb5\u8bbe\u7f6e\u7684\u8fc7\u671f\u65f6\u95f4\uff09\uff0c\u8bbe\u7f6e\u4e3a 7 \u8868\u793a\uff0c\u8868\u793a\u5bc6\u7801\u8fc7\u671f\u4e4b\u540e 7 \u5929\u4e4b\u5185\u6ca1\u6709\u66f4\u65b0\u5bc6\u7801\u7684\u8bdd\uff0c\u5bc6\u7801\u5931\u6548\uff0c\u6ca1\u6709\u66f4\u6539\u7684\u673a\u4f1a\u4e5f\u4e0d\u80fd\u5728\u767b\u5f55\u4e86\u3002</p> </li> <li> <p>\u8d26\u53f7\u5931\u6548\u65e5\u671f\uff0c1970 \u5e74\u4ee5\u6765\u7684\u5929\u6570\uff0c\u5931\u6548\u4e4b\u540e\u4e0d\u80fd\u5728\u4f7f\u7528\u8be5\u8d26\u53f7\uff08\u65e0\u8bba\u5bc6\u7801\u662f\u5426\u8fc7\u671f\uff09\u3002</p> </li> <li> <p>\u4fdd\u7559\u5b57\u6bb5\u3002</p> </li> </ul>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#_2","title":"\u7fa4\u7ec4","text":"<p>/etc/group \u6587\u4ef6\u7ed3\u6784\uff1a <pre><code># head -n 4 /etc/group\nroot:x:0:\ndaemon:x:1:\nbin:x:2:\nsys:x:3:\n</code></pre></p> <ul> <li>\u7ec4\u540d\u3002</li> <li>\u7fa4\u7ec4\u5bc6\u7801\uff0c\u5f88\u5c11\u4f7f\u7528\uff0c\u901a\u5e38\u4e0d\u9700\u8981\u914d\u7f6e\uff0c\u5e76\u4e14\u5df2\u7ecf\u79fb\u52a8\u5230 /etc/gshadow\u3002</li> <li>GID \u7fa4\u7ec4ID\u3002</li> <li>\u7fa4\u7ec4\u652f\u6301\u7684\u8d26\u53f7\uff0c\u5373\u7fa4\u7ec4\u91cc\u6709\u54ea\u4e9b\u7528\u6237\uff0c\u7528\u6237\u540d\u9017\u53f7\u9694\u5f00\u3002</li> </ul>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#_3","title":"\u521d\u59cb\u7fa4\u7ec4\u548c\u6709\u6548\u7fa4\u7ec4","text":"<p>\u4e00\u4e2a\u8d26\u53f7\u80fd\u591f\u52a0\u5165\u591a\u4e2a\u7fa4\u7ec4\uff0c\u5728 /etc/passwd \u4e2d\u7684 GID \u5c31\u662f\u7528\u6237\u7684\u521d\u59cb\u7fa4\u7ec4\u3002\u5f53\u7528\u6237\u767b\u5f55 Shell \u4e4b\u540e\uff0c\u7cfb\u7edf\u9ed8\u8ba4\u5c06\u521d\u59cb\u7fa4\u7ec4\u4f5c\u4e3a\u5f53\u524d\u7684\u6709\u6548\u7fa4\u7ec4\u3002  </p> <p>\u4f7f\u7528 groups \u547d\u4ee4\u67e5\u770b\u7fa4\u7ec4\uff0c\u9ed8\u8ba4\u7b2c\u4e00\u4e2a\u5c31\u662f\u6709\u6548\u7fa4\u7ec4\uff1a <pre><code>suomea@suomea01:~$ groups [username]\nsuomea cdrom floppy audio dip video plugdev users netdev\n</code></pre></p> <p>\u5982\u679c\u6b64\u65f6\u521b\u5efa\u6587\u4ef6\uff0c\u90a3\u4e48\u6587\u4ef6\u7684\u6240\u5c5e\u7684\u7fa4\u7ec4\u5c31\u662f\u5f53\u524d\u8d26\u53f7\u7684\u6709\u6548\u7fa4\u7ec4\u3002</p> <p>\u4f7f\u7528 newgrp \u547d\u4ee4\u5207\u6362\u6709\u6548\u7fa4\u7ec4\uff0c\u524d\u63d0\u662f\u5207\u6362\u7684\u7fa4\u7ec4\u662f\u5f53\u524d\u8d26\u53f7\u5df2\u7ecf\u52a0\u5165\u7fa4\u7ec4\u3002 <pre><code>suomea@suomea01:~$ newgrp users\nsuomea@suomea01:~$ groups\nusers cdrom floppy audio dip video plugdev netdev suomea\n</code></pre></p> <p>Note</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f newgrp \u547d\u4ee4\u4f1a\u65b0\u5efa\u4e00\u4e2a shell\uff0c\u65b0 shell \u7684\u6709\u6548\u7fa4\u7ec4\u6539\u4e3a\u4e86 users\uff0c\u4f46\u662f\u5982\u679c\u4f7f\u7528 exit \u9000\u51fa\u65b0 shell \u7684\u8bdd\uff0c\u539f\u6765\u7684 shell \u7684\u6709\u6548\u7fa4\u7ec4\u4ecd\u7136\u662f suomea\u3002</p>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#_4","title":"\u7528\u6237\u7ba1\u7406","text":""},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#_5","title":"\u65b0\u589e\u7528\u6237","text":"<p>useradd \u547d\u4ee4\u3002 <pre><code>useradd [-u UID] [-g \u521d\u59cb\u7fa4\u7ec4\u540d\u79f0] [-G \u6b21\u8981\u7fa4\u7ec4] [-mM] [-c \u8d26\u53f7\u8bf4\u660e] [-d \u5bb6\u76ee\u5f55\u7684\u7edd\u5bf9\u8def\u5f84] [-s shell] \u8d26\u53f7\u540d\u79f0\n\n-u: \u63a5 UID\uff0c\u76f4\u63a5\u624b\u52a8\u6307\u5b9a\u8d26\u53f7\u7684 UID\u3002\n\n-g\uff1a\u6307\u5b9a\u7528\u6237\u7684\u521d\u59cb\u7fa4\u7ec4\u540d\u79f0\u3002\n\n-G\uff1a\u6307\u5b9a\u7528\u6237\u6240\u5c5e\u7684\u7fa4\u7ec4\u3002\n\n-M\uff1a\u5f3a\u5236\u4e0d\u5efa\u7acb\u7528\u6237\u7684\u5bb6\u76ee\u5f55\u3002\n\n-m\uff1a\u5f3a\u5236\u5efa\u7acb\u7528\u6237\u7684\u5bb6\u76ee\u5f55\u3002\n\n-c\uff1a\u8d26\u53f7\u8bf4\u660e\u3002\n\n-d\uff1a\u6307\u5b9a\u7528\u6237\u7684\u5bb6\u76ee\u5f55\uff0c\u7edd\u5bf9\u8def\u5f84\u3002\n\n-r: \u5efa\u7acb\u4e00\u4e2a\u7cfb\u7edf\u8d26\u53f7\uff0cUID \u4f1a\u6709\u9650\u5236\uff0c\u53c2\u8003 /etc/login.defs\n\n-s\uff1a\u6307\u5b9a\u7528\u6237\u767b\u5f55\u540e\u7684 shell\u3002\u5982\u679c\u6307\u5b9a\uff1a-s /sbin/nologin \u5219\u7528\u6237\u4e0d\u80fd\u767b\u5f55\u4e3b\u673a\n\n-e\uff1a\u6307\u5b9a\u5931\u6548\u65e5\u671f\uff0c\u683c\u5f0f yyyy-MM-dd\u3002\u3002\n</code></pre></p> <p>\u65b0\u5efa\u7528\u6237\uff0c\u53ef\u4ee5\u770b\u5230\u9ed8\u8ba4\u65b0\u5efa\u4e86\u540c\u540d\u7684\u7ec4\uff0c\u6307\u5b9a\u4e86\u5bb6\u76ee\u5f55\u548c shell\uff0c\u4f46\u662f\u9ed8\u8ba4\u6ca1\u6709\u8bbe\u7f6e\u5bc6\u7801\u3002</p> <pre><code># useradd suomea\n# grep suomea /etc/passwd /etc/shadow /etc/group\n/etc/passwd:suomea:x:1002:1003::/home/suomea:/bin/sh\n/etc/shadow:suomea:!:19615:0:99999:7:::\n/etc/group:suomea:x:1003:\n</code></pre> <p>\u67e5\u770b\u521b\u5efa\u7528\u6237\u53c2\u6570\u7684\u9ed8\u8ba4\u503c <pre><code>root@VM-4-5-debian:~# useradd -D\nGROUP=100\nHOME=/home\nINACTIVE=-1\nEXPIRE=\nSHELL=/bin/sh\nSKEL=/etc/skel\nCREATE_MAIL_SPOOL=no\nLOG_INIT=yes\n</code></pre> - GROUP=100     GID \u7b49\u4e8e 100 \u7684\u9ed8\u8ba4\u662f users \u7fa4\u7ec4\uff0c\u7cfb\u7edf\u81ea\u5e26\u7684\u3002\u4f46\u662f useradd suomea \u521b\u5efa\u7684 suomea \u8d26\u53f7\u5e76\u4e0d\u662f\u5c5e\u4e8e users \u7fa4\u7ec4\uff0c\u800c\u662f\u65b0\u589e\u4e86\u4e00\u4e2a suomea \u7fa4\u7ec4\u3002\u673a\u5236\u95ee\u9898\uff1a     - \u79c1\u6709\u7fa4\u7ec4\u673a\u5236\uff1a\u7cfb\u7edf\u4f1a\u5efa\u7acb\u4e00\u4e2a\u4e0e\u8d26\u53f7\u4e00\u6837\u7684\u7fa4\u7ec4\u4f5c\u4e3a\u8d26\u53f7\u7684\u521d\u59cb\u7fa4\u7ec4\u3002\u8fd9\u6837\u6bd4\u8f83\u6709\u4fdd\u5bc6\u6027\uff0c\u6bcf\u4e2a\u8d26\u53f7\u90fd\u6709\u81ea\u5df1\u7684\u7fa4\u7ec4\u3002     - \u516c\u5171\u7fa4\u7ec4\u673a\u5236\uff1a\u4ee5 GID 100 \u4f5c\u4e3a\u65b0\u5efa\u8d26\u53f7\u7684\u521d\u59cb\u7fa4\u7ec4\u3002     - \u5982\u4f55\u8bbe\u5b9a\u7fa4\u7ec4\u673a\u5236\uff1a</p> <ul> <li> <p>HOME=/home\uff1a\u8d26\u53f7\u5bb6\u76ee\u5f55\u7684\u57fa\u51c6\u76ee\u5f55\u3002</p> </li> <li> <p>INACTIVE=-1\uff1a\u6307\u5b9a /etc/shadow \u7b2c\u4e03\u4e2a\u5b57\u6bb5\uff0c-1 \u6807\u8bc6\u5bc6\u7801\u6c38\u8fdc\u4e0d\u4f1a\u5931\u6548\u3002</p> </li> <li> <p>EXPIRE=\uff1a\u8d26\u53f7\u7684\u5931\u6548\u65e5\u671f\uff0c\u6307\u5b9a /etc/shadow \u7b2c\u516b\u4e2a\u5b57\u6bb5\u3002</p> </li> <li> <p>SHELL=/bin/sh\uff1a\u9ed8\u8ba4\u4f7f\u7528 shell \u7684\u6587\u4ef6\u540d\uff0c\u5982\u679c\u4e0d\u5141\u8bb8\u8d26\u53f7\u767b\u5f55 shell\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e3a /sbin/nologin\u3002</p> </li> <li> <p>SKEL=/etc/skel\uff1a\u7528\u6237\u5bb6\u76ee\u5f55\u7684\u53c2\u8003\u76ee\u5f55\uff0c\u65b0\u5efa\u7528\u6237\u5bb6\u76ee\u5f55\u7684\u6587\u4ef6\u90fd\u662f\u4ece /etc/skel \u590d\u5236\u8fc7\u53bb\u3002</p> </li> </ul> <p>\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u7684\u53c2\u6570\u4f1a\u5f71\u54cd\u7528\u6237\u65b0\u5efa\u7684\u884c\u4e3a\u53c2\u8003 /etc/login.defs\uff0c\u91cc\u9762\u914d\u7f6e\u4e86\u5bb6\u76ee\u5f55\u7684\u6743\u9650\u7b49\u7b49\u3002</p> <p>\u7528\u6237\u521b\u5efa\u9ed8\u8ba4\u4f1a\u4f7f\u7528\u4ee5\u4e0b\u6587\u4ef6\u6216\u8005\u76ee\u5f55 - /etc/default/useradd\u00a0 \u547d\u4ee4 - /etc/login.defs \u4e00\u4e9b\u914d\u7f6e\u4fe1\u606f - /etc/skel/* \u5bb6\u76ee\u5f55\u7684\u6a21\u677f\u76ee\u5f55</p>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#_6","title":"\u4fee\u6539\u5bc6\u7801","text":"<p>useradd \u65b0\u5efa\u8d26\u53f7\u4e4b\u540e\u662f\u6ca1\u6709\u8bbe\u7f6e\u5bc6\u7801\u7684\uff0c\u4e5f\u5c31\u65e0\u6cd5\u767b\u5f55\uff0c\u53ef\u4ee5\u4f7f\u7528 passwd \u547d\u4ee4\u7ed9\u8d26\u53f7\u8bbe\u7f6e\u5bc6\u7801\u3002 <pre><code>passwd [-l] [-u] [-S] \u8d26\u53f7\n\n-l: \u662f\u5bc6\u7801\u5931\u6548\uff0c\u4f1a\u5728 /etc/shadow \u7b2c\u4e8c\u680f\u6700\u524d\u9762\u52a0\u4e0a !\uff0c\u4f7f\u5bc6\u7801\u5931\u6548\u3002\n\n-u: \u4e0e -l \u76f8\u5bf9\uff0c\u662f unlock \u7684\u610f\u601d\u3002\n\n-S\uff1a\u5217\u51fa\u5bc6\u7801\u76f8\u5173\u7684\u53c2\u6570\uff0c\u5373 shadow \u6587\u4ef6\u5185\u7684\u5927\u90e8\u5206\u4fe1\u606f\u3002\n    root@suomea06:~# passwd -S root\n    root P 2023-08-25 0 99999 7 -1\n\n-n\uff1a\u540e\u9762\u63a5\u5929\u6570\uff0cshadow \u7684\u7b2c\u56db\u4e2a\u5b57\u6bb5\u3002\n\n-x: \u540e\u9762\u63a5\u5929\u6570\uff0cshadow \u7684\u7b2c\u4e94\u4e2a\u5b57\u6bb5\u3002\n\n-w\uff1a\u540e\u9762\u63a5\u5929\u6570\uff0cshadow \u7684\u7b2c\u516d\u4e2a\u5b57\u6bb5\u3002\n\n-i: \u540e\u9762\u63a5\u65e5\u671f\uff0cshadow \u7684\u7b2c\u4e03\u4e2a\u5b57\u6bb5\u3002\n</code></pre></p> <p>\u4fee\u6539 suomea \u8d26\u53f7\u7684\u5bc6\u7801  <code>passwd suomea</code>\uff0c\u4fee\u6539\u5f53\u524d\u767b\u5f55\u8d26\u53f7\u7684\u5bc6\u7801 <code>passwd</code>\u3002</p> <p>\u4e5f\u53ef\u4f7f\u4f7f\u7528 chage \u547d\u4ee4\u67e5\u770b\u5bc6\u7801\u7684\u8be6\u7ec6\u53c2\u6570\u4fe1\u606f <pre><code>chage [-ldEImMw] \u8d26\u53f7\u540d\u79f0\n\n-l\uff1a\u5217\u51fa\u8d26\u53f7\u7684\u8be6\u7ec6\u5bc6\u7801\u53c2\u6570\n    root@suomea06:~# chage -l suomea\n    Last password change\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: Aug 25, 2023\n    Password expires\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: never\n    Password inactive\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: never\n    Account expires\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: never\n    Minimum number of days between password change\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: 0\n    Maximum number of days between password change\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: 99999\n    Number of days of warning before password expires\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: 7\n\n-d\uff1a\u540e\u9762\u63a5\u65e5\u671f\uff0c\u4fee\u6539 shadow \u7b2c\u4e09\u4e2a\u5b57\u6bb5\uff0cyyyy-MM-dd\n\n-E\uff1a\u540e\u9762\u63a5\u65e5\u671f\uff0c\u4fee\u6539 shadow \u7b2c\u516b\u4e2a\u5b57\u6bb5\uff0cyyyy-MM-dd\n\n-I\uff1a\u540e\u9762\u63a5\u5929\u6570\uff0c\u4fee\u6539 shadow \u7b2c\u4e03\u4e2a\u5b57\u6bb5\u3002\n\n-m\uff1a\u540e\u9762\u63a5\u5929\u6570\uff0c\u4fee\u6539 shadow \u7b2c\u56db\u4e2a\u5b57\u6bb5\u3002\n\n-M\uff1a\u540e\u9762\u63a5\u5929\u6570\uff0c\u4fee\u6539 shadow \u7b2c\u4e94\u4e2a\u5b57\u6bb5\u3002\n\n-W\uff1a\u540e\u9762\u63a5\u5929\u6570\uff0c\u4fee\u6539 shadow \u7b2c\u516d\u5b57\u6bb5\u3002\n</code></pre></p>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#_7","title":"\u66f4\u65b0\u7528\u6237","text":"<p>\u5982\u679c\u4f7f\u7528 useradd \u547d\u4ee4\u6dfb\u52a0\u7528\u6237\u65f6\u6307\u5b9a\u4e86\u9519\u8bef\u7684\u9009\u9879\uff0c\u5f53\u7136\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539 /etc/passwd \u6216\u8005 /etc/shadow \u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 usermod \u8fdb\u884c\u8d26\u53f7\u7684\u7ec6\u90e8\u8bbe\u5b9a\u66f4\u65b0\u3002 <pre><code>usermod [-cdegGlsuLU] \u8d26\u53f7\n\n-c\uff1a\u540e\u9762\u63a5\u8d26\u53f7\u8bf4\u660e\uff0c\u5373 /etc/passwd \u7b2c\u4e94\u680f\u7684\u8bf4\u660e\n\n-d: \u540e\u9762\u63a5\u8d26\u53f7\u7684\u5bb6\u76ee\u5f55\uff0c\u5373\u4fee\u6539 /etc/passwd \u7684\u7b2c\u516d\u680f\u3002\n\n-e\uff1a\u540e\u9762\u63a5\u65e5\u671f\uff0cshadow \u7b2c\u516b\u4e2a\u5b57\u6bb5\uff0cyyyy-MM-dd \u683c\u5f0f\u3002\n\n-f\uff1a\u540e\u9762\u63a5\u5929\u6570\uff0cshadow \u7b2c\u4e03\u4e2a\u5b57\u6bb5\u3002\n\n-g\uff1a\u540e\u9762\u63a5\u521d\u59cb\u7fa4\u7ec4\uff0c\u4fee\u6539 /etc/passwd \u7b2c\u56db\u4e2a\u5b57\u6bb5\u3002\n\n-G\uff1a\u540e\u9762\u63a5\u6b21\u8981\u7fa4\u7ec4\uff0c\u662f\u8fd9\u4e2a\u8d26\u53f7\u52a0\u5165\u8fd9\u4e2a\u7fa4\u7ec4\uff0c\u4fee\u6539\u7684\u65f6 /etc/group\n\n-l: \u540e\u9762\u63a5\u8d26\u53f7\u540d\u79f0\uff0c\u4fee\u6539\u8d26\u53f7\u540d\u79f0\uff0c\u5373 /etc/passwd \u7684\u7b2c\u4e00\u680f\u3002\n\n-s: \u540e\u9762\u63a5 shell \u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002\n\n-u: \u540e\u9762\u63a5 UID \u6570\u5b57\uff0c\u4fee\u6539 /etc/passwd \u7b2c\u4e09\u680f\u3002\n\n-L: \u6682\u65f6\u51bb\u7ed3\u7528\u6237\u5bc6\u7801\uff0c\u4f7f\u7528\u6237\u65e0\u6cd5\u767b\u5f55\u3002\u4ec5\u4fee\u6539 /etc/shadow \u7684\u5bc6\u7801\u680f\u3002\n\n-U\uff1a\u5c06 shadow \u5bc6\u7801\u680f\u7684 ! \u62ff\u6389\u3002\u89e3\u51bb\u3002\n</code></pre></p>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#_8","title":"\u5220\u9664\u7528\u6237","text":"<p>userdel \u5220\u9664\u7528\u6237\u76f8\u5173\u7684\u6570\u636e - \u8d26\u53f7\u5bc6\u7801\u76f8\u5173\u7684\u53c2\u6570 /etc/passwd\uff0c/etc/shadow - \u7fa4\u7ec4\u76f8\u5173\u7684\u53c2\u6570 /etc/group\uff0c/etc/shadow - \u4e2a\u4eba\u6587\u4ef6\u6570\u636e /home/username\uff0c/var/spool/mail/username </p> <p>\u786e\u5b9a\u8981\u5b8c\u5168\u5220\u9664\u7528\u6237\u4e4b\u524d\uff0c\u6700\u597d\u5148\u67e5\u627e\u4e00\u4e0b\u7528\u6237\u5728\u7cfb\u7edf\u4e2d\u6709\u54ea\u4e9b\u6587\u4ef6\uff0cfind / -user username</p> <pre><code>userdel [-r] username\n\n-r: \u8fde\u540c\u7528\u6237\u7684\u5bb6\u76ee\u5f55\u4e00\u8d77\u5220\u9664\u3002\n\n\u786e\u5b9a\u8981\u5b8c\u5168\u5220\u9664\u7528\u6237\u4e4b\u524d\uff0c\u6700\u597d\u5148\u67e5\u627e\u4e00\u4e0b\u7528\u6237\u5728\u7cfb\u7edf\u4e2d\u6709\u54ea\u4e9b\u6587\u4ef6\uff0cfind / -user username\n</code></pre>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#uid","title":"\u67e5\u8be2\u81ea\u5df1\u7684 UID","text":"<pre><code>id [username]\n</code></pre>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#_9","title":"\u65b0\u589e\u7fa4\u7ec4","text":"<pre><code>groupadd [-g gid] [-r] \u7ec4\u540d\n\n-g: \u6307\u5b9a GID\n\n-r\uff1a\u5efa\u7acb\u7cfb\u7edf\u7fa4\u7ec4\n</code></pre>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#_10","title":"\u4fee\u6539\u7fa4\u7ec4","text":"<pre><code>groupmod [-g gid] [-n group_name] \u7fa4\u7ec4\u540d\u79f0\n\n-g \u4fee\u6539\u73b0\u6709\u7684\u7fa4\u7ec4 GID\n\n-n \u4fee\u6539\u73b0\u6709\u7684\u7ec4\u540d\n</code></pre>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#_11","title":"\u5220\u9664\u7fa4\u7ec4","text":"<p>\u5220\u9664\u7fa4\u7ec4\u540d\u79f0\u662f\u6709\u9650\u5236\u7684\uff0c\u786e\u4fdd\u6ca1\u6709\u8d26\u53f7\u7684\u521d\u59cb\u7fa4\u7ec4\u4e4b\u540e\u624d\u80fd\u5141\u8bb8\u5220\u9664\u8be5\u7fa4\u7ec4\u3002 <pre><code>groupdel \u7fa4\u7ec4\u540d\u79f0\n</code></pre></p>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#su-sudo","title":"su \u548c sudo","text":"<p>Login shell \u548c Non-login shell \u767b\u5f55 shell \u4f1a\u52a0\u8f7d\u5168\u5c40\u7684\u914d\u7f6e\u6587\u4ef6 /etc/profile \u548c\u7528\u6237\u7684\u914d\u7f6e\u6587\u4ef6 <code>~/.bashrc</code>\u3001<code>~/.profile</code>\u3002\u800c\u975e\u767b\u5f55 shell \u4e0d\u4f1a\u52a0\u8f7d\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\uff0c\u53ea\u4f1a\u52a0\u8f7d\u7528\u6237\u4e2a\u4eba\u7684 shell \u914d\u7f6e\u3002</p> <p>\u5982\u679c\u5728\u767b\u5f55 shell \u6267\u884c <code>bash</code> \u547d\u4ee4\uff0c\u5219\u4f1a\u542f\u52a8\u4e00\u4e2a\u65b0\u7684\u975e\u767b\u5f55 shell\uff0c\u4f46\u662f\u65b0\u7684 shell \u4f1a\u7ee7\u627f\u7236\u7ea7 shell \u7684\u73af\u5883\u53d8\u91cf\u3002</p>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#su","title":"su \u5207\u6362\u5230\u6307\u5b9a\u7528\u6237","text":"<p>\u5207\u6362\u5230 root \u7528\u6237\uff0c\u9700\u8981\u8f93\u5165 root \u7528\u6237\u5bc6\u7801\uff1a <pre><code>su [-] [username]\n\u5982\u679c\u52a0\u4e0a -\uff0c\u5c31\u7b97\u662f\u767b\u5f55 shell \u5426\u5219\u5c31\u7b97\u662f\u975e\u767b\u5f55 shell\u3002username \u5982\u679c\u7701\u7565\uff0c\u9ed8\u8ba4\u4e3a root\u3002\n</code></pre></p> <p>\u5207\u6362\u5230\u7528\u6237 <code>user1</code>\uff0c\u9700\u8981\u8f93\u5165\u6307\u5b9a\u7528\u6237\u5bc6\u7801\uff1a <pre><code>su user1\n</code></pre></p> <p>\u4f7f\u7528 root \u7528\u6237\u8eab\u4efd\u6267\u884c\u547d\u4ee4\uff1a <pre><code>su -c \"ls /root\"\n</code></pre></p>"},{"location":"Operations/Linux/%E8%B4%A6%E5%8F%B7%E7%BE%A4%E7%BB%84/#sudo-root","title":"sudo \u4e34\u65f6\u4ee5 root \u6216\u5176\u4ed6\u7528\u6237\u7684\u8eab\u4efd\u6267\u884c\u547d\u4ee4","text":"<p>\u666e\u901a\u7528\u6237\u9700\u8981\u5728 /etc/sudoers \u4e2d\u914d\u7f6e\uff0c\u624d\u80fd\u6267\u884c sudo \u547d\u4ee4\u3002\u5982\u679c\u7528\u6237\u88ab\u6dfb\u52a0\u5230 sudo \u7ec4\uff0c\u4e5f\u53ef\u4ee5\u6267\u884c sudo \u547d\u4ee4\u3002</p> <p>\u5207\u6362\u5230 root \u7528\u6237\uff0c\u9700\u8981\u8f93\u5165\u5f53\u524d\u7528\u6237\u5bc6\u7801\uff1a <pre><code>sudo -i\n\u767b\u5f55 shell\n</code></pre></p> <p>\u4ee5 root \u8eab\u4efd\u6267\u884c\u547d\u4ee4\uff0c\u9700\u8981\u8f93\u5165\u5f53\u524d\u7528\u6237\u5bc6\u7801\uff1a <pre><code>sudo ls -l /root\n</code></pre></p>"},{"location":"Operations/Linux/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/","title":"\u8f6f\u4ef6\u5b89\u88c5","text":""},{"location":"Operations/Linux/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/#_1","title":"\u4ecb\u7ecd","text":"<p>\u5728\u65e9\u671f\u7684 Unix/Linux \u7cfb\u7edf\u4e2d\u5b89\u88c5\u8f6f\u4ef6\u76f8\u5f53\u8d39\u65f6\u8d39\u529b\uff0c\u7cfb\u7edf\u7ba1\u7406\u5458\u9700\u8981\u4ece\u6e90\u7801\u7f16\u8bd1\u8f6f\u4ef6\u5e76\u4e3a\u81ea\u5df1\u7684\u7cfb\u7edf\u505a\u5404\u79cd\u8c03\u6574\uff0c\u751a\u81f3\u4fee\u6539\u6e90\u7801\u3002\u8fd9\u6837\u867d\u7136\u589e\u5f3a\u4e86\u7528\u6237\u5b9a\u5236\u7684\u81ea\u7531\u5ea6\uff0c\u4f46\u5728\u5404\u79cd\u5c0f\u7684\u7ec6\u8282\u4e0a\u8017\u8d39\u5de8\u5927\u7684\u7cbe\u529b\u663e\u7136\u662f\u7f3a\u4e4f\u6548\u7387\u7684\u3002</p> <p>\u8f6f\u4ef6\u5305\u7ba1\u7406\u4f7f\u5f97\u7ba1\u7406\u5458\u4ece\u5404\u79cd\u517c\u5bb9\u6027\u7684\u95ee\u9898\u4e2d\u89e3\u8131\u51fa\u6765\uff0c\u8f6f\u4ef6\u5305\u5b89\u88c5\u4f7f\u8f6f\u4ef6\u5b89\u88c5\u6210\u4e3a\u4e86\u4e00\u7cfb\u5217\u4e0d\u53ef\u5206\u5272\u7684\u539f\u5b50\u64cd\u4f5c\u3002\u4e00\u65e6\u53d1\u751f\u9519\u8bef\uff0c\u53ef\u4ee5\u5378\u8f7d\u8f6f\u4ef6\u5305\uff0c\u4e5f\u53ef\u4ee5\u91cd\u65b0\u5b89\u88c5\u3002\u4f7f\u7528\u8f6f\u4ef6\u5305\u7cfb\u7edf\u5b89\u88c5\u8f6f\u4ef6\u540c\u6837\u9700\u8981\u8003\u8651\u4f9d\u8d56\u6027\u95ee\u9898\uff0c\u53ea\u6709\u5e94\u7528\u8f6f\u4ef6\u6240\u4f9d\u8d56\u7684\u6240\u6709\u5e93\u548c\u652f\u6301\u90fd\u5df2\u7ecf\u6b63\u786e\u5b89\u88c5\u597d\u4e86\uff0c\u8f6f\u4ef6\u624d\u80fd\u88ab\u6b63\u786e\u5b89\u88c5\u3002</p> <p>\u4e00\u4e9b\u9ad8\u7ea7\u7684\u8f6f\u4ef6\u5305\u5de5\u5177\u53ef\u4ee5\u81ea\u52a8\u89e3\u6790\u4f9d\u8d56\u5173\u7cfb\u5e76\u5b89\u88c5\u8f6f\u4ef6\u3002</p>"},{"location":"Operations/Linux/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/#dpkg","title":"dpkg","text":"<p>Debian Pakcage\uff0cdpkg --help \u67e5\u770b\u5e2e\u52a9\u6587\u6863\u3002</p>"},{"location":"Operations/Linux/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/#_2","title":"\u5b89\u88c5","text":"<p>Debian \u4f7f\u7528 dpkg \u7ba1\u7406\u8f6f\u4ef6\u5305\uff0c\u8fd9\u4e9b\u8f6f\u4ef6\u5305\u901a\u5e38\u4ee5 .deb \u7ed3\u5c3e\u3002</p> <p>dpkg \u4f7f\u7528 --install \u9009\u9879\u5b89\u88c5\uff0c\u8fd9\u4e2a\u9009\u9879\u4e5f\u53ef\u4ee5\u7b80\u5199\u4e3a -i\uff0c-i \u9009\u9879\u4f1a\u5728\u5b89\u88c5\u8f6f\u4ef6\u5305\u4e4b\u524d\u628a\u7cfb\u7edf\u4e0a\u539f\u6709\u7684\u65e7\u7684\u7248\u672c\u5220\u9664\u3002</p>"},{"location":"Operations/Linux/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/#_3","title":"\u67e5\u8be2","text":"<p>\u67e5\u770b\u5f53\u524d\u7cfb\u7edf\u5b89\u88c5\u7684\u8f6f\u4ef6\u7248\u672c\u4fe1\u606f openssh \u4e3a\u4f8b\uff1a <pre><code>root@suomea01:~# dpkg -l | grep openssh\nii  openssh-client                          1:9.2p1-2+deb12u1                   amd64        secure shell (SSH) client, for secure access to remote machines\nii  openssh-server                          1:9.2p1-2+deb12u1                   amd64        secure shell (SSH) server, for secure access from remote machines\nii  openssh-sftp-server                     1:9.2p1-2+deb12u1                   amd64        secure shell (SSH) sftp server module, for SFTP access from remote machines\n</code></pre></p> <p>\u67e5\u770b\u5b89\u88c5\u8f6f\u4ef6\u5411\u7cfb\u7edf\u4e2d\u590d\u5236\u4e86\u90a3\u4e9b\u6587\u4ef6\uff1a <pre><code>root@suomea01:~# dpkg -S openssh\nopenssh-client: /usr/share/doc/openssh-client/changelog.Debian.gz\nopenssh-server: /usr/share/lintian/overrides/openssh-server\nopenssh-client: /usr/lib/openssh/ssh-pkcs11-helper\nopenssh-server: /etc/ufw/applications.d/openssh-server\n\u00b7\u00b7\u00b7\n</code></pre></p>"},{"location":"Operations/Linux/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/#_4","title":"\u5378\u8f7d","text":"<p>\u4f7f\u7528 --remove \u6216\u8005 -r \u9009\u9879\u5378\u8f7d\u5df2\u7ecf\u5b89\u88c5\u7684\u8f6f\u4ef6\u5305\u3002</p>"},{"location":"Operations/Linux/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/#apt","title":"APT","text":"<p>\u5168\u79f0\u4e3a Advanced Package Tool\uff0c\u5373\u9ad8\u7ea7\u8f6f\u4ef6\u5305\u5de5\u5177\u3002\u5b83\u53ef\u4ee5\u81ea\u52a8\u68c0\u6d4b\u8f6f\u4ef6\u4f9d\u8d56\u95ee\u9898\uff0c\u4e0b\u8f7d\u548c\u5b89\u88c5\u6240\u6709\u7684\u6587\u4ef6\u3002</p> <p>apt -h \u67e5\u770b\u5e2e\u52a9\u6587\u6863\u3002</p> <p>\u6a21\u62df\u5b89\u88c5\uff0c\u53ea\u663e\u793a\u5c06\u8981\u5b89\u88c5\u6216\u8005\u5347\u7ea7\u7684\u5305\u548c\u4f9d\u8d56\uff0c\u4e0d\u4f1a\u771f\u6b63\u7684\u5b89\u88c5\u3002 <pre><code>apt install --simulate samba\n--simulate \u4e0d\u4f1a\u771f\u6b63\u5b89\u88c5\uff0c\u53ea\u663e\u793a\u5c06\u8981\u5b89\u88c5\u7684\u5305\u548c\u4f9d\u8d56\u3002\n</code></pre></p>"},{"location":"Operations/Linux/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/#_5","title":"\u8f6f\u4ef6\u6e90","text":"<p>\u6240\u6709\u7528\u4e8e apt \u4e0b\u8f7d\u8f6f\u4ef6\u7684\u5730\u5740\u901a\u5e38\u79f0\u4e3a\u5b89\u88c5\u6e90\u3002</p> <p>Debian 12 \u914d\u7f6e\u6e05\u534e\u8f6f\u4ef6\u6e90\uff0c\u7f16\u8f91 <code>/etc/apt/source.list</code> \u6587\u4ef6\u3002 <pre><code>deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware\n\ndeb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware\n\ndeb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware\n\ndeb https://security.debian.org/debian-security bookworm-security main contrib non-free non-free-firmware\n# deb-src https://security.debian.org/debian-security bookworm-security main contrib non-free non-free-firmware\n</code></pre></p>"},{"location":"Operations/Linux/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/#_6","title":"\u67e5\u627e\u8f6f\u4ef6","text":"<p>apt search regex</p> <p>\u8be5\u547d\u4ee4\u4f1a\u67e5\u627e\u8f6f\u4ef6\u540d\u548c\u8f6f\u4ef6\u63cf\u8ff0\uff0c\u5982\u679c\u8f6f\u4ef6\u540d\u6216\u8005\u8f6f\u4ef6\u63cf\u8ff0\u5339\u914d\u67e5\u8be2\u5b57\u7b26\u4e32\uff0c\u5219\u4f1a\u5728\u8f93\u51fa\u4e2d\u5c55\u793a\u8f6f\u4ef6\u540d\u548c\u7b80\u77ed\u7684\u63cf\u8ff0\u3002</p> <p>--full\uff1a\u9009\u9879\u5219\u5c55\u793a\u5168\u90e8\u63cf\u8ff0\u3002\u56e0\u4e3a\u9ed8\u8ba4\u641c\u7d22\u5168\u90e8\u63cf\u8ff0\u800c\u53ea\u5c55\u793a\u7b80\u77ed\u63cf\u8ff0\uff0c\u8f93\u51fa\u53ef\u80fd\u4f1a\u9020\u6210\u56f0\u60d1\u3002</p> <p>--names-only\uff1a\u9009\u9879\u6307\u5b9a\u641c\u9501\u53ea\u5339\u914d\u8f6f\u4ef6\u540d\u79f0\uff0c\u4e0d\u641c\u7d22\u8f6f\u4ef6\u63cf\u8ff0\u3002</p>"},{"location":"Operations/Linux/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/#_7","title":"\u5b89\u88c5\u8f6f\u4ef6","text":"<p>\u5982\u679c\u8f6f\u4ef6\u6e90\u53ea\u6709\u4e00\u4e2a\u7248\u672c\u7684\u8f6f\u4ef6\uff0c\u60f3\u8981\u5b89\u88c5\u5176\u5b83\u7684\u7248\u672c\u600e\u4e48\u5904\u7406\uff1f</p>"},{"location":"Operations/Linux/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/#_8","title":"\u5378\u8f7d\u8f6f\u4ef6","text":""},{"location":"Operations/Nginx/Nginx%20Tips/","title":"Nginx Tips","text":""},{"location":"Operations/Nginx/Nginx%20Tips/#uri","title":"URI","text":"<p>\u53c2\u8003 RFC 3986\uff0c\u5b8c\u6574\u7ed3\u6784\u5982\u4e0b\uff1a <pre><code>foo://example.com:8042/over/there?name=ferret#nose\n\\_/   \\______________/\\_________/ \\_________/ \\__/\n |          |             |           |       |\nscheme  authority        path       query  fragment\n\nscheme:[//authority]path[?query][#fragment]\n</code></pre></p> <p>authority \u90e8\u5206\u7684\u683c\u5f0f\uff1a<code>[userinfo@]host[:port]</code> </p> <ul> <li><code>userinfo</code> \u90e8\u5206\u662f\u53ef\u9009\u7684\uff0c\u4f8b\u5982\uff1a<code>admin:123456@</code>\u3002</li> <li><code>host</code> \u57df\u540d\u6216 IP \u5730\u5740\u3002</li> <li><code>port</code> \u90e8\u5206\u4e5f\u662f\u53ef\u9009\u7684\uff0c\u9ed8\u8ba4\u6839\u636e\u534f\u8bae\u63a8\u65ad\u3002</li> </ul> <p>fragment \u4ee5 <code>#</code> \u5f00\u5934\uff0c\u7528\u4e8e\u6807\u8bc6\u8d44\u6e90\u5185\u7684\u67d0\u4e2a\u90e8\u5206\uff08\u5982 HTML \u951a\u70b9\uff09\uff0c\u4e0d\u4f1a\u53d1\u9001\u5230\u670d\u52a1\u5668\uff0c\u4ec5\u7531\u5ba2\u6237\u7aef\u5904\u7406\u3002</p>"},{"location":"Operations/Nginx/Nginx%20Tips/#nginx-server","title":"Nginx \u5173\u95ed Server \u54cd\u5e94\u5934","text":"<p>\u9ed8\u8ba4 <code>Nginx</code> \u4f1a\u5728\u54cd\u5e94\u5934 <code>Server</code> \u4e2d\u643a\u5e26\u7248\u672c\u4fe1\u606f\uff0c\u5728 <code>http</code> \u57df\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\u9690\u85cf <code>Server</code> \u54cd\u5e94\u5934\u4e2d\u7684\u7248\u672c\u53f7\u3002 \u53c2\u8003\uff1ahttps://nginx.org/en/docs/http/ngx_http_core_module.html <pre><code>server_tokens off;\n</code></pre></p>"},{"location":"Operations/Nginx/Nginx%20Tips/#nginx","title":"Nginx \u914d\u7f6e\u5141\u8bb8\u4e0a\u4f20\u7684\u6587\u4ef6\u5927\u5c0f","text":"<pre><code>server {\n    listen       8088 ;\n    client_max_body_size 100m; \n\n    location / { \n        root   /data/frontend/service/dist;\n        index  index.html index.htm;\n        try_files $uri $uri/ /index.html;\n    }\n}   \n</code></pre>"},{"location":"Operations/Nginx/Nginx%20Tips/#nginx-location","title":"Nginx location \u7684\u5339\u914d\u7528\u6cd5","text":"<p><code>location</code> \u5982\u679c\u4e0d\u6307\u5b9a\u4fee\u9970\u7b26\uff0c\u5219\u9ed8\u8ba4\u4e3a\u524d\u7f00\u5339\u914d\u3002\u4f7f\u7528\u8bed\u6cd5\u5982\u4e0b\uff1a <pre><code>location [=|~|~*|^~|@] pattern {...}\n</code></pre></p>"},{"location":"Operations/Nginx/Nginx%20Tips/#_1","title":"\u5b8c\u5168\u5339\u914d <code>=</code>","text":"<p>\u5047\u8bbe <code>location</code> \u914d\u7f6e\u5982\u4e0b\uff1a <pre><code>location /test {\n    ...\n}\n</code></pre></p> <p>\u8bf7\u6c42\u8def\u5f84 <code>/test</code> \u5339\u914d\u3002 \u8bf7\u6c42\u8def\u5f84 <code>/TEST</code> \u53d6\u51b3\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u662f\u5426\u5927\u5c0f\u5199\u654f\u611f\u3002 \u8bf7\u6c42\u8def\u5f84 <code>/test?param=1</code> \u5339\u914d\uff0c\u67e5\u8be2\u53c2\u6570\u7684\u90e8\u5206\u4e0d\u53c2\u4e0e\u5339\u914d\u3002 \u8bf7\u6c42\u8def\u5f84 <code>/test/</code> \u4e0d\u5339\u914d\u3002 \u8bf7\u6c42\u8def\u5f84 <code>/testabc</code> \u4e0d\u5339\u914d\u3002  </p>"},{"location":"Operations/Nginx/Nginx%20Tips/#_2","title":"\u533a\u5206\u5927\u5c0f\u5199\u7684\u6b63\u5219\u5339\u914d <code>~</code>","text":"<p>\u5047\u8bbe <code>location</code> \u7684\u914d\u7f6e\u5982\u4e0b \uff1a <pre><code>location ~ ^/test {\n    ...\n}\n</code></pre></p>"},{"location":"Operations/Nginx/Nginx%20Tips/#_3","title":"\u4e0d\u5206\u533a\u5927\u5c0f\u5199\u7684\u6b63\u5219\u5339\u914d ~*","text":""},{"location":"Operations/Nginx/Nginx%20Tips/#nginx-location-proxy_pass","title":"Nginx \u63a5\u53e3\u8f6c\u53d1 <code>location</code> \u548c <code>proxy_pass</code>","text":"<p>\u5982\u679c <code>proxy_pass</code> \u4e0d\u5305\u542b <code>path</code>\uff0c\u90a3\u4e48 <code>location</code> \u5339\u914d\u5230\u7684 <code>path</code> \u4f1a\u8ffd\u52a0\u5230 <code>proxy_pass</code> \u7684 <code>port</code> \u540e\u9762\u3002</p> <p>\u5047\u8bbe\u524d\u7f00\u5339\u914d\u7684\u914d\u7f6e\u5982\u4e0b\uff1a <pre><code>location /test1 {\n    proxy_pass http://localhost:8080;\n}\n</code></pre> \u8bf7\u6c42 <code>path</code> <code>/test1/abc</code> \u5c06\u88ab\u8f6c\u53d1\u5230\uff1a<code>http://localhost:8080/test1/abc</code>\u3002</p> <p>\u5982\u679c <code>proxy_pass</code> \u5305\u542b <code>path</code>\uff0c\u5373\u4f7f <code>path</code> \u4ec5\u4ec5\u53ea\u662f\u4e00\u4e2a <code>/</code>\uff0c\u90a3\u4e48\u8f6c\u53d1\u89c4\u5219\u5c31\u53d8\u6210\uff1a\u5c06\u5339\u914d\u7684 <code>path</code> \u5220\u9664 <code>location</code> \u5339\u914d\u7684\u90e8\u5206\uff0c\u7136\u540e\u5c06\u5f97\u5230\u7684\u5b57\u7b26\u4e32\u62fc\u63a5\u5230 <code>proxy_pass</code> \u540e\u9762\u3002</p> <p>\u5047\u8bbe\u524d\u7f00\u5339\u914d\u7684\u914d\u7f6e\u5982\u4e0b\uff1a <pre><code>location /test1 {\n    proxy_pass http://localhost:8080/;\n}\n</code></pre> \u8bf7\u6c42 <code>path</code> <code>/test1/abc</code> \u5c06\u88ab\u8f6c\u53d1\u5230\uff1a<code>http://localhost:8080//abc</code>\u3002</p>"},{"location":"Operations/Nginx/Nginx%20Tips/#nginx-root-alias","title":"Nginx \u914d\u7f6e\u9759\u6001\u6587\u4ef6\u8def\u5f84 root \u548c alias","text":"<p>root \u5c06 location \u5339\u914d\u7684\u90e8\u5206\u76f4\u63a5\u62fc\u63a5\u5728 root \u6307\u5b9a\u7684\u76ee\u5f55\u540e\u9762\u3002</p> <p>alias \u5c06 location \u5339\u914d\u7684\u90e8\u5206\u5220\u6389\uff0c\u7136\u540e\u5c06\u5269\u4f59\u7684\u90e8\u5206\u62fc\u63a5\u5728 alias \u6307\u5b9a\u7684\u76ee\u5f55\u540e\u9762\u3002alias \u4e00\u822c\u4f7f\u7528\u65f6\uff0clocation \u5339\u914d\u8def\u5f84\u548c alias \u6307\u5b9a\u7684\u76ee\u5f55\u6700\u540e\u90fd\u8981\u5e26\u4e0a\u5b57\u7b26 \u201c/\u201d\u3002 </p> <p>\u5982\u679c\u662f\u6b63\u5219\u5339\u914d\uff0c\u53ef\u4ee5\u4f7f\u7528 $ \u7b26\u53f7\u52a0\u4e0a\u6570\u5b57\uff0c\u6765\u83b7\u53d6\u5339\u914d\u7ec4\u8fdb\u884c\u62fc\u63a5\u3002</p>"},{"location":"Operations/Nginx/Nginx%20Tips/#nginx_1","title":"Nginx \u5b9a\u4e49\u53d8\u91cf","text":"<pre><code>set $my_var \"value\";\n</code></pre>"},{"location":"Operations/Nginx/Nginx%20Tips/#nginx_2","title":"Nginx \u914d\u7f6e\u6587\u4ef6\u6d4f\u89c8","text":"<pre><code>        location /movie {\n            return 301 /movie/;\n        }\n\n        location /movie/ {\n            alias /data/disk1/qBittorent/;\n            autoindex on; # \u8bbf\u95ee\u76ee\u5f55\u7684\u65f6\u5019\u81ea\u52a8\u751f\u6210\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5217\u8868\n            autoindex_exact_size off; # \u663e\u793a\u53ef\u8bfb\u6587\u4ef6\u5927\u5c0f\uff08KB/MB/GB\uff09\n\n            add_header Content-Disposition inline; # http \u54cd\u5e94\u5934\u6d4f\u89c8\u5668\u5c1d\u8bd5\u76f4\u63a5\u6253\u5f00\u6587\u4ef6\n        }\n</code></pre>"},{"location":"Operations/Nginx/Nginx%20%E4%BD%BF%E7%94%A8%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6/","title":"Nginx \u4f7f\u7528\u81ea\u7b7e\u540d\u8bc1\u4e66","text":"<p>\u6ce8\u610f Nginx \u7f16\u8bd1\u5b89\u88c5\u65f6\u9700\u8981\u5e26\u4e0a --with-http_ssl_module \u9009\u9879\uff0c\u5df2\u7ecf\u5b89\u88c5\u7684 Nginx \u53ef\u4ee5\u4f7f\u7528 nginx -V \u547d\u4ee4\u67e5\u770b\u662f\u5426\u5305\u542b\u8be5\u9009\u9879\u3002</p> <p>\u81ea\u7b7e\u540d\u8bc1\u4e66\u7c7b\u578b</p> <ul> <li>\u81ea\u7b7e\u540d\u8bc1\u4e66</li> <li>\u81ea\u5efa CA \u7b7e\u540d\u7684\u8bc1\u4e66</li> </ul> <p>\u81ea\u7b7e\u540d\u8bc1\u4e66\u65e0\u6cd5\u88ab\u540a\u9500\uff0cCA \u7b7e\u540d\u7684\u8bc1\u4e66\u53ef\u4ee5\u88ab\u540a\u9500\u3002</p>"},{"location":"Operations/Nginx/Nginx%20%E4%BD%BF%E7%94%A8%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6/#_1","title":"\u81ea\u7b7e\u540d\u8bc1\u4e66","text":"<p>\u751f\u6210\u79c1\u94a5 <pre><code>openssl genrsa -out client.key 4096\n</code></pre></p> <p>\u751f\u6210\u8bc1\u4e66\u7b7e\u540d\u8bf7\u6c42 CSR <pre><code>openssl req -new -key client.key -out client.csr\n</code></pre></p> <p>\u751f\u6210\u8bc1\u4e66\uff0c\u8bc1\u4e66\u4e2d\u5305\u542b\u516c\u94a5\u3002 <pre><code>openssl x509 -req -days 365 -in client.csr -signkey client.key -out client.crt\n</code></pre></p> <p>\u5c06\u79c1\u94a5\u548c\u8bc1\u4e66\u79fb\u52a8\u5230 Nginx \u914d\u7f6e\u76ee\u5f55\u4e0b <pre><code>mv client.key client.crt /usr/local/nginx/conf/mainssl/\n</code></pre></p>"},{"location":"Operations/Nginx/Nginx%20%E4%BD%BF%E7%94%A8%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6/#ca","title":"\u521b\u5efa\u81ea\u7b7e CA \u8bc1\u4e66","text":"<p>\u521b\u5efa CA \u7684\u79c1\u94a5\u548c\u8bc1\u4e66\uff1a <pre><code>openssl genrsa -out ca.key 4096\n\nopenssl req -new -x509 -key ca.key -sha256 -days 3650 -out ca.crt \\\n  -subj \"/C=CN/ST=Shanghai/L=Shanghai\"\n</code></pre></p> <p>\u4f7f\u7528 CA \u7684\u8bc1\u4e66\u7b7e\u53d1\u7f51\u7ad9\u7684\u8bc1\u4e66\uff1a <pre><code>openssl req -new -newkey rsa:2048 -nodes -keyout nginx.key -out nginx.csr \\\n  -subj \"/C=CN/ST=Shanghai/L=Shanghai/OU=Logstash\"\n\nopenssl x509 -req -in nginx.csr -CA ca.crt -CAkey ca.key -CAcreateserial \\\n  -out nginx.crt -days 3650 -sha256 \\\n  -extfile &lt;(printf \"basicConstraints=CA:FALSE\\nkeyUsage=digitalSignature,keyEncipherment\\nextendedKeyUsage=serverAuth\\nsubjectAltName=DNS:localhost,IP:127.0.0.1,IP:xxxxxxxx\")\n</code></pre></p> <p>\u5728 Chrome \u6d4f\u89c8\u5668\u4e2d\u5bfc\u5165 CA \u7684\u8bc1\u4e66\uff0c\u7136\u540e\u8bbf\u95ee\u7f51\u7ad9\u5373\u53ef\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7f51\u7ad9\u7684 <code>subjectAltName</code> \u5b57\u6bb5\u8981\u5305\u542b\u8bbf\u95ee\u7f51\u7ad9\u7684\u57df\u540d\u6216\u8005 IP\u3002</p>"},{"location":"Operations/Nginx/Nginx%20%E4%BD%BF%E7%94%A8%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6/#nginx","title":"Nginx \u914d\u7f6e","text":"<p>\u914d\u7f6e Nginx <pre><code>server {\n        listen       80 ssl;\n        server_name  localhost;\n\n        ssl_certificate ./ssl/client.crt;\n        ssl_certificate_key ./ssl/client.key;\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n}\n</code></pre></p> <p>\u53c2\u8003\u8fde\u63a5\uff1a\u5982\u4f55\u7528 OpenSSL \u521b\u5efa\u81ea\u7b7e\u540d\u8bc1\u4e66</p>"},{"location":"Operations/Nginx/Nginx%20%E6%97%A5%E5%BF%97/","title":"Nginx \u65e5\u5fd7","text":""},{"location":"Operations/Nginx/Nginx%20%E6%97%A5%E5%BF%97/#nginx","title":"Nginx \u65e5\u5fd7","text":""},{"location":"Operations/Nginx/Nginx%20%E6%97%A5%E5%BF%97/#_1","title":"\u65e5\u5fd7\u683c\u5f0f\u5b9a\u4e49","text":"<p>log_format \u5b9a\u4e49\u65e5\u5fd7\u7684\u683c\u5f0f\uff0c\u5fc5\u987b\u5728 http \u57df\u4e2d\u5b9a\u4e49\uff1a <pre><code>log_format\u00a0name\u00a0[escape=default|json|none]\u00a0string;\n</code></pre></p> <p>escape \u6307\u5b9a\u5bf9\u8f93\u51fa\u65e5\u5fd7\u7684\u8f6c\u4e49\u65b9\u5f0f\uff0c\u5bf9\u8f93\u51fa\u65e5\u5fd7\u7684\u7279\u6b8a\u5b57\u7b26\u3001\u5f15\u53f7\u3001\u53cd\u659c\u6760\u5982\u4f55\u5904\u7406\u3002 \u914d\u7f6e\u65e5\u5fd7 JSON \u683c\u5f0f\u8f93\u51fa\uff0c\u5982\u679c\u8f93\u51fa\u65e5\u5fd7\u67d0\u4e2a\u5b57\u6bb5\u7684\u503c\u5305\u542b\u53cc\u5f15\u53f7\uff0c\u90a3\u4e48\u5c31\u4f1a\u5bfc\u81f4\u65e5\u5fd7\u5206\u6790\u5de5\u5177 JSON \u89e3\u6790\u5931\u8d25\uff0c\u5c31\u8981\u4f7f\u7528 json \u8f6c\u4e49\u6765\u5bf9\u8f93\u51fa\u65e5\u5fd7\u8fdb\u884c\u5904\u7406\u3002</p> <p>\u9ed8\u8ba4\u914d\u7f6e\u793a\u4f8b\uff1a <pre><code>log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                  '$status $body_bytes_sent \"$http_referer\" '\n                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n</code></pre> \u867d\u7136\u914d\u7f6e\u6587\u4ef6\u662f\u4e09\u884c\uff0c\u4f46\u662f\u5b9e\u9645\u8f93\u51fa\u65e5\u5fd7\u662f\u4e00\u884c\u3002\u5982\u679c\u60f3\u8981\u591a\u884c\u8f93\u51fa\u65e5\u5fd7\uff0c\u53ef\u4ee5\u5728 log_format \u4e2d\u6dfb\u52a0\u6362\u884c\u7b26\u3002</p> <p>log_format \u914d\u7f6e\u53d8\u91cf\u53ef\u4ee5\u53d6 Nginx \u7684\u5185\u7f6e\u53d8\u91cf\uff1a\u5ba2\u6237\u7aef\u3001\u670d\u52a1\u5668\u3001\u8bf7\u6c42\u3001\u8bf7\u6c42\u5934\u3001\u65f6\u95f4\u3001\u54cd\u5e94\u7b49\u76f8\u5173\u7684\u53d8\u91cf\u90fd\u53ef\u4ee5\u914d\u7f6e\u8f93\u51fa\u3002\u5982\u679c log_format \u914d\u7f6e\u7684\u53d8\u91cf\u503c\u4e3a\u7a7a\uff0c\u9ed8\u8ba4\u8f93\u51fa <code>-</code> \u5b57\u7b26\u3002</p> <p>log_format \u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\u3002\u4e0b\u9762\u5b9e\u9645\u914d\u7f6e\u793a\u4f8b\uff0c\u7b2c\u4e00\u4e2a\u52a0\u4e0a\u4e86 token \u8ba4\u8bc1\u8bf7\u6c42\u5934\u8f93\u51fa\uff0c\u7b2c\u4e8c\u4e2a\u52a0\u4e0a\u4e86 service_name \u53d8\u91cf\u8f93\u51fa\uff1a <pre><code>log_format main \n           '$remote_addr - $remote_user [$time_local] '\n           '\"$request\" $status $body_bytes_sent $request_time '\n           '\"$http_referer\" \"$http_user_agent\" \"$http_token\" '\n           '$upstream_response_time $upstream_addr';\n\nlog_format j_format escape=json\n  '{\"time\":\"$time_local\",'\n   '\"remote_addr\":\"$remote_addr\",'\n   '\"request_method\":\"$request_method\",'\n   '\"uri\":\"$uri\",'\n   '\"args\":\"$args\",'\n   '\"server_protocol\":\"$server_protocol\",'\n   '\"status\":$status,'\n   '\"body_bytes_sent\":$body_bytes_sent,'\n   '\"request_time\":$request_time,'\n   '\"http_referer\":\"$http_referer\",'\n   '\"http_user_agent\":\"$http_user_agent\",'\n   '\"http_token\":\"$http_token\",'\n   '\"upstream_response_time\":\"$upstream_response_time\",'\n   '\"service_name\":\"$service_name\",'\n   '\"upstream_addr\":\"$upstream_addr\"}';\n</code></pre></p> <p>Note</p> <p>\u5982\u679c\u8bf7\u6c42\u5934\u662f A-b\uff0c\u90a3\u4e48 Nginx \u4f1a\u5c06\u8bf7\u6c42\u5934\u6620\u5c04\u5230\u53d8\u91cf $http_a_b\u3002  </p> <p>\u5982\u679c log_format \u5b9a\u4e49\u4e2d\u53d6\u4e86 service_name \u53d8\u91cf\u8f93\u51fa\uff0c\u4f46\u662f service_name \u5e76\u4e0d\u662f Nginx \u7684\u5185\u7f6e\u53d8\u91cf\u3002\u90a3\u4e48\u5c31\u8981\u5728\u4f7f\u7528 log_format \u7684\u57df\u6216\u8005\u4e0a\u5c42\u57df\u4e2d\uff0c\u5b9a\u4e49 service_name \u53d8\u91cf\u3002</p> <p>$reuqest \u8fd9\u4e2a\u53d8\u91cf\uff0c\u5982\u679c\u76d1\u542c\u7684\u662f http \u7528 https \u8bf7\u6c42\uff0c\u6216\u8005\u53cd\u8fc7\u6765\uff0c\u90fd\u4f1a\u5bfc\u81f4\u65e5\u5fd7\u51fa\u73b0\u4e71\u7801\u3002\u8fd9\u6837\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e00\u4e9b JSON \u89e3\u6790\u6846\u67b6\u51fa\u9519\u3002\u6240\u4ee5\u5efa\u8bae\u4f7f\u7528 $uri + $args \u66ff\u6362 $request \u53d8\u91cf\u3002</p>"},{"location":"Operations/Nginx/Nginx%20%E6%97%A5%E5%BF%97/#_2","title":"\u8bbf\u95ee\u65e5\u5fd7\u8f93\u51fa","text":"<p>access_log \u9ed8\u8ba4\u8bb0\u5f55\u6240\u6709\u7684\u8bf7\u6c42\uff0c\u8bed\u6cd5\uff1a <pre><code>access_log\u00a0path\u00a0[format\u00a0[buffer=size] [gzip[=level_]] [flush=time] [if=condition]];  \naccess_log\u00a0off;\n</code></pre></p> <p>access_log \u53ef\u4ee5\u5728 http\u3001server\u3001location \u5757\u8fdb\u884c\u8bbe\u7f6e\uff0c\u5982\u679c\u540c\u65f6\u8bbe\u7f6e\u7684\u8bdd\u4f18\u5148\u7ea7\u4f9d\u6b21\u662f location\u3001server\u3001http\u3002</p> <p>\u914d\u7f6e\u793a\u4f8b\uff1a <pre><code>    server {\n        listen       80;\n        server_name  localhost;\n\n        set $service_name \"otto\";\n\n        access_log logs/access.log main;\n        access_log logs/json.log json;\n\n        \u2026\u2026\n    }\n</code></pre></p> <p>access_log \u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\uff0c\u5199\u5165\u4e0d\u540c\u7684\u6587\u4ef6\uff0c\u4f7f\u7528\u4e0d\u540c\u7684 log_format\u3002</p>"},{"location":"Operations/Nginx/Nginx%20%E6%97%A5%E5%BF%97/#_3","title":"\u5b58\u50a8\u5206\u6790","text":"<p>\u5982\u679c\u5e76\u53d1\u4e0d\u662f\u5f88\u9ad8\uff0c\u53ef\u4ee5\u4f7f\u7528 logstash/filebeat \u8fdb\u884c\u91c7\u96c6\u65e5\u5fd7\uff0c\u7136\u540e Stream Load \u5bfc\u5165\u5230 Doris\u3002 \u5982\u679c\u5e76\u53d1\u5f88\u9ad8\uff0c\u90a3\u4e48 logstash/filebeat \u76f4\u63a5\u63a8\u9001\u5230 Kafka\uff0c\u7136\u540e Routine Load \u5bfc\u5165\u5230 Doris\u3002  </p> <p>Doris \u9488\u5bf9 Beats/Logstash \u6709\u5b98\u65b9\u7684 Output \u63d2\u4ef6\uff0c\u80fd\u591f\u76f4\u63a5\u5c06\u6570\u636e\u901a\u8fc7 Http Stream Load \u8f93\u51fa\u5230 Drois \u4e2d\u3002</p>"},{"location":"Operations/Nginx/Nginx%20%E6%97%A5%E5%BF%97/#nginx_1","title":"Nginx \u65e5\u5fd7\u914d\u7f6e","text":"<p>Nginx \u914d\u7f6e\u65e5\u5fd7\u5b58\u50a8\uff1a <pre><code>log_format j_format escape=json  \n  '{\"time\":\"$time_iso8601\",'  \n   '\"remote_addr\":\"$remote_addr\",'  \n   '\"scheme\":\"$scheme\",'  \n   '\"status\":$status,'  \n   '\"request_method\":\"$request_method\",'  \n   '\"uri\":\"$uri\",'  \n   '\"args\":\"$args\",'  \n   '\"server_protocol\":\"$server_protocol\",'  \n   '\"body_bytes_sent\":$body_bytes_sent,'  \n   '\"request_time\":$request_time,'  \n   '\"http_referer\":\"$http_referer\",'  \n   '\"http_user_agent\":\"$http_user_agent\",'  \n   '\"http_token\":\"$http_token\",'  \n   '\"upstream_response_time\":\"$upstream_response_time\",'  \n   '\"service_name\":\"$service_name\",'  \n   '\"upstream_addr\":\"$upstream_addr\"}';\n\naccess_log  logs/access.json j_format;\n</code></pre></p>"},{"location":"Operations/Nginx/Nginx%20%E6%97%A5%E5%BF%97/#doris","title":"Doris \u5efa\u8868","text":"<p>Doris \u5efa\u8868 <pre><code>CREATE TABLE `nginx_log` (\n  `time` datetime NULL,\n  `remote_addr` varchar(50) NULL,\n  `scheme` varchar(20) NULL,\n  `status` int NULL,\n  `remote_method` varchar(50) NULL,\n  `uri` varchar(3000) NULL,\n  `args` varchar(3000) NULL,\n  `server_protocol` varchar(50) NULL,\n  `body_bytes_sent` bigint NULL,\n  `request_time` float NULL,\n  `http_referer` varchar(500) NULL,\n  `http_user_agent` varchar(500) NULL,\n  `http_token` varchar(500) NULL,\n  `upstream_response_time` varchar(50) NULL,\n  `service_name` varchar(100) NULL,\n  `upstream_addr` varchar(100) NULL,\n  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP\n) ENGINE=OLAP\nDUPLICATE KEY(`time`, `remote_addr`)\nPARTITION BY RANGE(`time`)()\nDISTRIBUTED BY RANDOM BUCKETS 10\nPROPERTIES (\n\"replication_allocation\" = \"tag.location.default: 1\",\n\"dynamic_partition.enable\" = \"true\",\n\"dynamic_partition.time_unit\" = \"YEAR\",\n\"dynamic_partition.time_zone\" = \"Asia/Shanghai\",\n\"dynamic_partition.start\" = \"-2147483648\",\n\"dynamic_partition.end\" = \"10\",\n\"dynamic_partition.prefix\" = \"p\",\n\"dynamic_partition.replication_allocation\" = \"tag.location.default: 1\",\n\"dynamic_partition.buckets\" = \"8\",\n\"dynamic_partition.create_history_partition\" = \"true\",\n\"dynamic_partition.history_partition_num\" = \"2\",\n\"dynamic_partition.hot_partition_num\" = \"0\"\n);\n</code></pre></p> <p>\u6ce8\u610f\uff0c<code>DISTRIBUTED BY RANDOM BUCKETS 10</code> \u80fd\u591f\u5728\u5bfc\u5165\u6570\u636e\u7684\u65f6\u5019\u914d\u7f6e\u5c06\u540c\u4e00\u6279\u6570\u636e\u5b58\u5165\u540c\u4e00\u4e2a\u5206\u6876\u3002</p>"},{"location":"Operations/Nginx/Nginx%20%E6%97%A5%E5%BF%97/#filebeat-doris","title":"Filebeat \u76f4\u63a5\u5bfc\u5165\u5230 Doris","text":"<p>\u4e0b\u8f7d Doris \u5b98\u65b9\u7684 Beats\uff1ahttps://doris.apache.org/zh-CN/docs/3.0/ecosystem/beats</p> <p>Filebeat \u914d\u7f6e\u6587\u4ef6\uff1a <pre><code># input \n# \u9010\u884c\u8bfb\u53d6\uff0c\u6bcf\u4e00\u884c\u5c31\u662f\u4e00\u4e2a\u4e8b\u4ef6\nfilebeat.inputs:\n- type: log\n  enabled: true\n  paths:\n    - /usr/local/nginx/logs/json_access.log\n\n# queue and batch\nqueue.mem:\n  ## \u5185\u5b58\u6700\u591a\u7f13\u5b58 100 \u4e07\u6761\u4e8b\u4ef6\n  events: 1000000\n  ## \u6bcf\u6b21\u81f3\u5c11\u51d1\u591f 10 \u4e07\u6761\u4e8b\u4ef6\u624d\u4f1a\u63a8\u9001 Doris\n  flush.min_events: 100000\n  ## \u5982\u679c 10 \u79d2\u5185\u6ca1\u6709\u51d1\u591f 10 \u4e07\u6761\uff0c\u4e5f\u4f1a\u5f3a\u5236\u63a8\u9001 Doris\n  flush.timeout: 10s\n\n# output\noutput.doris:\n  fenodes: [ \"http://fe_host:8030\" ]\n  user: \"root\"\n  password: \"xxxx\"\n  database: \"log_db\"\n  table: \"nginx_log\"\n  # output string format\n  ## \u76f4\u63a5\u628a\u539f\u59cb\u6587\u4ef6\u6bcf\u4e00\u884c\u7684 message \u539f\u6837\u8f93\u51fa\uff0c\u7531\u4e8e headers \u6307\u5b9a\u4e86 format: \"json\"\uff0cStream Load \u4f1a\u81ea\u52a8\u89e3\u6790 JSON \u5b57\u6bb5\u5199\u5165\u5bf9\u5e94\u7684 Doris \u8868\u7684\u5b57\u6bb5\u3002\n  codec_format_string: '%{[message]}'\n  headers:\n    format: \"json\"\n    read_json_by_line: \"true\"\n    ## \u540c\u4e00\u6279\u6b21\u7684\u6570\u636e\u5199\u5165\u5230\u4e00\u4e2a tablet \u91cc\u9762\u53bb\n    load_to_single_tablet: \"true\"\n</code></pre></p> <p>Filebeat \u542f\u52a8\uff1a <pre><code> ./filebeat-doris-2.0.0 -c nginx-log.yml\n</code></pre></p>"},{"location":"Operations/Nginx/Nginx%20%E6%97%A5%E5%BF%97/#filebeat-logstash-doris","title":"Filebeat \u5bfc\u5165\u5230 Logstash \u518d\u5bfc\u5165 Doris","text":"<p>Filebeat \u91c7\u96c6\u65e5\u5fd7\uff0c\u8f93\u51fa\u5230 LogStash\uff0c\u91c7\u7528 ssl \u8fdb\u884c\u8ba4\u8bc1\u3002</p> <p>\u751f\u6210 CA \u79c1\u94a5\u548c\u8bc1\u4e66\uff1a <pre><code>openssl genrsa -out ca.key 4096\n\nopenssl req -new -x509 -key ca.key -sha256 -days 3650 -out ca.crt \\\n  -subj \"/C=CN/ST=Shanghai/L=Shanghai\"\n</code></pre></p> <p>\u751f\u6210 Logstash \u7684\u79c1\u94a5\u548c\u8bc1\u4e66\uff1a <pre><code>openssl req -new -newkey rsa:2048 -nodes -keyout logstash.key -out logstash.csr \\\n  -subj \"/C=CN/ST=Shanghai/L=Shanghai/OU=Logstash\"\n\nopenssl x509 -req -in logstash.csr -CA ca.crt -CAkey ca.key -CAcreateserial \\\n  -out logstash.crt -days 3650 -sha256 \\\n  -extfile &lt;(printf \"basicConstraints=CA:FALSE\\nkeyUsage=digitalSignature,keyEncipherment\\nextendedKeyUsage=serverAuth\\nsubjectAltName=DNS:localhost,IP:127.0.0.1,IP:192.168.31.157\")\n</code></pre> \u6ce8\u610f\uff0c\u670d\u52a1\u7aef\u8bc1\u4e66 SAN \u9700\u8981\u6307\u5b9a ip \u5730\u5740\u6216\u8005 dns\uff0c\u5426\u5219\u5ba2\u6237\u7aef\u5728\u8fdb\u884c\u8bc1\u4e66\u6821\u9a8c\u7684\u65f6\u5019\u53ef\u80fd\u4e0d\u8fc7\u3002filebeat \u4e5f\u53ef\u4ee5\u914d\u7f6e\u8df3\u8fc7\u8bc1\u4e66\u6821\u9a8c\u3002</p> <p>\u751f\u6210 Filebeat \u7684\u79c1\u94a5\u548c\u8bc1\u4e66\uff1a <pre><code>openssl req -new -newkey rsa:2048 -nodes -keyout filebeat.key -out filebeat.csr \\\n  -subj \"/C=CN/ST=Shanghai/L=Shanghai/OU=Filebeat\"\n\nopenssl x509 -req -in filebeat.csr -CA ca.crt -CAkey ca.key -CAcreateserial \\\n  -out filebeat.crt -days 3650 -sha256 \\\n  -extfile &lt;(printf \"basicConstraints=CA:FALSE\\nkeyUsage=digitalSignature,keyEncipherment\\nextendedKeyUsage=clientAuth\")\n</code></pre></p> <p>logstash \u914d\u7f6e\u6587\u4ef6 <pre><code>input {\n  beats {\n    port =&gt; 5044\n    ssl_enabled =&gt; true\n    ssl_certificate =&gt; \"/home/jacky/logstash.crt\"       # Logstash \u670d\u52a1\u7aef\u8bc1\u4e66\n    ssl_key =&gt; \"/home/jacky/logstash.key\"   # Logstash \u79c1\u94a5\n    ssl_certificate_authorities =&gt; [\"/home/jacky/ca.crt\"]   # \u7528\u4e8e\u9a8c\u8bc1 Filebeat \u5ba2\u6237\u7aef\u8bc1\u4e66\n    ssl_client_authentication =&gt; \"required\"                  # \u5f3a\u5236\u9a8c\u8bc1\u5ba2\u6237\u7aef\u8bc1\u4e66\n  }\n}\n\nfilter {\n    json {\n        source =&gt; \"message\"\n        target =&gt; \"parsed_json\"\n    }\n\n    aggregate {\n        task_id =&gt; \"%{host}\"\n        code =&gt; \"\n            map['events'] ||= []\n            map['events'] &lt;&lt; event.get('parsed_json')\n            event.cancel()\n        \"\n        push_previous_map_as_event =&gt; true\n        timeout =&gt; 5\n    }\n\n    ruby {\n        code =&gt; 'event.set(\"message\", event.get(\"events\").to_json)'  # \u628a events \u5e8f\u5217\u5316\u6210 JSON\n    }\n}\n\noutput {\n  http {\n    url =&gt; \"http://192.168.31.86:8080/request/log\"  # \u76ee\u6807\u63a5\u53e3\n    http_method =&gt; \"post\"\n    format =&gt; \"message\"\n    headers =&gt; {\n      \"Content-Type\" =&gt; \"application/json\"\n    }\n    # \u53ef\u9009\uff1a\u8d85\u65f6\u548c\u91cd\u8bd5\u8bbe\u7f6e\n    # content_type =&gt; \"application/json\"\n    # http_proxy =&gt; \"http://proxy.example.com:8080\"\n    message =&gt; \"%{message}\"\n  }\n}\n</code></pre></p> <p>\u542f\u52a8 logstash <pre><code>bin/logstash -f config/logstash.conf\n</code></pre></p> <p>filebeat \u914d\u7f6e\u6587\u4ef6\uff1a <pre><code>filebeat.inputs:\n  - type: filestream\n    enabled: true\n    paths:\n      - /usr/local/nginx/logs/access.json\n\noutput.logstash:\n  # Logstash \u5730\u5740\n  hosts: [\"localhost:5044\"]\n\n  # \u542f\u7528 SSL/TLS\n  ssl.enabled: true\n\n  # CA \u8bc1\u4e66\uff0c\u7528\u4e8e\u9a8c\u8bc1 Logstash \u670d\u52a1\u7aef\u8bc1\u4e66\n  ssl.certificate_authorities: [\"/home/jacky/ca.crt\"]\n\n  # \u5ba2\u6237\u7aef\u8bc1\u4e66\u548c\u79c1\u94a5\uff0c\u7528\u4e8e\u53cc\u5411\u8ba4\u8bc1\n  ssl.certificate: \"/home/jacky/filebeat.crt\"\n  ssl.key: \"/home/jacky/filebeat.key\"\n\n  # \u53ef\u9009\uff1a\u8df3\u8fc7\u9a8c\u8bc1\uff08\u4e0d\u63a8\u8350\uff09\n  # ssl.verification_mode: none\n</code></pre></p> <p>\u542f\u52a8 filebeat -e \u8f93\u51fa\u65e5\u5fd7\u5230\u63a7\u5236\u53f0\uff0c\u65b9\u4fbf\u8c03\u8bd5\u3002 <pre><code>./filebeat -e -c filebeat.yml\n</code></pre></p>"},{"location":"Operations/Nginx/Nginx%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/","title":"Nginx \u7f16\u8bd1\u5b89\u88c5","text":""},{"location":"Operations/Nginx/Nginx%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/#_1","title":"\u51c6\u5907\u73af\u5883","text":""},{"location":"Operations/Nginx/Nginx%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/#_2","title":"\u5b89\u88c5\u7f16\u8bd1\u73af\u5883","text":"<pre><code>apt install gcc make\n</code></pre>"},{"location":"Operations/Nginx/Nginx%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/#_3","title":"\u5b89\u88c5\u5fc5\u8981\u7684\u652f\u6301\u5e93","text":"<p>pcre \u63d0\u4f9b http rewrite \u652f\u6301 <pre><code>apt install  libpcre3-dev zlib1g-dev libssl-dev libgd-dev\n</code></pre></p>"},{"location":"Operations/Nginx/Nginx%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/#nginx","title":"\u5b89\u88c5 Nginx","text":""},{"location":"Operations/Nginx/Nginx%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/#_4","title":"\u4e0b\u8f7d","text":"<pre><code>wget https://nginx.org/download/nginx-1.22.1.tar.gz\ntar -zxvf nginx-1.22.1.tar.gz -C /usr/local/src\n</code></pre>"},{"location":"Operations/Nginx/Nginx%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/#_5","title":"\u7f16\u8bd1\u5b89\u88c5","text":"<p>\u5b8c\u6574\u7684\u7f16\u8bd1\u53c2\u6570\u53c2\u8003\uff1ahttp://nginx.org/en/docs/configure.html <pre><code>cd /usr/local/srv/nginx-1.22.1\n\n./configure --prefix=/usr/local/nginx \\\n--user=www-data --group=www-data \\\n--with-stream \\\n--with-stream_ssl_module \\\n--with-http_ssl_module\n\n \u6307\u5b9a worker \u8fdb\u7a0b\u7684\u9ed8\u8ba4\u7528\u6237/\u7ec4\uff0c\u5f53\u7136\u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u7684\u4f18\u5148\u7ea7\u66f4\u9ad8\n \u5b9e\u73b0 TCP \u548c UDP \u6d41\u91cf\u7684\u8f6c\u53d1\u548c\u8d1f\u8f7d\uff0c\u5b9e\u73b0\u56db\u5c42\u4ee3\u7406\n \u5b9e\u73b0 TCP/UDP \u6d41\u91cf\u7684\u52a0\u5bc6\n \u5b9e\u73b0 HTTPS \u534f\u8bae\u7684\u652f\u6301\n\nmake &amp;&amp; make install \n</code></pre></p>"},{"location":"Operations/Nginx/Nginx%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/#_6","title":"\u542f\u52a8\u547d\u4ee4","text":"<pre><code>cd /usr/local/nginx\n\n# \u542f\u52a8\n./sbin/nginx \n\n# \u9a8c\u8bc1\u914d\u7f6e\u6587\u4ef6\u662f\u5426\u6b63\u786e\n./sbin/nginx -t\n\n# \u91cd\u542f\n./sbin/nginx -s reload\n\n# \u505c\u6b62 nginx\n./sbin/nginx -s stop\n\n# \u67e5\u770b\u7248\u672c\n./sbin/nginx -v\n</code></pre>"},{"location":"Operations/Nginx/Nginx%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/#_7","title":"\u914d\u7f6e\u670d\u52a1","text":"<p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 <code>/etc/systemd/system/nginx.service</code>\uff1a <pre><code>[Unit]\nDescription=nginx - high performance web server\nDocumentation=http://nginx.org/en/docs/\nAfter=network.target\n\n[Service]\nType=forking\nLimitNOFILE=65535\nPIDFile=/usr/local/nginx/logs/nginx.pid\nExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf\nExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf\nExecReload= /usr/local/nginx/sbin/nginx -s reload\nExecStop= /usr/local/nginx/sbin/nginx -s stop\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> \u914d\u7f6e\u4e3a\u670d\u52a1\u7684\u8bdd\uff0c\u9700\u8981\u5728\u670d\u52a1\u6587\u4ef6\u4e2d\u6307\u5b9a <code>LimitNOFILE=65535</code>\uff0cNginx \u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u7684 <code>worker_rlimit_nofile 65535;</code> \u4f1a\u4e0d\u751f\u6548\u3002</p> <p>\u914d\u7f6e\u670d\u52a1\u5f00\u673a\u542f\u52a8\uff1a <pre><code>systemctl daemon-reload\n\n# \u914d\u7f6e\u5f00\u673a\u542f\u52a8\nsystemctl enable nginx \n\n# \u542f\u52a8\nsystemctl start nginx\n\n# \u4fee\u6539\u914d\u7f6e\u540e\u91cd\u65b0\u52a0\u8f7d\nsystemctl reload nginx\n\n# \u67e5\u770b\u72b6\u6001\nsystemctl status nginx\n</code></pre></p>"},{"location":"Operations/Nginx/Nginx%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/#_8","title":"\u89e3\u91ca","text":""},{"location":"Operations/Nginx/Nginx%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/#_9","title":"\u7f16\u8bd1\u547d\u4ee4\u7684\u89e3\u91ca","text":"<pre><code># \u6a21\u5757\u53c2\u6570\u5177\u4f53\u529f\u80fd \n--with-cc-opt='-g -O2 -fPIE -fstack-protector'   # \u8bbe\u7f6e\u989d\u5916\u7684\u53c2\u6570\u5c06\u88ab\u6dfb\u52a0\u5230CFLAGS\u53d8\u91cf\u3002\uff08FreeBSD\u6216\u8005ubuntu\u4f7f\u7528\uff09\n--param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2' \n--with-ld-opt='-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now' \n\n--prefix=/usr/share/nginx                        # \u6307\u5411\u5b89\u88c5\u76ee\u5f55\n--conf-path=/etc/nginx/nginx.conf                # \u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\n--http-log-path=/var/log/nginx/access.log        # \u6307\u5b9a\u8bbf\u95ee\u65e5\u5fd7\n--error-log-path=/var/log/nginx/error.log        # \u6307\u5b9a\u9519\u8bef\u65e5\u5fd7\n--lock-path=/var/lock/nginx.lock                 # \u6307\u5b9alock\u6587\u4ef6\n--pid-path=/run/nginx.pid                        # \u6307\u5b9apid\u6587\u4ef6\n\n--http-client-body-temp-path=/var/lib/nginx/body    # \u8bbe\u5b9ahttp\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e34\u65f6\u6587\u4ef6\u8def\u5f84\n--http-fastcgi-temp-path=/var/lib/nginx/fastcgi     # \u8bbe\u5b9ahttp fastcgi\u4e34\u65f6\u6587\u4ef6\u8def\u5f84\n--http-proxy-temp-path=/var/lib/nginx/proxy         # \u8bbe\u5b9ahttp\u4ee3\u7406\u4e34\u65f6\u6587\u4ef6\u8def\u5f84\n--http-scgi-temp-path=/var/lib/nginx/scgi           # \u8bbe\u5b9ahttp scgi\u4e34\u65f6\u6587\u4ef6\u8def\u5f84\n--http-uwsgi-temp-path=/var/lib/nginx/uwsgi         # \u8bbe\u5b9ahttp uwsgi\u4e34\u65f6\u6587\u4ef6\u8def\u5f84\n\n--with-debug                                        # \u542f\u7528debug\u65e5\u5fd7\n--with-pcre-jit                                     # \u7f16\u8bd1PCRE\u5305\u542b\u201cjust-in-time compilation\u201d\n--with-ipv6                                         # \u542f\u7528ipv6\u652f\u6301\n--with-http_ssl_module                              # \u542f\u7528ssl\u652f\u6301\n--with-http_stub_status_module                      # \u83b7\u53d6nginx\u81ea\u4e0a\u6b21\u542f\u52a8\u4ee5\u6765\u7684\u72b6\u6001\n--with-http_realip_module                 # \u5141\u8bb8\u4ece\u8bf7\u6c42\u6807\u5934\u66f4\u6539\u5ba2\u6237\u7aef\u7684IP\u5730\u5740\u503c\uff0c\u9ed8\u8ba4\u4e3a\u5173\n--with-http_auth_request_module           # \u5b9e\u73b0\u57fa\u4e8e\u4e00\u4e2a\u5b50\u8bf7\u6c42\u7684\u7ed3\u679c\u7684\u5ba2\u6237\u7aef\u6388\u6743\u3002\u5982\u679c\u8be5\u5b50\u8bf7\u6c42\u8fd4\u56de\u76842xx\u54cd\u5e94\u4ee3\u7801\uff0c\u6240\u8ff0\u63a5\u5165\u662f\u5141\u8bb8\u7684\u3002\u5982\u679c\u5b83\u8fd4\u56de401\u6216403\u4e2d\uff0c\u8bbf\u95ee\u88ab\u62d2\u7edd\u4e0e\u76f8\u5e94\u7684\u9519\u8bef\u4ee3\u7801\u3002\u7531\u5b50\u8bf7\u6c42\u8fd4\u56de\u7684\u4efb\u4f55\u5176\u4ed6\u54cd\u5e94\u4ee3\u7801\u88ab\u8ba4\u4e3a\u662f\u4e00\u4e2a\u9519\u8bef\u3002\n--with-http_addition_module               # \u4f5c\u4e3a\u4e00\u4e2a\u8f93\u51fa\u8fc7\u6ee4\u5668\uff0c\u652f\u6301\u4e0d\u5b8c\u5168\u7f13\u51b2\uff0c\u5206\u90e8\u5206\u54cd\u5e94\u8bf7\u6c42\n--with-http_dav_module                    # \u589e\u52a0PUT,DELETE,MKCOL\uff1a\u521b\u5efa\u96c6\u5408,COPY\u548cMOVE\u65b9\u6cd5 \u9ed8\u8ba4\u5173\u95ed\uff0c\u9700\u7f16\u8bd1\u5f00\u542f\n--with-http_geoip_module                  # \u4f7f\u7528\u9884\u7f16\u8bd1\u7684MaxMind\u6570\u636e\u5e93\u89e3\u6790\u5ba2\u6237\u7aefIP\u5730\u5740\uff0c\u5f97\u5230\u53d8\u91cf\u503c\n--with-http_gunzip_module                 # \u5b83\u4e3a\u4e0d\u652f\u6301\u201cgzip\u201d\u7f16\u7801\u65b9\u6cd5\u7684\u5ba2\u6237\u7aef\u89e3\u538b\u5177\u6709\u201cContent-Encoding: gzip\u201d\u5934\u7684\u54cd\u5e94\u3002\n--with-http_gzip_static_module            # \u5728\u7ebf\u5b9e\u65f6\u538b\u7f29\u8f93\u51fa\u6570\u636e\u6d41\n--with-http_image_filter_module           # \u4f20\u8f93JPEG/GIF/PNG \u56fe\u7247\u7684\u4e00\u4e2a\u8fc7\u6ee4\u5668\uff09\uff08\u9ed8\u8ba4\u4e3a\u4e0d\u542f\u7528\u3002gd\u5e93\u8981\u7528\u5230\uff09\n--with-http_spdy_module                   # SPDY\u53ef\u4ee5\u7f29\u77ed\u7f51\u9875\u7684\u52a0\u8f7d\u65f6\u95f4\n--with-http_sub_module                    # \u5141\u8bb8\u7528\u4e00\u4e9b\u5176\u4ed6\u6587\u672c\u66ff\u6362nginx\u54cd\u5e94\u4e2d\u7684\u4e00\u4e9b\u6587\u672c\n--with-http_xslt_module                   # \u8fc7\u6ee4\u8f6c\u6362XML\u8bf7\u6c42\n--with-mail                               # \u542f\u7528POP3/IMAP4/SMTP\u4ee3\u7406\u6a21\u5757\u652f\u6301\n--with-mail_ssl_module                    # \u542f\u7528ngx_mail_ssl_module\u652f\u6301\u542f\u7528\u5916\u90e8\u6a21\u5757\u652f\u6301\n</code></pre>"},{"location":"Operations/Nginx/Nginx%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/#nginx_1","title":"Nginx \u914d\u7f6e\u6587\u4ef6\u7684\u89e3\u91ca","text":"<pre><code># \u5168\u5c40\u53c2\u6570\u8bbe\u7f6e \nworker_processes  1;          # \u8bbe\u7f6enginx\u542f\u52a8\u8fdb\u7a0b\u7684\u6570\u91cf\uff0c\u4e00\u822c\u8bbe\u7f6e\u6210\u4e0e\u903b\u8f91cpu\u6570\u91cf\u76f8\u540c \nerror_log  logs/error.log;    # \u6307\u5b9a\u9519\u8bef\u65e5\u5fd7 \nworker_rlimit_nofile 65535;   # \u8bbe\u7f6e\u4e00\u4e2anginx\u8fdb\u7a0b\u80fd\u6253\u5f00\u7684\u6700\u5927\u6587\u4ef6\u6570 \npid        /var/run/nginx.pid; \nevents {                      # \u4e8b\u4ef6\u914d\u7f6e\n    worker_connections  10240; # \u8bbe\u7f6e\u4e00\u4e2a\u8fdb\u7a0b\u7684\u6700\u5927\u5e76\u53d1\u8fde\u63a5\u6570\n    use epoll;                # \u4e8b\u4ef6\u9a71\u52a8\u7c7b\u578b\n} \n# http \u670d\u52a1\u76f8\u5173\u8bbe\u7f6e \nhttp {  \n    log_format  main  'remote_addr - remote_user [time_local] \"request\" '\n                      'status body_bytes_sent \"$http_referer\" '\n                      '\"http_user_agent\" \"http_x_forwarded_for\"'; \n    access_log  /var/log/nginx/access.log  main;    #\u8bbe\u7f6e\u8bbf\u95ee\u65e5\u5fd7\u7684\u4f4d\u7f6e\u548c\u683c\u5f0f \n    sendfile          on;      # \u7528\u4e8e\u5f00\u542f\u6587\u4ef6\u9ad8\u6548\u4f20\u8f93\u6a21\u5f0f\uff0c\u4e00\u822c\u8bbe\u7f6e\u4e3aon\uff0c\u82e5nginx\u662f\u7528\u6765\u8fdb\u884c\u78c1\u76d8IO\u8d1f\u8f7d\u5e94\u7528\u65f6\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3aoff\uff0c\u964d\u4f4e\u7cfb\u7edf\u8d1f\u8f7d\n    tcp_nopush        on;      # \u51cf\u5c11\u7f51\u7edc\u62a5\u6587\u6bb5\u6570\u91cf\uff0c\u5f53\u6709\u6570\u636e\u65f6\uff0c\u5148\u522b\u7740\u6025\u53d1\u9001, \u786e\u4fdd\u6570\u636e\u5305\u5df2\u7ecf\u88c5\u6ee1\u6570\u636e, \u907f\u514d\u4e86\u7f51\u7edc\u62e5\u585e\n    tcp_nodelay       on;      # \u63d0\u9ad8I/O\u6027\u80fd\uff0c\u786e\u4fdd\u6570\u636e\u5c3d\u5feb\u53d1\u9001, \u63d0\u9ad8\u53ef\u6570\u636e\u4f20\u8f93\u6548\u7387                           \n    gzip              on;      # \u662f\u5426\u5f00\u542f gzip \u538b\u7f29 \n    keepalive_timeout  65;     # \u8bbe\u7f6e\u957f\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u8bf7\u6c42\u5b8c\u6210\u4e4b\u540e\u8fd8\u8981\u4fdd\u6301\u8fde\u63a5\u591a\u4e45\uff0c\u4e0d\u662f\u8bf7\u6c42\u65f6\u95f4\u591a\u4e45\uff0c\u76ee\u7684\u662f\u4fdd\u6301\u957f\u8fde\u63a5\uff0c\u51cf\u5c11\u521b\u5efa\u8fde\u63a5\u8fc7\u7a0b\u7ed9\u7cfb\u7edf\u5e26\u6765\u7684\u6027\u80fd\u635f\u8017\uff0c\u7c7b\u4f3c\u4e8e\u7ebf\u7a0b\u6c60\uff0c\u6570\u636e\u5e93\u8fde\u63a5\u6c60\n    types_hash_max_size 2048;  # \u5f71\u54cd\u6563\u5217\u8868\u7684\u51b2\u7a81\u7387\u3002types_hash_max_size \u8d8a\u5927\uff0c\u5c31\u4f1a\u6d88\u8017\u66f4\u591a\u7684\u5185\u5b58\uff0c\u4f46\u6563\u5217key\u7684\u51b2\u7a81\u7387\u4f1a\u964d\u4f4e\uff0c\u68c0\u7d22\u901f\u5ea6\u5c31\u66f4\u5feb\u3002types_hash_max_size\u8d8a\u5c0f\uff0c\u6d88\u8017\u7684\u5185\u5b58\u5c31\u8d8a\u5c0f\uff0c\u4f46\u6563\u5217key\u7684\u51b2\u7a81\u7387\u53ef\u80fd\u4e0a\u5347\n    include             /etc/nginx/mime.types;  # \u5173\u8054mime\u7c7b\u578b\uff0c\u5173\u8054\u8d44\u6e90\u7684\u5a92\u4f53\u7c7b\u578b(\u4e0d\u540c\u7684\u5a92\u4f53\u7c7b\u578b\u7684\u6253\u5f00\u65b9\u5f0f)\n    default_type        application/octet-stream;  # \u6839\u636e\u6587\u4ef6\u7684\u540e\u7f00\u6765\u5339\u914d\u76f8\u5e94\u7684MIME\u7c7b\u578b\uff0c\u5e76\u5199\u5165Response header\uff0c\u5bfc\u81f4\u6d4f\u89c8\u5668\u64ad\u653e\u6587\u4ef6\u800c\u4e0d\u662f\u4e0b\u8f7d\n    # \u865a\u62df\u670d\u52a1\u5668\u7684\u76f8\u5173\u8bbe\u7f6e \n    server { \n        listen      80;        # \u8bbe\u7f6e\u76d1\u542c\u7684\u7aef\u53e3 \n        server_name  localhost;        # \u8bbe\u7f6e\u7ed1\u5b9a\u7684\u4e3b\u673a\u540d\u3001\u57df\u540d\u6216ip\u5730\u5740 \n        charset koi8-r;        # \u8bbe\u7f6e\u7f16\u7801\u5b57\u7b26 \n        location / { \n            root  /var/www/nginx;           # \u8bbe\u7f6e\u670d\u52a1\u5668\u9ed8\u8ba4\u7f51\u7ad9\u7684\u6839\u76ee\u5f55\u4f4d\u7f6e \n            index  index.html index.htm;    # \u8bbe\u7f6e\u9ed8\u8ba4\u6253\u5f00\u7684\u6587\u6863 \n        }\n\n        error_page  500 502 503 504  /50x.html; # \u8bbe\u7f6e\u9519\u8bef\u4fe1\u606f\u8fd4\u56de\u9875\u9762 \n            location = /50x.html { \n            root  html;        # \u8fd9\u91cc\u7684\u7edd\u5bf9\u4f4d\u7f6e\u662f/var/www/nginx/html \n        } \n    } \n }\n</code></pre>"},{"location":"Operations/Nginx/Nginx%20%E9%85%8D%E7%BD%AE%20Basic%20Auth/","title":"Nginx \u914d\u7f6e Basic Auth","text":"<p>\u9996\u5148\u4f7f\u7528 openssl \u83b7\u53d6\u52a0\u5bc6\u5bc6\u7801 openssl passwd -5 your-password\uff0c\u6bd4\u5982\u5bc6\u7801 123456\u3002 <pre><code># openssl passwd -5 123456\n$5$jZFBH2tXARpLGmik$YDeK49P73WVVYzfjhWVZG7ZjHXyc7g0MVaWCZXHc0U9\n</code></pre></p> <p>\u7136\u540e\u65b0\u589e\u914d\u7f6e\u6587\u4ef6 conf/.htpasswd\u3002 <pre><code>usera:$5$jZFBH2tXARpLGmik$YDeK49P73WVVYzfjhWVZG7ZjHXyc7g0MVaWCZXHc0U9\nuserb:$5$jZFBH2tXARpLGmik$YDeK49P73WVVYzfjhWVZG7ZjHXyc7g0MVaWCZXHc0U9\n</code></pre></p> <p>\u7f16\u8f91 Nginx \u914d\u7f6e\u6587\u4ef6\u3002 <pre><code>    server {\n        listen       80; \n        server_name  localhost;\n\n        auth_basic \"Restricted Access\";           # \u8bbe\u7f6e\u63d0\u793a\u4fe1\u606f\n        auth_basic_user_file ./.htpasswd; # \u6307\u5b9a\u8ba4\u8bc1\u6587\u4ef6\u8def\u5f84\n\n        location / { \n            root   html;\n            index  index.html index.htm;\n        }\n    }\n</code></pre></p> <p>\u914d\u7f6e\u6587\u4ef6\u751f\u6548\u4e4b\u540e\uff0c\u8bbf\u95ee\u4e3b\u673a\u7684 80 \u7aef\u53e3\uff0c\u4f7f\u7528 usera/123456 \u548c userb/123456 \u90fd\u80fd\u8fdb\u884c\u8bbf\u95ee\u3002</p>"},{"location":"Operations/Prometheus/%E6%8E%A2%E7%B4%A2%20PromQL/","title":"\u63a2\u7d22 PromQL","text":"<p>Prometheus \u4f1a\u5c06\u6240\u6709\u91c7\u96c6\u5230\u7684\u6837\u672c\u6570\u636e\u4ee5\u65f6\u95f4\u5e8f\u5217\u7684\u65b9\u5f0f\u5b58\u50a8\u5728\u5185\u5b58\u6570\u636e\u5e93\u4e2d\uff0c\u5e76\u5b9a\u65f6\u4fdd\u5b58\u5728\u786c\u76d8\u4e0a\u3002\u6bcf\u6761\u65f6\u95f4\u5e8f\u5217\u901a\u8fc7\u6307\u6807\u540d\u79f0\u548c\u4e00\u7ec4\u6807\u7b7e\u96c6\u5408\u547d\u540d\u3002 \u6837\u672c sample \u65f6\u95f4\u5e8f\u5217 time-series \u6307\u6807\u540d\u79f0 metrics name \u6807\u7b7e\u96c6\u5408 labelset <pre><code>  ^\n  \u2502   . . . . . . . . . . . . . . . . . . .   node_cpu{cpu=\"cpu0\",mode=\"idle\"}\n  \u2502   . . . . . . . . . . . . . . . . . . .   node_cpu{cpu=\"cpu0\",mode=\"system\"}\n  \u2502   . . . . . . . . . . . . . . . . . . .   node_load1{}\n  \u2502   . . . . . . . . . . . . . . . . . . .  \n  v\n    &lt;------------------ \u65f6\u95f4 ----------------&gt;\n</code></pre></p> <p><code>__</code> \u5f00\u5934\u547d\u540d\u7684\u6807\u7b7e\u662f\u7cfb\u7edf\u4fdd\u7559\u6807\u7b7e\uff0c\u667a\u80fd\u5728\u7cfb\u7edf\u5185\u90e8\u4f7f\u7528\u3002 \u4e0b\u9762\u4e24\u79cd\u65b9\u5f0f\u5747\u53ef\u4ee5\u8868\u793a\u540c\u4e00\u6761\u65f6\u95f4\u5e8f\u5217 <pre><code>api_total{method=\"POST\", path=\"/message\"}\n{__name__=\"api_total\", method=\"POST\", path=\"/message\"}\n</code></pre></p> <p>\u4ece\u5b58\u50a8\u4e0a\u6765\u8bf4\uff0c\u6240\u6709\u7684\u76d1\u63a7\u6307\u6807\u90fd\u662f\u76f8\u540c\u7684\uff0c\u4f46\u662f\u5728\u4e1a\u52a1 Prometheus \u5b9a\u4e49\u4e86 4 \u4e2d\u4e0d\u540c\u7684\u6307\u6807\u7c7b\u578b\uff1aCounter \u8ba1\u6570\u5668\u3001Gauge \u4eea\u8868\u76d8\u3001Histogram \u76f4\u65b9\u56fe\u3001Summary \u6458\u8981\u3002</p> <p>Counter \u53ea\u589e\u52a0\u4e0d\u51cf\u5c11\u7684\u8ba1\u6570\u5668\uff0c\u6bd4\u5982\u7edf\u8ba1\u63a5\u53e3\u8bf7\u6c42\u6570\u91cf\u7684\u6307\u6807  http_request_total\u3002\u4e00\u822c\u5728\u5b9a\u4e49 Counter \u7c7b\u578b\u7684\u6307\u6807\u65f6\u5efa\u8bae\u4f7f\u7528 <code>_total</code> \u4f5c\u4e3a\u540e\u7f00\u3002</p> <p>Gauge \u53ef\u589e\u53ef\u51cf\u7684\u4eea\u8868\u76d8\uff0c\u5e38\u89c1\u6307\u6807\u5982\uff1anode_memory_MemFree\uff08\u4e3b\u673a\u5f53\u524d\u7a7a\u95f2\u7684\u5185\u5bb9\u5927\u5c0f\uff09\u3001node_memory_MemAvailable\uff08\u53ef\u7528\u5185\u5b58\u5927\u5c0f\uff09\u90fd\u662fGauge\u7c7b\u578b\u7684\u76d1\u63a7\u6307\u6807\u3002</p> <p>\u9664\u4e86 Counter \u548c Gauge \u7c7b\u578b\u7684\u76d1\u63a7\u6307\u6807\u4ee5\u5916\uff0cPrometheus \u8fd8\u5b9a\u4e49\u4e86 Histogram \u548c Summary \u7684\u6307\u6807\u7c7b\u578b\u3002Histogram \u548c Summary \u4e3b\u7528\u7528\u4e8e\u7edf\u8ba1\u548c\u5206\u6790\u6837\u672c\u7684\u5206\u5e03\u60c5\u51b5\u3002</p> <p>\u4f8b\u5982\uff0c\u6307\u6807 prometheus_tsdb_wal_fsync_duration_seconds \u7684\u6307\u6807\u7c7b\u578b\u4e3aSummary\u3002 \u5b83\u8bb0\u5f55\u4e86 Prometheus Server \u4e2d wal_fsync \u5904\u7406\u7684\u5904\u7406\u65f6\u95f4\uff0c\u901a\u8fc7\u8bbf\u95ee Prometheus Server\u7684 /metrics\u5730\u5740\uff0c\u53ef\u4ee5\u83b7\u53d6\u5230\u4ee5\u4e0b\u76d1\u63a7\u6837\u672c\u6570\u636e\uff1a <pre><code># HELP prometheus_tsdb_wal_fsync_duration_seconds Duration of WAL fsync.\n# TYPE prometheus_tsdb_wal_fsync_duration_seconds summary\nprometheus_tsdb_wal_fsync_duration_seconds{quantile=\"0.5\"} 0.012352463\nprometheus_tsdb_wal_fsync_duration_seconds{quantile=\"0.9\"} 0.014458005\nprometheus_tsdb_wal_fsync_duration_seconds{quantile=\"0.99\"} 0.017316173\nprometheus_tsdb_wal_fsync_duration_seconds_sum 2.888716127000002\nprometheus_tsdb_wal_fsync_duration_seconds_count 216\n</code></pre></p> <p>\u4ece\u4e0a\u9762\u7684\u6837\u672c\u4e2d\u53ef\u4ee5\u5f97\u77e5\u5f53\u524d Prometheus Server \u8fdb\u884c wal_fsync \u64cd\u4f5c\u7684\u603b\u6b21\u6570\u4e3a 216 \u6b21\uff0c\u8017\u65f6 2.888716127000002s\u3002\u5176\u4e2d\u4e2d\u4f4d\u6570\uff08quantile=0.5\uff09\u7684\u8017\u65f6\u4e3a 0.012352463\uff0c9 \u5206\u4f4d\u6570\uff08quantile=0.9\uff09\u7684\u8017\u65f6\u4e3a 0.014458005s\u3002</p> <p>\u5728Prometheus Server\u81ea\u8eab\u8fd4\u56de\u7684\u6837\u672c\u6570\u636e\u4e2d\uff0c\u6211\u4eec\u8fd8\u80fd\u627e\u5230\u7c7b\u578b\u4e3a Histogram \u7684\u76d1\u63a7\u6307\u6807 prometheus_tsdb_compaction_chunk_range_bucket\u3002 <pre><code># HELP prometheus_tsdb_compaction_chunk_range Final time range of chunks on their first compaction\n# TYPE prometheus_tsdb_compaction_chunk_range histogram\nprometheus_tsdb_compaction_chunk_range_bucket{le=\"100\"} 0\nprometheus_tsdb_compaction_chunk_range_bucket{le=\"400\"} 0\nprometheus_tsdb_compaction_chunk_range_bucket{le=\"1600\"} 0\nprometheus_tsdb_compaction_chunk_range_bucket{le=\"6400\"} 0\nprometheus_tsdb_compaction_chunk_range_bucket{le=\"25600\"} 0\nprometheus_tsdb_compaction_chunk_range_bucket{le=\"102400\"} 0\nprometheus_tsdb_compaction_chunk_range_bucket{le=\"409600\"} 0\nprometheus_tsdb_compaction_chunk_range_bucket{le=\"1.6384e+06\"} 260\nprometheus_tsdb_compaction_chunk_range_bucket{le=\"6.5536e+06\"} 780\nprometheus_tsdb_compaction_chunk_range_bucket{le=\"2.62144e+07\"} 780\nprometheus_tsdb_compaction_chunk_range_bucket{le=\"+Inf\"} 780\nprometheus_tsdb_compaction_chunk_range_sum 1.1540798e+09\nprometheus_tsdb_compaction_chunk_range_count 780\n</code></pre> \u4e0eSummary\u7c7b\u578b\u7684\u6307\u6807\u76f8\u4f3c\u4e4b\u5904\u5728\u4e8eHistogram\u7c7b\u578b\u7684\u6837\u672c\u540c\u6837\u4f1a\u53cd\u5e94\u5f53\u524d\u6307\u6807\u7684\u8bb0\u5f55\u7684\u603b\u6570(\u4ee5_count\u4f5c\u4e3a\u540e\u7f00)\u4ee5\u53ca\u5176\u503c\u7684\u603b\u91cf\uff08\u4ee5_sum\u4f5c\u4e3a\u540e\u7f00\uff09\u3002\u4e0d\u540c\u5728\u4e8eHistogram\u6307\u6807\u76f4\u63a5\u53cd\u5e94\u4e86\u5728\u4e0d\u540c\u533a\u95f4\u5185\u6837\u672c\u7684\u4e2a\u6570\uff0c\u533a\u95f4\u901a\u8fc7\u6807\u7b7elen\u8fdb\u884c\u5b9a\u4e49\u3002</p> <p>\u67e5\u8be2\u65f6\u95f4\u5e8f\u5217 <pre><code>http_requests_total\n</code></pre></p> <p>\u7b49\u540c\u4e8e <pre><code>http_requests_total{}\n</code></pre></p> <p>\u8be5\u8868\u8fbe\u5f0f\u4f1a\u8fd4\u56de\u6307\u6807\u540d\u79f0\u4e3ahttp_requests_total\u7684\u6240\u6709\u65f6\u95f4\u5e8f\u5217\uff1a <pre><code>http_requests_total{code=\"200\",handler=\"alerts\",instance=\"localhost:9090\",job=\"prometheus\",method=\"get\"}=(20889@1518096812.326)\nhttp_requests_total{code=\"200\",handler=\"graph\",instance=\"localhost:9090\",job=\"prometheus\",method=\"get\"}=(21287@1518096812.326)\n</code></pre></p> <p>PromQL \u8fd8\u652f\u6301\u6307\u6807\u7684\u6807\u7b7e\u8fc7\u6ee4\uff0c\u5b8c\u5168\u5339\u914d\uff1a= \u548c !=\uff0c\u6b63\u5219\u5339\u914d\uff1a=~ \u548c !~\u3002 <pre><code>http_requests_total{environment=~\"staging|testing|development\",method!=\"GET\"}\n</code></pre></p> <p>\u4e0a\u8ff0\u67e5\u8be2\u9ed8\u8ba4\u8fd4\u56de\u6307\u6807\u7684\u6700\u65b0\u4e00\u4e2a\u6837\u672c\uff0c\u8fd9\u6837\u7684\u8fd4\u56de\u7ed3\u6784\u79f0\u4e3a\u77ac\u65f6\u5411\u91cf\uff0c\u76f8\u5e94\u7684\u8868\u8fbe\u5f0f\u79f0\u4e3a\u77ac\u65f6\u5411\u91cf\u8868\u8fbe\u5f0f\u3002</p> <p>\u5982\u679c\u60f3\u8981\u83b7\u53d6\u4e00\u6bb5\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6837\u672c\u6570\u636e\uff0c\u5219\u9700\u8981\u4f7f\u7528\u533a\u95f4\u5411\u91cf\u8868\u8fbe\u5f0f\uff0c\u533a\u95f4\u5411\u91cf\u8868\u8fbe\u5f0f\u9700\u8981\u5b9a\u4e49\u4e8b\u4ef6\u9009\u62e9\u8303\u56f4\u3002 <pre><code>http_requests_total{}[5m]\n</code></pre> \u8fd4\u56de\u7ed3\u679c <pre><code>http_requests_total{code=\"200\",handler=\"alerts\",instance=\"localhost:9090\",job=\"prometheus\",method=\"get\"}=[\n    1@1518096812.326\n    1@1518096817.326\n    1@1518096822.326\n    1@1518096827.326\n    1@1518096832.326\n    1@1518096837.325\n]\nhttp_requests_total{code=\"200\",handler=\"graph\",instance=\"localhost:9090\",job=\"prometheus\",method=\"get\"}=[\n    4 @1518096812.326\n    4@1518096817.326\n    4@1518096822.326\n    4@1518096827.326\n    4@1518096832.326\n    4@1518096837.325\n]\n</code></pre></p> <p>\u8fd8\u652f\u6301\u5176\u5b83\u65f6\u95f4\u5355\u4f4d\uff1ay\u3001w\u3001d\u3001h\u3001m\u3001s\u3002</p> <p>\u5728\u77ac\u65f6\u5411\u91cf\u8868\u8fbe\u5f0f\u6216\u8005\u533a\u95f4\u5411\u91cf\u8868\u8fbe\u5f0f\u4e2d\uff0c\u90fd\u662f\u4ee5\u5f53\u524d\u65f6\u95f4\u4e3a\u57fa\u51c6\uff1a <pre><code>http_request_total{} # \u77ac\u65f6\u5411\u91cf\u8868\u8fbe\u5f0f\uff0c\u9009\u62e9\u5f53\u524d\u6700\u65b0\u7684\u6570\u636e\nhttp_request_total{}[5m] # \u533a\u95f4\u5411\u91cf\u8868\u8fbe\u5f0f\uff0c\u9009\u62e9\u4ee5\u5f53\u524d\u65f6\u95f4\u4e3a\u57fa\u51c6\uff0c5\u5206\u949f\u5185\u7684\u6570\u636e\n</code></pre></p> <p>\u800c\u5982\u679c\u6211\u4eec\u60f3\u67e5\u8be2\uff0c5\u5206\u949f\u524d\u7684\u77ac\u65f6\u6837\u672c\u6570\u636e\uff0c\u6216\u6628\u5929\u4e00\u5929\u7684\u533a\u95f4\u5185\u7684\u6837\u672c\u6570\u636e\u5462? \u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u4f4d\u79fb\u64cd\u4f5c\uff0c\u4f4d\u79fb\u64cd\u4f5c\u7684\u5173\u952e\u5b57\u4e3aoffset\u3002 \u53ef\u4ee5\u4f7f\u7528offset\u65f6\u95f4\u4f4d\u79fb\u64cd\u4f5c\uff1a <pre><code>http_request_total{} offset 5m\nhttp_request_total{}[1d] offset 1d\n</code></pre></p> <p>\u6807\u91cf scalar</p> <p>\u6807\u91cf\u53ea\u662f\u4e00\u4e2a\u6570\u5b57\uff0c\u6ca1\u6709\u65f6\u5e8f\u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7\u5185\u7f6e\u51fd\u6570 scalar \u5c06\u5355\u4e2a\u77ac\u65f6\u5411\u91cf\u8f6c\u6362\u4e3a\u6807\u91cf\u3002</p> <p>\u6570\u5b66\u8fd0\u7b97</p> <p><pre><code>node_memory_free_bytes_total / (1024 * 1024)\n</code></pre> \u5f53\u77ac\u65f6\u5411\u91cf\u4e0e\u6807\u91cf\u4e4b\u95f4\u8fdb\u884c\u6570\u5b66\u8fd0\u7b97\u65f6\uff0c\u6570\u5b66\u8fd0\u7b97\u4f1a\u4f9d\u6b21\u4f5c\u7528\u4e0e\u77ac\u65f6\u5411\u91cf\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6837\u672c\u503c\uff0c\u4ece\u800c\u7684\u5230\u4e00\u7ec4\u65b0\u7684\u65f6\u95f4\u5e8f\u5217\u3002</p> <p>\u5982\u679c\u662f\u77ac\u65f6\u5411\u91cf\u4e0e\u77ac\u65f6\u5411\u91cf\u4e4b\u95f4\u8fdb\u884c\u6570\u5b66\u8fd0\u7b97\u65f6\uff0c\u8fc7\u7a0b\u4f1a\u76f8\u5bf9\u590d\u6742\u4e00\u70b9\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u6211\u4eec\u60f3\u6839\u636enode_disk_bytes_written\u548cnode_disk_bytes_read\u83b7\u53d6\u4e3b\u673a\u78c1\u76d8IO\u7684\u603b\u91cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u8868\u8fbe\u5f0f\uff1a <pre><code>node_disk_bytes_written + node_disk_bytes_read\n</code></pre></p> <p>\u90a3\u8fd9\u4e2a\u8868\u8fbe\u5f0f\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u5462\uff1f\u4f9d\u6b21\u627e\u5230\u4e0e\u5de6\u8fb9\u5411\u91cf\u5143\u7d20\u5339\u914d\uff08\u6807\u7b7e\u5b8c\u5168\u4e00\u81f4\uff09\u7684\u53f3\u8fb9\u5411\u91cf\u5143\u7d20\u8fdb\u884c\u8fd0\u7b97\uff0c\u5982\u679c\u6ca1\u627e\u5230\u5339\u914d\u5143\u7d20\uff0c\u5219\u76f4\u63a5\u4e22\u5f03\u3002\u540c\u65f6\u65b0\u7684\u65f6\u95f4\u5e8f\u5217\u5c06\u4e0d\u4f1a\u5305\u542b\u6307\u6807\u540d\u79f0\u3002 \u8be5\u8868\u8fbe\u5f0f\u8fd4\u56de\u7ed3\u679c\u7684\u793a\u4f8b\u5982\u4e0b\u6240\u793a\uff1a <pre><code>{device=\"sda\",instance=\"localhost:9100\",job=\"node_exporter\"}=&gt;1634967552@1518146427.807 + 864551424@1518146427.807\n{device=\"sdb\",instance=\"localhost:9100\",job=\"node_exporter\"}=&gt;0@1518146427.807 + 1744384@1518146427.807\n</code></pre></p> <p>PromQL\u652f\u6301\u7684\u6240\u6709\u6570\u5b66\u8fd0\u7b97\u7b26\u5982\u4e0b\u6240\u793a\uff1a - <code>+</code> (\u52a0\u6cd5) - <code>-</code> (\u51cf\u6cd5) - <code>*</code> (\u4e58\u6cd5) - <code>/</code> (\u9664\u6cd5) - <code>%</code> (\u6c42\u4f59) - <code>^</code> (\u5e42\u8fd0\u7b97)</p> <p>Prometheus\u8fd8\u63d0\u4f9b\u4e86\u4e0b\u5217\u5185\u7f6e\u7684\u805a\u5408\u64cd\u4f5c\u7b26\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u7b26\u4f5c\u7528\u57df\u77ac\u65f6\u5411\u91cf\u3002\u53ef\u4ee5\u5c06\u77ac\u65f6\u8868\u8fbe\u5f0f\u8fd4\u56de\u7684\u6837\u672c\u6570\u636e\u8fdb\u884c\u805a\u5408\uff0c\u5f62\u6210\u4e00\u4e2a\u65b0\u7684\u65f6\u95f4\u5e8f\u5217\u3002 - <code>sum</code> (\u6c42\u548c) - <code>min</code> (\u6700\u5c0f\u503c)   - <code>max</code> (\u6700\u5927\u503c) - <code>avg</code> (\u5e73\u5747\u503c) - <code>stddev</code> (\u6807\u51c6\u5dee) - <code>stdvar</code> (\u6807\u51c6\u65b9\u5dee) - <code>count</code> (\u8ba1\u6570) - <code>count_values</code> (\u5bf9value\u8fdb\u884c\u8ba1\u6570) - <code>bottomk</code> (\u540en\u6761\u65f6\u5e8f) - <code>topk</code> (\u524dn\u6761\u65f6\u5e8f) - <code>quantile</code> (\u5206\u4f4d\u6570)</p> <p>\u4f7f\u7528\u805a\u5408\u64cd\u4f5c\u7684\u8bed\u6cd5\u5982\u4e0b\uff1a <pre><code>&lt;aggr-op&gt;([parameter,] &lt;vector expression&gt;) [without|by (&lt;label list&gt;)]\n</code></pre> \u5176\u4e2d\u53ea\u6709<code>count_values</code>, <code>quantile</code>, <code>topk</code>, <code>bottomk</code>\u652f\u6301\u53c2\u6570(parameter)\u3002</p> <p>by \u662f\u901a\u8fc7\u6307\u5b9a\u7684\u6807\u7b7e\u8fdb\u884c\u5206\u7ec4\uff0cwithout \u662f\u5254\u9664\u6307\u5b9a\u7684\u6807\u7b7e\uff0c\u5176\u4f59\u6807\u7b7e\u4f5c\u4e3a\u5206\u7ec4\u4f9d\u636e\u3002 \u5047\u8bbe\u6709\u4ee5\u4e0b\u6307\u6807\uff1a <pre><code>http_requests_total{instance=\"server1\", job=\"web\", method=\"GET\"}  100 \nhttp_requests_total{instance=\"server2\", job=\"web\", method=\"GET\"} 200 \nhttp_requests_total{instance=\"server1\", job=\"web\", method=\"POST\"} 50 \nhttp_requests_total{instance=\"server2\", job=\"web\", method=\"POST\"} 150\n</code></pre></p> <p>\u4f7f\u7528 by \u805a\u5408 <pre><code>sum(http_requests_total) by (method)\n</code></pre></p> <p>\u7ed3\u679c <pre><code>{method=\"GET\"}  300 \n{method=\"POST\"} 200\n</code></pre></p> <p>\u4f7f\u7528 without \u805a\u5408 <pre><code>sum(http_requests_total) without (instance)\n</code></pre></p> <p>\u7ed3\u679c <pre><code>{job=\"web\", method=\"GET\"}  300 \n{job=\"web\", method=\"POST\"} 200\n</code></pre></p> <p>\u5185\u7f6e\u51fd\u6570</p> <p>increase(v range-vector) \u8ba1\u7b97\u65f6\u95f4\u8303\u56f4\u5185\u7684\u603b\u589e\u91cf rate(v range-vector) \u8ba1\u7b97\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6bcf\u79d2\u5e73\u5747\u589e\u957f\u7387 irate(v range-vector) \u57fa\u4e8e\u6700\u540e\u4e24\u4e2a\u6570\u636e\u70b9\u8ba1\u7b97\u7684\u6bcf\u79d2\u77ac\u65f6\u589e\u957f\u7387</p>"},{"location":"Operations/Prometheus/%E8%BF%90%E7%BB%B4%E7%9B%91%E6%8E%A7/","title":"\u8fd0\u7ef4\u76d1\u63a7","text":""},{"location":"Operations/Prometheus/%E8%BF%90%E7%BB%B4%E7%9B%91%E6%8E%A7/#prometheus","title":"Prometheus","text":"<p>Prometheus \u4e00\u4e2a\u65f6\u5e8f\u6570\u636e\u5e93\uff0c\u9002\u7528\u4e8e\u8fd0\u7ef4\u76d1\u63a7\u573a\u666f\u3002</p> <p>\u4e0b\u8f7d\u89e3\u538b\u7f29 tar -zxvf prometheus-3.0.1.linux-amd64.tar.gz -C /srv/</p> <p>\u8fd0\u884c nohup ./prometheus --config.file=prometheus.yml &gt;./info.log 2&gt;&amp;1 &amp;</p> <p>\u8bbf\u95ee http://localhost:9090 \u8fdb\u5165 web \u63a7\u5236\u53f0\u754c\u9762</p> <p>\u9ed8\u8ba4\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u65b0\u5efa data \u6587\u4ef6\u5939\u5b58\u50a8\u6570\u636e\uff0c\u9ed8\u8ba4\u6570\u636e\u4fdd\u5b58 15 \u5929\u3002</p> <p>\u542f\u52a8\u9009\u9879 --storage.tsdb.path \u6307\u5b9a\u5b58\u50a8\u76ee\u5f55 --storage.tsdb.retention.time \u8bbe\u7f6e\u6570\u636e\u4fdd\u5b58\u65f6\u95f4\uff0c\u9ed8\u8ba4 15d\uff0c\u652f\u6301 y\u3001w\u3001d\u3001h\u3001m\u3001s\u3001ms\u3002 --storage.tsdb.retention.size \u8bbe\u7f6e\u6570\u636e\u5b58\u50a8\u5757\u7684\u603b\u5927\u5c0f\uff0c\u9ed8\u8ba4 0 \u672a\u542f\u7528\u3002\u652f\u6301\u5355\u4f4d B\u3001KB\u3001MB\u3001GB\u3001TB\u3001PB\u3001EB\uff0c\u8d85\u8fc7\u6b64\u503c\u65f6\u4f1a\u5220\u9664\u6700\u65e7\u7684\u6570\u636e\u5757\u3002</p> <p>\u6821\u9a8c\u914d\u7f6e\u6587\u4ef6\u8bed\u6cd5 <pre><code>./promtool check config prometheus.yml\n</code></pre></p> <p>\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e <pre><code>kill -HUP &lt;PID&gt;\n</code></pre></p> <p>Tips Prometheus \u9ed8\u8ba4\u7684\u6807\u7b7e  <pre><code>__address__=\"localhost:9090\"\n\n__metrics_path__=\"/metrics\"\n\n__scheme__=\"http\"\n\n__scrape_interval__=\"15s\"\n\n__scrape_timeout__=\"10s\"\n\njob=\"prometheus\"\n</code></pre></p> <p>Prometheus \u4f1a\u5c06\u5e26\u6709\u524d\u7f00 <code>__param_</code> \u7684\u6807\u7b7e\u503c\u8f6c\u6362\u4e3a HTTP \u8bf7\u6c42\u7684\u67e5\u8be2\u53c2\u6570\u3002\u6807\u7b7e\u7684\u540d\u79f0\u53bb\u6389 <code>__param_</code> \u524d\u7f00\u540e\uff0c\u5269\u4e0b\u7684\u90e8\u5206\u6210\u4e3a\u53c2\u6570\u540d\uff0c\u6807\u7b7e\u7684\u503c\u6210\u4e3a\u53c2\u6570\u503c\u3002</p> <p>\u4e00\u822c\u4f7f\u7528\u5982\u4e0b\u914d\u7f6e\u5bf9 target \u76ee\u6807\u8fdb\u884c\u6293\u53d6 <pre><code>static_configs:\n  - targets:\n      - server1:3306\n      - server2:3306\n    labels:\n      - name: kaka\n      - remark: tata\n</code></pre></p> <p><code>__address__</code> \u662f Prometheus \u7684\u5185\u7f6e\u6807\u7b7e\uff0c\u9ed8\u8ba4\u5305\u542b <code>targets</code> \u7684\u503c\u3002\u5b83\u8868\u793a Prometheus \u5728\u8fdb\u884c HTTP \u6293\u53d6\u65f6\u7684\u5b9e\u9645\u5730\u5740\uff0c\u5305\u62ec\u4e3b\u673a\u548c\u7aef\u53e3\u3002\u53ef\u4ee5\u901a\u8fc7 <code>relabel_configs</code> \u52a8\u6001\u4fee\u6539 <code>__address__</code> \u7684\u503c\uff0c\u4ece\u800c\u6539\u53d8 Prometheus \u6700\u7ec8\u6293\u53d6\u7684\u5b9e\u9645\u5730\u5740\u3002</p> <p>\u66ff\u6362\u6293\u53d6\u5730\u5740 \u5728\u5f88\u591a\u573a\u666f\u4e0b\uff0c<code>targets</code> \u53ea\u662f\u903b\u8f91\u5730\u5740\uff0c\u6700\u7ec8\u6293\u53d6\u5730\u5740\u9700\u8981\u901a\u8fc7 <code>relabel_configs</code> \u6765\u91cd\u5b9a\u5411\uff0c\u4f8b\u5982\uff1a <pre><code>relabel_configs:\n  - source_labels: [__address__]\n    target_label: __param_target\n  - target_label: __address__\n    replacement: localhost:9104\n</code></pre> \u8fd9\u6837\u7684\u8bdd target \u5c31\u8f6c\u6362\u4e3a\u4e86\u53c2\u6570\uff0c\u800c\u5b9e\u9645\u7684\u8bf7\u6c42\u5730\u5740\u4e3a localhost:9104</p>"},{"location":"Operations/Prometheus/%E8%BF%90%E7%BB%B4%E7%9B%91%E6%8E%A7/#exporter","title":"Exporter","text":""},{"location":"Operations/Prometheus/%E8%BF%90%E7%BB%B4%E7%9B%91%E6%8E%A7/#mysqld_exporter","title":"mysqld_exporter","text":"<p>MySQL \u521b\u5efa\u8d26\u53f7 <pre><code>create user exporter@localhost identified by 'xxxxxxxxxx' with max_user_connections 3;\ngrant process, replication client, select on *.* to exporter@localhost;\nflush privileges;\n</code></pre></p> <p>\u4e0b\u8f7d\u89e3\u538b\u7f29 tar -zxvf mysqld_exporter-0.16.0.linux-amd64.tar.gz -C /srv/</p> <p>\u542f\u52a8 <pre><code>nohup ./mysqld_exporter &gt;info.log 2&gt;&amp;1 &amp;\n</code></pre></p> <p>mysqld_exporter \u63a5\u6536 target \u53c2\u6570\u6765\u68c0\u6d4b\u5bf9\u5e94\u7684\u76ee\u6807 /probe?target=host:port\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u5728 URL \u4e2d\u4f20\u9012\u7528\u6237\u540d\u5bc6\u7801\uff0c\u9ed8\u8ba4\u4f7f\u7528 ./.my.cnf \u6587\u4ef6\u4e2d\u7684 client \u8ba4\u8bc1\u914d\u7f6e\u4f5c\u4e3a\u8fde\u63a5 MySQL \u7684\u8d26\u53f7\u5bc6\u7801\uff0c\u53ef\u4ee5\u4f7f\u7528 config.my-cnf \u542f\u52a8\u9009\u9879\u624b\u52a8\u7f6e\u9876\u6539\u6587\u4ef6\u7684\u5730\u5740\u3002\u7136\u540e\u4f7f\u7528 auth_module \u53c2\u6570 <code>&amp;auth_module=&lt;section&gt;</code>\u00a0\u6765\u5339\u914d\u8ba4\u8bc1\u4fe1\u606f\u3002 <pre><code>[client]\nuser = usr\npassword = pwd\n[clienta]\nuser = usr\npassword = pwd\n[clientb]\nuser = usr\npassword = pwd\n</code></pre></p> <p>\u5982\u679c\u8981\u5728\u540c\u4e00\u4e2a job_name \u4e0b\u914d\u7f6e\u591a\u76ee\u6807\u68c0\u6d4b\u6709\u4e24\u79cd\u914d\u7f6e\u65b9\u5f0f \u7b2c\u4e00\u79cd\uff0c\u6240\u6709\u7684\u76ee\u6807\u90fd\u662f\u7528\u540c\u4e00\u4e2a\u8d26\u53f7\u5bc6\u7801\uff0cPrometheus \u914d\u7f6e\u5982\u4e0b\uff0cserver1 \u548c server2 \u90fd\u662f\u7528 clienta \u8ba4\u8bc1\u914d\u7f6e\u3002 <pre><code>    - job_name: mysql # To get metrics about the mysql exporter\u2019s targets\n      params:\n        # Not required. Will match value to child in config file. Default value is `client`.\n        auth_module: [clienta]\n      static_configs:\n        - targets:\n          # All mysql hostnames or unix sockets to monitor.\n          - server1:3306\n          - server2:3306\n      relabel_configs:\n        - source_labels: [__address__]\n          target_label: __param_target\n        - source_labels: [__param_target]\n          target_label: instance\n        - target_label: __address__\n          # The mysqld_exporter host:port\n          replacement: localhost:9104\n</code></pre></p> <p>\u7b2c\u4e8c\u79cd\uff0c\u6709\u4e0d\u540c\u7684\u8ba4\u8bc1\u8d26\u53f7\u548c\u5bc6\u7801\uff0c\u5df2\u7ecf\u5728 .my.cnf \u4e2d\u914d\u7f6e\u4e86\uff0cPrometheus \u914d\u7f6e\u5982\u4e0b <pre><code>  - job_name: \"mysql exporter\"\n    static_configs:\n      - targets:\n        - localhost:3306\n        labels:\n          auth_module: clienta\n          app: MySQL\n          name: \"clienta db\"\n      - targets:\n        - localhost:3306\n        labels:\n          auth_module: clientb\n          app: MySQL\n          name: \"clientb db\"\n    metrics_path: /probe\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__patam_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: localhost:9104\n      - source_labels: [auth_module]\n        target_label: __param_auth_module\n      - action: labeldrop\n        regex: auth_module\n</code></pre></p>"},{"location":"Operations/Prometheus/%E8%BF%90%E7%BB%B4%E7%9B%91%E6%8E%A7/#node_exporter","title":"node_exporter","text":"<p>tar -zxvf node_exporter-1.8.2.linux-amd64.tar.gz -C /srv/ mv node_exporter-1.8.2.linux-amd64/ node_exporter</p> <p>\u9ed8\u8ba4\u76d1\u542c\u7aef\u53e3 9100</p> <p>\u7f16\u8f91 prometheus \u914d\u7f6e\u6587\u4ef6\uff0c\u6dfb\u52a0\u76d1\u63a7 <pre><code>  - job_name: \"node exporter\"\n    static_configs:\n      - targets: [\"localhost:9100\"] \n</code></pre></p> <p>\u6307\u6807 CPU \u6838\u5fc3\u6570\u91cf \u4f7f\u7528 node_cpu_seconds_total \u6307\u6807\u8fdb\u884c\u7edf\u8ba1\uff0c\u8868\u793a\u4ece\u7cfb\u7edf\u542f\u52a8\u5230\u5f53\u524d\u65f6\u95f4\u70b9\uff0cCPU \u5728\u7279\u5b9a\u72b6\u6001\u4e0b\u7d2f\u8ba1\u4f7f\u7528\u7684\u65f6\u95f4\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002 <pre><code># HELP node_cpu_seconds_total Seconds the CPUs spent in each mode.\n# TYPE node_cpu_seconds_total counter\nnode_cpu_seconds_total{cpu=\"0\",mode=\"idle\"} 2.7743456e+06\nnode_cpu_seconds_total{cpu=\"0\",mode=\"iowait\"} 259.22\nnode_cpu_seconds_total{cpu=\"0\",mode=\"irq\"} 0\nnode_cpu_seconds_total{cpu=\"0\",mode=\"nice\"} 1.67\nnode_cpu_seconds_total{cpu=\"0\",mode=\"softirq\"} 483.32\nnode_cpu_seconds_total{cpu=\"0\",mode=\"steal\"} 0\nnode_cpu_seconds_total{cpu=\"0\",mode=\"system\"} 2896.12\nnode_cpu_seconds_total{cpu=\"0\",mode=\"user\"} 4644.81\nnode_cpu_seconds_total{cpu=\"1\",mode=\"idle\"} 2.77475794e+06\nnode_cpu_seconds_total{cpu=\"1\",mode=\"iowait\"} 251.45\nnode_cpu_seconds_total{cpu=\"1\",mode=\"irq\"} 0\nnode_cpu_seconds_total{cpu=\"1\",mode=\"nice\"} 1.74\nnode_cpu_seconds_total{cpu=\"1\",mode=\"softirq\"} 522.6\nnode_cpu_seconds_total{cpu=\"1\",mode=\"steal\"} 0\nnode_cpu_seconds_total{cpu=\"1\",mode=\"system\"} 2840.9\nnode_cpu_seconds_total{cpu=\"1\",mode=\"user\"} 4591.24\n</code></pre></p> <p>mode \u6807\u8bc6 CPU \u7684\u8fd0\u884c\u6a21\u5f0f\u6216\u72b6\u6001\uff0c\u5305\u62ec\u4ee5\u4e0b\u51e0\u79cd\u5e38\u89c1\u503c\uff1a - <code>idle</code>\uff1a\u7a7a\u95f2\u65f6\u95f4 - <code>user</code>\uff1a\u7528\u6237\u6001\u8fd0\u884c\u65f6\u95f4 - <code>system</code>\uff1a\u7cfb\u7edf\u6001\uff08\u5185\u6838\u6001\uff09\u8fd0\u884c\u65f6\u95f4 - <code>iowait</code>\uff1a\u7b49\u5f85 I/O \u5b8c\u6210\u7684\u65f6\u95f4 - <code>irq</code>\uff1a\u5904\u7406\u786c\u4e2d\u65ad\u7684\u65f6\u95f4 - <code>softirq</code>\uff1a\u5904\u7406\u8f6f\u4e2d\u65ad\u7684\u65f6\u95f4 - <code>steal</code>\uff1a\u88ab\u865a\u62df\u5316\u7ba1\u7406\u7a0b\u5e8f\u5360\u7528\u7684\u65f6\u95f4 - <code>nice</code>\uff1a\u8c03\u6574\u8fc7\u4f18\u5148\u7ea7\u7684\u7528\u6237\u6001\u8fd0\u884c\u65f6\u95f4</p> <p><code>count(node_cpu_seconds_total{job=\"$job\", instance=\"$instance\"}) by (cpu)</code> \u67e5\u8be2\u7ed3\u679c <pre><code>{cpu=\"0\"} 8\n{cpu=\"1\"} 8\n</code></pre></p> <p><code>count(count(node_cpu_seconds_total{job=\"$job\", instance=\"$instance\"}) by (cpu))</code> \u67e5\u8be2\u7ed3\u679c <pre><code>2\n</code></pre></p> <p>\u5185\u5b58\u5927\u5c0f node_memory_MemTotal_bytes \u8868\u793a\u7cfb\u7edf\u7269\u7406\u5185\u5b58\u7684\u603b\u5bb9\u91cf\uff08\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff09 <pre><code>node_memory_MemTotal_bytes{instance=\"$node\",job=\"$job\"}\n</code></pre></p> <pre><code># cat /proc/meminfo \nMemTotal:        1749324 kB\nMemFree:          110480 kB\nMemAvailable:     669836 kB\nBuffers:          117796 kB\nCached:           529968 kB\n\u2026\u2026\nSwapTotal:             0 kB\nSwapFree:              0 kB\n\u2026\u2026\n</code></pre> <p>\u78c1\u76d8\u5bb9\u91cf\u5927\u5c0f node_filesystem_size_bytes \u8868\u793a\u6587\u4ef6\u7cfb\u7edf\u7684\u603b\u5927\u5c0f\uff0c\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d node_filesystem_avail_bytes \u8868\u793a\u6587\u4ef6\u7cfb\u7edf\u7684\u53ef\u7528\u5927\u5c0f\uff0c\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d</p> <p>\u7cfb\u7edf\u5f00\u673a\u65f6\u95f4\u65f6\u957f node_time_seconds \u8868\u793a\u7cfb\u7edf\u5f53\u524d\u65f6\u95f4\u6233\uff0cnode_boot_time_seconds \u8868\u793a\u7cfb\u7edf\u6700\u65b0\u4e00\u6b21\u542f\u52a8\u7684\u65f6\u95f4\u6233\uff1a <pre><code>node_time_seconds{instance=\"$node\",job=\"$job\"} - node_boot_time_seconds{instance=\"$node\",job=\"$job\"}\n</code></pre></p> <p>Grafana \u4e0b\u8f7d  <pre><code>wget https://dl.grafana.com/enterprise/release/grafana-enterprise-11.4.0.linux-amd64.tar.gz\ntar -zxvf grafana-enterprise-11.4.0.linux-amd64.tar.gz -C /srv/\nmv grafana-v11.4.0/ grafana\n</code></pre> \u542f\u52a8 nohup ./bin/grafana server &gt;/dev/null 2&gt;&amp;1 &amp;</p> <p>\u9ed8\u8ba4\u7aef\u53e3 3000\uff0c\u9ed8\u8ba4 admin/admin\uff0c\u9996\u6b21\u767b\u5f55\u9700\u8981\u66f4\u65b0\u5bc6\u7801\u3002</p> <p>\u6570\u636e\u9ed8\u8ba4\u5b58\u653e\u5728\u5b89\u88c5\u76ee\u5f55\u7684 data/ \u6587\u4ef6\u5939\uff0c\u65e5\u5fd7\u5b58\u653e\u5728 data/log/ \u6587\u4ef6\u5939\u4e0b\u3002</p>"},{"location":"Operations/Security/%E5%85%B3%E4%BA%8E%E5%AE%89%E5%85%A8/","title":"\u5173\u4e8e\u5b89\u5168","text":"<p>\u4ed8\u8d39\u5185\u5bb9 1. \u9632\u706b\u5899 2. \u6740\u6bd2\u8f6f\u4ef6</p> <p>\u4e1a\u52a1\u7cfb\u7edf 1. \u767b\u5f55\u5931\u8d25\u9501\u5b9a\u3002 2. \u4e0d\u80fd\u5b58\u5728 root/admin/administrator \u7b49\u7528\u6237\u540d\u3002 3. \u4e0d\u80fd\u5b58\u5728\u5f31\u53e3\u4ee4\uff0c\u5b9a\u671f\u5f3a\u5236\u7528\u6237\u66f4\u65b0\u5bc6\u7801\u3002 4. \u5b9a\u671f\u505a\u6e17\u900f\u6d4b\u8bd5\uff0cOPENVAS\u3002 5. \u4ee3\u7801\u6f0f\u6d1e\u626b\u63cf\uff0cSonarQube\u3002 6. \u8f6f\u4ef6\u4ee5\u975e root \u7528\u6237\u6267\u884c\uff0c\u6216\u8005 docker \u5bb9\u5668\u6267\u884c\u3002</p> <p>\u670d\u52a1\u5668 1. \u7ec8\u7aef 10 \u5206\u949f\u8d85\u65f6\u9000\u51fa\u3002 2. \u8d26\u53f7\u5bc6\u7801\u590d\u6742\u5ea6\u3002 3. \u767b\u5f55\u5931\u8d25\u9501\u5b9a\u3002 4. \u5b9a\u671f\u5f3a\u5236\u7528\u6237\u66f4\u7ec6\u5bc6\u7801\u3002 5. \u6700\u597d\u6709\u5821\u5792\u673a\uff0c\u6240\u6709\u7684\u670d\u52a1\u5668\u767b\u5f55\u53ea\u80fd\u901a\u8fc7\u5821\u5792\u673a\u3002 6. \u5f00\u542f\u5ba1\u8ba1\u8fdb\u7a0b\u670d\u52a1\uff0c\u5ba1\u8ba1\u65e5\u5fd7\u4fdd\u7559 90 \u5929\u3002</p> <p>\u7f51\u7edc 1. \u670d\u52a1\u7f51\u7edc\u73af\u5883\u6309\u7167\u9879\u76ee\u8fdb\u884c\u9694\u79bb\uff0c\u6a2a\u5411\u3002 2. \u81f3\u5c11\u5212\u5206\u4e24\u4e2a\u533a\uff0c\u5185\u7f51\u533a\u548c\u5916\u7f51\u533a\uff0c\u7ad6\u5411\u3002\u5916\u7f51\u533a\u670d\u52a1\u5668\u4ec5\u4f5c\u4ee3\u7406\u3002 3. \u5916\u7f51\u533a\u7684\u670d\u52a1\u5668\u53ea\u5f00\u9700\u8981\u7684\u7b56\u7565\uff0c\u8fdb\u548c\u51fa\u90fd\u662f\u3002 4. \u5185\u7f51\u533a\u7684\u670d\u52a1\u5668\u4e4b\u95f4\u5168\u901a\u3002 5. \u5185\u7f51\u533a\u548c\u5916\u7f51\u533a\u7684\u670d\u52a1\u5668\u901a\u4fe1\u53ea\u5f00\u70b9\u5bf9\u70b9\u7b56\u7565\u3002 6. \u670d\u52a1\u5668\u6a2a\u5411\u6309\u7167\u7f51\u7edc\u533a\u5206\u5c42\u9694\u79bb\uff0c\u7ad6\u5411\u6309\u7167\u9879\u76ee\u9694\u79bb\uff0c\u53ea\u5f00\u9700\u8981\u7684\u70b9\u5bf9\u70b9\u7b56\u7565\u3002 7. \u66f4\u4e25\u683c\u7684\u5212\u5206\uff0c     - Java \u670d\u52a1\u533a\u3001     - \u4e2d\u95f4\u4ef6\u533a\u3001     - \u6570\u636e\u5e93\u533a\uff1a     - \u7ba1\u7406\u8fd0\u7ef4\u533a\uff1a\u80fd\u591f\u6a2a\u5411\u548c\u7ad6\u5411\u8bbf\u95ee\u6240\u6709\u7684\u670d\u52a1\u5668\uff0c\u80fd\u591f\u8bbf\u95ee\u6240\u6709\u7684\u3002</p>"},{"location":"Operations/Security/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%89%E7%BA%A7%E7%AD%89%E4%BF%9D/","title":"\u670d\u52a1\u5668\u4e09\u7ea7\u7b49\u4fdd","text":""},{"location":"Operations/Security/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%89%E7%BA%A7%E7%AD%89%E4%BF%9D/#_1","title":"\u8eab\u4efd\u9274\u522b","text":"<p>a\uff09\u5e94\u5bf9\u767b\u5f55\u7684\u7528\u6237\u8fdb\u884c\u8eab\u4efd\u6807\u8bc6\u548c\u9274\u522b\uff0c\u8eab\u4efd\u6807\u8bc6\u5177\u6709\u552f\u4e00\u6027\uff0c\u8eab\u4efd\u9274\u522b\u4fe1\u606f\u5177\u6709\u590d\u6742\u5ea6\u8981\u6c42\u5e76\u5b9a\u671f\u66f4\u6362\uff1b b\uff09\u5e94\u5177\u6709\u767b\u5f55\u5931\u8d25\u5904\u7406\u529f\u80fd\uff0c\u5e94\u914d\u7f6e\u5e76\u542f\u7528\u7ed3\u675f\u4f1a\u8bdd\u3001\u9650\u5236\u975e\u6cd5\u767b\u5f55\u6b21\u6570\u548c\u5f53\u767b\u5f55\u8fde\u63a5\u8d85\u65f6\u81ea\u52a8\u9000\u51fa\u7b49\u76f8\u5173\u63aa\u65bd\uff1b c\uff09\u5f53\u8fdb\u884c\u8fdc\u7a0b\u7ba1\u7406\u65f6\uff0c\u5e94\u91c7\u53d6\u5fc5\u8981\u63aa\u65bd\u9632\u6b62\u9274\u522b\u4fe1\u606f\u5728\u7f51\u7edc\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u88ab\u7a83\u542c\uff1b d\uff09\u5e94\u91c7\u7528\u53e3\u4ee4\u3001\u5bc6\u7801\u6280\u672f\u3001\u751f\u7269\u6280\u672f\u7b49\u4e24\u79cd\u6216\u4e24\u79cd\u4ee5\u4e0a\u7ec4\u5408\u7684\u9274\u522b\u6280\u672f\u5bf9\u7528\u6237\u8fdb\u884c\u8eab\u4efd\u9274\u522b\uff0c\u4e14\u5176\u4e2d\u4e00\u79cd\u9274\u522b\u6280\u672f\u81f3\u5c11\u5e94\u4f7f\u7528\u5bc6\u7801\u6280\u672f\u6765\u5b9e\u73b0\u3002</p>"},{"location":"Operations/Security/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%89%E7%BA%A7%E7%AD%89%E4%BF%9D/#_2","title":"\u8bbf\u95ee\u63a7\u5236","text":"<p>a\uff09\u5e94\u5bf9\u767b\u5f55\u7684\u7528\u6237\u5206\u914d\u8d26\u6237\u548c\u6743\u9650\uff1b b\uff09\u5e94\u91cd\u547d\u540d\u6216\u5220\u9664\u9ed8\u8ba4\u8d26\u6237\uff0c\u4fee\u6539\u9ed8\u8ba4\u8d26\u6237\u7684\u9ed8\u8ba4\u53e3\u4ee4\uff1b c\uff09\u5e94\u53ca\u65f6\u5220\u9664\u6216\u505c\u7528\u591a\u4f59\u7684\u3001\u8fc7\u671f\u7684\u8d26\u6237\uff0c\u907f\u514d\u5171\u4eab\u8d26\u6237\u7684\u5b58\u5728\uff1b d\uff09\u5e94\u6388\u4e88\u7ba1\u7406\u7528\u6237\u6240\u9700\u7684\u6700\u5c0f\u6743\u9650\uff0c\u5b9e\u73b0\u7ba1\u7406\u7528\u6237\u7684\u6743\u9650\u5206\u79bb\uff1b e\uff09\u5e94\u7531\u6388\u6743\u4e3b\u4f53\u914d\u7f6e\u8bbf\u95ee\u63a7\u5236\u7b56\u7565\uff0c\u8bbf\u95ee\u63a7\u5236\u7b56\u7565\u89c4\u5b9a\u4e3b\u4f53\u5bf9\u5ba2\u4f53\u7684\u8bbf\u95ee\u89c4\u5219\uff1b f\uff09\u8bbf\u95ee\u63a7\u5236\u7684\u7c92\u5ea6\u5e94\u8fbe\u5230\u4e3b\u4f53\u4e3a\u7528\u6237\u7ea7\u6216\u8fdb\u7a0b\u7ea7\uff0c\u5ba2\u4f53\u4e3a\u6587\u4ef6\u3001\u6570\u636e\u5e93\u8868\u7ea7\uff1b g\uff09\u5e94\u5bf9\u91cd\u8981\u4e3b\u4f53\u548c\u5ba2\u4f53\u8bbe\u7f6e\u5b89\u5168\u6807\u8bb0\uff0c\u5e76\u63a7\u5236\u4e3b\u4f53\u5bf9\u6709\u5b89\u5168\u6807\u8bb0\u4fe1\u606f\u8d44\u6e90\u7684\u8bbf\u95ee\u3002</p>"},{"location":"Operations/Security/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%89%E7%BA%A7%E7%AD%89%E4%BF%9D/#_3","title":"\u5b89\u5168\u5ba1\u8ba1","text":"<p>a\uff09\u5e94\u542f\u7528\u5b89\u5168\u5ba1\u8ba1\u529f\u80fd\uff0c\u5ba1\u8ba1\u8986\u76d6\u5230\u6bcf\u4e2a\u7528\u6237\uff0c\u5bf9\u91cd\u8981\u7684\u7528\u6237\u884c\u4e3a\u548c\u91cd\u8981\u5b89\u5168\u4e8b\u4ef6\u8fdb\u884c\u5ba1\u8ba1\uff1b b\uff09\u5ba1\u8ba1\u8bb0\u5f55\u5e94\u5305\u62ec\u4e8b\u4ef6\u7684\u65e5\u671f\u548c\u65f6\u95f4\u3001\u7528\u6237\u3001\u4e8b\u4ef6\u7c7b\u578b\u3001\u4e8b\u4ef6\u662f\u5426\u6210\u529f\u53ca\u5176\u4ed6\u4e0e\u5ba1\u8ba1\u76f8\u5173\u7684\u4fe1\u606f\uff1b c\uff09\u5e94\u5bf9\u5ba1\u8ba1\u8bb0\u5f55\u8fdb\u884c\u4fdd\u62a4\uff0c\u5b9a\u671f\u5907\u4efd\uff0c\u907f\u514d\u53d7\u5230\u672a\u9884\u671f\u7684\u5220\u9664\u3001\u4fee\u6539\u6216\u8986\u76d6\u7b49\uff1b d\uff09\u5e94\u5bf9\u5ba1\u8ba1\u8fdb\u7a0b\u8fdb\u884c\u4fdd\u62a4\uff0c\u9632\u6b62\u672a\u7ecf\u6388\u6743\u7684\u4e2d\u65ad\u3002</p>"},{"location":"Operations/Security/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%89%E7%BA%A7%E7%AD%89%E4%BF%9D/#_4","title":"\u5165\u4fb5\u9632\u8303","text":"<p>a\uff09\u5e94\u9075\u5faa\u6700\u5c0f\u5b89\u88c5\u7684\u539f\u5219\uff0c\u4ec5\u5b89\u88c5\u9700\u8981\u7684\u7ec4\u4ef6\u548c\u5e94\u7528\u7a0b\u5e8f\uff1b b\uff09\u5e94\u5173\u95ed\u4e0d\u9700\u8981\u7684\u7cfb\u7edf\u670d\u52a1\u3001\u9ed8\u8ba4\u5171\u4eab\u548c\u9ad8\u5371\u7aef\u53e3\uff1b c\uff09\u5e94\u901a\u8fc7\u8bbe\u5b9a\u7ec8\u7aef\u63a5\u5165\u65b9\u5f0f\u6216\u7f51\u7edc\u5730\u5740\u8303\u56f4\u5bf9\u901a\u8fc7\u7f51\u7edc\u8fdb\u884c\u7ba1\u7406\u7684\u7ba1\u7406\u7ec8\u7aef\u8fdb\u884c\u9650\u5236\uff1b d\uff09\u5e94\u63d0\u4f9b\u6570\u636e\u6709\u6548\u6027\u68c0\u9a8c\u529f\u80fd\uff0c\u4fdd\u8bc1\u901a\u8fc7\u4eba\u673a\u63a5\u53e3\u8f93\u5165\u6216\u901a\u8fc7\u901a\u4fe1\u63a5\u53e3\u8f93\u5165\u7684\u5185\u5bb9\u7b26\u5408\u7cfb\u7edf\u8bbe\u5b9a\u8981\u6c42\uff1b e\uff09\u5e94\u80fd\u53d1\u73b0\u53ef\u80fd\u5b58\u5728\u7684\u5df2\u77e5\u6f0f\u6d1e\uff0c\u5e76\u5728\u7ecf\u8fc7\u5145\u5206\u6d4b\u8bd5\u8bc4\u4f30\u540e\uff0c\u53ca\u65f6\u4fee\u8865\u6f0f\u6d1e\uff1b f\uff09\u5e94\u80fd\u591f\u68c0\u6d4b\u5230\u5bf9\u91cd\u8981\u8282\u70b9\u8fdb\u884c\u5165\u4fb5\u7684\u884c\u4e3a\uff0c\u5e76\u5728\u53d1\u751f\u4e25\u91cd\u5165\u4fb5\u4e8b\u4ef6\u65f6\u63d0\u4f9b\u62a5\u8b66\u3002</p>"},{"location":"Operations/Security/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%89%E7%BA%A7%E7%AD%89%E4%BF%9D/#_5","title":"\u6076\u610f\u4ee3\u7801\u9632\u8303","text":"<p>a\uff09\u5e94\u91c7\u7528\u514d\u53d7\u6076\u610f\u4ee3\u7801\u653b\u51fb\u7684\u6280\u672f\u63aa\u65bd\u6216\u4e3b\u52a8\u514d\u75ab\u53ef\u4fe1\u9a8c\u8bc1\u673a\u5236\u53ca\u65f6\u8bc6\u522b\u5165\u4fb5\u548c\u75c5\u6bd2\u884c\u4e3a\uff0c\u5e76\u5c06\u5176\u6709\u6548\u963b\u65ad\u3002</p>"},{"location":"Operations/Security/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%89%E7%BA%A7%E7%AD%89%E4%BF%9D/#_6","title":"\u53ef\u4fe1\u9a8c\u8bc1","text":"<p>a\uff09\u53ef\u57fa\u4e8e\u53ef\u4fe1\u6839\u5bf9\u8ba1\u7b97\u8bbe\u5907\u7684\u7cfb\u7edf\u5f15\u5bfc\u7a0b\u5e8f\u3001\u7cfb\u7edf\u7a0b\u5e8f\u3001\u91cd\u8981\u914d\u7f6e\u53c2\u6570\u548c\u5e94\u7528\u7a0b\u5e8f\u7b49\u8fdb\u884c\u53ef\u4fe1\u9a8c\u8bc1\uff0c\u5e76\u5728\u5e94\u7528\u7a0b\u5e8f\u7684\u5173\u952e\u6267\u884c\u73af\u8282\u8fdb\u884c\u52a8\u6001\u53ef\u4fe1\u9a8c\u8bc1\uff0c\u5728\u68c0\u6d4b\u5230\u5176\u53ef\u4fe1\u6027\u53d7\u5230\u7834\u574f\u540e\u8fdb\u884c\u62a5\u8b66\uff0c\u5e76\u5c06\u9a8c\u8bc1\u7ed3\u679c\u5f62\u6210\u5ba1\u8ba1\u8bb0\u5f55\u9001\u81f3\u5b89\u5168\u7ba1\u7406\u4e2d\u5fc3\u3002</p>"},{"location":"Operations/Security/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%89%E7%BA%A7%E7%AD%89%E4%BF%9D/#_7","title":"\u6570\u636e\u5b8c\u6574\u6027","text":"<p>a\uff09\u5e94\u91c7\u7528\u6821\u9a8c\u6280\u672f\u6216\u5bc6\u7801\u6280\u672f\u4fdd\u8bc1\u91cd\u8981\u6570\u636e\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u7684\u5b8c\u6574\u6027\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u9274\u522b\u6570\u636e\u3001\u91cd\u8981\u4e1a\u52a1\u6570\u636e\u3001\u91cd\u8981\u5ba1\u8ba1\u6570\u636e\u3001\u91cd\u8981\u914d\u7f6e\u6570\u636e\u3001\u91cd\u8981\u89c6\u9891\u6570\u636e\u548c\u91cd\u8981\u4e2a\u4eba\u4fe1\u606f\u7b49\uff1b b\uff09\u5e94\u91c7\u7528\u6821\u9a8c\u6280\u672f\u6216\u5bc6\u7801\u6280\u672f\u4fdd\u8bc1\u91cd\u8981\u6570\u636e\u5728\u5b58\u50a8\u8fc7\u7a0b\u4e2d\u7684\u5b8c\u6574\u6027\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u9274\u522b\u6570\u636e\u3001\u91cd\u8981\u4e1a\u52a1\u6570\u636e\u3001\u91cd\u8981\u5ba1\u8ba1\u6570\u636e\u3001\u91cd\u8981\u914d\u7f6e\u6570\u636e\u3001\u91cd\u8981\u89c6\u9891\u6570\u636e\u548c\u91cd\u8981\u4e2a\u4eba\u4fe1\u606f\u7b49\u3002 a\uff09\u5e94\u91c7\u7528\u5bc6\u7801\u6280\u672f\u4fdd\u8bc1\u91cd\u8981\u6570\u636e\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u7684\u4fdd\u5bc6\u6027\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u9274\u522b\u6570\u636e\u3001\u91cd\u8981\u4e1a\u52a1\u6570\u636e\u548c\u91cd\u8981\u4e2a\u4eba\u4fe1\u606f\u7b49\uff1b b\uff09\u5e94\u91c7\u7528\u5bc6\u7801\u6280\u672f\u4fdd\u8bc1\u91cd\u8981\u6570\u636e\u5728\u5b58\u50a8\u8fc7\u7a0b\u4e2d\u7684\u4fdd\u5bc6\u6027\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u9274\u522b\u6570\u636e\u3001\u91cd\u8981\u4e1a\u52a1\u6570\u636e\u548c\u91cd\u8981\u4e2a\u4eba\u4fe1\u606f\u7b49\u3002</p>"},{"location":"Operations/Security/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%89%E7%BA%A7%E7%AD%89%E4%BF%9D/#_8","title":"\u6570\u636e\u5907\u4efd\u6062\u590d","text":"<p>a\uff09\u5e94\u63d0\u4f9b\u91cd\u8981\u6570\u636e\u7684\u672c\u5730\u6570\u636e\u5907\u4efd\u4e0e\u6062\u590d\u529f\u80fd\uff1b b\uff09\u5e94\u63d0\u4f9b\u5f02\u5730\u5b9e\u65f6\u5907\u4efd\u529f\u80fd\uff0c\u5229\u7528\u901a\u4fe1\u7f51\u7edc\u5c06\u91cd\u8981\u6570\u636e\u5b9e\u65f6\u5907\u4efd\u81f3\u5907\u4efd\u573a\u5730\uff1b c\uff09\u5e94\u63d0\u4f9b\u91cd\u8981\u6570\u636e\u5904\u7406\u7cfb\u7edf\u7684\u70ed\u5197\u4f59\uff0c\u4fdd\u8bc1\u7cfb\u7edf\u7684\u9ad8\u53ef\u7528\u6027\u3002</p>"},{"location":"Operations/Security/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%89%E7%BA%A7%E7%AD%89%E4%BF%9D/#_9","title":"\u5269\u4f59\u4fe1\u606f\u4fdd\u62a4","text":"<p>a\uff09\u5e94\u4fdd\u8bc1\u9274\u522b\u4fe1\u606f\u6240\u5728\u7684\u5b58\u50a8\u7a7a\u95f4\u88ab\u91ca\u653e\u6216\u91cd\u65b0\u5206\u914d\u524d\u5f97\u5230\u5b8c\u5168\u6e05\u9664\uff1b b\uff09\u5e94\u4fdd\u8bc1\u5b58\u6709\u654f\u611f\u6570\u636e\u7684\u5b58\u50a8\u7a7a\u95f4\u88ab\u91ca\u653e\u6216\u91cd\u65b0\u5206\u914d\u524d\u5f97\u5230\u5b8c\u5168\u6e05\u9664\u3002</p>"},{"location":"Operations/Security/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%89%E7%BA%A7%E7%AD%89%E4%BF%9D/#_10","title":"\u4e2a\u4eba\u4fe1\u606f\u4fdd\u62a4","text":"<p>a\uff09\u5e94\u4ec5\u91c7\u96c6\u548c\u4fdd\u5b58\u4e1a\u52a1\u5fc5\u9700\u7684\u7528\u6237\u4e2a\u4eba\u4fe1\u606f\uff1b b\uff09\u5e94\u7981\u6b62\u672a\u6388\u6743\u8bbf\u95ee\u548c\u975e\u6cd5\u4f7f\u7528\u7528\u6237\u4e2a\u4eba\u4fe1\u606f\u3002</p>"},{"location":"Python/Tips/","title":"Tips","text":"<p>Pip  pip3 \u4f1a\u5c06\u4e0b\u8f7d\u7684\u5305\u5b58\u50a8\u5728\u7f13\u5b58\u76ee\u5f55\u4e2d\u3002\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\u7f13\u5b58\u76ee\u5f55\uff1a <pre><code>pip3 cache dir\n</code></pre></p>"},{"location":"Python/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/","title":"Python","text":"<p>Python \u57fa\u7840\u5b66\u4e60\u56fe\u4e66 1. Python\u7f16\u7a0b\uff1a\u4ece\u5165\u95e8\u5230\u5b9e\u8df5 2. Python\u7f16\u7a0b\u5165\u95e8.\u7b2c3\u7248</p>"},{"location":"Python/%E7%AC%AC%2010%20%E7%AB%A0%EF%BC%9A%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/","title":"\u7b2c 10 \u7ae0\uff1a\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b","text":""},{"location":"Python/%E7%AC%AC%2010%20%E7%AB%A0%EF%BC%9A%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/#_1","title":"\u6784\u9020\u51fd\u6570","text":"<p>\u5b9a\u4e49\u4e86 Person \u7c7b\uff0c\u5305\u542b\u6570\u636e name \u548c age\u3002 <code>__init__</code> \u662f\u6784\u9020\u51fd\u6570\uff0c\u6bcf\u6b21\u521b\u5efa\u65b0\u5bf9\u8c61\u65f6\uff0c\u90fd\u5c06\u8c03\u7528\u6784\u9020\u51fd\u6570\u3002</p> <pre><code># person.py\n\nclass Person:\n    \"\"\"\n    Class to represend a person\n    \"\"\"\n\n    def __init__(self):\n        self.name = ''\n        self.age = 0\n</code></pre> <p>\u6d4b\u8bd5\u5b9e\u4f8b\u5316\u5bf9\u8c61\u3002 <pre><code>&gt;&gt;&gt; import person\n&gt;&gt;&gt; p = person.Person()\n&gt;&gt;&gt; p\n&lt;person.Person object at 0x0000017F1431CE30&gt;\n</code></pre></p> <p>\u53c2\u6570 self\uff0cself \u6307\u5411\u5bf9\u8c61\u81ea\u8eab\uff0c\u7c7b\u4f3c Java \u4e2d\u7684 <code>this</code>\u3002Python \u7684\u6807\u51c6\u505a\u6cd5\u5c06 <code>__init__</code> \u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u547d\u540d\u4e3a self\uff0c\u6307\u5411\u5bf9\u8c61\u81ea\u8eab\u3002</p>"},{"location":"Python/%E7%AC%AC%2010%20%E7%AB%A0%EF%BC%9A%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/#_2","title":"\u663e\u793a\u5bf9\u8c61","text":"<p>Python \u63d0\u4f9b\u4e86\u4e00\u4e9b\u7279\u6b8a\u7684\u65b9\u6cd5\uff0c\u8ba9\u5bf9\u8c61\u5b8c\u7f8e\u652f\u6301\u6253\u5370\u3002 <pre><code># person.py\n\nclass Person:\n    \"\"\"\n    Class to represend a person\n    \"\"\"\n\n    def __init__(self):\n        self.name = ''\n        self.age = 0\n\n    def __str__(self):\n        return \"Person('%s', %d)\" % (self.name, self.age)\n</code></pre></p> <p>\u6d4b\u8bd5\u3002 <pre><code>&gt;&gt;&gt; import person\n&gt;&gt;&gt; p = person.Person()\n&gt;&gt;&gt; str(p)\n\"Person('', 0)\"\n</code></pre></p> <p>\u51fd\u6570 <code>__repr__</code> \u8fd4\u56de\u5bf9\u8c61\u7684\u5b98\u65b9\u8868\u793a\u3002\u4f8b\u5982\uff0c\u9ed8\u8ba4\u7684\u8f93\u51fa\u5982\u4e0b\u3002 <pre><code>&gt;&gt;&gt; p\n&lt;person.Person object at 0x0000017F1431CE30&gt;\n</code></pre></p> <p>\u589e\u52a0 <code>__repr__</code> \u51fd\u6570\u3002 <pre><code># person.py\n\nclass Person:\n    \"\"\"\n    Class to represend a person\n    \"\"\"\n\n    def __init__(self):\n        self.name = ''\n        self.age = 0\n\n    def __str__(self):\n        return \"Person('%s', %d)\" % (self.name, self.age)\n\n    def __repr__(self):\n        return str(self)\n</code></pre></p> <p>\u6d4b\u8bd5\u3002 <pre><code>&gt;&gt;&gt; import person\n&gt;&gt;&gt; p = person.Person()\n&gt;&gt;&gt; p\nPerson('', 0)\n</code></pre></p> <p><code>__str__</code> \u63d0\u4f9b\u53cb\u597d\u3001\u53ef\u9605\u8bfb\u7684\u5b57\u7b26\u4e32\u8868\u793a\u5f62\u5f0f\uff0c\u4f7f\u7528 <code>print()</code> \u51fd\u6570\u76f4\u63a5\u6253\u5370\u5bf9\u8c61\u65f6\u4f1a\u8c03\u7528\u8be5\u51fd\u6570\u3002 <code>__repr__</code> \u63d0\u4f9b\u66f4\u8be6\u7ec6\u3001\u66f4\u5177\u5f00\u53d1\u8005\u53cb\u597d\u7684\u5b57\u7b26\u4e32\u8868\u793a\u5f62\u5f0f\uff0c\u5728\u4ea4\u4e92\u5f0f\u73af\u5883\u4e2d\u76f4\u63a5\u8f93\u51fa\u5bf9\u8c61\u4f1a\u8c03\u7528\u8be5\u51fd\u6570\u3002 \u5982\u679c\u5b9a\u4e49\u4e86 <code>__repr__</code>\uff0c\u4f46\u662f\u6ca1\u6709\u5b9a\u4e49 <code>__str__</code>\uff0c\u5219\u5bf9\u5bf9\u8c61\u8c03\u7528 str() \u65f6\uff0c\u5c06\u6267\u884c <code>__repr__</code>\u3002</p>"},{"location":"Python/%E7%AC%AC%2010%20%E7%AB%A0%EF%BC%9A%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/#_3","title":"\u7075\u6d3b\u7684\u521d\u59cb\u5316","text":"<p>\u76f4\u63a5\u8bbf\u95ee\u53d8\u91cf\u5bf9\u53d8\u91cf\u8d4b\u503c\u3002 <pre><code>&gt;&gt;&gt; p.name = 'jacky' \n&gt;&gt;&gt; p.age = 22\n&gt;&gt;&gt; p\nPerson('jacky', 22)\n</code></pre></p> <p>\u5728\u6784\u9020\u51fd\u6570\u4e2d\u521d\u59cb\u5316\uff0c\u8fd9\u91cc\u6784\u9020\u51fd\u6570\u4e2d\u8bbe\u7f6e\u4e86\u9ed8\u8ba4\u503c\uff0c\u56e0\u6b64\u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u662f\u53ef\u4ee5\u7701\u7565\u7684\u3002 <pre><code>    def __init__(self, name = '', age = 0):\n        self.name = name\n        self.age = age\n</code></pre></p> <p>\u6d4b\u8bd5\u3002 <pre><code>&gt;&gt;&gt; p = person.Person(\"jacky\", 22)\n&gt;&gt;&gt; p\nPerson('jacky', 22)\n&gt;&gt;&gt; p = person.Person(age = 22) \n&gt;&gt;&gt; p\nPerson('', 22)\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%2010%20%E7%AB%A0%EF%BC%9A%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/#setter-getter","title":"Setter \u548c Getter","text":"<p>\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u53e5\u70b9\u8868\u8fbe\u5f0f\uff0c\u5982 p.name \u83b7\u53d6\u548c\u8bbe\u7f6e\u53d8\u91cf\u7684\u503c\u3002\u8fd9\u79cd\u505a\u6cd5\u53ef\u80fd\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff0c\u53ef\u80fd\u4e0d\u5c0f\u5fc3\u5c06\u5e74\u9f84\u8bbe\u7f6e\u4e3a\u4e0d\u5408\u7406\u7684\u503c\u5982 -22 \u6216\u8005 789\u3002\u6240\u4ee5\u53ef\u4ee5\u6dfb\u52a0 setter \u51fd\u6570\uff0c\u4f7f\u5f97\u4ec5\u5728\u63d0\u4f9b\u7684\u503c\u5408\u7406\u65f6\u624d\u4fee\u6539 age\u3002 <pre><code>    def set_age(self, age):\n        if 0 &lt; age &lt;= 150:\n            self.age = age\n</code></pre></p> <p>\u7136\u800c\u8fd9\u6837 p.set_age(30) \u8981\u6bd4 p.age = 30 \u66f4\u7e41\u7410\u3002</p> <p>Python \u4f7f\u7528 property decorator \u6765\u6307\u51fa\u51fd\u6570\u6216\u8005\u65b9\u6cd5\u6709\u70b9\u7279\u6b8a\u3002\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002 <pre><code># person.py\n\nclass Person:\n    \"\"\"\n    Class to represend a person\n    \"\"\"\n\n    def __init__(self, name = '', age = 0):\n        self._name = name\n        self._age = age\n\n    @property\n    def age(self):\n        return self._age\n\n    @age.setter\n    def age(self, age):\n        if 0 &lt; age &lt;= 150:\n            self._age = age\n</code></pre></p> <p>\u4f7f\u7528\u4e0b\u5212\u7ebf\u5f00\u5934  <code>_age</code> \u4e0e\u65b9\u6cd5 age \u533a\u5206\u5f00\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u76f4\u63a5\u8d4b\u503c\u548c\u83b7\u53d6\uff0c\u4f46\u5b9e\u9645\u8c03\u7528\u7684\u662f\u65b9\u6cd5\u3002\u4ecd\u80fd\u4f7f\u7528 <code>_age</code> \u83b7\u53d6\u548c\u8bbe\u7f6e\u53d8\u91cf\u7684\u503c\u3002 <pre><code>&gt;&gt;&gt; p = person.Person()\n&gt;&gt;&gt; p.age = 20\n&gt;&gt;&gt; p.age\n20\n&gt;&gt;&gt; p._age\n20\n</code></pre></p> <p>\u5982\u679c\u4e0d\u60f3\u53d8\u91cf\u88ab\u76f4\u63a5\u8bbf\u95ee\uff0c\u53ef\u4ee5\u5c06\u53d8\u91cf\u8bbe\u7f6e\u4e3a\u79c1\u6709\u53d8\u91cf\uff0c\u5373\u5728\u53d8\u91cf\u540d\u5f00\u5934\u4f7f\u7528\u4e24\u4e2a\u4e0b\u5212\u7ebf\uff0c\u8868\u793a\u53d8\u91cf\u4e3a\u79c1\u6709\u53d8\u91cf\u3002 <pre><code># person.py\n\nclass Person:\n    \"\"\"\n    Class to represend a person\n    \"\"\"\n\n    def __init__(self, name = '', age = 0):\n        self.__name = name\n        self.__age = age\n\n    @property\n    def age(self):\n        return self.__age\n\n    @age.setter\n    def age(self, age):\n        if 0 &lt; age &lt;= 150:\n            self.__age = age\n</code></pre></p> <p>\u5728 Python \u4e2d\u6ca1\u6709\u5916\u90e8\u7edd\u5bf9\u8bbf\u95ee\u4e0d\u4e86\u7684\u53d8\u91cf\uff0cPython \u4ee3\u7801\u5e94\u8be5\u9075\u5faa\u4e00\u4e2a\u89c4\u8303\uff1a\u4ee5\u5355\u4e2a\u4e0b\u5212\u7ebf\u5f00\u5934\u7684\u53d8\u91cf\u6216\u65b9\u6cd5\u5e94\u88ab\u89c6\u4e3a\u975e\u516c\u5f00\u7684 API\uff0c\u56e0\u6b64\u4e0d\u7528\u7279\u522b\u58f0\u660e\uff0c\u5916\u90e8\u7684\u8c03\u7528\u8005\u4e5f\u4e0d\u5e94\u8be5\u53bb\u8bbf\u95ee\u4ee5\u5355\u4e2a\u4e0b\u5212\u7ebf\u5f00\u5934\u7684\u53d8\u91cf\u6216\u65b9\u6cd5\u3002</p> <p>\u4ee5\u53cc\u4e0b\u5212\u7ebf\u5f00\u5934\uff0c\u5e76\u4ee5\u6700\u591a\u4e00\u4e2a\u4e0b\u5212\u7ebf\u7ed3\u5c3e\u7684\u6807\u8bc6\u7b26\uff0c\u4f8b\u5982 <code>__x</code> \u4f1a\u88ab\u8f6c\u5199\u4e3a <code>__classname__x</code>\uff0c\u76f4\u63a5\u8bbf\u95ee <code>p.__age</code> \u4f1a\u62a5\u9519\uff0c\u56e0\u6b64\u80fd\u591f\u907f\u514d\u8c03\u7528\u8005\u8bef\u8bbf\u95ee\u3002\u8fd9\u4e2a\u673a\u5236\u79f0\u4e3a <code>name mangling</code>\u3002</p> <p>\u53c2\u8003\uff1ahttps://docs.python.org/3/tutorial/classes.html#private-variables</p>"},{"location":"Python/%E7%AC%AC%2010%20%E7%AB%A0%EF%BC%9A%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/#_4","title":"\u7ee7\u627f","text":"<p>\u7ee7\u627f\u662f\u4e00\u79cd\u91cd\u7528\u7c7b\u7684\u673a\u5236\uff0c\u521b\u5efa\u5168\u65b0\u7684\u7c7b\uff1a\u7ed9\u65e2\u6709\u7c7b\u7684\u62f7\u8d1d\u6dfb\u52a0\u53d8\u91cf\u548c\u65b9\u6cd5\u3002</p> <p>\u5f00\u53d1\u4e00\u4e2a\u73a9\u5bb6\u7c7b\uff0c\u6240\u6709\u7c7b\u578b\u7684\u73a9\u5bb6\u90fd\u6709\u540d\u79f0\u548c\u5206\u6570\u3002 <pre><code># players.py\nclass Player:\n    def __init__(self, name):\n        self._name = name\n        self._score = 0\n\n    def reset_score(self):\n        self._score = 0\n\n    def incr_score(self):\n        self._score = self._score + 1\n\n    def get_name(self):\n        return self._name\n\n    def __str__(self):\n        return \"name = '%s', score = %d\" % (self._name, self._score)\n\n    def __repr__(self):\n        return 'Player(%s)' % str(self)\n\ndef main():\n    p = Player(name= 'jacky')\n    p.incre_score()\n    print(p)\n    # \u6267\u884c\u547d\u4ee4 python players.py\n    # \u8f93\u51fa name = 'jacky', score = 1\n\nif __name__ == '__main__':\n    main()\n</code></pre></p> <p>\u5047\u8bbe\u6709\u4e24\u7c7b\u73a9\u5bb6\uff1a\u4eba\u548c\u8ba1\u7b97\u673a\uff0c\u4e3b\u8981\u5dee\u522b\u5728\u4e8e\u4eba\u901a\u8fc7\u952e\u76d8\u8f93\u5165\uff0c\u800c\u8ba1\u7b97\u673a\u4f7f\u7528\u51fd\u6570\u3002 \u4eba\u7c7b\u3002 <pre><code># human.py\n\nimport players\n\nclass Human(players.Player):\n    pass\n</code></pre></p> <p>\u7ee7\u627f\u662f\u901a\u8fc7\u5728\u5706\u62ec\u53f7\u5185\u6307\u5b9a\u4e00\u4e2a\u6216\u591a\u4e2a\u7236\u7c7b\u6765\u5b9e\u73b0\u7684\u3002</p> <p><code>pass</code> \u8868\u793a\u4ec0\u4e48\u90fd\u4e0d\u505a\uff0c\u4e3b\u8981\u7684\u4f5c\u7528\u662f\u4fdd\u6301\u8bed\u6cd5\u548c\u7f29\u8fdb\u7684\u5b8c\u6574\u6027\u3002\u4e5f\u53ef\u4ee5\u7528\u5728\u51fd\u6570\u4f53\u3001\u6761\u4ef6\u8bed\u53e5\u5185\u548c\u5faa\u73af\u4f53\u5185\u3002</p> <p>\u8fd0\u884c\u793a\u4f8b\u3002 <pre><code>&gt;&gt;&gt; import human\n&gt;&gt;&gt; h = human.Human(name='jacky') \n&gt;&gt;&gt; h\nPlayer(name = 'jacky', score = 0)\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%2010%20%E7%AB%A0%EF%BC%9A%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/#override","title":"Override","text":"<p>\u901a\u8fc7 Override \u4fee\u6539 <code>Human</code> \u7684 <code>__repr__</code> \u51fd\u6570\u3002 <pre><code># human.py\n\nimport players\n\nclass Human(players.Player):\n    pass\n\n    def __repr__(self):\n        return 'Human(%s)' % str(self)\n</code></pre></p> <p>\u8fd0\u884c\u793a\u4f8b\u3002 <pre><code>&gt;&gt;&gt; import human\n&gt;&gt;&gt; h = human.Human('suomea') \n&gt;&gt;&gt; h\nHuman(name = 'suomea', score = 0)\n</code></pre></p> <p>\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u8f7b\u677e\u7f16\u5199 <code>Computer</code> \u7c7b\u3002 <pre><code># computer.py\n\nimport players\n\nclass Computer(players.Player):\n    pass\n\n    def __repr__(self):\n        return 'Computer(%s)' % str(self)\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%2010%20%E7%AB%A0%EF%BC%9A%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/#_5","title":"\u591a\u6001","text":"<p>\u4ee3\u7801\u793a\u4f8b\uff0c<code>play_indercur</code> \u51fd\u6570\u9762\u5411 <code>Player</code> \u7c7b\u578b\uff0c<code>get_move</code> \u51fd\u6570\u5b9e\u73b0\u4e0d\u53d6\u51b3\u4e8e\u540c\u7684\u5177\u4f53\u7c7b\u578b <code>Human</code> \u548c <code>Computer</code>\u3002 <pre><code># game.py\n\nimport human\nimport computer\n\ndef play_indercut(p1, p2):\n    p1.reset_score()\n    p2.reset_score()\n    m1 = p1.get_move()\n    m2 = p2.get_move()\n    print('%s move: %s' % (p1.get_name(), m1))\n    print('%s move: %s' % (p2.get_name(), m2))\n    if m1 == m2 - 1:\n        p1.incr_score()\n        return p1, p2, '%s wins!' % p1.get_name()\n    elif m2 == m1 - 1:\n        p2.incr_score()\n        return p1, p2, '%s wins!' % p2.get_name()\n    else:\n        return p1, p2, 'draw: no winner'\n\ndef main():\n    c = computer.Computer('Hal Bot')\n    h = human.Human('Lia')\n    print(play_indercut(c, h))\n    pass\n\nif __name__ == '__main__':\n    main()\n</code></pre></p> <p>\u8fd0\u884c\uff1a <pre><code># python game.py\nLia move (1 - 10): 2\nHal Bot move: 1\nLia move: 2\n(Computer(name = 'Hal Bot', score = 1), Human(name = 'Lia', score = 0), 'Hal Bot wins!')\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%202%20%E7%AB%A0%EF%BC%9A%E7%AE%97%E6%9C%AF%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E5%8F%98%E9%87%8F/","title":"Python","text":""},{"location":"Python/%E7%AC%AC%202%20%E7%AB%A0%EF%BC%9A%E7%AE%97%E6%9C%AF%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E5%8F%98%E9%87%8F/#shell","title":"\u4ea4\u4e92\u5f0f Shell","text":"<p>\u5728\u547d\u4ee4\u884c\u76f4\u63a5\u8f93\u51fa python \u5373\u53ef\u6253\u5f00 Python \u7684\u4ea4\u4e92\u5f0f shell\u3002</p> <p>hello world! <pre><code>&gt;&gt;&gt; print(\"hello world!\")\nhello world!\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%202%20%E7%AB%A0%EF%BC%9A%E7%AE%97%E6%9C%AF%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E5%8F%98%E9%87%8F/#_1","title":"\u7b97\u672f\u8fd0\u7b97","text":"<p>Python \u652f\u6301\u56db\u79cd\u57fa\u672c\u7b97\u672f\u8fd0\u7b97\u3002 \uff0c \u8fd8\u652f\u6301\u4f7f\u7528 <code>**</code> \u548c <code>%</code> \u8fdb\u884c\u4e58\u65b9\u548c\u6c42\u4f59\u8fd0\u7b97\uff0c\u652f\u6301\u4f7f\u7528<code>//</code> \u8fdb\u884c\u6574\u9664\u8fd0\u7b97\u3002</p> <p>\u53ef\u4ee5\u76f4\u63a5\u5728\u4ea4\u4e92\u5f0f shell \u4e2d\u8fdb\u884c <pre><code>&gt;&gt;&gt; 1+2\n3\n&gt;&gt;&gt; 1-2\n-1\n&gt;&gt;&gt; 2*3\n6\n&gt;&gt;&gt; 3/2\n1.5\n&gt;&gt;&gt; 3//2\n1\n&gt;&gt;&gt; 2**2\n4\n&gt;&gt;&gt; 3%2\n1\n</code></pre></p> <p>\u5728 Python \u4e2d\u6574\u6570\u7684\u957f\u5ea6\u4e0d\u53d7\u9650\u5236\uff08\u5b9e\u9645\u5e94\u8be5\u8fd8\u662f\u6709\u9650\u5236\u7684\uff09\u3002 <pre><code>&gt;&gt;&gt; 2**1999\n57406534763712726211641660058884099201115885104434760023882136841288313069618515692832974315825313495922298231949373138672355948043152766571296567808332659269564994572656140000344389574120022435714463495031743122390807731823194181973658513020233176985452498279081199404472314802811655824768082110985166340672084454492229252801189742403957029450467388250214501358353312915261004066118140645880633941658603299497698209063510889929202021079926591625770444716951045960277478891794836019580040978608315291377690212791863007764174393209716027254457637891941312587717764400411421385408982726881092425574514688\n</code></pre></p> <p>\u5728 Python \u4e2d\u6d6e\u70b9\u6570\u662f\u5e26\u5c0f\u6570\u7684\u6570\u5b57\uff0c\u6240\u6709\u4e0a\u8ff0\u9002\u7528\u4e8e\u6574\u6570\u7684\u8fd0\u7b97\u4e5f\u9002\u7528\u4e8e\u6d6e\u70b9\u6570\u3002 <pre><code>&gt;&gt;&gt; 2.2**3\n10.648000000000003\n</code></pre></p> <p>\u6d6e\u70b9\u6570<code>3.</code> \u7b49\u4e8e<code>3.0</code>\uff0c<code>.5</code>\u7b49\u4e8e<code>0.5</code>\u3002\u53ef\u89c1 Python \u8868\u8ff0\u6d6e\u70b9\u6570\u975e\u5e38\u7075\u6d3b\u3002\u8fd8\u53ef\u4ee5\u4f7f\u7528\u79d1\u5b66\u8ba1\u6570\u6cd5\u8868\u793a\u6d6e\u70b9\u6570\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\u533a\u5206<code>3</code>\u548c<code>3.0</code>\u662f\u5f88\u91cd\u8981\u7684\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u5185\u90e8\u8868\u793a\u5927\u76f8\u5ead\u5f84\u3002 <pre><code>&gt;&gt;&gt; 2e2\n200.0\n&gt;&gt;&gt; 2e-2\n0.02\n&gt;&gt;&gt; .34\n0.34\n&gt;&gt;&gt; 3.\n3.0\n&gt;&gt;&gt;\n</code></pre></p> <p>\u6d6e\u70b9\u6570\u5b58\u5728\u4e0a\u9650\u548c\u4e0b\u9650\uff0c\u5373\u6d6e\u70b9\u6570\u7684\u8fd0\u7b97\u53ef\u80fd\u5b58\u5728\u6ea2\u51fa\u3002</p>"},{"location":"Python/%E7%AC%AC%202%20%E7%AB%A0%EF%BC%9A%E7%AE%97%E6%9C%AF%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E5%8F%98%E9%87%8F/#_2","title":"\u5b57\u7b26\u4e32","text":"<p>\u5b57\u7b26\u4e32\u6709\u4e09\u79cd\u8868\u793a\u65b9\u5f0f\u3002\u5355\u5f15\u53f7\u80fd\u591f\u5728\u5b57\u7b26\u4e32\u4e2d\u5305\u542b\u53cc\u5f15\u53f7\u5b57\u7b26\uff0c\u53cc\u5f15\u53f7\u80fd\u591f\u5728\u5b57\u7b26\u4e32\u4e2d\u5305\u542b\u5355\u5f15\u53f7\u5b57\u7b26\u3002\u4e09\u5f15\u53f7\u4e3b\u8981\u7528\u6765\u5305\u542b\u591a\u884c\u5b57\u7b26\u4e32\uff0c\u5185\u90e8\u53ef\u4ee5\u5305\u542b\u5355\u5f15\u53f7\u5b57\u7b26\u548c\u53cc\u5f15\u53f7\u5b57\u7b26\u3002 <pre><code>\"hello world\"  \n\n'hello world'  \n\n\"\"\"  \nhello world  \n\u4f60\u597d\u4e16\u754c\uff01  \n\"\"\"\n</code></pre></p> <p>\u5b57\u7b26\u4e32\u957f\u5ea6\u4f7f\u7528 len(s) \u51fd\u6570\u83b7\u5f97\uff0c\u8fd4\u56de\u4e00\u4e2a\u6574\u6570\u3002</p> <p>\u5b57\u7b26\u4e32\u62fc\u63a5\u4f7f\u7528<code>+</code>\u5b57\u7b26\u3002 <pre><code>&gt;&gt;&gt; print('hello' + \" world!\")\nhello world!\n&gt;&gt;&gt; print(2 * 'hello' + 2 * '!!')\nhellohello!!!!\n&gt;&gt;&gt; print(len(2 * 'hello' + 2 * '!!'))\n14\n&gt;&gt;&gt; len('aa') * '12'\n'1212'\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%202%20%E7%AB%A0%EF%BC%9A%E7%AE%97%E6%9C%AF%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E5%8F%98%E9%87%8F/#_3","title":"\u7c7b\u578b\u8f6c\u6362","text":"<p>\u6574\u6570\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570\uff0c\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570\u3002 <pre><code>&gt;&gt;&gt; float(3)\n3.0\n&gt;&gt;&gt; float('3')\n3.0\n&gt;&gt;&gt; float('3.12')\n3.12\n</code></pre></p> <p>\u6d6e\u70b9\u6570\u548c\u6574\u6570\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u3002 <pre><code>&gt;&gt;&gt; str(3)\n'3'\n&gt;&gt;&gt; str(-2.3)\n'-2.3'\n</code></pre></p> <p>\u5b57\u7b26\u4e32\u548c\u6d6e\u70b9\u6570\u8f6c\u6362\u4e3a\u6574\u6570\u3002 <pre><code>&gt;&gt;&gt; int('3')\n3\n&gt;&gt;&gt; round(float('3.2'))\n3\n&gt;&gt;&gt; round(float('3.6'))\n4\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%202%20%E7%AB%A0%EF%BC%9A%E7%AE%97%E6%9C%AF%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E5%8F%98%E9%87%8F/#_4","title":"\u51fd\u6570\u548c\u6a21\u5757","text":"<p>\u5728\u4e0a\u9762\u4f7f\u7528\u4e86\u4e00\u4e9b\u5185\u7f6e\u7684\u51fd\u6570\uff0c\u4f7f\u7528<code>dir(__builtins__)</code>\u67e5\u770b\u5b8c\u6574\u7684\u5185\u7f6e\u51fd\u6570\u6e05\u5355\u3002 <pre><code>&gt;&gt;&gt; dir(__builtins__)\n['ArithmeticError', 'AssertionError', 'AttributeError', 'BaseException', \n \u00b7\u00b7\u00b7\n 'abs', 'aiter', 'all', 'anext', 'any', 'ascii', 'bin', 'bool', 'breakpoint', 'bytearray', 'bytes', 'callable', 'chr', 'classmethod', 'compile', 'complex', 'copyright', 'credits', 'delattr', 'dict', 'dir', 'divmod', 'enumerate', 'eval', 'exec', 'exit', 'filter', 'float', 'format', 'frozenset', 'getattr', 'globals', 'hasattr', 'hash', 'help', 'hex', 'id', 'input', 'int', 'isinstance', 'issubclass', 'iter', 'len', 'license', 'list', 'locals', 'map', 'max', 'memoryview', 'min', 'next', 'object', 'oct', 'open', 'ord', 'pow', 'print', 'property', 'quit', 'range', 'repr', 'reversed', 'round', 'set', 'setattr', 'slice', 'sorted', 'staticmethod', 'str', 'sum', 'super', 'tuple', 'type', 'vars', 'zip']\n</code></pre></p> <p>\u67e5\u770b\u5185\u7f6e\u51fd\u6570\u7684\u6587\u6863\uff0c\u4e24\u79cd\u65b9\u6cd5<code>help(abs)</code>\u6216\u8005<code>print(abs.__doc__)</code>\u3002 <pre><code>&gt;&gt;&gt; help(abs)\nHelp on built-in function abs in module builtins:\n\nabs(x, /)\n    Return the absolute value of the argument.\n\n&gt;&gt;&gt; print(abs.__doc__)\nReturn the absolute value of the argument.\n</code></pre></p> <p>\u5185\u7f6e\u7684\u51fd\u6570\u6ee1\u8db3\u4e0d\u4e86\u9700\u6c42\u7684\u4f7f\u7528\uff0c\u53ef\u4ee5\u5bfc\u5165\u6a21\u5757\uff0c\u7136\u540e\u4f7f\u7528\u6a21\u5757\u7684\u51fd\u6570\u3002 <pre><code>&gt;&gt;&gt; import math\n&gt;&gt;&gt; math.sqrt(4)\n2.0\n</code></pre></p> <p>\u67e5\u770b<code>math</code>\u6a21\u5757\u7684\u51fd\u6570\u3002 <pre><code>&gt;&gt;&gt; dir(math)\n['__doc__', '__loader__', '__name__', '__package__', '__spec__', 'acos', 'acosh', 'asin', 'asinh', 'atan', 'atan2', 'atanh', 'ceil', 'comb', 'copysign', 'cos', 'cosh', 'degrees', 'dist', 'e', 'erf', 'erfc', 'exp', 'expm1', 'fabs', 'factorial', 'floor', 'fmod', 'frexp', 'fsum', 'gamma', 'gcd', 'hypot', 'inf', 'isclose', 'isfinite', 'isinf', 'isnan', 'isqrt', 'lcm', 'ldexp', 'lgamma', 'log', 'log10', 'log1p', 'log2', 'modf', 'nan', 'nextafter', 'perm', 'pi', 'pow', 'prod', 'radians', 'remainder', 'sin', 'sinh', 'sqrt', 'tan', 'tanh', 'tau', 'trunc', 'ulp']\n</code></pre></p> <p>\u67e5\u770b<code>math.tan</code>\u51fd\u6570\u7684\u6587\u6863\u3002 <pre><code>&gt;&gt;&gt; print(math.tan.__doc__)\nReturn the tangent of x (measured in radians).\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%202%20%E7%AB%A0%EF%BC%9A%E7%AE%97%E6%9C%AF%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E5%8F%98%E9%87%8F/#_5","title":"\u53d8\u91cf","text":"<p>\u53d8\u91cf\u6307\u5411\u4e00\u4e2a\u503c\uff0c\u9047\u5230\u53d8\u91cf\u65f6 Python \u5c06\u5176\u66ff\u6362\u4e3a\u6307\u5411\u7684\u503c\u3002 <pre><code>&gt;&gt;&gt; name = 'jacky'\n&gt;&gt;&gt; 2 * name\n'jackyjacky'\n&gt;&gt;&gt; l = len(2 * name)\n&gt;&gt;&gt; l\n10\n&gt;&gt;&gt; name\n'jacky'\n</code></pre></p> <p>\u53d8\u91cf\u7684\u547d\u540d\u89c4\u5219\u9700\u8981\u9075\u5b88\u4ee5\u4e0b\u6761\u4ef6\uff1a 1. \u53d8\u91cf\u540d\u7684\u957f\u5ea6\u4e0d\u53d7\u9650\u5236\uff0c\u4f46\u662f\u5fc5\u987b\u662f\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u8005\u4e0b\u5212\u7ebf\u3002 2. \u53d8\u91cf\u540d\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e0d\u80fd\u662f\u6570\u5b57\u3002 3. \u53d8\u91cf\u540d\u533a\u5206\u5927\u5c0f\u5199\u3002 4. \u4e0d\u80fd\u4f7f\u7528 Python \u7684\u5173\u952e\u5b57\u4f5c\u4e3a\u53d8\u91cf\u540d\u3002</p> <p>\u53ef\u4ee5\u5c06\u4efb\u4f55\u503c\u8d4b\u503c\u7ed9\u53d8\u91cf\uff0c\u5305\u62ec\u5176\u5b83\u53d8\u91cf\u7684\u503c\uff08\u5373\u4f7f\u7c7b\u578b\u4e0d\u540c\uff09\u3002 <pre><code>&gt;&gt;&gt; name\n2\n&gt;&gt;&gt; name='jacky'\n&gt;&gt;&gt; name\n'jacky'\n</code></pre></p> <p>\u8d4b\u503c\u5c31\u50cf\u662f\u6307\u9488\u64cd\u4f5c\u4e00\u6837\uff0c\u6ca1\u6709\u590d\u5236\u3002\u5bf9\u4e8e\u6ca1\u6709\u4efb\u4f55\u53d8\u91cf\u6307\u5411\u7684\u503c\uff0cPython \u5c06\u81ea\u52a8\u5c06\u5176\u5220\u9664\u3002</p> <p>\u6570\u5b57\u548c\u5b57\u7b26\u4e32\u662f\u4e0d\u53ef\u53d8\u7684\u3002</p> <p>\u591a\u91cd\u8d4b\u503c\uff0c\u80fd\u591f\u7ed9\u591a\u4e2a\u53d8\u91cf\u540c\u65f6\u8d4b\u503c\uff08\u5e76\u4e0d\u5e38\u7528\uff09\u3002 <pre><code>&gt;&gt;&gt; a, b, c = 1, '2', 3.3\n&gt;&gt;&gt; a\n1\n&gt;&gt;&gt; a, c, b\n(1, 3.3, '2')\n&gt;&gt;&gt; a, b, c = c, b, a\n&gt;&gt;&gt; a, c, b\n(3.3, 1, '2')\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/","title":"Python","text":"<p>Python \u7a0b\u5e8f\u4e2d\u7684\u8bed\u53e5\u79f0\u4e3a\u6e90\u4ee3\u7801\uff0c\u5c06\u7a0b\u5e8f\u6587\u4ef6\u79f0\u4e3a\u6e90\u4ee3\u7801\u6587\u4ef6\u3002\u6839\u636e\u7ea6\u5b9a\uff0c\u6240\u6709 Python \u6e90\u4ee3\u7801\u6587\u4ef6\u90fd\u4f7f\u7528\u6269\u5c55\u540d <code>.py</code> \u3002 </p> <p>Python \u7531\u4e09\u4e2a\u90e8\u5206\u7ec4\u6210\uff1a\u8fd0\u884c\u8bed\u53e5\u7684\u89e3\u91ca\u5668\u3001\u5c06 <code>.py</code> \u6587\u4ef6\u8f6c\u6362\u4e3a <code>.pyc</code> \u6587\u4ef6\u7684\u7f16\u8bd1\u5668\u4ee5\u53ca\u8fd0\u884c <code>.pyc</code> \u6587\u4ef6\u7684\u865a\u62df\u673a\u3002</p>"},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#_1","title":"\u4ece\u952e\u76d8\u8bfb\u53d6\u5b57\u7b26\u4e32","text":"<p>\u6e90\u4ee3\u7801\u5982\u4e0b\uff0c<code>#</code> \u5f00\u5934\u7684\u8868\u793a\u6ce8\u91ca\u884c\uff1b<code>input</code> \u662f\u5185\u7f6e\u7684\u6807\u51c6\u51fd\u6570\u8bfb\u53d6\u8f93\u5165\uff1b\u7136\u540e\u5c06\u7528\u6237\u7684\u8f93\u51fa\u8d4b\u503c\u7ed9 <code>name</code> \u53d8\u91cf\uff1b\u8f93\u51fa\u8c03\u7528\u4e86\u5b57\u7b26\u4e32\u7684 <code>capitalize</code> \u51fd\u6570\uff0c\u8be5\u51fd\u6570\u5c06\u5b57\u7b26\u4e32\u7684\u9996\u5b57\u6bcd\u5927\u5199\u3002</p> <p>\u4f7f\u7528 dir(\"\") \u53ef\u4ee5\u67e5\u770b\u5b57\u7b26\u4e32\u5305\u542b\u54ea\u4e9b\u51fd\u6570\u3002</p> <pre><code># name.py\nname = input(\"What's your first name? \")\nprint('hello ' + name.capitalize() + '!')\n</code></pre> <p>\u4f7f\u7528 <code>python name.py</code> \u547d\u4ee4\u8fd0\u884c\u7a0b\u5e8f\u3002</p>"},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#_2","title":"\u4ece\u952e\u76d8\u8bfb\u53d6\u6570\u5b57","text":"<pre><code># age.py\nage = int(input('How old are you today? '))\nprint('In 10 years you will be ' + str((age + 10)) + ' year old.')\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\u9700\u8981\u5c06 age + 10 \u8f6c\u6362\u6210\u5b57\u7b26\u4e32\u624d\u80fd\u6253\u5370\uff0c\u5426\u5219 Python \u5c06\u62a5\u9519\u3002</p>"},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#_3","title":"\u6253\u5370\u5b57\u7b26\u4e32","text":"<p><code>print</code> \u662f\u5185\u7f6e\u7684\u5c06\u5b57\u7b26\u4e32\u6253\u5370\u5230\u6807\u51c6\u8f93\u51fa\u7684\u51fd\u6570\u3002 <pre><code># print_test.py\n\nprint('hello', \"world!\")\n\nprint(\"\u4f60\u597d\")\nprint(\"\u4e16\u754c\uff01\")\n\nprint(\"hello world!\", end='')\nprint(\"\u4f60\u597d\u4e16\u754c\uff01\")\n</code></pre></p> <p>\u8f93\u51fa\u5982\u4e0b\uff1a <pre><code>G:\\suomea-projects\\python-core&gt;python print_test.py\nhello world!\n\u4f60\u597d\n\u4e16\u754c\uff01\nhello world!\u4f60\u597d\u4e16\u754c\uff01\n\nG:\\suomea-projects\\python-core&gt;\n</code></pre></p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b <code>print</code> \u6253\u5370\u5b8c\u6307\u5b9a\u7684\u5185\u5bb9\u4e4b\u540e\u4f1a\u6dfb\u52a0\u4e00\u4e2a\u6362\u884c\u7b26\u3002</p>"},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#_4","title":"\u903b\u8f91\u8fd0\u7b97","text":"<p>Python \u4f7f\u7528 True \u548c False \u8868\u793a\u5e03\u5c14\u503c\u3002\u903b\u8f91\u8fd0\u7b97\u7684\u7ed3\u679c\u4e3a\u5e03\u5c14\u503c\u3002</p>"},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#_5","title":"\u8fd0\u7b97\u7b26","text":"<p>\u4e3b\u8981\u7684\u903b\u8f91\u8fd0\u7b97\u7b26\u6709\uff1a<code>not</code>\u3001<code>or</code>\u3001<code>and</code>\u3001<code>==</code>\u3001<code>!=</code> <pre><code>&gt;&gt;&gt; True == False\nFalse\n&gt;&gt;&gt; True and False\nFalse\n&gt;&gt;&gt; True or False\nTrue\n&gt;&gt;&gt; not True\nFalse\n&gt;&gt;&gt; True != False\nTrue\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#_6","title":"\u4f18\u5148\u7ea7","text":"<p>\u5982\u679c\u903b\u8f91\u8fd0\u7b97\u8868\u8fbe\u5f0f\u6bd4\u8f83\u957f\uff0c\u53ef\u4ee5\u4f7f\u7528\u5706\u62ec\u53f7\u63d0\u5347\u5176\u5185\u90e8\u8868\u8fbe\u5f0f\u7684\u4f18\u5148\u7ea7\uff0c\u4f18\u5148\u7ea7\u4ece\u9ad8\u5230\u5e95\u3002 - \u5706\u62ec\u53f7\u5185\u90e8\u7684\u8868\u8fbe\u5f0f - <code>==</code> - <code>!=</code> - <code>not</code> <code>and</code> - <code>or</code></p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\u5e03\u5c14\u8868\u8fbe\u5f0f\u7684\u6c42\u503c\u8fc7\u7a0b Python \u91c7\u7528\u4e86\u77ed\u8def\u6c42\u503c\u6280\u5de7\u3002\u5982\u679c\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u5df2\u7ecf\u786e\u5b9a\uff0c\u8fd8\u672a\u8ba1\u7b97\u5230\u7684\u8868\u8fbe\u5f0f\u4e0d\u4f1a\u88ab\u6267\u884c\uff0c\u8fd9\u6837\u80fd\u591f\u63d0\u9ad8\u67d0\u4e9b\u8868\u8fbe\u5f0f\u7684\u8ba1\u7b97\u901f\u5ea6\u3002</p>"},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#ifelse","title":"IF/ELSE","text":""},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#ifelse_1","title":"if/else","text":"<p>\u5148\u6765\u770b\u4e00\u6bb5\u7b80\u5355\u7684\u5bc6\u7801\u9a8c\u8bc1\u4ee3\u7801\uff0c\u4f7f\u7528\u4e86 if/else \u5173\u952e\u5b57\u3002 <pre><code># password.py\npwd = input(\"What is your password? \")\n\nif pwd == 'apple' :\n\u00a0 \u00a0 print('Loggin on ...')\nelse :\n\u00a0 \u00a0 print('Incorrect password!')\n\nprint(\"All done.\", end='')\n</code></pre></p> <p>\u9996\u5148 if \u4f5c\u4e3a\u5224\u65ad\u8bed\u53e5\u7684\u5f00\u5934\uff0c\u5176\u540e\u7d27\u8ddf\u5e03\u5c14\u8868\u8fbe\u5f0f\uff0c\u79f0\u4e3a\u6761\u4ef6\u3002</p> <p>if \u6761\u4ef6\u540e\u9762\u662f\u4e00\u4e2a\u5192\u53f7\uff0c\u4ece if \u5173\u952e\u5b57\u5f00\u59cb\u5230\u5192\u53f7\u4e3a\u6b62\u662f\u4e00\u6761 if \u8bed\u53e5\u3002</p> <p>if \u5173\u952e\u5b57\u3001\u6761\u4ef6\u3001\u5192\u53f7\u5fc5\u987b\u4f4d\u4e8e\u540c\u4e00\u884c\u3002</p> <p>else \u4ee3\u7801\u5757\u662f\u53ef\u9009\u7684\u3002</p> <p>\u4e0e Java \u4e0d\u540c\u7684\u662f\uff0cPython \u4f7f\u7528\u7f29\u8fdb\u6765\u8868\u793a\u4ee3\u7801\u5757\uff0c\u5728\u540c\u4e00\u4e2a\u4ee3\u7801\u5757\u4e2d\uff0c\u6240\u6709\u8bed\u53e5\u7684\u7f29\u8fdb\u91cf\u5fc5\u987b\u76f8\u540c\u3002</p>"},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#ifelif","title":"if/elif","text":"<p>if/elif <pre><code># age.py\nage = int(input(\"How old are you? \"));\n\nif age &lt;= 2 :\n\u00a0 \u00a0 print(\" free\")\nelif 2 &lt; age &lt; 13 :\n\u00a0 \u00a0 print(' child fare')\nelse :\n\u00a0 \u00a0 print('adult fare')\n\nprint('All done!')\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#_7","title":"\u6761\u4ef6\u8868\u8fbe\u5f0f","text":"<p>\u4e0b\u9762\u4e24\u79cd\u65b9\u5f0f\u662f\u7b49\u4ef7\u7684\u3002</p> <pre><code># food.py\n\nfood = input(\"What's your favorite food? \")\n\nif food == 'lamb' :\n\u00a0 \u00a0 reply = 'yuck'\nelse :\n\u00a0 \u00a0 reply = 'yum';\n\u00a0 \u00a0 \nprint(reply)\n</code></pre> <pre><code># food.py\nfood = input(\"What's your favorite food? \")\n\nreply = 'yuck' if food == 'lamb' else 'yum'\n\nprint(reply)\n</code></pre>"},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#_8","title":"\u5faa\u73af","text":""},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#rage","title":"rage \u51fd\u6570","text":"<p>range \u662f Python \u5185\u7f6e\u7684\u51fd\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a\u6574\u6570\u5e8f\u5217\u3002\u4f7f\u7528 <code>print(range__doc__)</code> \u67e5\u770b\u6587\u6863\u3002 <pre><code>range(stop) -&gt; range object\nrange(start, stop[, step]) -&gt; range object\n\nReturn an object that produces a sequence of integers from start (inclusive)\nto stop (exclusive) by step.  range(i, j) produces i, i+1, i+2, ..., j-1.\nstart defaults to 0, and stop is omitted!  range(4) produces 0, 1, 2, 3.\nThese are exactly the valid indices for a list of 4 elements.\nWhen step is given, it specifies the increment (or decrement).\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#for","title":"for \u5faa\u73af","text":"<p>\u793a\u4f8b\u4ee3\u7801\u3002 <pre><code># for_test.py\n\n# 0, 1, 2, 3, 4, 5, 6, 7, 8, 9\nfor i in range(10) :\n\u00a0 \u00a0 print(i, end=', ')\nprint() \u00a0 \u00a0\n\n# 0, 1, 2, 3, 4, 5, 6, 7, 8, 9\nfor i in range(0, 10) :\n\u00a0 \u00a0 print(i, end=', ')\nprint() \u00a0 \u00a0\n\n# 10, 8, 6, 4, 2, \u00a0\nfor i in range(10, 0, -2) :\n\u00a0 \u00a0 print(i, end=', ')\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#while","title":"while \u5faa\u73af","text":"<p>\u793a\u4f8b\u4ee3\u7801\u3002 <pre><code># while_test.py\n# 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,\ni = 0\nwhile i &lt; 10 :\n\u00a0 \u00a0 print(i, end=', ')\n\u00a0 \u00a0 i = i + 1\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#_9","title":"\u8ba1\u7b97\u9636\u4e58","text":"<p>\u8f93\u5165\u6570\u5b57\u4f8b\u5982\uff1a10 \u8f93\u51fa\uff1a1 x 2 x 3 x 4 x 5 x 6 x 7 x 8 x 9 x 10 \u7684\u7ed3\u679c</p> <p>for <pre><code># for_fact.py\nn = int(input('Enter an integer &gt;= 0: '))\nfact = 1;\nfor i in range(1, n + 1) :\n\u00a0 \u00a0 fact = fact * i\n\u00a0 \u00a0 \nprint(str(n) + \u00a0' factorial is ' + str(fact))\n</code></pre></p> <p>while <pre><code># while_fact.py\n\nn = int(input('Enter an integer &gt; 0: '))\nfact = 1\ni = 1\nwhile i &lt;= n :\n\u00a0 \u00a0 fact = fact * i\n\u00a0 \u00a0 i = i + 1\n\nprint(str(n) + ' factorial is ' + str(fact))\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%204%20%E7%AB%A0%EF%BC%9A%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#_10","title":"\u8df3\u51fa\u5faa\u73af","text":"<p><code>break</code> \u5173\u952e\u5b57\u8df3\u51fa\u5f53\u524d\u5faa\u73af\uff1b<code>continue</code> \u5173\u952e\u5b57\u7acb\u5373\u8df3\u8f6c\u5230\u5faa\u73af\u6761\u4ef6\uff0c\u5373\u8fdb\u5165\u4e0b\u4e00\u6b21\u5faa\u73af\u8fed\u4ee3\u3002  <pre><code># donesum_break.py\ntotal = 0\nwhile True :\n\u00a0 \u00a0 s = input('Enter a number (or done): ')\n\u00a0 \u00a0 if s == 'done':\n\u00a0 \u00a0 \u00a0 \u00a0 break;\n\u00a0 \u00a0 num = int(s)\n\u00a0 \u00a0 total = total + num\n\u00a0 \u00a0 \nprint('The sum is ' + str(total))\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%205%20%E7%AB%A0%EF%BC%9A%E5%87%BD%E6%95%B0/","title":"Python","text":"<p>\u51fd\u6570\u662f\u4e00\u5927\u5757\u53ef\u91cd\u7528\u7684\u4ee3\u7801\u5757\u3002\u5b83\u662f\u6709\u540d\u79f0\u7684\u4ee3\u7801\u5757\uff0c\u63a5\u6536\u8f93\u5165\u3001\u63d0\u4f9b\u8f93\u51fa\u5e76\u53ef\u5b58\u50a8\u5728\u6587\u4ef6\u4e2d\u4f9b\u4ee5\u540e\u4f7f\u7528\u3002</p>"},{"location":"Python/%E7%AC%AC%205%20%E7%AB%A0%EF%BC%9A%E5%87%BD%E6%95%B0/#_1","title":"\u8c03\u7528\u51fd\u6570","text":"<p>\u5185\u7f6e\u51fd\u6570 <code>pow(x, y)</code> \u8ba1\u7b97 <code>x ** y</code>\uff0c\u5373 x \u7684 y \u6b21\u65b9\u3002 <pre><code>&gt;&gt;&gt; pow(2,3)\n8\n</code></pre></p> <p>\u5f53\u8c03\u7528\u51fd\u6570\u65f6\uff0cPython \u5c06\u51fd\u6570\u8c03\u7528\u66ff\u6362\u4e3a\u5176\u8fd4\u56de\u503c\uff0c\u4f8b\u5982\uff0c\u8868\u8fbe\u5f0f <code>pow(2, 3) + 2</code>\u4e0e <code>8 + 2</code> \u7b49\u4ef7\uff0c\u7ed3\u679c\u4e3a 10\u3002</p> <p>\u6709\u4e9b\u51fd\u6570\u6ca1\u6709\u8fd4\u56de\u503c\uff0c\u4f8b\u5982 print(x) \u51fd\u6570\u3002</p>"},{"location":"Python/%E7%AC%AC%205%20%E7%AB%A0%EF%BC%9A%E5%87%BD%E6%95%B0/#_2","title":"\u5b9a\u4e49\u51fd\u6570","text":"<p>\u7f16\u8f91 area.py \u6587\u4ef6\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a\u51fd\u6570 circle\uff0c\u6c42\u5706\u7684\u9762\u79ef\u3002 <pre><code># area.py\nimport math\n\ndef circle(radius):\n\u00a0 \u00a0 \"\"\"Returns the area of circle with the given radius.\n\u00a0 \u00a0 For example:\n\u00a0 \u00a0 &gt;&gt;&gt; area(5.5)\n\u00a0 \u00a0 95.03317777109125\n\u00a0 \u00a0 \"\"\"\n\u00a0 \u00a0 return math.pi * radius ** 2\n</code></pre></p> <p>\u5728\u547d\u4ee4\u884c\u4f7f\u7528 area.circle \u51fd\u6570\u3002 <pre><code>&gt;&gt;&gt; import area \n&gt;&gt;&gt; print(area.circle.__doc__) \n\nReturns the area of circle\nwith the given radius.\nFor example:\n&gt;&gt;&gt; area(5.5)\n95.03317777109125\n\n&gt;&gt;&gt; area.circle(2)\n12.566370614359172\n</code></pre></p> <p>\u5728\u6e90\u4ee3\u7801\u4e2d\u4f7f\u7528 area.circle \u51fd\u6570\u3002 <pre><code># main.py\nimport area\n\nprint(area.circle.__doc__)\nprint(area.circle(2))\n</code></pre></p> <p>Python \u6587\u6863\u5b57\u7b26\u4e32\u901a\u5e38\u9075\u5faa\u4e00\u79cd\u6807\u51c6\u683c\u5f0f\u7ea6\u5b9a\uff1a\u7528\u4e09\u5f15\u53f7\u8868\u793a\u6587\u6863\u5b57\u7b26\u4e32\u7684\u5f00\u59cb\u548c\u7ed3\u675f\u4f4d\u7f6e\uff0c\u7b2c\u4e00\u884c\u662f\u7b80\u8981\u63cf\u8ff0\uff0c\u63a5\u4e0b\u6765\u662f\u8be6\u60c5\u548c\u793a\u4f8b\u3002</p> <p>\u7b2c\u4e00\u884c\u4ee5 <code>def</code> \u5f00\u5934\u88ab\u79f0\u4e3a\u51fd\u6570\u5934\uff1b\u51fd\u6570\u5934\u540e\u9762\u6240\u6709\u7f29\u8fdb\u7684\u4ee3\u7801\u88ab\u79f0\u4e3a\u51fd\u6570\u4f53\u3002</p> <p>\u51fd\u6570\u5934\u540e\u9762\u662f\u53ef\u9009\u7684\u6587\u6863\u5b57\u7b26\u4e32\u3002\u53ef\u4ee5\u4f7f\u7528 <code>print(area.circle.__doc__)</code> \u7684\u65b9\u5f0f\u67e5\u770b\u51fd\u6570\u6587\u6863\u5b57\u7b26\u4e32\u3002</p> <p>\u5982\u679c\u51fd\u6570\u6ca1\u6709 return \u8bed\u53e5\uff0cPython \u5c06\u8ba4\u4e3a\u51fd\u6570\u4ee5 <code>reutrn None</code> \u7ed3\u675f\u3002\u7279\u6b8a\u503c None \u7528\u4e8e\u6307\u51fa\u51fd\u6570\u4e0d\u8fd4\u56de\u503c\u3002</p>"},{"location":"Python/%E7%AC%AC%205%20%E7%AB%A0%EF%BC%9A%E5%87%BD%E6%95%B0/#_3","title":"\u53d8\u91cf\u7684\u4f5c\u7528\u57df","text":"<p>\u793a\u4f8b\u4ee3\u7801\u3002 <pre><code># global_error.py\ndef say_hello():\n\u00a0 \u00a0 print('Hello ' + name + \"!\")\n\ndef change_name(new_name):\n\u00a0 \u00a0 name = new_name\n\nname = 'Jacky'\nsay_hello() # Hello Jacky!\nchange_name('Suomea')\nsay_hello() # Hello Jacky!\n</code></pre></p> <p>\u5728\u51fd\u6570\u5916\u58f0\u660e\u7684\u53d8\u91cf\u4e3a\u5168\u5c40\u53d8\u91cf\uff0c\u7a0b\u5e8f\u4e2d\u7684\u4efb\u4f55\u4ee3\u7801\u548c\u51fd\u6570\u90fd\u53ef\u4ee5\u8bfb\u53d6\u5b83\u3002<code>name</code> \u5c31\u662f\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\u3002</p> <p><code>change_name</code> \u51fd\u6570\u5e76\u6ca1\u80fd\u591f\u4fee\u6539\u5168\u5c40\u53d8\u91cf <code>name</code> \u7684\u503c\uff0c\u56e0\u4e3a Python \u5c06\u51fd\u6570 <code>change_name</code> \u51fd\u6570\u4e2d\u7684 <code>name</code> \u53d8\u91cf\u89c6\u4e3a\u5c40\u90e8\u53d8\u91cf\u3002 \u5982\u679c\u8981\u8bbf\u95ee\u5168\u5c40\u53d8\u91cf\uff0c\u9700\u8981\u4f7f\u7528 <code>global</code> \u5173\u952e\u5b57\u3002</p> <p>\u4fee\u6539\u8fc7\u540e\u7684\u4ee3\u7801\u3002 <pre><code># global.py\ndef say_hello():\n\u00a0 \u00a0 print('Hello ' + name + \"!\")\n\ndef change_name(new_name):\n\u00a0 \u00a0 global name\n\u00a0 \u00a0 name = new_name\n\nname = 'Jacky'\nsay_hello() # Hello Jacky!\nchange_name('Suomea')\nsay_hello() # Hello Suomea!\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%205%20%E7%AB%A0%EF%BC%9A%E5%87%BD%E6%95%B0/#main","title":"<code>main</code> \u51fd\u6570","text":"<p>\u5728 C\u3001C++ \u548c Java \u4e2d\uff0c\u5fc5\u987b\u6709\u4e00\u4e2a main \u51fd\u6570\u4f5c\u4e3a\u7a0b\u5e8f\u7684\u5165\u53e3\u3002\u4f46\u662f\u5728 Python \u4e2d\uff0cmain \u53ea\u662f\u4e00\u79cd\u7ea6\u5b9a\uff0c\u5b8c\u5168\u662f\u53ef\u9009\u7684\uff08\u811a\u672c\u8bed\u8a00\ud83d\udc40\uff09\u3002</p> <pre><code># main.py\n\ndef main():\n    print('hello world!')\n\nif __name__ == '__main__':\n    main()\n</code></pre> <p>\u8bed\u53e5 <code>if __name__ == '__main__':</code> \u7684\u4f5c\u7528\u662f\u68c0\u67e5\u811a\u672c\u662f\u5426\u76f4\u63a5\u8fd0\u884c\u7684\uff0c\u800c\u4e0d\u662f\u4f5c\u4e3a\u6a21\u5757\u88ab\u5bfc\u5165\u7684\u3002\u5f53 Python \u6587\u4ef6\u76f4\u63a5\u8fd0\u884c\u65f6\uff0c<code>__name__</code>\u00a0\u4f1a\u88ab\u8bbe\u7f6e\u4e3a\u00a0<code>__main__</code>\uff0c\u5c31\u4f1a\u8c03\u7528 <code>main()</code> \u51fd\u6570\u3002</p> <p>\u76f4\u63a5\u8fd0\u884c\u547d\u4ee4\uff1a<code>python main.py</code></p>"},{"location":"Python/%E7%AC%AC%205%20%E7%AB%A0%EF%BC%9A%E5%87%BD%E6%95%B0/#_4","title":"\u51fd\u6570\u7684\u53c2\u6570","text":"<p>Python \u4e2d\u53ea\u6709\u5f15\u7528\u4f20\u9012\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\u3002 <pre><code># reference.py\ndef set(x):\n\u00a0 \u00a0 x = 1\n</code></pre></p> <p>set \u51fd\u6570\u5e76\u4e0d\u4f1a\u6539\u53d8\u53d8\u91cf a \u7684\u503c\u3002 <pre><code>&gt;&gt;&gt; import reference\n&gt;&gt;&gt; a = 2\n&gt;&gt;&gt; a\n2\n&gt;&gt;&gt; reference.set(a)\n&gt;&gt;&gt; a\n2\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%205%20%E7%AB%A0%EF%BC%9A%E5%87%BD%E6%95%B0/#_5","title":"\u51fd\u6570\u7684\u9ed8\u8ba4\u503c","text":"<p>\u793a\u4f8b\u4ee3\u7801\u3002 <pre><code># greeting.py\ndef greeting(name, greeting = 'Hello'):\n\u00a0 \u00a0 print(greeting, name + '!')\n</code></pre></p> <p>\u6267\u884c\u51fd\u6570\u3002 <pre><code>&gt;&gt;&gt; import greeting\n&gt;&gt;&gt; greeting.greeting('jacky') \nHello jacky!\n&gt;&gt;&gt; greeting.greeting('jacky', \"\u4f60\u597d\")\n\u4f60\u597d jacky!\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%205%20%E7%AB%A0%EF%BC%9A%E5%87%BD%E6%95%B0/#_6","title":"\u6a21\u5757","text":"<p>\u521b\u5efa\u6a21\u5757\u53ea\u9700\u8981\u521b\u5efa\u4e00\u4e2a <code>.py</code> \u6587\u4ef6\uff0c\u5728\u5176\u4e2d\u7f16\u5199\u7528\u4e8e\u5b8c\u6210\u4efb\u52a1\u7684\u51fd\u6570\u3002 \u793a\u4f8b\u4ee3\u7801\u3002 <pre><code># shapes.py\n\"\"\"A collection of functions\n\u00a0 \u00a0 for printing basic shapes.\n\"\"\"\n\nCHAR = \"*\"\ndef rectangle(height, width):\n\u00a0 \u00a0 \"\"\"Print a rectangle.\"\"\"\n\u00a0 \u00a0 for row in range(height):\n\u00a0 \u00a0 \u00a0 \u00a0 for col in range(width):\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 print(CHAR, end = '')\n\u00a0 \u00a0 \u00a0 \u00a0 print()\n\ndef square(side):\n\u00a0 \u00a0 \"\"\"Print a square.\"\"\"\n\u00a0 \u00a0 rectangle(side, side)\n</code></pre></p> <p>\u6267\u884c\u547d\u4ee4\u3002 <pre><code>&gt;&gt;&gt; import shapes\n&gt;&gt;&gt; dir(shapes)\n['CHAR', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__', 'rectangle', 'square']\n&gt;&gt;&gt; print(shapes.square.__doc__)\nPrint a square.\n&gt;&gt;&gt; shapes.square(4)\n****\n****\n****\n****\n&gt;&gt;&gt; help(shapes.square)\nHelp on function square in module shapes:\n\nsquare(side)\n    Print a square.\n</code></pre></p> <p>\u5bf9\u4e8e\u6a21\u5757\uff0c\u8981\u8ba9\u6a21\u5757\u4e2d\u7684\u540d\u79f0\u5728\u6a21\u5757\u5916\u90e8\u53ef\u89c1\uff0c\u5fc5\u987b\u4f7f\u7528 <code>import</code> \u8bed\u53e5\u3002</p>"},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/","title":"Python","text":""},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#python_1","title":"Python \u5185\u7f6e\u7684\u5b57\u7b26\u4e32\u76f8\u5173\u7684\u51fd\u6570","text":""},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#_1","title":"\u5b57\u7b26\u4e32\u7d22\u5f15","text":"<p>Python \u4e2d\u5b57\u7b26\u4e32\u53ef\u4ee5\u5f53\u4f5c\u4e00\u4e2a\u5b57\u7b26\u6570\u7ec4\uff0c\u4f7f\u7528\u6570\u7ec4\u7d22\u5f15\u53bb\u8bbf\u95ee\u5b57\u7b26\u4e32\u4e2d\u7684\u5b57\u7b26\u3002</p> <p>\u7d22\u5f15\u4ece 0 \u5f00\u59cb\uff0c\u7d22\u5f15\u4e5f\u53ef\u4ee5\u4e3a\u8d1f\u6570\u3002\u5f53\u7d22\u5f15\u4e3a -1 \u65f6\u8868\u793a\u8bbf\u95ee\u5b57\u7b26\u4e32\u7684\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u3002</p> <p>\u5185\u7f6e\u51fd\u6570 len(s) \u7528\u4e8e\u83b7\u53d6\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u3002</p> <pre><code>&gt;&gt;&gt; name[0]\n'j'\n&gt;&gt;&gt; name[-1]\n'y'\n&gt;&gt;&gt; name[len(name) - 1]\n'y'\n</code></pre>"},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#for","title":"\u4f7f\u7528 for \u5faa\u73af\u8bbf\u95ee\u5b57\u7b26\u4e32","text":"<p>\u5185\u7f6e\u51fd\u6570 ord(s) \u63a5\u6536\u4e00\u4e2a\u5b57\u7b26\u4f5c\u4e3a\u53c2\u6570\uff0c\u5e76\u8fd4\u56de\u8be5\u5b57\u7b26\u5bf9\u5e94\u7684 Unicode \u503c\u3002\u63d0\u793a\uff1aUnicode \u7684\u524d 256 \u4e2a\u5b57\u6bcd\u4e3a ASCII \u7801\u3002</p> <p>\u4e24\u79cd\u65b9\u6cd5\u904d\u5386\u5b57\u7b26\u4e32\uff0c\u914d\u5408\u4f7f\u7528 <code>ord</code> \u51fd\u6570\u8ba1\u7b97\u5b57\u7b26\u4e32\u7684 Unicode \u548c\u3002 <pre><code># codesum.py\n\ndef sunm1(s):\n\u00a0 \u00a0 total = 0\n\u00a0 \u00a0 for c in s:\n\u00a0 \u00a0 \u00a0 \u00a0 total = total + ord(c)\n\u00a0 \u00a0 return total\n\ndef sum2(s):\n\u00a0 \u00a0 total = 0\n\u00a0 \u00a0 for i in range(len(s)):\n\u00a0 \u00a0 \u00a0 \u00a0 total = total + ord(s[i])\n\u00a0 \u00a0 return total\n</code></pre></p> <pre><code>&gt;&gt;&gt; import codesum\n&gt;&gt;&gt; codesum.sum1('cc')\n198\n&gt;&gt;&gt; codesum.sum2('cc') \n198\n</code></pre>"},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#_2","title":"\u5b57\u7b26","text":"<p>\u524d\u9762\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\u5185\u7f6e\u51fd\u6570 <code>ord</code>\uff0c\u4e0e\u4e4b\u5bf9\u5e94\u7684\u51fd\u6570\u662f <code>chr</code>\u3002<code>chr</code> \u63a5\u53d7\u4e00\u4e2a Unicode \u503c\uff0c\u8fd4\u56de\u5176\u5bf9\u5e94\u7684\u5b57\u7b26\u3002</p> <p>\u6253\u5370\u6240\u6709\u7684\u4e2d\u6587\u5b57\u7b26\u3002 <pre><code># chr_test.py\nfor i in range(0x4e00, 0xa000):\n\u00a0 \u00a0 print(chr(i), end='')\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#_3","title":"\u8f6c\u4e49\u5b57\u7b26","text":"<p>\u6709\u4e9b\u5b57\u7b26\u5177\u6709\u7279\u6b8a\u7684\u610f\u4e49\uff0c\u56e0\u6b64\u5728\u6253\u5370\u7684\u65f6\u5019\u9700\u8981\u914d\u5408\u4f7f\u7528\u8f6c\u4e49\u5b57\u7b26\u53d6\u6d88\u5176\u7279\u6b8a\u610f\u4e49\u3002\u8f6c\u4e49\u5b57\u7b26\u4e3a <code>\\</code>\u3002</p> <p>\u4e00\u4e9b\u5e38\u89c1\u7684\u8f6c\u4e49\u5b57\u7b26\uff0c\u8f6c\u4e49\u5b57\u7b26\u662f\u5355\u4e2a\u5b57\u7b26\uff0c\u6240\u4ee5\u5728\u8ba1\u7b97\u5b57\u7b26\u4e32\u957f\u5ea6\u65f6\u957f\u5ea6\u4e3a 1\u3002</p> \u5b57\u7b26 \u542b\u4e49 <code>\\\\</code> \u53cd\u659c\u6760 <code>\\'</code> \u5355\u5f15\u53f7 <code>\\\"</code> \u53cc\u5f15\u53f7 <code>\\n</code> \u6362\u884c\u7b26 <code>\\r</code> \u56de\u8f66\u7b26 <code>\\t</code> Tab <pre><code>&gt;&gt;&gt; len(\"\\\\\")\n1\n</code></pre>"},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#_4","title":"\u5b57\u7b26\u4e32\u5207\u7247","text":"<p>\u53ef\u4ee5\u4f7f\u7528\u5207\u7247\u4ece\u5b57\u7b26\u4e32\u4e2d\u63d0\u53d6\u5b50\u4e32\u3002</p> <p><code>s[begin:end]</code> \u8fd4\u56de\u4ece\u7d22\u5f15 begin \u5230 end-1 \u7684\u5b57\u4e32\u3002</p> <p>\u5982\u679c\u7701\u7565 begin \u9ed8\u8ba4 begin \u4e3a\u96f6\u3002</p> <p>\u5982\u679c\u7701\u7565 end \u9ed8\u5c06\u63d0\u53d6\u5230\u7ed3\u5c3e\u3002</p> <p>\u5982\u679c\u7701\u7565 begin \u548c end \u5c06\u63d0\u53d6\u6574\u4e2a\u5b57\u7b26\u4e32\u3002</p>"},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#_5","title":"\u6807\u51c6\u5b57\u7b26\u4e32\u51fd\u6570","text":"<p>\u6807\u51c6\u5b57\u7b26\u4e32\u51fd\u6570\u662f\u7528\u6765\u5904\u7406\u5b57\u7b26\u4e32\u7684\uff0c\u4e0d\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u5982\u679c\u60f3\u8981\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u9700\u8981\u4f7f\u7528 <code>re</code> \u6a21\u5757\u3002</p>"},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#_6","title":"\u5b57\u7b26\u4e32\u6d4b\u8bd5\u51fd\u6570","text":"<pre><code>s.endswith(t) s \u4ee5\u5b57\u7b26\u4e32 t \u7ed3\u5c3e \ns.startswith(t) s \u4ee5\u5b57\u7b26\u4e32 t \u6253\u5934 \ns.isalnum() s \u53ea\u5305\u542b\u5b57\u6bcd\u6216\u6570\u5b57 \ns.isalpha() s \u53ea\u5305\u542b\u5b57\u6bcd \ns.isdecimal() s \u53ea\u5305\u542b\u8868\u793a\u5341\u8fdb\u5236\u6570\u5b57\u7684\u5b57\u7b26 \ns.isdigit() s \u53ea\u5305\u542b\u6570\u5b57\u5b57\u7b26 \ns.isidentifier() s \u662f\u5408\u6cd5\u7684\u6807\u8bc6\u7b26 \ns.islower() s \u53ea\u5305\u542b\u5c0f\u5199\u5b57\u6bcd \ns.isnumeric() s \u53ea\u5305\u542b\u6570\u5b57 \ns.isprintable() s \u53ea\u5305\u542b\u53ef\u6253\u5370\u5b57\u7b26 \ns.isspace() s \u53ea\u5305\u542b\u7a7a\u767d\u5b57\u7b26 \ns.istitle() s \u662f\u4e2a\u5927\u5c0f\u5199\u7b26\u5408\u5934\u8854\u8981\u6c42 \uff08title-case\uff09\u7684\u5b57\u7b26\u4e32 \ns.isupper() s \u53ea\u5305\u542b\u5927\u5199\u5b57\u6bcd \nt in s s \u5305\u542b\u5b57\u7b26\u4e32 t\n</code></pre>"},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#_7","title":"\u641c\u7d22\u51fd\u6570","text":"<pre><code>s.find(t) \u5982\u679c\u6ca1\u6709\u627e\u5230\u5b50\u4e32 t\uff0c\u5219\u8fd4\u56de -1\uff1b\u5426\u5219 \u8fd4\u56de t \u5728 s \u4e2d\u7684\u8d77\u59cb\u4f4d\u7f6e \ns.rfind(t) \u4e0e find \u76f8\u540c\uff0c\u4f46\u4ece\u53f3\u5f80\u5de6\u641c\u7d22 \ns.index(t) \u4e0e find \u76f8\u540c\uff0c\u4f46\u5982\u679c\u5728 s \u4e2d\u627e\u4e0d\u5230 t\uff0c \u5219\u5f15\u53d1 ValueError \u5f02\u5e38 \ns.rindex(t) \u4e0e index \u76f8\u540c\uff0c\u4f46\u4ece\u53f3\u5f80\u5de6\u641c\u7d22\n</code></pre>"},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#_8","title":"\u6539\u53d8\u5927\u5c0f\u5199\u7684\u51fd\u6570","text":"<p>\u5728\u6240\u6709\u8fd9\u4e9b\u51fd\u6570\u4e2d\uff0cPython \u90fd\u521b\u5efa\u5e76\u8fd4\u56de\u4e00\u4e2a\u65b0\u5b57\u7b26\u4e32\u3002 <pre><code>s.capitalize() \u5c06 s[0] \u6539\u4e3a\u5927\u5199 \ns.lower() \u8ba9 s \u7684\u6240\u6709\u5b57\u6bcd\u90fd\u5c0f\u5199 \ns.upper() \u8ba9 s \u7684\u6240\u6709\u5b57\u6bcd\u90fd\u5927\u5199 \ns.swapcase() \u5c06\u5c0f\u5199\u5b57\u6bcd\u6539\u4e3a\u5927\u5199\uff0c\u5e76\u5c06\u5927\u5199\u5b57 \u6bcd\u6539\u4e3a\u5c0f\u5199 \ns.title() \u8ba9 s \u7684\u5927\u5c0f\u5199\u7b26\u5408\u5934\u8854\u7684\u8981\u6c42\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#_9","title":"\u8bbe\u7f6e\u683c\u5f0f\u7684\u51fd\u6570","text":"<pre><code>s.center(n, ch) \u5305\u542b n \u4e2a\u5b57\u7b26\u7684\u5b57\u7b26\u4e32\uff0c\u5176\u4e2d s \u4f4d \u4e8e\u4e2d\u592e\uff0c\u4e24\u8fb9\u7528\u5b57\u7b26 ch \u586b\u5145 \ns.ljust(n, ch) \u5305\u542b n \u4e2a\u5b57\u7b26\u7684\u5b57\u7b26\u4e32\uff0c\u5176\u4e2d s \u4f4d \u4e8e\u5de6\u8fb9\uff0c\u53f3\u8fb9\u7528\u5b57\u7b26 ch \u586b\u5145 \ns.rjust(n, ch) \u5305\u542b n \u4e2a\u5b57\u7b26\u7684\u5b57\u7b26\u4e32\uff0c\u5176\u4e2d s \u4f4d \u4e8e\u53f3\u8fb9\uff0c\u5de6\u8fb9\u7528\u5b57\u7b26 ch \u586b\u5145 \ns.format(vars)\n</code></pre> <p>format \u51fd\u6570\u7b80\u5355\u4f7f\u7528\u793a\u4f8b\uff0cformat \u51fd\u6570\u975e\u5e38\u5f3a\u5927\uff0c\u8be6\u7ec6\u4f7f\u7528\u53c2\u8003\u5b98\u65b9\u6587\u6863\u3002 <pre><code>&gt;&gt;&gt; \"hello, {0} and {1}\".format('jacky', 'suomea')\n'hello, jacky and suomea'\n&gt;&gt;&gt; \"hello, {n} and {m}\".format(m='suomea', n = 'jacky')\n'hello, jacky and suomea'\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#_10","title":"\u5254\u9664\u51fd\u6570","text":"<pre><code>s.strip(ch) \u4ece s \u5f00\u5934\u548c\u672b\u5c3e\u5220\u9664\u6240\u6709\u5305\u542b\u5728\u5b57 \u7b26\u4e32 ch \u4e2d\u7684\u5b57\u7b26 \ns.lstrip(ch) \u4ece s \u5f00\u5934\uff08\u5de6\u7aef\uff09\u5220\u9664\u6240\u6709\u5305\u542b\u5728 \u5b57\u7b26\u4e32 ch \u4e2d\u7684\u5b57\u7b26 \ns.rstrip(ch) \u4ece s \u672b\u5c3e\uff08\u53f3\u7aef\uff09\u5220\u9664\u6240\u6709\u5305\u542b\u5728 \u5b57\u7b26\u4e32 ch \u4e2d\u7684\u5b57\u7b26\n</code></pre> <p>\u793a\u4f8b\u3002 <pre><code>&gt;&gt;&gt; file_path = '   /path/t   o/file.txt    '\n&gt;&gt;&gt; file_path.lstrip()\n'/path/t   o/file.txt    '\n&gt;&gt;&gt; file_path.rstrip()\n'   /path/t   o/file.txt'\n&gt;&gt;&gt; file_path.strip()\n'/path/t   o/file.txt'\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#_11","title":"\u62c6\u5206\u51fd\u6570","text":"<pre><code>s.partition(t) \u5c06 s \u62c6\u5206\u4e3a\u4e09\u4e2a\u5b57\u7b26\u4e32\uff08head\u3001t \u548c tail\uff09\uff0c\u5176\u4e2d head \u4e3a t \u524d\u9762\u7684\u5b50\u4e32\uff0c \u800c tail \u4e3a t \u540e\u9762\u7684\u5b50\u4e32 \ns.rpartition(t) \u4e0e partition \u76f8\u540c\uff0c\u4f46\u4ece s \u7684\u53f3\u7aef \u5f00\u59cb\u641c\u7d22 t \ns.split(t) \u4ee5 t \u4e3a\u5206\u9694\u7b26\uff0c\u5c06 s \u5212\u5206\u6210\u4e00\u7cfb\u5217 \u5b50\u4e32\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u7531\u8fd9\u4e9b\u5b50\u4e32\u7ec4\u6210 \u7684\u5217\u8868 \ns.rsplit(t) \u4e0e split \u76f8\u540c\uff0c\u4f46\u4ece s \u7684\u53f3\u7aef\u5f00\u59cb \u641c\u7d22 t \ns.splitlines() \u8fd4\u56de\u4e00\u4e2a\u7531 s \u4e2d\u7684\u5404\u884c\u7ec4\u6210\u7684\u5217\u8868\n</code></pre> <p>\u793a\u4f8b\u3002 <pre><code>&gt;&gt;&gt; name='hello jacky jacky world!'\n&gt;&gt;&gt; name.partition('jacky')\n('hello ', 'jacky', ' jacky world!')\n&gt;&gt;&gt; name.rpartition('jacky')\n('hello jacky ', 'jacky', ' world!')\n</code></pre></p> <p><code>split</code> \u548c <code>rsplit</code> \u8fd8\u53ef\u4ee5\u6307\u5b9a\u5206\u5272\u7684\u6b21\u6570\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\u5206\u5272\u7684\u6b21\u6570\u5b83\u4eec\u7684\u6548\u679c\u662f\u4e00\u6837\u7684\u3002 <pre><code>&gt;&gt;&gt; name='hello jacky jacky world!'\n&gt;&gt;&gt; name.rsplit('jacky', 1)\n['hello jacky ', ' world!']\n&gt;&gt;&gt; name.split('jacky', 1)\n['hello ', ' jacky world!']\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#_12","title":"\u66ff\u6362\u51fd\u6570","text":"<pre><code>s.replace(old, new) \u5c06 s \u4e2d\u7684\u6bcf\u4e2a old \u66ff\u6362\u4e3a new \ns.expandtabs(n) \u5c06 s \u4e2d\u7684\u6bcf\u4e2a\u5236\u8868\u7b26\u66ff\u6362\u4e3a n \u4e2a \u7a7a\u683c\n</code></pre>"},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#_13","title":"\u5176\u5b83\u51fd\u6570","text":"<pre><code>s.count(t) t \u5728 s \u4e2d\u51fa\u73b0\u7684\u6b21\u6570 \ns.encode() \u8bbe\u7f6e s \u7684\u7f16\u7801\uff0c\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f\u8bf7\u53c2\u9605\u5728\u7ebf\u6587\u6863\uff08http://docs.python.org/3/library/stdtypes. html#str.encode\uff09 \ns.join(seq) \u4f7f\u7528 s \u5c06 seq \u4e2d\u7684\u5b57\u7b26\u4e32\u8fde\u63a5\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32 \ns.maketrans(old,new) \u521b\u5efa\u4e00\u4e2a\u8f6c\u6362\u8868\uff0c\u7528\u4e8e\u5c06 old \u4e2d\u7684\u5b57\u7b26\u6539\u4e3a new \u4e2d\u76f8\u5e94\u7684\u5b57\u7b26\uff1b\u8bf7\u6ce8\u610f\uff0cs \u53ef\u4ee5\u662f\u4efb\u4f55 \u5b57\u7b26\u4e32\uff0c\u5b83\u4e0d\u5f71\u54cd\u8fd4\u56de\u7684\u8f6c\u6362\u8868 s.translate(table) \u4f7f\u7528\u6307\u5b9a\u8f6c\u6362\u8868\uff08\u4f7f\u7528 maketrans \u521b\u5efa\u7684\uff09\u5bf9 s \u4e2d\u7684\u5b57\u7b26\u8fdb\u884c\u66ff\u6362 \ns.zfill(width) \u5728 s \u5de6\u8fb9\u6dfb\u52a0\u8db3\u591f\u591a\u7684 0\uff0c\u8ba9\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u4e3a width\n</code></pre>"},{"location":"Python/%E7%AC%AC%206%20%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/#_14","title":"\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>\u6b63\u5219\u8868\u8fbe\u5f0f\u9700\u8981\u4f7f\u7528 <code>re</code> \u6a21\u5757\u3002</p> <p>\u5339\u914d\u3001\u5206\u5272\u548c\u67e5\u627e\u5728\u8be5\u6a21\u5757\u4e0b\u90fd\u6709\u5bf9\u5e94\u7684\u51fd\u6570\u3002</p> <p>\u5339\u914d\u793a\u4f8b\u3002 <pre><code>&gt;&gt;&gt; name=\"hahaha!!!! ha! hahahahha\"\n&gt;&gt;&gt; re.match('(ha)+!+', name)\n&lt;re.Match object; span=(0, 10), match='hahaha!!!!'&gt;\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%207%20%E7%AB%A0%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/","title":"Python","text":"<p>\u672c\u8282\u5b66\u4e60 Python \u7684\u6570\u636e\u7ed3\u6784\uff0c\u7c7b\u4f3c Java \u4e2d\u7684\u96c6\u5408\u6846\u67b6\u3002</p>"},{"location":"Python/%E7%AC%AC%207%20%E7%AB%A0%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#type","title":"type \u547d\u4ee4","text":"<p>\u5185\u7f6e\u547d\u4ee4 <code>type</code> \u80fd\u591f\u67e5\u770b\u53d8\u91cf\u6216\u503c\u7684\u6570\u636e\u7c7b\u578b\u3002</p> <pre><code>&gt;&gt;&gt; type(1)\n&lt;class 'int'&gt;\n&gt;&gt;&gt; type(None)\n&lt;class 'NoneType'&gt;\n&gt;&gt;&gt; type(print)\n&lt;class 'builtin_function_or_method'&gt;\n&gt;&gt;&gt; type(1.1)\n&lt;class 'float'&gt;\n</code></pre>"},{"location":"Python/%E7%AC%AC%207%20%E7%AB%A0%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_1","title":"\u5e8f\u5217","text":"<p>Python \u6709 3 \u4e2d\u5185\u7f6e\u7684\u5e8f\u5217\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32\u3001\u5143\u7ec4\u548c\u5217\u8868\u3002</p> <ol> <li>\u5e8f\u5217\u662f\u6309\u7167\u987a\u5e8f\u6392\u5217\u7684\uff0c\u8fd9\u70b9\u5f88\u91cd\u8981\u3002\u4e0d\u540c\u4e8e\u5b57\u5178\u548c\u96c6\u5408\uff0c\u5b83\u4eec\u53ea\u5173\u5fc3\u81ea\u5df1\u662f\u5426\u5305\u542b\u7279\u5b9a\u7684\u5143\u7d20\uff0c\u800c\u4e0d\u4fdd\u8bc1\u5143\u7d20\u7684\u76f8\u5bf9\u987a\u5e8f\u3002</li> <li>\u5e8f\u5217\u7684\u957f\u5ea6\u4e0d\u53d7\u9650\u5236\uff0c\u7406\u8bba\u4e0a\u3002\uff08\u5f53\u7136\u4f1a\u53d7\u5230\u8ba1\u7b97\u673a\u7269\u7406\u5185\u5b58\u7684\u9650\u5236\uff09</li> </ol> <p>\u5e8f\u5217\u7684\u4f18\u70b9\u4e4b\u4e00\u5c31\u662f\u652f\u6301\u7d22\u5f15\u548c\u5207\u7247\u3002\u6240\u6709\u7684\u5e8f\u5217\u90fd\u5177\u5907\u5982\u4e0b\u7279\u5f81\u3002 1. \u7b2c\u4e00\u4e2a\u6b63\u7d22\u5f15\u4e3a 0\uff0c\u6307\u5411\u5de6\u7aef\u3002 2. \u7b2c\u4e00\u4e2a\u8d1f\u7d22\u5f15\u4e3a -1\uff0c\u6307\u5411\u53f3\u7aef\u3002 3. \u53ef\u4ee5\u4f7f\u7528\u5207\u7247\u8868\u793a\u6cd5\u6765\u590d\u5236\u5b50\u5e8f\u5217\uff0c\u4f8b\u5982\uff0c<code>seq[begin:end]</code> \u590d\u5236 seq \u7684\u5982\u4e0b\u5143\u7d20\uff1a\u4ece\u7d22\u5f15 begin \u6307\u5411\u7684\u5143\u7d20\u5230\u7d22\u5f15 end - 1 \u6307\u5411\u7684\u5143\u7d20\u3002 4. \u53ef\u4ee5\u4f7f\u7528 <code>+</code> \u548c <code>*</code> \u8fdb\u884c\u62fc\u63a5\u3002\u8981\u8fdb\u884c\u62fc\u63a5\uff0c\u5e8f\u5217\u7684\u7c7b\u578b\u5fc5\u987b\u76f8\u540c\uff0c\u5373\u4e0d\u80fd\u62fc\u63a5\u5143\u7ec4\u548c\u5217\u8868\u3002 5. \u53ef\u4f7f\u7528 <code>len</code> \u51fd\u6570\u8ba1\u7b97\u5176\u957f\u5ea6\u3002 6. \u8868\u8fbe\u5f0f <code>x in s</code> \u68c0\u67e5\u5e8f\u5217 <code>s</code> \u662f\u5426\u5305\u542b\u5143\u7d20 <code>x</code>\u3002</p>"},{"location":"Python/%E7%AC%AC%207%20%E7%AB%A0%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_2","title":"\u5143\u7ec4","text":"<p>\u5143\u7ec4\u662f\u4e00\u79cd\u4e0d\u53ef\u53d8\u7684\u5e8f\u5217\uff0c\u5305\u542b\u96f6\u4e2a\u6216\u8005\u66f4\u591a\u4e2a\u503c\u3002\u6ce8\u610f\u8fd9\u91cc\u8bf4\u7684\u662f\u503c\uff0c\u5373\u6ca1\u6709\u7c7b\u578b\u4e0a\u7684\u9650\u5236\u3002 <pre><code>&gt;&gt;&gt;items = (1, 'cat', 0.1, (1, 2))\n</code></pre></p> <p>\u5143\u7ec4\u53ef\u4ee5\u5305\u542b\u53e6\u4e00\u4e2a\u5143\u7ec4\u3002</p> <p>\u7a7a\u5143\u7ec4\u7528 <code>()</code> \u8868\u793a\uff0c\u53ea\u6709\u4e00\u4e2a\u5143\u7ec4\u7684\u5143\u7ec4\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\u8868\u793a <code>(x,)</code>\uff0c\u6ce8\u610f\u5355\u5143\u7d20\u5143\u7ec4\u540e\u9762\u7684\u9017\u53f7\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\uff08\u4e3a\u4e86\u533a\u5206\u4e0e\u8868\u8fbe\u5f0f\u7684\u533a\u522b\uff09\u3002 <pre><code>&gt;&gt;&gt; type(())\n&lt;class 'tuple'&gt;\n&gt;&gt;&gt; type((1, 'jacky'))\n&lt;class 'tuple'&gt;\n&gt;&gt;&gt; type((1,))\n&lt;class 'tuple'&gt;\n&gt;&gt;&gt; type((1))\n&lt;class 'int'&gt;\n</code></pre></p> <p>\u5143\u7ec4\u662f\u4e0d\u53ef\u53d8\u7684\uff0c\u8fd9\u610f\u5473\u5143\u7ec4\u5728\u521b\u5efa\u4e4b\u540e\u4e0d\u80fd\u4fee\u6539\u5b83\u3002\u5b57\u7b26\u4e32\u3001\u6574\u6570\u548c\u6d6e\u70b9\u6570\u90fd\u662f\u4e0d\u53ef\u53d8\u7684\u3002 <pre><code>&gt;&gt;&gt; items=(1, 2, 3, 4)\n&gt;&gt;&gt; items2=items[1:]\n&gt;&gt;&gt; items2\n(2, 3, 4)\n</code></pre></p> <p>\u5143\u7ec4\u5e38\u7528\u7684\u51fd\u6570\u3002 <pre><code>x in tup \u5982\u679c x \u662f\u5143\u7ec4 tup \u7684\u4e00\u4e2a\u5143\u7ec4\uff0c\u5219\u8fd4 \u56de True\uff0c\u5426\u5219\u8fd4\u56de False \nlen(tup) \u5143\u7ec4 tup \u5305\u542b\u7684\u5143\u7d20\u6570 \ntup.count(x) \u5143\u7d20 x \u5728\u5143\u7ec4 tup \u4e2d\u51fa\u73b0\u7684\u6b21\u6570 t\nup.index(x) \u5143\u7ec4 tup \u4e2d\u7b2c\u4e00\u4e2a\u5143\u7d20 x \u7684\u7d22\u5f15\uff1b\u5982 \u679c x \u672a\u5305\u542b\u5728\u5143\u7ec4 tup \u4e2d\uff0c\u5c06\u5f15\u53d1 ValueError \u5f02\u5e38\n</code></pre></p> <p>\u793a\u4f8b\u3002 <pre><code>&gt;&gt;&gt; items=(1,2,3,4)\n&gt;&gt;&gt; 1 in items\nTrue\n&gt;&gt;&gt; 9 in items\nFalse\n&gt;&gt;&gt; len(items)\n4\n&gt;&gt;&gt; items.count(1)\n1\n&gt;&gt;&gt; items.index(2)\n1\n</code></pre></p> <p>\u5143\u7ec4\u548c\u5b57\u7b26\u4e32\u4e00\u6837\u53ef\u4ee5\u4f7f\u7528 <code>+</code> \u548c <code>*</code> \u8fdb\u884c\u62fc\u63a5\u64cd\u4f5c\u3002 <pre><code>&gt;&gt;&gt; name='jacky'\n&gt;&gt;&gt; name * 3\n'jackyjackyjacky'\n&gt;&gt;&gt; items=('cat', 'dog')\n&gt;&gt;&gt; items * 2\n('cat', 'dog', 'cat', 'dog')\n&gt;&gt;&gt; items + items\n('cat', 'dog', 'cat', 'dog')\n&gt;&gt;&gt; items * 4\n('cat', 'dog', 'cat', 'dog', 'cat', 'dog', 'cat', 'dog')\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%207%20%E7%AB%A0%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_3","title":"\u5217\u8868","text":"<p>\u5217\u8868\u57fa\u672c\u4e8e\u5143\u7ec4\u76f8\u540c\uff0c\u4f46\u662f\u6709\u4e00\u4e2a\u91cd\u8981\u7684\u5dee\u522b\uff1a\u5217\u8868\u662f\u53ef\u53d8\u7684\u3002</p> <p>\u5217\u8868\u4f7f\u7528\u65b9\u62ec\u53f7\u62ec\u8d77\u6765\uff0c\u5176\u4e2d\u7684\u5143\u7d20\u4f7f\u7528\u9017\u53f7\u9694\u5f00\u3002\u4e0e\u5b57\u7b26\u4e32\u548c\u5143\u7ec4\u4e00\u6837\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>len</code> \u51fd\u6570\u83b7\u53d6\u5217\u8868\u7684\u957f\u5ea6\uff0c\u8fd8\u53ef\u4ee5\u53ea\u7528 <code>+</code> \u548c <code>*</code> \u62fc\u63a5\u5217\u8868\u3002 <pre><code>&gt;&gt;&gt; items = [1, 2, 3, 5]\n&gt;&gt;&gt; items[1]\n2\n&gt;&gt;&gt; items + items\n[1, 2, 3, 5, 1, 2, 3, 5]\n&gt;&gt;&gt; len(items)\n4\n&gt;&gt;&gt; items[0]=9\n&gt;&gt;&gt; items\n[9, 2, 3, 5]\n</code></pre></p> <p>\u53e6\u5916\uff0c\u4e0e\u5b57\u7b26\u4e32\u548c\u5143\u7ec4\u4e00\u6837\uff0c\u53ef\u4ee5\u4f7f\u7528\u7d22\u5f15\u548c\u5207\u7247\u6765\u8bbf\u95ee\u5143\u7d20\u548c\u5b50\u5217\u8868\u3002 <pre><code>&gt;&gt;&gt; items = [1, 'cat', (1,), [1,2]]\n&gt;&gt;&gt; items[3]\n[1, 2]\n&gt;&gt;&gt; items[1:2]\n['cat']\n</code></pre></p> <p>\u5217\u8868\u5143\u7d20\u5e76\u4e0d\u5305\u542b\u5176\u503c\uff0c\u800c\u662f\u6307\u5411\u5176\u503c\u3002</p> <p>\u5217\u8868\u5143\u7ec4\u6307\u5411\u80fd\u591f\u6307\u5411\u81ea\u8eab\uff0c\u4f46\u662f\u8fd9\u4f1a\u5bfc\u81f4\u5faa\u73af\u5f15\u7528\u3002Python \u5728\u8f93\u51fa\u8fd9\u79cd\u5217\u8868\u7684\u4f7f\u7528\u4f7f\u7528 <code>[...]</code> \u8868\u793a\u8bc6\u522b\u9664\u4e86\u5faa\u73af\u5f15\u7528\u3002 <pre><code>&gt;&gt;&gt; items\n[1, 1, (1,), [1, 2]]\n&gt;&gt;&gt; items[1]=items\n&gt;&gt;&gt; items\n[1, [...], (1,), [1, 2]]\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%207%20%E7%AB%A0%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_4","title":"\u5217\u8868\u51fd\u6570","text":"<p>append(x) \u5728\u5217\u8868\u672b\u5c3e\u6dfb\u52a0\u5143\u7d20 x <pre><code># numnote.py\ndef numnote(lst):\n\u00a0 \u00a0 msg = []\n\u00a0 \u00a0 for num in lst:\n\u00a0 \u00a0 \u00a0 \u00a0 if num &lt; 0:\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 s = str(num) + ' is negative'\n\u00a0 \u00a0 \u00a0 \u00a0 elif 0 == num:\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 s = str(num) + ' is zero'\n\u00a0 \u00a0 \u00a0 \u00a0 else:\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 s = str(num) + ' is positive'\n\u00a0 \u00a0 \u00a0 \u00a0 msg.append(s)\n\u00a0 \u00a0 return msg\n</code></pre></p> <pre><code>&gt;&gt;&gt; import numnote\n&gt;&gt;&gt; numnote.numnote([1,2,3,0,-1,22]) \n['1 is positive', '2 is positive', '3 is positive', '0 is zero', '-1 is negative', '22 is positive']\n</code></pre> <p>\u5982\u679c\u60f3\u8981\u6253\u5370\u5217\u8868\uff0c\u6bcf\u4e2a\u5143\u7d20\u5360\u7528\u4e00\u884c\u3002 <pre><code>&gt;&gt;&gt; for msg in numnote.numnote([1,2,3,0,-1,22]):\n...     print(msg)\n...\n1 is positive\n2 is positive\n3 is positive\n0 is zero\n-1 is negative\n22 is positive\n&gt;&gt;&gt; print('\\n'.join(numnote.numnote([1,2,3,0,-1,22])))\n1 is positive\n2 is positive\n3 is positive\n0 is zero\n-1 is negative\n22 is positive\n</code></pre></p> <p>extend(lst) \u5c06 lst \u7684\u6240\u6709\u5143\u7d20\u6dfb\u52a0\u5230\u5217\u8868\u672b\u5c3e\u3002 <pre><code>&gt;&gt;&gt; name=['jacky','suomea']\n&gt;&gt;&gt; lst = ['aaa', 'bb', 'cc']\n&gt;&gt;&gt; name.extend(lst)  \n&gt;&gt;&gt; name\n['jacky', 'suomea', 'aaa', 'bb', 'cc']\n</code></pre></p> <p>pop(i) \u5220\u9664\u5217\u8868\u4e2d\u7d22\u5f15\u4e3a i \u7684\u5143\u7d20\uff0c\u5e76\u8fd4\u56de\u3002\u9ed8\u8ba4\u5220\u9664\u5217\u8868\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u3002</p> <p>remove(x) \u5220\u9664\u5217\u8868\u4e2d\u7b2c\u4e00\u4e2a x \u5143\u7d20\u3002</p> <p>reverse() \u53cd\u8f6c\u5217\u8868\u5143\u7d20\u7684\u6392\u5217\u987a\u5e8f\u3002</p> <p>sort() \u5bf9\u5217\u8868\u8fdb\u884c\u6392\u5e8f\uff0c\u5f53\u7136\u8fd9\u9700\u8981\u5217\u8868\u4e2d\u7684\u6240\u6709\u5143\u7d20\u7c7b\u578b\u4e00\u81f4\u3002\u53ef\u4ee5\u5148\u90fd\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u7136\u540e\u518d\u8fdb\u884c\u6392\u5e8f\u3002 <pre><code>&gt;&gt;&gt; lst= [3,6,0,-1,7,22]\n&gt;&gt;&gt; lst.sort()\n&gt;&gt;&gt; lst\n[-1, 0, 3, 6, 7, 22]\n\n&gt;&gt;&gt; lst=[\"aa\", \"dd\", \"bb\"]         \n&gt;&gt;&gt; lst.sort()\n&gt;&gt;&gt; lst\n['aa', 'bb', 'dd']\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%207%20%E7%AB%A0%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_5","title":"\u5b57\u5178","text":"<p>Python \u4e2d\u7684\u5b57\u5178\u7c7b\u4f3c\u4e8e Java \u4e2d\u7684 HashMap\uff0c\u5305\u62ec\u5e95\u5c42\u5b9e\u73b0\u539f\u7406\u3002\u5b57\u5178\u662f\u53ef\u53d8\u7684\u3002</p> <pre><code>&gt;&gt;&gt; color= {'red': 1, 'blue': 2, \"green\": 3}\n&gt;&gt;&gt; color\n{'red': 1, 'blue': 2, 'green': 3}\n&gt;&gt;&gt; color['green']\n3\n</code></pre> <p>\u5b57\u5178\u7684\u952e\u5fc5\u987b\u662f\u552f\u4e00\u7684\u3002</p> <p>\u5b57\u5178\u7684\u952e\u5fc5\u987b\u662f\u4e0d\u53ef\u53d8\u7684\uff0c\u6240\u4ee5\u952e\u4e0d\u80fd\u662f\u5217\u8868\u548c\u5b57\u5178\u3002</p>"},{"location":"Python/%E7%AC%AC%207%20%E7%AB%A0%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_6","title":"\u5b57\u5178\u51fd\u6570","text":"<pre><code>d.items() \u8fd4\u56de\u4e00\u4e2a\u7531\u5b57\u5178 d \u7684\u952e - \u503c\u5bf9\u7ec4\u6210\u7684\u89c6\u56fe\uff08view\uff09 \nd.keys() \u8fd4\u56de\u4e00\u4e2a\u7531\u5b57\u5178 d \u7684\u952e\u7ec4\u6210\u7684\u89c6\u56fe \nd.values() \u8fd4\u56de\u4e00\u4e2a\u7531\u5b57\u5178 d \u7684\u503c\u7ec4\u6210\u7684\u89c6\u56fe \nd.get(key) \u8fd4\u56de\u4e0e key \u76f8\u5173\u8054\u7684\u503c \nd.pop(key) \u5220\u9664\u952e key \u5e76\u8fd4\u56de\u4e0e\u4e4b\u76f8\u5173\u8054\u7684\u503c \nd.popitem() \u5220\u9664\u5b57\u5178 d \u4e2d\u7684\u67d0\u4e2a\u952e - \u503c\u5bf9\u5e76\u8fd4\u56de\u76f8\u5e94\u7684\u952e - \u503c \nd.clear() \u5220\u9664\u5b57\u5178 d \u7684\u6240\u6709\u5143\u7d20 \nd.copy() \u590d\u5236\u5b57\u5178 d \nd.fromkeys(s, t) \u521b\u5efa\u4e00\u4e2a\u65b0\u5b57\u5178\uff0c\u5176\u4e2d\u7684\u952e\u6765\u81ea s\uff0c\u503c\u6765\u81ea t \nd.setdefault(key, v) \u5982\u679c\u952e key \u5305\u542b\u5728\u5b57\u5178 d \u4e2d\uff0c\u5219\u8fd4\u56de\u5176\u503c\uff1b\u5426\u5219\uff0c\u8fd4\u56de v \u5e76\u5c06 (key, v) \u6dfb\u52a0\u5230\u5b57\u5178 d \u4e2d \nd.update(e) \u5c06 e \u4e2d\u7684\u952e - \u503c\u5bf9\u6dfb\u52a0\u5230\u5b57\u5178 d \u4e2d\uff1be \u53ef\u80fd\u662f\u5b57\u5178\uff0c\u4e5f\u53ef\u80fd\u662f\u952e - \u503c\u5bf9\u5e8f\u5217\n</code></pre> <p>\u51fd\u6570 <code>items</code>\u3001<code>keys</code> \u548c <code>values</code> \u90fd\u8fd4\u56de\u4e00\u4e2a\u7279\u6b8a\u7684\u5bf9\u8c61\u2014\u2014\u89c6\u56fe\u3002\u89c6\u56fe\u88ab\u94fe\u63a5\u5230\u539f\u59cb\u5b57\u5178\uff0c\u56e0\u6b64\u5982\u679c\u5b57\u5178\u53d1\u751f\u53d8\u5316\uff0c\u89c6\u56fe\u4e5f\u5c06\u53d1\u751f\u53d8\u5316\u3002 <pre><code>&gt;&gt;&gt; color\n{'red': 1, 'blue': 2, 'green': 3}\n&gt;&gt;&gt; k = color.keys()\n&gt;&gt;&gt; for i in k: print(i)\n...\nred\nblue\ngreen\n&gt;&gt;&gt; color.pop('red')\n1\n&gt;&gt;&gt; color\n{'blue': 2, 'green': 3}\n&gt;&gt;&gt; for i in k: print(i)\n...\nblue\ngreen\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%207%20%E7%AB%A0%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#_7","title":"\u96c6\u5408","text":"<p>\u96c6\u5408\u662f\u4e00\u79cd\u65e0\u5e8f\u3001\u53ef\u53d8\u7684\u6570\u636e\u7c7b\u578b\uff0c\u7528\u6237\u5b58\u50a8\u4e0d\u91cd\u590d\u7684\u5143\u7d20\u3002\u96c6\u5408\u4f7f\u7528 <code>{}</code> \u8868\u793a\uff0c\u5143\u7d20\u4e4b\u95f4\u4f7f\u7528\u9017\u53f7\u5206\u5272\u3002</p> <pre><code>&gt;&gt;&gt; my_set = {1, 2,3,4,4,123} \n&gt;&gt;&gt; my_set\n{1, 2, 3, 4, 123}\n\n&gt;&gt;&gt; my_set.add(-1)  \n&gt;&gt;&gt; my_set\n{1, 2, 3, 4, 123, -1}\n\n&gt;&gt;&gt; my_set.remove(-1) \n&gt;&gt;&gt; my_set\n{1, 2, 3, 4, 123}\n\n&gt;&gt;&gt; set1= {1,2,3}\n&gt;&gt;&gt; set2={3,4,5} \n&gt;&gt;&gt; set1 | set2\n{1, 2, 3, 4, 5}\n\n&gt;&gt;&gt; set1 &amp; set2\n{3}\n\n&gt;&gt;&gt; if 2 in set1: print(\"yes\") \n...\nyes\n\n&gt;&gt;&gt; if 100 not in set1: print(\"no\")  \n...\nno\n</code></pre>"},{"location":"Python/%E7%AC%AC%208%20%E7%AB%A0%EF%BC%9A%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA/","title":"\u7b2c 8 \u7ae0\uff1a\u8f93\u5165\u548c\u8f93\u51fa","text":""},{"location":"Python/%E7%AC%AC%208%20%E7%AB%A0%EF%BC%9A%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA/#_1","title":"\u8bbe\u7f6e\u5b57\u7b26\u4e32\u683c\u5f0f","text":"<p>\u7c7b\u4f3c C \u8bed\u8a00\u7684\u683c\u5f0f\u5316\u8f93\u51fa\u3002 <pre><code>&gt;&gt;&gt; x=1/81\n&gt;&gt;&gt; print('value: %.2f' % x)\nvalue: 0.01\n\n&gt;&gt;&gt; age=22\n&gt;&gt;&gt; name='jacky'\n&gt;&gt;&gt; print('my name is %s, age is %d.' % (name, age))\nmy name is jacky, age is 22.\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%208%20%E7%AB%A0%EF%BC%9A%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA/#_2","title":"\u683c\u5f0f\u5b57\u7b26\u4e32","text":"<p>\u793a\u4f8b\u3002 <pre><code>&gt;&gt;&gt; 'My {pet} has {prob}'.format(pet='dog', prob='fleas')\n'My dog has fleas'\n&gt;&gt;&gt; 'My {0} has {1}'.format('dog','fleas')\n'My dog has fleas'\n\n&gt;&gt;&gt; '1/81 = {x}'.format(x=1/81)\n'1/81 = 0.012345679012345678'\n&gt;&gt;&gt; '1/81 = {x:f}'.format(x=1/81)\n'1/81 = 0.012346'\n&gt;&gt;&gt; '1/81 = {x:.3f}'.format(x=1/81)\n'1/81 = 0.012'\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%208%20%E7%AB%A0%EF%BC%9A%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA/#_3","title":"\u6587\u4ef6\u548c\u6587\u4ef6\u5939","text":"<p>Windows \u4f7f\u7528\u53cd\u659c\u6760 <code>\\</code> \u6765\u5206\u5272\u8def\u5f84\uff0c\u7531\u4e8e\u5728 Python \u4e2d\u53cd\u659c\u6760\u4e3a\u8f6c\u4e49\u5b57\u7b26\uff0c\u6240\u4ee5\u8981\u5728\u5b57\u7b26\u4e32\u4e2d\u5305\u542b <code>\\</code> \u8981\u4f7f\u7528\u4e24\u4e2a\u53cd\u659c\u6760 <code>\\\\</code>\u3002</p> <p>\u5de5\u4f5c\u76ee\u5f55\uff08cwd\uff09\uff0c\u64cd\u4f5c\u6587\u4ef6\u5939\u6216\u8005\u6587\u4ef6\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\u5b8c\u6574\u8def\u5f84\uff0c\u5219 Python \u4f1a\u9ed8\u8ba4\u6307\u7684\u662f\u5f53\u524d\u76ee\u5f55\u7684\u6587\u4ef6\u6216\u8005\u6587\u4ef6\u5939\u3002</p> <p>\u76f8\u5173\u7684\u529f\u80fd\u9700\u8981\u5bfc\u5165 os \u6a21\u5757\u3002</p> <p>\u5e38\u89c1\u7684\u51fd\u6570\u3002 <pre><code>os.getcwd() \u8fd4\u56de\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\u7684\u540d\u79f0 \nos.listdir(p) \u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u5176\u4e2d\u5305\u542b\u8def\u5f84 p \u6307\u5b9a\u7684\u6587\u4ef6\u5939\u4e2d\u6240\u6709\u6587\u4ef6\u548c\u6587\u4ef6\u5939\u7684\u540d\u79f0 \nos.chdir(p) \u5c06\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\u8bbe\u7f6e\u4e3a\u8def\u5f84 p \nos.path.isfile(p) \u5f53\u8def\u5f84 p \u6307\u5b9a\u7684\u662f\u4e00\u4e2a\u6587\u4ef6\u7684\u540d\u79f0\u65f6\uff0c\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False \nos.path.isdir(p) \u5f53\u8def\u5f84 p \u6307\u5b9a\u7684\u662f\u4e00\u4e2a\u6587\u4ef6\u5939\u7684\u540d\u79f0\u65f6\uff0c\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False \nos.stat(fname) \u8fd4\u56de\u6709\u5173 fname \u7684\u4fe1\u606f\uff0c\u5982\u5927\u5c0f\uff08\u5355\u4f4d\u4e3a\u5b57\u8282\uff09\u548c\u6700\u540e\u4e00\u6b21\u4fee\u6539\u65f6\u95f4\n</code></pre></p> <p>\u793a\u4f8b\u3002 <pre><code>&gt;&gt;&gt; os.getcwd()\n'C:\\\\Users\\\\jacky'\n&gt;&gt;&gt; os.listdir(os.getcwd())\n['.android', '.cache', '.config', '.emulator_console_auth_token', '.gitconfig', '.gnupg', '.gradle', '.ideaLibSources', '.lesshst', '.m2']\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%208%20%E7%AB%A0%EF%BC%9A%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA/#_4","title":"\u6587\u4ef6\u6253\u5f00\u6a21\u5f0f","text":"\u5b57\u7b26 \u542b\u4e49 <code>r</code> \u4e3a\u8bfb\u53d6\u6587\u4ef6\u800c\u6253\u5f00\uff0c\u9ed8\u8ba4 <code>w</code> \u4e3a\u5199\u5165\u6587\u4ef6\u800c\u6253\u5f00 <code>a</code> \u4e3a\u5728\u6587\u4ef6\u672b\u5c3e\u8ffd\u52a0\u800c\u6253\u5f00 <code>b</code> \u4e8c\u8fdb\u5236\u6a21\u5f0f <code>t</code> \u6587\u672c\u6a21\u5f0f\uff0c\u9ed8\u8ba4 <code>+</code> \u4e3a\u8bfb\u5199\u6253\u5f00\u6587\u4ef6 ### \u9010\u884c\u8bfb\u53d6\u6587\u672c <p>\u793a\u4f8b\u4ee3\u7801\u3002 <pre><code># my_file.py\n\ndef print_file(file_path):\n    with open(file_path, 'r') as file:\n        for line in file:\n            print(line, end='')\n\ndef main():\n    file_path = input(\"Input file path: \")\n    print_file(file_path)\n\nif __name__ == \"__main__\":\n    main()\n</code></pre></p> <p>\u4e0a\u8ff0\u7a0b\u5e8f\u7684\u6253\u5370\u4ee3\u7801\u53ef\u4ee5\u7b80\u5316\u4e00\u884c\uff0c\u4f46\u662f\u5982\u679c\u6253\u5370\u7684\u6587\u4ef6\u5f88\u5927\u7684\u8bdd\u4f1a\u5360\u7528\u5927\u91cf\u7684\u5185\u5b58\u3002 <pre><code># my_file.py\n\ndef print_file(file_path):\n    print(open(file_path).read())\n\ndef main():\n    file_path = input(\"Input file path: \")\n    print_file(file_path)\n\nif __name__ == \"__main__\":\n    main()\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%208%20%E7%AB%A0%EF%BC%9A%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA/#_5","title":"\u5199\u5165\u6587\u672c\u5230\u6587\u4ef6","text":"<p>\u793a\u4f8b\u4ee3\u7801\u3002 <pre><code># my_file.py\n\ndef print_file(file_path):\n    print(open(file_path, encoding='utf-8').read())\n\n\ndef write_file(file_path):\n    with open(file_path, 'w', encoding='utf-8') as file:\n        while True:\n            line = input('write line input: ')\n            if (line == 'done'):\n                break\n            file.write(line + '\\n')\n\ndef main():\n    file_path = input(\"Input file path: \")\n    write_file(file_path)\n    print_file(file_path)\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre></p> <p>\u8fd0\u884c\u793a\u4f8b\uff0c\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\u4f1a\u521b\u5efa\u6587\u4ef6\u5e76\u4e14\u8986\u76d6\u6587\u4ef6\u7684\u5185\u5bb9\u3002 <pre><code>D:\\suomea-project\\python-learn&gt;python my_file.py\nInput file path: test.txt\nwrite line input: \u4f60\u597d\u4e16\u754c\nwrite line input: hello world\nwrite line input: how are you \nwrite line input: done\n\u4f60\u597d\u4e16\u754c\nhello world\nhow are you\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%208%20%E7%AB%A0%EF%BC%9A%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA/#_6","title":"\u8ffd\u52a0\u6587\u672c\u5230\u6587\u4ef6\u672b\u5c3e","text":"<p>\u793a\u4f8b\u4ee3\u7801\u3002 <pre><code># my_file.py\n\ndef print_file(file_path):\n    print(open(file_path, encoding='utf-8').read())\n\n\ndef write_file(file_path):\n    with open(file_path, 'w', encoding='utf-8') as file:\n        while True:\n            line = input('write line input: ')\n            if (line == 'done'):\n                break\n            file.write(line + '\\n')\n\ndef append_file(file_path):\n    with open(file_path, 'a', encoding='utf-8') as file:\n        while True:\n            line = input('write line input: ')\n            if (line == 'done'):\n                break\n            file.write(line + '\\n')\n\ndef main():\n    file_path = input(\"Input file path: \")\n    append_file(file_path)\n    print_file(file_path)\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre></p> <p>\u8fd0\u884c\u793a\u4f8b\uff0c\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\u4f1a\u521b\u5efa\u6587\u4ef6\u5e76\u4e14\u8986\u76d6\u6587\u4ef6\u7684\u5185\u5bb9\u3002 <pre><code>D:\\suomea-project\\python-learn&gt;python my_file.py\nInput file path: test.txt\nwrite line input: 1\nwrite line input: 2\nwrite line input: 3\nwrite line input: done\n1\n2\n3\n\n\nD:\\suomea-project\\python-learn&gt;python my_file.py\nInput file path: test.txt\nwrite line input: 11\nwrite line input: 22\nwrite line input: 33\nwrite line input: done\n1\n2\n3\n11\n22\n33\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%208%20%E7%AB%A0%EF%BC%9A%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA/#_7","title":"\u5c06\u5b57\u7b26\u63d2\u5165\u5230\u6587\u4ef6\u5f00\u5934","text":"<p>\u793a\u4f8b\u4ee3\u7801\uff0c\u7cfb\u7edf\u6ca1\u6709\u63d0\u4f9b\u76f4\u63a5\u4ece\u6587\u4ef6\u5934\u8ffd\u52a0\u5185\u5bb9\u7684\u51fd\u6570\uff0c\u6240\u4ee5\u5148\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\uff0c\u8fdb\u884c\u62fc\u63a5\uff0c\u4e4b\u540e\u518d\u5199\u5165\u6587\u4ef6\u3002 <pre><code>def insert_title(file_path, title):\n    with open(file_path, 'r+') as file:\n        temp = file.read()\n        temp = title + '\\n\\n' + temp\n        file.seek(0)\n        file.write(temp)\n\ndef main():\n    file_path = input(\"Input file path: \")\n    print_file(file_path)\n    insert_title(file_path, \"Hello World!\")\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre></p>"},{"location":"Python/%E7%AC%AC%209%20%E7%AB%A0%EF%BC%9A%E5%BC%82%E5%B8%B8/","title":"Python","text":"<p>\u793a\u4f8b\u4ee3\u7801\u5c55\u793a\u4e86\u4e09\u79cd\u60c5\u51b5\uff0c\u6355\u83b7\u591a\u79cd\u5f02\u5e38\u3001\u5206\u522b\u6355\u83b7\u5f02\u5e38\u3001\u6355\u83b7\u6240\u6709\u5f02\u5e38\u3002<code>finally</code> \u5757\u7684\u4ee3\u7801\u4e00\u5b9a\u4f1a\u6267\u884c\u3002 <pre><code>def convert_to_int1(s, base):\n    try:\n        return int(s, base)\n    except(ValueError, TypeError):\n        return \"error\"\n\ndef convert_to_int2(s, base):\n    try:\n        return int(s, base)\n    except ValueError:\n        return 'value error'\n    except TypeError:\n        return 'type error'\n\ndef convert_to_int3(s, base):\n    try: \n        return int(2, base)\n    except:\n        return 'error'\n    finally:\n        print(\"finally...\")\n</code></pre></p>"},{"location":"ThreeMountains/Algorithms/Base64%20%E7%AE%97%E6%B3%95/","title":"Base64 \u7b97\u6cd5","text":"<p>Base64 \u7b97\u6cd5\u6700\u65e9\u5e94\u7528\u4e8e\u7535\u5b50\u90ae\u4ef6\u4f20\u8f93\u95ee\u9898\u3002\u65e9\u671f\u7531\u4e8e\u5386\u53f2\u95ee\u9898\uff0c\u7535\u5b50\u90ae\u4ef6\u53ea\u5141\u8bb8 ASCII \u5b57\u7b26\u7801\u3002\u5982\u679c\u8981\u4f20\u8f93\u4e00\u5c01\u5e26\u6709\u975e ACSII \u5b57\u7b26\u7801\u7684\u7535\u5b50\u90ae\u4ef6\uff0c \u65e9\u671f\u7684\u5386\u53f2\u95ee\u9898\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e71\u7801\uff0c\u4e8e\u662f Base64\u2014\u2014\u4e00\u79cd\u80fd\u591f\u5c06\u4e8c\u8fdb\u5236\u6570\u636e\u8f6c\u6362\u4e3a ASCII \u5b57\u7b26\u7801\u7684\u7b97\u6cd5\u5e94\u8fd0\u800c\u751f\u3002</p>"},{"location":"ThreeMountains/Algorithms/Base64%20%E7%AE%97%E6%B3%95/#base64","title":"Base64 \u5b57\u7b26\u8f6c\u6362\u8868","text":"<p>Base64 \u7b97\u6cd5\u80fd\u591f\u5c06\u4e8c\u8fdb\u5236\u7684\u6570\u636e\u8f6c\u6362\u4e3a 64 \u4e2a ACSII \u5b57\u7b26\uff08\u52a0\u4e0a\u586b\u5145\u5b57\u7b26 '=' \u5171 65 \u4e2a\uff09\uff0c \u53c2\u8003RFC 4648 \u3002 <pre><code>+------+--------+------+-------+--------+------+-------+--------+------+-------+--------+------+\n|Index | Binary | Char | Index | Binary | Char | Index | Binary | Char | Index | Binary | Char |\n|------+--------+------+-------+--------+------+-------+--------+------+-------+--------+------|\n|0     | 000000 | A    | 16    | 010000 | Q    | 32    | 100000 | g    | 48    | 110000 | w    |\n|1     | 000001 | B    | 17    | 010001 | R    | 33    | 100001 | h    | 49    | 110001 | x    |\n|2     | 000010 | C    | 18    | 010010 | S    | 34    | 100010 | i    | 50    | 110010 | y    |\n|3     | 000011 | D    | 19    | 010011 | T    | 35    | 100011 | j    | 51    | 110011 | z    |\n|4     | 000100 | E    | 20    | 010100 | U    | 36    | 100100 | k    | 52    | 110100 | 0    |\n|5     | 000101 | F    | 21    | 010101 | V    | 37    | 100101 | l    | 53    | 110101 | 1    |\n|6     | 000110 | G    | 22    | 010110 | W    | 38    | 100110 | m    | 54    | 110110 | 2    |\n|7     | 000111 | H    | 23    | 010111 | X    | 39    | 100111 | n    | 55    | 110111 | 3    |\n|8     | 001000 | I    | 24    | 011000 | Y    | 40    | 101000 | o    | 56    | 111000 | 4    |\n|9     | 001001 | J    | 25    | 011001 | Z    | 41    | 101001 | p    | 57    | 111001 | 5    |\n|10    | 001010 | K    | 26    | 011010 | a    | 42    | 101010 | q    | 58    | 111010 | 6    |\n|11    | 001011 | L    | 27    | 011011 | b    | 43    | 101011 | r    | 59    | 111011 | 7    |\n|12    | 001100 | M    | 28    | 011100 | c    | 44    | 101100 | s    | 60    | 111100 | 8    |\n|13    | 001101 | N    | 29    | 011101 | d    | 45    | 101101 | t    | 61    | 111101 | 9    |\n|14    | 001110 | O    | 30    | 011110 | e    | 46    | 101110 | u    | 62    | 111110 | +    |\n|15    | 001111 | P    | 31    | 011111 | f    | 47    | 101111 | v    | 63    | 111111 | /    |\n+------+--------+------+-------+--------+------+-------+--------+------+-------+--------+------+\nPadding (=)\n</code></pre></p>"},{"location":"ThreeMountains/Algorithms/Base64%20%E7%AE%97%E6%B3%95/#_1","title":"\u8f6c\u6362\u89c4\u5219","text":"<ol> <li> <p>\u83b7\u5f97\u5b57\u7b26\u4e32\u7684\u4e8c\u8fdb\u5236\u7f16\u7801\u3002</p> </li> <li> <p>\u5c06\u4e8c\u8fdb\u5236\u7f16\u7801\u8fdb\u884c\u5206\u7ec4\uff0c\u6bcf 24 \u4f4d\u4e3a\u4e00\u6bb5\uff0c\u6bcf\u6bb5\u518d\u5206\u4e3a 6 \u4f4d\u4e00\u7ec4\uff08\u4e0d\u591f 6 \u4f4d\u7684\u5730\u4f4d\u8865 0\uff0c\u6ca1\u6709\u4f4d\u7684\u7ec4\uff0c\u7ed3\u679c\u4e2d\u4f7f\u7528\u586b\u5145\u5b57\u7b26 '='\uff09\u3002</p> </li> <li> <p>\u5411\u6bcf\u7ec4\u7684\u9ad8\u4e24\u4f4d\u8865 0 \u7ec4\u6210 8 \u4f4d\u3002</p> </li> <li> <p>\u5c06\u83b7\u5f97\u7684 4 \u7ec4\u4e8c\u8fdb\u5236\u7801\u8f6c\u6362\u4e3a 10 \u8fdb\u5236\u3002</p> </li> <li> <p>\u5c06\u83b7\u5f97\u7684\u5341\u8fdb\u5236\u7801\u53c2\u7167 Base64 \u5b57\u7b26\u5bf9\u7167\u8868\u8f6c\u6362\u6210\u5bf9\u5e94\u7684\u5b57\u7b26\u3002</p> </li> </ol> <p>\u793a\u4f8b 1. \u5b57\u7b26\u4e32\u4e8c\u8fdb\u5236\u4f4d\u6570\u521a\u597d\u4e3a 24 \u7684\u6574\u6570\u500d \"yes\" <pre><code>1) \u5bf9\u5e94\u7684\u5b57\u8282\u6570\u7ec4\u4e3a {121, 101, 115} \u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\uff1a01111001 01100101 01110011\n\n2) \u5206\u6210 6 \u4f4d\u4e00\u7ec4\uff1a011110 010110 010101 110011\n\n3) \u9ad8\u4f4d\u8865 0\uff1a00011110 00010110 00010101 00110011\n\n4) \u5bf9\u5e94\u7684\u5341\u8fdb\u5236\uff1a30 22 21 51\n\n5) \u7ed3\u679c\uff1aeWVz\n</code></pre></p> <p>\u793a\u4f8b 2. \u5b57\u7b26\u4e32\u4e8c\u8fdb\u5236\u4f4d\u6570\u4e0d\u4e3a 24 \u7684\u6574\u6570\u500d \"y\" <pre><code>1) \u5bf9\u5e94\u7684\u5b57\u8282\u6570\u7ec4\u4e3a {121} \u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\uff1a01111001\n\n2) \u5206\u6210 6 \u4f4d\u4e00\u7ec4\uff0c\u4e0d\u591f\u7684\u4f4d\u8865 0\uff1a011110 010000\n\n3) \u9ad8\u4f4d\u8865 0\uff1a00011110 00010000 padding padding\n\n4) \u5bf9\u5e94\u7684\u5341\u8fdb\u5236\uff1a30 8 padding padding\n\n5) \u7ed3\u679c\uff1aeQ==\n</code></pre></p> <p>\u4e00\u822c Base64 \u7ed3\u679c\u7684\u5b57\u7b26\u4e32\u6700\u591a\u4f1a\u6709\u4e24\u4e2a\u586b\u5145\u5b57\u7b26\uff0c\u56e0\u4e3a\u6570\u636e\u7684\u4e8c\u8fdb\u5236\u901a\u5e38\u7801\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff088bit\uff09\u5b58\u50a8\uff0c\u4fdd\u8bc1\u81f3\u5c11\u4f1a\u6709\u4e24\u4e2a\u7ec4\uff086bit\uff09\u3002</p>"},{"location":"ThreeMountains/Algorithms/Base64%20%E7%AE%97%E6%B3%95/#urlbase64","title":"UrlBase64 \u7b97\u6cd5","text":"<p>UrlBase64 \u7b97\u6cd5\u4e3b\u8981\u662f\u66ff\u6362\u4e86 Base64 \u5b57\u7b26\u6620\u5c04\u8868\u4e2d\u7684\u7b2c 62 \u548c 63 \u4e2a\u5b57\u7b26\uff0c\u4e5f\u5c31\u662f\u5c06 <code>+</code> \u548c <code>/</code> \u66ff\u6362\u6210 <code>-</code> \u548c <code>_</code> \u3002</p>"},{"location":"ThreeMountains/Algorithms/Base64%20%E7%AE%97%E6%B3%95/#_2","title":"\u793a\u4f8b\u4ee3\u7801","text":"<pre><code>public class Test {\n    public static void main(String[] args) {\n        byte[] data  = \"\u4f60\u597d\u4e16\u754c\uff01@#\uffe5%\u2026\u2026&amp;*\uff08\uff09\".getBytes(StandardCharsets.UTF_8);\n\n        Base64.getEncoder().encodeToString(data);\n\n        Base64.getEncoder().withoutPadding().encodeToString(data);\n\n        Base64.getUrlEncoder().encodeToString(data);\n\n        Base64.getUrlEncoder().withoutPadding().encodeToString(data);\n    }\n}\n</code></pre>"},{"location":"ThreeMountains/Algorithms/Base64%20%E7%AE%97%E6%B3%95/#linux-base64","title":"Linux base64 \u547d\u4ee4","text":"<p>base64 \u7f16\u7801\uff1a <pre><code>echo -n yes | base64\neWVz\n</code></pre></p> <p>base64 \u89e3\u7801\uff1a <pre><code>echo -n eWVz | base64 -d\nyes\n</code></pre></p>"},{"location":"ThreeMountains/Algorithms/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E5%9B%BE/","title":"\u6570\u636e\u7ed3\u6784\uff1a\u56fe","text":""},{"location":"ThreeMountains/Algorithms/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E5%9B%BE/#_1","title":"\u56fe\u7684\u8868\u793a","text":"<p>\u9876\u70b9\u53ef\u4ee5\u4f7f\u7528\u57fa\u672c\u6574\u5f62\u8868\u793a\uff0c\u5171\u6709 6 \u4e2a\u9876\u70b9 {1, 2, 3, 4, 5, 6}\u3002</p> <p>\u8fb9\u6709\u4e24\u79cd\u8868\u793a\u65b9\u6cd5</p> <p>\u90bb\u63a5\u8868\uff0c\u6bcf\u4e2a\u5355\u72ec\u7684\u94fe\u8868\u8868\u793a\u4e86\u6709\u54ea\u4e9b\u9876\u70b9\u4e0e\u5f53\u524d\u9876\u70b9\u90bb\u63a5\u3002</p> \u9876\u70b9 \u5305\u542b\u90bb\u63a5\u9876\u70b9\u7684\u94fe\u8868 1 2-&gt;4 2 1-&gt;3-&gt;4-&gt;5-&gt;6 3 2-&gt;6 4 1-&gt;2-&gt;5 5 2-&gt;4-&gt;6 6 2-&gt;3-&gt;5 <p>\u90bb\u63a5\u77e9\u9635\uff0c\u662f\u4e00\u4e2a\u4e8c\u7ef4\u6570\u7ec4\uff0c\u6570\u636e\u9879\u8868\u793a\u4e24\u70b9\u95f4\u662f\u5426\u5b58\u5728\u8fb9\u3002\u5982\u679c\u6709 N \u4e2a\u9876\u70b9\uff0c\u90bb\u63a5\u77e9\u9635\u5c31\u662f <code>N*N</code> \u7684\u6570\u7ec4\u3002</p> 1 2 3 4 5 6 1 0 1 0 1 0 0 2 1 0 1 1 1 1 3 0 1 0 0 0 1 4 1 1 0 0 1 0 5 0 1 0 1 0 1 6 0 1 1 0 1 0"},{"location":"ThreeMountains/Algorithms/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E5%9B%BE/#_2","title":"\u90bb\u63a5\u8868","text":"<p>\u9876\u70b9\u7684\u8868\u793a\u3002 <pre><code>public class Vertex {  \n\n    private String  label;  \n\n    public Vertex(String label) {  \n        this.label = label;  \n    }  \n\n    // ... \u7701\u7565 getter\u3001setter\u3001equals \u548c hashcode \u65b9\u6cd5\n}\n</code></pre></p> <p>\u56fe\u7684\u8868\u793a\u3002 <pre><code>public class Graph {  \n\n    private List&lt;Vertex&gt; vertices;  \n    private Map&lt;Vertex, List&lt;Vertex&gt;&gt; edges;  \n\n    public Graph() {  \n        vertices = new ArrayList&lt;&gt;();  \n        edges = new HashMap&lt;&gt;();  \n    }  \n\n    // ... \u7701\u7565 getter \u548c setter \u65b9\u6cd5\n\n    // \u6dfb\u52a0\u9876\u70b9\n    public void addVertex(Vertex vertex) {  \n        vertices.add(vertex);  \n        edges.putIfAbsent(vertex, new LinkedList&lt;&gt;());  \n    }  \n\n    // \u6dfb\u52a0\u8fb9\n    public void addEdge(Vertex src, Vertex dst) {  \n        edges.get(src).add(dst);  \n        edges.get(dst).add(src);  \n    }  \n\n    // \u6253\u5370\u90bb\u63a5\u8868\n    public void show() {  \n        edges.entrySet().forEach(item -&gt; {  \n            System.out.println(item.getKey().getLabel() + \" -&gt; \" + item.getValue().stream().map(Vertex::getLabel).collect(Collectors.joining(\",\")));  \n        });  \n    }  \n\n}\n</code></pre></p> <p>\u56fe\u7684\u521b\u5efa\u548c\u5c55\u793a\u3002 <pre><code>public class Main {  \n    public static void main(String[] args) {  \n        Graph graph = new Graph();  \n\n        Vertex v1 = new Vertex(\"1\");  \n        Vertex v2 = new Vertex(\"2\");  \n        Vertex v3 = new Vertex(\"3\");  \n        Vertex v4 = new Vertex(\"4\");  \n        Vertex v5 = new Vertex(\"5\");  \n        Vertex v6 = new Vertex(\"6\");  \n        Vertex v7 = new Vertex(\"7\");  \n        Vertex v8 = new Vertex(\"8\");  \n        Vertex v9 = new Vertex(\"9\");  \n        Vertex v10 = new Vertex(\"10\");  \n\n        graph.addVertex(v1);  \n        graph.addVertex(v2);  \n        graph.addVertex(v3);  \n        graph.addVertex(v4);  \n        graph.addVertex(v5);  \n        graph.addVertex(v6);  \n        graph.addVertex(v7);  \n        graph.addVertex(v8);  \n        graph.addVertex(v9);  \n        graph.addVertex(v10);  \n\n        graph.addEdge(v1, v2);  \n        graph.addEdge(v1, v4);  \n        graph.addEdge(v1, v6);  \n        graph.addEdge(v2, v3);  \n        graph.addEdge(v4, v3);  \n        graph.addEdge(v4, v5);  \n        graph.addEdge(v4, v7);  \n        graph.addEdge(v6, v7);  \n        graph.addEdge(v8, v7);  \n        graph.addEdge(v9, v7);  \n        graph.addEdge(v8, v10);  \n\n        System.out.println(\"\u90bb\u63a5\u8868\u8868\u793a\u56fe\u7684\u8f93\u51fa-----------------------\");  \n        graph.show();  \n}\n</code></pre></p>"},{"location":"ThreeMountains/Algorithms/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E5%9B%BE/#_3","title":"\u56fe\u7684\u904d\u5386","text":""},{"location":"ThreeMountains/Algorithms/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E5%9B%BE/#_4","title":"\u6df1\u5ea6\u4f18\u5148\u904d\u5386","text":"<pre><code>public class Main {  \n    public static void main(String[] args) {  \n        // \u2026\u2026 \u5ffd\u7565\u90e8\u5206\u4ee3\u7801\n        System.out.println(\"\u90bb\u63a5\u8868\u8868\u793a\u56fe\u7684\u6df1\u5ea6\u4f18\u5148\u904d\u5386\uff0c\u4f7f\u7528\u9012\u5f52\u5b9e\u73b0-----------------------\");  \n        visited.clear();  \n        deepFirstSearchRecursive(graph, v1);  \n\n        System.out.println(\"\u90bb\u63a5\u8868\u8868\u793a\u56fe\u7684\u6df1\u5ea6\u4f18\u5148\u904d\u5386\uff0c\u4f7f\u7528\u5faa\u73af\u548c\u6808\u5b9e\u73b0-----------------------\");  \n        visited.clear();  \n        deepFirstSearchStack(graph, v1);  \n    }  \n\n    // \u4fdd\u5b58\u8bbf\u95ee\u8fc7\u7684\u9876\u70b9  \n    private static Set&lt;Vertex&gt; visited = new HashSet&lt;&gt;();  \n\n    // \u4f7f\u7528\u9012\u5f52\u8fdb\u884c\u904d\u5386  \n    public static void deepFirstSearchRecursive(Graph graph, Vertex vertex) {  \n        if (!visited.contains(visited)) {  \n            System.out.println(\"Visited vertex: \" + vertex.getLabel());  \n            visited.add(vertex);  \n        }  \n\n        for (Vertex v : graph.getEdges().get(vertex)) {  \n            if (!visited.contains(v)) {  \n                deepFirstSearchRecursive(graph, v);  \n            }  \n        }  \n    }  \n\n    // \u4f7f\u7528\u6808\u8fdb\u884c\u904d\u5386  \n    public static void deepFirstSearchStack(Graph graph, Vertex startVertex) {  \n        Stack&lt;Vertex&gt; stack = new Stack&lt;&gt;();  \n        stack.push(startVertex);  \n\n        while (!stack.isEmpty()) {  \n            Vertex currentVertex = stack.pop();  \n\n            if (!visited.contains(currentVertex)) {  \n                System.out.println(\"Visited vertex: \" + currentVertex.getLabel());  \n                visited.add(currentVertex);  \n\n                for (Vertex v : graph.getEdges().get(currentVertex)) {  \n                    if (!visited.contains(v)) {  \n                        stack.push(v);  \n                    }  \n                }  \n            }  \n        }  \n    }  \n}\n</code></pre> <p>\u4f7f\u7528\u4e24\u79cd\u65b9\u6cd5\u904d\u5386\uff0c\u9012\u5f52\u548c\u89e3\u9012\u5f52\u3002</p> <p>\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u4f7f\u7528\u9012\u5f52\uff0c\u548c\u4e8c\u53c9\u6811\u5148\u5e8f\u904d\u5386\u7684\u9012\u5f52\u601d\u8def\u57fa\u672c\u4e00\u81f4\u3002</p> <p>\u89e3\u9012\u5f52\u4f7f\u7528\u6808\u6765\u5b9e\u73b0\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u961f\u5217\u6765\u5b9e\u73b0\u3002\u5f53\u7136\u4e24\u79cd\u904d\u5386\u7684\u65b9\u5f0f\u53ef\u80fd\u8f93\u51fa\u7684\u7ed3\u679c\u5e76\u4e0d\u4e00\u81f4\uff08\u53d6\u51b3\u4e8e\u56fe\u7684\u7ed3\u6784\uff09\uff0c\u4f46\u662f\u4e24\u79cd\u904d\u5386\u65b9\u5f0f\u90fd\u9075\u5faa\u6df1\u5ea6\u4f18\u5148\u7684\u601d\u60f3\u3002</p>"},{"location":"ThreeMountains/Algorithms/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E5%9B%BE/#_5","title":"\u56fe\u7684\u5e7f\u5ea6\u4f18\u5148\u904d\u5386","text":"<pre><code>public class Main {  \n    public static void main(String[] args) {  \n        // \u2026\u2026 \u5ffd\u7565\u90e8\u5206\u4ee3\u7801\n        System.out.println(\"\u90bb\u63a5\u8868\u8868\u793a\u56fe\u7684\u5e7f\u5ea6\u4f18\u5148\u904d\u5386\uff0c\u4f7f\u7528\u5faa\u73af\u548c\u961f\u5217\u5b9e\u73b0-----------------------\");  \n        visited.clear();  \n        breadthFirstSearch(graph ,v1);\n    }  \n\n    // \u4fdd\u5b58\u8bbf\u95ee\u8fc7\u7684\u9876\u70b9  \n    private static Set&lt;Vertex&gt; visited = new HashSet&lt;&gt;();  \n\n    // \u4f7f\u7528\u961f\u5217\u8fdb\u884c\u5e7f\u5ea6\u4f18\u5148\u904d\u5386  \n    public static void breadthFirstSearch(Graph graph, Vertex startVertex) {  \n        Queue&lt;Vertex&gt; queue = new LinkedList&lt;&gt;();  \n        queue.add(startVertex);  \n\n        while (!queue.isEmpty()) {  \n            Vertex currentVertex = queue.poll();  \n\n            if (!visited.contains(currentVertex)) {  \n                System.out.println(\"Visited vertex: \" + currentVertex.getLabel());  \n                visited.add(currentVertex);  \n\n                for (Vertex v : graph.getEdges().get(currentVertex)) {  \n                    if (!visited.contains(v)) {  \n                        queue.add(v);  \n                    }  \n                }  \n            }  \n        }  \n    }\n}\n</code></pre> <p>\u9700\u8981\u4f7f\u7528\u961f\u5217\u8fdb\u884c\u5e7f\u5ea6\u4f18\u5148\u904d\u5386\u3002</p>"},{"location":"ThreeMountains/Algorithms/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E5%9B%BE/#_6","title":"\u5e26\u6743\u56fe","text":"<p>\u589e\u52a0\u8fb9\u7c7b\u3002 <pre><code>public class Edge {  \n\n    private Vertex dst;  \n\n    private Integer weight;  \n\n    public Edge(Vertex dst, Integer weight) {  \n        this.dst = dst;  \n        this.weight = weight;  \n    }  \n\n    // ...\n}\n</code></pre></p> <p>\u9876\u70b9\u7c7b\u3002 <pre><code>  public class Vertex {  \n\n    private String  label;  \n\n    public Vertex(String label) {  \n        this.label = label;  \n    }  \n\n    public String getLabel() {  \n        return label;  \n    }  \n\n    public void setLabel(String label) {  \n        this.label = label;  \n    }  \n\n    @Override  \n    public boolean equals(Object o) {  \n        if (this == o) return true;  \n        if (o == null || getClass() != o.getClass()) return false;  \n        Vertex vertex = (Vertex) o;  \n        return Objects.equals(label, vertex.label);  \n    }  \n\n    @Override  \n    public int hashCode() {  \n        return Objects.hash(label);  \n    }  \n}\n</code></pre></p> <p>\u56fe\u7c7b\u3002 <pre><code>public class Graph {  \n\n    private List&lt;Vertex&gt; vertices;  \n    private Map&lt;Vertex, List&lt;Edge&gt;&gt; edges;  \n\n    public Graph() {  \n        vertices = new ArrayList&lt;&gt;();  \n        edges = new HashMap&lt;&gt;();  \n    }  \n\n    // ...\n\n    public void addVertex(Vertex vertex) {  \n        vertices.add(vertex);  \n        edges.putIfAbsent(vertex, new LinkedList&lt;&gt;());  \n    }  \n\n    public void addEdge(Vertex src, Vertex dst, int w) {  \n        edges.get(src).add(new Edge(dst, w));  \n        edges.get(dst).add(new Edge(src, w));  \n    }  \n\n    public void show() {  \n        edges.entrySet().forEach(item -&gt; {  \n            System.out.println(item.getKey().getLabel() + \" -&gt; \" + item.getValue().stream().map(edge -&gt; edge.getDst().getLabel() + \"/\" + edge.getWeight()).collect(Collectors.joining(\",\")));  \n        });  \n    }  \n\n}\n</code></pre></p> <p>\u521d\u59cb\u5316\u56fe\u53ca\u904d\u5386\u3002 <pre><code>public class Main {  \n    public static void main(String[] args) {  \n\n        Graph graph = new Graph();  \n\n        Vertex va = new Vertex(\"A\");  \n        Vertex vb = new Vertex(\"B\");  \n        Vertex vc = new Vertex(\"C\");  \n        Vertex vd = new Vertex(\"D\");  \n        Vertex ve = new Vertex(\"E\");  \n        Vertex vf = new Vertex(\"F\");  \n        Vertex vg = new Vertex(\"G\");  \n\n\n        graph.addVertex(va);  \n        graph.addVertex(vb);  \n        graph.addVertex(vc);  \n        graph.addVertex(vd);  \n        graph.addVertex(ve);  \n        graph.addVertex(vf);  \n        graph.addVertex(vg);  \n\n        graph.addEdge(va, vb, 1);  \n        graph.addEdge(va, vc, 5);  \n        graph.addEdge(va, vd, 10);  \n        graph.addEdge(vb, ve, 3);  \n        graph.addEdge(vc, ve, 100);  \n        graph.addEdge(vc, vf, 500);  \n        graph.addEdge(vd, vg, 1);  \n        graph.addEdge(ve, vg, 200);  \n        graph.addEdge(vf, vg, 1);  \n\n        System.out.println(\"\u90bb\u63a5\u8868\u8868\u793a\u56fe\u7684\u8f93\u51fa-----------------------\");  \n        graph.show();  \n\n        // -----------------------------  \n        System.out.println(\"\u90bb\u63a5\u8868\u8868\u793a\u56fe\u7684\u6df1\u5ea6\u4f18\u5148\u904d\u5386\uff0c\u4f7f\u7528\u9012\u5f52\u5b9e\u73b0-----------------------\");  \n        visited.clear();  \n        deepFirstSearchRecursive(graph, va);  \n\n        System.out.println(\"\u90bb\u63a5\u8868\u8868\u793a\u56fe\u7684\u6df1\u5ea6\u4f18\u5148\u904d\u5386\uff0c\u4f7f\u7528\u5faa\u73af\u548c\u6808\u5b9e\u73b0-----------------------\");  \n        visited.clear();  \n        deepFirstSearchStack(graph, va);  \n\n        System.out.println(\"\u90bb\u63a5\u8868\u8868\u793a\u56fe\u7684\u5e7f\u5ea6\u4f18\u5148\u904d\u5386\uff0c\u4f7f\u7528\u5faa\u73af\u548c\u961f\u5217\u5b9e\u73b0-----------------------\");  \n        visited.clear();  \n        breadthFirstSearch(graph ,va);  \n    }  \n\n    // \u4fdd\u5b58\u8bbf\u95ee\u8fc7\u7684\u9876\u70b9  \n    private static Set&lt;Vertex&gt; visited = new HashSet&lt;&gt;();  \n\n    // \u4f7f\u7528\u9012\u5f52\u8fdb\u884c\u904d\u5386  \n    public static void deepFirstSearchRecursive(Graph graph, Vertex vertex) {  \n        if (!visited.contains(visited)) {  \n            System.out.println(\"Visited vertex: \" + vertex.getLabel());  \n            visited.add(vertex);  \n        }  \n\n        for (Edge edge : graph.getEdges().get(vertex)) {  \n            if (!visited.contains(edge.getDst())) {  \n                deepFirstSearchRecursive(graph, edge.getDst());  \n            }  \n        }  \n    }  \n\n    // \u4f7f\u7528\u6808\u8fdb\u884c\u904d\u5386  \n    public static void deepFirstSearchStack(Graph graph, Vertex startVertex) {  \n        Stack&lt;Vertex&gt; stack = new Stack&lt;&gt;();  \n        stack.push(startVertex);  \n\n        while (!stack.isEmpty()) {  \n            Vertex currentVertex = stack.pop();  \n\n            if (!visited.contains(currentVertex)) {  \n                System.out.println(\"Visited vertex: \" + currentVertex.getLabel());  \n                visited.add(currentVertex);  \n\n                for (Edge edge : graph.getEdges().get(currentVertex)) {  \n                    if (!visited.contains(edge.getDst())) {  \n                        stack.push(edge.getDst());  \n                    }  \n                }  \n            }  \n        }  \n    }  \n\n    // \u4f7f\u7528\u961f\u5217\u8fdb\u884c\u5e7f\u5ea6\u4f18\u5148\u904d\u5386  \n    public static void breadthFirstSearch(Graph graph, Vertex startVertex) {  \n        Queue&lt;Vertex&gt; queue = new LinkedList&lt;&gt;();  \n        queue.add(startVertex);  \n\n        while (!queue.isEmpty()) {  \n            Vertex currentVertex = queue.poll();  \n\n            if (!visited.contains(currentVertex)) {  \n                System.out.println(\"Visited vertex: \" + currentVertex.getLabel());  \n                visited.add(currentVertex);  \n\n                for (Edge edge : graph.getEdges().get(currentVertex)) {  \n                    if (!visited.contains(edge.getDst())) {  \n                        queue.add(edge.getDst());  \n                    }  \n                }  \n            }  \n        }  \n    }    \n}\n</code></pre></p>"},{"location":"ThreeMountains/Algorithms/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E5%9B%BE/#_7","title":"\u6700\u77ed\u8def\u5f84\u7b97\u6cd5","text":""},{"location":"ThreeMountains/Algorithms/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E5%9B%BE/#java","title":"Java \u4f18\u5148\u53ca\u961f\u5217\u7684\u4f7f\u7528","text":"<pre><code>public class PriorityQueueTest {  \n\n    public static void main(String[] args) {  \n        PriorityQueue&lt;Integer&gt; queue = new PriorityQueue&lt;&gt;();  \n\n\n        queue.add(5);  \n        queue.add(4);  \n        queue.add(100);  \n        queue.add(2);  \n        queue.add(2002);  \n        queue.add(3);  \n        queue.add(72);  \n        queue.add(23);  \n\n        while (!queue.isEmpty()) {  \n            System.out.println(queue.poll());  \n        }  \n        //2\n        //3\n        //4\n        //5\n        //23\n        //72\n        //100\n        //2002\n    }  \n}\n</code></pre>"},{"location":"ThreeMountains/Algorithms/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E5%9B%BE/#dijkstra","title":"Dijkstra \u6700\u77ed\u8def\u5f84\u7b97\u6cd5","text":"<p>Dijkstra \u7b97\u6cd5\u7684\u6838\u5fc3\u601d\u60f3\u662f\u6c38\u8fdc\u6cbf\u7740\u6700\u77ed\u7684\u8def\u5f84\u8d70\uff0c\u76f4\u5230\u904d\u5386\u5b8c\u6240\u6709\u7684\u9876\u70b9\u3002</p> <p>Dijkstra \u7b97\u6cd5\u4f1a\u7ed9\u51fa\u8d77\u59cb\u9876\u70b9\u5230\u6240\u6709\u9876\u70b9\u7684\u6700\u77ed\u8def\u5f84\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f Dijkstra \u7b97\u6cd5\u4e0d\u80fd\u5904\u7406\u56fe\u4e2d\u6709\u8fb9\u7684\u6743\u91cd\u4e3a\u8d1f\u6570\u7684\u60c5\u51b5\u3002</p> <p>\u4ee5\u4e0a\u56fe\u4e3a\u4f8b\uff0c\u4ece\u9876\u70b9 A \u51fa\u53d1\u83b7\u53d6\u5230\u9876\u70b9 G \u7684\u6700\u77ed\u8def\u5f84\u3002</p> <p>\u9700\u8981\u51c6\u5907\u4e00\u5f20\u8868\uff0c\u8bb0\u5f55\u4ece\u9876\u70b9 A \u5230\u5404\u4e2a\u9876\u70b9\u7684\u6700\u77ed\u8def\u5f84\u3002</p> \u9876\u70b9 \u662f\u5426\u5df2\u7ecf\u627e\u5230\u6700\u77ed\u8def\u5f84 \u4ee3\u4ef7 \u524d\u7f6e\u9876\u70b9 B N/A N/A N/A C N/A N/A N/A D N/A N/A N/A E N/A N/A N/A F N/A N/A N/A G N/A N/A N/A <p>\u9996\u5148\u8bbf\u95ee\u9876\u70b9 A\uff0c\u5f97\u5230\u4ece A \u5230 B\u3001C\u3001D \u9876\u70b9\u7684\u4ee3\u4ef7\uff0c\u66f4\u65b0\u8868\u683c\u3002</p> \u9876\u70b9 \u662f\u5426\u5df2\u7ecf\u627e\u5230\u6700\u77ed\u8def\u5f84 \u4ee3\u4ef7 \u524d\u7f6e\u9876\u70b9 B N/A 1 A C N/A 5 A D N/A 10 A E N/A N/A N/A F N/A N/A N/A G N/A N/A N/A <p>\u627e\u5230\u8868\u683c\u4e2d\u4ee3\u4ef7\u6700\u5c0f\u7684\u9879\uff0c\u5373 A \u5230 B \u7684\u6700\u77ed\u8def\u5f84\u5df2\u7ecf\u786e\u5b9a\u3002\u56e0\u4e3a\u5982\u679c\u8d70\u5176\u5b83\u8def\u5f84\u52bf\u5fc5\u7ecf\u8fc7 C\u3001D\uff0c\u4f46\u662f\u5b83\u4eec\u90fd\u4e0d\u662f\u8868\u683c\u4e2d\u7684\u6700\u5c0f\u9879\uff08Dijkstra \u7b97\u6cd5\u4e0d\u80fd\u5904\u7406\u56fe\u4e2d\u6709\u8fb9\u7684\u6743\u91cd\u4e3a\u8d1f\u6570\u7684\u60c5\u51b5\uff09\u3002\u66f4\u65b0\u8868\u683c\u3002</p> \u9876\u70b9 \u662f\u5426\u5df2\u7ecf\u627e\u5230\u6700\u77ed\u8def\u5f84 \u4ee3\u4ef7 \u524d\u7f6e\u9876\u70b9 B \u662f 1 A C N/A 5 A D N/A 10 A E N/A N/A N/A F N/A N/A N/A G N/A N/A N/A <p>\u7136\u540e\u8bbf\u95ee B\uff0c\u5f97\u5230\u4ece A \u5230 E \u7684\u8ddd\u79bb\uff0c\u66f4\u65b0\u8868\u683c\u3002</p> \u9876\u70b9 \u662f\u5426\u5df2\u7ecf\u627e\u5230\u6700\u77ed\u8def\u5f84 \u4ee3\u4ef7 \u524d\u7f6e\u9876\u70b9 B \u662f 1 A C N/A 5 A D N/A 10 A E N/A 4 B F N/A N/A N/A G N/A N/A N/A <p>\u627e\u5230\u8868\u683c\u4e2d\u4ee3\u4ef7\u6700\u5c0f\u9879\uff08\u5ffd\u7565\u5df2\u7ecf\u8bbf\u95ee\u8fc7\u7684\u9876\u70b9\uff09\uff0c\u5373 A \u5230 E \u7684\u6700\u77ed\u8def\u5f84\u5df2\u7ecf\u786e\u5b9a\u3002\u56e0\u4e3a\u5982\u679c\u8d70\u5176\u5b83\u8def\u5f84\u4e5f\u80fd\u5230\u8fbe E \u7684\u8bdd\uff0c\u90a3\u4e48 E \u4e0d\u4f1a\u662f\u8868\u683c\u4e2d\u7684\u6700\u5c0f\u9879\u3002\u66f4\u65b0\u8868\u683c\u3002</p> \u9876\u70b9 \u662f\u5426\u5df2\u7ecf\u627e\u5230\u6700\u77ed\u8def\u5f84 \u4ee3\u4ef7 \u524d\u7f6e\u9876\u70b9 B \u662f 1 A C N/A 5 A D N/A 10 A E \u662f 4 B F N/A N/A N/A G N/A N/A N/A <p>\u7136\u540e\u8bbf\u95ee E\uff0c\u5f97\u5230\u4ece A \u5230 C \u548c G \u7684\u8ddd\u79bb\u3002\u5982\u679c A \u7ecf E \u5230 C \u5219\u4ee3\u4ef7\u4e3a 104 \u5927\u4e8e\u4ece A \u76f4\u63a5\u5230 C\uff0c\u4e0d\u66f4\u65b0\u8868\u683c\uff1b\u5982\u679c\u7ecf E \u5230 G\uff0c\u5219\u4ee3\u4ef7\u4e3a 204\uff0c\u66f4\u65b0\u8868\u683c\u3002</p> \u9876\u70b9 \u662f\u5426\u5df2\u7ecf\u627e\u5230\u6700\u77ed\u8def\u5f84 \u4ee3\u4ef7 \u524d\u7f6e\u9876\u70b9 B \u662f 1 A C N/A 5 A D N/A 10 A E \u662f 4 B F N/A N/A N/A G N/A 204 E <p>\u627e\u5230\u8868\u683c\u4e2d\u4ee3\u4ef7\u6700\u5c0f\u9879\uff08\u5ffd\u7565\u5df2\u7ecf\u8bbf\u95ee\u8fc7\u7684\u9876\u70b9\uff09\uff0c\u5373 A \u5230 C \u7684\u6700\u77ed\u8def\u5f84\u5df2\u7ecf\u786e\u5b9a\u3002\u56e0\u4e3a\u5982\u679c\u6709\u5176\u5b83\u8def\u5f84\u80fd\u5230\u8fbe C \u7684\u8bdd\uff0c\u90a3\u4e48 C \u4e0d\u4f1a\u662f\u8868\u683c\u4e2d\u7684\u6700\u5c0f\u9879\u3002\u66f4\u65b0\u8868\u683c\u3002</p> \u9876\u70b9 \u662f\u5426\u5df2\u7ecf\u627e\u5230\u6700\u77ed\u8def\u5f84 \u4ee3\u4ef7 \u524d\u7f6e\u9876\u70b9 B \u662f 1 A C \u662f 5 A D N/A 10 A E \u662f 4 B F N/A N/A N/A G N/A 204 E <p>\u7136\u540e\u8bbf\u95ee C\uff0c\u5f97\u5230\u4ece A \u7ecf C \u5230\u8fbe E \u548c F \u7684\u4ee3\u4ef7\u3002\u5982\u679c A \u7ecf C \u5230 E \u5219\u4ee3\u4ef7\u662f 105 \u5927\u4e8e\u5df2\u7ecf\u627e\u5230\u5230 E \u7684\u6700\u77ed\u8def\u5f84\uff0c\u4e0d\u66f4\u65b0\u8868\u683c\u3002\u5982\u679c\u7ecf C \u5230 E\uff0c\u5219\u4ee3\u4ef7\u662f 505\uff0c\u66f4\u65b0\u8868\u683c\u3002</p> \u9876\u70b9 \u662f\u5426\u5df2\u7ecf\u627e\u5230\u6700\u77ed\u8def\u5f84 \u4ee3\u4ef7 \u524d\u7f6e\u9876\u70b9 B \u662f 1 A C \u662f 5 A D N/A 10 A E \u662f 4 B F N/A 505 C G N/A 204 E <p>\u627e\u5230\u8868\u683c\u4e2d\u4ee3\u4ef7\u6700\u5c0f\u9879\uff08\u5ffd\u7565\u5df2\u7ecf\u8bbf\u95ee\u8fc7\u7684\u9876\u70b9\uff09\uff0c\u5373 A \u5230 D \u7684\u6700\u77ed\u8def\u5f84\u5df2\u7ecf\u786e\u5b9a\u3002\u56e0\u4e3a\u5982\u679c\u6709\u5176\u5b83\u8def\u5f84\u80fd\u5230\u8fbe D \u7684\u8bdd\uff0c\u90a3\u4e48 D \u4e0d\u4f1a\u662f\u8868\u683c\u4e2d\u7684\u6700\u5c0f\u9879\u3002\u66f4\u65b0\u8868\u683c\u3002</p> \u9876\u70b9 \u662f\u5426\u5df2\u7ecf\u627e\u5230\u6700\u77ed\u8def\u5f84 \u4ee3\u4ef7 \u524d\u7f6e\u9876\u70b9 B \u662f 1 A C \u662f 5 A D \u662f 10 A E \u662f 4 B F N/A 505 C G N/A 204 E <p>\u7136\u540e\u8bbf\u95ee D\uff0c\u5f97\u5230\u4ece A \u7ecf D \u5230\u8fbe G \u7684\u4ee3\u4ef7\u3002\u5982\u679c A \u7ecf D \u5230 G \u5219\u4ee3\u4ef7\u662f 11 \u5c0f\u4e8e\u7ecf E \u8fbe\u5230 G \u7684\u4ee3\u4ef7 204\uff0c\u66f4\u65b0\u8868\u683c\u3002</p> \u9876\u70b9 \u662f\u5426\u5df2\u7ecf\u627e\u5230\u6700\u77ed\u8def\u5f84 \u4ee3\u4ef7 \u524d\u7f6e\u9876\u70b9 B \u662f 1 A C \u662f 5 A D \u662f 10 A E \u662f 4 B F N/A 505 C G N/A 11 D <p>\u627e\u5230\u8868\u683c\u4e2d\u4ee3\u4ef7\u6700\u5c0f\u9879\uff08\u5ffd\u7565\u5df2\u7ecf\u8bbf\u95ee\u8fc7\u7684\u9876\u70b9\uff09\uff0c\u5373 A \u5230 G \u7684\u6700\u77ed\u8def\u5f84\u5df2\u7ecf\u786e\u5b9a\u3002\u56e0\u4e3a\u5982\u679c\u6709\u5176\u5b83\u8def\u5f84\u80fd\u5230\u8fbe G \u7684\u8bdd\uff0c\u90a3\u4e48 G \u4e0d\u4f1a\u662f\u8868\u683c\u4e2d\u7684\u6700\u5c0f\u9879\u3002\u66f4\u65b0\u8868\u683c\u3002</p> \u9876\u70b9 \u662f\u5426\u5df2\u7ecf\u627e\u5230\u6700\u77ed\u8def\u5f84 \u4ee3\u4ef7 \u524d\u7f6e\u9876\u70b9 B \u662f 1 A C \u662f 5 A D \u662f 10 A E \u662f 4 B F N/A 505 C G \u662f 11 D <p>\u7136\u540e\u8bbf\u95ee G\uff0c\u5f97\u5230\u7ecf G \u5230 E \u548c F \u7684\u4ee3\u4ef7\u3002\u5982\u679c A \u7ecf G \u5230 E \u5219\u4ee3\u4ef7\u662f 211 \u5927\u4e8e\u7ecf B \u8fbe\u5230 E \u7684\u4ee3\u4ef7 4\uff0c\u4e0d\u66f4\u65b0\u8868\u683c\u3002\u5982\u679c A \u7ecf G \u5230 F \u5219\u4ee3\u4ef7\u662f 12 \u5927\u4e8e\u7ecf C \u8fbe\u5230 F \u7684\u4ee3\u4ef7 505\uff0c\u66f4\u65b0\u8868\u683c\u3002</p> \u9876\u70b9 \u662f\u5426\u5df2\u7ecf\u627e\u5230\u6700\u77ed\u8def\u5f84 \u4ee3\u4ef7 \u524d\u7f6e\u9876\u70b9 B \u662f 1 A C \u662f 5 A D \u662f 10 A E \u662f 4 B F N/A 12 G G \u662f 11 D <p>\u627e\u5230\u8868\u683c\u4e2d\u4ee3\u4ef7\u6700\u5c0f\u9879\uff08\u5ffd\u7565\u5df2\u7ecf\u8bbf\u95ee\u8fc7\u7684\u9876\u70b9\uff09\uff0c\u5373 A \u5230 F \u7684\u6700\u77ed\u8def\u5f84\u5df2\u7ecf\u786e\u5b9a\uff0c\u5176\u5b83\u7684\u5168\u90e8\u6700\u77ed\u8def\u5f84\u4e5f\u5df2\u7ecf\u786e\u5b9a\uff0c\u66f4\u65b0\u8868\u683c\u5373\u53ef\u3002</p> \u9876\u70b9 \u662f\u5426\u5df2\u7ecf\u627e\u5230\u6700\u77ed\u8def\u5f84 \u4ee3\u4ef7 \u524d\u7f6e\u9876\u70b9 B \u662f 1 A C \u662f 5 A D \u662f 10 A E \u662f 4 B F \u662f 12 G G \u662f 11 D <p>\u6839\u636e\u6700\u65b0\u7684\u8868\u683c\u53ef\u4ee5\u77e5\u9053\uff0c\u4ece A \u5230 G \u7684\u6700\u5c0f\u4ee3\u4ef7\u662f 11\uff0c\u8def\u5f84\u4e3a G-&gt;D-&gt;A\u3002</p> <p>\u4ee3\u7801\u5b9e\u73b0 Dijkstra \u7b97\u6cd5\u3002 <pre><code>public static void dijkstra(Graph graph, Vertex vertex) {  \n\n    // \u521d\u59cb\u5316\u8ddd\u79bb\u8868  \n    Map&lt;Vertex, Integer&gt; distance = new HashMap&lt;&gt;();  \n\n    // \u521d\u59cb\u5316\u524d\u7f6e\u8282\u70b9\u8868  \n    Map&lt;Vertex, Vertex&gt; preVertex = new HashMap&lt;&gt;();  \n\n\n    // \u904d\u5386\u7684\u4f18\u5148\u7ea7\u961f\u5217  \n    PriorityQueue&lt;Node&gt; queue = new PriorityQueue&lt;&gt;(Comparator.comparing(o -&gt; o.distance));  \n    queue.add(new Node(vertex, 0));  \n    distance.put(vertex, 0);  \n\n    while (!queue.isEmpty()) {  \n        Vertex currentVertex = queue.poll().vertex;  \n        visited.add(currentVertex);  \n\n        for (Edge edge : graph.getEdges().get(currentVertex)) {  \n            if (!visited.contains(edge.getDst())) {  \n                Integer oldDistance = distance.get(edge.getDst());  \n                Integer newDistance = distance.get(currentVertex) + edge.getWeight();  \n                if (oldDistance == null || newDistance &lt; oldDistance) {  \n                    distance.put(edge.getDst(), newDistance);  \n                    preVertex.put(edge.getDst(), currentVertex);  \n                }  \n\n                queue.add(new Node(edge.getDst(), oldDistance == null ? newDistance : Math.min(oldDistance, newDistance)));  \n            }  \n        }  \n    }  \n\n    printPath(vertex, distance, preVertex);  \n}  \n\nprivate static void printPath(Vertex vertex, Map&lt;Vertex, Integer&gt; distance, Map&lt;Vertex, Vertex&gt; preVertex) {  \n    distance.entrySet().forEach(item -&gt; {  \n        System.out.println(vertex.getLabel() + \"-&gt;\" + item.getKey().getLabel() + \", \" + item.getValue());  \n\n        Vertex dst = item.getKey();  \n        System.out.println(dst.getLabel());  \n        while (preVertex.get(dst) != null) {  \n            dst = preVertex.get(dst);  \n            System.out.println(dst.getLabel());  \n        }  \n    });  \n}  \n\nstatic class Node {  \n    Vertex vertex;  \n\n    Integer distance;  \n\n    public Node(Vertex vertex, Integer distance) {  \n        this.vertex = vertex;  \n        this.distance = distance;  \n    }  \n}\n</code></pre></p>"},{"location":"ThreeMountains/Algorithms/%E6%B1%82%E8%A7%A3%E7%AE%97%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%80%BC/","title":"\u6c42\u89e3\u7b97\u6570\u8868\u8fbe\u5f0f\u7684\u503c","text":"<p>\u6c42\u89e3\u7b97\u6570\u8868\u8fbe\u5f0f\uff0c\u5982\u679c\u76f4\u63a5\u6c42\u7b97\u6570\u8868\u8fbe\u5f0f\u7684\u503c\u662f\u76f8\u5f53\u56f0\u96be\u7684\uff0c\u56e0\u6b64\u5206\u4e09\u6b65\u5b9e\u73b0\uff1a</p> <ol> <li>\u89e3\u6790\u7b97\u672f\u8868\u8fbe\u5f0f\u5b57\u7b26\u4e32\u7684\u5143\u7d20\u3002</li> <li>\u5c06\u7b97\u6570\u8868\u8fbe\u5f0f\u8f6c\u6362\u4e3a\u53e6\u4e00\u79cd\u5f62\u5f0f\uff1a\u540e\u7f00\u8868\u8fbe\u5f0f\u3002</li> <li>\u8ba1\u7b97\u540e\u7f00\u8868\u8fbe\u5f0f\u7684\u503c\u3002</li> </ol>"},{"location":"ThreeMountains/Algorithms/%E6%B1%82%E8%A7%A3%E7%AE%97%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%80%BC/#_1","title":"\u89e3\u6790\u7b97\u672f\u8868\u8fbe\u5f0f\u5b57\u7b26\u4e32\u7684\u5143\u7d20","text":"<p>\u5c06\u7b97\u672f\u8868\u8fbe\u5f0f\u5b57\u7b26\u4e32\u4e2d\u7684\u5404\u4e2a\u5143\u7d20\uff08\u6570\u5b57\u3001\u64cd\u4f5c\u7b26\u3001\u62ec\u53f7\uff09\u89e3\u6790\u51fa\u6765\u3002 </p> <p>\u4ece\u5de6\u5230\u53f3\u89e3\u6790\u5b57\u7b26\u4e32\uff0c\u5e76\u4e14\u5c06\u7b97\u672f\u8868\u8fbe\u5f0f\u8f6c\u6362\u4e3a\u540e\u7f00\u8868\u8fbe\u5f0f\u7684\u65f6\u5019\u4e5f\u8981\u4ece\u5de6\u5230\u53f3\u8fdb\u884c\u5904\u7406\uff0c\u6240\u4ee5\u8fd9\u91cc\u91c7\u7528\u961f\u5217\u5b58\u50a8\u7b97\u672f\u8868\u8fbe\u5f0f\u7684\u5404\u4e2a\u5143\u7d20\u3002\u4ee3\u7801\u5982\u4e0b\uff08\u6682\u4e0d\u652f\u6301\u5904\u7406\u8d1f\u6570\uff09\uff1a <pre><code>    // \u5b58\u50a8\u7b97\u672f\u8868\u8fbe\u5f0f\u7684\u5143\u7d20\uff1a\u6570\u5b57\uff0c\u8fd0\u7b97\u7b26\uff08\u5305\u62ec\u62ec\u53f7\uff09\n    Queue&lt;String&gt; elements = new LinkedList&lt;&gt;();\n\n    @Test\n    public void test() {\n\n//        String input = \"1+2\";\n//        String input = \"2+3*4-5\";\n        String input = \"(1+2*2.35-(23+3)*4)-(12)+(23/1)\";\n\n        // \u89e3\u6790\u5b57\u7b26\u4e32\u4e2d\u7684\u5404\u4e2a\u5143\u7d20\n        parseElements(input);\n        System.out.println(elements);\n    }\n\n    private void parseElements(String input) {\n        char[] charArray = input.toCharArray();\n        int start = 0, end;\n        for (int i = 0; i &lt; charArray.length; i++) {\n            end = i;\n            char ch = charArray[i];\n            if (ch == '+' || ch == '-' || ch == '*' || ch == '/' || ch == '(' || ch == ')') {\n                if (start &lt; end) {\n                    char[] elementArray = Arrays.copyOfRange(charArray, start, end);\n                    elements.offer(new String(elementArray));\n                }\n                elements.offer(String.valueOf(ch));\n                start = i + 1;\n            } else if (i == charArray.length - 1) {\n                char[] elementArray = Arrays.copyOfRange(charArray, start, charArray.length);\n                elements.offer(new String(elementArray));\n            }\n        }\n    }\n</code></pre></p>"},{"location":"ThreeMountains/Algorithms/%E6%B1%82%E8%A7%A3%E7%AE%97%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%80%BC/#_2","title":"\u540e\u7f00\u8868\u8fbe\u5f0f\u6c42\u503c","text":"<p>\u65e5\u5e38\u7684\u8868\u8fbe\u5f0f\u5c06\u64cd\u4f5c\u7b26\u653e\u5728\u4e24\u4e2a\u64cd\u4f5c\u6570\u4e2d\u95f4\uff0c\u56e0\u4e3a\u64cd\u4f5c\u7b26\u5728\u64cd\u4f5c\u6570\u7684\u4e2d\u95f4\uff0c\u56e0\u6b64\u79f0\u4e3a\u4e2d\u7f00\u8868\u8fbe\u5f0f\u3002  </p> <p>\u4e2d\u7f00\u8868\u8fbe\u5f0f\u5982\uff1aA+B*C-D\uff0c\u5176\u5bf9\u5e94\u7684\u540e\u7f00\u8868\u8fbe\u5f0f\u4e3a\uff1aABC*+D-\u3002 \u4e2d\u7f00\u8868\u8fbe\u5f0f\u548c\u540e\u7f00\u8868\u8fbe\u5f0f\u7684\u6570\u5b57\u987a\u5e8f\u662f\u4e00\u6837\u7684\u5747\u4e3a: A-&gt;B-&gt;C-&gt;D\u3002  </p>"},{"location":"ThreeMountains/Algorithms/%E6%B1%82%E8%A7%A3%E7%AE%97%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%80%BC/#_3","title":"\u540e\u7f00\u8868\u8fbe\u5f0f\u7684\u6c42\u503c\u903b\u8f91","text":"<ul> <li> <p>\u7531\u5de6\u5411\u53f3\u9010\u4e2a\u8bfb\u53d6\u540e\u7f00\u8868\u8fbe\u5f0f\u7684\u5143\u7d20\u3002 -- \u5982\u679c\u8bfb\u53d6\u7684\u5143\u7d20\u4e3a\u64cd\u4f5c\u6570\u5219\u5c06\u64cd\u4f5c\u6570\u538b\u5165\u6808\u4e2d\u3002 -- \u5982\u679c\u8bfb\u53d6\u7684\u5143\u7d20\u4e3a\u64cd\u4f5c\u7b26\uff0c\u5219\u53d6\u51fa\u6808\u9876\u7684\u4e24\u4e2a\u64cd\u4f5c\u6570\uff0c\u8fdb\u884c\u8ba1\u7b97\u5e76\u5c06\u8ba1\u7b97\u7ed3\u679c\u5165\u6808\u3002   </p> </li> <li> <p>\u8bfb\u53d6\u5b8c\u6bd5\uff0c\u83b7\u53d6\u6808\u4e2d\u5143\u7d20\u5373\u4e3a\u8ba1\u7b97\u7ed3\u679c\u3002</p> </li> </ul>"},{"location":"ThreeMountains/Algorithms/%E6%B1%82%E8%A7%A3%E7%AE%97%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%80%BC/#abcd-","title":"\u6c42\u540e\u7f00\u8868\u8fbe\u5f0f ABC*+D- \u503c","text":"<p>\u8ba1\u7b97\u7684\u540e\u7f00\u8868\u8fbe\u5f0f\u4e3a\uff1aABC*+D-\uff0c\u4ece\u540e\u7f00\u8868\u8fbe\u5f0f\u4e2d\u9010\u4e2a\u8bfb\u53d6\u5143\u7d20\u3002</p> <ol> <li> <p>\u8bfb\u53d6\u64cd\u4f5c\u6570 A \u5165\u6808\u3002\u6808\u9876\u5230\u6808\u5e95\u4e3a A\u3002</p> </li> <li> <p>\u8bfb\u53d6\u64cd\u4f5c\u6570 B \u5165\u6808\u3002\u6808\u9876\u5230\u6808\u5e95\u4e3a BA\u3002</p> </li> <li> <p>\u8bfb\u53d6\u64cd\u4f5c\u6570 C \u5165\u6808\u3002\u6808\u9876\u5230\u6808\u5e95\u4e3a CBA\u3002  </p> </li> <li> <p>\u8bfb\u53d6\u64cd\u4f5c\u7b26 *\uff0c\u53d6\u51fa\u6808\u9876\u7684\u4e24\u4e2a\u64cd\u4f5c\u6570 C \u548c B\uff0c\u8ba1\u7b97 B * C \u7684\u503c\u8bb0\u4e3a Z\uff0c\u5c06 Z \u538b\u5165\u6808\u4e2d\u3002\u6808\u9876\u5230\u6808\u5e95\u4e3a ZA\u3002  </p> </li> <li> <p>\u8bfb\u53d6\u64cd\u4f5c\u7b26 +\uff0c\u53d6\u51fa\u6808\u9876\u7684\u4e24\u4e2a\u64cd\u4f5c\u6570 Z \u548c A\uff0c\u8ba1\u7b97 A + Z \u7684\u503c\u8bb0\u4e3a Y\uff0c\u5c06 Y \u538b\u5165\u6808\u4e2d\u3002\u6808\u9876\u5230\u6808\u5e95\u4e3a Y\u3002  </p> </li> <li> <p>\u8bfb\u53d6\u64cd\u4f5c\u6570 D \u5165\u6808\u3002\u6808\u9876\u5230\u6808\u5e95\u4e3a DY\u3002  </p> </li> <li> <p>\u8bfb\u53d6\u64cd\u4f5c\u7b26 -\uff0c\u53d6\u51fa\u6808\u9876\u7684\u4e24\u4e2a\u64cd\u4f5c\u6570 D \u548c Y\uff0c\u8ba1\u7b97 Y - D \u7684\u503c\u8bb0\u4e3a X\uff0c\u5c06 X \u538b\u5165\u6808\u4e2d\u3002\u6808\u9876\u5230\u6808\u5e95\u4e3a X\u3002  </p> </li> <li> <p>\u8bfb\u53d6\u5b8c\u6bd5\uff0c\u5f39\u51fa\u6808\u4e2d\u7684\u7ed3\u679c X \u5373\u4e3a\u8ba1\u7b97\u7ed3\u679c\uff1aX-&gt;(Y - D)-&gt;(A + Z - D)-&gt;(A + B * C - D)</p> </li> </ol>"},{"location":"ThreeMountains/Algorithms/%E6%B1%82%E8%A7%A3%E7%AE%97%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%80%BC/#_4","title":"\u5c06\u4e2d\u7f00\u8868\u8fbe\u5f0f\u8f6c\u6362\u4e3a\u540e\u7f00\u8868\u8fbe\u5f0f","text":""},{"location":"ThreeMountains/Algorithms/%E6%B1%82%E8%A7%A3%E7%AE%97%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%80%BC/#_5","title":"\u8f6c\u6362\u89c4\u5219","text":"<ul> <li> <p>\u7531\u5de6\u5411\u53f3\u9010\u4e2a\u8bfb\u53d6\u4e2d\u7f00\u8868\u8fbe\u5f0f\u7684\u5143\u7d20\u3002</p> </li> <li> <p>\u5982\u679c\u5143\u7d20\u4e3a\u64cd\u4f5c\u6570\uff0c\u76f4\u63a5\u5199\u81f3\u8f93\u51fa\u3002</p> </li> <li> <p>\u5982\u679c\u5143\u7d20\u4e3a\u5de6\u62ec\u53f7<code>(</code>\uff0c\u538b\u5165\u6808\u4e2d\u3002</p> </li> <li> <p>\u5982\u679c\u5143\u7d20\u4e3a\u53f3\u62ec\u53f7<code>)</code>\uff0c\u82e5\u6808\u975e\u7a7a\u5219\u91cd\u590d\u4ee5\u4e0b\u6b65\u9aa4\uff1a --  \u53d6\u51fa\u6808\u9876\u5143\u7d20\u3002 --  \u82e5\u53d6\u51fa\u5143\u7d20\u4e0d\u4e3a<code>(</code>\uff0c\u5219\u5c06\u53d6\u51fa\u5143\u7d20\u5199\u81f3\u8f93\u51fa\uff1b\u5426\u5219\u9000\u51fa\u5faa\u73af\u3002</p> </li> <li> <p>\u5982\u679c\u5143\u7d20\u4e3a\u64cd\u4f5c\u7b26\uff0c\u8bb0\u4e3a opThis\u3002\u5982\u679c\u6808\u4e3a\u7a7a\u5c06 opThis \u5165\u6808\uff1b\u5426\u5219\u91cd\u590d\u4ee5\u4e0b\u6b65\u9aa4\u76f4\u81f3\u6808\u4e3a\u7a7a\uff0c\u6700\u540e\u5c06 opThis \u538b\u5165\u6808\uff1a   -- \u53d6\u51fa\u6808\u9876\u5143\u7d20\u8bb0\u4e3a opTop\u3002   -- \u5982\u679c opTop \u4e3a<code>(</code>\uff0c\u5219\u91cd\u65b0\u5c06 opTop \u5165\u6808\uff0c\u9000\u51fa\u5faa\u73af\u3002     -- \u5982\u679c opTop \u4e3a\u64cd\u4f5c\u7b26\uff0c\u4e14 opTop \u7684\u4f18\u5148\u7ea7\u5c0f\u4e8e opThis \u7684\u4f18\u5148\u7ea7\uff0c\u5219\u91cd\u65b0\u5c06 opTop \u5165\u6808\uff0c\u9000\u51fa\u5faa\u73af\u3002   -- \u5982\u679c opTop \u4e3a\u64cd\u4f5c\u7b26\uff0c\u4e14 opTop \u7684\u4f18\u5148\u7ea7\u5927\u4e8e\u7b49\u4e8e opThis \u7684\u4f18\u5148\u7ea7\uff0c\u5219\u5c06 opTop \u5199\u81f3\u8f93\u51fa\uff0c\u7ee7\u7eed\u5faa\u73af\u3002</p> </li> <li> <p>\u8bfb\u53d6\u5b8c\u6bd5\uff0c\u5982\u679c\u6808\u4e0d\u4e3a\u7a7a\uff0c\u5c06\u6808\u4e2d\u5143\u7d20\u7531\u6808\u9876\u81f3\u6808\u5e95\u9010\u4e2a\u5199\u5165\u8f93\u51fa\u3002</p> </li> </ul>"},{"location":"ThreeMountains/Algorithms/%E6%B1%82%E8%A7%A3%E7%AE%97%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%80%BC/#abc-d","title":"\u8f6c\u6362\u4e2d\u7f00\u8868\u8fbe\u5f0f A+B*C-D","text":"<p>\u8f6c\u6362\u7684\u4e2d\u7f00\u8868\u8fbe\u5f0f\u4e3a\uff1aA+B*C-D\uff0c\u4ece\u4e2d\u7f00\u8868\u8fbe\u5f0f\u4e2d\u9010\u4e2a\u8bfb\u53d6\u5143\u7d20\u3002</p> <ol> <li> <p>\u8bfb\u53d6\u64cd\u4f5c\u6570 A\uff0c\u76f4\u63a5\u5199\u81f3\u8f93\u51fa\u3002\u8f93\u51fa\u4e3a A\uff0c\u6808\u4e3a\u7a7a\u3002</p> </li> <li> <p>\u8bfb\u53d6\u64cd\u4f5c\u7b26 +\uff0c\u6b64\u65f6\u6808\u4e3a\u7a7a\uff0c\u5c06\u64cd\u4f5c\u7b26 + \u5165\u6808\u3002\u8f93\u51fa\u4e3a A\uff0c\u6808\u9876\u5230\u6808\u5e95\u4e3a +\u3002</p> </li> <li> <p>\u8bfb\u53d6\u64cd\u4f5c\u6570 B\uff0c\u76f4\u63a5\u5199\u81f3\u8f93\u51fa\u3002\u8f93\u51fa\u4e3a AB\uff0c\u6808\u9876\u5230\u6808\u5e95\u4e3a +\u3002</p> </li> <li> <p>\u8bfb\u53d6\u64cd\u4f5c\u7b26 *\u3002    -- \u53d6\u51fa\u6808\u9876\u5143\u7d20\u4e3a\u64cd\u4f5c\u7b26 +\uff0c\u64cd\u4f5c\u7b26 + \u7684\u4f18\u5148\u7ea7\u5c0f\u4e8e\u64cd\u4f5c\u7b26 *\uff0c\u5219\u5c06\u64cd\u4f5c + \u91cd\u65b0\u5165\u6808\u3002\u8f93\u51fa\u4e3a AB\uff0c\u6808\u9876\u5230\u6808\u5e95\u4e3a +\u3002    -- \u5c06\u64cd\u4f5c\u7b26 * \u5165\u6808\u3002\u8f93\u51fa\u4e3a AB\uff0c\u6808\u9876\u5230\u6808\u5e95\u4e3a *+\u3002</p> </li> <li> <p>\u8bfb\u53d6\u64cd\u4f5c\u6570 C\uff0c\u76f4\u63a5\u5199\u81f3\u8f93\u51fa\u3002\u8f93\u51fa\u4e3a ABC\uff0c\u6808\u9876\u5230\u6808\u5e95\u4e3a +\u3002</p> </li> <li> <p>\u8bfb\u53d6\u64cd\u4f5c\u7b26 -\u3002    -- \u53d6\u51fa\u6808\u9876\u5143\u7d20\u4e3a\u64cd\u4f5c\u7b26 *\uff0c\u64cd\u4f5c\u7b26 * \u7684\u4f18\u5148\u7ea7\u5927\u4e8e\u64cd\u4f5c\u7b26 -\uff0c\u5219\u5c06\u64cd\u4f5c\u7b26 * \u5199\u81f3\u8f93\u51fa\u3002\u8f93\u51fa\u4e3a ABC*\uff0c\u6808\u9876\u5230\u6808\u5e95\u4e3a +\u3002    -- \u53d6\u51fa\u6808\u9876\u5143\u7d20\u4e3a\u64cd\u4f5c\u7b26 +\uff0c\u64cd\u4f5c\u7b26 + \u7684\u4f18\u5148\u7ea7\u7b49\u4e8e\u64cd\u4f5c\u7b26 -\uff0c\u5219\u5c06\u64cd\u4f5c\u7b26 + \u5199\u81f3\u8f93\u51fa\u3002\u8f93\u51fa\u4e3a ABC*+\uff0c\u6808\u4e3a\u7a7a\u3002    -- \u5c06\u64cd\u4f5c\u7b26 - \u5165\u6808\u3002\u8f93\u51fa\u4e3a ABC*+\uff0c\u6808\u9876\u5230\u6808\u5e95\u4e3a -\u3002</p> </li> <li> <p>\u8bfb\u53d6\u64cd\u4f5c\u6570 D\uff0c\u76f4\u63a5\u5199\u81f3\u8f93\u51fa\u3002\u8f93\u51fa\u4e3a ABC*+D\uff0c\u6808\u9876\u5230\u6808\u5e95\u4e3a -\u3002</p> </li> <li> <p>\u8bfb\u53d6\u5b8c\u6bd5\uff0c\u5c06\u6808\u4e2d\u5143\u7d20 - \u5199\u81f3\u8f93\u51fa\u3002\u8f93\u51fa\u4e3a ABC*+D-\uff0c\u5b8c\u6210\u4e2d\u7f00\u8868\u8fbe\u5f0f\u5230\u540e\u7f00\u8868\u8fbe\u5f0f\u7684\u8f6c\u6362\u3002</p> </li> </ol>"},{"location":"ThreeMountains/Algorithms/%E6%B1%82%E8%A7%A3%E7%AE%97%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%80%BC/#java","title":"Java \u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>import org.junit.jupiter.api.Test;\n\nimport java.util.Arrays;\nimport java.util.LinkedList;\nimport java.util.Queue;\nimport java.util.Stack;\n\npublic class BaseTest {\n\n    // \u5b58\u50a8\u7b97\u672f\u8868\u8fbe\u5f0f\u7684\u5143\u7d20\uff1a\u6570\u5b57\uff0c\u8fd0\u7b97\u7b26\uff08\u5305\u62ec\u62ec\u53f7\uff09\n    Queue&lt;String&gt; elements = new LinkedList&lt;&gt;();\n\n    // \u8f6c\u6362\u540e\u7f00\u8868\u8fbe\u5f0f\u4f7f\u7528\u7684\u6808\n    Stack&lt;String&gt; convertStack = new Stack&lt;&gt;();\n\n    // \u5b58\u50a8\u540e\u7f00\u8868\u8fbe\u5f0f\n    Queue&lt;String&gt; output = new LinkedList&lt;&gt;();\n\n    // \u8ba1\u7b97\u5b58\u50a8\u7ed3\u679c\u4f7f\u7528\u7684\u7684\u6808\n    Stack&lt;Double&gt; calcStack = new Stack&lt;&gt;();\n\n    @Test\n    public void test() {\n\n//        String input = \"1+2\";\n//        String input = \"2+3*4-5\";\n        String input = \"(1+2*2.35-(23+3)*4)-(12)+(23/1)\";\n\n        // \u89e3\u6790\u5b57\u7b26\u4e32\u4e2d\u7684\u5404\u4e2a\u5143\u7d20\n        parseElements(input);\n        System.out.println(elements);\n\n        // \u5c06\u4e2d\u7f00\u8868\u8fbe\u5f0f\u8f6c\u6362\u4e3a\u540e\u7f00\u8868\u8fbe\u5f0f\n        convertPostfix();\n        System.out.println(output);\n\n        // \u8ba1\u7b97\u540e\u7f00\u8868\u8fbe\u5f0f\u7684\u503c\n        Double result = calculateResult();\n        System.out.println(result);\n    }\n\n    private void parseElements(String input) {\n        char[] charArray = input.toCharArray();\n        int start = 0, end;\n        for (int i = 0; i &lt; charArray.length; i++) {\n            end = i;\n            char ch = charArray[i];\n            if (ch == '+' || ch == '-' || ch == '*' || ch == '/' || ch == '(' || ch == ')') {\n                if (start &lt; end) {\n                    char[] elementArray = Arrays.copyOfRange(charArray, start, end);\n                    elements.offer(new String(elementArray));\n                }\n                elements.offer(String.valueOf(ch));\n                start = i + 1;\n            } else if (i == charArray.length - 1) {\n                char[] elementArray = Arrays.copyOfRange(charArray, start, charArray.length);\n                elements.offer(new String(elementArray));\n            }\n        }\n    }\n\n    public void convertPostfix() {\n        while (!elements.isEmpty()) {\n            String element = elements.poll();\n\n            switch (element) {\n                case \"+\":\n                case \"-\":\n                    processOperator(element, 1);\n                    break;\n                case \"*\":\n                case \"/\":\n                    processOperator(element, 2);\n                    break;\n                case \")\":\n                    processRight();\n                    break;\n                case \"(\":\n                    convertStack.push(element);\n                    break;\n                default:\n                    output.offer(element);\n                    break;\n            }\n        }\n\n        while (!convertStack.isEmpty()) {\n            output.offer(convertStack.pop());\n        }\n    }\n\n    public void processOperator(String opThis, int precThis) {\n        while (!convertStack.isEmpty()) {\n            String opTop = convertStack.pop();\n            if (opTop.equals(\"(\")) {\n                convertStack.push(opTop);\n                break;\n            } else {\n                int precTop;\n                if (opTop.equals(\"+\") || opTop.equals(\"-\")) {\n                    precTop = 1;\n                } else {\n                    precTop = 2;\n                }\n\n                if (precTop &lt; precThis) {\n                    convertStack.push(opTop);\n                    break;\n                } else {\n                    output.offer(opTop);\n                }\n            }\n        }\n\n        convertStack.push(opThis);\n    }\n\n    public void processRight() {\n        while (!convertStack.isEmpty()) {\n            String opTop = convertStack.pop();\n            if (opTop.equals(\"(\")) {\n                break;\n            } else {\n                output.offer(opTop);\n            }\n        }\n    }\n\n    private Double calculateResult() {\n        while (!output.isEmpty()) {\n            String element = output.poll();\n            if (element.charAt(0) &gt;= '0' &amp;&amp; element.charAt(0) &lt;= '9') {\n                calcStack.push(Double.parseDouble(element));\n            } else {\n                Double num2 = calcStack.pop();\n                Double num1 = calcStack.pop();\n\n                switch (element) {\n                    case \"+\":\n                        calcStack.push(num1 + num2);\n                        break;\n                    case \"-\":\n                        calcStack.push(num1 - num2);\n                        break;\n                    case \"*\":\n                        calcStack.push(num1 * num2);\n                        break;\n                    case \"/\":\n                        calcStack.push(num1 / num2);\n                        break;\n                    default:\n                        calcStack.push((double) 0);\n                        break;\n                }\n            }\n        }\n\n        return calcStack.pop();\n    }\n}\n</code></pre>"},{"location":"ThreeMountains/Network/Network%20Tips/","title":"Network Tips","text":""},{"location":"ThreeMountains/Network/Network%20Tips/#_1","title":"\u9996\u90e8\u6821\u9a8c\u548c\u7b97\u6cd5","text":"<p>\u5047\u8bbe\u53d1\u9001\u65b9\u53d1\u9001\u7684\u662f\u4e94\u4e2a 4 \u4f4d\u6570\u7684\u5e8f\u5217 <code>{7, 11, 12, 0, 6}</code>\uff0c\u9664\u4e86\u53d1\u9001\u8fd9\u51e0\u4e2a\u6570\u5916\u8fd8\u8981\u53d1\u9001\u8fd9\u51e0\u4e2a\u6570\u7684\u548c 36\u3002\u63a5\u6536\u65b9\u628a\u4e94\u4e2a\u6570\u76f8\u52a0\uff0c\u5e76\u5c06\u7ed3\u679c\u4e8e\u548c\u8fdb\u884c\u6bd4\u8f83\uff0c\u76f8\u540c\u5219\u8ba4\u4e3a\u6ca1\u6709\u5dee\u9519\u3002</p> <p>\u4e0a\u9762\u7684\u65b9\u6cd5\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u5982\u679c\u6821\u9a8c\u548c\u4e5f\u662f 4 \u4f4d\uff0c\u90a3\u4e48\u662f\u653e\u4e0d\u4e0b 36 \u7684\u3002\u56e0\u6b64\u91c7\u7528\u4e8c\u8fdb\u5236\u53cd\u7801\u52a0\u6cd5\uff1a <pre><code>36 = 0b10_0100 =&gt; 0b10 + 0b0100 = 0b0110 = 6 \n</code></pre> \u63a5\u6536\u65b9\u540c\u6837\u91c7\u7528\u4e8c\u8fdb\u5236\u53cd\u7801\u52a0\u6cd5\u8ba1\u7b97\u6821\u9a8c\u548c\uff0c\u7ed3\u679c\u540c\u6837\u662f 6 \u5219\u8ba4\u4e3a\u6ca1\u6709\u5dee\u9519\u3002</p> <p>\u4e3a\u4e86\u4f7f\u63a5\u6536\u65b9\u7684\u8ba1\u7b97\u66f4\u7b80\u5355\uff0c\u53d1\u9001\u65b9\u5c06\u4e8c\u8fdb\u5236\u53cd\u7801\u52a0\u6cd5\u6c42\u5f97\u548c 6 \u53d6\u53cd\uff0c0110 =&gt; 1001 \u4f5c\u4e3a\u6821\u9a8c\u548c\u653e\u5728\u9996\u90e8\u4e2d\u3002\u63a5\u6536\u65b9\u53ea\u9700\u8981\u6309\u7167\u6bcf 4 \u4f4d\u4f7f\u7528\u4e8c\u8fdb\u5236\u53cd\u7801\u52a0\u6cd5\u6c42\u548c\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\u7ed3\u679c\u4e3a 1111\uff0c\u7136\u540e\u53d6\u53cd\u5224\u65ad\u662f\u4e0d\u662f\u7b49\u4e8e 0 \u5373\u53ef\u5b8c\u6210\u6821\u9a8c\u3002</p> <p>\u4f20\u7edf\u4e0a\uff0c\u56e0\u7279\u7f51\u4f7f\u7528\u4e00\u4e2a 16 \u4f4d\u7684\u6821\u9a8c\u548c\u3002 \u53d1\u9001\u65b9\u903b\u8f91\uff1a   <pre><code>1. \u62a5\u6587\u88ab\u5212\u5206\u4e3a 16 \u4f4d\u7684\u5b57\u3002\n\n2. \u6821\u9a8c\u548c\u7684\u503c\u521d\u59cb\u5316\u4e3a 0\u3002  \n\n3. \u7528\u4e8c\u8fdb\u5236\u53cd\u7801\u52a0\u6cd5\u628a\u6240\u6709\u7684\u5b57\u76f8\u52a0\uff0c\u5305\u62ec\u6821\u9a8c\u548c\u3002// \u4e00\u822c\u548c\u7528 32 \u4f4d\u4fdd\u5b58\uff0c\u6ea2\u51fa\u7684\u4f4d\u53ef\u4ee5\u53f3\u79fb 16 \u4f4d\u5f97\u5230\uff0c\u53f3\u8fb9\u7684 16 \u4f4d\u53ef\u4ee5\u548c 0x0000FFFF \u8fdb\u884c\u4e0e\u8fd0\u7b97\u5f97\u5230\n\n4. \u5bf9\u548c\u6c42\u53cd\uff0c\u4ece\u800c\u5f62\u6210\u6821\u9a8c\u548c\u3002 // 32 \u4f4d\u622a\u65ad\u4e3a 16 \u4f4d\u5f97\u5230\u6821\u9a8c\u548c\n\n5. \u6821\u9a8c\u548c\u968f\u6570\u636e\u4e00\u8d77\u53d1\u9001\u3002  \n</code></pre></p> <p>\u63a5\u6536\u65b9\u903b\u8f91\uff1a <pre><code>1. \u62a5\u6587\u88ab\u5212\u5206\u4e3a 16 \u4f4d\u7684\u5b57\u3002\n\n2. \u7528\u4e8c\u8fdb\u5236\u53cd\u7801\u52a0\u6cd5\u628a\u6240\u6709\u7684\u5b57\u76f8\u52a0\u3002 \n\n3. \u5bf9\u548c\u6c42\u53cd\uff0c\u4ece\u800c\u751f\u6210\u65b0\u7684\u6821\u9a8c\u548c\u3002\n\n4. \u5982\u679c\u6821\u9a8c\u548c\u7684\u503c\u662f 0\uff0c\u62a5\u6587\u88ab\u63a5\u53d7\uff0c\u5426\u5219\uff0c\u62a5\u6587\u88ab\u62d2\u7edd\u3002  \n</code></pre></p> <p>\u4e8c\u8fdb\u5236\u53cd\u7801\u52a0\u6cd5\u6c42\u5f97\u7684\u548c\u4e0d\u53ef\u80fd\u5168\u90e8\u4e3a 0\uff0c\u56e0\u6b64\u6821\u9a8c\u548c\u5b57\u6bb5\u6b63\u5e38\u60c5\u51b5\u4e0b\u4e0d\u53ef\u80fd\u5168\u90e8\u4e3a 1\u3002</p>"},{"location":"ThreeMountains/Network/Network%20Tips/#tcp-udp","title":"\u4e3a\u4ec0\u4e48 TCP \u548c UDP \u7684\u6821\u9a8c\u548c\u8ba1\u7b97\u65f6\u8981\u589e\u52a0\u4f2a\u9996\u90e8\u90e8\u5206","text":"<p>\u4f2a\u9996\u90e8\u5305\u542b - \u6e90 IP \u5730\u5740 - \u76ee\u7684 IP \u5730\u5740\uff1a\u9632\u6b62\u6570\u636e\u5305\u88ab\u9519\u8bef\u7684\u9001\u8fbe\uff0c\u5982\u679c IP \u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u76ee\u7684\u5730\u5740\u53d1\u751f\u4e86\u6539\u53d8\uff0cIP \u7684\u6821\u9a8c\u548c\u7b97\u6cd5\u5e76\u4e0d\u4e00\u5b9a\u80fd\u591f\u68c0\u6d4b\u51fa\u6765\u3002 - \u8fd0\u8f93\u5c42\u534f\u8bae</p>"},{"location":"ThreeMountains/Network/Network%20Tips/#tcp","title":"TCP \u7684\u7f13\u5b58\u548c\u7a97\u53e3\u7684\u5173\u7cfb","text":"<p>\u6709 4 \u548c\u7f13\u5b58\uff0c\u5ba2\u6237\u7aef\u7684\u53d1\u9001\u548c\u63a5\u6536\u7f13\u5b58\uff0c\u670d\u52a1\u5668\u7684\u53d1\u9001\u548c\u63a5\u6536\u7f13\u5b58\u3002\u9700\u8981\u6ce8\u610f\u7684\u65f6\u5b83\u4eec\u90fd\u662f\u548c Scoket \u4e00\u4e00\u5bf9\u5e94\u7684\uff0c\u5e76\u4e0d\u662f\u64cd\u4f5c\u7cfb\u7edf\u5168\u5c40\u552f\u4e00\u7684\u3002</p>"},{"location":"ThreeMountains/Network/Network%20Tips/#_2","title":"\u5168\u53cc\u5de5\u3001\u534a\u53cc\u5de5\u548c\u5355\u5de5","text":"<p>\u5168\u53cc\u5de5 Full Duplex\uff0c\u662f\u6307\u5728\u540c\u4e00\u65f6\u95f4\uff0c\u6570\u636e\u53ef\u4ee5\u540c\u65f6\u53cc\u5411\u4f20\u8f93\uff0c\u5373\u901a\u4fe1\u7684\u4e24\u4e2a\u7aef\u70b9\u53ef\u4ee5\u540c\u65f6\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\u800c\u4e0d\u4f1a\u53d1\u751f\u78b0\u649e\u3002</p> <p>\u534a\u53cc\u5de5 Half Duplex\uff0c\u662f\u6307\u5728\u540c\u4e00\u65f6\u95f4\uff0c\u6570\u636e\u53ea\u80fd\u5728\u4e00\u4e2a\u65b9\u5411\u4e0a\u4f20\u8f93\u3002\u867d\u7136\u901a\u4fe1\u7684\u4e24\u4e2a\u7aef\u70b9\u90fd\u53ef\u4ee5\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\uff0c\u4f46\u4e0d\u80fd\u540c\u65f6\u8fdb\u884c\u3002\u4f8b\u5982\uff0c\u5bf9\u8bb2\u673a\u548c\u65e0\u7ebf\u7535\u901a\u4fe1\u5c31\u662f\u534a\u53cc\u5de5\u3002</p> <p>\u5355\u5de5 Simplex\uff0c\u662f\u6307\u6570\u636e\u53ea\u80fd\u5728\u4e00\u4e2a\u65b9\u5411\u4e0a\u4f20\u8f93\uff0c\u5e76\u4e14\u53ea\u80fd\u7531\u4e00\u4e2a\u8bbe\u5907\u53d1\u9001\u6570\u636e\uff0c\u53e6\u4e00\u4e2a\u8bbe\u5907\u53ea\u80fd\u63a5\u6536\u6570\u636e\u3002</p>"},{"location":"ThreeMountains/Network/Network%20Tips/#tcp-4gb","title":"TCP \u80fd\u4e0d\u80fd\u4f20\u8f93\u8d85\u8fc7 4GB \u7684\u6570\u636e","text":"<p>\u80af\u5b9a\u662f\u53ef\u4ee5\u7684\u3002</p> <p>\u9996\u5148\u867d\u7136 TCP \u7684\u5e8f\u53f7\u4e3a 32 \u4f4d\uff0c\u4f46\u662f\u5e8f\u53f7\u7684\u4e3b\u8981\u76ee\u7684\u8868\u793a\u5b57\u8282\u7684\u987a\u5e8f\uff0c\u5176\u6b21\u624d\u662f\u6807\u8bc6\u552f\u4e00\u4e00\u4e2a\u5b57\u8282\uff0c\u5e8f\u53f7\u7684\u503c\u5728\u8fbe\u5230\u6700\u5927\u503c\u4e4b\u540e\u5c06\u56de\u5230 0\u3002</p> <p>\u5982\u679c\u63a5\u6536\u65b9\u7684\u7f13\u5b58\u5927\u4e8e 4GB\uff0c\u90a3\u4e48\u53d1\u9001\u7aef\u4e0d\u5c31\u65e0\u6cd5\u5f04\u660e\u767d\u63a5\u6536\u65b9\u7684\u786e\u8ba4\u662f\u9488\u5bf9\u54ea\u4e00\u4e2a\u5b57\u8282\u7684\u4e86\u5417\uff1f\u63a5\u6536\u65b9\u7684\u7f13\u5b58\u5927\u5c0f\u5373\u7a97\u53e3\u5927\u5c0f\uff0c\u800c\u7a97\u53e3\u5927\u5c0f\u5b57\u6bb5\u662f 16 \u4f4d\u7684\uff0c\u4e0d\u4f1a\u8d85\u8fc7 65535 \u5b57\u8282\u3002\u6240\u4ee5\u95ee\u9898\u4e0d\u5b58\u5728\u3002\uff08\u5f53\u7136\uff0c64KB \u7684\u7a97\u53e3\u5927\u5c0f\u5bf9\u4e8e\u73b0\u5728\u8ba1\u7b97\u673a\u6765\u8bf4\u592a\u5c0f\u4e86\uff0c\u56e0\u6b64 TCP \u5f15\u5165\u4e86 TCP \u7a97\u53e3\u7f29\u653e\u9009\u9879\u4f5c\u4e3a\u7a97\u53e3\u7f29\u653e\u7684\u6bd4\u4f8b\u56e0\u5b50\uff0c\u6765\u6269\u5927\u7a97\u53e3\u7684\u5927\u5c0f\u3002\uff09</p>"},{"location":"ThreeMountains/Network/Network%20Tips/#tcp-ack","title":"TCP \u7eaf\u7684 ACK \u62a5\u6587\u6bb5\u4e0d\u6d88\u8017\u5e8f\u53f7","text":"<p>TCP \u4e2d\u7684\u7eaf ACK \u62a5\u6587\u6bb5\u4e0d\u6d88\u8017\u5e8f\u53f7\u3002</p> <p>\u5728 TCP \u534f\u8bae\u4e2d\uff0cACK \u62a5\u6587\u6bb5\u7528\u4e8e\u786e\u8ba4\u5df2\u7ecf\u6210\u529f\u63a5\u6536\u5230\u7684\u6570\u636e\u3002\u5f53\u63a5\u6536\u65b9\u6536\u5230\u6570\u636e\u540e\uff0c\u4f1a\u53d1\u9001\u4e00\u4e2a ACK \u62a5\u6587\u6bb5\u7ed9\u53d1\u9001\u65b9\uff0c\u4ee5\u786e\u8ba4\u63a5\u6536\u5230\u7684\u6570\u636e\u3002\u8fd9\u4e2a ACK \u62a5\u6587\u6bb5\u901a\u5e38\u4e0d\u5305\u542b\u4efb\u4f55\u6570\u636e\uff0c\u53ea\u6709\u4e00\u4e2a\u786e\u8ba4\u53f7\u5b57\u6bb5\uff0c\u7528\u6765\u6307\u793a\u4e0b\u4e00\u4e2a\u671f\u671b\u63a5\u6536\u7684\u6570\u636e\u7684\u5e8f\u53f7\u3002</p> <p>\u56e0\u6b64\uff0c\u7eaf ACK \u62a5\u6587\u6bb5\u4e0d\u643a\u5e26\u6570\u636e\uff0c\u4e5f\u4e0d\u6d88\u8017\u5e8f\u53f7\uff0c\u5b83\u4eec\u53ea\u662f\u7528\u6765\u8fdb\u884c\u6d41\u91cf\u63a7\u5236\u548c\u786e\u8ba4\u6570\u636e\u63a5\u6536</p>"},{"location":"ThreeMountains/Network/SSL/","title":"SSL","text":"<p>HTTPS \u53ea\u6709\u5728\u63e1\u624b\u9636\u6bb5\u624d\u4f7f\u7528\u975e\u5bf9\u79f0\u52a0\u5bc6\uff0c\u5728\u534f\u5546\u597d\u52a0\u5bc6\u5bc6\u94a5\u4e4b\u540e\uff0c\u540e\u7eed\u7684\u6d88\u606f\u90fd\u4f7f\u7528\u5bf9\u79f0\u52a0\u5bc6\u8fdb\u884c\u3002\u63d0\u9ad8\u6548\u7387\u3002</p> <p>\u516c\u94a5\u548c\u79c1\u94a5 1. \u516c\u94a5\u548c\u79c1\u94a5\u662f\u6210\u5bf9\u51fa\u73b0\u7684\uff0c\u516c\u94a5\u662f\u516c\u5f00\u7684\uff0c\u79c1\u94a5\u662f\u4fdd\u5bc6\u7684\u3002 2. \u6bcf\u4e00\u5bf9\u516c\u79c1\u94a5\u90fd\u53ea\u6709\u5bf9\u5e94\u7684\u53e6\u4e00\u65b9\u624d\u80fd\u89e3\u5bc6\u3002 3. \u901a\u5e38\u516c\u94a5\u7528\u6765\u52a0\u5bc6\uff0c\u56e0\u4e3a\u53ea\u6709\u79c1\u94a5\u624d\u80fd\u89e3\u5bc6\uff0c\u4fdd\u8bc1\u4e86\u6d88\u606f\u7684\u79c1\u5bc6\u6027\u3002 4. \u79c1\u94a5\u52a0\u5bc6\u901a\u5e38\u7528\u6765\u8fdb\u884c\u6570\u5b57\u7b7e\u540d\uff0c\u6570\u5b57\u7b7e\u540d\u7b80\u5355\u7406\u89e3\u5c31\u662f\u5bf9\u6d88\u606f\u7684\u6458\u8981\u8fdb\u884c\u52a0\u5bc6\uff0c\u9644\u5728\u6d88\u606f\u540e\u9762\u3002\u516c\u94a5\u8fdb\u884c\u89e3\u5bc6\u5f97\u5230\u6d88\u606f\u7684\u6458\u8981\uff0c\u7136\u540e\u548c\u81ea\u5df1\u8ba1\u7b97\u7684\u6458\u8981\u8fdb\u884c\u5339\u914d\u786e\u4fdd\u6d88\u606f\u7684\u6765\u6e90\u548c\u5b8c\u6574\u3002 5. \u5982\u4f55\u786e\u4fdd\u670d\u52a1\u7aef\u516c\u94a5\u7684\u4fe1\u4efb\u95ee\u9898\uff0c\u4e0d\u662f\u4f2a\u9020\u7684\u3002\u4e00\u822c\u670d\u52a1\u7aef\u7684\u516c\u94a5\u5305\u542b\u5728\u8bc1\u4e66\u91cc\u9762\uff0c\u8bc1\u4e66\u7531\u8bc1\u4e66\u9881\u53d1\u673a\u6784\u8fdb\u884c\u9881\u53d1\u548c\u7ba1\u7406\u3002 6. \u8bc1\u4e66\u9881\u53d1\u673a\u6784\u7684\u8bc1\u4e66\u4e00\u822c\u5185\u7f6e\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u3002\u8fd9\u6837\u5728\u63a5\u6536\u5230\u670d\u52a1\u7aef\u7684\u8bc1\u4e66\u7684\u65f6\u5019\uff0c\u7531\u64cd\u4f5c\u7cfb\u7edf\u5185\u7f6e\u7684\u8bc1\u4e66\u8fdb\u884c\u9a8c\u7b7e\uff0c\u5224\u65ad\u670d\u52a1\u7aef\u7684\u8bc1\u4e66\u662f\u5426\u7531\u53d7\u4fe1\u4efb\u7684\u8bc1\u4e66\u9881\u53d1\u673a\u6784\u9881\u53d1\u3002</p>"},{"location":"ThreeMountains/Network/%E7%A8%8B%E5%BA%8F%EF%BC%9A%E6%97%B6%E9%97%B4%E6%9C%8D%E5%8A%A1/","title":"\u7a0b\u5e8f\uff1a\u65f6\u95f4\u670d\u52a1","text":"<p>C \u8bed\u8a00\u670d\u52a1\u7aef <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n#include &lt;time.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;sys/socket.h&gt;\n\n#define MAXLINE 4096\n\nint main() {\n    int listenfd, connfd;\n    struct sockaddr_in serveraddr;\n\n    if ((listenfd = socket(AF_INET, SOCK_STREAM, 0)) == -1) \n    {\n        perror(\"socket error\");\n        exit(EXIT_FAILURE);\n    }\n\n    bzero(&amp;serveraddr, sizeof(serveraddr));\n    serveraddr.sin_family = AF_INET;\n    serveraddr.sin_addr.s_addr = htonl(INADDR_ANY);\n    serveraddr.sin_port = htons(13);\n\n    if (bind(listenfd, (struct sockaddr *)&amp;serveraddr, sizeof(serveraddr)) == -1) \n    {\n        perror(\"bind error\");\n        exit(EXIT_FAILURE);\n    }\n\n    if (listen(listenfd, 10) == -1) \n    {\n        perror(\"listen error\");\n        exit(EXIT_FAILURE);\n    }\n\n    printf(\"Time server is running...\\n\");\n\n    for (;;) \n    {\n        if ((connfd = accept(listenfd, (struct sockaddr *)NULL, NULL)) == -1) \n        {\n            perror(\"accept error\");\n            continue;\n        }\n\n        char buff[MAXLINE];\n        time_t ticks = time(NULL);\n        snprintf(buff, sizeof(buff), \"%.24s\\r\\n\", ctime(&amp;ticks));\n\n        if (write(connfd, buff, strlen(buff)) == -1) \n        {\n            perror(\"write error\");\n        }\n\n        close(connfd);\n    }\n\n    close(listenfd);\n\n    return 0;\n}\n</code></pre></p> <p>Java \u8bed\u8a00\u670d\u52a1\u7aef <pre><code>import java.io.*;\nimport java.net.*;\nimport java.time.*;\nimport java.time.format.*;\n\npublic class TimeServer {\n\n    private static final int PORT = 13;\n\n    private static DateTimeFormatter dtf = DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss.SSS\");\n\n    public static void main(String[] args) {\n        try(ServerSocket ss = new ServerSocket(PORT)) {\n            while(true) {\n                try (Socket socket = ss.accept()) {\n                    PrintWriter out = new PrintWriter(socket.getOutputStream());\n                    out.println(LocalDateTime.now().format(dtf));\n                    out.flush();\n                } catch(IOException e) {\n                    e.printStackTrace();\n                }\n            }\n\n        } catch(IOException e) {\n            e.printStackTrace();\n        }\n    } \n}\n</code></pre></p> <p>C \u8bed\u8a00\u5ba2\u6237\u7aef <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;arpa/inet.h&gt;\n#include &lt;string.h&gt;\n\n#define MAXLINE     4096\n\nint main(int argc, char **argv) {\n    int sockfd, n;\n    char recvline[MAXLINE + 1];\n\n    struct sockaddr_in serveraddr;\n\n    if (argc != 2)\n    {\n        printf(\"usage: a.out &lt;IPaddress&gt;\\n\");\n        exit(1);\n    }\n\n    if ((sockfd = socket(AF_INET, SOCK_STREAM, 0)) &lt; 0)\n    {\n        perror(\"socket error!\");\n        exit(1);\n    }\n\n    memset(&amp;serveraddr, 0, sizeof(serveraddr));\n    serveraddr.sin_family = AF_INET;\n    serveraddr.sin_port = htons(13);\n    if (inet_pton(AF_INET, argv[1], &amp;serveraddr.sin_addr) &lt;= 0)\n    {\n        printf(\"inet_pton error for %s\", argv[1]);\n        exit(1);\n    }\n\n    if (connect(sockfd, (struct sockaddr *) &amp;serveraddr, sizeof(serveraddr)) &lt; 0)\n    {\n        perror(\"connect error\");\n        exit(1);\n    }\n\n    while ((n = read(sockfd, recvline, MAXLINE)) &gt; 0)\n    {\n        recvline[n] = 0;\n        if (fputs(recvline, stdout) == EOF)\n        {\n            perror(\"fputs error\");\n            exit(1);\n        }\n    }\n\n    if (n &lt; 0)\n    {\n        perror(\"read error\");\n        exit(1);\n    }\n\n    close(sockfd);\n\n    exit(0);\n}\n</code></pre></p> <p>Java \u5ba2\u6237\u7aef <pre><code>import java.io.*;\nimport java.net.*;\nimport java.nio.charset.*;\nimport java.util.*;\n\npublic class TimeClient {\n\n    private static final String IP = \"106.15.72.83\";\n\n    private static final int POST = 13;\n\n    public static void main(String[] args) throws IOException{\n        try (Socket socket = new Socket(IP, 13);\n        Scanner scanner = new Scanner(socket.getInputStream(), StandardCharsets.UTF_8)) {\n            while(scanner.hasNextLine()) {\n                System.out.println(scanner.nextLine());\n            }\n        }\n\n    }\n}\n</code></pre></p> <p>bzero \u548c memset \u7684\u533a\u522b\uff0c\u524d\u8005\u4e13\u95e8\u5c06\u5185\u5b58\u533a\u57df\u8bbe\u7f6e\u4e3a 0\uff0c\u5e76\u4e0d\u662f\u6807\u51c6\u51fd\u6570\u3002\u540e\u8005\u66f4\u7075\u6d3b\u8bbe\u7f6e\u503c\uff0c\u4e00\u822c\u8bbe\u7f6e 0 \u6216 255\uff0c\u4e3a\u6807\u51c6\u5e93\u51fd\u6570\uff0c\u79fb\u690d\u6027\u9ad8\u3002</p> <p>perror \u8f93\u51fa\u4fe1\u606f\uff0c\u540c\u65f6\u4e5f\u4f1a\u8f93\u51fa\u6700\u540e\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\u662f\u5426\u6210\u529f\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AICMP/","title":"\u7f51\u7edc\u5c42\uff1aICMP","text":""},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AICMP/#icmp","title":"ICMP","text":"<p>\u7f51\u9645\u63a7\u5236\u62a5\u6587\u534f\u8bae\uff0cInternet Control Message Protocol\u3002</p> <p>IP \u534f\u8bae\u5c3d\u6700\u5927\u52aa\u529b\u7684\u670d\u52a1\uff0c\u628a\u6570\u636e\u4ece\u6e90\u70b9\u4ea4\u4ed8\u5230\u7ec8\u70b9\u3002\u4f46\u662f\u5b83\u6709\u4e24\u4e2a\u7f3a\u70b9\uff1a\u7f3a\u5c11\u5dee\u9519\u63a7\u5236\u548c\u7f3a\u5c11\u8f85\u52a9\u673a\u5236\u3002ICMPv4 \u5c31\u662f\u4e3a\u4e86\u8865\u507f\u8fd9\u4e24\u4e2a\u7f3a\u70b9\u8bbe\u8ba1\u7684\u3002</p> <p>\u5dee\u9519\u63a7\u5236\uff0c\u8bd5\u60f3\u5982\u679c IP \u6570\u636e\u62a5 TTL \u4e3a\u96f6\u8def\u7531\u5668\u5fc5\u987b\u4e22\u5f03\u6570\u636e\u65f6\uff0c\u600e\u4e48\u5904\u7406\uff1f\u5982\u679c\u76ee\u5f55\u4e3b\u673a\u5728\u9884\u8bbe\u7684\u65f6\u95f4\u8303\u56f4\u5185\u6ca1\u6709\u6536\u5230\u4e00\u4e2a\u6570\u636e\u62a5\u7684\u5168\u90e8\u5206\u7247\uff0c\u56e0\u800c\u5fc5\u987b\u628a\u5df2\u7ecf\u63a5\u6536\u7684\u5206\u7247\u5168\u90e8\u4e22\u5f03\u65f6\uff0c\u53c8\u8be5\u600e\u4e48\u5904\u7406\uff1f\u8fd9\u4e9b\u60c5\u51b5 IP \u534f\u8bae\u90fd\u6ca1\u6709\u5185\u5efa\u7684\u89e3\u51b3\u673a\u5236\u3002</p> <p>\u67e5\u8be2\u8f85\u52a9\u673a\u5236\uff0cIP \u534f\u8bae\u8fd8\u7f3a\u5c11\u4e3b\u673a\u7ba1\u7406\u548c\u67e5\u8be2\u6240\u9700\u8981\u7684\u673a\u5236\u3002\u5982\u5224\u65ad\u8def\u7531\u5668\u6216\u8005\u76ee\u7684\u4e3b\u673a\u662f\u5426\u6d3b\u8dc3\u3002</p> <p>ICMP \u7684\u8bbe\u8ba1\u5c31\u662f\u4e3a\u4e86\u5f25\u8865\u4e0a\u8ff0\u4e24\u4e2a\u7f3a\u61be\u7684\u3002ICMP \u534f\u8bae\u4f4d\u4e8e\u7f51\u7edc\u5c42\uff0c\u4f46\u662f\u5b83\u7684\u62a5\u6587\u5e76\u4e0d\u76f4\u63a5\u4f20\u8f93\u7ed9\u6570\u636e\u94fe\u8def\u5c42\u3002\u5b9e\u9645\u4e0a ICMP \u62a5\u6587\u8981\u9996\u5148\u5c01\u88c5\u6210 IP \u6570\u636e\u62a5\uff0c\u7136\u540e\u624d\u88ab\u4f20\u9012\u5230\u4e0b\u4e00\u5c42\u3002</p> <p></p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AICMP/#_1","title":"\u62a5\u6587\u683c\u5f0f","text":"<p>ICMP \u62a5\u6587\u7531\u4e00\u4e2a 8 \u5b57\u8282\u7684\u9996\u90e8\u548c\u53ef\u53d8\u957f\u7684\u6570\u636e\u90e8\u5206\u7ec4\u6210\u3002\u5bf9\u4e8e\u6bcf\u79cd\u7c7b\u578b\u7684\u62a5\u6587\uff0c\u9996\u90e8\u7684\u683c\u5f0f\u4e00\u822c\u90fd\u662f\u4e0d\u540c\u7684\uff0c\u4f46\u662f\u524d 4 \u4e2a\u5b57\u8282\u5bf9\u6240\u6709\u7684\u7c7b\u578b\u6765\u8bf4\u90fd\u662f\u76f8\u540c\u7684\u3002 </p> <p>\u7b2c\u4e00\u4e2a\u5b57\u6bb5\u662f ICMP \u62a5\u6587\u7684\u7c7b\u578b\u3002</p> \u7c7b\u578b \u62a5\u6587 \u79cd\u7c7b 3 \u7ec8\u70b9\u4e0d\u53ef\u8fbe\uff08destination-unreachable message\uff09 \u5dee\u9519\u62a5\u544a\u62a5\u6587 4 \u6e90\u70b9\u6291\u5236 \u5dee\u9519\u62a5\u544a\u62a5\u6587 11 \u8d85\u65f6 \u5dee\u9519\u62a5\u544a\u62a5\u6587 12 \u53c2\u6570\u95ee\u9898 \u5dee\u9519\u62a5\u544a\u62a5\u6587 5 \u6539\u53d8\u8def\u7531 \u5dee\u9519\u62a5\u544a\u62a5\u6587 8 \u6216 0 echo \u8bf7\u6c42\u6216\u56de\u7b54 \u67e5\u8be2\u62a5\u6587 13 \u6216 14 timestamp \u8bf7\u6c42\u6216\u56de\u7b54 \u67e5\u8be2\u62a5\u6587 ## \u67e5\u8be2\u62a5\u6587 <p>\u901a\u8fc7\u67e5\u8be2\u62a5\u6587\u6765\u5bf9\u67d0\u4e9b\u7f51\u7edc\u95ee\u9898\u8fdb\u884c\u8bca\u65ad\uff0c\u4e00\u5171\u8bbe\u8ba1\u4e86\u4e94\u5bf9\u4e0d\u540c\u7684\u62a5\u6587\uff0c\u4f46\u662f\u5176\u4e2d\u4e09\u5bf9\u5df2\u7ecf\u8fc7\u65f6\u3002\u76ee\u524d\u8fd8\u5728\u4f7f\u7528\u7684\uff1aecho-request \u548c echo-reply\uff0ctimestamp-request \u548c timestamp-reply\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AICMP/#echo-request-echo-reply","title":"echo-request \u548c echo-reply","text":"<p><code>echo-request</code> \u548c <code>echo-reply</code> \u62a5\u6587\u662f\u4e3a\u4e86\u8bca\u65ad\u800c\u8bbe\u8ba1\u7684\u3002<code>echo-request</code> \u548c <code>echo-reply</code> \u7ec4\u5408\u8d77\u6765\u786e\u5b9a\u4e86\u4e24\u4e2a\u7cfb\u7edf\uff08\u4e3b\u673a\u6216\u8def\u7531\u5668\uff09\u4e4b\u95f4\u80fd\u5426\u5f7c\u6b64\u901a\u4fe1\u3002</p> <p>echo-request \u548c echo-reply \u62a5\u6587\u53ef\u4ee5\u7528\u6765\u786e\u5b9a\u4e24\u53f0\u673a\u5668\u5728 IP \u7ea7\u80fd\u591f\u5f7c\u6b64\u901a\u4fe1\u3002\u56e0\u4e3a ICMP \u62a5\u6587\u88ab\u5c01\u88c5\u6210\u6570\u636e\u62a5\uff0c\u53d1\u9001 echo-request \u7684\u673a\u5668\u5728\u6536\u5230 echo-reply \u56de\u5230\u62a5\u6587\u65f6\uff0c\u5c31\u8bc1\u660e\u4e86\u53d1\u9001\u65b9\u548c\u63a5\u6536\u65b9\u4e4b\u95f4\u80fd\u591f\u7528 IP \u6570\u636e\u62a5\u8fdb\u884c\u901a\u4fe1\u3002\u6b64\u5916\uff0c\u8fd9\u8fd8\u8bc1\u660e\u4e86\u4e2d\u95f4\u7684\u8def\u7531\u5668\u80fd\u591f\u63a5\u6536\u3001\u5904\u7406\u548c\u8f6c\u53d1\u6570\u636e\u62a5\u3002\u901a\u5e38\u4f7f\u7528 ping \u547d\u4ee4\u6765\u6d4b\u8bd5\u4e3b\u673a\u7684\u53ef\u8fbe\u6027\u3002  \u6807\u8bc6\u7b26\u548c\u5e8f\u53f7\u5b57\u6bb5\u5728\u534f\u8bae\u4e2d\u6ca1\u6709\u6b63\u5f0f\u5b9a\u4e49\uff0c\u6709\u610f\u7531\u53d1\u9001\u65b9\u4efb\u610f\u4f7f\u7528\u3002\u6807\u8bc6\u7b26\u901a\u5e38\u4e0e\u53d1\u8d77\u8bf7\u6c42\u7684\u7684\u8fdb\u7a0bID\u662f\u4e00\u81f4\u7684\u3002</p> <p>echo-request \u53ef\u4ee5\u5305\u542b\u53ef\u9009\u6570\u636e\uff0c\u8fd9\u4e2a\u6570\u636e\u5fc5\u987b\u7531 echo-reply \u5728\u62a5\u6587\u4e2d\u4e00\u6478\u4e00\u6837\u7684\u91cd\u590d\u4e00\u904d\u3002</p> <p>\u6293\u5305\u6d4b\u8bd5</p> <p>ping \u767e\u5ea6\u7684\u57df\u540d\u3002 <pre><code>D:\\suomea-note&gt;ping baidu.com\n\n\u6b63\u5728 Ping baidu.com [39.156.66.10] \u5177\u6709 32 \u5b57\u8282\u7684\u6570\u636e:\n\u6765\u81ea 39.156.66.10 \u7684\u56de\u590d: \u5b57\u8282=32 \u65f6\u95f4=33ms TTL=50\n\u6765\u81ea 39.156.66.10 \u7684\u56de\u590d: \u5b57\u8282=32 \u65f6\u95f4=33ms TTL=50\n\u6765\u81ea 39.156.66.10 \u7684\u56de\u590d: \u5b57\u8282=32 \u65f6\u95f4=30ms TTL=50\n\u6765\u81ea 39.156.66.10 \u7684\u56de\u590d: \u5b57\u8282=32 \u65f6\u95f4=30ms TTL=50\n\n39.156.66.10 \u7684 Ping \u7edf\u8ba1\u4fe1\u606f:\n    \u6570\u636e\u5305: \u5df2\u53d1\u9001 = 4\uff0c\u5df2\u63a5\u6536 = 4\uff0c\u4e22\u5931 = 0 (0% \u4e22\u5931)\uff0c\n\u5f80\u8fd4\u884c\u7a0b\u7684\u4f30\u8ba1\u65f6\u95f4(\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d):\n    \u6700\u77ed = 30ms\uff0c\u6700\u957f = 33ms\uff0c\u5e73\u5747 = 31ms\n</code></pre></p> <p>wireshark \u6293\u5305\u8fc7\u6ee4 icmp \u80fd\u591f\u770b\u5230\u5bf9\u5e94\u7684 echo-request \u548c echo-reply \u8bf7\u6c42\u3002 </p> <p>\u7b2c\u4e00\u4e2a echo-request \u7b2c\u4e00\u4e2a echo-reply \u62a5\u6587\uff0c\u5bf9\u6bd4\u80fd\u591f\u53d1\u73b0\u4e24\u4e2a\u62a5\u6587\u7684\u53ef\u9009\u6570\u636e\u90e8\u5206\u662f\u4e00\u6837\u7684\uff0c\u5747\u4e3a 32 \u4e2a\u5b57\u8282\u3002  </p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AICMP/#_2","title":"\u65f6\u95f4\u6233\u8bf7\u6c42\u548c\u65f6\u95f4\u6233\u56de\u7b54","text":"<p>\u4e24\u4e2a\u4e3b\u673a\u53ef\u4ee5\u4f7f\u7528 temestamp-request \u548c timestamp-reply \u62a5\u6587\u6765\u786e\u5b9a IP \u6570\u636e\u62a5\u5728\u8fd9\u4e24\u4e2a\u673a\u5668\u4e4b\u95f4\u6765\u56de\u6240\u9700\u7684\u5f80\u8fd4\u65f6\u95f4\u3002\u5b83\u4e5f\u53ef\u4ee5\u7528\u4e8e\u540c\u6b65\u4e24\u4e2a\u673a\u5668\u7684\u65f6\u949f\uff08\u4e00\u822c\u5355\u72ec\u4f7f\u7528 NTP \u534f\u8bae\uff09\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AICMP/#_3","title":"\u5dee\u9519\u62a5\u544a\u62a5\u6587","text":"<p>IP \u662f\u4e00\u4e2a\u4e0d\u53ef\u9760\u7684\u534f\u8bae\uff0cIP \u5e76\u4e0d\u8003\u8651\u5dee\u9519\u68c0\u9a8c\u548c\u5dee\u9519\u63a7\u5236\u3002\u4e4b\u6240\u4ee5\u8bbe\u8ba1 ICMP \u5c31\u662f\u4e3a\u4e86\u5f25\u8865\u8fd9\u4e2a\u7f3a\u70b9\uff0c\u4e0d\u8fc7 ICMP \u4e0d\u80fd\u7ea0\u6b63\u5dee\u9519\uff0c\u5b83\u53ea\u662f\u7b80\u5355\u7684\u62a5\u544a\u5dee\u9519\u3002</p> <p>\u5dee\u9519\u7ea0\u6b63\u7559\u7ed9\u9ad8\u5c42\u534f\u8bae\u53bb\u9519\uff0c\u5dee\u9519\u62a5\u6587\u603b\u662f\u53d1\u7ed9\u6700\u521d\u7684\u6570\u636e\u6e90\uff0c\u56e0\u4e3a\u5728\u6570\u636e\u62a5\u4e2d\u5173\u4e8e\u8def\u7531\u7684\u552f\u4e00\u53ef\u7528\u4fe1\u606f\u5c31\u662f\u6e90 IP \u548c\u76ee\u7684 IP \u5730\u5740\u3002ICMP \u603b\u662f\u628a\u5dee\u9519\u62a5\u6587\u62a5\u7ed9\u6700\u521d\u7684\u6570\u636e\u6e90\u3002</p> <p>\u4e00\u5171\u6709 5 \u79cd\u5dee\u9519\u5904\u7406\uff0c\u5dee\u9519\u62a5\u544a\u62a5\u6587\u6709\u5982\u4e0b\u89c4\u5219\uff1a - \u5bf9\u4e8e\u643a\u5e26 ICMP \u5dee\u9519\u62a5\u6587\u7684\u6570\u636e\u62a5\uff0c\u4e0d\u518d\u4ea7\u751f ICMP \u5dee\u9519\u62a5\u6587\u3002\uff08\u662f\u4e0d\u662f ICMP \u5dee\u9519\u62a5\u6587\u5982\u679c\u4e22\u5931\u4e86\u4e5f\u5c31\u4e22\u5931\u4e86\u3002\uff09 - \u5bf9\u4e8e\u5206\u7247\u6570\u636e\u62a5\uff0c\u5982\u679c\u4e0d\u662f\u7b2c\u4e00\u4e2a\u5206\u7247\uff0c\u5219\u4e0d\u4ea7\u751f ICMP \u5dee\u9519\u62a5\u6587\u3002 - \u5bf9\u4e8e\u5177\u6709\u591a\u64ad\u5730\u5740\u7684\u6570\u636e\u62a5\uff0c\u4e0d\u4ea7\u751f ICMP \u5dee\u9519\u62a5\u6587\u3002 - \u5bf9\u4e8e\u5177\u6709\u7279\u6b8a\u5730\u5740\uff08\u5982 127.0.0.1 \u6216 0.0.0.0\uff09\u7684\u6570\u636e\u62a5\uff0c\u4e0d\u4ea7\u751f ICMP \u5dee\u9519\u62a5\u6587\u3002</p> <p>\u6240\u6709\u5dee\u9519\u62a5\u544a\u62a5\u6587\u90fd\u5305\u542b\u4e00\u4e2a\u6570\u636e\u90e8\u5206\uff0c\u5b83\u5305\u62ec\u539f\u59cb\u6570\u636e\u62a5\u7684 IP \u9996\u90e8\u518d\u52a0\u4e0a\u8be5\u6570\u636e\u62a5\u6570\u636e\u7684\u524d 8 \u4e2a\u5b57\u8282\u3002\u4e4b\u6240\u4ee5\u8981\u52a0\u4e0a\u539f\u59cb\u6570\u636e\u7684\u524d 8 \u4e2a\u5b57\u8282\u662f\u56e0\u4e3a\u8fd9\u524d 8 \u4e2a\u5b57\u8282\u63d0\u4f9b\u4e86\u5173\u4e8e\u7aef\u53e3\u53f7\uff08TCP \u548c UDP\uff09\u548c\u5e8f\u53f7\uff08TCP\uff09\u7684\u4fe1\u606f\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AICMP/#_4","title":"\u7ec8\u70b9\u4e0d\u53ef\u8fbe","text":"<p>\u5f53\u8def\u7531\u5668\u65e0\u6cd5\u4e3a\u4e00\u4e2a\u6570\u636e\u62a5\u627e\u5230\u8def\u7531\uff0c\u6216\u8005\u4e3b\u673a\u65e0\u6cd5\u4ea4\u4ed8\u4e00\u4e2a\u6570\u636e\u62a5\u65f6\uff0c\u8be5\u6570\u636e\u62a5\u88ab\u4e22\u5f03\uff0c\u7136\u540e\u7531\u8def\u7531\u5668\u6216\u4e3b\u673a\u5411\u53d1\u51fa\u8fd9\u4e2a\u6570\u636e\u62a5\u7684\u6e90\u4e3b\u673a\u8fd4\u56de\u4e00\u4e2a\u7ec8\u70b9\u4e0d\u53ef\u8fbe\u62a5\u6587\uff08destination-unreachable message\uff09\u3002</p> <p>\u7c7b\u578b\u4e3a 3\u3002</p> <p>\u4ee3\u7801 0\uff1a\u7f51\u7edc\u4e0d\u53ef\u8fbe\u3002\u53ef\u80fd\u662f\u786c\u4ef6\u53d1\u751f\u6545\u969c\u5bfc\u81f4\u7684\u3002 \u4ee3\u7801 1\uff1a\u4e3b\u673a\u4e0d\u53ef\u8fbe\u3002\u53ef\u80fd\u662f\u786c\u4ef6\u53d1\u751f\u6545\u969c\u5bfc\u81f4\u7684\u3002 \u4ee3\u7801 2\uff1a\u534f\u8bae\u4e0d\u53ef\u8fbe\u3002IP \u6570\u636e\u62a5\u53ef\u4ee5\u643a\u5e26\u5c5e\u4e8e\u67d0\u4e2a\u9ad8\u5c42\u534f\u8bae\u7684\u6570\u636e\uff0c\u5982 UDP\u3001TCP \u548c OSPF\u3002\u4f8b\u5982\uff0c\u76ee\u7684\u4e3b\u673a\u6536\u5230\u4e00\u4e2a\u6570\u636e\u62a5\u5fc5\u987b\u4ea4\u4ed8\u7ed9 TCP \u534f\u8bae\uff0c\u4f46 TCP \u534f\u8bae\u5e76\u672a\u8fd0\u884c\u3002 \u4ee3\u7801 3\uff1a\u7aef\u53e3\u4e0d\u53ef\u8fbe\u3002\u6570\u636e\u62a5\u8981\u4ea4\u4ed8\u7684\u76ee\u6807\u7a0b\u5e8f\u5e76\u672a\u8fd0\u884c\u3002 \u4ee3\u7801 4\uff1a\u9700\u8981\u8fdb\u884c\u5206\u7247\uff0c\u4f46\u662f IP \u6570\u636e\u62a5\u7684 DF \u5b57\u6bb5\u5df2\u88ab\u8bbe\u7f6e\u3002 \u4ee3\u7801 5\uff1a\u6e90\u8def\u7531\u4e0d\u80fd\u5b8c\u6210\uff0c\u5373\u5728\u6e90\u8def\u7531\u9009\u9879\u4e2d\u5b9a\u4e49\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u8def\u7531\u5668\u65e0\u6cd5\u901a\u8fc7\u3002 \u4ee3\u7801 6\uff1a\u76ee\u7684\u7f51\u7edc\u672a\u77e5\u3002\u4e0e\u4ee3\u7801 0 \u4e0d\u540c\u7684\u662f\uff0c\u4ee3\u7801 0 \u8868\u793a\u8def\u7531\u5668\u77e5\u9053\u76ee\u7684\u7f51\u7edc\u7684\u5b58\u5728\u800c\u65e0\u6cd5\u5230\u8fbe\uff0c\u4ee3\u7801 6 \u8868\u793a\u8def\u7531\u5668\u6ca1\u6709\u76ee\u7684\u7f51\u7edc\u7684\u4fe1\u606f\u3002 \u4ee3\u7801 7\uff1a\u76ee\u7684\u4e3b\u673a\u4f4d\u7f6e\u3002\u4e0e\u4ee3\u7801 1 \u4e0d\u540c\u7684\u662f\uff0c\u4ee3\u7801 1 \u8868\u793a\u8def\u7531\u5668\u77e5\u9053\u76ee\u7684\u4e3b\u673a\u7684\u5b58\u5728\u800c\u65e0\u6cd5\u5230\u8fbe\uff0c\u4ee3\u7801 7 \u8868\u793a\u8def\u7531\u5668\u6ca1\u6709\u76ee\u7684\u4e3b\u673a\u7684\u4fe1\u606f\u3002 \u4ee3\u7801 8\uff1a\u6e90\u4e3b\u673a\u88ab\u9694\u79bb\u4e86\u3002 \u4ee3\u7801 9\uff1a\u4ece\u7ba1\u7406\u4e0a\u7981\u6b62\u4e0e\u76ee\u7684\u7f51\u7edc\u901a\u4fe1\u3002 \u4ee3\u7801 10\uff1a\u4ece\u7ba1\u7406\u4e0a\u7981\u6b62\u4e0e\u76ee\u7684\u4e3b\u673a\u901a\u4fe1\u3002 \u4ee3\u7801 11\uff1a\u5bf9\u6307\u660e\u7684\u670d\u52a1\u7c7b\u578b\uff0c\u7f51\u7edc\u4e0d\u53ef\u8fbe\u3002 \u4ee3\u7801 12\uff1a\u5bf9\u6307\u660e\u7684\u670d\u52a1\u7c7b\u578b\uff0c\u4e3b\u673a\u4e0d\u53ef\u8fbe\u3002 \u4ee3\u7801 13\uff1a\u4e3b\u673a\u4e0d\u53ef\u8fbe\uff0c\u56e0\u4e3a\u7ba1\u7406\u5458\u5df2\u7ecf\u5728\u8fd9\u4e2a\u4e3b\u673a\u4e0a\u653e\u7f6e\u4e86\u8fc7\u6ee4\u5668\u3002 \u4ee3\u7801 14\uff1a\u4e3b\u673a\u4e0d\u53ef\u8fbe\uff0c\u56e0\u4e3a\u4e3b\u673a\u8fdd\u53cd\u4e86\u4f18\u5148\u7ea7\u7b56\u7565\u3002 \u4ee3\u7801 15\uff1a\u4e3b\u673a\u4e0d\u53ef\u8fbe\uff0c\u56e0\u4e3a\u5b83\u7684\u4f18\u5148\u7ea7\u88ab\u622a\u81f3\u3002</p> <p>\u4ee3\u7801 2 \u6216 3 \u7684\u7ec8\u70b9\u4e0d\u53ef\u8fbe\u62a5\u6587\u53ea\u80fd\u7531\u76ee\u7684\u4e3b\u673a\u521b\u5efa\u3002\u5176\u4f59\u7684\u7ec8\u70b9\u4e0d\u53ef\u8fbe\u62a5\u6587\u53ea\u80fd\u7531\u8def\u7531\u5668\u521b\u5efa\u3002 \u8def\u7531\u5668\u65e0\u6cd5\u68c0\u6d4b\u51fa\u5bfc\u81f4\u5206\u7ec4\u6ca1\u6709\u4ea4\u4ed8\u7684\u6240\u6709\u95ee\u9898\uff0c\u6240\u4ee5\u5373\u4f7f\u8def\u7531\u5668\u6ca1\u6709\u53d1\u9001\u7ec8\u70b9\u4e0d\u53ef\u8fbe\u62a5\u6587\uff0c\u4e5f\u4e0d\u4e00\u5b9a\u8868\u793a\u6570\u636e\u5df2\u7ecf\u88ab\u4ea4\u4ed8\u4e86\u3002</p> <p>\u9996\u90e8\u7684\u5176\u4f59\u90e8\u5206\u672a\u4f7f\u7528\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AICMP/#_5","title":"\u6e90\u70b9\u6291\u5236","text":"<p>IP \u534f\u8bae\u662f\u65e0\u8fde\u63a5\u534f\u8bae\u3002\u5728\u4ea7\u751f\u4ea7\u751f\u6570\u636e\u62a5\u7684\u6e90\u4e3b\u673a\u548c\u8f6c\u53d1\u6570\u636e\u62a5\u7684\u8def\u7531\u5668\u4ee5\u53ca\u5904\u7406\u6570\u636e\u62a5\u7684\u76ee\u7684\u4e3b\u673a\u4e4b\u95f4\u6ca1\u6709\u4efb\u4f55\u901a\u4fe1\u8054\u7cfb\u3002\u8fd9\u79cd\u7f3a\u4e4f\u901a\u4fe1\u6240\u5f15\u8d77\u7684\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\u7f3a\u4e4f\u6d41\u91cf\u63a7\u5236\u548c\u62e5\u585e\u63a7\u5236\u3002</p> <p>\u5728 IP \u534f\u8bae\u4e2d\u6ca1\u6709\u6d41\u91cf\u63a7\u5236\u548c\u62e5\u585e\u63a7\u5236\u3002</p> <p>\u6e90\u70b9 \u6291\u5236\u62a5\u6587 source-quench message\uff0c\u5373\u4f7f\u4e3a\u4e86\u7ed9 IP \u534f\u8bae\u589e\u52a0\u67d0\u79cd\u7a0b\u5ea6\u7684\u6d41\u91cf\u63a7\u5236\u548c\u62e5\u585e\u63a7\u5236\u800c\u8bbe\u8ba1\u7684\u3002</p> <p>\u5f53\u8def\u7531\u5668\u6216\u4e3b\u673a\u56e0\u62e5\u585e\u800c\u4e22\u5f03\u6570\u636e\u62a5\u65f6\uff0c\u5b83\u5c31\u5411\u8be5\u6570\u636e\u62a5\u53d1\u9001\u65b9\u53d1\u9001\u4e00\u4e2a\u6e90\u70b9\u6291\u5236\u62a5\u6587\u3002\u8fd9\u4e2a\u62a5\u6587\u6709\u4e24\u4e2a\u4f5c\u7528\u3002 - \u7b2c\u4e00\uff0c\u540c\u65f6\u6e90\u70b9\u6570\u636e\u5df2\u7ecf\u88ab\u4e22\u5f03\u3002</p> <ul> <li>\u7b2c\u4e8c\uff0c\u8b66\u544a\u6e90\u70b9\uff0c\u5728\u5f53\u524d\u94fe\u8def\u7684\u67d0\u5904\u51fa\u73b0\u4e86\u62e5\u585e\uff0c\u56e0\u800c\u6e90\u70b9\u8981\u653e\u6162\u53d1\u9001\u8fc7\u7a0b\u3002</li> </ul> <p>\u7c7b\u578b\u4e3a 4\u3002</p> <p>\u4ee3\u7801\u4e3a 0.</p> <p>\u9996\u90e8\u7684\u5176\u4f59\u90e8\u5206\u672a\u4f7f\u7528\u3002</p> <p>\u906d\u9047\u62e5\u585e\u7684\u8def\u7531\u5668\u6216\u76ee\u7684\u4e3b\u673a\u5fc5\u987b\u4e3a\u6bcf\u4e00\u4e2a\u4e22\u5f03\u7684\u6570\u636e\u62a5\u5411\u6e90\u4e3b\u673a\u53d1\u9001\u4e00\u4e2a\u6e90\u70b9\u6291\u5236\u62a5\u6587\u3002</p> <p>\u6ca1\u6709\u4e00\u79cd\u673a\u5236\u53ef\u4ee5\u544a\u8bc9\u6e90\u70b9\uff0c\u62e5\u585e\u5df2\u7ecf\u5f97\u5230\u7f13\u89e3\uff0c\u53ef\u4ee5\u6309\u7167\u539f\u6765\u7684\u901f\u7387\u53d1\u9001\u6570\u636e\u62a5\u4e86\u3002\u6e90\u70b9\u53ea\u662f\u4e0d\u65ad\u7684\u964d\u4f4e\u53d1\u9001\u901f\u7387\uff0c\u76f4\u5230\u4e0d\u518d\u6536\u5230\u66f4\u591a\u7684\u6e90\u70b9\u6291\u5236\u62a5\u6587\u4e3a\u6b62\u3002</p> <p>\u5728\u591a\u5bf9\u4e00\u7684\u901a\u4fe1\u60c5\u51b5\u4e0b\uff0c\u8def\u7531\u5668\u6216\u8005\u76ee\u7684\u4e3b\u673a\u5e76\u4e0d\u77e5\u9053\u54ea\u4e00\u4e2a\u6e90\u70b9\u5e94\u8be5\u5bf9\u62e5\u585e\u8d1f\u8d23\u3002\u6240\u4ee5\u5b83\u6709\u53ef\u80fd\u4e22\u5f03\u4e86\u4f4e\u901f\u7387\u6e90\u70b9\u7684\u6570\u636e\u5305\uff0c\u800c\u6ca1\u6709\u4e22\u5f03\u771f\u6b63\u4ea7\u751f\u62e5\u585e\u7684\u6e90\u70b9\u53d1\u9001\u7684\u6570\u636e\u62a5\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AICMP/#_6","title":"\u8d85\u65f6","text":"<p>\u8d85\u65f6\u62a5\u6587 time-exceeded message\uff0c\u5728\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5\u4ea7\u751f\u3002 - \u5f53\u8def\u7531\u5668\u53d1\u73b0 IP \u6570\u636e\u5305\u7684 TTL \u5b57\u6bb5\u53d8\u4e3a 0 \u540e\uff0c\u5c31\u4e22\u5f03\u8fd9\u4e2a\u6570\u636e\u62a5\uff0c\u5e76\u5411\u6e90\u70b9\u53d1\u9001\u4e00\u4e2a\u8d85\u65f6\u62a5\u6587\u3002</p> <ul> <li>\u5f53\u7ec4\u6210\u4e00\u4e2a\u62a5\u6587\u7684\u6240\u6709\u5206\u7247\u672a\u80fd\u5728\u67d0\u4e00\u9650\u5b9a\u65f6\u95f4\u5185\u5168\u90e8\u8fbe\u5230\u76ee\u7684\u4e3b\u673a\uff0c\u4e5f\u8981\u4ea7\u751f\u4e00\u4e2a\u8d85\u65f6\u62a5\u6587\u3002\u5f53\u7b2c\u4e00\u4e2a\u5206\u7247\u8fbe\u5230\u65f6\uff0c\u76ee\u7684\u4e3b\u673a\u5c31\u542f\u52a8\u4e00\u4e2a\u8ba1\u65f6\u5668\u3002\u5982\u679c\u8ba1\u65f6\u5668\u5230\u65f6\uff0c\u5374\u6ca1\u6709\u6536\u9f50\u6240\u6709\u7684\u5206\u7247\uff0c\u76ee\u7684\u4e3b\u673a\u5c31\u5c06\u5df2\u6536\u5230\u7684\u5206\u7247\u5168\u90e8\u4e22\u5f03\uff0c\u5e76\u5411\u6e90\u70b9\u53d1\u9001\u4e00\u4e2a\u8d85\u65f6\u62a5\u6587\u3002</li> </ul> <p>\u7c7b\u578b\u4e3a 11\u3002</p> <p>\u4ee3\u7801\u4e3a 0 \u6216 1\u30020 \u8868\u793a TTL \u539f\u56e0\u4e22\u5f03\uff0c\u4ec5\u4f9b\u8def\u7531\u5668\u4f7f\u7528\uff1b1 \u8868\u793a\u5206\u7247\u63a5\u6536\u8d85\u65f6\u4e22\u5f03\uff0c\u4ec5\u4f9b\u76ee\u7684\u4e3b\u673a\u4f7f\u7528\u3002</p> <p>\u9996\u90e8\u7684\u5176\u4f59\u90e8\u5206\u672a\u4f7f\u7528\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AICMP/#_7","title":"\u6821\u9a8c\u548c","text":"<p>\u53d1\u9001\u65b9\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u8ba1\u7b97\uff1a</p> <pre><code>1.\u628a\u6821\u9a8c\u548c\u5b57\u6bb5\u7f6e\u4e3a\u96f6\u3002\n\n2.\u8ba1\u7b97\u6240\u6709 16 \u4f4d\u5b57\uff08\u9996\u90e8\uff09\u4e4b\u548c\uff0c\u91c7\u7528\u4e8c\u8fdb\u5236\u53cd\u7801\u52a0\u6cd5\u3002\n\n3.\u628a\u5f97\u5230\u7684\u548c\u53d6\u53cd\u7801\u5b58\u50a8\u5728\u6821\u9a8c\u548c\u5b57\u6bb5\u4e2d\u3002\n</code></pre> <p>\u63a5\u6536\u65b9\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u68c0\u9a8c\uff1a</p> <pre><code>1.\u8ba1\u7b97\u6240\u6709 16 \u4f4d\u5b57\uff08\u9996\u90e8\uff09\u4e4b\u548c\uff0c\u91c7\u7528\u4e8c\u8fdb\u5236\u53cd\u7801\u52a0\u6cd5\u3002\n\n2.\u628a\u5f97\u5230\u7684\u548c\u6c42\u53cd\u7801\u3002\n\n3.\u5982\u679c\u6b65\u9aa4 2 \u5f97\u5230\u7684\u7ed3\u679c\u662f\u96f6\uff0c\u5219\u63a5\u53d7\u8fd9\u4e2a\u62a5\u6587\uff0c\u5426\u5219\u4e22\u5f03\u3002\n</code></pre>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AICMP/#ping","title":"Ping","text":"<p>ping \u4e3b\u8981\u901a\u8fc7 ICMP \u534f\u8bae\u6765\u8fdb\u6d4b\u8bd5\u7f51\u7edc IP \u5c42\u7684\u72b6\u51b5\u3002 <pre><code># ping [\u9009\u9879\u53c2\u6570] IP\n\n\u9009\u9879\u53c2\u6570\uff1a\n-c &lt;\u6570\u503c&gt;\uff1a\u540e\u9762\u63a5\u7684\u662f\u6267\u884c ping \u7684\u6b21\u6570\uff0c\u4f8b\u5982\uff0c-c 5\u3002\n\n-s &lt;\u6570\u503c&gt;\uff1a\u53d1\u9001\u51fa\u53bb ICMP \u5305\u542b\u53ef\u9009\u6570\u636e\u7684\u5927\u5c0f\uff0c\u9ed8\u8ba4\u4e3a 56 \u5b57\u8282\u3002\u4e00\u822c\u52a0\u4e0a 20 \u5b57\u8282\u7684 IP \u9996\u90e8\uff08\u4e0d\u5305\u542b options\uff09\u548c 8 \u5b57\u8282\u7684 ICMP \u9996\u90e8\u624d\u662f\u5230\u8fbe\u672c\u673a\u6570\u636e\u94fe\u8def\u5c42\u7684\u5927\u5c0f\u3002\n\n-t &lt;\u6570\u503c&gt;\uff1a\u6307\u5b9a IP \u534f\u8bae TTL \u751f\u5b58\u65f6\u95f4\u5b57\u6bb5\u7684\u503c\uff0c\u6bcf\u7ecf\u8fc7\u4e00\u4e2a\u8282\u70b9\u5c31\u4f1a\u5c11 1\u3002\n\n-W &lt;\u6570\u503c&gt;\uff1a\u7b49\u5f85\u5bf9\u65b9\u4e3b\u673a\u56de\u5e94\u7684\u79d2\u6570\u3002\n\n-M [do|dont|want]\uff1a\u7528\u4e8e\u8bbe\u7f6e\u8def\u5f84 MTU \u9650\u5236\u53ca\u63a7\u5236\u5206\u7247\u884c\u4e3a\uff0c\u4e3b\u8981\u7684\u9009\u9879\u662f\uff1a\n    do\uff1a\u8bbe\u7f6e IP \u9996\u90e8\u7684 DF\uff08Don't Fragment\uff09\u6807\u5fd7\u4e3a 1\uff0c\u4f7f\u6570\u636e\u94fe\u8def\u5c42\u4e0d\u80fd\u5bf9 IP \u6570\u636e\u62a5\u8fdb\u884c\u5206\u7247\uff0c\u5982\u679c\u6570\u636e\u94fe\u8def\u5c42\u4e0d\u80fd\u53d1\u9001\uff08\u8d85\u51fa MTU\uff09\u8be5\u6570\u636e\u62a5\u5219\u4e22\u5f03\u3002\n    dont\uff1a\u4e0d\u8bbe\u7f6e DF \u6807\u5fd7\uff0c\u8868\u793a IP \u6570\u636e\u62a5\u53ef\u4ee5\u88ab\u6570\u636e\u94fe\u8def\u5c42\u5206\u7247\u3002\n</code></pre></p> <p>ping \u6d4b\u8bd5\u793a\u4f8b <pre><code># ping -c 5 baidu.com\nPING baidu.com (110.242.68.66) 56(84) bytes of data.\n64 bytes from 110.242.68.66: icmp_seq=1 ttl=50 time=27.0 ms\n64 bytes from 110.242.68.66: icmp_seq=2 ttl=50 time=26.9 ms\n64 bytes from 110.242.68.66: icmp_seq=3 ttl=50 time=26.9 ms\n64 bytes from 110.242.68.66: icmp_seq=4 ttl=50 time=27.0 ms\n64 bytes from 110.242.68.66: icmp_seq=5 ttl=50 time=26.9 ms\n\n--- baidu.com ping statistics ---\n5 packets transmitted, 5 received, 0% packet loss, time 6043ms\nrtt min/avg/max/mdev = 26.927/26.948/26.979/0.019 ms\n</code></pre></p> <p>\u7b2c\u4e00\u884c <code>56(84) bytes of data</code> \u8868\u793a ICMP \u53ef\u9009\u6570\u636e\u7684\u5927\u5c0f\u4e3a 56 \u5b57\u8282\uff0c\u52a0\u4e0a 8 \u5b57\u8282\u7684 ICMP \u9996\u90e8\u548c 20 \u5b57\u8282\u7684 IP \u9996\u90e8\u5171 84 \u5b57\u8282\u3002</p> <p>\u7b2c\u4e8c\u884c  - 64 bytes\uff1a\u8868\u793a\u8fd9\u6b21\u4f20\u9001\u7684 ICMP \u6570\u636e\u5305\u7684\u5927\u5c0f\u4e3a 64 bytes\u3002 - icmp_seq=1\uff1aICMP \u4fa6\u6d4b\u8fdb\u884c\u7684\u6d4b\u8bd5\uff0c\u7b2c\u4e00\u6b21\u5c31\u4e3a 1. - ttl=50\uff1aIP \u9996\u90e8 TTL\u5b57\u6bb5\u7684\u503c\uff0c\u9ed8\u8ba4\u4e3a 50\uff0c\u53ef\u4ee5\u4f7f\u7528 -t \u8fdb\u884c\u8bbe\u7f6e\u3002 - time=27.0ms\uff1aIMCP \u6570\u636e\u62a5\u7684\u5f80\u8fd4\u4f20\u64ad\u65f6\u95f4\uff0cRound-Trip Time\uff0crtt\u3002</p> <p>ping \u901a\u8fc7\u672c\u673a\u65f6\u95f4\u6d4b\u8bd5 rtt = echo-request \u53d1\u9001\u51fa\u53bb\u7684\u65f6\u95f4 - echo-reply \u63a5\u53d7\u5230\u7684\u65f6\u95f4\u3002NTP \u5148\u6d4b\u8bd5 delay\uff0c\u7136\u540e\u518d\u6839\u636e delay \u6d4b\u8bd5\u673a\u5668\u4e4b\u524d\u7684 offset\u3002</p> <p>\u6700\u540e\u4e09\u884c\u4e3a\u7edf\u8ba1\u4fe1\u606f\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AICMP/#ping-mtu","title":"\u7528 ping \u6765\u8ffd\u8e2a\u8def\u5f84 MTU \u6570\u503c\u3002","text":"<pre><code>ping -s 100 -M do baidu.com\n</code></pre> <p><code>-s</code> \u8bbe\u7f6e\u4e86 ICMP \u53ef\u9009\u6570\u636e\u5927\u5c0f\u3002</p> <p><code>-M do</code> \u8868\u793a\u6570\u636e\u94fe\u8def\u5c42\u4e0d\u80fd\u5206\u7247 IP \u6570\u636e\u62a5\u3002</p> <p>\u5982\u679c\u6267\u884c\u547d\u4ee4\u6ca1\u6709\u53cd\u5e94\uff0c\u5219\u8868\u793a\u8def\u5f84 MTU \u5c0f\u4e8e 100 + 8 + 20 \u5b57\u8282\u3002\u4e00\u822c\u4ee5\u592a\u7f51\u5361\u7684 MTU \u4e3a 1500 \u5b57\u8282\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/","title":"\u7f51\u7edc\u5c42\uff1aIP","text":""},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/#_1","title":"\u5e38\u89c4\u9996\u90e8\u90e8\u5206","text":"<p>\u7f51\u7edc\u5c42\u7684\u5206\u7ec4\u79f0\u4e3a\u6570\u636e\u62a5 <code>datagram</code>\u3002</p> <p>\u6570\u636e\u62a5\u4e24\u4e2a\u90e8\u5206\u7ec4\u6210\uff1a\u9996\u90e8\u548c\u6570\u636e\u3002\u9996\u90e8\u957f\u5ea6\u53ef\u4ee5\u662f 20~60 \u5b57\u8282\uff0c\u5305\u542b\u6709\u5173\u8def\u7531\u9009\u62e9\u548c\u4ea4\u4ed8\u7684\u91cd\u8981\u4fe1\u606f\u3002</p> <p>IP \u6570\u636e\u62a5\u7684\u9996\u90e8\u683c\u5f0f\u5982\u4e0b\u3002 </p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/#ver","title":"\u7248\u672c <code>VER</code>","text":"<p>\u5b9a\u4e49\u4e2a IP \u534f\u8bae\u7684\u7248\u672c\u3002\u76ee\u524d\u7684\u7248\u672c\u662f 4\uff0c\u4f46\u662f\u5c06\u6765\u7684\u7248\u672c 6 \u53ef\u80fd\u4f1a\u53d6\u4ee3\u7248\u672c 4\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/#hlen","title":"\u9996\u90e8\u957f\u5ea6 <code>HLEN</code>","text":"<p>\u5b9a\u4e49\u4e86\u6570\u636e\u62a5\u9996\u90e8\u7684\u957f\u5ea6\uff0c\u4ee5 4 \u5b57\u8282\u4e3a\u5355\u4f4d\u8ba1\u7b97\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/#type-of-service-tos","title":"\u670d\u52a1\u7c7b\u578b <code>type of service, TOS</code>","text":"<p>\u73b0\u5728\u5927\u591a\u6570 TCP/IP \u5b9e\u73b0\u90fd\u4e0d\u652f\u6301 <code>TOS</code> \u7279\u6027\uff0c\u4e00\u822c\u8bbe\u7f6e\u5168\u96f6\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/#_2","title":"\u603b\u957f\u5ea6","text":"<p>\u5b9a\u4e49\u4e86\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u7684\u6570\u636e\u62a5\u603b\u957f\u5ea6\uff08\u9996\u90e8\u52a0\u4e0a\u6570\u636e\uff09\u3002\u56e0\u4e3a\u603b\u957f\u5ea6\u7684\u5b57\u6bb5\u662f 16 \u4f4d\uff0c\u56e0\u6b64 IP \u6570\u636e\u62a5\u957f\u5ea6\u9650\u5236\u5728 65535 \u5b57\u8282\uff0c\u5176\u4e2d\u9996\u90e8\u5360 20~60 \u5b57\u8282\uff0c\u5269\u4e0b\u7684\u662f\u4ece\u4e0a\u5c42\u4f20\u9001\u8fc7\u6765\u7684\u6570\u636e\u3002</p> <p>\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u5e76\u4e0d\u9700\u8981\u603b\u957f\u5ea6\u5b57\u6bb5\uff0c\u56e0\u4e3a\u5e27\u5265\u53bb\u5e27\u9996\u90e8\u548c\u5c3e\u90e8\u4e4b\u540e\u5269\u4e0b\u7684\u5c31\u662f IP \u6570\u636e\u62a5\u4e86\u3002\u4f46\u662f\u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5c01\u88c5\u5728\u5e27\u91cc\u9762\u7684\u5e76\u4e0d\u4ec5\u4ec5\u662f\u6570\u636e\u62a5\uff0c\u8fd8\u53ef\u80fd\u6dfb\u52a0\u4e86\u4e00\u4e9b\u586b\u5145\u3002\u4f8b\u5982\uff0c\u4ee5\u592a\u7f51\u534f\u8bae\u5bf9\u5e27\u91cc\u7684\u6570\u636e\u6709\u6700\u5c0f\u503c\u548c\u6700\u5927\u503c\u7684\u9650\u5236\uff0846~1500 \u5b57\u8282\uff09\u3002\u5f53 IP \u6570\u636e\u62a5\u7684\u957f\u5ea6\u5c0f\u4e8e 46 \u5b57\u8282\u65f6\uff0c\u9700\u8981\u589e\u52a0\u4e00\u4e9b\u586b\u5145\u5b57\u8282\u624d\u80fd\u6ee1\u8db3\u8fd9\u4e2a\u8981\u6c42\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u63a5\u6536\u5e27\u7684\u673a\u5668\u5fc5\u987b\u68c0\u67e5\u603b\u957f\u5ea6\u5b57\u6bb5\u624d\u80fd\u786e\u5b9a\u6570\u636e\u7684\u771f\u6b63\u957f\u5ea6\u548c\u586b\u5145\u5b57\u8282\u7684\u957f\u5ea6\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/#_3","title":"\u6807\u8bc6","text":"<p>IP \u6570\u636e\u62a5\u7684\u6700\u5927\u957f\u5ea6\u4e3a 65535 \u5b57\u8282\u3002\u7531\u4e8e\u6570\u636e\u62a5\u53ef\u80fd\u4f1a\u7ecf\u8fc7\u4e0d\u540c\u7684\u7f51\u7edc\uff0c\u5982\u679c\u7f51\u7edc\u7684 MTU \u5c0f\u4e8e\u6570\u636e\u62a5\u7684\u5927\u5c0f\uff0c\u90a3\u4e48\u4e3a\u4e86\u8ba9\u6570\u636e\u62a5\u901a\u8fc7\u7f51\u7edc\u5c31\u8981\u5206\u5272\u6570\u636e\u62a5\u3002</p> <p>\u6e90\u70b9\u901a\u5e38\u4e0d\u4f1a\u5bf9 IP \u6570\u636e\u5427\u8fdb\u884c\u5206\u7247\u3002\u56e0\u4e3a\u8fd0\u8f93\u5c42\u4f1a\u628a\u6570\u636e\u5212\u5206\u6210 IP \u4e0e\u6e90\u70b9\u4f7f\u7528\u7684\u6570\u636e\u94fe\u8def\u5c42\u53ef\u63a5\u7eb3\u7684\u5927\u5c0f\u3002</p> <p>\u5f53\u6570\u636e\u62a5\u88ab\u5206\u7247\u65f6\uff0c\u9996\u90e8\u4e2d\u7684\u4e00\u4e9b\u5fc5\u8981\u7684\u90e8\u5206\u5fc5\u987b\u88ab\u590d\u5236\u5230\u6240\u6709\u7684\u5206\u7247\u4e2d\u3002\u5bf9\u6570\u636e\u62a5\u8fdb\u884c\u5206\u7247\u7684\u4e3b\u673a\u6216\u8def\u7531\u5668\u5fc5\u987b\u6539\u53d8\u7684\u4e09\u4e2a\u5b57\u6bb5\u7684\u503c\uff1a\u6807\u5fd7\u3001\u5206\u7247\u504f\u79fb\u548c\u603b\u957f\u5ea6\u3002\u5176\u4f59\u7684\u4e2a\u5b57\u6bb5\u5fc5\u987b\u88ab\u590d\u5236\u3002</p> <p>\u5f53\u7136\uff0c\u4e0d\u7ba1\u662f\u5426\u8fdb\u884c\u5206\u7247\uff0c\u6821\u9a8c\u548c\u7684\u503c\u603b\u662f\u8981\u91cd\u65b0\u8ba1\u7b97\u7684\u3002\u56e0\u4e3a\u6570\u636e\u62a5\u6bcf\u7ecf\u8fc7\u4e00\u8df3\uff0cTTL \u7684\u503c\u90fd\u4f1a\u53d1\u751f\u6539\u53d8\u3002</p> <p>\u8be5\u5b57\u6bb5\u6807\u5fd7\u4e86\u4ece\u6e90\u4e3b\u673a\u53d1\u51fa\u7684\u4e00\u4e2a\u6570\u636e\u62a5\u3002\u5f53\u6570\u636e\u62a5\u4ece\u6e90\u4e3b\u673a\u79bb\u5f00\u4e4b\u540e\uff0c\u6807\u8bc6\u5b57\u6bb5\u4e0e\u6e90 IP \u5730\u5740\u7684\u7ec4\u5408\u552f\u4e00\u5730\u786e\u5b9a\u4e86\u8fd9\u4e2a\u6570\u636e\u62a5\u3002</p> <p>IP \u534f\u8bae\u4f7f\u7528\u4e86\u4e00\u4e2a\u8ba1\u6570\u5668\u6765\u4e3a\u6570\u636e\u62a5\u751f\u6210\u6807\u8bc6\uff0c\u521d\u59cb\u503c\u4e3a\u6b63\u6574\u6570\u3002\u5f53 IP \u534f\u8bae\u6bcf\u53d1\u9001\u4e00\u4e2a\u6570\u636e\u62a5\u65f6\uff0c\u5c31\u628a\u8fd9\u4e2a\u8ba1\u6570\u5668\u7684\u5f53\u524d\u503c\u590d\u5236\u5230\u6807\u8bc6\u5b57\u6bb5\u4e2d\uff0c\u5e76\u628a\u8ba1\u6570\u5668\u7684\u503c\u52a0 1\u3002</p> <p>\u5728\u6570\u636e\u62a5\u5206\u7247\u65f6\uff0c\u6807\u8bc6\u5b57\u6bb5\u7684\u503c\u8981\u590d\u5236\u5230\u6240\u6709\u7684\u5206\u7247\u4e2d\u3002\u6240\u6709\u7684\u5206\u7247\u90fd\u5177\u6709\u76f8\u540c\u7684\u6807\u8bc6\uff0c\u8fd9\u4e2a\u6807\u8bc6\u5728\u7ec8\u70b9\u91cd\u88c5\u6570\u636e\u62a5\u65f6\u5f88\u6709\u7528\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/#_4","title":"\u6807\u5fd7","text":"<p>\u8fd9\u662f 3 \u4f4d\u7684\u5b57\u6bb5\u3002</p> <p>\u7b2c\u4e00\u4f4d\u4fdd\u7559\u3002</p> <p>\u7b2c\u4e8c\u4f4d\u79f0\u4e3a \u201c\u4e0d\u5206\u7247\u201d\uff0c<code>Don't Fragment\uff0cDF</code> \u4f4d\u3002</p> <p>\u5982\u679c\u503c\u662f 1\uff0c\u673a\u5668\u5c31\u4e0d\u80fd\u5bf9\u8be5\u6570\u636e\u62a5\u8fdb\u884c\u5206\u7247\u3002\u5982\u679c\u4e0d\u5206\u7247\u4e0d\u80fd\u901a\u8fc7\u8be5\u7269\u7406\u7f51\u7edc\uff0c\u5c31\u4e22\u5f03\u8fd9\u4e2a\u6570\u636e\u62a5\uff0c\u5e76\u5411\u6e90\u4e3b\u673a\u53d1\u9001 ICMP \u62a5\u6587\uff08\u7ec8\u70b9\u4e0d\u53ef\u8fbe\u62a5\u6587\uff0c\u4ee3\u7801 4\uff09\u3002</p> <p>\u5982\u679c\u503c\u662f 0\uff0c\u5219\u53ef\u5728\u5fc5\u8981\u65f6\u5bf9\u8fd9\u4e2a\u6570\u636e\u62a5\u8fdb\u884c\u5206\u7247\u3002</p> <p>\u7b2c\u4e09\u4f4d\u662f \u201c\u8fd8\u6709\u5206\u7247\u201d \u4f4d\uff0c1 \u8868\u793a\u8fd9\u4e2a\u6570\u636e\u62a5\u4e0d\u662f\u6700\u540e\u7684\u5206\u7247\uff0c\u5728\u8fd9\u4e2a\u5206\u7247\u540e\u8fd8\u6709\u66f4\u591a\u7684\u5206\u7247\uff1b0 \u8868\u793a\u8fd9\u662f\u6700\u540e\u7684\u6216\u552f\u4e00\u7684\u5206\u7247\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/#_5","title":"\u5206\u7247\u504f\u79fb","text":"<p>\u8fd9\u4e2a 13 \u4f4d\u7684\u5b57\u6bb5\u8868\u793a\u7684\u662f\u5206\u7247\u5728\u6574\u4e2a\u6570\u636e\u62a5\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\uff0c\u5373\u6570\u636e\u5728\u539f\u59cb\u6570\u636e\u62a5\u4e2d\u7684\u504f\u79fb\u91cf\uff0c\u4ee5 8 \u5b57\u8282\u4e3a\u5ea6\u91cf\u5355\u4f4d\u3002</p> <p>\u4f8b\u5982\uff0c\u4e00\u4e2a\u6709 4000 \u5b57\u8282\u6570\u636e\u7684\u6570\u636e\u62a5\u88ab\u5212\u5206\u4e3a\u4e09\u4e2a\u5206\u7247\uff0c0~3999 \u5b57\u8282\u7684\u6570\u636e\u662f\u7b2c\u4e00\u4e2a\u5206\u7247\uff0c1400~2799 \u4e3a\u7b2c\u4e8c\u4e2a\u5206\u7247\uff0c2800~3999 \u4e3a\u7b2c\u4e09\u4e2a\u5206\u7247\uff0c\u90a3\u4e48\u4e09\u4e2a\u5206\u7247\u7684\u5206\u7247\u504f\u79fb\u5b57\u6bb5\u503c\u4e3a\uff1a0/8=0\uff0c1400/8=175\uff0c2800/8=350\u3002</p> <p>\u6240\u6709\u7684\u5206\u7247\u7684\u6807\u8bc6\u5b57\u6bb5\u503c\u90fd\u662f\u4e00\u6837\u7684\u3002\u9664\u6700\u540e\u4e00\u4e2a\u5206\u7247\u5916\uff0c\u6240\u6709\u5206\u7247\u7684\u6807\u5fd7\u5b57\u6bb5\u7684 \u201c\u8fd8\u6709\u5206\u7247\u201d \u4f4d\u5747\u88ab\u7f6e 1\u3002  \u4e0a\u56fe\u63cf\u7ed8\u4e86\u5982\u679c\u5206\u7247\u8fd8\u6709\u5206\u7247\u65f6\u7684\u60c5\u51b5\uff0c\u5206\u7247\u504f\u79fb\u503c\u6c38\u8fdc\u662f\u76f8\u5bf9\u539f\u59cb\u6570\u636e\u62a5\u7684\u3002</p> <p>\u5373\u4f7f\u5206\u7247\u91c7\u7528\u4e0d\u540c\u7684\u8def\u5f84\u5e76\u5931\u5e8f\u5230\u8fbe\uff0c\u6700\u7ec8\u7684\u76ee\u7684\u4e3b\u673a\u4e5f\u80fd\u591f\u7528\u6536\u5230\u7684\u5206\u7247\uff08\u5047\u8bbe\u6ca1\u6709\u4e00\u4e2a\u4e22\u5931\uff09\u91cd\u88c5\u6210\u539f\u59cb\u7684\u6570\u636e\u62a5\uff0c\u4f7f\u7528\u7684\u7b56\u7565\u5982\u4e0b\uff1a <pre><code>1. \u7b2c\u4e00\u4e2a\u5206\u7247\u7684\u5206\u7247\u504f\u79fb\u5b57\u6bb5\u503c\u4e3a 0\u3002\n\n2. \u628a\u7b2c\u4e00\u4e2a\u5206\u7247\u7684\u957f\u5ea6\u9664\u4ee5 8\uff0c\u8fd9\u4e2a\u7ed3\u679c\u5c31\u662f\u7b2c\u4e8c\u4e2a\u5206\u7247\u7684\u5206\u7247\u504f\u79fb\u503c\u3002\n\n3. \u628a\u7b2c\u4e00\u4e2a\u548c\u7b2c\u4e8c\u4e2a\u5206\u7247\u7684\u6570\u636e\u603b\u957f\u5ea6\u9664\u4ee5 8\uff0c\u8fd9\u4e2a\u7ed3\u679c\u5c31\u662f\u7b2c\u4e09\u4e2a\u5206\u7247\u7684\u5206\u7247\u504f\u79fb\u503c\u3002\n\n4. \u7ee7\u7eed\u4ee5\u4e0a\u8fc7\u7a0b\u3002\u6700\u540e\u4e00\u4e2a\u5206\u7247\u7684 \u201c\u8fd8\u6709\u5206\u7247\u201d \u4f4d\u7684\u503c\u662f 0\u3002\n</code></pre></p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/#time-to-livettl","title":"\u751f\u5b58\u65f6\u95f4 <code>time-to-live\uff0cTTL</code>","text":"<p>\u8be5\u5b57\u6bb5\u8bbe\u7f6e\u4e86\u6570\u636e\u62a5\u53ef\u4ee5\u7ecf\u8fc7\u7684\u6700\u591a\u8def\u7531\u5668\u6570\u3002\u5b83\u6307\u5b9a\u4e86\u6570\u636e\u62a5\u7684\u751f\u5b58\u65f6\u95f4\u3002<code>TTL</code> \u7684\u521d\u59cb\u503c\u7531\u6e90\u4e3b\u673a\u8bbe\u7f6e\uff08\u901a\u5e38\u4e3a 32 \u6216 64\uff09\uff0c\u4e00\u65e6\u7ecf\u8fc7\u4e00\u4e2a\u5904\u7406\u5b83\u7684\u8def\u7531\u5668\uff0c\u5b83\u7684\u503c\u5c31\u51cf\u53bb 1\u3002\u5f53\u8be5\u5b57\u6bb5\u7684\u503c\u4e3a 0 \u65f6\uff0c\u6570\u636e\u62a5\u5c31\u88ab\u4e22\u5f03\u3002\u5e76\u53d1\u9001 ICMP \u62a5\u6587\uff08\u7c7b\u578b\u4e3a\u8d85\u65f6\uff09\u901a\u77e5\u6e90\u4e3b\u673a\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/#_6","title":"\u534f\u8bae","text":"<p>\u5b9a\u4e49\u4e86\u4f7f\u7528\u6b64 IP \u5c42\u670d\u52a1\u7684\u9ad8\u5c42\u534f\u8bae\uff08\u4e0d\u4e00\u662f\u8fd0\u8f93\u5c42\uff0c\u4e5f\u53ef\u80fd\u662f\u7f51\u7edc\u5c42\u7684\u5176\u5b83\u534f\u8bae\uff09\u3002 <pre><code>| 1   - ICMP \n| 2   - IGMP \n| 6   - TCP  \n| 17  - UDP \n| 89  - OSPF \n</code></pre></p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/#_7","title":"\u6821\u9a8c\u548c","text":"<p>\u6821\u9a8c\u548c\u80fd\u591f\u9632\u6b62\u5206\u7ec4\u5728\u4f20\u8f93\u671f\u95f4\u51fa\u73b0\u635f\u574f\u3002\u53d1\u9001\u7aef\u8ba1\u7b97\u6821\u9a8c\u548c\uff0c\u5e76\u628a\u5f97\u5230\u7684\u7ed3\u679c\u4e0e\u5206\u7ec4\u4e00\u8d77\u53d1\u9001\u51fa\u53bb\u3002</p> <p>IP \u5206\u7ec4\u4e2d\u7684\u6821\u9a8c\u548c\u4ec5\u8986\u76d6\u9996\u90e8\uff0c\u800c\u4e0d\u7ba1\u6570\u636e\u3002\u4e24\u4e2a\u539f\u56e0\uff0c\u9996\u5148\uff0c\u5c06\u6570\u636e\u5c01\u88c5\u5728 IP \u6570\u636e\u5305\u4e2d\u7684\u6240\u6709\u9ad8\u5c42\u534f\u8bae\u90fd\u6709\u4e00\u4e2a\u6d89\u53ca\u6574\u5408\u5206\u7ec4\u7684\u6821\u9a8c\u548c\u5b57\u6bb5\u3002\u56e0\u6b64\uff0cIP \u6570\u636e\u62a5\u7684\u6821\u9a8c\u548c\u5c31\u4e0d\u5fc5\u518d\u68c0\u9a8c\u6240\u5c01\u88c5\u7684\u6570\u636e\u3002\u5176\u6b21\uff0c\u6bcf\u7ecf\u8fc7\u4e00\u4e2a\u8def\u7531\u5668\uff0cIP \u6570\u636e\u62a5\u7684\u9996\u90e8\u90fd\u8981\u53d1\u751f\u53d8\u5316\uff0c\u4f46\u6570\u636e\u90e8\u5206\u4fdd\u6301\u4e0d\u53d8\u3002\u56e0\u6b64\u6821\u9a8c\u548c\u53ea\u5bf9\u53d1\u751f\u53d8\u5316\u7684\u90e8\u5206\u8fdb\u884c\u68c0\u9a8c\u3002</p> <p>IP \u534f\u8bae\u4e3b\u8981\u662f\u4e3a\u4e86\u8def\u7531\u548c\u8f6c\u53d1\u6570\u636e\u5305\uff0c\u81f3\u4e8e\u7aef\u5230\u7aef\u7684\u6570\u636e\u5b8c\u6574\u6027\u6821\u9a8c\u4ea4\u7531\u4e0a\u5c42\u7684\u534f\u8bae\u5904\u7406\u3002</p> <p>\u53d1\u9001\u65b9\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u8ba1\u7b97\uff1a</p> <pre><code>1.\u628a\u6821\u9a8c\u548c\u5b57\u6bb5\u7f6e\u4e3a\u96f6\u3002\n\n2.\u8ba1\u7b97\u6240\u6709 16 \u4f4d\u5b57\uff08\u9996\u90e8\uff09\u4e4b\u548c\uff0c\u91c7\u7528\u4e8c\u8fdb\u5236\u53cd\u7801\u52a0\u6cd5\u3002\n\n3.\u628a\u5f97\u5230\u7684\u548c\u53d6\u53cd\u7801\u5b58\u50a8\u5728\u6821\u9a8c\u548c\u5b57\u6bb5\u4e2d\u3002\n</code></pre> <p>\u63a5\u6536\u65b9\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u68c0\u9a8c\uff1a</p> <pre><code>1.\u8ba1\u7b97\u6240\u6709 16 \u4f4d\u5b57\uff08\u9996\u90e8\uff09\u4e4b\u548c\uff0c\u91c7\u7528\u4e8c\u8fdb\u5236\u53cd\u7801\u52a0\u6cd5\u3002\n\n2.\u628a\u5f97\u5230\u7684\u548c\u6c42\u53cd\u7801\u3002\n\n3.\u5982\u679c\u6b65\u9aa4 2 \u5f97\u5230\u7684\u7ed3\u679c\u662f\u96f6\uff0c\u5219\u63a5\u53d7\u8fd9\u4e2a\u62a5\u6587\uff0c\u5426\u5219\u4e22\u5f03\u3002\n</code></pre> <p>\u6821\u9a8c\u548c\u7684\u76ee\u6807\u662f\u68c0\u6d4b\u6570\u636e\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u662f\u5426\u53d1\u751f\u4e86\u9519\u8bef\uff0c\u4f46\u5e76\u975e\u7edd\u5bf9\u80fd\u591f\u68c0\u6d4b\u6240\u6709\u9519\u8bef\u3002\u6821\u9a8c\u548c\u4f7f\u7528\u4e86\u4e00\u79cd\u7b80\u5355\u7684\u7b97\u6cd5\uff0c\u901a\u5e38\u662f\u4e8c\u8fdb\u5236\u7684\u7d2f\u52a0\u548c\uff0c\u4ee5\u4fbf\u5feb\u901f\u8ba1\u7b97\u548c\u68c0\u6d4b\u4f20\u8f93\u6570\u636e\u7684\u53d8\u5316\u3002</p> <p>\u6821\u9a8c\u548c\u7684\u4f5c\u7528\u662f\u68c0\u6d4b\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u662f\u5426\u53d1\u751f\u4e86\u5355\u4e00\u6bd4\u7279\u7684\u9519\u8bef\uff0c\u4f8b\u5982\u7531\u4e8e\u566a\u58f0\u5f15\u8d77\u7684\u6bd4\u7279\u7ffb\u8f6c\u3002\u5b83\u80fd\u591f\u6709\u6548\u5730\u6355\u83b7\u8fd9\u79cd\u7c7b\u578b\u7684\u9519\u8bef\uff0c\u4f46\u5e76\u4e0d\u603b\u662f\u80fd\u591f\u68c0\u6d4b\u66f4\u590d\u6742\u7684\u9519\u8bef\uff0c\u6bd4\u5982\u591a\u4e2a\u6bd4\u7279\u540c\u65f6\u53d1\u751f\u53d8\u5316\u6216\u67d0\u4e9b\u7279\u5b9a\u6a21\u5f0f\u7684\u9519\u8bef\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/#_8","title":"\u6e90\u5730\u5740","text":"<p>\u5b9a\u4e49\u7684\u6e90\u70b9\u7684\u5730\u5740\uff0c\u4e00\u822c\uff08\u4e0d\u8003\u8651 NAT \u6216\u8005\u5176\u5b83\u60c5\u51b5\uff09\u60c5\u51b5\u4e0b\u5728 IP \u6570\u636e\u62a5\u4ece\u6e90\u4e3b\u673a\u53d1\u9001\u5230\u76ee\u7684\u4e3b\u673a\u7684\u8fc7\u7a0b\u4e2d\u4fdd\u6301\u4e0d\u53d8\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/#_9","title":"\u76ee\u7684\u5730\u5740","text":"<p>\u5b9a\u4e49\u4e86\u7ec8\u70b9\u7684 IP \u5730\u5740\uff0c\u4e00\u822c\uff08\u4e0d\u8003\u8651 NAT \u6216\u8005\u5176\u5b83\u60c5\u51b5\uff09\u60c5\u51b5\u4e0b\u5728 IP \u6570\u636e\u62a5\u4ece\u6e90\u4e3b\u673a\u53d1\u9001\u5230\u76ee\u7684\u4e3b\u673a\u7684\u8fc7\u7a0b\u4e2d\u4fdd\u6301\u4e0d\u53d8\u3002</p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/#_10","title":"\u9996\u90e8\u9009\u9879\u90e8\u5206","text":"<p>IP \u6570\u636e\u62a5\u7684\u9996\u90e8\u7531\u4e24\u4e2a\u90e8\u5206\u7ec4\u6210\uff0c\u56fa\u5b9a\u90e8\u5206\u548c\u53ef\u53d8\u90e8\u5206\u3002\u56fa\u5b9a\u90e8\u5206\u7684\u957f\u5ea6\u662f 20 \u5b57\u8282\uff0c\u53ef\u53d8\u90e8\u5206\u7531\u4e00\u4e9b\u9009\u9879\u7ec4\u6210\uff0c\u6700\u957f\u53ef\u8fbe 40 \u5b57\u8282\u3002</p> <p>\u9009\u9879\u90e8\u5206\u5bf9\u6bcf\u4e2a\u6570\u636e\u62a5\u6765\u8bf4\u5e76\u4e0d\u662f\u5fc5\u987b\u7684\uff0c\u8fd9\u4e9b\u9009\u9879\u53ef\u7528\u4e8e\u7f51\u7edc\u7684\u6d4b\u8bd5\u548c\u6392\u9519\u3002</p> <p>\u4e0b\u56fe\u662f\u9009\u9879\u7684\u683c\u5f0f\uff0c\u4e09\u4e2a\u7ec4\u6210\u90e8\u5206\uff1a\u4e00\u4e2a\u5b57\u8282\u7684\u7c7b\u578b\u5b57\u6bb5\uff0c\u4e00\u4e2a\u5b57\u8282\u7684\u957f\u5ea6\u5b57\u6bb5\uff0c\u4ee5\u53ca\u53ef\u53d8\u957f\u5ea6\u7684\u503c\u5b57\u6bb5\u3002\u8fd9\u4e09\u4e2a\u5b57\u6bb5\u88ab\u79f0\u4e3a <code>type-length-value\uff0cTLV</code>\u3002 </p>"},{"location":"ThreeMountains/Network/%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9AIP/#_11","title":"\u7c7b\u578b","text":"<p>\u7c7b\u578b\u5b57\u6bb5 <code>type field</code> \u7684\u957f\u5ea6\u4e3a 8 \u4f4d\uff0c\u5305\u62ec\u4e86\u4e09\u4e2a\u5b50\u5b57\u6bb5\uff1a\u590d\u5236\u3001\u7c7b\u522b\u548c\u7f16\u53f7\u3002</p> <ul> <li> <p>\u590d\u5236 \u8fd9\u4e2a 1 \u4f4d\u5b50\u5b57\u6bb5\u63a7\u5236\u4e86\u9009\u9879\u5728\u5206\u7247\u4e2d\u7684\u51fa\u73b0\u3002\u82e5\u8fd9\u4e2a\u503c\u662f 0\uff0c\u5c31\u8868\u793a\u5fc5\u987b\u4ec5\u4ec5\u590d\u5236\u5230\u7b2c\u4e00\u4e2a\u5206\u7247\u3002\u82e5\u8fd9\u4e2a\u503c\u662f 1\uff0c\u5219\u8868\u793a\u9009\u9879\u5fc5\u987b\u590d\u5236\u5230\u6240\u6709\u5206\u7247\u4e2d\u3002</p> </li> <li> <p>\u7c7b\u522b \u8fd9\u4e2a 2 \u4f4d\u5b50\u5b57\u6bb5\u5b9a\u4e49\u4e86\u8be5\u9009\u9879\u7684\u4e00\u822c\u7528\u9014\u3002</p> </li> <li> <p>\u7f16\u53f7 \u8fd9\u4e2a 5 \u4f4d\u5b57\u6bb5\u5b9a\u4e49\u4e86\u9009\u9879\u7684\u7c7b\u578b\u3002\u76ee\u524d\u4ec5\u5b9a\u4e49\u4e86 6 \u79cd\u7c7b\u578b\u3002\u5176\u4e2d\u4e24\u79cd\u4e3a\u5355\u5b57\u8282\u9009\u9879\uff08\u65e0\u64cd\u4f5c\u548c\u9009\u9879\u7ed3\u675f\uff09\uff0c\u4e0d\u9700\u8981\u957f\u5ea6\u548c\u503c\u5b57\u6bb5\uff1b\u5269\u4e0b\u7684\u56db\u79cd\u662f\u591a\u5b57\u8282\u9009\u9879\uff0c\u9700\u8981\u957f\u5ea6\u548c\u503c\u5b57\u6bb5\u3002</p> </li> </ul> <p>\u65e0\u64cd\u4f5c\u9009\u9879 no-operation option \u662f\u4e2a 1 \u5b57\u8282\u7684\u9009\u9879\uff0c\u7528\u4f5c\u9009\u9879\u548c\u9009\u9879\u4e4b\u95f4\u7684\u586b\u5145\u7b26\u3002</p> <p>\u9009\u9879\u7ed3\u675f\u9009\u9879 end-of-operation option \u4e5f\u662f\u4e00\u4e2a 1 \u5b57\u8282\u7684\u9009\u9879\uff0c\u7528\u4e8e\u9009\u9879\u5b57\u6bb5\u7ed3\u675f\u65f6\u7684\u586b\u5145\u3002</p> <p>\u9009\u9879\u7ed3\u675f\u9009\u9879\u53ea\u80fd\u7528\u4e8e\u6700\u540e\u4e00\u4e2a\u9009\u9879\uff0c\u5e76\u4e14\u53ea\u80fd\u4f7f\u7528\u4e00\u6b21\u3002\u5728\u8fd9\u4e2a\u9009\u9879\u4e4b\u540e\uff0c\u63a5\u6536\u5668\u5c31\u5f00\u59cb\u5bfb\u627e\u51c0\u8377\u6570\u636e\u3002\u8fd9\u5c31\u8868\u793a\u5982\u679c\u5bf9\u9f50\u9009\u9879\u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u5b57\u8282\uff0c\u90a3\u4e48\u5fc5\u987b\u4f7f\u7528\u4e00\u4e9b\u65e0\u64cd\u4f5c\u9009\u9879\uff0c\u7136\u540e\u518d\u8ddf\u968f\u4e00\u4e2a\u9009\u9879\u7ed3\u675f\u9009\u9879\u3002</p> <p>\u8bb0\u5f55\u8def\u7531\u9009\u9879 record-route option \u7528\u6765\u8bb0\u5f55\u5904\u7406\u6570\u636e\u62a5\u7684\u56e0\u7279\u7f51\u8def\u7531\u5668\u3002\u5b83\u53ef\u4ee5\u5217\u51fa\u6700\u591a 9 \u4e2a\u8def\u7531\u5668\u7684 IP \u5730\u5740\uff0c\u56e0\u4e3a\u9996\u90e8\u7684\u6700\u5927\u957f\u5ea6\u662f 60 \u5b57\u8282\uff0c\u5176\u4e2d\u8fd8\u5305\u62ec 20 \u5b57\u8282\u7684\u57fa\u672c\u9996\u90e8\uff0c\u8fd8\u5269 40 \u5b57\u8282\u7559\u7ed9\u9009\u9879\u90e8\u5206\u3002  \u6307\u9488\u5b57\u6bb5\u662f\u4e00\u4e2a\u504f\u79fb\u91cf\u7684\u6574\u6570\u5b57\u6bb5\uff0c\u5b83\u6307\u5411\u7b2c\u4e00\u4e2a\u53ef\u7528\u7684\u7a7a\u9879\u3002\u6e90\u70b9\u5728\u9009\u9879\u7684\u503c\u5b57\u6bb5\u4e2d\u521b\u5efa\u4e86\u4e00\u4e9b\u7528\u4e8e\u586b\u5199 IP \u5730\u5740\u7684\u7a7a\u5b57\u6bb5\u3002\u5f53\u6570\u636e\u62a5\u79bb\u5f00\u6e90\u70b9\u65f6\uff0c\u6240\u6709\u8fd9\u4e9b\u5b57\u6bb5\u90fd\u662f\u7a7a\u7684\u3002\u6307\u9488\u5b57\u6bb5\u7684\u503c\u662f 4\uff0c\u6307\u5411\u7b2c\u4e00\u4e2a\u7a7a\u5b57\u6bb5\u3002</p> <p>\u4e0b\u56fe\u662f\u5728 192.168.31.14 \u673a\u5668\u6267\u884c ping -R 192.168.31.1 \u547d\u4ee4\u53d1\u51fa\u7684\u7b2c\u4e00\u4e2a echo-request \u5305\u3002 </p> <p>Options: (40 bytes), Record Route \u8868\u793a IP \u6570\u636e\u62a5\u5305\u542b\u4e86 40 \u5b57\u8282\u7684\u9009\u9879\u90e8\u5206\u3002</p> <p>\u7b2c\u4e00\u4e2a\u9009\u9879\u662f\u5355\u5b57\u8282\u7684\u65e0\u64cd\u4f5c\u9009\u9879\uff0c\u7528\u6765\u586b\u5145\u5bf9\u9f50\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u9009\u9879\u662f\u8bb0\u5f55\u8def\u7531\u9009\u9879\uff0c\u5171 39 \u4e2a\u5b57\u8282\u3002</p> <ul> <li> <p>\u7c7b\u578b\u5360\u4e00\u4e2a\u5b57\u8282\uff0c\u590d\u5236\u3001\u7c7b\u522b\u548c\u7f16\u53f7\u5206\u522b\u662f 0\u300100 \u548c 00111\u3002</p> </li> <li> <p>\u957f\u5ea6\u5360\u4e00\u4e2a\u5b57\u8282\uff0c\u8868\u793a\u8be5\u9009\u9879\u5171 39 \u4e2a\u5b57\u8282\u3002</p> </li> <li> <p>\u6307\u9488\u5360\u4e00\u4e2a\u5b57\u8282\uff0c\u6307\u5411\u4e0b\u4e00\u4e2a\u53ef\u7528\u9009\u9879\uff0c\u7b2c 8 \u4e2a\u5b57\u8282\u3002\u524d\u9762\u4e03\u4e2a\u5b57\u8282\u88ab\u7c7b\u578b\u3001\u957f\u5ea6\u3001\u6307\u9488\u672c\u8eab\u548c\u672c\u673a\u7684 IP \u5730\u5740\u5360\u7528\u4e86\u3002</p> </li> <li> <p>\u7b2c\u4e00\u4e2a\u8def\u7531\u9009\u9879\u8bb0\u5f55\u7684\u662f\u53d1\u51fa\u8bf7\u6c42\u7684\u673a\u5668\u7684 IP\uff0c\u5373 192.168.31.14\uff0c\u5360\u7528 4 \u4e2a\u5b57\u8282\u3002</p> </li> <li> <p>\u9009\u9879\u7684\u5176\u4f59\u90e8\u5206\u88ab\u521d\u59cb\u5316\u4f4d\u7a7a\uff0c\u5168 0\u3002</p> </li> </ul> <p>\u4e0b\u56fe\u662f\u4e0a\u9762\u4e00\u4e2a echo-request \u5bf9\u5e94\u7684 echo-reply \u5305\u3002 ![[Pasted image 20240305230906.png]] Options: (40 bytes), Record Route \u8868\u793a IP \u6570\u636e\u62a5\u5305\u542b\u4e86 40 \u5b57\u8282\u7684\u9009\u9879\u90e8\u5206\u3002</p> <p>\u7b2c\u4e00\u4e2a\u9009\u9879\u662f\u8bb0\u5f55\u8def\u7531\u9009\u9879\uff0c\u5171 39 \u4e2a\u5b57\u8282\u3002</p> <ul> <li> <p>\u7c7b\u578b\u5360\u4e00\u4e2a\u5b57\u8282\uff0c\u590d\u5236\u3001\u7c7b\u522b\u548c\u7f16\u53f7\u5206\u522b\u662f 0\u300100 \u548c 00111\u3002</p> </li> <li> <p>\u957f\u5ea6\u5360\u4e00\u4e2a\u5b57\u8282\uff0c\u8868\u793a\u8be5\u9009\u9879\u5171 39 \u4e2a\u5b57\u8282\u3002</p> </li> <li> <p>\u6307\u9488\u5360\u4e00\u4e2a\u5b57\u8282\uff0c\u6307\u5411\u4e0b\u4e00\u4e2a\u53ef\u7528\u9009\u9879\uff0c\u7b2c 16 \u4e2a\u5b57\u8282\u3002</p> </li> <li> <p>\u53ef\u4ee5\u770b\u5230\u9009\u9879\u8bb0\u5f55\u91cc\u9762\u589e\u52a0\u4e86\u4e24\u6761 192.168.31.1\uff0c\u53ef\u80fd\u662f\u63a5\u6536 IP \u6570\u636e\u62a5\u7684\u65f6\u5019\u589e\u52a0\u4e86\u4e00\u6761\uff0c\u53d1\u51fa IP \u6570\u636e\u62a5\u7684\u65f6\u5019\u53c8\u589e\u52a0\u4e86\u4e00\u6761\u3002</p> </li> </ul> <p>\u7b2c\u4e8c\u4e2a\u9009\u9879\u662f\u5355\u5b57\u8282\u7684\u9009\u9879\u7ed3\u675f\u9009\u9879\uff0c\u7528\u6765\u586b\u5145\u5bf9\u9f50\u3002</p> <p>\u4e25\u683c\u6e90\u8def\u7531\u9009\u9879\uff08strict-source-route option\uff09\u88ab\u6e90\u70b9\u7528\u6765\u9884\u5148\u6307\u5b9a\u6570\u636e\u62a5\u5728\u56e0\u7279\u7f51\u4e2d\u4f20\u9001\u65f6\u7684\u8def\u7531\u3002</p> <p>\u5982\u679c\u6570\u636e\u62a5\u6307\u5b9a\u4e86\u4e25\u683c\u8def\u7531\u9009\u9879\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6570\u636e\u62a5\u5c31\u5fc5\u987b\u7ecf\u8fc7\u5728\u9009\u9879\u4e2d\u5b9a\u4e49\u7684\u6240\u6709\u8def\u7531\u5668\u3002</p> <p>\u82e5\u67d0\u8def\u7531\u5668\u7684 IP \u5730\u5740\u672a\u88ab\u5217\u5165\u5230\u6570\u636e\u62a5\u4e2d\uff0c\u5219\u8fd9\u4e2a\u6570\u636e\u62a5\u5c31\u4e00\u5b9a\u4e0d\u80fd\u901a\u8fc7\u8fd9\u4e2a\u8def\u7531\u5668\u3002</p> <p>\u82e5\u6570\u636e\u62a5\u8fbe\u5230\u4e86\u4e00\u4e2a\u672a\u88ab\u5217\u5165\u7684\u8def\u7531\u5668\uff0c\u5219\u8def\u7531\u5668\u5c06\u4e22\u5f03\u8be5\u6570\u636e\u62a5\u5e76\u53d1\u9001\u5dee\u9519\u62a5\u6587\u3002</p> <p>\u82e5\u6570\u636e\u62a5\u8fbe\u5230\u7ec8\u70b9\u65f6\u4ecd\u6709\u67d0\u4e9b\u5217\u5165\u7684\u8def\u7531\u5668\u672a\u66fe\u7ecf\u8fc7\uff0c\u5219\u7ec8\u70b9\u628a\u8fd9\u4e2a\u6570\u636e\u62a5\u4e22\u5f03\u5e76\u53d1\u51fa\u5dee\u9519\u62a5\u6587\u3002</p> <p>\u5bf9\u4e8e\u67d0\u4e9b\u573a\u666f\u6765\u8bf4\u8be5\u9009\u9879\u662f\u6709\u7528\u7684\uff0c\u6bd4\u5982\u53d1\u9001\u65b9\u53ef\u4ee5\u9009\u62e9\u6700\u5c0f\u65f6\u5ef6\u6216\u6700\u5927\u541e\u5410\u7684\u8def\u7531\u3002\u6216\u8005\u51fa\u4e8e\u5b89\u5168\u8003\u8651\uff0c\u53d1\u9001\u65b9\u53ef\u4ee5\u9009\u62e9\u67d0\u6761\u8def\u7531\u4f7f\u5f97\u6570\u636e\u62a5\u4e0d\u7ecf\u8fc7\u7ade\u4e89\u5bf9\u624b\u7684\u7f51\u7edc\u3002</p> <p>\u4e0d\u4e25\u683c\u6e90\u8def\u7531\u9009\u9879\uff08loose-source-route option\uff09\u4e0e\u4e25\u683c\u8def\u7531\u9009\u9879\u76f8\u4f3c\uff0c\u4f46\u6761\u4ef6\u8981\u653e\u5bbd\u4e00\u4e9b\u3002</p> <p>\u8868\u4e2d\u5217\u51fa\u7684\u8def\u7531\u5668\u5fc5\u987b\u901a\u8fc7\uff0c\u4f46\u662f\u6570\u636e\u8fd8\u4ee5\u8bbf\u95ee\u5176\u4ed6\u7684\u8def\u7531\u5668\u3002</p> <p>\u957f\u5ea6 \u957f\u5ea6\u5b57\u6bb5\uff08length field\uff09\u5b9a\u4e49\u4e86\u9009\u9879\u7684\u603b\u957f\u5ea6\uff0c\u5305\u62ec\u7c7b\u578b\u5b57\u6bb5\u548c\u957f\u5ea6\u5b57\u6bb5\u672c\u8eab\u3002\u8fd9\u4e2a\u5b57\u6bb5\u5e76\u4e0d\u662f\u5728\u6240\u6709\u7c7b\u578b\u7684\u9009\u9879\u4e2d\u90fd\u4f1a\u51fa\u73b0\u3002</p> <p>\u503c \u503c\u5b57\u6bb5\uff08value field\uff09\u5305\u542b\u7684\u662f\u67d0\u4e9b\u7279\u5b9a\u9009\u9879\u6240\u9700\u7684\u6570\u636e\u3002\u8fd9\u4e2a\u5b57\u6bb5\u5e76\u4e0d\u662f\u5728\u6240\u6709\u7c7b\u578b\u7684\u9009\u9879\u4e2d\u90fd\u4f1a\u51fa\u73b0\u3002</p>"},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/","title":"\u8fd0\u8f93\u5c42\uff1aTCP","text":"","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_1","title":"\u4ecb\u7ecd","text":"","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_2","title":"\u8fdb\u7a0b\u5230\u8fdb\u7a0b\u7684\u901a\u4fe1","text":"<p>\u4e0e UDP \u4e00\u6837\uff0cTCP \u4e5f\u662f\u4f7f\u7528\u7aef\u53e3\u53f7\u63d0\u4f9b\u8fdb\u7a0b\u5230\u8fdb\u7a0b\u7684\u901a\u4fe1\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_3","title":"\u6d41\u4ea4\u4ed8\u670d\u52a1","text":"<p>\u548c UDP \u4e0d\u540c\uff0cTCP \u662f\u4e00\u79cd\u9762\u5411\u6d41\u7684\u534f\u8bae\u3002\u5728 UDP \u4e2d\uff0c\u8fdb\u7a0b\u628a\u9884\u5148\u5b9a\u4e49\u597d\u7f16\u8f91\u7684\u62a5\u6587\u4f20\u9001\u7ed9 UDP \u4ee5\u4fbf\u8fdb\u884c\u4ea4\u4ed8\uff0c\u4e0d\u8bba\u662f UDP \u8fd8\u662f IP \u90fd\u4e0d\u8ba4\u4e3a\u4e24\u4e2a UDP \u6570\u636e\u62a5\u4e4b\u95f4\u5b58\u5728\u5173\u8054\u5173\u7cfb\u3002</p> <p>TCP \u5219\u5141\u8bb8\u53d1\u9001\u8fdb\u7a0b\u4ee5\u5b57\u8282\u6d41\u7684\u5f62\u5f0f\u4f20\u9012\u6570\u636e\uff0c\u4e5f\u5141\u8bb8\u63a5\u6536\u8fdb\u7a0b\u628a\u6570\u636e\u4f5c\u4e3a\u5b57\u8282\u6d41\u6765\u63a5\u6536\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_4","title":"\u5168\u53cc\u5de5\u901a\u4fe1","text":"<p>TCP \u63d0\u4f9b\u5168\u53cc\u5de5\u670d\u52a1\uff0c\u5373\u6570\u636e\u53ef\u4ee5\u5728\u540c\u4e00\u65f6\u95f4\u53cc\u5411\u6d41\u52a8\u3002TCP \u7684\u4e24\u4e2a\u7aef\u70b9\u7684 Scoket \u5206\u522b\u6709\u81ea\u5df1\u7684\u53d1\u9001\u7f13\u5b58\u548c\u63a5\u6536\u7f13\u5b58\uff0c\u62a5\u6587\u6bb5\u53ef\u4ee5\u5728\u4e24\u4e2a\u65b9\u5411\u8fd0\u52a8\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_5","title":"\u9762\u5411\u8fde\u63a5\u7684\u670d\u52a1","text":"<p>\u548c UDP \u4e0d\u540c\uff0cTCP \u662f\u9762\u5411\u8fde\u63a5\u7684\u534f\u8bae\u3002</p> <p>TCP \u4f7f\u7528 IP \u7684\u670d\u52a1\u628a\u4e00\u4e2a\u4e2a\u62a5\u6587\u6bb5\u4ea4\u4ed8\u7ed9\u63a5\u6536\u65b9\uff0c\u4f46\u662f\u8fde\u63a5\u672c\u8eab\u662f\u7531 TCP \u63a7\u5236\u7684\u3002\u5982\u679c\u4e00\u4e2a\u62a5\u6587\u6bb5\u4e22\u5931\u6216\u6536\u5230\u635f\u4f24\uff0c\u90a3\u4e48\u8fd9\u4e2a\u62a5\u6587\u6bb5\u5c31\u88ab\u91cd\u4f20\uff0cIP \u5e76\u4e0d\u77e5\u9053 TCP \u7684\u91cd\u4f20\u884c\u4e3a\uff1b\u5982\u679c\u4e00\u4e2a\u62a5\u6587\u6bb5\u6ca1\u6709\u6309\u5e8f\u5230\u8fbe\uff0c\u90a3\u4e48 TCP \u4f1a\u4fdd\u7559\u5b83\uff0c\u76f4\u5230\u4e22\u5931\u7684\u62a5\u6587\u8fbe\u5230\u4e3a\u6b62\uff0c\u4f46\u662f IP \u5e76\u4e0d\u77e5\u9053\u8fd9\u4e2a\u91cd\u65b0\u6392\u5e8f\u7684\u8fc7\u7a0b\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_6","title":"\u7f16\u53f7\u7cfb\u7edf","text":"<p>\u5e8f\u53f7 TCP \u628a\u5728\u4e00\u4e2a\u8fde\u63a5\u4e2d\u8981\u53d1\u9001\u7684\u6240\u6709\u6570\u636e\u5b57\u8282\u90fd\u7f16\u4e0a\u53f7\u3002\u4e24\u4e2a\u65b9\u5411\u7684\u7f16\u53f7\u662f\u76f8\u4e92\u72ec\u7acb\u7684\u3002\u5f53 TCP \u63a5\u6536\u6765\u81ea\u8fdb\u7a0b\u7684\u6570\u636e\u5b57\u8282\u65f6\uff0c\u5c31\u628a\u5b83\u4eec\u5b58\u50a8\u5728\u53d1\u9001\u7f13\u5b58\u4e2d\uff0c\u5e76\u4e3a\u5b83\u4eec\u8fdb\u884c\u7f16\u53f7\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\u7f13\u5b58\u662f\u548c Socket \u5bf9\u5e94\u7684\uff0cSocket \u5728 TCP \u7684\u4e24\u7aef\u5206\u522b\u6709\u72ec\u7acb\u7684\u53d1\u9001\u548c\u63a5\u6536\u7f13\u5b58\u3002\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u5173\u8054\u591a\u4e2a Socket\u3002</p> <p>\u7f16\u53f7\u4e0d\u4e00\u5b9a\u8981\u4ece 0 \u5f00\u59cb\u3002\u5982\u679c\u8d77\u59cb\u7f16\u53f7\u6070\u597d\u662f 1057\uff0c\u800c\u8981\u53d1\u9001\u7684\u6570\u636e\u603b\u5171 6000 \u5b57\u8282\uff0c\u90a3\u4e48\u8fd9\u4e9b\u5b57\u8282\u7684\u7f16\u53f7\u5c31\u662f\u4ece 1057~7056\u3002</p> <p>\u5f53\u6240\u6709\u5b57\u8282\u90fd\u88ab\u7f16\u4e0a\u53f7\u4ee5\u540e\uff0cTCP \u5c31\u7ed9\u6bcf\u4e00\u4e2a\u8981\u53d1\u9001\u7684\u62a5\u6587\u6bb5\u6307\u6d3e\u4e00\u4e2a\u5e8f\u53f7\u3002\u6bcf\u4e2a\u62a5\u6587\u6bb5\u7684\u5e8f\u53f7\u5c31\u662f\u8fd9\u4e2a\u62a5\u6587\u6bb5\u4e2d\u7b2c\u4e00\u4e2a\u6570\u636e\u5b57\u8282\u88ab\u5206\u914d\u7684\u7f16\u53f7\u3002</p> <p>\u786e\u8ba4\u53f7 \u5f53\u4e00\u6761\u8fde\u63a5\u5efa\u7acb\u540e\uff0c\u53cc\u65b9\u80fd\u540c\u65f6\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\uff0c\u901a\u5e38\u53cc\u65b9\u4ece\u4e0d\u540c\u7684\u8d77\u59cb\u7f16\u53f7\u5f00\u59cb\u5bf9\u5b57\u8282\u7f16\u53f7\u3002\u53cc\u65b9\u8fd8\u4f7f\u7528\u4e86\u786e\u8ba4\u53f7\u5bf9\u5404\u81ea\u6536\u5230\u7684\u5b57\u8282\u8868\u793a\u786e\u8ba4\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u786e\u8ba4\u53f7\u5b9a\u4e49\u7684\u662f\u5b83\u671f\u671b\u63a5\u6536\u5230\u7684\u4e0b\u4e00\u4e2a\u81ea\u5df1\u7684\u7f16\u53f7\u3002\u53e6\u5916\u786e\u8ba4\u53f7\u662f\u7d2f\u79ef\uff0c\u610f\u601d\u662f\u5982\u679c\u67d0\u4e00\u65b9\u4f7f\u7528 5643 \u4f5c\u4e3a\u786e\u8ba4\u53f7\uff0c\u90a3\u5c31\u8868\u793a\u5b83\u5df2\u7ecf\u6536\u5230\u4e86\u4ece\u5f00\u59cb\u4e00\u76f4\u5230\u7f16\u53f7\u4e3a 5642 \u7684\u6240\u6709\u5b57\u8282\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_7","title":"\u683c\u5f0f","text":"<p>\u62a5\u6587\u6bb5\u5305\u62ec\u4e86 20~60 \u5b57\u8282\u7684\u9996\u90e8\uff0c\u5176\u540e\u662f\u5e94\u7528\u7a0b\u5e8f\u7684\u6570\u636e\u3002\u9996\u90e8\u5728\u6ca1\u6709\u9009\u9879\u65f6\u662f 20 \u5b57\u8282\uff0c\u5982\u679c\u6709\u9009\u9879\u6700\u591a\u53ef\u8fbe 60 \u5b57\u8282\u3002\u9996\u90e8\u683c\u5f0f\u5982\u4e0b\u3002  \u6e90\u7aef\u53e3\u5730\u5740 16 \u4f4d\u7684\u5b57\u6bb5\uff0c\u5b9a\u4e49\u53d1\u9001\u8fd9\u4e2a\u62a5\u6587\u6bb5\u7684\u4e3b\u673a\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u7aef\u53e3\u53f7\u3002</p> <p>\u76ee\u7684\u7aef\u53e3i\u5730\u5740 16 \u4f4d\u7684\u5b57\u6bb5\uff0c\u5b9a\u4e49\u4e86\u63a5\u6536\u8fd9\u4e2a\u62a5\u6587\u6bb5\u7684\u4e3b\u673a\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u7aef\u53e3\u53f7\u3002</p> <p>\u5e8f\u53f7 32 \u4f4d\u5b57\u6bb5\uff0c\u5b9a\u4e49\u4e86\u6307\u6d3e\u7ed9\u672c\u62a5\u6587\u6bb5\u7b2c\u4e00\u4e2a\u6570\u636e\u5b57\u8282\u7684\u7f16\u53f7\u3002\u5728\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u53cc\u65b9\u4f7f\u7528\u5404\u81ea\u7684\u968f\u673a\u6570\u4ea7\u751f\u5668\u4ea7\u751f\u4e00\u4e2a\u521d\u59cb\u5e8f\u53f7\uff08Initial Sequence Number\uff0cISN\uff09\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4e24\u4e2a\u65b9\u5411\u4e0a\u7684 ISN \u662f\u4e0d\u540c\u7684\u3002</p> <p>\u786e\u8ba4\u53f7 32 \u4f4d\u5b57\u6bb5\uff0c\u5b9a\u4e49\u4e86\u62a5\u6587\u6bb5\u7684\u63a5\u6536\u65b9\u671f\u671b\u4ece\u5bf9\u65b9\u63a5\u6536\u7684\u5b57\u8282\u7f16\u53f7\u3002\u5982\u679c\u62a5\u6587\u6bb5\u7684\u63a5\u6536\u65b9\u6210\u529f\u63a5\u6536\u4e86\u5bf9\u65b9\u53d1\u6765\u7684\u7f16\u53f7\u4e3a x \u7684\u5b57\u8282\uff0c\u90a3\u4e48\u5b83\u5c31\u8fd4\u56de x+1 \u4f5c\u4e3a\u786e\u8ba4\u53f7\u3002\u786e\u8ba4\u53ef\u4ee5\u548c\u6570\u636e\u634e\u5e26\u5728\u4e00\u8d77\u53d1\u9001\u3002</p> <p>\u9996\u90e8\u957f\u5ea6 4 \u4f4d\u5b57\u6bb5\uff0c\u5b9a\u4e49\u4e86 TCP \u9996\u90e8\u4e00\u5171\u6709\u591a\u5c11\u4e2a 4 \u5b57\u5b57\u8282\u3002\u9996\u90e8\u957f\u5ea6\u53ef\u4ee5\u5728 20~60 \u5b57\u8282\u4e4b\u95f4\u3002\u56e0\u6b64\u8fd9\u4e2a\u5b57\u6bb5\u7684\u503c\u53ef\u4ee5\u5728 5 \u5230 15 \u4e4b\u95f4\u3002</p> <p>\u4fdd\u7559 6 \u4f4d\u5b57\u6bb5\uff0c\u4fdd\u7559\u4e3a\u4eca\u540e\u4f7f\u7528\u3002</p> <p>\u63a7\u5236 \u5171 6 \u4f4d\u3002\u5728\u540c\u4e00\u65f6\u95f4\u53ef\u8bbe\u7f6e\u4e00\u4f4d\u6216\u591a\u4f4d\u6807\u5fd7\u3002</p> <ul> <li>URG \u7d27\u6025\u6307\u9488\u6709\u6548\u7684\u3002</li> <li>ACK \u786e\u8ba4\u662f\u6709\u6548\u7684\u3002</li> <li>PSH \u8bf7\u6c42\u63a8\u9001\u3002</li> <li>RST \u8fde\u63a5\u590d\u4f4d\u3002</li> <li>SYN \u540c\u6b65\u5e8f\u53f7\u3002</li> <li>FIN \u7ec8\u6b62\u8fde\u63a5\u3002</li> </ul> <p>\u7a97\u53e3\u5927\u5c0f 16 \u4f4d\u5b57\u6bb5\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u5b9a\u4e49\u7684\u662f\u53d1\u9001 TCP \u7684\u7a97\u53e3\u5927\u5c0f\uff0c\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u3002\u7a97\u53e3\u5927\u5c0f\u662f\u7531\u63a5\u6536\u65b9\u51b3\u5b9a\u7684\uff0c\u53d1\u9001\u65b9\u670d\u4ece\u63a5\u6536\u65b9\u7684\u6307\u793a\u3002\u53ea\u6709\u5f53\u4e00\u4e2a\u62a5\u6587\u6bb5\u4e2d\u5305\u542b\u4e86\u786e\u8ba4\u65f6\uff0c\u5b9a\u4e49\u7a97\u53e3\u5927\u5c0f\u624d\u6709\u610f\u4e49\u3002</p> <p>\u6821\u9a8c\u548c 16 \u4f4d\u5b57\u6bb5\u3002TCP \u6821\u9a8c\u548c\u5b57\u6bb5\u662f\u5f3a\u5236\u7684\uff0c\u548c UDP \u4e00\u6837\u6821\u9a8c\u548c\u7684\u8ba1\u7b97\u8981\u5305\u542b\u4f2a\u9996\u90e8\u548c\u6570\u636e\u90e8\u5206\u3002</p> <p>\u7d27\u6025\u6307\u9488 16 \u4f4d\u5b57\u6bb5\uff0c\u53ea\u6709\u5f53\u7d27\u6025\u6807\u5fd7\u4f4d\u65f6\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u624d\u6709\u6548\uff0c\u6b64\u65f6\u62a5\u6587\u6bb5\u4e2d\u5305\u542b\u4e86\u7d27\u6025\u6570\u636e\u3002\u7d27\u6025\u6307\u9488\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6570\u503c\uff0c\u628a\u8fd9\u4e2a\u6570\u503c\u52a0\u5230\u5e8f\u53f7\u4e0a\u5c31\u5f97\u51fa\u62a5\u6587\u6bb5\u6570\u636e\u90e8\u5206\u4e2d\u6700\u540e\u4e00\u4e2a\u7d27\u6025\u5b57\u8282\u7684\u7f16\u53f7\u3002</p> <p>\u9009\u9879 TCP \u9996\u90e8\u4e2d\u6709\u53ef\u4ee5\u591a\u5927 40 \u5b57\u8282\u7684\u9009\u9879\u4fe1\u606f\u3002\u9009\u9879\u7528\u4e8e\u628a\u9644\u52a0\u4fe1\u606f\u4f20\u9012\u7ed9\u7ec8\u70b9\uff0c\u6216\u7528\u6765\u586b\u5145\u5bf9\u5176\u5176\u4ed6\u9009\u9879\u3002</p> <p>\u5355\u5b57\u8282\u9009\u9879\uff1a\u9009\u9879\u5217\u8868\u7ed3\u675f\u548c\u65e0\u64cd\u4f5c\u3002 \u591a\u5b57\u8282\u9009\u9879\uff1a\u6700\u5927\u62a5\u6587\u6bb5\u957f\u5ea6\u3001\u7a97\u53e3\u6269\u5927\u56e0\u5b50\u3001\u65f6\u95f4\u6233\u3001\u5141\u8bb8 SACK \u548c SACK\u3002</p> <p>\u9009\u9879\u7ed3\u675f\uff08end-of-option\uff0cEOP\uff09 \u9009\u9879\u662f\u5355\u5b57\u8282\u9009\u9879\uff0c\u7528\u6765\u5728\u9009\u9879\u533a\u7ed3\u5c3e\u8fdb\u884c\u586b\u5145\u3002\u5b83\u53ea\u80fd\u7528\u4f5c\u6700\u540e\u4e00\u4e2a\u9009\u9879\u3002\u8fd9\u4e2a\u9009\u9879\u53ea\u5141\u8bb8\u51fa\u73b0\u4e00\u6b21\uff0c\u5728\u8fd9\u4e2a\u9009\u9879\u4e4b\u540e\u5c31\u662f\u6709\u6548\u8377\u8f7d\u6570\u636e\u4e86\u3002</p> <p>\u65e0\u64cd\u4f5c\uff08no-opreration\uff0cNOP\uff09 \u9009\u9879\u662f\u5355\u5b57\u8282\u9009\u9879\uff0c\u7528\u4f5c\u9009\u9879\u4e4b\u95f4\u7684\u586b\u5145\u3002NOP \u53ef\u4ee5\u591a\u6b21\u4f7f\u7528\uff0c\u901a\u5e38\u7528\u6765\u5e2e\u52a9\u9009\u9879\u80fd\u591f\u5728\u4e00\u4e2a 4 \u5b57\u8282\u4e2d\u5bf9\u9f50\u3002</p> <p>\u6700\u5927\u62a5\u6587\u6bb5\u957f\u5ea6\u9009\u9879\uff08maximum-segment-size option\uff0cMSS\uff09 \u5b9a\u4e49\u4e86\u80fd\u591f\u88ab\u7ec8\u70b9\u63a5\u6536\u7684 TCP \u62a5\u6587\u6bb5\u7684\u6700\u5927\u6570\u636e\u5355\u5143\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8be5\u9009\u9879\u5b9a\u4e49\u7684\u662f\u6570\u636e\u7684\u6700\u5927\u957f\u5ea6\uff0c\u800c\u4e0d\u662f\u62a5\u6587\u6bb5\u7684\u6700\u5927\u957f\u5ea6\u3002</p> <p>\u8fd9\u4e2a\u5b57\u6bb5\u662f 16 \u4f4d\u957f\uff0c\u6240\u4ee5\u7406\u8bba\u503c\u53ea\u80fd\u5728 0 \u5230 65535 \u5b57\u8282\u4e4b\u95f4\u3002\u79cd\u7c7b 1 \u4e2a\u5b57\u8282\u503c\u4e3a 2\uff0c\u957f\u5ea6 1 \u4e2a\u5b57\u8282\u503c\u4e3a 4\uff0c\u6700\u5927\u62a5\u6587\u6bb5\u957f\u5ea6 2 \u4e2a\u5b57\u8282\uff0c\u5b9a\u4e49\u4e86\u62a5\u6587\u6bb5\u6570\u636e\u7684\u6700\u5927\u957f\u5ea6\u3002</p> <p>MSS \u662f\u5728\u5efa\u7acb\u8fde\u63a5\u9636\u6bb5\u786e\u7acb\u7684\u3002\u6bcf\u4e00\u65b9\u90fd\u8981\u5b9a\u4e49\u5b83\u5728\u8fde\u63a5\u671f\u95f4\u63a5\u6536\u7684\u62a5\u6587\u6bb5\u7684 MSS\uff0c\u9ed8\u8ba4 536 \u5b57\u8282\u3002\u5e76\u4e14\uff0cMSS \u5728\u8fde\u63a5\u671f\u95f4\u4fdd\u6301\u4e0d\u53d8\u3002</p> <p>\u7a97\u53e3\u6269\u5927\u56e0\u5b50 \u9996\u90e8\u4e2d\u7684\u7a97\u53e3\u5927\u5c0f\u5b57\u6bb5\u5b9a\u4e49\u4e86\u6ed1\u52a8\u7a97\u53e3\u7684\u5927\u5c0f\uff0c\u4f46\u662f\u53ea\u6709 16 \u4f4d\uff0c\u8868\u793a\u7a97\u53e3\u7684\u5927\u5c0f\u8303\u56f4 0~65535 \u5b57\u8282\u3002\u4e3a\u4e86\u52a0\u5927\u7a97\u53e3\u5927\u5c0f\uff0c\u5c31\u8981\u4f7f\u7528\u7a97\u53e3\u6269\u5927\u56e0\u5b50\uff08window sacle factor\uff09\u3002\u65b0\u7684\u7a97\u53e3\u5927\u5c0f\u53ef\u4ee5\u8fd9\u6837\u6c42\u51fa\uff0c\u5373\u5148\u8ba1\u7b97 2 \u7684\u7a97\u53e3\u6269\u5927\u56e0\u5b50\u6b21\u65b9\uff0c\u518d\u628a\u5f97\u51fa\u7684\u7ed3\u679c\u4e58\u4ee5\u9996\u90e8\u4e2d\u7684\u7a97\u53e3\u503c\u3002</p> <p>\u7a97\u53e3\u6269\u5927\u56e0\u5b50\u53ea\u80fd\u5728\u5efa\u7acb\u8fde\u63a5\u9636\u6bb5\u786e\u5b9a\uff0c\u5728\u8fde\u63a5\u671f\u95f4\u5b83\u7684\u503c\u4e0d\u80fd\u6539\u53d8\u3002</p> <p>\u6269\u5927\u56e0\u5b50\u6709\u65f6\u4e5f\u79f0\u79fb\u4f4d\u8ba1\u6570\uff0c\u56e0\u4e3a\u8981\u628a\u4e00\u4e2a\u6570\u4e58\u4ee5 2 \u7684\u51e0\u6b21\u65b9\uff0c\u53ea\u9700\u8981\u628a\u8fd9\u4e2a\u6570\u6309\u4f4d\u64cd\u4f5c\uff0c\u5411\u5de6\u79fb\u51e0\u4f4d\u5c31\u884c\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fde\u63a5\u7684\u4e00\u6bb5\u53ef\u4ee5\u628a\u7a97\u53e3\u6269\u5927\u56e0\u5b50\u8bbe\u7f6e\u4e3a 0\uff0c\u610f\u601d\u662f\u8bf4\u867d\u7136\u5b83\u652f\u6301\u8fd9\u4e2a\u9009\u9879\uff0c\u4f46\u662f\u5728\u76ee\u524d\u8fd9\u4e2a\u8fde\u63a5\u4e2d\uff0c\u5b83\u4e0d\u60f3\u4f7f\u7528\u8fd9\u4e2a\u9009\u9879\u3002</p> <p>\u65f6\u95f4\u6233</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_8","title":"\u8fde\u63a5","text":"<p>\u5728 TCP \u4e2d\uff0c\u9762\u5411\u8fde\u63a5\u7684\u4f20\u8f93\u9700\u8981\u7ecf\u5386\u4e09\u4e2a\u9636\u6bb5\uff1a\u8fde\u63a5\u5efa\u7acb\u3001\u6570\u636e\u4f20\u8f93\u548c\u8fde\u63a5\u7ec8\u6b62\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_9","title":"\u5efa\u7acb\u8fde\u63a5","text":"<p>\u4e09\u5411\u63e1\u624b </p> <p>\u5ba2\u6237\u7aef\u4e3b\u52a8\u6253\u5f00\uff0cC-&gt;S \u53d1\u9001\u62a5\u6587\uff0cseq: x\uff0cSYN\u3002</p> <p>\u5ba2\u6237\u7aef\u53d1\u9001\u7b2c\u4e00\u4e2a\u62a5\u6587\u6bb5\uff08SYN \u62a5\u6587\u6bb5\uff09\uff0c\u5728\u8fd9\u4e2a\u62a5\u6587\u6bb5\u4e2d SYN \u6807\u5fd7\u7f6e\u4e3a 1\u3002</p> <p>SYN \u62a5\u6587\u6bb5\u4e0d\u643a\u5e26\u4efb\u4f55\u6570\u636e\uff0c\u4f46\u662f\u5b83\u8981\u6d88\u8017\u4e00\u4e2a\u5e8f\u53f7\uff0c\u8fd9\u4e2a\u5e8f\u53f7\u79f0\u4e3a\u521d\u59cb\u5e8f\u53f7 ISN\u3002</p> <p>\u8fd9\u4e2a\u62a5\u6587\u6bb5\u4e0d\u5305\u62ec\u786e\u8ba4\u53f7\uff0c\u4e5f\u6ca1\u6709\u5b9a\u4e49\u7a97\u53e3\u5927\u5c0f\u3002\u53ea\u6709\u5f53\u4e00\u4e2a\u62a5\u6587\u6bb5\u4e2d\u5305\u542b\u4e86\u786e\u8ba4\u65f6\uff0c\u5b9a\u4e49\u7a97\u53e3\u5927\u5c0f\u624d\u6709\u610f\u4e49\u3002</p> <p>\u670d\u52a1\u7aef\u88ab\u52a8\u6253\u5f00\uff0cS-&gt;C\u53d1\u9001\u62a5\u6587\uff0cseq: y\uff0cack: x+1\uff0cSYN\uff0cACK\uff0crwnd: 5000\u3002</p> <p>\u670d\u52a1\u7aef\u53d1\u9001\u7b2c\u4e8c\u4e2a\u62a5\u6587\u6bb5\uff0c\u5373 SYN+ACK \u62a5\u6587\u6bb5\uff0c\u62a5\u6587\u6bb5\u4e2d\u7684\u8fd9\u4e24\u4e2a\u6807\u5fd7\u7f6e 1\u3002SYN + ACK \u62a5\u6587\u6bb5\u4e0d\u643a\u5e26\u4efb\u4f55\u6570\u636e\uff0c\u4f46\u662f\u5b83\u8981\u6d88\u8017\u4e00\u4e2a\u5e8f\u53f7\u3002</p> <p>\u8fd9\u4e2a\u62a5\u6587\u6bb5\u6709\u4e24\u4e2a\u76ee\u7684\uff0c\u9996\u5148\u3002\u5b83\u662f\u53e6\u4e00\u4e2a\u65b9\u5411\u4e0a\u901a\u4fe1\u7684 SYN \u62a5\u6587\u6bb5\u3002\u670d\u52a1\u5668\u4f7f\u7528\u8fd9\u4e2a\u62a5\u6587\u6bb5\u6765\u540c\u6b65\u5b83\u7684\u521d\u59cb\u5e8f\u53f7\uff0c\u4ee5\u4fbf\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u5b57\u8282\u3002\u5176\u6b21\uff0c\u670d\u52a1\u5668\u8fd8\u901a\u8fc7 ACK \u6807\u5fd7\u6765\u786e\u8ba4\u5df2\u6536\u5230\u6765\u81ea\u5ba2\u6237\u7aef\u7684 SYN \u62a5\u6587\u6bb5\uff0c\u540c\u65f6\u7ed9\u51fa\u671f\u671b\u4ece\u5ba2\u6237\u7aef\u5ba2\u6237\u7aef\u6536\u5230\u7684\u4e0b\u4e00\u4e2a\u5e8f\u53f7\u3002</p> <p>\u56e0\u4e3a\u8fd9\u4e2a\u62a5\u6587\u6bb5\u5305\u542b\u4e86\u786e\u8ba4\uff0c\u6240\u4ee5\u5b83\u8fd8\u9700\u8981\u5b9a\u4e49\u63a5\u6536\u7a97\u53e3\u5927\u5c0f\uff0c\u5373 rwnd\uff0c\u7531\u5ba2\u6237\u7aef\u4f7f\u7528\u3002</p> <p>\u5ba2\u6237\u7aef\u786e\u8ba4\uff0cC-&gt;S\u53d1\u9001\u62a5\u6587\uff0cseq: x\uff0cack: y+1\uff0cACK\uff0crwnd: 3000\u3002</p> <p>\u5ba2\u6237\u7aef\u53d1\u9001\u7b2c\u4e09\u4e2a\u62a5\u6587\u6bb5\u3002\u8fd9\u4ec5\u4ec5\u662f\u4e00\u4e2a ACK \u62a5\u6587\u6bb5\uff0c\u5b83\u4f7f\u7528 ACK \u6807\u5fd7\u548c\u786e\u8ba4\u53f7\u6765\u786e\u8ba4\u6536\u5230\u4e86\u7b2c\u4e8c\u4e2a\u62a5\u6587\u6bb5\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\u8fd9\u4e2a\u62a5\u6587\u6bb5\u7684\u5e8f\u53f7 SYN \u62a5\u6587\u6bb5\u4f7f\u7528\u7684\u5e8f\u53f7\u4e00\u6837\uff0c\u5373\u8fd9\u4e2a ACK \u62a5\u6587\u6bb5\u4e0d\u6d88\u8017\u4efb\u4f55\u5e8f\u53f7\u3002</p> <p>\u5ba2\u6237\u7aef\u5728\u8fd9\u4e2a\u62a5\u6587\u6bb5\u4e2d\u5b9a\u4e49\u670d\u52a1\u7aef\u53d1\u9001\u7a97\u53e3\u7684\u5927\u5c0f\u3002</p> <p>Note</p> <p>\u6700\u540e\u4e00\u6b21\u63e1\u624b\u7684\u5e8f\u53f7\u4e5f\u53ef\u80fd\u662f <code>x+1</code>\uff0c\u5728\u4f7f\u7528\u540e\u9762\u7684 <code>EchoServer</code> \u793a\u4f8b\u8fdb\u884c\u6293\u5305\u65f6\uff0c\u5ba2\u6237\u7aef\u7b2c\u4e09\u6b21\u63e1\u624b\u53d1\u9001\u7684\u5e8f\u53f7\u5c31\u662f <code>x+1</code>\uff0c\u4f46\u662f\u5ba2\u6237\u7aef\u5e76\u6ca1\u6709\u6d88\u8017\u6389\u8fd9\u4e2a\u5e8f\u53f7\u3002\u5728\u63e1\u624b\u7ed3\u675f\u540e\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u7b2c\u4e00\u4e2a\u62a5\u6587\u6bb5\u7684\u5e8f\u53f7\u4ecd\u662f <code>x+1</code>\u3002</p> <p>SYN \u6d2a\u6cdb\u653b\u51fb \u5f53\u4e00\u4e2a\u6216\u591a\u4e2a\u6076\u610f\u653b\u51fb\u7684\u653b\u51fb\u8005\u5411\u67d0\u53f0\u670d\u52a1\u5668\u53d1\u9001\u5927\u91cf\u7684 SYN \u62a5\u6587\u6bb5\uff0c\u5e76\u901a\u8fc7\u4f2a\u9020\u62a5\u6587\u6bb5\u4e2d\u7684\u6e90 IP \u5730\u5740\u6765\u5047\u88c5\u6bcf\u4e00\u4e2a\u62a5\u6587\u6bb5\u6765\u81ea\u4e0d\u540c\u7684\u5ba2\u6237\u7aef\u65f6\uff0c\u8fd9\u4e2a\u95ee\u9898\u5c31\u53d1\u751f\u4e86\u3002\u670d\u52a1\u5668\u8ba4\u4e3a\u8fd9\u4e9b\u5ba2\u6237\u7aef\u53d1\u6765\u4e86\u4e3b\u52a8\u6253\u5f00\u8bf7\u6c42\uff0c\u4e8e\u662f\u5c31\u5206\u914d\u5fc5\u8981\u7684\u8d44\u6e90\uff0c\u5e76\u8bbe\u7f6e\u4e00\u4e9b\u8ba1\u65f6\u5668\u3002\u7136\u540e\u670d\u52a1\u5668\u5411\u8fd9\u4e9b\u5047\u5192\u7684\u5ba2\u6237\u7aef\u53d1\u9001 SYN+ACK \u62a5\u6587\u6bb5\uff0c\u800c\u8fd9\u4e9b\u62a5\u6587\u6bb5\u90fd\u4e22\u5931\u4e86\u3002</p> <p>\u5982\u679c\u5728\u5f88\u77ed\u7684\u65f6\u95f4\u5185\uff0cSYN \u62a5\u6587\u6bb5\u7684\u6570\u91cf\u5f88\u5927\uff0c\u670d\u52a1\u5668\u6700\u7ec8\u4f1a\u56e0\u4e3a\u8d44\u6e90\u8017\u5c3d\u800c\u4e0d\u80fd\u63a5\u53d7\u6765\u81ea\u5408\u6cd5\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\u3002\u8fd9\u79cd SYN \u6d2a\u6cdb\u653b\u51fb\u5c5e\u4e8e\u62d2\u7edd\u670d\u52a1\uff08DOS\uff09\u653b\u51fb\uff0c\u5373\u653b\u51fb\u8005\u7528\u5927\u91cf\u7684\u670d\u52a1\u8bf7\u6c42\u5784\u65ad\u4e86\u4e00\u4e2a\u7cfb\u7edf\uff0c\u4f7f\u8fd9\u4e2a\u7cfb\u7edf\u56e0\u8d85\u8f7d\u800c\u62d2\u7edd\u4e3a\u5408\u6cd5\u7684\u8bf7\u6c42\u63d0\u4f9b\u670d\u52a1\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_10","title":"\u6570\u636e\u4f20\u9001","text":"<p>\u5728\u5efa\u7acb\u8fde\u63a5\u4e4b\u540e\uff0c\u53cc\u5411\u7684\u6570\u636e\u4f20\u9001\u5c31\u53ef\u4ee5\u5f00\u59cb\u3002\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u53ef\u4ee5\u5728\u4e24\u4e2a\u65b9\u5411\u4e0a\u4f20\u9001\u6570\u636e\uff0c\u5e76\u4e14\u5728\u540c\u4e00\u4e2a\u62a5\u6587\u6bb5\u4e2d\u4e5f\u53ef\u4ee5\u643a\u5e26\u786e\u8ba4\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_11","title":"\u8fde\u63a5\u4e2d\u6b62","text":"<p>\u53c2\u4e0e\u6570\u636e\u4ea4\u6362\u7684\u53cc\u65b9\u4e2d\u7684\u4efb\u4f55\u4e00\u65b9\u90fd\u53ef\u4ee5\u5173\u95ed\u8fde\u63a5\uff0c\u4e00\u822c\u6765\u8bf4\u8fd9\u662f\u7531\u5ba2\u6237\u7aef\u542f\u52a8\u7684\u3002\u76ee\u524d\uff0c\u5927\u591a\u6570 TCP \u5b9e\u73b0\u5141\u8bb8\u8fde\u63a5\u7ec8\u6b62\u65f6\u6709\u4e24\u79cd\u9009\u62e9\uff1a\u4e09\u5411\u63e1\u624b\u548c\u5177\u6709\u529e\u5173\u95ed\u5c5e\u6027\u7684\u56db\u5411\u63e1\u624b\u3002</p> <p>\u4e09\u5411\u63e1\u624b \u5ba2\u6237\u7aef\u4e3b\u52a8\u5173\u95ed\uff0cC-&gt;S \u53d1\u9001\u62a5\u6587\uff0cseq: x\uff0cFIN+ACK\u3002</p> <p>\u5ba2\u6237\u7aef\u5728\u6536\u5230\u8fdb\u7a0b\u7684\u5173\u95ed\u547d\u4ee4\u540e\uff0c\u5c31\u53d1\u9001\u4e00\u4e2a\u62a5\u6587\u6bb5\uff0c\u8fd9\u662f\u4e00\u4e2a\u5c06 FIN \u6807\u5fd7\u7f6e 1 \u7684\u62a5\u6587\u6bb5\u3002 zhixiao FIN \u62a5\u6587\u6bb5\u53ef\u4ee5\u5305\u542b\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6700\u540e\u4e00\u5757\u6570\u636e\u3002\u6216\u8005\u4ec5\u4ec5\u53ea\u662f\u4e00\u4e2a\u63a7\u5236\u62a5\u6587\u6bb5\uff0c\u4e0d\u5305\u542b\u6570\u636e\u7684\u8bdd\u4ec5\u6d88\u8017\u4e00\u4e2a\u5e8f\u53f7\u3002</p> <p>\u670d\u52a1\u7aef\u88ab\u52a8\u5173\u95ed\uff0cS-&gt;C \u53d1\u9001\u62a5\u6587\uff0cseq: y\uff0cack: x+1\uff0cFIN+ACK\u3002</p> <p>\u670d\u52a1\u7aef\u5728\u6536\u5230\u5ba2\u6237\u7aef\u7684 FIN \u62a5\u6587\u6bb5\u540e\uff0c\u53d1\u9001\u4e86\u7b2c\u4e8c\u4e2a\u62a5\u6587\u6bb5 FIN+ACK \u62a5\u6587\u6bb5\uff0c\u4ee5\u8bc1\u5b9e\u5b83\u6536\u5230\u4e86\u6765\u81ea\u5ba2\u6237\u7aef\u7684 FIN \u62a5\u6587\u6bb5\uff0c\u540c\u65f6\u4e5f\u5ba3\u5e03\u53e6\u4e00\u4e2a\u65b9\u5411\u6b63\u5728\u5173\u95ed\u8fde\u63a5\u3002</p> <p>\u8fd9\u4e2a\u62a5\u6587\u6bb5\u4e5f\u53ef\u4ee5\u643a\u5e26\u670d\u52a1\u7aef\u7684\u6700\u540e\u4e00\u5757\u6570\u636e\u3002\u5982\u679c\u5b83\u4e0d\u643a\u5e26\u6570\u636e\uff0c\u5219\u53ea\u6d88\u8017\u4e00\u4e2a\u5e8f\u53f7\u3002</p> <p>\u5ba2\u6237\u7aef\u786e\u8ba4\uff0cC-&gt;S \u53d1\u9001\u62a5\u6587\uff0cseq: x\uff0cack: y+1\uff0cACK\u3002</p> <p>\u5ba2\u6237\u7aef\u53d1\u9001\u6700\u540e\u4e00\u4e2a ACK \u62a5\u6587\u6bb5\uff0c\u4ee5\u8bc1\u5b9e\u4ece TCP \u670d\u52a1\u7aef\u6536\u5230\u4e86 FIN \u62a5\u6587\u6bb5\u3002</p> <p>\u8fd9\u4e2a\u62a5\u6587\u6bb5\u4e0d\u643a\u5e26\u6570\u636e\uff0c\u5e76\u4e14\u4e5f\u4e0d\u6d88\u8017\u5e8f\u53f7\u3002</p> <p>\u534a\u5173\u95ed \u5728 TCP \u4e2d\uff0c\u8fde\u63a5\u7684\u4e00\u65b9\u53ef\u4ee5\u505c\u6b62\u53d1\u9001\u6570\u636e\uff0c\u4f46\u662f\u4ecd\u7136\u53ef\u4ee5\u63a5\u6536\u6570\u636e\uff0c\u8fd9\u5c31\u79f0\u4e3a\u534a\u5173\u95ed\uff0chalf-close\u3002</p> <p>\u5e38\u89c1\u7684\u60c5\u51b5\u662f\uff0c\u5ba2\u6237\u7aef\u5728\u5728\u53d1\u9001\u5b8c\u6240\u6709\u7684\u6570\u636e\u4e4b\u540e\uff0c\u53ef\u4ee5\u628a\u5ba2\u6237\u7aef\u5230\u670d\u52a1\u5668\u65b9\u5411\u7684\u8fde\u63a5\u5173\u95ed\u3002\u4f46\u662f\uff0c\u4ece\u670d\u52a1\u7aef\u5230\u5ba2\u6237\u7aef\u8fde\u63a5\u53ef\u4ee5\u662f\u7ee7\u7eed\u6253\u5f00\u7684\uff0c\u4ee5\u4fbf\u670d\u52a1\u7aef\u5904\u7406\u5b8c\u5ba2\u6237\u7aef\u7684\u6570\u636e\u4e4b\u540e\u5c06\u5904\u7406\u7ed3\u679c\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002 </p> <p>\u5ba2\u6237\u7aef\u4e3b\u52a8\u5173\u95ed\uff0cC-&gt;S \u53d1\u9001\u62a5\u6587\uff0cseq: x\uff0cack: y\uff0cFIN+ACK\u3002</p> <p>\u4ece\u5ba2\u6237\u7aef\u5230\u670d\u52a1\u7aef\u7684\u6570\u636e\u4f20\u9001\u7ed3\u675f\u4e86\uff0c\u5ba2\u6237\u7aef\u5c31\u53d1\u9001\u4e00\u4e2a FIN \u62a5\u6587\u6bb5\uff0c\u6b64\u8fde\u63a5\u88ab\u534a\u5173\u95ed\u4e86\u3002</p> <p>\u670d\u52a1\u7aef\u786e\u8ba4\uff0cS-&gt;C \u53d1\u9001\u62a5\u6587\uff0cseq: y-1\uff0cack: x+1\uff0cACK\u3002</p> <p>\u670d\u52a1\u7aef\u53d1\u9001 ACK \u62a5\u6587\u6bb5\u8868\u793a\u63a5\u53d7\u534a\u5173\u95ed\uff0c\u4f46\u662f\u8fd9\u4e2a\u65f6\u5019\u670d\u52a1\u7aef\u4ecd\u662f\u53ef\u4ee5\u53d1\u9001\u6570\u636e\u7684\u3002</p> <p>\u6ce8\u610f\u8fd9\u4e2a\u5355\u7eaf\u7684 ACK \u62a5\u6587\u6bb5\u662f\u4e0d\u6d88\u8017\u5e8f\u53f7\u7684\u3002</p> <p>&lt;-- \u670d\u52a1\u7aef\u5230\u5ba2\u6237\u7aef\u62a5\u6587\u6bb5 -|- \u5ba2\u6237\u7aef\u5230\u670d\u52a1\u7aef\u7684\u786e\u8ba4 --&gt;</p> <p>\u670d\u52a1\u7aef\u4e3b\u52a8\u5173\u95ed\uff0cS-&gt;C \u53d1\u9001\u62a5\u6587\u6bb5\uff0cseq: z\uff0cack: x+1\uff0cFIN+ACK\u3002</p> <p>\u670d\u52a1\u7aef\u53d1\u9001\u5b8c\u6570\u636e\u4e4b\u540e\uff0c\u5173\u95ed\u670d\u52a1\u7aef\u5230\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u3002</p> <p>\u5ba2\u6237\u7aef\u786e\u8ba4\uff0cS-&gt;C \u53d1\u9001\u62a5\u6587\u6bb5\uff0cseq: x\uff0cack: z+ 1\uff0cACK\u3002</p> <p>\u8fde\u63a5\u5173\u95ed\uff0c\u9700\u8981\u6ce8\u610f ACK \u62a5\u6587\u6bb5\u5e76\u672a\u6d88\u8017\u5e8f\u53f7\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_12","title":"\u72b6\u6001\u5217\u8868","text":"\u72b6\u6001 \u8bf4\u660e <code>CLOSED</code> \u6ca1\u6709\u8fde\u63a5\u3002 <code>LISTEN</code> \u6536\u5230\u4e86\u88ab\u52a8\u6253\u5f00\uff0c\u7b49\u5f85 SYN\u3002 <code>SYN-SENT</code> \u5df2\u53d1\u9001\u4e86 SYN\uff0c\u7b49\u5f85 ACK\u3002 <code>SYN-RCVD</code> \u5df2\u53d1\u9001\u4e86 SYN+ACK\uff0c\u7b49\u5f85 ACK\u3002 <code>ESTABLISHED</code> \u8fde\u63a5\u5efa\u7acb\uff0c\u6570\u636e\u4f20\u9001\u5728\u8fdb\u884c\u3002 <code>FIN-WAIT1</code> \u7b2c\u4e00\u4e2a FIN \u5df2\u53d1\u9001\uff0c\u7b49\u5f85 ACK\u3002 <code>FIN-WAIT2</code> \u5bf9\u7b2c\u4e00\u4e2a FIN \u7684 ACK \u5df2\u6536\u5230\uff0c\u7b49\u5f85\u7b2c\u4e8c\u4e2a FIN\u3002 <code>CLOSE-WAIT</code> \u6536\u5230\u7b2c\u4e00\u4e2a FIN\uff0c\u5df2\u53d1\u9001 ACK\uff0c\u7b49\u5f85\u5e94\u7528\u7a0b\u5e8f\u5173\u95ed\u3002 <code>TIME-WAIT</code> \u6536\u5230\u7b2c\u4e8c\u4e2a FIN\uff0c\u5df2\u53d1\u9001 ACK\uff0c\u7b49\u5f85 2MSL \u8d85\u65f6\u3002 <code>LAST-ACK</code> \u5df2\u53d1\u9001\u7b2c\u4e8c\u4e2a FIN\uff0c\u7b49\u5f85 ACK\u3002 <code>CLOSING</code> \u53cc\u65b9\u90fd\u4ee5\u51b3\u5b9a\u540c\u65f6\u5173\u95ed\u3002","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_13","title":"\u5efa\u7acb\u8fde\u63a5\u548c\u534a\u5173\u95ed\u4e2d\u6b62","text":"<p>\u4e0b\u56fe\u5c55\u793a\u4e86 TCP \u5efa\u7acb\u8fde\u63a5\u548c\u534a\u5173\u95ed\u7ec8\u6b62\u7684\u65f6\u95f4\u7ebf\u56fe\u3002  \u5ba2\u6237\u7aef\u72b6\u6001</p> <p>\u5ba2\u6237\u8fdb\u7a0b\u5411 TCP \u53d1\u51fa\u547d\u4ee4\uff0c\u8bf7\u6c42\u8fde\u63a5\u67d0\u4e2a\u7279\u5b9a\u7684\u5957\u63a5\u5b57\u5730\u5740\uff0c\u8fd9\u5c31\u79f0\u4e3a\u4e3b\u6253\u5f00\u3002\u4e8e\u662f TCP \u53d1\u51fa\u4e00\u4e2a SYN \u62a5\u6587\u6bb5\uff0c\u8fdb\u5165\u5230 <code>SYN-SENT</code> \u72b6\u6001\u3002</p> <p>\u5728\u6536\u5230 SYN+ACK \u62a5\u6587\u6bb5\u540e\uff0cTCP \u53d1\u9001 ACK \u62a5\u6587\u6bb5\uff0c\u5e76\u8fdb\u5165 <code>ESTABLISHED</code> \u72b6\u6001\u3002\u6b64\u540e\u6570\u636e\u5f00\u59cb\u4f20\u9001\u548c\u786e\u8ba4\u3002</p> <p>\u5f53\u5ba2\u6237\u6ca1\u6709\u66f4\u591a\u7684\u6570\u636e\u8981\u4f20\u9001\u65f6\uff0c\u5c31\u53d1\u51fa\u79f0\u4e3a\u4e3b\u52a8\u5173\u95ed\u7684\u547d\u4ee4\u3002\u4e8e\u662f TCP \u53d1\u9001 FIN \u62a5\u6587\u6bb5\uff0c\u5e76\u8fdb\u5165\u5230 <code>FIN-WAIT-1</code> \u72b6\u6001\u3002\u5f53\u5ba2\u6237\u7aef\u6536\u5230\u5bf9\u521a\u624d\u53d1\u9001\u7684 FIN \u62a5\u6587\u6bb5\u7684 ACK \u540e\u5c31\u8fdb\u5165\u5230 <code>FIN-WAIT-2</code> \u72b6\u6001\uff0c\u5e76\u7ee7\u7eed\u505c\u7559\u5728\u8fd9\u4e2a\u72b6\u6001\uff0c\u76f4\u5230\u6536\u5230\u670d\u52a1\u5668\u7684 FIN \u62a5\u6587\u6bb5\u4e3a\u6b62\u3002</p> <p>\u5728\u6536\u5230\u670d\u52a1\u5668\u7684 FIN \u62a5\u6587\u6bb5\u540e\uff0c\u5ba2\u6237\u7aef\u5c31\u53d1\u9001 ACK \u62a5\u6587\u6bb5\uff0c\u5e76\u8fdb\u5165 <code>TIME-WAIT</code> \u72b6\u6001\uff0c\u540c\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u8ba1\u65f6\u5668\uff0c\u5b83\u7684\u8d85\u65f6\u65f6\u95f4\u662f\u6700\u5927\u62a5\u6587\u6bb5\u5bff\u547d\uff08Maximum Segment Lifetime\uff0cMSL\uff09\u7684\u4e24\u500d\u3002</p> <p>\u4e3a\u4ec0\u4e48\u5ba2\u6237\u7aef\u5728\u6536\u5230\u670d\u52a1\u7aef\u7684 FIN \u4e4b\u540e\u4e0d\u7acb\u5373\u8fdb\u5165 <code>CLOSED</code> \u72b6\u6001\uff0c\u800c\u662f\u8981\u8fdb\u5165 <code>TIME-WAIT</code> \u72b6\u6001\u5e76\u4e14\u7b49\u5f85\u4e24\u4e2a MSL\uff1f</p> <p>\u7b2c\u4e00\u3001\u5982\u679c\u6700\u540e\u4e00\u4e2a ACK \u4e22\u5931\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u4f1a\u8ba4\u4e3a\u662f\u670d\u52a1\u5668\u81ea\u5df1\u7684 FIN \u4e22\u5931\uff08\u5b83\u4e3a\u6700\u540e\u7684 FIN \u8bbe\u7f6e\u4e86\u8ba1\u65f6\u5668\uff09\uff0c\u56e0\u800c\u91cd\u4f20\uff0c\u4f46\u662f\u5982\u679c\u5ba2\u6237\u7aef\u5df2\u7ecf\u5173\u95ed\u7684\u8bdd\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u65e0\u6cd5\u5173\u95ed\u8fde\u63a5\uff08\u80af\u5b9a\u8fd8\u662f\u6709\u529e\u6cd5\u5173\u95ed\u7684\uff0c\u7b49\u5f85\u8d85\u65f6\u6216\u8005\u8fbe\u5230\u6700\u5927\u8fde\u63a5\u6570\uff09\u30022MSL \u8ba1\u65f6\u5668\u53ef\u4ee5\u4f7f\u5ba2\u6237\u7b49\u5f85\u8db3\u591f\u957f\u7684\u65f6\u95f4\uff0c\u4f7f\u5f97 ACK \u4e22\u5931\uff08\u4e00\u4e2a MSL\uff09\u7684\u60c5\u51b5\u4e0b\u7b49\u5f85\u53e6\u4e00\u4e2a FIN \u7684\u5230\u6765\uff08\u4e00\u4e2a MSL\uff09\u3002</p> <p>\u5982\u679c\u5ba2\u6237\u7aef\u5728 TIME-WAIT \u72b6\u6001\u4e2d\u6709\u4e00\u4e2a\u65b0\u7684 FIN \u8fbe\u5230\uff0c\u5ba2\u6237\u7aef\u5c31\u53d1\u9001\u4e00\u4e2a\u65b0\u7684 ACK\uff0c\u5e76\u91cd\u65b0\u542f\u52a8 2MSL \u8ba1\u65f6\u5668\u3002</p> <p>\u7b2c\u4e8c\u3001\u5047\u5b9a\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5df2\u7ecf\u5173\u95ed\u4e86\u8fde\u63a5\uff0c\u7d27\u63a5\u7740\u7acb\u9a6c\u53c8\u65b0\u5efa\u4e86\u4e00\u4e2a\u8fde\u63a5\uff0c\u5e76\u4e14\u548c\u4e0a\u4e00\u4e2a\u8fde\u63a5\u4f7f\u7528\u7684\u4f7f\u540c\u4e00\u4e2a\u5957\u63a5\u5b57\u5730\u5740\u7684\u3002\u8fd9\u6837\u7684\u65b0\u8fde\u63a5\u79f0\u4e3a\u65e7\u8fde\u63a5\u7684<code>\u5316\u8eab</code>\u3002\u6ca1\u6709 2MSL \u7684\u8bdd\uff0c\u8fd9\u4e24\u4e2a\u8fde\u63a5\u7684\u95f4\u9694\u65f6\u95f4\u5f88\u77ed\uff0c\u6709\u53ef\u80fd\u524d\u4e00\u4e2a\u8fde\u63a5\u7684\u91cd\u590d\u62a5\u6587\u5230\u8fbe\u65b0\u7684\u8fde\u63a5\u4e2d\u3002\u4e3a\u4e86\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\u7b49\u5f85 2MSL \u8db3\u591f\u91cd\u590d\u8ba9\u62a5\u6587\u6bb5\u5728\u94fe\u8def\u4e2d\u88ab\u4e22\u5f03\uff0c\u800c\u4e0d\u5e72\u6270\u65b0\u7684\u8fde\u63a5\u3002</p> <p>\u670d\u52a1\u7aef\u72b6\u6001</p> <p>\u670d\u52a1\u7aef\u9996\u5148\u8981\u8fdb\u5165 <code>LISTEN</code> \u72b6\u6001\uff0c\u5e76\u7ee7\u7eed\u5904\u4e8e\u8fd9\u4e2a\u72b6\u6001\u4e2d\uff0c\u76f4\u5230\u6536\u5230 SYN \u62a5\u6587\u6bb5\u4e3a\u6b62\u3002</p> <p>\u5f53\u670d\u52a1\u7aef\u6536\u5230 SYN \u62a5\u6587\u6bb5\u4e4b\u540e\uff0c\u5c31\u53d1\u9001 SYN+ACK \u62a5\u6587\u6bb5\uff0c\u5e76\u8fdb\u5165 <code>SYN-RCVD</code> \u72b6\u6001\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u7684 ACK \u62a5\u6587\u6bb5\u3002</p> <p>\u5728\u6536\u5230 ACK \u62a5\u6587\u6bb5\u4e4b\u540e\uff0c\u5c31\u8fdb\u5165\u5230 <code>ESTABLISHED</code> \u72b6\u6001\uff0c\u6b64\u65f6\u53ef\u4ee5\u8fdb\u884c\u6570\u636e\u4f20\u9001\u3002</p> <p>TCP \u53ef\u4ee5\u4e00\u76f4\u4fdd\u6301\u5728 <code>ESTABLISHED</code> \u72b6\u6001\uff0c\u76f4\u5230\u6536\u5230\u6765\u81ea\u5ba2\u6237\u7aef\u7684 FIN \u62a5\u6587\u6bb5\uff0c\u8fd9\u8868\u793a\u5ba2\u6237\u7aef\u6ca1\u6709\u6570\u636e\u8981\u53d1\u9001\u4e86\uff0c\u56e0\u800c\u53ef\u4ee5\u5173\u95ed\u8fde\u63a5\u3002\u670d\u52a1\u7aef\u60f3\u5ba2\u6237\u7aef\u53d1\u9001 ACK \u62a5\u6587\u6bb5\uff0c\u5e76\u53d1\u9001\u961f\u5217\u4e2d\u5c1a\u672a\u53d1\u9001\u5b8c\u7684\u6570\u636e\uff0c\u7136\u540e\u8fdb\u5165 <code>CLOSE-WAIT</code> \u72b6\u6001\u3002</p> <p>\u6b64\u65f6\u8fde\u63a5\u65f6\u534a\u5173\u95ed\u7684\u72b6\u6001\uff0c\u670d\u52a1\u7aef TCP \u53ef\u4ee5\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u6570\u636e\u548c\u63a5\u6536\u786e\u8ba4\uff0c\u4f46\u662f\u6ca1\u6709\u53cd\u65b9\u5411\u7684\u6570\u636e\u80fd\u591f\u4f20\u9001\u8fc7\u6765\u3002\u670d\u52a1\u7aef\u53ef\u4ee5\u4e00\u76f4\u5904\u4e8e\u8fd9\u4e2a\u72b6\u6001\uff0c\u76f4\u5230\u5e94\u7528\u7a0b\u5e8f\u771f\u6b63\u5730\u53d1\u51fa\u5173\u95ed\u547d\u4ee4\u3002</p> <p>\u670d\u52a1\u7aef TCP \u53d1\u9001 FIN \u62a5\u6587\u6bb5\uff0c\u8868\u793a\u8981\u5173\u95ed\u8fd9\u4e2a\u8fde\u63a5\uff0c\u5e76\u8fdb\u5165\u5230 <code>LAST-ACK</code> \u72b6\u6001\u3002\u670d\u52a1\u5668 TCP \u4e00\u76f4\u5904\u4e8e\u8fd9\u4e2a\u72b6\u6001\u76f4\u5230\u6536\u5230\u6700\u540e\u7684 ACK \u62a5\u6587\u6bb5\uff0c\u7136\u540e\u8fdb\u5165 <code>CLOSED</code> \u72b6\u6001\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_14","title":"\u62d2\u7edd\u8fde\u63a5","text":"<p> \u4e00\u79cd\u5e38\u89c1\u7684\u60c5\u51b5\u662f\uff0c\u5ba2\u6237\u7aef\u8bf7\u6c42\u670d\u52a1\u5668\u7684\u7aef\u53e3\u5efa\u7acb\u8fde\u63a5\uff0c\u4f46\u662f\u670d\u52a1\u7aef\u7684\u7aef\u53e3\u5e76\u6ca1\u6709\u5904\u4e8e <code>LISTEN</code> \u72b6\u6001\u3002</p> <p>\u670d\u52a1\u5668 TCP \u5728\u6536\u5230\u8fd9\u6837\u7684 SYN \u62a5\u6587\u6bb5\u540e\u4f1a\u53d1\u9001\u4e00\u4e2a RST+ACK \u62a5\u6587\u6bb5\uff0c\u5b83\u786e\u8ba4\u4e86 SYN \u62a5\u6587\u6bb5\uff0c\u4f46\u4e8e\u6b64\u540c\u65f6\u91cd\u7f6e\u8fd9\u6761\u8fde\u63a5\u3002</p> <p>\u5ba2\u6237\u7aef\u5728\u6536\u5230\u8fd9\u4e2a RST+ACK \u62a5\u6587\u6bb5\u540e\u8fdb\u5165 <code>CLOSED</code> \u72b6\u6001\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#tcp","title":"TCP \u4e2d\u7684\u7a97\u53e3","text":"<p>TCP \u8fde\u63a5\u901a\u4fe1\u53cc\u65b9\u5171\u6709\u56db\u4e2a\u7a97\u53e3\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u53c8\u5404\u81ea\u7684\u53d1\u9001\u548c\u63a5\u6536\u7a97\u53e3\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_15","title":"\u53d1\u9001\u7a97\u53e3","text":"<p>\u867d\u7136 TCP \u4f20\u8f93\u7684\u662f\u4e00\u4e2a\u4e00\u4e2a\u7684\u62a5\u6587\u6bb5\uff0c\u4f46\u662f\u7528\u4e8e\u63a7\u5236\u7a97\u53e3\u7684\u53d8\u91cf\u662f\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u7684\u3002\u6ed1\u52a8\u7a97\u53e3\u5185\u7684\u6570\u636e\u662f\u5e94\u7528\u5c42\u7684\u6570\u636e\uff0c\u4e5f\u5373 TCP \u62a5\u6587\u6bb5\u7684\u6570\u636e\u90e8\u5206\uff0c\u800c\u4e0d\u662f\u6574\u4e2a TCP \u62a5\u6587\u6bb5\u7684\u6570\u636e\u3002</p> <p>\u7a97\u53e3\u5de6\u6cbf\u5916\u7684\u6570\u636e\u53ef\u4ee5\u4ece\u7f13\u5b58\u4e2d\u6e05\u9664\u3002\u7a97\u53e3\u53f3\u6cbf\u5916\u7684\u6570\u636e\u4e0d\u5141\u8bb8\u53d1\u9001\uff0c\u9664\u975e\u7a97\u53e3\u53f3\u6cbf\u5411\u53f3\u79fb\u52a8\u3002</p> <p>\u5173\u95ed \u7a97\u53e3\u7684\u5de6\u58c1\u5411\u53f3\u79fb\u52a8\u3002\u7a97\u53e3\u7684\u5de6\u58c1\u4e0d\u4f1a\u5411\u5de6\u79fb\u52a8\u3002 \u6253\u5f00 \u7a97\u53e3\u7684\u53f3\u58c1\u5411\u53f3\u79fb\u52a8\u3002 \u6536\u7f29 \u7a97\u53e3\u7684\u53f3\u58c1\u5411\u5de6\u79fb\u52a8\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_16","title":"\u63a5\u6536\u7a97\u53e3","text":"<p> TCP \u5141\u8bb8\u8fdb\u7a0b\u6309\u7167\u5b57\u8282\u7684\u8282\u594f\u6765\u62c9\u53d6\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5206\u914d\u7ed9\u63a5\u6536\u65b9\u7684\u7f13\u5b58\u4e2d\uff0c\u53ef\u80fd\u6709\u4e00\u90e8\u5206\u88ab\u5df2\u63a5\u6536\u548c\u786e\u8ba4\u4f46\u6b63\u7b49\u5f85\u63a5\u6536\u8fdb\u7a0b\u6765\u62c9\u53d6\u7684\u6570\u636e\u5360\u7528\u3002\u56e0\u6b64\uff0c\u63a5\u6536\u7a97\u53e3\u7684\u5927\u5c0f\u603b\u662f\u5c0f\u4e8e\u6216\u7b49\u4e8e\u7f13\u5b58\u5927\u5c0f\u3002\u63a5\u6536\u7a97\u53e3 rwnd \u53ef\u4ee5\u7528\u4ee5\u4e0b\u516c\u5f0f\u6765\u8ba1\u7b97\u3002 <pre><code>rwnd = \u7f13\u5b58\u5927\u5c0f - \u6b63\u5728\u7b49\u5f85\u88ab\u8fdb\u7a0b\u62c9\u53d6\u7684\u5b57\u8282\u6570\n</code></pre></p> <p>\u5173\u95ed \u7a97\u53e3\u7684\u5de6\u58c1\u5411\u5de6\u79fb\u52a8\u3002\u7a97\u53e3\u7684\u5de6\u58c1\u4e0d\u4f1a\u5411\u5de6\u79fb\u52a8\u3002 \u6253\u5f00 \u7a97\u53e3\u7684\u53f3\u58c1\u5411\u53f3\u79fb\u52a8\u3002\uff08\u5047\u8bbe\u7a97\u53e3\u7684\u53f3\u58c1\u4e0d\u4f1a\u5411\u5de6\u79fb\u52a8\uff0c\u867d\u7136\u5076\u5c14\u4f1a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u3002\uff09</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_17","title":"\u6d41\u91cf\u63a7\u5236","text":"<p>\u4e3a\u4e86\u5b9e\u73b0\u6d41\u91cf\u63a7\u5236\uff0cTCP \u7684\u53d1\u9001\u65b9\u548c\u63a5\u6536\u65b9\u9700\u8981\u4e0d\u65ad\u8c03\u6574\u5b83\u4eec\u7684\u7a97\u53e3\u5927\u5c0f\uff0c\u5373\u4f7f\u53cc\u65b9\u7684\u7f13\u5b58\u5728\u5efa\u7acb\u8fde\u63a5\u662f\u5c31\u88ab\u56fa\u5b9a\u4e0b\u6765\u4e86\u3002</p> <p>\u5f53\u6709\u66f4\u591a\u7684\u5b57\u8282\u4ece\u53d1\u9001\u65b9\u4f20\u8fc7\u6765\u65f6\uff0c\u63a5\u6536\u7a97\u53e3\u5173\u95ed\uff0c\u800c\u5f53\u66f4\u591a\u7684\u5b57\u8282\u88ab\u8fdb\u7a0b\u62c9\u53d6\u8d70\u65f6\uff0c\u63a5\u6536\u7a97\u53e3\u6253\u5f00\u3002</p> <p>\u53d1\u9001\u7a97\u53e3\u7684\u6253\u5f00\u3001\u5173\u95ed\u548c\u6536\u7f29\u662f\u88ab\u63a5\u6536\u65b9\u6240\u63a7\u5236\u7684\u3002\u5f53\u4e00\u4e2a\u65b0\u7684\u786e\u8ba4\u5230\u8fbe\uff0c\u4e14\u5728\u8fd9\u4e2a\u786e\u8ba4\u5141\u8bb8\u65f6\uff0c\u53d1\u9001\u7a97\u53e3\u4f1a\u5173\u95ed\u3002</p> <p>\u5f53\u7531\u63a5\u6536\u65b9\u901a\u544a\u7684\u63a5\u6536\u7a97\u53e3\u7684\u5927\u5c0f rwnd \u5141\u8bb8\u65f6\uff0c\u53d1\u9001\u7a97\u53e3\u4f1a\u6253\u5f00\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_18","title":"\u4e00\u79cd\u5047\u8bbe\u7684\u60c5\u51b5","text":"<p>\u4e0b\u9762\u63cf\u8ff0\u7684\u662f\u5728\u5efa\u7acb\u9636\u6bb5\u5982\u4f55\u8bbe\u7f6e\u53d1\u9001\u7a97\u53e3\u548c\u63a5\u6536\u7a97\u53e3\uff0c\u5e76\u4e14\u5728\u6570\u636e\u4f20\u9001\u65f6\u72b6\u6001\u53c8\u662f\u5982\u4f55\u53d1\u751f\u6539\u53d8\u7684\u3002\u6211\u4eec\u5148\u5ffd\u7565\u5dee\u9519\u63a7\u5236\uff0c\u5047\u8bbe\u6ca1\u6709\u62a5\u6587\u6bb5\u635f\u574f\u3001\u4e22\u5931\u3001\u91cd\u590d\u6216\u5931\u5e8f\u5230\u8fbe\u3002\u4e0b\u9762\u63cf\u8ff0\u7684\u662f\u4e00\u4e2a\u5355\u9879\u6570\u636e\u4f20\u9001\uff0c\u4ece\u5ba2\u6237\u7aef\u5230\u670d\u52a1\u5668\u7684\u7b80\u5355\u4f8b\u5b50\u3002</p> <p>\u7b2c\u4e00\u4e2a\u62a5\u6587\u662f\u5ba2\u6237\u7aef\u53d1\u9001 SYN \u62a5\u6587\u6bb5\uff0cISN \u4e3a 100\uff0c\u8bf7\u6c42\u5efa\u7acb\u8fde\u63a5\u3002\u5f53\u62a5\u6587\u6bb5\u8fbe\u5230\u670d\u52a1\u5668\u65f6\uff0c\u670d\u52a1\u5668\u5206\u914d\u4e00\u4e2a\u5927\u5c0f\u4e3a 800 \u5b57\u8282\u7684\u7f13\u5b58\uff0c\u5e76\u8bbe\u7f6e\u5b83\u7684\u63a5\u6536\u7a97\u53e3\u8986\u76d6\u6574\u4e2a\u7f13\u5b58\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u62a5\u6587\u6bb5\u662f\u4ece\u670d\u52a1\u7aef\u5230\u5ba2\u6237\u7aef\u3002\u8fd9\u662f\u4e00\u4e2a SYN+ACK \u62a5\u6587\u6bb5\u3002\u8fd9\u4e2a\u62a5\u6587\u6bb5\u7684 ack=101\uff0c\u540c\u65f6\u5ba3\u5e03\u4e86\u5ba2\u6237\u7aef\u53ef\u4ee5\u5c06\u53d1\u9001\u7a97\u53e3\u5927\u5c0f\u8bbe\u7f6e\u4e3a 800 \u5b57\u8282\u3002</p> <p>\u7b2c\u4e09\u4e2a\u62a5\u6587\u6bb5\u662f\u5ba2\u6237\u7aef\u5230\u670d\u52a1\u7aef\u7684 ACK \u62a5\u6587\u6bb5\u3002</p> <p>\u5f53\u5ba2\u6237\u7aef\u6839\u636e\u670d\u52a1\u7aef\u7684\u6307\u793a\u8bbe\u7f6e\u81ea\u5df1\u7684\u7a97\u53e3 800 \u5b57\u8282\u4e4b\u540e\uff0c\u8fdb\u7a0b\u63a8\u9001 200 \u5b57\u8282\u7684\u6570\u636e\u3002TCP \u5ba2\u6237\u7aef\u7528 101~300 \u7ed9\u8fd9\u4e9b\u5b57\u8282\u7f16\u53f7\uff0c\u7136\u540e\u521b\u5efa\u4e00\u4e2a\u62a5\u6587\u6bb5\u5e76\u5c06\u5176\u53d1\u9001\u81f3\u670d\u52a1\u7aef\u3002\u62a5\u6587\u6bb5\u663e\u793a\u8d77\u59cb\u5b57\u8282\u7f16\u53f7\u4e3a 101\uff0c\u5e76\u4e14\u643a\u5e26\u4e86 200 \u5b57\u8282\u7684\u6570\u636e\u3002\u5ba2\u6237\u7aef\u4f1a\u8c03\u6574\u7a97\u53e3\uff0c\u6765\u8868\u793a\u5df2\u53d1\u9001 200 \u5b57\u8282\u7684\u6570\u636e\uff0c\u4e14\u6b63\u5728\u7b49\u5f85\u786e\u8ba4\u3002\u5f53\u8fd9\u4e2a\u62a5\u6587\u8fbe\u5230\u670d\u52a1\u7aef\u540e\uff0c\u8fd9\u4e9b\u5b57\u8282\u88ab\u4fdd\u5b58\u4e0b\u6765\uff0c\u63a5\u6536\u7a97\u53e3\u5173\u95ed\u4ee5\u8868\u793a\u4e0b\u4e00\u4e2a\u5e0c\u671b\u63a5\u6536\u7684\u5b57\u8282\u662f 301\u3002\u88ab\u4fdd\u5b58\u7684\u5b57\u8282\u5360\u7528\u4e86\u7f13\u5b58\u4e2d\u7684 200 \u5b57\u8282\u3002</p> <p>\u7b2c\u4e94\u4e2a\u62a5\u6587\u662f\u670d\u52a1\u7aef\u5230\u5ba2\u6237\u7aef\u7684\u53cd\u9988\uff0c\u670d\u52a1\u7aef\u786e\u8ba4\u4e86\u7f16\u53f7 300 \u53ca\u5176\u4e4b\u524d\u7684\u6240\u6709\u5b57\u8282\u3002\u8fd9\u4e2a\u62a5\u6587\u6bb5\u8fd8\u643a\u5e26\u4e86\u4e00\u4e2a\u51cf\u5c0f\u4e4b\u540e\u7684\u63a5\u6536\u7a97\u53e3\u5927\u5c0f\uff08600\uff09\u3002\u5ba2\u6237\u7aef\u5728\u63a5\u6536\u5230\u8fd9\u4e2a\u62a5\u6587\u4e4b\u540e\uff0c\u5c06\u4ee5\u88ab\u786e\u8ba4\u7684\u6570\u636e\u4ece\u53d1\u9001\u7a97\u53e3\u6e05\u9664\u51fa\u53bb\uff0c\u5e76\u5173\u95ed\u7a97\u53e3\uff0c\u4ee5\u8868\u793a\u4e0b\u4e00\u4e2a\u8981\u53d1\u9001\u7684\u5b57\u8282\u662f 301\u3002\u4f46\u662f\u8fd9\u4e2a\u7a97\u53e3\u7684\u5927\u5c0f\u8981\u7f29\u51cf\u81f3 600\u3002\u867d\u7136\u5206\u914d\u7684\u7f13\u5b58\u80fd\u591f\u653e\u5f97\u4e0b 800 \u5b57\u8282\uff0c\u4f46\u662f\u7a97\u53e3\u4e0d\u80fd\u5c06\u5176\u53f3\u58c1\u5411\u53f3\u79fb\u52a8\uff0c\u56e0\u4e3a\u63a5\u6536\u65b9\u6ca1\u6709\u5141\u8bb8\u5b83\u8fd9\u6837\u505a\u3002</p> <p>\u5f53\u5ba2\u6237\u8fdb\u7a0b\u53c8\u63a8\u9001\u53e6\u5916\u7684 300 \u5b57\u8282\uff0cTCP \u53d1\u9001\u62a5\u6587\u6bb5 6\u3002\u8fd9\u4e2a\u62a5\u6587\u6bb5\u7684\u5e8f\u53f7\u662f 301\uff0c\u5e76\u4e14\u5305\u542b\u4e86 300 \u4e2a\u5b57\u8282\u3002\u5f53\u8fd9\u4e2a\u62a5\u6587\u6bb5\u5230\u8fbe\u670d\u52a1\u7aef\u4e4b\u540e\uff0c\u670d\u52a1\u7aef\u5c06\u5b83\u4eec\u4fdd\u5b58\u4e0b\u6765\uff0c\u4f46\u662f\u670d\u52a1\u7aef\u5fc5\u987b\u51cf\u5c11\u63a5\u6536\u7a97\u53e3\u7684\u5927\u5c0f\u3002\u5728\u670d\u52a1\u7aef\u8fdb\u7a0b\u62c9\u53d6\u4e86 100 \u4e2a\u5b57\u8282\u7684\u6570\u636e\u4e4b\u540e\uff0c\u7a97\u53e3\u4ece\u5de6\u8fb9\u5173\u95ed 300 \u4e2a\u5b57\u8282\uff0c\u540c\u65f6\u53c8\u5411\u53f3\u8fb9\u6253\u5f00 100 \u4e2a\u5b57\u8282\u3002\u73b0\u5728\u63a5\u6536\u7a97\u53e3\u7684\u5927\u5c0f\u662f 400 \u5b57\u8282\u3002</p> <p>\u5728\u7b2c\u4e03\u4e2a\u62a5\u6587\u6bb5\u4e2d\uff0c\u670d\u52a1\u7aef\u5bf9\u6536\u5230\u7684\u5b57\u8282\u8fdb\u884c\u786e\u8ba4\uff0c\u5e76\u5ba3\u5e03\u63a5\u6536\u7a97\u53e3\u7684\u5927\u5c0f\u662f 400\u3002\u5f53\u8fd9\u4e2a\u62a5\u6587\u5230\u8fbe\u5ba2\u6237\u7aef\u540e\uff0c\u5ba2\u6237\u7aef\u6ca1\u6709\u5176\u4ed6\u9009\u62e9\uff0c\u53ea\u80fd\u518d\u4e00\u6b21\u5c06\u7a97\u53e3\u51cf\u5c0f\u3002\u5ba2\u6237\u7aef\u5c06\u53d1\u9001\u7a97\u53e3\u4ece\u5de6\u8fb9\u5173\u95ed 300 \u5b57\u8282\uff0c\u5e76\u5728\u53f3\u8fb9\u6253\u5f00 100 \u5b57\u8282\u3002</p> <p>\u62a5\u6587\u6bb5\u516b\u662f\u670d\u52a1\u5668\u8fdb\u7a0b\u53c8\u4e00\u6b21\u62c9\u53d6\u4e86 200 \u5b57\u8282\u4e4b\u540e\u4ece\u670d\u52a1\u5668\u53d1\u51fa\u7684\u3002\u670d\u52a1\u7aef\u7684\u7a97\u53e3\u5927\u5c0f\u589e\u52a0\u4e86\uff0c\u73b0\u5728\uff0c\u65b0\u7684 rwnd \u662f 600\u3002\u8fd9\u4e2a\u62a5\u6587\u6bb5\u544a\u8bc9\u5ba2\u6237\u7aef\uff0c\u670d\u52a1\u7aef\u4ecd\u5728\u671f\u76fc\u7740\u5b57\u8282 601\uff0c\u4f46\u662f\u670d\u52a1\u7aef\u7684\u7a97\u53e3\u5927\u5c0f\u5df2\u7ecf\u6269\u5c55\u5230 600 \u4e86\u3002\u6ce8\u610f\uff0c\u8fd9\u4e2a\u62a5\u6587\u6bb5\u7684\u53d1\u9001\u4e0e\u5426\u53d6\u51b3\u4e8e\u5177\u4f53\u5b9e\u73b0\u7684\u7b56\u7565\u3002\u5f53\u8fd9\u4e2a\u62a5\u6587\u6bb5\u5230\u8fbe\u5ba2\u6237\u7aef\u540e\uff0c\u5ba2\u6237\u7aef\u5c06\u53d1\u9001\u7a97\u53e3\u518d\u6253\u5f00 200 \u5b57\u8282\uff0c\u5e76\u4e14\u6ca1\u6709\u505a\u4efb\u4f55\u52a8\u4f5c\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_19","title":"\u7a97\u53e3\u7684\u6536\u7f29","text":"<p>\u63a5\u6536\u7a97\u53e3\u4e0d\u5141\u8bb8\u6536\u7f29\u3002</p> <p>\u53d1\u9001\u7a97\u53e3\uff0c\u5982\u679c\u63a5\u6536\u65b9\u6307\u5b9a\u7684 rwnd \u503c\u4f1a\u5bfc\u81f4\u53d1\u9001\u7a97\u53e3\u7f29\u5c0f\uff0c\u90a3\u4e48\u53d1\u9001\u7a97\u53e3\u5c31\u6536\u7f29\u3002</p> <p>\u67d0\u4e9b\u5b9e\u73b0\u662f\u4e0d\u5141\u8bb8\u53d1\u9001\u7a97\u53e3\u6536\u7f29\u7684\uff0c\u5b83\u9650\u5236\u4e86\u53d1\u9001\u7a97\u53e3\u7684\u53f3\u74a7\u4e0d\u5141\u8bb8\u5411\u5de6\u79fb\u52a8\u3002\u4e3a\u4e86\u9632\u6b62\u53d1\u9001\u7a97\u53e3\u7684\u6536\u7f29\uff0c\u63a5\u6536\u65b9\u5728\u6700\u8fd1\u7684\u548c\u65b0\u7684\u786e\u8ba4\u4ee5\u53ca\u6700\u8fd1\u7684\u548c\u65b0\u7684 rwnd \u503c\u4e4b\u95f4\u59cb\u7ec8\u8981\u6ee1\u8db3\u4e0b\u8ff0\u5173\u7cfb\uff1a <pre><code>\u65b0\u7684 ackNo + \u65b0\u7684 rwnd &gt;= \u6700\u8fd1\u7684 ackNo + \u6700\u8fd1\u7684 rwnd\n</code></pre> \u8fd9\u4e2a\u4e0d\u7b49\u5f0f\u7684\u5de6\u8fb9\u4ee3\u8868\u4e86\u53f3\u74a7\u7684\u65b0\u4f4d\u7f6e\uff0c\u53f3\u4fa7\u4ee3\u8868\u4e86\u7a97\u53e3\u53f3\u74a7\u539f\u6765\u7684\u4f4d\u7f6e\u3002\u8fd9\u4e2a\u5173\u7cfb\u8bf4\u660e\u7a97\u53e3\u53f3\u74a7\u4e0d\u4f1a\u5411\u5de6\u79fb\u52a8\uff08\u6536\u7f29\uff09\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_20","title":"\u7a97\u53e3\u7684\u5173\u95ed","text":"<p>\u53d1\u9001\u7a97\u53e3\u7684\u53f3\u74a7\u5de6\u79fb\u4ee5\u6536\u7f29\u53d1\u9001\u7a97\u53e3\u662f\u975e\u5e38\u4e0d\u5e0c\u671b\u51fa\u73b0\u7684\u3002\u4f46\u662f\u6709\u4e00\u4e2a\u4f8b\u5916\uff1a\u63a5\u6536\u7aef\u53ef\u4ee5\u53d1\u9001 rwnd \u4e3a 0 \u7684\u62a5\u6587\u6bb5\u6765\u6682\u65f6\u5173\u95ed\u7a97\u53e3\u3002\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\u662f\u7531\u4e8e\u63a5\u6536\u65b9\u56e0\u4e3a\u67d0\u79cd\u539f\u56e0\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u4e0d\u613f\u610f\u4ece\u53d1\u9001\u65b9\u63a5\u6536\u4efb\u4f55\u6570\u636e\u3002\u6b64\u65f6\uff0c\u53d1\u9001\u65b9\u5b9e\u9645\u4e0a\u5e76\u975e\u771f\u6b63\u7684\u628a\u7a97\u53e3\u5927\u5c0f\u6536\u7f29\u4e86\uff0c\u800c\u662f\u6682\u505c\u53d1\u9001\u6570\u636e\uff0c\u76f4\u5230\u6536\u5230\u4e00\u4e2a\u65b0\u7684\u901a\u544a\u4e3a\u6b62\u3002\u5b9e\u9645\u4e0a\uff0c\u5373\u4f7f\u5173\u95ed\u4e86\u53d1\u9001\u7a97\u53e3\uff0c\u53d1\u9001\u65b9\u4ecd\u7136\u53ef\u4ee5\u53d1\u9001\u5177\u6709\u4e00\u4e2a\u5b57\u8282\u7684\u62a5\u6587\u6bb5\uff0c\u79f0\u4e3a\u63a2\u6d4b\uff0c\u7528\u4e8e\u9632\u6b62\u6b7b\u9501\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_21","title":"\u7cca\u6d82\u7a97\u53e3\u7efc\u5408\u5f81","text":"<p>\u5f53\u53d1\u9001\u5e94\u7528\u7a0b\u5e8f\u4ea7\u751f\u6570\u636e\u7684\u901f\u5ea6\u5f88\u6162\uff0c\u6216\u8005\u63a5\u6536\u5e94\u7528\u7a0b\u5e8f\u6d88\u8017\u7684\u901f\u5ea6\u5f88\u6162\uff0c\u6216\u8005\u4e24\u8005\u90fd\u6709\u3002\u4e0d\u7ba1\u4e0a\u8ff0\u54ea\u4e00\u79cd\u60c5\u51b5\uff0c\u90fd\u4f1a\u4f7f\u5f97\u53d1\u9001\u6570\u636e\u7684\u62a5\u6587\u6bb5\u5f88\u5c0f\uff0c\u8fd9\u5c31\u4f1a\u964d\u4f4e\u8fd0\u884c\u6548\u7387\u3002\u4f8b\u5982\uff0c\u5047\u82e5 TCP \u53d1\u9001\u7684\u62a5\u6587\u6bb5\u53ea\u5305\u542b 1 \u4e2a\u5b57\u8282\u7684\u6570\u636e\uff0c\u90a3\u4e48\u610f\u5473\u7740\u6211\u4eec\u4e3a\u4f20\u9001 1 \u5b57\u8282\u7684\u6570\u636e\u800c\u9001\u4e86 41 \u5b57\u8282\u7684\u6570\u636e\uff0820 \u5b57\u8282\u7684 TCP \u9996\u90e8\u548c 20 \u5b57\u8282\u7684 IP \u9996\u90e8\uff09\u3002\u8fd9\u65f6\u4f7f\u7528\u7f51\u7edc\u7684\u6548\u7387\u975e\u5e38\u4f4e\uff0c\u5982\u679c\u5728\u7b97\u4e0a\u6570\u636e\u94fe\u8def\u5c42\u548c\u7269\u7406\u5c42\u7684\u5f00\u9500\u540e\uff0c\u8fd9\u79cd\u4f4e\u6548\u7387\u5c31\u66f4\u52a0\u4e25\u91cd\u4e86\u3002\u8fd9\u4e2a\u95ee\u9898\u79f0\u4e3a\u7cca\u6d82\u7a97\u53e3\u7efc\u5408\u5f81\uff08silly window syndrome\uff09\u3002</p> <p>\u53d1\u9001\u65b9\u4ea7\u751f\u7684\u75c7\u72b6 \u5982\u679c\u53d1\u9001 TCP \u6b63\u5728\u4e3a\u4e00\u4e2a\u4ea7\u751f\u6570\u636e\u901f\u5ea6\u5f88\u6162\u7684\u5e94\u7528\u7a0b\u5e8f\u670d\u52a1\uff0c\u4f8b\u5982\u4e00\u6b21\u4ea7\u751f 1 \u4e2a\u5b57\u8282\uff0c\u90a3\u4e48\u5c31\u53ef\u80fd\u4ea7\u751f\u7cca\u6d82\u7a97\u53e3\u7efc\u5408\u5f81\u3002\u5e94\u7528\u7a0b\u5e8f\u4e00\u6b21\u628a 1 \u4e2a\u5b57\u8282\u7684\u6570\u636e\u5199\u5165\u5230\u53d1\u9001 TCP \u7684\u7f13\u5b58\u3002\u5982\u679c\u53d1\u9001 TCP \u6ca1\u6709\u4efb\u4f55\u7279\u6b8a\u7684\u6307\u4ee4\uff0c\u5b83\u5c31\u4f1a\u4ea7\u751f\u53ea\u5305\u62ec 1 \u4e2a\u5b57\u8282\u6570\u636e\u7684\u62a5\u6587\u6bb5\u3002\u5176\u7ed3\u679c\u5c31\u662f\u5f88\u591a\u4e2a 41 \u5b57\u8282\u7684\u62a5\u6587\u6bb5\u5728\u4e92\u8054\u7f51\u4e2d\u4f20\u6765\u4f20\u53bb\u3002</p> <p>\u89e3\u51b3\u95ee\u9898\u7684\u529e\u6cd5\u5c31\u662f\u9632\u6b62 TCP \u4e00\u4e2a\u4e00\u4e2a\u5b57\u8282\u7684\u53d1\u9001\u6570\u636e\u3002\u5fc5\u987b\u8981\u5f3a\u8feb\u53d1\u9001 TCP \u7b49\u5f85\uff0c\u5e76\u628a\u6570\u636e\u6536\u96c6\u6210\u8f83\u5927\u7684\u6570\u636e\u5757\u540e\u518d\u53d1\u9001\u3002\u53d1\u9001 TCP \u7b49\u5f85\u591a\u957f\u65f6\u95f4\u5462\uff1f\u5982\u679c\u7b49\u5f85\u8fc7\u957f\uff0c\u5c31\u4f1a\u5ef6\u8fdf\u4e86\u5904\u7406\u8fc7\u7a0b\uff0c\u5982\u679c\u7b49\u5f85\u7684\u65f6\u95f4\u4e0d\u591f\u957f\uff0c\u6700\u540e\u5f88\u53ef\u80fd\u8fd8\u662f\u53d1\u9001\u4e00\u4e2a\u4e2a\u5c0f\u7684\u62a5\u6587\u6bb5\u3002</p> <p>Nagle \u7b97\u6cd5\u627e\u5230\u4e86\u4e00\u4e2a\u5f88\u7cbe\u5de7\u7684\u89e3\u51b3\u529e\u6cd5\uff1a 1. \u53d1\u9001 TCP \u628a\u5b83\u4ece\u53d1\u9001\u5e94\u7528\u7a0b\u5e8f\u6536\u5230\u7684\u7b2c\u4e00\u5757\u6570\u636e\u53d1\u9001\u51fa\u53bb\uff0c\u54ea\u6015\u53ea\u6709\u4e00\u4e2a\u5b57\u8282\u3002 2. \u5728\u53d1\u9001\u4e86\u7b2c\u4e00\u4e2a\u62a5\u6587\u6bb5\u540e\uff0c\u53d1\u9001 TCP \u5c31\u5728\u8f93\u51fa\u7f13\u5b58\u4e2d\u79ef\u7d2f\u6570\u636e\u5e76\u7b49\u5f85\uff0c\u76f4\u5230\u6536\u5230 TCP \u53d1\u6765\u7684\u786e\u8ba4\uff0c\u6216\u8005\u5df2\u79ef\u7d2f\u4e86\u8db3\u591f\u7684\u6570\u636e\u53ef\u4ee5\u5c01\u88c5\u6210\u6700\u5927\u957f\u5ea6\u7684\u62a5\u6587\u6bb5\u3002\u8fd9\u65f6\uff0c\u53d1\u9001 TCP \u636e\u53ef\u4ee5\u554a\u53d1\u9001\u8fd9\u4e2a\u62a5\u6587\u6bb5\u4e86\u3002 3. \u5bf9\u5269\u4e0b\u7684\u4f20\u8f93\uff0c\u4e0d\u65ad\u91cd\u590d\u6b65\u9aa4 2\u3002</p> <p>Nagle \u7b97\u6cd5\u7684\u7cbe\u5999\u4e4b\u5904\u5728\u4e8e\u5b83\u7684\u7b80\u5355\uff0c\u5e76\u4e14\u5b9e\u9645\u4e0a\u6743\u8861\u4e86\u5e94\u7528\u7a0b\u5e8f\u4ea7\u751f\u7684\u901f\u7387\u548c\u7f51\u7edc\u8fd0\u8f93\u6570\u636e\u7684\u901f\u7387\u3002\u82e5\u5e94\u7528\u7a0b\u5e8f\u6bd4\u7f51\u7edc\u5757\uff0c\u5219\u62a5\u6587\u6bb5\u8f83\u5927\uff1b\u82e5\u5e94\u7528\u7a0b\u5e8f\u6bd4\u7f51\u7edc\u6162\uff0c\u5219\u62a5\u6587\u6bb5\u8f83\u5c0f\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b Nagle \u7b97\u6cd5\u662f\u542f\u52a8\u7684\uff0cJava \u53ef\u4ee5\u901a\u8fc7 <code>setTcpNoNagle(true);</code> \u6765\u7981\u7528 Nagle \u7b97\u6cd5\u3002 <pre><code>Socket socket = new Socket();  \nsocket.setTcpNoDelay(true);\n</code></pre></p> <p>Nagle \u7b97\u6cd5\u51fa\u73b0\u7684\u65f6\u5019\u7f51\u7edc\u7684\u5e26\u5bbd\u90fd\u5f88\u5c0f\uff0c\u5f53\u6709\u5927\u91cf\u5c0f\u5305\u4f20\u8f93\u65f6\uff0c\u5f88\u5bb9\u6613\u5c06\u5e26\u5bbd\u5360\u6ee1\uff0c\u51fa\u73b0\u4e22\u5305\u91cd\u4f20\u7b49\u73b0\u8c61\u3002Nagle \u7b97\u6cd5\u7684\u4f5c\u7528\u662f\u51cf\u5c11\u5c0f\u5305\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u76f4\u63a5\u4f20\u8f93\u3002</p> <p>\u4e00\u822c\u5bf9\u65f6\u5ef6\u654f\u611f\u7684\u7a0b\u5e8f Nagle \u7b97\u6cd5\u7684\u610f\u4e49\u5c31\u4e0d\u5927\u4e86\u3002\u6bd4\u5982\u5728\u7ebf\u6e38\u620f\uff0c\u53ef\u4ee5\u7981\u7528 Nagle \u7b97\u6cd5\u6765\u51cf\u5c11\u5ef6\u8fdf</p> <p>\u6d4b\u8bd5</p> <p>\u670d\u52a1\u7aef <code>nc -l 9999</code> \u76d1\u542c\u7aef\u53e3\u3002</p> <p>\u5ba2\u6237\u7aef\u4ee3\u7801 <pre><code>package tcp;  \n\nimport java.io.OutputStream;  \nimport java.net.InetSocketAddress;  \nimport java.net.Socket;  \nimport java.util.concurrent.TimeUnit;  \n\npublic class NagleClient {  \n\n    public static void main(String[] args) throws Exception {  \n        Socket socket = new Socket();  \n        socket.connect(new InetSocketAddress(\"172.31.8.118\", 9999));  \n        OutputStream out = socket.getOutputStream();  \n        byte[] request = new byte[10];  \n        for (int i = 0; i &lt; 5; i ++) {  \n            out.write(request);  \n        }  \n\n        TimeUnit.SECONDS.sleep(1);  \n        socket.close();  \n    }  \n}\n</code></pre></p> <p>\u6293\u5305\u80fd\u8fc7\u591f\u53d1\u73b0\uff0c\u63e1\u624b\u7ed3\u675f\u4e4b\u540e\u7acb\u9a6c\u53d1\u9001\u4e86\u7b2c\u4e00\u4e2a\u5305\uff0c\u6570\u636e\u4e3a 10 \u4e2a\u5b57\u8282\u3002\u7136\u540e\u53d1\u9001\u7b2c\u4e8c\u4e2a\u6570\u636e\u5305\uff0c\u6570\u636e\u4e3a 40 \u5b57\u8282\u3002 </p> <p>\u8bbe\u7f6e<code>socket.setTcpNoDelay(true);</code>\u4e4b\u540e\uff0c\u6293\u5305\u80fd\u591f\u53d1\u73b0\uff0c\u8fde\u7eed\u53d1\u9001\u4e86 5 \u4e2a 10 \u5b57\u8282\u7684\u6570\u636e\u5305\u3002 </p> <p>\u63a5\u6536\u65b9\u4ea7\u751f\u7684\u75c7\u72b6 \u5982\u679c\u63a5\u6536 TCP \u4e3a\u4e00\u4e2a\u6d88\u8017\u6570\u636e\u5f88\u6162\u7684\u5e94\u7528\u7a0b\u5e8f\u670d\u52a1\uff0c\u4f8b\u5982\u4e00\u6b21\u6d88\u8017\u4e00\u4e2a\u5b57\u8282\uff0c\u5b83\u5c31\u6709\u53ef\u80fd\u4ea7\u751f\u7cca\u6d82\u7a97\u53e3\u7efc\u5408\u5f81\u3002\u56e0\u4e3a\u5982\u679c\u63a5\u6536\u7a97\u53e3\u6ee1\u4e86\u4e4b\u540e\uff0c\u6bcf\u6b21\u91ca\u653e\u4e00\u4e2a\u5b57\u8282\uff0c\u7136\u540e\u901a\u77e5\u53d1\u9001\u65b9\u53ef\u4ee5\u8c03\u6574\u7a97\u53e3\u4e3a 1\uff0c\u53d1\u9001\u4e00\u4e2a\u5b57\u8282\u7ee7\u7eed\u7b49\u5f85\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u79cd\u7cca\u6d82\u7a97\u53e3\u7efc\u5408\u5f81\uff0c\u5373\u5e94\u7528\u7a0b\u5e8f\u6d88\u8017\u6570\u636e\u7684\u901f\u5ea6\u6bd4\u6570\u636e\u5230\u8fbe\u7684\u901f\u5ea6\u6162\uff0c\u6709\u4e24\u79cd\u5efa\u8bae\u7684\u89e3\u51b3\u529e\u6cd5\u3002</p> <p>Clark \u89e3\u51b3\u65b9\u6cd5 \u53ea\u8981\u6709\u6570\u636e\u5230\u8fbe\u5c31\u53d1\u9001\u786e\u8ba4\uff0c\u4f46\u5728\u7f13\u5b58\u4e2d\u6709\u8db3\u591f\u5927\u7684\u7a7a\u95f4\u653e\u5165\u6700\u5927\u957f\u5ea6\u62a5\u6587\u6bb5\u4e4b\u524d\uff0c\u6216\u8005\u81f3\u5c11\u6709\u4e00\u534a\u7684\u7f13\u5b58\u7a7a\u95f4\u4e4b\u524d\uff0c\u4e00\u76f4\u90fd\u5ba3\u5e03\u7a97\u53e3\u5927\u5c0f\u4e3a\u96f6\u3002</p> <p>\u63a8\u8fdf\u786e\u8ba4 \u7b2c\u4e8c\u79cd\u89e3\u51b3\u65b9\u6cd5\u662f\u63a8\u8fdf\u786e\u8ba4\u3002\u8fd9\u5c31\u8868\u793a\u5f53\u62a5\u6587\u6bb5\u8fbe\u5230\u65f6\u5e76\u4e0d\u7acb\u5373\u53d1\u9001\u786e\u8ba4\u3002\u63a5\u6536\u65b9\u5728\u5bf9\u6536\u5230\u7684\u62a5\u6587\u6bb5\u8fdb\u884c\u786e\u8ba4\u4e4b\u524d\u4e00\u76f4\u7b49\u5f85\uff0c\u76f4\u81f3\u8f93\u5165\u7f13\u5b58\u6709\u8db3\u591f\u7684\u7a7a\u95f4\u4e3a\u6b62\u3002\u63a8\u8fdf\u53d1\u9001\u786e\u8ba4\u9632\u6b62\u4e86\u53d1\u9001 TCP \u6ed1\u52a8\u5b83\u7684\u7a97\u53e3\u3002\u53d1\u9001 TCP \u5728\u53d1\u9001\u4e86\u6570\u636e\u4e4b\u540e\u5c31\u505c\u4e0b\u6765\uff0c\u56e0\u800c\u9632\u6b62\u4e86\u8fd9\u79cd\u75c7\u72b6\u51fa\u73b0\u3002</p> <p>\u63a8\u8fdf\u786e\u8ba4\u8fd8\u6709\u53e6\u5916\u4e00\u4e2a\u4f18\u70b9\uff0c\u5b83\u51cf\u5c11\u4e86\u901a\u4fe1\u91cf\u3002\u63a5\u6536\u65b9\u4e0d\u9700\u8981\u5bf9\u6bcf\u4e00\u4e2a\u62a5\u6587\u6bb5\u8fdb\u884c\u786e\u8ba4\u3002\u4f46\u662f\u5b83\u6709\u4e00\u4e2a\u7f3a\u70b9\uff0c\u5c31\u662f\u786e\u8ba4\u7684\u63a8\u8fdf\u6709\u53ef\u80fd\u8feb\u4f7f\u53d1\u9001\u65b9\u91cd\u4f20\u672a\u88ab\u786e\u8ba4\u7684\u62a5\u6587\u6bb5\u3002\u5f53\u7136 TCP \u53ef\u4ee5\u8fdb\u884c\u5e73\u8861\uff0c\u63a8\u8fdf\u7684\u65f6\u95f4\u4e0d\u80fd\u8d85\u8fc7\u4e00\u4e2a\u503c\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_22","title":"\u5dee\u9519\u63a7\u5236","text":"<p>TCP \u662f\u53ef\u9760\u7684\u8fd0\u8f93\u5c42\u534f\u8bae\u3002\u8fd9\u5c31\u8868\u793a\u5e94\u7528\u5c42\u628a\u6570\u636e\u6d41\u4ea4\u4ed8\u7ed9 TCP \u540e\uff0c\u5c31\u8981\u4f9d\u9760 TCP \u628a\u6574\u4e2a\u6570\u636e\u6d41\u4ea4\u4ed8\u7ed9\u53e6\u4e00\u7aef\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e76\u4e14\u662f\u6309\u5e8f\u7684\u3001\u6ca1\u6709\u5dee\u9519\u3001\u4e5f\u6ca1\u6709\u4efb\u4f55\u4e00\u90e8\u5206\u4e22\u5931\u6216\u91cd\u590d\u3002</p> <p>TCP \u4f7f\u7528\u5dee\u9519\u63a7\u5236\u6765\u63d0\u4f9b\u53ef\u9760\u6027\u3002\u5dee\u9519\u63a7\u5236\u5305\u62ec\u4ee5\u4e0b\u4e00\u4e9b\u673a\u5236\uff1a\u68c0\u6d4b\u548c\u91cd\u4f20\u6536\u5230\u635f\u4f24\u7684\u62a5\u6587\u3001\u91cd\u4f20\u4e22\u5931\u7684\u62a5\u6587\u6bb5\u3001\u4fdd\u5b58\u5931\u5e8f\u8fbe\u5230\u7684\u62a5\u6587\u6bb5\u76f4\u81f3\u7f3a\u5931\u7684\u62a5\u6587\u6bb5\u5230\u9f50\uff0c\u4ee5\u53ca\u68c0\u6d4b\u548c\u4e22\u5f03\u91cd\u590d\u7684\u62a5\u6587\u6bb5\u3002TCP \u901a\u8fc7\u4f7f\u7528\u4e09\u4e2a\u5de5\u5177\u6765\u5b8c\u6210\u5176\u5dee\u9519\u63a7\u5236\uff1a\u6821\u9a8c\u548c\u3001\u786e\u8ba4\u548c\u8d85\u65f6\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_23","title":"\u6821\u9a8c\u548c","text":"<p>\u6bcf\u4e2a\u62a5\u6587\u6bb5\u90fd\u5305\u542b\u4e86\u4e00\u4e2a\u6821\u9a8c\u548c\u5b57\u6bb5\uff0c\u7528\u6765\u68c0\u6d4b\u62a5\u6587\u6bb5\u662f\u5426\u53d7\u5230\u635f\u4f24\u3002\u5982\u679c\u67d0\u4e2a\u62a5\u6587\u6bb5\u56e0\u6821\u9a8c\u548c\u65e0\u6548\u800c\u88ab\u68c0\u6d4b\u51fa\u6536\u5230\u635f\u4f24\uff0c\u5c31\u7531\u7ec8\u70b9 TCP \u5c06\u5176\u4e22\u5f03\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_24","title":"\u786e\u8ba4","text":"<p>TCP \u91c7\u7528\u786e\u8ba4\u6765\u8bc1\u5b9e\u6536\u5230\u4e86\u62a5\u6587\u6bb5\u3002ACK \u62a5\u6587\u6bb5\u4e0d\u6d88\u8017\u5e8f\u53f7\uff0c\u4e5f\u4e0d\u9700\u8981\u88ab\u786e\u8ba4\u3002</p> <p>\u7d2f\u8ba1\u786e\u8ba4 ACK TCP \u6700\u521d\u7684\u8bbe\u8ba1\u662f\u5bf9\u6536\u5230\u7684\u62a5\u6587\u6bb5\u8fdb\u884c\u7d2f\u8ba1\u786e\u8ba4\u3002\u63a5\u6536\u65b9\u901a\u544a\u5b83\u671f\u671b\u63a5\u6536\u7684\u4e0b\u4e00\u4e2a\u5b57\u8282\u7684\u5e8f\u53f7\uff0c\u5e76\u5ffd\u7565\u6240\u6709\u5931\u5e8f\u8fbe\u5230\u5e76\u88ab\u4fdd\u5b58\u7684\u62a5\u6587\u6bb5\u3002\u5bf9\u4e8e\u4e22\u5f03\u3001\u4e22\u5931\u6216\u91cd\u590d\u7684\u62a5\u6587\u6bb5\u90fd\u4e0d\u63d0\u4f9b\u4efb\u4f55\u53cd\u9988\u3002\u5728 TCP \u9996\u90e8\u4e2d\u7684 32 \u4f4d ACK \u5b57\u6bb5\u7528\u4e8e\u7d2f\u79ef\u786e\u8ba4\uff0c\u800c\u5b83\u7684\u503c\u4ec5\u5728 ACK \u6807\u5fd7\u4e3a 1 \u65f6\u624d\u6709\u6548\u3002</p> <p>\u9009\u62e9\u786e\u8ba4 SACK SACK \u5e76\u6ca1\u6709\u53d6\u4ee3 ACK\uff0c\u800c\u662f\u5411\u53d1\u9001\u65b9\u62a5\u544a\u4e86\u66f4\u591a\u7684\u4fe1\u606f\u3002SACK \u8981\u62a5\u544a\u5931\u5e8f\u7684\u6570\u636e\u5757\u4ee5\u53ca\u91cd\u590d\u7684\u62a5\u6587\u6bb5\uff08\u5373\u4f7f\u6536\u5230\u4e0d\u6b62\u4e00\u6b21\uff09\u3002\u4f46\u662f\uff0cTCP \u9996\u90e8\u5e76\u672a\u63d0\u4f9b\u589e\u52a0\u8fd9\u7c7b\u4fe1\u606f\u7684\u5730\u65b9\uff0c\u56e0\u6b64 SACK \u662f\u4f5c\u4e3a TCP \u9996\u90e8\u672b\u5c3e\u7684\u9009\u9879\u6765\u5b9e\u73b0\u7684\u3002</p> <p>\u4ec0\u4e48\u65f6\u5019\u4ea7\u751f\u786e\u8ba4\uff1f\u4e0d\u540c\u7684\u5b9e\u73b0\u53ef\u80fd\u6709\u4e0d\u540c\u7684\u89c4\u5219\uff0c\u4e0b\u9762\u662f\u51e0\u4e2a\u5e38\u7528\u7684\u89c4\u5219\u3002 1. \u5f53 A \u7aef\u5411 B \u7aef\u53d1\u9001\u6570\u636e\u62a5\u6587\u6bb5\u65f6\uff0c\u5fc5\u987b\u634e\u5e26\u4e00\u4e2a\u786e\u8ba4\uff0c\u5b83\u7ed9\u51fa\u4e86 A \u7aef\u671f\u671b\u63a5\u6536\u7684\u4e0b\u4e00\u4e2a\u5b57\u8282\u7684\u5e8f\u53f7\u3002\u8fd9\u6761\u89c4\u5219\u51cf\u5c11\u4e86\u6240\u9700\u7684\u62a5\u6587\u6bb5\u7684\u6570\u91cf\uff0c\u56e0\u800c\u51cf\u5c11\u4e86\u901a\u4fe1\u91cf\u3002</p> <ol> <li> <p>\u5f53\u63a5\u6536\u65b9\u6ca1\u6709\u6570\u636e\u8981\u53d1\u9001\uff0c\u4f46\u662f\u6536\u5230\u4e86\u6309\u5e8f\u8fbe\u5230\uff08\u5e8f\u53f7\u662f\u671f\u671b\u7684\uff09\u7684\u62a5\u6587\u6bb5\uff0c\u540c\u65f6\u524d\u4e00\u4e2a\u62a5\u6587\u6bb5\u4e5f\u5df2\u7ecf\u786e\u8ba4\u8fc7\u4e86\uff0c\u90a3\u4e48\u63a5\u6536\u65b9\u5c31\u5ef6\u8fdf\u53d1\u9001\u786e\u8ba4\u62a5\u6587\u6bb5\uff0c\u76f4\u5230\u53e6\u4e00\u4e2a\u62a5\u6587\u6bb5\u8fbe\u5230\uff0c\u6216\u7ecf\u8fc7\u4e86\u4e00\u6bb5\u65f6\u95f4\uff08\u901a\u5e38\u662f 500ms\uff09\u3002\u6362\u8a00\u4e4b\uff0c\u5982\u679c\u4ec5\u4ec5\u7531\u4e00\u4e2a\u6309\u5e8f\u5230\u8fbe\u7684\u62a5\u6587\u6bb5\u6ca1\u6709\u88ab\u786e\u8ba4\uff0c\u63a5\u6536\u65b9\u5c31\u8981\u5ef6\u8fdf\u53d1\u9001\u786e\u8ba4\u62a5\u6587\u6bb5\u3002\u8fd9\u6761\u89c4\u5219\u4e5f\u51cf\u5c11\u4e86 ACK \u62a5\u6587\u6bb5\u7684\u901a\u4fe1\u91cf\u3002</p> </li> <li> <p>\u5f53\u6240\u671f\u671b\u7684\u5e8f\u53f7\u7684\u62a5\u6587\u6bb5\u5230\u8fbe\uff0c\u800c\u4e14\u524d\u4e00\u4e2a\u6309\u5e8f\u5230\u8fbe\u7684\u62a5\u6587\u6bb5\u8fd8\u6ca1\u6709\u88ab\u786e\u8ba4\uff0c\u90a3\u4e48\u63a5\u6536\u65b9\u5c31\u8981\u7acb\u5373\u53d1\u9001 ACK \u62a5\u6587\u6bb5\u3002\u6362\u8a00\u4e4b\uff0c\u5728\u4efb\u4f55\u65f6\u5019\uff0c\u4e0d\u80fd\u6709\u4e24\u4e2a\u4ee5\u4e0a\u6309\u5e8f\u5230\u8fbe\u7684\u62a5\u6587\u6bb5\u672a\u88ab\u786e\u8ba4\u3002\u8fd9\u5c31\u907f\u514d\u4e86\u4e0d\u5fc5\u8981\u7684\u91cd\u4f20\u3002</p> </li> <li> <p>\u5f53\u5e8f\u53f7\u6bd4\u671f\u671b\u7684\u5e8f\u53f7\u8fd8\u5927\u7684\u62a5\u6587\u6bb5\u8fbe\u5230\u65f6\uff0c\u63a5\u6536\u65b9\u7acb\u523b\u53d1\u9001 ACK \u62a5\u6587\u6bb5\uff0c\u5e76\u5ba3\u5e03\u4e0b\u4e00\u4e2a\u671f\u671b\u7684\u62a5\u6587\u6bb5\u5e8f\u53f7\u3002\u8fd9\u4f1a\u5bfc\u81f4\u5bf9\u4e22\u5931\u62a5\u6587\u6bb5\u7684\u5feb\u91cd\u4f20\u3002</p> </li> <li> <p>\u5f53\u4e00\u4e2a\u4e22\u5931\u7684\u62a5\u6587\u6bb5\u5230\u8fbe\u65f6\uff0c\u63a5\u6536\u65b9\u8981\u53d1\u9001 ACK \u62a5\u6587\u6bb5\uff0c\u5e76\u5ba3\u5e03\u4e0b\u4e00\u4e2a\u671f\u671b\u7684\u5e8f\u53f7\u3002\u8fd9\u662f\u544a\u8bc9\u63a5\u6536\u65b9\uff0c\u88ab\u901a\u62a5\u4e3a\u4e22\u5931\u7684\u62a5\u6587\u6bb5\u5df2\u7ecf\u6536\u5230\u4e86\u3002</p> </li> <li> <p>\u5982\u679c\u5230\u8fbe\u4e00\u4e2a\u91cd\u590d\u7684\u62a5\u6587\u6bb5\uff08\u6709\u53ef\u80fd\u662f\u63a5\u6536\u65b9\u7684 ACK \u4e22\u5931\u4e86\uff0c\u5bfc\u81f4\u53d1\u9001\u65b9\u8d85\u65f6\u91cd\u4f20\uff09\uff0c\u63a5\u53d7\u65b9\u5c31\u4e22\u5f03\u8be5\u62a5\u6587\u6bb5\uff0c\u4f46\u662f\u5e94\u5f53\u7acb\u5373\u53d1\u9001\u786e\u8ba4\uff0c\u6307\u51fa\u4e0b\u4e00\u4e2a\u671f\u671b\u7684\u62a5\u6587\u6bb5\u3002\u8fd9\u5c31\u89e3\u51b3\u4e86 ACK \u62a5\u6587\u6bb5\u672c\u8eab\u4e22\u5931\u6240\u5e26\u6765\u7684\u4e00\u4e9b\u95ee\u9898\u3002</p> </li> </ol>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_25","title":"\u91cd\u4f20","text":"<p>\u5dee\u9519\u63a7\u5236\u673a\u5236\u7684\u6838\u5fc3\u5c31\u662f\u62a5\u6587\u6bb5\u7684\u91cd\u4f20\u3002\u5728\u4e00\u4e2a\u62a5\u6587\u6bb5\u53d1\u9001\u65f6\uff0c\u5b83\u4f1a\u88ab\u4fdd\u5b58\u5230\u4e00\u4e2a\u961f\u5217\u4e2d\uff0c\u76f4\u5230\u88ab\u786e\u8ba4\u4e3a\u6b62\u3002\u5f53\u91cd\u4f20\u8ba1\u65f6\u5668\u8d85\u65f6\uff0c\u6216\u8005\u53d1\u9001\u65b9\u6536\u5230\u8be5\u961f\u5217\u4e2d\u7b2c\u4e00\u4e2a\u62a5\u6587\u6bb5\u7684\u4e09\u4e2a\u91cd\u590d\u7684 ACK \u65f6\uff0c\u8be5\u62a5\u6587\u6bb5\u88ab\u91cd\u4f20\u3002</p> <p>RTO \u4e4b\u540e\u7684\u91cd\u4f20 \u53d1\u9001\u65b9 TCP \u4e3a\u6bcf\u4e00\u6761\u8fde\u63a5\u8bbe\u7f6e\u4e00\u4e2a\u91cd\u4f20\u8d85\u65f6\uff08retransmission time-out\uff0cRTO\uff09\u8ba1\u65f6\u5668\u3002\u5f53\u8ba1\u65f6\u5668\u65f6\u95f4\u8d85\u65f6\uff0cTCP \u53d1\u9001\u961f\u5217\u4e2d\u6700\u524d\u9762\u7684\u62a5\u6587\u6bb5\uff0c\u5373\u5e8f\u53f7\u6700\u5c0f\u7684\u62a5\u6587\u6bb5\uff0c\u5e76\u91cd\u542f\u8ba1\u65f6\u5668\u3002\u5728 TCP \u4e2d RTO \u7684\u503c\u662f\u52a8\u6001\u7684\uff0c\u5b83\u6839\u636e\u62a5\u6587\u6bb5\u7684\u5f80\u8fd4\u65f6\u95f4\u66f4\u65b0\u3002</p> <p>\u8d85\u65f6\u91cd\u4f20\u8ba1\u65f6\u5668</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8ba1\u65f6\u5668\u4f5c\u7528\u7684\u5730\u65b9\u662f\u62a5\u6587\u6bb5\u7684\u7f13\u5b58\u961f\u5217\uff0c\u800c\u4e0d\u662f\u6ed1\u52a8\u7a97\u53e3\u3002</p> <p>\u4e09\u4e2a\u91cd\u590d\u7684 ACK \u62a5\u6587\u6bb5\u4e4b\u540e\u7684\u91cd\u4f20 \u5982\u679c RTO \u503c\u4e0d\u662f\u5f88\u5927\uff0c\u524d\u9762\u63cf\u8ff0\u7684\u91cd\u4f20\u62a5\u6587\u6bb5\u7684\u89c4\u5219\u5c31\u8db3\u591f\u4e86\u3002\u4f46\u662f\u5982\u679c\u5141\u8bb8\u53d1\u9001\u65b9\u66f4\u5feb\u7684\u91cd\u4f20\uff0c\u800c\u4e0d\u7528\u7b49\u5f85\u8ba1\u65f6\u5668\u8d85\u65f6\uff0c\u5c31\u80fd\u66f4\u6709\u5229\u4e8e\u7f51\u7edc\u541e\u5410\u91cf\uff0c\u56e0\u6b64\u73b0\u5728\u7684\u5927\u591a\u6570\u5b9e\u73b0\u90fd\u9075\u5b88\u6536\u5230\u4e09\u4e2a\u91cd\u590d ACK \u5219\u7acb\u5373\u91cd\u4f20\u4e22\u5931\u7684\u62a5\u6587\u6bb5\u89c4\u5219\u3002\u8fd9\u4e00\u7279\u6027\u88ab\u79f0\u4e3a\u5feb\u91cd\u4f20\uff08fast retransmission\uff09\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_26","title":"\u5931\u5e8f\u7684\u62a5\u6587\u6bb5","text":"<p>TCP \u5b9e\u73b0\u57fa\u672c\u4e0a\u4e0d\u4f1a\u4e22\u5931\u5931\u5e8f\u5230\u8fbe\u7684\u62a5\u6587\u6bb5\uff0c\u800c\u662f\u628a\u8fd9\u4e9b\u62a5\u6587\u6bb5\u6682\u65f6\u4fdd\u5b58\u4e0b\u6765\uff0c\u5e76\u628a\u5b83\u4eec\u6807\u5fd7\u4f4d\u5931\u5e8f\u62a5\u6587\u6bb5\uff0c\u76f4\u81f3\u7f3a\u5931\u7684\u62a5\u6587\u6bb5\u5230\u9f50\u3002\u6ce8\u610f\uff0cTCP \u4e0d\u4f1a\u628a\u5931\u5e8f\u7684\u62a5\u6587\u6bb5\u4ea4\u4ed8\u7ed9\u8fdb\u7a0b\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#tcp-fsm","title":"TCP \u6570\u636e\u4f20\u9001\u7684 FSM","text":"<p>\u6536\u5230\u6765\u81ea\u5e94\u7528\u7684\u5b57\u8282\u5757 \u4ea7\u751f\u4e00\u4e2a\u62a5\u6587\u6bb5\uff0c\u5e76\u5b58\u62a5\u6587\u6bb5\u7684\u526f\u672c\uff0c\u5e76\u53d1\u9001\u8be5\u62a5\u6587\u6bb5\u3002\u5982\u679c\u8fd9\u4e2a\u62a5\u6587\u6bb5\u662f\u53d1\u9001\u7f13\u5b58\u961f\u5217\u4e2d\u7684\u7b2c\u4e00\u4e2a\u62a5\u6587\u6bb5\uff0c\u542f\u52a8\u8ba1\u65f6\u5668\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_27","title":"\u51e0\u79cd\u60c5\u51b5","text":"<p>\u6b63\u5e38\u8fd0\u884c</p> <p>\u62a5\u6587\u6bb5\u4e22\u5931</p> <p>\u5feb\u91cd\u4f20</p> <p>\u5ef6\u8fdf\u7684\u62a5\u6587\u6bb5</p> <p>\u91cd\u590d\u7684\u62a5\u6587\u6bb5</p> <p>\u81ea\u52a8\u7ea0\u6b63\u4e22\u5931\u7684 ACK</p> <p>\u4e22\u5931\u7684\u786e\u8ba4\u88ab\u91cd\u4f20\u7684\u62a5\u6587\u6bb5\u7ea0\u6b63</p> <p>\u56e0\u786e\u8ba4\u4e22\u5931\u800c\u4ea7\u751f\u7684\u6b7b\u9501 \u5f53\u63a5\u6536\u65b9\u53d1\u9001\u4e86\u786e\u8ba4\uff0c\u540c\u65f6\u628a rwnd \u7f6e\u4e3a 0\uff0c\u4e5f\u5c31\u662f\u8bf7\u6c42\u53d1\u9001\u65b9\u6682\u65f6\u5173\u95ed\u5176\u7a97\u53e3\uff0c\u5c31\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u4e86\u3002\u8fc7\u4e86\u4e00\u6bb5\u65f6\u95f4\u4e4b\u540e\uff0c\u63a5\u6536\u65b9\u6253\u7b97\u53d6\u6d88\u8fd9\u4e00\u9650\u5236\uff0c\u4f46\u662f\u5982\u679c\u5b83\u6ca1\u6709\u6570\u636e\u8981\u53d1\u9001\uff0c\u5c31\u4f1a\u53d1\u9001 ACK \u62a5\u6587\u6bb5\uff0c\u5e76\u4e14\u7528 rwnd \u7b49\u4e8e\u4e00\u4e2a\u975e\u96f6\u7684\u6570\u503c\u6765\u53d6\u6d88\u8fd9\u4e2a\u9650\u5236\u3002</p> <p>\u5982\u679c\u8fd9\u4e2a\u786e\u8ba4\u4e22\u5931\u4e86\uff0c\u90a3\u4e48\u5c31\u4f1a\u4ea7\u751f\u95ee\u9898\u3002\u53d1\u9001\u65b9\u4e00\u76f4\u5728\u7b49\u5f85\u786e\u8ba4\u6765\u5ba3\u5e03\u975e\u96f6\u7684 rwnd\u3002\u800c\u63a5\u6536\u65b9\u5219\u8ba4\u4e3a\u53d1\u9001\u65b9\u5df2\u7ecf\u6536\u5230\u4e86\u8fd9\u4e2a\u786e\u8ba4\uff0c\u56e0\u800c\u5728\u7b49\u5f85\u6570\u636e\u3002\u8fd9\u79cd\u60c5\u51b5\u53eb\u505a\u6b7b\u9501\uff0c\u4e5f\u5c31\u662f\u53cc\u65b9\u90fd\u5728\u7b49\u5f85\u5bf9\u65b9\u7684\u54cd\u5e94\uff0c\u800c\u4ec0\u4e48\u4e5f\u4e0d\u4f1a\u53d1\u751f\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\uff0cTCP \u4f7f\u7528\u4e00\u4e2a\u6301\u7eed\u8ba1\u65f6\u5668\uff08persistence timer\uff09\u3002\u5f53\u53d1\u9001 TCP \u63a5\u6536\u5230\u7a97\u53e3\u503c\u4e3a\u96f6\u7684\u786e\u8ba4\u65f6\uff0c\u5c31\u542f\u52a8\u4e00\u4e2a\u6301\u7eed\u8ba1\u65f6\u5668\u3002\u5f53\u6301\u7eed\u8ba1\u65f6\u5668\u8d85\u65f6\u540e\uff0c\u53d1\u9001 TCP \u5c31\u53d1\u9001\u4e00\u4e2a\u7279\u6b8a\u7684\u62a5\u6587\u6bb5\uff0c\u79f0\u4e3a\u63a2\u6d4b\u62a5\u6587\u6bb5\u3002\u8fd9\u4e2a\u62a5\u6587\u6bb5\u53ea\u6709 1 \u4e2a\u5b57\u8282\u7684\u65b0\u6570\u636e\u3002\u5b83\u6709\u5e8f\u53f7\uff0c\u4f46\u5b83\u7684\u5e8f\u53f7\u6c38\u8fdc\u4e0d\u9700\u8981\u786e\u8ba4\uff0c\u751a\u81f3\u5728\u8ba1\u7b97\u5269\u4f59\u6570\u636e\u7684\u5e8f\u53f7\u65f6\uff0c\u8fd9\u4e2a\u5e8f\u53f7\u4e5f\u88ab\u5ffd\u7565\u3002\u63a2\u6d4b\u62a5\u6587\u6bb5\u4fc3\u4f7f\u63a5\u6536 TCP \u91cd\u4f20\u4e00\u4e2a\u786e\u8ba4\u3002</p> <p>\u6301\u7eed\u8ba1\u65f6\u5668\u7684\u65f6\u95f4\u957f\u5ea6\u88ab\u8bbe\u7f6e\u4e3a\u91cd\u4f20\u65f6\u95f4\u7684\u503c\u3002\u4f46\u662f\uff0c\u82e5\u6ca1\u6709\u63a5\u6536\u5230\u4ece\u63a5\u6536\u65b9\u53d1\u6765\u7684\u54cd\u5e94\uff0c\u5219\u9700\u8981\u53d1\u9001\u53e6\u4e00\u4e2a\u63a2\u6d4b\u62a5\u6587\u6bb5\uff0c\u5e76\u5c06\u5176\u6301\u7eed\u8ba1\u65f6\u5668\u7684\u503c\u52a0\u500d\uff0c\u4e14\u8ba1\u65f6\u5668\u590d\u4f4d\u3002\u53d1\u9001\u65b9\u7ee7\u7eed\u53d1\u9001\u63a2\u6d4b\u62a5\u6587\uff0c\u4e0d\u65ad\u5730\u5c06\u6301\u7eed\u8ba1\u65f6\u5668\u7684\u503c\u52a0\u500d\u548c\u590d\u4f4d\uff0c\u76f4\u5230\u8fd9\u4e2a\u503c\u8fbe\u5230\u4e00\u4e2a\u95e8\u9650\u4e3a\u6b62\u3002\u5728\u8fd9\u4ee5\u540e\uff0c\u53d1\u9001\u65b9\u6bcf\u4e2a 60 \u79d2\u5c31\u53d1\u9001\u4e00\u4e2a\u63a2\u6d4b\u62a5\u6587\uff0c\u76f4\u5230\u7a97\u53e3\u91cd\u65b0\u6253\u5f00\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_28","title":"\u62e5\u585e\u63a7\u5236","text":"","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#_29","title":"\u62e5\u585e\u7a97\u53e3","text":"<p>\u524d\u9762\u8ba8\u8bba\u6d41\u91cf\u63a7\u5236\uff0c\u6307\u51fa\u53d1\u9001\u7a97\u53e3\u7684\u5927\u5c0f\u662f\u7531\u63a5\u6536\u65b9\u7684\u53ef\u7528\u7f13\u5b58\u7a7a\u95f4\uff08rwnd\uff09\u6765\u51b3\u5b9a\u7684\u3002\u6362\u8a00\u4e4b\uff0c\u5047\u5b9a\u4e86\u53ea\u6709\u63a5\u6536\u65b9\u80fd\u591f\u6307\u793a\u53d1\u9001\u65b9\u5e94\u5f53\u4f7f\u7528\u591a\u5927\u7684\u53d1\u9001\u7a97\u53e3\u3002\u6b64\u65f6\uff0c\u662f\u5b8c\u5168\u5ffd\u7565\u4e86\u53e6\u4e00\u4e2a\u5b9e\u4f53\uff0c\u5373\u7f51\u7edc\u3002\u5982\u679c\u7f51\u7edc\u4e0d\u80fd\u50cf\u53d1\u9001\u65b9\u4ea7\u751f\u6570\u636e\u90a3\u6837\u5feb\u5730\u628a\u6570\u636e\u4ea4\u4ed8\u7ed9\u63a5\u6536\u65b9\uff0c\u90a3\u4e48\u5b83\u5c31\u5fc5\u987b\u901a\u77e5\u53d1\u9001\u65b9\u653e\u6162\u901f\u5ea6\u3002\u5373\uff0c\u9664\u4e86\u63a5\u6536\u65b9\u4e4b\u5916\uff0c\u7f51\u7edc\u662f\u51b3\u5b9a\u53d1\u9001\u65b9\u7a97\u53e3\u7684\u7b2c\u4e8c\u4e2a\u5b9e\u4f53\u3002</p> <p>\u53d1\u9001\u65b9\u6709\u4e24\u79cd\u4fe1\u606f\uff1a\u63a5\u6536\u65b9\u901a\u544a\u7684\u7a97\u53e3\u5927\u5c0f\u548c\u62e5\u585e\u7a97\u53e3\u5927\u5c0f\u3002\u7a97\u53e3\u7684\u771f\u6b63\u5927\u5c0f\u53d6\u4e24\u8005\u4e4b\u4e2d\u8f83\u5c0f\u7684\u4e00\u4e2a\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#tcpdump","title":"tcpdump","text":"<p>\u7f51\u5361\u9009\u9879 \u76f4\u63a5\u6293\u53d6\u4e3b\u673a\u4e0a\u7684\u6240\u6709\u5305\uff0c-i \u9009\u9879\u6307\u5b9a\u7f51\u5361\uff0cany \u8868\u793a\u4efb\u610f\u7f51\u5361\u3002 <pre><code>tcpdump -i any\n</code></pre></p> <p>IP \u9009\u9879 \u6293\u53d6 IP \u5730\u5740\u4e3a 192.168.31.99 \u7684\u5305\uff0c<code>host</code> \u53ef\u4ee5\u662f\u6e90\u5730\u5740\u6216\u8005\u76ee\u7684\u5730\u5740\u3002\u53ea\u6293\u53d6\u6e90\u5730\u5740\u4f7f\u7528 <code>src</code>\uff0c\u53ea\u6293\u53d6\u76ee\u7684\u5730\u5740\u4f7f\u7528 <code>dst</code>\u3002 <pre><code>tcpdump -i any host 192.168.31.99\n</code></pre></p> <p>PORT \u9009\u9879 \u6293\u53d6\u7aef\u53e3\u4e3a 80 \u7684\u6570\u636e\u5305\uff0cport \u6307\u5b9a\u7aef\u53e3\u53f7\u3002\u53ea\u6293\u53d6\u6e90\u7aef\u53e3\u53f7\uff08\u672c\u673a\u53d1\u51fa\uff09\u5728 <code>port</code> \u524d\u52a0 <code>src</code>\uff0c\u53ea\u6293\u53d6\u76ee\u7684\u7aef\u53e3\u53f7\uff08\u6536\u5230\uff09\u5728 <code>port</code> \u524d\u52a0 <code>dst</code>\u3002 <pre><code>tcpdump -i any [src|dst] port 80\n</code></pre></p> <p>\u4e5f\u53ef\u4f7f\u7528 portrange \u9009\u9879\u6293\u53d6\u6307\u5b9a\u7aef\u53e3\u8303\u56f4\u7684\u6d41\u91cf\u3002 <pre><code>tcpdump portrange 80-88\n</code></pre></p> <p>-n \u9009\u9879\uff0c\u76f4\u63a5\u8f93\u51fa IP \u5730\u5740\u548c\u7aef\u53e3\u53f7\uff0c\u9ed8\u8ba4\u4f1a\u6253\u5370\u4e3b\u673a\u540d\u548c\u7aef\u53e3\u7684\u534f\u8bae\u540d\u79f0\u3002</p> <p>-c \u9009\u9879\uff0c\u6307\u5b9a\u6293\u5305\u7684\u6570\u91cf\u3002</p> <p>-w \u9009\u9879\uff0c\u5c06\u6293\u5305\u6587\u4ef6\u8f93\u51fa\u5230\u6587\u4ef6\uff0c\u751f\u6210\u7684 pcap \u6587\u4ef6\u53ef\u4ee5\u4f7f\u7528 wireshark \u8fdb\u884c\u8be6\u7ec6\u5206\u6790\u3002</p> <p>\u6293\u5305 22222 \u7aef\u53e3\uff0c10 \u4e2a\u5305\uff0c\u5199\u5165\u5230 test.pcap \u6587\u4ef6\uff0c\u663e\u793a\u7edd\u5bf9\u5e8f\u53f7\u3002 <pre><code>tcpdump -i any port 22222 -c 10 -w test.pcap -U\n</code></pre></p> <p>\u9ad8\u7ea7\u6280\u5de7 \u53ef\u4ee5\u4f7f\u7528 and\u3001or \u548c not \u6765\u7ec4\u6210\u8868\u8fbe\u5f0f\u8fc7\u6ee4\u6761\u4ef6\u3002</p> <p>\u6293\u53d6 IP \u4e3a 192.168.31.99 \u4e14\u76ee\u7684\u7aef\u53e3\u4e3a 3306 \u7684\u5305\u3002 <pre><code>tcpdump -i any host 192.168.31.99 and dst port 3306\n</code></pre></p> <p>\u6293\u53d6 IP \u4e3a 192.168.31.99 \u4e14\u76ee\u7684\u7aef\u53e3\u4e0d\u4e3a 22222 \u7684\u5305\u3002 <pre><code>tcpdump -i any host 192.168.31.99 and not dst port 22222\n</code></pre></p> <p>\u4e5f\u652f\u6301\u4f7f\u7528\u62ec\u53f7 <code>()</code> \u5c06\u590d\u6742\u7684\u8868\u8fbe\u5f0f\u7ec4\u5408\u8d77\u6765\uff0c\u4f46\u662f shell \u91cc\u9762\u62ec\u53f7\u662f\u7279\u6b8a\u5b57\u7b26\uff0c\u6240\u4ee5\u9700\u8981\u4f7f\u7528\u5355\u5f15\u53f7\u5305\u542b\u8868\u8fbe\u5f0f\u3002 <pre><code>tcpdump -i any 'src 192.168.31.99 and (dst port 3306 or dst port 6379)'\n</code></pre></p> <p>\u6293\u53d6\u6240\u6709 RST \u7684\u5305\uff0ctcp \u5934\u90e8\u7b2c 14 \u4e2a\u5b57\u8282\uff0c\u53d6\u503c\u8fdb\u884c\u8fd0\u7b97\u3002 <pre><code>tcpdump 'tcp[13] &amp; 4 != 0'\n</code></pre></p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#qa","title":"QA","text":"","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9ATCP/#java-echo","title":"Java \u5b9e\u73b0 Echo \u534f\u8bae\u4ee3\u7801","text":"<pre><code>package com.haizhi.hivetest;  \n\nimport java.io.*;  \nimport java.net.ServerSocket;  \nimport java.net.Socket;  \nimport java.nio.charset.StandardCharsets;  \nimport java.util.Scanner;  \n\npublic class EchoServer {  \n\n    private static final int PORT = 2333;  \n\n    public static void main(String[] args) {  \n\n        try (ServerSocket serverSocket = new ServerSocket(PORT)) {  \n\n            while (true) {  \n                Socket accept = serverSocket.accept();  \n                new Thread(() -&gt; {  \n                    try (InputStream inputStream = accept.getInputStream();  \n                         OutputStream outputStream = accept.getOutputStream();  \n                         Scanner in = new Scanner(inputStream, \"UTF-8\");  \n                         PrintWriter out = new PrintWriter(new OutputStreamWriter(outputStream, StandardCharsets.UTF_8), true)) {  \n\n                        out.println(\"Hello! Enter BYE to exit.\");  \n\n                        boolean done = false;  \n                        while (!done &amp;&amp; in.hasNextLine()) {  \n                            String line = in.nextLine();  \n                            out.println(\"Echo: \" + line);  \n                            if (line.trim().equalsIgnoreCase(\"bye\")) {  \n                                done = true;  \n                            }  \n                        }  \n                    } catch (IOException e) {  \n                        e.printStackTrace();  \n                    }  \n                }).start();  \n            }  \n        } catch (Exception e) {  \n            e.printStackTrace();  \n        }  \n    }  \n}\n</code></pre> <p>\u4f7f\u7528 telnet \u7a0b\u5e8f\u6d4b\u8bd5\u3002\u5148\u8fdb\u6027\u4e09\u6b21\u63e1\u624b\uff0ctelnet \u4f1a\u6bcf\u6572\u4e00\u4e2a\u5b57\u7b26\u5c31\u53d1\u9001\u4e00\u4e2a\u5b57\u7b26 TCP \u5305\uff0c <pre><code>telnet localhost 2333\nHello! Enter BYE to exit.\na\nEcho: a\nhello echo server!\nEcho: hello echo server!\nbye\nEcho: bye\n</code></pre></p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9AUDP/","title":"\u8fd0\u8f93\u5c42\uff1aUDP","text":"","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9AUDP/#_1","title":"\u7b80\u4ecb","text":"<p>\u7528\u6237\u6570\u636e\u62a5\u534f\u8bae\uff0cUser Datagram Protocol\uff0c\u63d0\u4f9b\u8fdb\u7a0b\u5230\u8fdb\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\u3002</p> <p>UDP \u6ca1\u6709\u6d41\u91cf\u63a7\u5236\uff0c\u5728\u5206\u7ec4\u6536\u5230\u65f6\u4e5f\u6ca1\u6709\u786e\u8ba4\u3002UDP \u4e5f\u6ca1\u6709\u5dee\u9519\u63a7\u5236\uff0c\u5982\u679c UDP \u68c0\u6d4b\u5230\u5206\u7ec4\u4e2d\u6709\u5dee\u9519\uff0c\u5b83\u5c31\u4e22\u6389\u8fd9\u4e2a\u5206\u7ec4\u3002</p> <p>UDP \u662f\u4e00\u79cd\u65e0\u8fde\u63a5\u3001\u4e0d\u53ef\u9760\u7684\u8fd0\u8f93\u534f\u8bae\u3002\u5b83\u9664\u4e86\u5728 IP \u670d\u52a1\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u8fdb\u7a0b\u5230\u8fdb\u7a0b\u7684\u901a\u4fe1\uff0c\u4f7f\u4e4b\u4e0d\u518d\u662f\u4e3b\u673a\u5230\u4e3b\u673a\u7684\u901a\u4fe1\u4e4b\u5916\uff0c\u5c31\u518d\u6ca1\u6709\u4ec0\u4e48\u4e86\u3002</p> <p>UDP \u529f\u80fd\u5f88\u5f31\uff0c\u4f46\u662f\u4e3a\u4ec0\u4e48\u8fd8\u6709\u8fdb\u7a0b\u4f7f\u7528\u5462\uff1f\u56e0\u4e3a\u7b80\u5355\uff0c\u90a3\u4e48\u4e5f\u5c31\u610f\u5473\u8fd9\u5f00\u9500\u5c0f\uff0c\u56e0\u6b64\u9002\u5408\u4e00\u4e9b\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u9ad8\u3001\u5bb9\u5fcd\u5c11\u91cf\u6570\u636e\u4e22\u5931\u7684\u5e94\u7528\u573a\u666f\uff0c\u6bd4\u5982\u97f3\u89c6\u9891\u6d41\u4f20\u8f93\u3001\u5728\u7ebf\u6e38\u620f\u7b49\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9AUDP/#_2","title":"\u534f\u8bae\u683c\u5f0f\u4ecb\u7ecd","text":"<p>UDP \u6570\u636e\u62a5\u7684\u683c\u5f0f\u5982\u4e0b\uff1a</p> <p></p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9AUDP/#_3","title":"\u6e90\u7aef\u53e3\u53f7","text":"<p>\u6e90\u4e3b\u673a\u4e0a\u8fdb\u7a0b\u6240\u4f7f\u7528\u7684\u7aef\u53e3\u53f7\u300216 \u4f4d\u957f\uff0c\u53d6\u503c\u8303\u56f4\u4e3a 0~65535\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9AUDP/#_4","title":"\u76ee\u7684\u7aef\u53e3\u53f7","text":"<p>\u8fd0\u884c\u5728\u76ee\u7684\u4e3b\u673a\u4e0a\u7684\u8fdb\u7a0b\u6240\u4f7f\u7528\u7684\u7aef\u53e3\u53f7\u300216 \u4f4d\u957f\uff0c\u53d6\u503c\u8303\u56f4\u4e3a 0~65535\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9AUDP/#_5","title":"\u603b\u957f\u5ea6","text":"<p>16 \u4f4d\u7684\u5b57\u6bb5\uff0c\u5b9a\u4e49\u4e86\u7528\u6237\u6570\u636e\u5305\u7684\u603b\u957f\u5ea6\uff0c\u9996\u90e8\u52a0\u4e0a\u6570\u636e\u300216 \u4f4d\u53ef\u4ee5\u5b9a\u4e49\u7684\u603b\u957f\u5ea6\u4e3a 0~65535\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a UDP \u8981\u653e\u5728\u603b\u957f\u5ea6\u4e3a 65535 \u5b57\u8282\u7684 IP \u6570\u636e\u62a5\u4e4b\u4e2d\uff0c\u6240\u4ee5 UDP \u6570\u636e\u62a5\u7684\u6700\u5927\u603b\u957f\u5ea6\u8981\u5c0f\u4e8e 65535 \u5b57\u8282\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9AUDP/#_6","title":"\u6821\u9a8c\u548c","text":"<p>\u8fd9\u4e2a\u5b57\u6bb5\u7528\u6765\u68c0\u9a8c\u6574\u4e2a\u7528\u6237\u6570\u636e\u62a5\uff08\u9996\u90e8\u52a0\u4e0a\u6570\u636e\uff09\u51fa\u73b0\u7684\u5dee\u9519\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9AUDP/#udp","title":"UDP \u4f7f\u7528\u7684\u719f\u77e5\u7aef\u53e3","text":"<pre><code>| 7   | Echo    | \u628a\u63a5\u6536\u5230\u7684\u6570\u636e\u62a5\u56de\u9001\u5230\u53d1\u9001\u65b9 \n| 9   | Discard | \u4e22\u5f03\u6536\u5230\u7684\u4efb\u4f55\u6570\u636e\u62a5     \n| 11  | Users   | \u6d3b\u8dc3\u7684\u7528\u6237          \n| 13  | Daytime | \u8fd4\u56de\u65e5\u671f\u548c\u65f6\u95f4        \n| 17  | Quote   | \u8fd4\u56de\u65e5\u671f\u7684\u5f15\u7528        \n| 19  | Chargen | \u8fd4\u56de\u5b57\u7b26\u4e32          \n| 53  | Domain  | DNS            \n| 67  | Bootps  | \u4e0b\u8f7d\u5f15\u5bfc\u7a0b\u5e8f\u4fe1\u606f\u7684\u670d\u52a1\u5668\u7aef\u53e3 \n| 68  | Bootpc  | \u4e0b\u8f7d\u5f15\u5bfc\u7a0b\u5e8f\u7684\u5ba2\u6237\u7aef\u7aef\u53e3   \n| 69  | TFTP    | \u7b80\u5355\u7684\u6587\u4ef6\u4f20\u9001\u534f\u8bae      \n| 111 | RPC     | \u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528         \n| 123 | NTP     | \u7f51\u7edc\u65f6\u95f4\u534f\u8bae         \n| 161 | SNMP    | \u7b80\u5355\u7684\u7f51\u7edc\u7ba1\u7406\u534f\u8bae      \n| 162 | SNMP    | \u7b80\u5355\u7684\u7f51\u7edc\u7ba1\u7406\u534f\u8bae\uff08\u9677\u9631\uff09  \n</code></pre>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9AUDP/#_7","title":"\u65e0\u8fde\u63a5\u7684\u670d\u52a1","text":"<p>UDP \u63d0\u4f9b\u65e0\u8fde\u63a5\u7684\u670d\u52a1\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u7531 UDP \u53d1\u9001\u7684\u6bcf\u4e00\u4e2a\u7528\u6237\u6570\u636e\u62a5\u90fd\u662f\u72ec\u7acb\u7684\u6570\u636e\u62a5\uff0c\u4e0d\u540c\u7684\u7528\u6237\u6570\u636e\u62a5\u4e4b\u524d\u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\u3002</p> <p>\u65e0\u8fde\u63a5\u5bfc\u81f4\u7684\u53e6\u4e00\u4e2a\u7ed3\u679c\u5c31\u662f\uff1a\u4f7f\u7528 UDP \u7684\u8fdb\u7a0b\u4e0d\u80fd\u53d1\u9001\u6d41\u6570\u636e\u5230 UDP\uff0c\u4e5f\u4e0d\u80fd\u671f\u671b UDP \u628a\u8fd9\u4e2a\u6570\u636e\u6d41\u5206\u5272\u6210\u8bb8\u591a\u4e2a\u4e92\u76f8\u5173\u8054\u7684\u7528\u6237\u6570\u636e\u62a5\u3002\u76f8\u53cd\uff0c\u8fdb\u7a0b\u7684\u6bcf\u4e00\u4e2a\u8bf7\u6c42\u90fd\u5fc5\u987b\u8db3\u591f\u5c0f\uff0c\u4f7f\u5176\u80fd\u591f\u5c01\u88c5\u8fdb\u4e00\u4e2a\u7528\u6237\u6570\u636e\u62a5\u4e2d\u3002\u53ea\u6709\u90a3\u4e9b\u53d1\u9001\u77ed\u7684\u62a5\u6587\u624d\u5e94\u8be5\u4f7f\u7528 UDP\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9AUDP/#_8","title":"\u6d41\u91cf\u63a7\u5236","text":"<p>UDP \u6ca1\u6709\u6d41\u91cf\u63a7\u5236\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9AUDP/#_9","title":"\u5dee\u9519\u63a7\u5236","text":"<p>\u9664\u4e86\u6821\u9a8c\u548c\u4e4b\u5916\uff0cUDP \u6ca1\u6709\u63d0\u4f9b\u5176\u4ed6\u5dee\u9519\u63a7\u5236\u673a\u5236\u3002\u8fd9\u5c31\u8868\u793a\u53d1\u9001\u65b9\u5e76\u4e0d\u77e5\u9053\u62a5\u6587\u662f\u4e22\u5931\u4e86\u8fd8\u662f\u91cd\u590d\u4ea4\u4ed8\u4e86\u3002\u5f53\u63a5\u6536\u65b9\u901a\u8fc7\u6821\u9a8c\u548c\u68c0\u6d4b\u51fa\u5dee\u9519\u65f6\uff0c\u5c31\u76f4\u63a5\u4e22\u6389\u8fd9\u4e2a\u7528\u6237\u6570\u636e\u62a5\uff0c\u7f3a\u5c11\u5dee\u9519\u63a7\u5236\u673a\u5236\u5c31\u610f\u5473\u7740\u5728\u5fc5\u8981\u65f6\u5e94\u5f53\u7531\u4f7f\u7528 UDP \u7684\u8fdb\u7a0b\u6765\u63d0\u4f9b\u8fd9\u79cd\u670d\u52a1\u3002</p> <p>\u6821\u9a8c\u548c\u7684\u8ba1\u7b97\u6821\u9a8c\u7b97\u6cd5\u548c IP \u534f\u8bae\u7c7b\u4f3c\u3002</p> <p>UDP \u6821\u9a8c\u548c\u7684\u8ba1\u7b97\u5305\u62ec\u4e09\u4e2a\u90e8\u5206\uff1a\u4f2a\u9996\u90e8\u3001UDP \u9996\u90e8\u4ee5\u53ca\u5e94\u7528\u5c42\u7684\u6570\u636e\u3002</p> <p>UDP \u5206\u7ec4\u7684\u53d1\u9001\u65b9\u53ef\u4ee5\u9009\u62e9\u4e0d\u8ba1\u7b97\u6821\u9a8c\u548c\u3002\u82e5\u4e0d\u8ba1\u7b97\u6821\u9a8c\u548c\uff0c\u5219\u5728\u53d1\u9001\u4e4b\u524d\u628a\u6821\u9a8c\u548c\u5b57\u6bb5\u5168\u90e8\u586b\u51650\u3002</p>","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9A%E4%BB%8B%E7%BB%8D/","title":"\u8fd0\u8f93\u5c42\uff1a\u4ecb\u7ecd","text":"","tags":["Network"]},{"location":"ThreeMountains/Network/%E8%BF%90%E8%BE%93%E5%B1%82%EF%BC%9A%E4%BB%8B%E7%BB%8D/#_1","title":"\u8fd0\u8f93\u5c42\u670d\u52a1","text":"","tags":["Network"]},{"location":"ThreeMountains/OS/C/","title":"C","text":""},{"location":"ThreeMountains/OS/C/#hello-world","title":"<code>hello world</code>","text":"<p>\u5148\u4ece\u4e00\u4e2a\u5165\u95e8\u7684 <code>hello world!</code> \u5f00\u59cb\uff0c\u4ee3\u7801\uff1a <pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    printf(\"hello world!\\n\");\n}\n</code></pre></p> <p>\u8fd0\u884c <pre><code>gcc p1.c\n./a.out\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#_1","title":"\u534e\u6c0f\u6e29\u5ea6\u548c\u6444\u6c0f\u5ea6\u8f6c\u6362","text":"<p><code>while</code> \u5faa\u73af\u5b9e\u73b0\uff1a <pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    float fahr, celsius;\n    float lower, upper, step;\n\n    lower = 0;\n    upper = 300;\n    step = 20;\n\n    fahr = lower;\n\n    printf(\"%6s\\t%9s\\n\", \"Fahr/\u2109\", \"Celsius/\u2103\");\n    while (fahr &lt;= upper)\n    {\n        celsius = 5 * (fahr - 32) / 9;\n        printf(\"%6.0f\\t%9.1f\\n\", fahr, celsius);\n        fahr += step;\n    }\n\n}\n</code></pre></p> <p><code>for</code> \u5faa\u73af\u5b9e\u73b0\uff1a <pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    float fahr;\n\n    printf(\"%6s\\t%9s\\n\", \"Fahr/\u2109\", \"Celsius/\u2103\");\n    for (fahr = 0; fahr &lt;= 300; fahr += 20)\n    {\n        printf(\"%6.0f\\t%9.1f\\n\", fahr, 5 * (fahr - 32) / 9);\n    }\n\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#_2","title":"\u5b9a\u4e49\u7b26\u53f7\u5e38\u91cf","text":"<p>\u7c7b\u4f3c Java \u4e2d\u7684\u5e38\u91cf\uff0c\u5e94\u8be5\u907f\u514d\u5728\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u9b54\u6570\uff0c\u800c\u662f\u4f7f\u7528\u7b26\u53f7\u5e38\u91cf\u3002</p> <p>\u5b9a\u4e49\u7b26\u53f7\u5e38\u91cf\u7684\u8bed\u6cd5\uff0c\u5728\u8be5\u5b9a\u4e49\u4e4b\u540e\uff0c\u7a0b\u5e8f\u4e2d\u51fa\u73b0\u7684 <code>name</code> \u90fd\u4f1a\u88ab\u66ff\u6362\u4e3a <code>txt</code>\u3002 <pre><code>#define name txt\n</code></pre></p> <p>\u793a\u4f8b\uff1a <pre><code>#include &lt;stdio.h&gt;\n\n#define STEP 20\n#define LOWER 0\n#define UPPER 300\n\nint main() {\n    float fahr;\n\n    printf(\"%6s\\t%9s\\n\", \"Fahr/\u2109\", \"Celsius/\u2103\");\n    for (fahr = LOWER; fahr &lt;= UPPER; fahr += STEP)\n    {\n        printf(\"%6.0f\\t%9.1f\\n\", fahr, 5 * (fahr - 32) / 9);\n    }\n\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#_3","title":"\u5c06\u8f93\u5165\u590d\u5236\u5230\u8f93\u51fa","text":"<p><code>getchar()</code> \u51fd\u6570\u4ece\u6807\u51c6\u8f93\u5165\u4e2d\u8bfb\u53d6\u4e00\u4e2a\u5b57\u7b26\uff0c\u5e76\u5728\u7528\u6237\u6309\u4e0b\u56de\u8f66\u952e\u65f6\u5f00\u59cb\u8bfb\u53d6\u8f93\u5165\u7684\u5b57\u7b26\u3002</p> <p><code>putchar(int c)</code> \u51fd\u6570\u5c06\u4e00\u4e2a\u5b57\u7b26\u6253\u5370\u5230\u6807\u51c6\u8f93\u51fa\u3002</p> <p><code>EOF</code> \u662f\u4e00\u4e2a\u7279\u6b8a\u503c\uff08\u6ce8\u610f\uff0c\u4e0d\u662f\u5b57\u7b26\uff09\uff0c\u6807\u8bc6\u8f93\u5165\u7ed3\u675f\u3002\u8f93\u5165\u6587\u4ef6\u7ed3\u675f\u7b26\u7684\u65b9\u5f0f\u662f\u6309\u4e0bCtrl+D\uff08\u5728Unix/Linux\u7cfb\u7edf\u4e0b\uff09\uff0c\u6216\u8005Ctrl+Z\uff08\u5728Windows\u7cfb\u7edf\u4e0b\uff09</p> <pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    int c;\n    while((c = getchar()) != EOF) {\n        putchar(c);\n    }\n}\n</code></pre>"},{"location":"ThreeMountains/OS/C/#_4","title":"\u5b57\u7b26\u8ba1\u6570","text":"<p><code>while</code> \u5b9e\u73b0\u5b57\u7b26\u8ba1\u6570\uff1a <pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    long nc;\n    while (getchar() != EOF) {\n        nc ++;\n    }\n\n    printf(\"%ld\\n\", nc);\n\n}\n</code></pre></p> <p><code>for</code> \u5b9e\u73b0\u884c\u8ba1\u6570\uff1a <pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    long nl;\n    int c;\n    for (;(c = getchar()) != EOF;) {\n        if(c == '\\n') {\n            nl ++;\n        }\n    }\n    printf(\"%ld\\n\", nl);\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#_5","title":"\u5355\u8bcd\u8ba1\u6570","text":"<p>\u5047\u8bbe\u5355\u8bcd\u7684\u5206\u5272\u7b26\u5305\u62ec\u7a7a\u683c\u3001\u5236\u8868\u7b26\u6216\u6362\u884c\u7b26\u3002\u4ee3\u7801\u793a\u4f8b\uff1a <pre><code>#include &lt;stdio.h&gt;\n\n#define IN 1\n#define OUT 0\n\nint main() {\n    int nw = 0, nl = 0, nc = 0;\n    int c;\n    int state = OUT;\n\n    while((c = getchar()) != EOF) {\n        nc ++;\n\n        if (c == '\\n') {\n            nl ++;\n        }\n\n        if (c == ' ' || c == '\\t' || c == '\\n') {\n            state = OUT;\n        } else if(state == OUT) {\n            state = IN;\n            nw ++;\n        }\n    }\n    printf(\"nc: %d, nw: %d, nl: %d\\n\", nc, nw, nl);\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#_6","title":"\u51fd\u6570","text":""},{"location":"ThreeMountains/OS/C/#main","title":"main \u51fd\u6570","text":"<p>\u5728 C \u8bed\u8a00\u4e2d\uff0c<code>main</code> \u51fd\u6570\u53ef\u4ee5\u63a5\u53d7\u4e24\u4e2a\u53c2\u6570\uff1a<code>argc</code> \u548c <code>argv</code>\u3002</p> <ul> <li> <p><code>argc</code>\uff1a\u8fd9\u662f\u4e00\u4e2a\u6574\u6570\uff0c\u8868\u793a\u547d\u4ee4\u884c\u53c2\u6570\u7684\u6570\u91cf\uff0c\u5305\u62ec\u7a0b\u5e8f\u7684\u540d\u79f0\u3002\u5373\u4f7f\u6ca1\u6709\u63d0\u4f9b\u989d\u5916\u7684\u53c2\u6570\uff0c<code>argc</code> \u7684\u503c\u4e5f\u81f3\u5c11\u4e3a 1\u3002</p> </li> <li> <p><code>argv</code>\uff1a\u8fd9\u662f\u4e00\u4e2a\u6307\u5411\u6307\u9488\u6570\u7ec4\u7684\u6307\u9488\uff0c\u6bcf\u4e2a\u6307\u9488\u6307\u5411\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8868\u793a\u4e00\u4e2a\u547d\u4ee4\u884c\u53c2\u6570\u3002\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u7a0b\u5e8f\u7684\u540d\u79f0\uff0c\u540e\u7eed\u53c2\u6570\u662f\u4f20\u9012\u7ed9\u7a0b\u5e8f\u7684\u53c2\u6570\u3002</p> </li> </ul> <p>\u5176\u4e2d argc \u548c argv \u4e24\u4e2a\u5f62\u53c2\u7684\u53c2\u6570\u7c7b\u578b\u548c\u987a\u5e8f\u662f\u56fa\u5b9a\u7684\uff0c\u5f62\u53c2\u7684\u540d\u79f0\u5219\u53ef\u4ee5\u81ea\u5b9a\u4e49\u3002 <pre><code>#include &lt;stdio.h&gt;\n\nint main(int argc, char *argv[])\n{\n\n    printf(\"argument count: %d\", argc);\n\n    for(int i = 0; i &lt; argc; i ++)\n        printf(\"argument %d: %s\", i, argv[i]);\n}\n</code></pre></p> <p>\u8fd0\u884c\u7ed3\u679c\uff1a <pre><code># ./a.out hello world\nargument count: 3\nargument 0: ./a.out\nargument 1: hello\nargument 2: world\n</code></pre></p> <p>\u5982\u679c <code>main</code> \u51fd\u6570\u6ca1\u6709\u5b9a\u4e49 <code>return</code> \u8bed\u53e5\uff0c\u5219\u7f16\u8bd1\u5668\u4f1a\u9ed8\u8ba4\u6dfb\u52a0 <code>return 0;</code> \u8bed\u53e5\uff0c\u8fd4\u56de 0 \u6807\u8bc6\u6b63\u5e38\u7ec8\u6b62\uff0c\u975e 0 \u6807\u8bc6\u51fa\u73b0\u5f02\u5e38\u60c5\u51b5\u6216\u51fa\u9519\u7ed3\u675f\u6761\u4ef6\u3002</p>"},{"location":"ThreeMountains/OS/C/#_7","title":"\u81ea\u5b9a\u4e49\u51fd\u6570","text":"<p>\u4e4b\u524d\u7684\u4ee3\u7801\u4f7f\u7528\u7684\u51fd\u6570\u5982 <code>printf</code>\u3001<code>getchar</code> \u548c <code>putchar</code> \u90fd\u662f\u5e93\u51fd\u6570\u4e2d\u63d0\u4f9b\u7684\u51fd\u6570\uff0c\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e2a\u6c42\u5e42\u51fd\u6570 <code>power(m, n)</code>\u3002<code>power(m, n)</code> \u51fd\u6570\u7528\u4e8e\u8ba1\u7b97\u6c42\u6574\u6570 m \u7684 n \u6b21\u5e42\uff0c\u5176\u4e2d n \u662f\u6b63\u6574\u6570\u3002</p> <p>\u4ee3\u7801\uff1a <pre><code>#include &lt;stdio.h&gt;\n\nint power(int m, int n);\n\nint main() \n{\n    for(int i = 0; i &lt; 10; ++ i) \n        printf(\"%d %5d %7d\\n\", i, power(2, i), power(-3, i));\n}\nc\nint power(int m, int n) {\n    int i, p;\n\n    p = 1;\n    for (i = 0; i &lt; n; i ++) {\n        p = p * m;\n    }\n\n    return p;\n}\n</code></pre></p> <p>\u5728 main \u51fd\u6570\u4e4b\u524d\u6709 power \u51fd\u6570\u7684\u58f0\u660e\u8bed\u53e5\uff0c\u8868\u660e power \u51fd\u6570\u6709\u4e24\u4e2a int \u7c7b\u578b\u7684\u53c2\u6570\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a int \u7c7b\u578b\u7684\u503c\u3002 <pre><code>int power(int m, int n);\n</code></pre></p> <p>\u8fd9\u79cd\u58f0\u660e\u6210\u4e3a\u51fd\u6570\u539f\u578b\uff0c\u5b83\u5fc5\u987b\u4e0e power \u51fd\u6570\u5b9a\u4e49\u548c\u7528\u6cd5\u4e00\u81f4\u3002\u51fd\u6570\u539f\u578b\u4e2d\u7684\u53c2\u6570\u540d\u662f\u53ef\u9009\u7684\uff0c\u4e5f\u53ef\u4ee5\u5199\u6210\u4e0b\u9762\u7684\u5f62\u5f0f\uff1a <pre><code>int power(int, int);\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#_8","title":"\u4f20\u503c\u8c03\u7528","text":"<p>\u5728 C \u8bed\u8a00\u4e2d\uff0c\u6240\u6709\u7684\u51fd\u6570\u53c2\u6570\u90fd\u662f\u201c\u901a\u8fc7\u503c\u201d\u4f20\u9012\u7684\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u4f20\u9012\u7ed9\u88ab\u8c03\u7528\u51fd\u6570\u7684\u53c2\u6570\u503c\u5b58\u653e\u5728\u4e34\u65f6\u53d8\u91cf\u4e2d\uff0c\u800c\u4e0d\u662f\u5b58\u653e\u5728\u539f\u6765\u7684\u53d8\u91cf\u4e2d\u3002\u56e0\u6b64\u5728 C \u8bed\u8a00\u4e2d\uff0c\u88ab\u8c03\u7528\u51fd\u6570\u4e0d\u80fd\u76f4\u63a5\u4fee\u6539\u4e3b\u8c03\u51fd\u6570\u4e2d\u53d8\u91cf\u7684\u503c\uff0c\u800c\u53ea\u80fd\u4fee\u6539\u5176\u79c1\u6709\u7684\u4e34\u65f6\u526f\u672c\u7684\u503c\u3002</p>"},{"location":"ThreeMountains/OS/C/#_9","title":"\u5b57\u7b26\u6570\u7ec4","text":"<p>\u4e0b\u9762\u7684\u7a0b\u5e8f\u8bfb\u53d6\u4e00\u7ec4\u6587\u7248\uff0c\u5e76\u628a\u6700\u957f\u7684\u6587\u672c\u884c\u6253\u5370\u51fa\u6765\u3002 <pre><code>#include &lt;stdio.h&gt;\n\n#define MAXLINE 100\n\nint get_line(char line[], int maxline);\nvoid copy(char from[], char to[]);\n\nint main() {\n    int len;\n    int max;\n\n    char line[MAXLINE];\n    char longest[MAXLINE];\n\n    max = 0;\n    while((len = get_line(line, MAXLINE)) &gt; 0) {\n        if (len &gt; max) {\n            max = len;\n            copy(line, longest);\n        }\n    }\n\n    if (max &gt; 0) {\n        printf(\"%s\", longest);\n    }\n\n    return 0;\n}\n\nint get_line(char s[], int lim) {\n    int c, i;\n\n    for(i = 0; i &lt; lim - 1 &amp;&amp; (c = getchar()) != '\\n' &amp;&amp; c != EOF; i ++) {\n        s[i] = c;\n    }\n\n    if (c == '\\n') {\n        s[i] = c;\n        i ++;\n    }\n\n    s[i] = '\\0';\n    return i;\n}\n\nvoid copy(char from[], char to[]) {\n    int i;\n\n    for(i = 0; (to[i] = from[i]) != '\\0'; i ++) {\n        ;\n    }\n}\n</code></pre></p> <p><code>get_line</code> \u51fd\u6570\u628a\u5b57\u7b26 <code>\\0</code> \u5373\u7a7a\u5b57\u7b26\u63d2\u5165\u5230\u6570\u7ec4\u7684\u672b\u5c3e\uff0c\u4ee5\u6807\u8bb0\u5b57\u7b26\u4e32\u7684\u7ed3\u675f\u3002\u6240\u4ee5\u5728 C \u8bed\u8a00\u4e2d\uff0c\u58f0\u660e <code>\"hello\"</code> \u5b57\u7b26\u4e32\uff0c\u5728\u5185\u5b58\u4e2d\u4f1a\u88ab\u5b58\u50a8\u4e3a <code>h</code> <code>e</code> <code>l</code> <code>l</code> <code>o</code> <code>\\0</code>\u3002</p> <p><code>printf</code> \u51fd\u6570\u4e2d\u7684\u683c\u5f0f\u89c4\u8303 <code>%s</code> \u89c4\u5b9a\uff0c\u5bf9\u5e94\u7684\u53c2\u6570\u5fc5\u987b\u662f\u4ee5\u8fd9\u79cd\u5f62\u5f0f\u6807\u8bc6\u7684\u5b57\u7b26\u4e32\u3002 <pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n\n    char tmp[] = {'a', 'b', 'c', '\\0', 'd', 'e', 'f'};\n\n    printf(\"%s\\n\", tmp);    // \u6253\u5370 abc\n\n    return 0;\n}\n</code></pre></p> <p>\u53e6\u5916 <code>copy</code> \u51fd\u6570\u7684\u8c03\u7528\uff0c\u4f20\u53c2\u4e5f\u662f\u503c\u4f20\u9012\uff0c\u4f20\u9012\u7684\u662f\u6570\u7ec4\u7684\u8d77\u59cb\u5730\u5740\u3002</p>"},{"location":"ThreeMountains/OS/C/#_10","title":"\u5916\u90e8\u53d8\u91cf\u4e0e\u4f5c\u7528\u57df","text":"<p>\u4e0a\u9762\u7684\u4ee3\u7801\u5728\u51fd\u6570\u5185\u90e8\u58f0\u660e\u7684\u53d8\u91cf\u90fd\u79f0\u4e3a\u201d\u5c40\u90e8\u53d8\u91cf\u201c\uff0c\u5176\u5b83\u51fd\u6570\u4e0d\u80fd\u76f4\u63a5\u8bbf\u95ee\u5b83\u4eec\u3002\u51fd\u6570\u4e2d\u7684\u6bcf\u4e2a\u5c40\u90e8\u53d8\u91cf\u53ea\u5728\u51fd\u6570\u8c03\u7528\u65f6\u5b58\u5728\uff0c\u5728\u51fd\u6570\u6267\u884c\u5b8c\u6bd5\u9000\u51fa\u65f6\u6d88\u5931\u3002</p> <p>\u76f8\u5bf9\u5c40\u90e8\u53d8\u91cf\u7684\u662f\u5916\u90e8\u53d8\u91cf\uff0c\u5916\u90e8\u53d8\u91cf\u662f\u5728\u6240\u6709\u51fd\u6570\u4e2d\u90fd\u53ef\u4ee5\u8bbf\u95ee\u7684\u53d8\u91cf\uff0c\u800c\u4e0d\u5fc5\u901a\u8fc7\u53c2\u6570\u8868\u3002\u5176\u6b21\uff0c\u5916\u90e8\u53d8\u91cf\u5728\u7a0b\u5e8f\u6267\u884c\u671f\u95f4\u4e00\u76f4\u5b58\u5728\u3002</p> <p>\u5916\u90e8\u53d8\u91cf\u5fc5\u987b\u5b9a\u4e49\u5728\u6240\u6709\u51fd\u6570\u4e4b\u5916\uff0c\u5e76\u4e14\u53ea\u80fd\u5b9a\u4e49\u4e00\u6b21\uff0c\u5b9a\u4e49\u540e\u7f16\u8bd1\u7a0b\u5e8f\u5c06\u4e3a\u5b83\u4eec\u5206\u914d\u5b58\u50a8\u5355\u5143\u3002\u5728\u6bcf\u4e2a\u9700\u8981\u8bbf\u95ee\u5916\u90e8\u53d8\u91cf\u7684\u51fd\u6570\u4e2d\uff0c\u5fc5\u987b\u58f0\u660e\u76f8\u5e94\u7684\u5916\u90e8\u53d8\u91cf\uff0c\u4ee5\u4fbf\u5bf9\u5176\u7c7b\u578b\u8fdb\u884c\u8bf4\u660e\u3002\u58f0\u660e\u4f7f\u7528 <code>extern</code> \u5173\u952e\u5b57\u8fdb\u884c\u663e\u793a\u58f0\u660e\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4e0a\u4e0b\u6587\u8fdb\u884c\u9690\u5f0f\u58f0\u660e\u3002 <pre><code>#include &lt;stdio.h&gt;\n\nint global_var; // \u5b9a\u4e49 define\n\nint main() {\n\n    extern int global_var;  // \u58f0\u660e declaration\n\n    global_var = 100;\n\n    printf(\"%d\\n\", global_var);\n}\n</code></pre></p> <p>\u5728\u6e90\u6587\u4ef6\u4e2d\uff0c\u5982\u679c\u5916\u90e8\u53d8\u91cf\u7684\u5b9a\u4e49\u51fa\u73b0\u5728\u4f7f\u7528\u5b83\u7684\u51fd\u6570\u4e4b\u524d\uff0c\u90a3\u4e48\u5728\u4f7f\u7528\u5916\u90e8\u53d8\u91cf\u7684\u51fd\u6570\u4e2d\u5c31\u53ef\u4ee5\u7701\u7565 <code>extern</code> \u58f0\u660e\u3002\u5982\u679c\u7a0b\u5e8f\u5305\u542b\u591a\u4e2a\u6e90\u6587\u4ef6\uff0c\u800c\u67d0\u4e2a\u5916\u90e8\u53d8\u91cf\u5b9a\u4e49\u5728 file1\uff0c\u5728 file2 \u548c file3 \u4e2d\u4f7f\u7528\u5c31\u9700\u8981\u4f7f\u7528 <code>extern</code> \u58f0\u660e\u3002\u5f53\u7136\u4e00\u822c\u4f7f\u7528\u5934\u6587\u4ef6\u8fdb\u884c\u58f0\u660e\uff0c\u5e76\u5728\u6bcf\u4e2a\u6e90\u6587\u4ef6\u7684\u5f00\u5934\u4f7f\u7528 <code>#include</code> \u8bed\u53e5\u628a\u6240\u8981\u4f7f\u7528\u7684\u5934\u6587\u4ef6\u5305\u542b\u8fdb\u6765\u3002 <pre><code>#ifndef GLOBAL_VAR_FLAG\n#define GLOBAL_VAR_FLAG\nextern int global_var\n#endif\n</code></pre></p> <p>define \u548c declaration</p> <p>\u4e00\u822c <code>define</code> \u5b9a\u4e49\uff0c\u8868\u793a\u521b\u5efa\u53d8\u91cf\u6216\u5206\u914d\u5b58\u50a8\u5355\u5143\uff1b\u800c <code>declaration</code> \u58f0\u660e\uff0c\u6307\u7684\u662f\u8bf4\u660e\u53d8\u91cf\u7684\u6027\u8d28\uff0c\u4f46\u4e0d\u5206\u914d\u5b58\u50a8\u5355\u5143\u3002</p> <p>C \u8bed\u8a00\u7a0b\u5e8f\u53ef\u4ee5\u770b\u6210\u7531\u4e00\u4e9b\u5217\u5916\u90e8\u5bf9\u8c61\u6784\u6210\uff0c\u8fd9\u4e9b\u5916\u90e8\u5bf9\u8c61\u53ef\u80fd\u662f\u53d8\u91cf\u6216\u51fd\u6570\u3002\u5916\u90e8\u53d8\u91cf\u5b9a\u4e49\u5728\u51fd\u6570\u4e4b\u5916\uff0c\u53ef\u4ee5\u5728\u51fd\u6570\u4e2d\u4f7f\u7528\u3002\u800c\u51fd\u6570\u672c\u8eab\u5c31\u662f\u201c\u5916\u90e8\u7684\u201d\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5916\u90e8\u53d8\u91cf\u5177\u6709\u4e0b\u5217\u6027\u8d28\uff1a\u901a\u8fc7\u4e00\u4e2a\u540d\u5b57\u5bf9\u5916\u90e8\u53d8\u91cf\u7684\u6240\u6709\u5f15\u7528\u5b9e\u9645\u4e0a\u90fd\u662f\u5f15\u7528\u540c\u4e00\u4e2a\u5bf9\u8c61\u3002</p>"},{"location":"ThreeMountains/OS/C/#_11","title":"\u9759\u6001\u53d8\u91cf","text":"<p>\u5916\u90e8\u53d8\u91cf\u53ef\u4ee5\u4f7f\u7528 static \u8fdb\u884c\u4fee\u9970\uff0c\u6b64\u65f6\u5c31\u4e0d\u518d\u662f\u5916\u90e8\u53d8\u91cf\u4e86\uff0c\u800c\u662f\u9759\u6001\u53d8\u91cf\u3002\u9759\u6001\u53d8\u91cf\u4ec5\u4f9b\u5176\u6240\u5728\u7684\u6e90\u6587\u4ef6\u4e2d\u7684\u51fd\u6570\u4f7f\u7528\u3002 <pre><code>static int global_var = 10;\n</code></pre></p> <p>static \u4e5f\u53ef\u4ee5\u58f0\u660e\u51fd\u6570\uff0c\u5982\u679c\u628a\u51fd\u6570\u58f0\u660e\u4e3a static \u7c7b\u578b\uff0c\u5219\u6539\u51fd\u6570\u540d\u53ea\u80fd\u5bf9\u8be5\u51fd\u6570\u6240\u5728\u7684\u6587\u4ef6\u53ef\u89c1\u3002 <pre><code>static void helperFund() {\n    // some code\n}\n</code></pre></p> <p>static \u4e5f\u53ef\u4ee5\u58f0\u660e\u5185\u90e8\u53d8\u91cf\uff0c\u5373\u5728\u51fd\u6570\u5185\u90e8\u58f0\u660e\u7684\u53d8\u91cf\u3002\u4e0e\u81ea\u52a8\u53d8\u91cf\u4e0d\u540c\u7684\u662f\uff0c\u5982\u679c\u4f7f\u7528 static \u4fee\u9970\u5185\u90e8\u53d8\u91cf\uff0c\u4e0d\u7ba1\u51fd\u6570\u662f\u5426\u8c03\u7528\uff0c\u5b83\u4e00\u76f4\u5b58\u5728\uff0c\u800c\u4e0d\u4f1a\u968f\u7740\u6240\u5728\u51fd\u6570\u7684\u8c03\u7528\u548c\u9000\u51fa\u800c\u5b58\u5728\u548c\u6d88\u5931\u3002 <pre><code>void myFunc() {\n    static int count = 0;\n    count++;\n    printf(\"Count: %d\\n\", count);\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#_12","title":"\u5bc4\u5b58\u5668\u53d8\u91cf","text":"<p><code>register</code> \u58f0\u660e\u9ad8\u901f\u7f16\u8bd1\u5668\uff0c\u5b83\u6240\u58f0\u660e\u7684\u53d8\u91cf\u5728\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u9891\u7387\u8f83\u9ad8\u3002\u5176\u601d\u60f3\u662f\uff0c\u5c06 register \u53d8\u91cf\u653e\u5728\u673a\u5668\u7684\u5bc4\u5b58\u5668\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u7a0b\u5e8f\u66f4\u5c0f\u3001\u6267\u884c\u901f\u5ea6\u66f4\u5feb\u3002\u7136\u800c\uff0c\u73b0\u4ee3\u7f16\u8bd1\u5668\u901a\u5e38\u4f1a\u5ffd\u7565\u8fd9\u79cd\u5efa\u8bae\uff0c\u56e0\u4e3a\u5b83\u4eec\u80fd\u591f\u66f4\u597d\u5730\u51b3\u5b9a\u53d8\u91cf\u5e94\u8be5\u5b58\u50a8\u5728\u4f55\u5904\uff0c\u4ee5\u83b7\u5f97\u6700\u4f73\u6027\u80fd\u3002</p> <p>register \u58f0\u660e\u53ea\u9002\u7528\u4e8e\u81ea\u52a8\u53d8\u91cf\u548c\u51fd\u6570\u53c2\u6570\u7684\u5f62\u5f0f\u3002</p>"},{"location":"ThreeMountains/OS/C/#_13","title":"\u6570\u636e\u7c7b\u578b","text":"<p>\u57fa\u672c\u6570\u636e\u7c7b\u578b\u6709\uff1achar\uff0cshort int\uff0cint\uff0clong int\uff0cfloat\uff0cdouble\uff0clong double\u3002</p> <p>char \u7c7b\u578b\u5360\u7528\u4e00\u4e2a\u5b57\u8282\u3002</p> <p>short int \u548c long int \u7c7b\u578b\u7684\u58f0\u660e\u4e2d\uff0cint \u53ef\u4ee5\u7701\u7565\u3002int \u901a\u5e38\u4ee3\u8868\u673a\u5668\u4e2d\u6574\u6570\u7684\u81ea\u7136\u957f\u5ea6\u3002short \u901a\u5e38\u4e3a 16 \u4f4d\uff0clong \u901a\u5e38\u4e3a 32 \u4f4d\uff0cint \u53ef\u4ee5\u4e3a 16 \u4f4d\u6216\u8005 32 \u4f4d\u3002\u7f16\u8bd1\u5668\u53ef\u4ee5\u6839\u636e\u786c\u4ef6\u7279\u6027\u81ea\u4e3b\u9009\u62e9\u5408\u9002\u7684\u957f\u5ea6\uff0c\u4f46\u662f\u9075\u5faa\u4e0b\u5217\u9650\u5236\uff1ashort \u548c int \u7c7b\u578b\u81f3\u5c11\u4e3a 16 \u4f4d\uff0clong \u7c7b\u578b\u81f3\u5c11\u4e3a 32 \u4f4d\uff0c\u5e76\u4e14 short \u4e0d\u5f97\u957f\u4e8e int\uff0cint \u4e0d\u5f97\u957f\u4e8e long\u3002</p> <p><code>signed</code> \u548c <code>unsigned</code> \u53ef\u4ee5\u4fee\u9970 char \u6216\u8005\u4efb\u4f55\u6574\u578b\uff0c\u6bd4\u5982 signed char \u7c7b\u578b\u7684\u53d8\u91cf\u53d6\u503c\u8303\u56f4\u4e3a -128~127\uff0c\u800c unsigned char \u53d6\u503c\u8303\u56f4\u4e3a 0~255\u3002</p> <p><code>float</code>\u3001<code>double</code> \u548c <code>long double</code> \u7684\u957f\u5ea6\u4e5f\u53d6\u51b3\u5177\u4f53\u7684\u5b9e\u73b0\u3002</p> <p>\u6709\u5173\u57fa\u672c\u7c7b\u578b\u7684\u53d6\u503c\u8303\u56f4\uff0c\u6574\u5f62\u53ef\u4ee5\u5728 <code>&lt;limits.h&gt;</code> \u4e2d\u83b7\u53d6\uff0c\u6d6e\u70b9\u578b\u53ef\u4ee5\u5728 <code>&lt;float.h&gt;</code> \u6587\u4ef6\u4e2d\u83b7\u53d6\u3002 <pre><code>#include &lt;stdio.h&gt;\n#include &lt;limits.h&gt;\n#include &lt;float.h&gt;\n\nint main() {\n    // signed types\n    printf(\"signed char min     = %d\\n\", SCHAR_MIN);\n    printf(\"signed char max     = %d\\n\", SCHAR_MAX);\n    printf(\"signed short min    = %d\\n\", SHRT_MIN);\n    printf(\"signed short max    = %d\\n\", SHRT_MAX);\n    printf(\"signed int min      = %d\\n\", INT_MIN);\n    printf(\"signed int max      = %d\\n\", INT_MAX);\n    printf(\"signed long min     = %ld\\n\", LONG_MIN);\n    printf(\"signed long max     = %ld\\n\", LONG_MAX);\n\n    // unsigned types\n    printf(\"unsigned char max     = %u\\n\", UCHAR_MAX);\n    printf(\"unsigned short max    = %u\\n\", USHRT_MAX);\n    printf(\"unsigned int max      = %u\\n\", UINT_MAX);\n    printf(\"unsigned long max     = %lu\\n\", ULONG_MAX);\n\n    printf(\"float min: %E\\n\", FLT_MIN);\n    printf(\"float max: %E\\n\", FLT_MAX);\n    printf(\"double min: %E\\n\", DBL_MIN);\n    printf(\"double max: %E\\n\", DBL_MAX);\n    printf(\"long double max: %E\\n\", LDBL_MAX);\n    printf(\"long double max: %E\\n\", LDBL_MAX);\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#_14","title":"\u521d\u59cb\u5316","text":"<p>\u5728\u4e0d\u8fdb\u884c\u663e\u793a\u521d\u59cb\u5316\u7684\u60c5\u51b5\u4e0b\uff0c\u5916\u90e8\u53d8\u91cf\u548c\u9759\u6001\u53d8\u91cf\u90fd\u5c06\u88ab\u521d\u59cb\u5316\u4e3a 0\uff0c\u81ea\u52a8\u53d8\u91cf\u548c\u5bc4\u5b58\u5668\u53d8\u91cf\u7684\u521d\u59cb\u503c\u6ca1\u6709\u5b9a\u4e49\uff08\u6ca1\u6709\u610f\u4e49\uff09\u3002</p> <p>\u5bf9\u4e8e\u7ed3\u6784\u4f53\u53d8\u91cf\uff0c\u5982\u679c\u6ca1\u6709\u663e\u793a\u521d\u59cb\u5316\uff0c\u5219\u5185\u90e8\u7684\u53d8\u91cf\u5219\u4f1a\u6839\u636e\u7c7b\u578b\u81ea\u52a8\u521d\u59cb\u5316\u9ed8\u8ba4\u503c\u3002</p>"},{"location":"ThreeMountains/OS/C/#_15","title":"\u51fd\u6570","text":"<p>\u4e00\u4e2a\u8bbe\u8ba1\u5f97\u5f53\u7684\u51fd\u6570\u53ef\u4ee5\u628a\u7a0b\u5e8f\u4e2d\u4e0d\u9700\u8981\u4e86\u89e3\u7684\u5177\u4f53\u64cd\u4f5c\u7ec6\u8282\u9690\u85cf\u8d77\u6765\uff0c\u4ece\u800c\u4f7f\u6574\u4e2a\u7a0b\u5e8f\u7ed3\u6784\u66f4\u52a0\u6e05\u6670\uff0c\u5e76\u964d\u4f4e\u7a0b\u5e8f\u7684\u4fee\u6539\u96be\u5ea6\u3002</p>"},{"location":"ThreeMountains/OS/C/#_16","title":"\u67e5\u627e\u6587\u672c","text":"<p>\u7f16\u5199\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u5c06\u8f93\u5165\u4e2d\u5305\u542b\u7279\u5b9a\u201c\u6a21\u5f0f\u201d\u6216\u5b57\u7b26\u4e32\u7684\u5404\u884c\u6253\u5370\u51fa\u6765\u3002\u4f8b\u5982\uff0c\u5728\u4e0b\u9762\u6587\u672c\u4e2d\u67e5\u627e\u5305\u542b\u5b57\u7b26\u4e32 \u201could\u201d \u7684\u884c\uff1a <pre><code>Ah Love! could you and I with Fate conspire\nTo grasp this sorry Scheme of Things entire,\nWould not we shatter it to bits -- and then\nRe-mould it nearer to the Heart's Desire\n</code></pre></p> <p>\u7a0b\u5e8f\u6267\u884c\u540e\u8f93\u51fa\u4e0b\u5217\u7ed3\u679c\uff1a <pre><code>Ah Love! could you and I with Fate conspire \nWould not we shatter it to bits -- and then \nRe-mould it nearer to the Heart's Desire!\n</code></pre></p> <p>\u4ee3\u7801\u5982\u4e0b\uff1a <pre><code>#include &lt;stdio.h&gt;\n\n#define MAXLINE 100\n\nchar pattern[] = \"ould\";\n\nint get_line(char*, int);\n\nint strindex(char*, char*);\n\nint main() {\n\n    char line[MAXLINE];\n\n    while(get_line(line, MAXLINE) &gt; 0) {\n        if (strindex(line, pattern) &gt;= 0) {\n            printf(\"%s\", line);\n        }\n    }\n}\n\nint get_line(char *line, int lim) {\n    int c;\n    int i = 0;\n\n    while(--lim &gt; 0 &amp;&amp; (c = getchar()) != '\\n' &amp;&amp; c != EOF) {\n        line[i++] = c;\n    }\n\n    if (c == '\\n') {\n        line[i++] = c;\n    }\n\n    line[i] = '\\0';\n    return i;\n}\n\nint strindex(char *line, char *p) {\n    int i, j, k;\n\n    for(i = 0; line[i] != '\\0'; i ++) {\n        j = i;\n        k = 0;\n\n        while (p[k] != '\\0' &amp;&amp; line[j] == p[k]) {\n            j ++;\n            k ++;\n        }\n\n        if (k &gt; 0 &amp;&amp; p[k] == '\\0') {\n            return i;\n        }\n    }\n    return -1;\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#_17","title":"\u8ba1\u7b97\u540e\u7f00\u8868\u8fbe\u5f0f\u7684\u503c","text":"<p>\u4e2d\u7f00\u8868\u8fbe\u5f0f\uff1a<code>(1 + 2) * 3</code> \u5bf9\u5e94\u7684\u540e\u7f00\u8868\u8fbe\u5f0f\u4e3a\uff1a<code>1 2 + 3 *</code> \u3002\u540e\u7f00\u8868\u8fbe\u5f0f\u4e5f\u6210\u4e3a\u9006\u6ce2\u5170\u8868\u8fbe\u5f0f\u3002</p> <p><code>calc.h</code> \u4ee3\u7801\u4e3a\u5934\u6587\u4ef6\uff0c\u5b9a\u4e49\u5b8f\u5e76\u4e14\u58f0\u660e\u51fd\u6570\u3002 <pre><code>// calc.h\n#define NUMBER '0'\n\nvoid push(double);\n\ndouble pop();\n\nint getop(char []);\n\nint getch();\n\nvoid ungetch(int);\n</code></pre></p> <p>\u540e\u7f00\u8868\u8fbe\u5f0f\u7684\u6c42\u503c\u903b\u8f91\uff1a\u7531\u5de6\u5411\u53f3\u9010\u4e2a\u8bfb\u53d6\u540e\u7f00\u8868\u8fbe\u5f0f\u7684\u5143\u7d20\uff0c\u5982\u679c\u8bfb\u53d6\u7684\u5143\u7d20\u4e3a\u64cd\u4f5c\u6570\u5219\u5c06\u64cd\u4f5c\u6570\u538b\u5165\u6808\u4e2d\uff0c\u5982\u679c\u8bfb\u53d6\u7684\u5143\u7d20\u4e3a\u64cd\u4f5c\u7b26\uff0c\u5219\u53d6\u51fa\u6808\u9876\u7684\u4e24\u4e2a\u64cd\u4f5c\u6570\uff0c\u8fdb\u884c\u8ba1\u7b97\u5e76\u5c06\u8ba1\u7b97\u7ed3\u679c\u5165\u6808\u3002 <pre><code>// main.c\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include \"calc.h\"\n\n#define MAXOP 100\n\nint main() {\n    int type;\n    double op2;\n    char s[MAXOP];\n\n    while((type = getop(s)) != EOF) {\n        switch (type) {\n        case NUMBER:\n            push(atof(s));\n            break;\n        case '+':\n            push(pop() + pop());\n            break;\n        case '*':\n            push(pop() * pop());\n            break;\n        case '-':\n            op2 = pop();\n            push(pop() - op2);\n            break;\n        case '/':\n            op2 = pop();\n            if (op2 != 0.0) {\n                push(pop() / op2);\n            } else {\n                printf(\"error: zero divisor\\n\");\n            }\n            break;\n        case '\\n':\n            printf(\"\\t%.8g\\n\", pop());\n            break;\n        default:\n            printf(\"error: unknown command %s\\n\", s);\n            break;\n        }\n    }\n    return 0;\n}\n</code></pre></p> <p><code>stack.c</code> \u5c01\u88c5\u6808\u7684\u57fa\u672c\u64cd\u4f5c\u3002 <pre><code>stack.c\n#include &lt;stdio.h&gt;\n#include \"calc.h\"\n\n#define MAXVAL 100\nc\nint sp = 0;\n\ndouble val[MAXVAL];\n\nvoid push(double f) {\n    if(sp &lt; MAXVAL) {\n        val[sp ++] = f;\n    } else {\n        printf(\"error: stack full, can't push %g\\n\", f);\n    }\n}\n\ndouble pop() {\n    if(sp &gt; 0) {\n        return val[--sp];\n    } else {\n        printf(\"error: stack empty\\n\");\n        return 0.0;\n    }\n}\n</code></pre></p> <p><code>getop.c</code> \u4ee3\u7801\u7684\u4f5c\u7528\u662f\u89e3\u6790\u540e\u7f00\u8868\u8fbe\u5f0f\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u3002 <pre><code>// getop.c\n#include &lt;stdio.h&gt;\n#include &lt;ctype.h&gt;\n#include \"calc.h\"\n\nint getch();\nvoid ungetch(int);\n\nint getop(char s[]) {\n    int i, c;\n\n    // \u83b7\u53d6\u7b2c\u4e00\u4e2a\u64cd\u4f5c\u5b57\u7b26\uff0c\u5ffd\u7565\u524d\u7f6e\u7684\u7a7a\u683c\u548c TAB\n    while((s[0] = c = getch()) == ' ' || c == '\\t') {\n        ;\n    }\n    s[1] = '\\0';\n\n    // \u5224\u65ad\u5b57\u7b26\u5982\u679c\u662f\u4e0d\u5c5e\u4e8e\u6570\u5b57\u76f4\u63a5\u8fd4\u56de\n    if (!isdigit(c) &amp;&amp; c != '.' &amp;&amp; c != '-') {\n        return c;\n    }\n\n    i = 0;\n    if (c == '-') {\n        if (isdigit(c = getch()) || c == '.') {\n            s[++i] = c;\n        } else {\n            if (c != EOF) {\n                ungetch(c);\n            }\n            return '-';\n        }   \n    }\n\n    // \u5982\u679c\u662f\u591a\u4f4d\u6570\n    if (isdigit(c)) {\n        while(isdigit(s[++i] = c = getch())) {\n            ;\n        }\n    }\n    // \u5982\u679c\u9047\u5230\u5c0f\u6570\u4f4d\u7ee7\u7eed\u83b7\u53d6\u540e\u7eed\u7684\u5c0f\u6570\u90e8\u5206\n    if (c == '.') {\n        /* code */\n        while(isdigit(s[++i] = c = getch())) {\n            ;\n        }\n    }\n\n    s[i] = '\\0';\n\n    // \u7f13\u5b58\u591a\u8bfb\u53d6\u7684\u4e0b\u4e00\u4e2a\u5143\u7d20\n    if (c != EOF) {\n        ungetch(c);\n    }\n    return NUMBER;\n}\n</code></pre></p> <p><code>getch.c</code> \u4ee3\u7801\u7684\u4f5c\u7528\u662f\u7f13\u5b58\u8bfb\u53d6\u7684\u5b57\u7b26\uff0c\u56e0\u4e3a <code>getop.c</code> \u4e3a\u4e86\u83b7\u53d6\u4e00\u4e2a\u5143\u7d20\uff0c\u5f80\u5f80\u8981\u591a\u8bfb\u53d6\u4e00\u4e2a\u5b57\u7b26\u6765\u5224\u65ad\u5f53\u524d\u5143\u7d20\u662f\u4e0d\u662f\u7ed3\u675f\uff0c\u6240\u4ee5\u8981\u5c06\u591a\u8bfb\u53d6\u7684\u5b57\u7b26\u7f13\u5b58\u8d77\u6765\u3002 <pre><code>// getch.c\n#include &lt;stdio.h&gt;\n#define BUFSIZE 100\n\nchar buf[BUFSIZE];\nint bufp = 0;\n\nint getch() {\n    return (bufp &gt; 0) ? buf[--bufp] : getchar();\n}\n\nvoid ungetch(int c) {\n    if (bufp &gt;= BUFSIZE) {c\n        printf(\"ungetch: too many characters\\n\");\n    } else {\n        buf[bufp ++] = c;\n    }\n\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#_18","title":"\u9884\u5904\u7406","text":""},{"location":"ThreeMountains/OS/C/#_19","title":"\u6587\u4ef6\u5305\u542b","text":"<p><code>#include &lt;&gt;</code> \u7528\u6765\u5f15\u7528\u6807\u51c6\u5e93\u5934\u6587\u4ef6\uff0c\u8fd9\u4e9b\u5934\u6587\u4ef6\u901a\u5e38\u5df2\u7ecf\u5b89\u88c5\u5728\u7cfb\u7edf\u7684\u6807\u51c6\u76ee\u5f55\u4e2d\u3002\u7f16\u8bd1\u5668\u4f1a\u5728\u8fd9\u4e2a\u6807\u51c6\u76ee\u5f55\u4e2d\u67e5\u627e\u5934\u6587\u4ef6\u5e76\u5c06\u5176\u5305\u542b\u5230\u4ee3\u7801\u4e2d\u3002  </p> <p><code>#include \"\"</code> \u7528\u6765\u5f15\u7528\u81ea\u5b9a\u4e49\u5934\u6587\u4ef6\uff0c\u8fd9\u4e9b\u5934\u6587\u4ef6\u901a\u5e38\u662f\u7528\u6237\u81ea\u5df1\u7f16\u5199\u7684\u3002\u7f16\u8bd1\u5668\u4f1a\u5728\u5f53\u524d\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u4e2d\u67e5\u627e\u5934\u6587\u4ef6\u5e76\u5c06\u5176\u5305\u542b\u8fdb\u4ee3\u7801\u4e2d\u3002</p>"},{"location":"ThreeMountains/OS/C/#_20","title":"\u5b8f\u66ff\u6362","text":"<p>\u6700\u7b80\u5355\u7684\u5b8f\u66ff\u6362\uff0c\u5373\u5b9a\u4e49\u4e00\u4e2a\u540d\u5b57\u548c\u66ff\u6362\u6587\u672c\uff0c\u540e\u7eed\u51fa\u73b0\u7684\u6240\u6709\u540d\u5b57\u90fd\u4f1a\u88ab\u6587\u672c\u66ff\u6362\u3002 <pre><code>#define name text\n</code></pre></p> <p><code>#define</code> \u6307\u4ee4\u5b9a\u4e49\u7684\u540d\u5b57\u7684\u4f5c\u7528\u57df\u4ece\u5176\u5b9a\u4e49\u70b9\u5f00\u59cb\uff0c\u5230\u88ab\u7f16\u8bd1\u7684\u6e90\u6587\u4ef6\u7684\u672b\u5c3e\u5904\u7ed3\u675f\u3002\u5b8f\u5b9a\u4e49\u4e5f\u53ef\u4ee5\u4f7f\u7528\u524d\u9762\u51fa\u73b0\u7684\u5b8f\u5b9a\u4e49\u3002</p> <p>\u66ff\u6362\u53ea\u5bf9\u8bb0\u53f7\u8fdb\u884c\uff0c\u5bf9\u62ec\u5728\u5f15\u53f7\u7684\u5b57\u7b26\u4e32\u4e0d\u8d77\u4f5c\u7528\u3002\u4f8b\u5982\uff0c\u5982\u679c YES \u662f\u4e00\u4e2a\u901a\u8fc7 <code>#define</code> \u6307\u4ee4\u5b9a\u4e49\u8fc7\u7684\u540d\u5b57\uff0c\u5219\u5728 printf(\"YES\") \u6216 YESMAN \u4e2d\u5c06\u4e0d\u6267\u884c\u66ff\u6362\u3002</p> <p>\u66ff\u6362\u53ef\u4ee5\u662f\u4efb\u610f\u6587\u672c\u7684\uff0c\u4f8b\u5982\uff0c\u4e3a\u65e0\u9650\u5faa\u73af\u5b9a\u4e49\u4e86\u4e00\u4e2a\u65b0\u540d\u5b57 forever\u3002 <pre><code>#define forever for(;;)\n</code></pre></p> <p>\u5b8f\u5b9a\u4e49\u4e5f\u53ef\u4ee5\u5e26\u53c2\u6570\uff0c\u4f46\u662f\u8981\u6ce8\u610f\u8868\u8fbe\u5f0f\u526f\u4f5c\u7528\u7684\u6216\u8005\u8ba1\u7b97\u987a\u5e8f\u7684\u95ee\u9898\u3002</p> <p>\u4e0b\u9762\u7684\u5b8f\u5b9a\u4e49\u5c31\u5b58\u5728\u8868\u8fbe\u5f0f\u7684\u526f\u4f5c\u7528\u95ee\u9898\uff0c\u5982\u679c\u8c03\u7528 <code>max(i++, j++)</code> \u5c31\u4f1a\u66b4\u9732\u7f3a\u9677\u3002 <pre><code>#define max(A,B) ((A) &gt; (B) ? (A) : (B))\n</code></pre></p> <p>\u4e0b\u9762\u7684\u5b8f\u5b9a\u4e49\u5c31\u5b58\u5728\u8ba1\u7b97\u987a\u5e8f\u95ee\u9898\uff0c\u5982\u679c\u8c03\u7528 <code>squrare(z + 1)</code> \u5c31\u4f1a\u66b4\u9732\u7f3a\u9677\u3002 <pre><code>#define squrare(x) x * x\n</code></pre></p> <p>\u53ef\u4ee5\u901a\u8fc7 <code>#undef</code> \u6307\u4ee4\u53d6\u6d88\u540d\u5b57\u7684\u5b8f\u5b9a\u4e49\u3002</p>"},{"location":"ThreeMountains/OS/C/#_21","title":"\u6307\u9488","text":"<p>\u6307\u9488\u662f\u4e00\u79cd\u4fdd\u5b58\u53d8\u91cf\u5730\u5740\u7684\u53d8\u91cf\u3002\u53ef\u4ee5\u628a\u6307\u9488\u770b\u7740\u4e00\u79cd\u7279\u6b8a\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u4e3a\u6307\u9488\u7c7b\u578b\uff0c\u5e76\u4e14\u503c\u53ea\u80fd\u662f\u5730\u5740\u3002</p> <p>\u4e00\u5143\u8fd0\u7b97\u7b26 &amp; \u53ef\u7528\u4e8e\u53d6\u4e00\u4e2a\u5bf9\u8c61\u7684\u5730\u5740\u3002 <pre><code>p = &amp;c;\n</code></pre></p> <p>\u4e0a\u8ff0\u8868\u8fbe\u5f0f\u628a\u53d8\u91cf c \u7684\u5730\u5740\u8d4b\u503c\u7ed9\u53d8\u91cf p\uff0c\u79f0 p \u4e3a\u201c\u6307\u5411\u201d c \u7684\u6307\u9488\u3002</p> <p>\u5730\u5740\u8fd0\u7b97\u7b26 &amp; \u53ea\u80fd\u5e94\u7528\u4e8e\u5185\u5b58\u4e2d\u7684\u5bf9\u8c61\uff0c\u5373\u53d8\u91cf\u4e0e\u6570\u7ec4\u3002\u5b83\u4e0d\u80fd\u4f5c\u7528\u4e8e\u8868\u8fbe\u5f0f\u3001\u5e38\u91cf\u6216 <code>register</code> \u7c7b\u578b\u7684\u53d8\u91cf\u3002 <pre><code>int x = 1, y = 2, z[10];\nint *ip;\nip = &amp;x;    // ip now points x\ny = *ip;    // y is now 1\n*ip = 0;    // x is now 0\nip = &amp;z[0];    // ip now points to z[0]\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#_22","title":"\u6307\u9488\u4e0e\u51fd\u6570","text":"<p>\u7531\u4e8e C \u8bed\u8a00\u662f\u4ee5\u4f20\u503c\u7684\u65b9\u5f0f\u5c06\u53c2\u6570\u503c\u4f20\u9012\u7ed9\u88ab\u8c03\u7528\u51fd\u6570\u3002\u56e0\u6b64\uff0c\u88ab\u8c03\u7528\u51fd\u6570\u4e0d\u80fd\u76f4\u63a5\u4fee\u6539\u4e3b\u8c03\u51fd\u6570\u4e2d\u53d8\u91cf\u7684\u503c\u3002</p> <p>\u5982\u4e0b\u7684 swap \u51fd\u6570\u5c31\u662f\u9519\u8bef\u7684\uff0c\u5b83\u4ec5\u4ec5\u4ea4\u6362\u4e86 a \u548c b \u7684\u526f\u672c\u7684\u503c\u3002 <pre><code>void swap(int x, int y) {\n    int tmp = x;\n    x = y;\n    y = tmp;\n}\n</code></pre></p> <p>\u6b63\u786e\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a <pre><code>void swap(int *x, int *y) {\n    int tmp = *x;\n    *x = *y;\n    *i = tmp;\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#_23","title":"\u6307\u9488\u4e0e\u6570\u7ec4","text":"<p>\u5728 C \u8bed\u8a00\u4e2d\u6307\u9488\u4e0e\u6570\u7ec4\u7684\u5173\u7cfb\u5341\u5206\u5bc6\u5207\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u7528\u6307\u9488\u7f16\u5199\u7684\u7a0b\u5e8f\u6bd4\u7528\u6570\u7ec4\u4e0b\u6807\u7f16\u5199\u7684\u7a0b\u5e8f\u6267\u884c\u901f\u5ea6\u66f4\u5feb\uff0c\u4f46\u53e6\u4e00\u65b9\u9762\uff0c\u7528\u6307\u9488\u5b9e\u73b0\u7684\u7a0b\u5e8f\u7406\u89e3\u8d77\u6765\u7a0d\u5fae\u56f0\u96be\u4e00\u4e9b\u3002</p> <p>\u5b9a\u4e49\u4e2a\u957f\u5ea6\u4e3a 10 \u7684\u6570\u7ec4 a\uff0c<code>a[i]</code> \u8868\u793a\u6570\u7ec4\u7684\u7b2c <code>i</code> \u4e2a\u5143\u7d20\u3002 <pre><code>int a[10];\n</code></pre></p> <p>\u5b9a\u4e49\u4e00\u4e2a\u6307\u5411\u6574\u578b\u5bf9\u8c61\u7684\u6307\u9488 <code>pa</code>\uff0c\u5e76\u4e14\u5c06\u6307\u9488 <code>pa</code> \u6307\u5411\u6570\u7ec4 a \u7684\u7b2c 0 \u4e2a\u5143\u7d20\u3002 <pre><code>int *pa;\npa = &amp;a[0];\n</code></pre></p> <p>\u5982\u679c <code>pa</code> \u6307\u5411\u6570\u7ec4\u4e2d\u7684\u67d0\u4e2a\u7279\u5b9a\u5143\u7d20\uff0c\u90a3\u4e48\uff0c\u6839\u636e\u6307\u9488\u8fd0\u7b97\u7684\u5b9a\u4e49\uff0c<code>pa + 1</code> \u5c06\u6307\u5411\u4e0b\u4e00\u4e2a\u5143\u7d20\u3002\u56e0\u6b64\uff0c\u5982\u679c pa \u6307\u5411 <code>a[0]</code>\uff0c\u90a3\u4e48 <code>*(pa + 1)</code> \u5f15\u7528\u7684\u662f\u7d20\u7ec4\u5143\u7d20 <code>a[1]</code> \u7684\u5185\u5bb9\uff0c<code>pa + i</code> \u662f\u6570\u7ec4\u5143\u7d20 <code>a[i]</code> \u5143\u7d20\u7684\u5730\u5740\uff0c<code>*(pa + i)</code> \u5f15\u7528\u7684\u662f\u6570\u7ec4\u5143\u7d20 <code>a[i]</code> \u7684\u5185\u5bb9\u3002\u65e0\u8bba\u6570\u7ec4 a \u4e2d\u5143\u7d20\u7684\u7c7b\u578b\u6216\u8005\u6570\u7ec4\u7684\u957f\u5ea6\u662f\u4ec0\u4e48\uff0c\u4ee5\u4e0a\u7ed3\u8bba\u90fd\u6210\u7acb\u3002</p> <p>\u6839\u636e\u5b9a\u4e49\uff0c\u6570\u7ec4\u7c7b\u578b\u7684\u53d8\u91cf\u6216\u8868\u8fbe\u5f0f\u7684\u503c\u662f\u8be5\u6570\u7ec4\u7b2c 0 \u4e2a\u5143\u7d20\u7684\u5730\u5740\u3002\u4e0b\u9762\u4e24\u6761\u8d4b\u503c\u8bed\u53e5\u7b49\u4ef7\u3002 <pre><code>pa = &amp;a[0];\npa = a;\n</code></pre></p> <p>\u5bf9\u6570\u7ec4\u5143\u7d20 <code>a[i]</code> \u7684\u5f15\u7528\u4e5f\u53ef\u4ee5\u5199\u6210 <code>*(a + i)</code> \u8fd9\u79cd\u5f62\u5f0f\uff0c\u56e0\u6b64 <code>&amp;a[i]</code> \u548c <code>a + i</code> \u7684\u542b\u4e49\u4e5f\u662f\u76f8\u540c\u7684\u3002\u54cd\u5e94\u5730\uff0c\u5982\u679c pa \u662f\u4e2a\u6307\u9488\uff0c\u90a3\u4e48\uff0c\u5728\u8868\u8fbe\u5f0f\u4e2d\u4e5f\u53ef\u4ee5\u5728\u5b83\u540e\u9762\u52a0\u4e0b\u8868\u3002<code>pa[i]</code> \u4e0e <code>*(pa + i)</code> \u662f\u7b49\u4ef7\u7684\u3002</p> <p>\u4f46\u662f\uff0c\u6570\u7ec4\u540d\u548c\u6307\u9488\u6709\u4e00\u4e2a\u4e0d\u540c\u4e4b\u5904\uff0c\u6307\u9488\u662f\u4e00\u4e2a\u53d8\u91cf\uff0c\u56e0\u6b64\uff0c\u5728 C \u8bed\u8a00\u4e2d\u8bed\u53e5 <code>pa = a</code> \u548c <code>pa ++</code> \u90fd\u662f\u5408\u6cd5\u7684\u3002\u4f46\u6570\u7ec4\u540d\u4e0d\u662f\u53d8\u91cf\uff0c\u56e0\u6b64\uff0c\u7c7b\u4f3c\u4e0e <code>a = pa</code> \u548c <code>a++</code> \u5f62\u5f0f\u7684\u8bed\u53e5\u90fd\u662f\u975e\u6cd5\u7684\u3002</p> <p>\u5f53\u628a\u6570\u7ec4\u540d\u4f20\u9012\u7ed9\u4e00\u4e2a\u51fd\u6570\u65f6\uff0c\u5b9e\u9645\u4e0a\u4f20\u9012\u7684\u662f\u8be5\u6570\u7ec4\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684\u5730\u5740\uff0c\u5373\u6307\u9488\u3002\u56e0\u6b64\u5728\u51fd\u6570\u5b9a\u4e49\u4e2d\uff0c\u5f62\u53c2 <code>char s[]</code> \u548c <code>char *s</code> \u662f\u7b49\u4ef7\u7684\u3002 <pre><code>#include &lt;stdio.h&gt;\n\nint str_len(char *s);\n\nint main() {\n    char s1[] = {'a', 'b', 'd', '\\0'};\n    char *s2 = \"hello world!\";\n\n    printf(\"s1 len: %d\\n\", str_len(s1 + 1));    // 2\n    printf(\"s2 len: %d\\n\", str_len(s2));    // 12\n}\n\nint str_len(char *s) {\n    int n;\n    for(n = 0; *s != '\\0'; s ++) {\n        n ++;\n    }\n    return n;\n}\n</code></pre></p> <p>\u7531\u4e8e\u6570\u7ec4\u7684\u4f20\u9012\u5b9e\u9645\u4e0a\u4f20\u9012\u7684\u662f\u6307\u9488\uff0c\u56e0\u6b64\u5728\u51fd\u6570\u5185\u90e8\u4f7f\u7528 sizeof \u662f\u83b7\u53d6\u4e0d\u5230\u6570\u7ec4\u7684\u957f\u5ea6\u3002\u56e0\u6b64\u5728\u4e0b\u9762\u7684\u4ee3\u7801\u4e2d <code>sizeof line</code> \u548c <code>sizeof(char *)</code> \u662f\u7b49\u4ef7\u7684\u3002 <pre><code>int get_line(char line[]) {\n    printf(\"get_line line len: %d\\n\", sizeof line);\n    printf(\"get_line line len: %d\\n\", sizeof(char *));\n\n    return 0;\n}\n</code></pre></p> <p>\u6307\u9488\u7684\u521d\u59cb\u5316</p> <p>\u540c\u5176\u5b83\u7c7b\u578b\u7684\u53d8\u91cf\u4e00\u6837\uff0c\u6307\u9488\u4e5f\u53ef\u4ee5\u521d\u59cb\u5316\u3002\u901a\u5e38\u9488\u5bf9\u6307\u9488\u6709\u610f\u4e49\u7684\u521d\u59cb\u5316\u503c\u53ea\u80fd\u662f 0 \u6216\u8005\u8868\u793a\u5730\u5740\u7684\u8868\u8fbe\u5f0f\u3002C \u8bed\u8a00\u4fdd\u8bc1\uff0c0 \u6c38\u8fdc\u4e0d\u662f\u6709\u6548\u7684\u6570\u636e\u5730\u5740\uff0c\u56e0\u6b64\uff0c\u8fd4\u56de\u503c 0 \u53ef\u7528\u6765\u8868\u793a\u53d1\u751f\u4e86\u5f02\u5e38\u4e8b\u4ef6\u3002 \u6307\u9488\u4e0e\u6574\u6570\u4e4b\u95f4\u4e0d\u80fd\u4e92\u76f8\u8f6c\u6362\uff0c\u4f46\u662f 0 \u662f\u552f\u4e00\u7684\u4f8b\u5916\uff1a\u5e38\u91cf 0 \u53ef\u4ee5\u8d4b\u503c\u7ed9\u6307\u9488\uff0c\u6307\u9488\u4e5f\u53ef\u4ee5\u548c\u5e38\u91cf 0 \u8fdb\u884c\u6bd4\u8f83\u3002\u7a0b\u5e8f\u4e2d\u5e38\u7528\u7b26\u53f7 <code>NULL</code> \u4ee3\u66ff\u5e38\u91cf 0\uff0c\u7b26\u53f7\u5e38\u91cf NULL \u5b9a\u4e49\u5728\u6807\u51c6\u5934\u6587\u4ef6 <code>&lt;stddef.h&gt;</code> \u4e2d\u3002</p> <p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u6307\u9488\u53ef\u4ee5\u53ca\u8fdb\u884c\u6bd4\u8f83\u8fd0\u7b97\uff0c\u4f8b\u5982\uff0c\u5982\u679c\u6307\u9488 p \u548c q \u6307\u5411\u540c\u4e00\u4e2a\u6570\u7ec4\u7684\u6210\u5458\uff0c\u90a3\u4e48\u5b83\u4eec\u4e4b\u95f4\u5c31\u53ef\u4ee5\u8fdb\u884c\u7c7b\u4f3c\u4e0e <code>==</code>\u3001<code>!=</code>  \u7684\u5173\u7cfb\u6bd4\u8f83\u8fd0\u7b97\u3002\u4f46\u662f\uff0c\u6307\u5411\u4e0d\u540c\u6570\u7ec4\u7684\u5143\u7d20\u7684\u6307\u9488\u4e4b\u95f4\u7684\u7b97\u672f\u6216\u6bd4\u8f83\u8fd0\u7b97\u6ca1\u6709\u610f\u4e49\u3002 \u5982\u679c p \u6307\u5411\u7684\u5143\u7d20\u7684\u4f4d\u7f6e\u5728 q \u6307\u5411\u7684\u5143\u7d20\u7684\u4f4d\u7f6e\u4e4b\u524d\uff0c\u90a3\u4e48\u4e0b\u9762\u7684\u8868\u8fbe\u5f0f\u4e3a\u771f\u3002 <pre><code>p &lt; q\n</code></pre></p> <p>\u6307\u9488\u53ef\u4ee5\u548c\u6574\u6570\u8fdb\u884c\u76f8\u52a0\u6216\u76f8\u51cf\u8fd0\u7b97\uff0c\u4f8b\u5982 <code>p + n</code> \u8868\u793a p \u5f53\u524d\u6307\u5411\u7684\u5bf9\u8c61\u4e4b\u540e\u7b2c n \u4e2a\u5bf9\u8c61\u7684\u5730\u5740\u3002\u65e0\u8bba\u6307\u9488 p \u6307\u5411\u7684\u5bf9\u8c61\u662f\u4f55\u79cd\u7c7b\u578b\uff0c\u4e0a\u8ff0\u7ed3\u8bba\u90fd\u6210\u7acb\u3002</p> <p>\u6307\u9488\u7684\u76f8\u51cf\u8fd0\u7b97\u4e5f\u662f\u6709\u610f\u4e49\u7684\uff1a\u5982\u679c p \u548c q \u6307\u5411\u76f8\u540c\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\uff0c\u4e14 p &lt; q\uff0c\u90a3\u4e48 <code>q - p + 1</code> \u5c31\u662f\u4f4d\u4e8e p \u548c q \u6307\u5411\u7684\u5143\u7d20\u4e4b\u95f4\u5143\u7d20\u7684\u6570\u76ee\u3002</p> <p>\u6709\u6548\u7684\u6307\u9488\u8fd0\u7b97\u5305\u62ec\u76f8\u540c\u7c7b\u578b\u6307\u9488\u4e4b\u95f4\u7684\u8d4b\u503c\u8fd0\u7b97\uff1b\u6307\u9488\u540c\u6574\u6570\u65f6\u95f4\u7684\u52a0\u51cf\u6cd5\u8fd0\u7b97\uff1b\u6307\u5411\u76f8\u540c\u6570\u7ec4\u4e2d\u5143\u7d20\u7684\u4e24\u4e2a\u6307\u9488\u95f4\u7684\u51cf\u6cd5\u6216\u6bd4\u8f83\u8fd0\u7b97\uff1b\u5c06\u6307\u9488\u8d4b\u503c\u4e3a 0 \u6216\u6307\u9488\u4e0e 0 \u4e4b\u95f4\u7684\u6bd4\u8f83\u8fd0\u7b97\u3002\u5176\u5b83\u6240\u6709\u5f62\u5f0f\u7684\u6307\u9488\u8fd0\u7b97\u90fd\u662f\u975e\u6cd5\u7684\u3002</p>"},{"location":"ThreeMountains/OS/C/#_24","title":"\u5b57\u7b26\u6307\u9488\u4e0e\u51fd\u6570","text":"<p>\u5b57\u7b26\u4e32\u5e38\u91cf\u662f\u4e00\u4e2a\u5b57\u7b26\u6570\u7ec4\uff0c\u4f8b\u5982\uff0c<code>\"I am a string\"</code> \u5728\u5b57\u7b26\u4e32\u7684\u5185\u90e8\u8868\u793a\u4e2d\uff0c\u5b57\u7b26\u6570\u7ec4\u4ee5\u7a7a\u5b57\u7b26 <code>\\0</code> \u7ed3\u5c3e\uff0c\u6240\u4ee5\uff0c\u53ef\u4ee5\u901a\u8fc7\u68c0\u67e5\u7a7a\u5b57\u7b26\u627e\u5230\u5b57\u7b26\u6570\u7ec4\u7684\u7ed3\u5c3e\u3002\u5b57\u7b26\u4e32\u5e38\u91cf\u5360\u636e\u7684\u5b58\u50a8\u5355\u5143\u6570\u4e5f\u56e0\u6b64\u6bd4\u53cc\u5f15\u53f7\u5185\u7684\u5b57\u7b26\u6570\u5927 1\u3002</p> <p>\u5b57\u7b26\u4e32\u5e38\u91cf\u4e00\u4e2a\u5e38\u89c1\u7684\u7528\u6cd5\u662f\u4f5c\u4e3a\u51fd\u6570\u53c2\u6570\uff0c\u4f8b\u5982\uff0c\u4e0b\u9762\u4ee3\u7801\u5b9e\u9645\u4e0a\u662f\u901a\u8fc7\u5b57\u7b26\u6307\u9488\u8bbf\u95ee\u8be5\u5b57\u7b26\u4e32\u7684\u3002 <pre><code>printf(\"hello world\\n\");\n</code></pre></p> <p>\u4e0b\u9762\u4e24\u4e2a\u8bed\u53e5\u7684\u5b9a\u4e49\u4e4b\u95f4\u6709\u5f88\u5927\u7684\u5dee\u522b\uff1a <pre><code>char amessage[] = \"now is the time\";\nchar *pmessage = \"now is the time\";\n</code></pre></p> <p><code>amessage</code> \u662f\u4e00\u4e2a\u4ec5\u4ec5\u8db3\u4ee5\u5b58\u653e\u521d\u59cb\u5316\u5b57\u7b26\u4e32\u4ee5\u53ca\u7a7a\u5b57\u7b26 <code>\\0</code> \u7684\u4e00\u7ef4\u6570\u7ec4\u3002\u6570\u7ec4\u4e2d\u7684\u5b57\u7b26\u53ef\u4ee5\u4fee\u6539\uff0c\u4f46\u662f amessage \u59cb\u7ec8\u6307\u5411\u540c\u4e00\u5b58\u50a8\u4f4d\u7f6e\u3002 <code>pmessage</code> \u662f\u4e00\u4e2a\u6307\u9488\uff0c\u5176\u521d\u59cb\u503c\u6307\u5411\u4e00\u4e2a\u5b57\u7b26\u4e32\u5e38\u91cf\uff0c\u4e4b\u540e\u5b83\u53ef\u4ee5\u88ab\u4fee\u6539\u6307\u5411\u5176\u5b83\u5730\u5740\uff0c\u4f46\u5982\u679c\u8bd5\u56fe\u4fee\u6539\u5b57\u7b26\u4e32\u7684\u5185\u5bb9\uff0c\u5176\u7ed3\u679c\u662f\u6ca1\u6709\u5b9a\u4e49\u7684\u3002</p> <p>\u4e0b\u9762\u662f\u4f7f\u7528\u6307\u9488\u5b9e\u73b0\u7684\u5b57\u7b26\u4e32\u590d\u5236\u51fd\u6570\uff0c\u63d0\u4f9b\u5c06\u5b57\u7b26\u4e32\u6307\u9488 <code>t</code> \u6307\u5411\u7684\u5b57\u7b26\u4e32\u590d\u5236\u5230 <code>s</code>\u3002 <pre><code>#include &lt;stdio.h&gt;\n\nvoid str_copy1(char*, char*);\nvoid str_copy2(char*, char*);\nvoid str_copy3(char*, char*);\n\nint main() {\n\n    char s1[] = \"hello world!\";\n    char t1[] = \"nihao\";\n\n    str_copy1(s1, t1);\n    printf(\"%s\\n\", s1);  // nihao\n\n    char s2[] = \"how much!\";\n    char t2[] = \"duoshao\";\n\n    str_copy2(s2, t2);\n    printf(\"%s\\n\", s2); // duoshao\n\n    char s3[] = \"thank you!\";\n    char t3[] = \"tks\";\n\n    str_copy3(s3, t3);\n    printf(\"%s\\n\", s3); // tks\n}\n\nvoid str_copy1(char *s, char *t) {\n    int i = 0;\n\n    while((s[i] = t[i]) != '\\0') {\n        i ++;\n    }\n}\n\nvoid str_copy2(char *s, char *t) {\n    while((*s = *t) != '\\0') {\n        s ++;\n        t ++;\n    }\n}\n\nvoid str_copy3(char *s, char *t) {\n    while((*s ++ = *t ++) != '\\0') {    // \u6b64\u5904\u4e5f\u53ef\u4ee5\u7701\u7565\u548c\u7a7a\u5b57\u7b26 '\\0' \u7684\u6bd4\u8f83\uff0c\u56e0\u4e3a\u7a7a\u5b57\u7b26\u7684\u503c\u4e3a 0 \u5373 false\n        ;\n    }\n}\n\nvoid strcpy(char *s, char * t) {\n    while(*s ++ = *t ++) {\n        ;\n    }\n}\n</code></pre></p> <p>\u4e0b\u9762\u662f\u5b57\u7b26\u4e32\u6bd4\u8f83\u51fd\u6570\uff0c\u6bd4\u8f83\u5b57\u7b26\u4e32 s \u548c t\uff0c\u5e76\u4e14\u6839\u636e s \u6309\u7167\u5b57\u5178\u987a\u5e8f\u5c0f\u4e8e\u3001\u7b49\u4e8e\u6216\u5927\u4e8e t \u7684\u7ed3\u679c\u5206\u522b\u8fd4\u56de\u8d1f\u6574\u6570\u30010 \u6216\u6b63\u6574\u6570\u3002 <pre><code>#include &lt;stdio.h&gt;\n\nint strcmp1(char *, char *);\nint strcmp2(char *, char *);\n\nint main()\n{\n    char str1[] = \"a!a\";   \n    char *str2 = \"a!\";\n\n    printf(\"strcmp1 result: %d\\n\", strcmp1(str1, str2));\n    printf(\"strcmp2 result: %d\\n\", strcmp2(str1, str2));\n}\n\nint strcmp1(char *s, char *t)\n{\n    int i = 0;\n    while (s[i] == t[i])\n    {\n        if (s[i] == '\\0')\n        {\n            return 0;\n        }\n        i++;\n    }\n\n    return s[i] - t[i];\n}\n\nint strcmp2(char *s, char *t)\n{\n    while (*s == *t)\n    {\n        if (*s == '\\0')\n        {\n            return 0;\n        }\n        s++, t++;\n    }\n    return *s - *t;\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#_25","title":"\u4e8c\u7ef4\u6570\u7ec4","text":"<pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    int day_of_year(int, int, int);\n    void month_day(int, int, int*, int *);\n\n    printf(\"2024-03-10: %d\\n\", day_of_year(2024, 3, 10)); //2024-03-10: 70\n\n\n    int month = 0;\n    int day = 0;\n    month_day(2024, 70, &amp;month, &amp; day);\n    printf(\"2024 70, month: %d, day: %d\\n\", month, day); // 2024 70, month: 3, day: 10\n\n}\n\nstatic char daytab[2][13] = {\n    {0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31},\n    {0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31}\n};\n\nint day_of_year(int year, int month, int day) {\n    int i, leap;\n    leap = year % 4 == 0 &amp;&amp; year % 100 != 0 || year % 400 ==0;\n    for(i = 1; i &lt; month; i ++) {\n        day += daytab[leap][i];\n    }\n    return day;\n}\n\nvoid month_day(int year, int yearday, int *pmonth, int *pday) {\n    int i, leap;\n    leap = year % 4 == 0 &amp;&amp; year % 100 != 0 || year % 400 ==0;\n    for(i = 1; yearday &gt; daytab[leap][i]; i ++) {\n        yearday -= daytab[leap][i];\n    }\n    *pmonth = i;\n    *pday = yearday;\n}\n</code></pre> <p>\u5728 C \u8bed\u8a00\u4e2d\uff0c\u4e8c\u7ef4\u6570\u7ec4\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u4e00\u7ef4\u6570\u7ec4\uff0c\u5b83\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u4e5f\u662f\u4e00\u4e2a\u6570\u7ec4\u3002\u53ef\u4ee5\u8868\u793a\u4e3a     <code>daytab[i][j]</code>    // <code>[row][col]</code></p> <p>\u5982\u679c\u5c06\u4e8c\u7ef4\u6570\u636e\u4f5c\u6587\u53c2\u6570\u4f20\u9012\u7ed9\u51fd\u6570 f\uff0c\u90a3\u4e48 f \u7684\u58f0\u660e\u53ef\u4ee5\u5199\u6210\u5982\u4e0b\u5f62\u5f0f\u3002 <pre><code>f(int daytab[2][13]) {}\n\nf(int daytab[][13]) {}\n\nf(int (*daytab)[13]) {}\n</code></pre></p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f <code>[]</code> \u7684\u4f18\u5148\u7ea7\u9ad8\u4e8e <code>*</code>\u3002\u6240\u6709\u4e0b\u9762\u4e24\u79cd\u58f0\u660e\u65b9\u5f0f\u662f\u6709\u533a\u522b\u7684\uff1a - <code>int (*daytab)[13]</code> \u8868\u793a daytab \u662f\u4e00\u4e2a\u6307\u9488\uff0c\u6307\u5411\u5305\u542b 13 \u4e2a\u6574\u578b\u5143\u7d20\u7684\u6570\u7ec4\u3002\u6307\u5411\u6570\u7ec4\u7684\u6307\u9488\u3002 - <code>int *daytab[13]</code>  \u8868\u793a daytab \u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u5185\u5305\u542b 13 \u4e2a\u5143\u7d20\uff0c\u5176\u4e2d\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u662f\u4e00\u4e2a\u6307\u5411 int \u7c7b\u578b\u7684\u6307\u9488\u3002\u6307\u9488\u6570\u7ec4\u3002</p> <p><code>int a[10][20]</code> <code>int *b[10]</code> \u8fd9\u91cc a \u662f\u4e00\u4e2a\u771f\u6b63\u7684\u4e8c\u7ef4\u6570\u7ec4\uff0c\u5206\u914d\u4e86 200 \u4e2a int \u957f\u5ea6\u7684\u5b58\u50a8\u7a7a\u95f4\u3002 \u800c b \u4ec5\u4ec5\u5206\u914d\u4e86 10 \u4e2a\u6307\u9488\u3002</p> <p>main \u51fd\u6570\u6253\u5370\u53c2\u6570\u3002 <pre><code>#include &lt;stdio.h&gt;\n\nint main(int argc, char *argv[]) {\n    // int i;\n\n    // for(int i = 1; i &lt; argc; i ++) {\n    //     printf(\"%s%s\", argv[i], (i &lt; argc - 1) ? \" \" : \"\");\n    // }\n    // printf(\"\\n\");\n    // return 0;\n    // ---------------------------------------------------------\n    // while(--argc &gt; 0) {\n    //     printf(\"%s%s\", *++argv, (argc &gt; 1) ? \" \": \"\");\n    // }\n    // printf(\"\\n\");\n    // return 0;\n    // ---------------------------------------------------------\n    while(--argc &gt; 0) {\n        printf((argc &gt; 1) ? \"%s \" : \"%s\", *++argv);\n    }\n    printf(\"\\n\");\n    return 0;\n}\n</code></pre></p> <p>\u76ee\u524d\u6240\u6709\u9047\u5230\u7684\u6307\u9488\u7684\u5f62\u5f0f <pre><code>#include &lt;stdio.h&gt;\n\nint main(int argc, char **argv) {\n\n    while(argc-- &gt; 0) {\n        printf((argc &gt; 0 ? \"%s \" : \"%s\\n\"), *(argv++));\n    }\n\n    char *pmsg = \"hello\";\n    char amsg[] = {'h', 'e', 'l', 'l', 'o', '\\0'};\n    printf(\"pmsg: %s, amsg: %s\\n\", pmsg, amsg);        // pmsg: hello, amsg: hello\n    printf(\"pmsg: %c, amsg: %c\\n\", *pmsg, *amsg);      // pmsg: h, amsg: h\n    printf(\"pmsg: %c, amsg: %c\\n\", pmsg[0], amsg[0]);  // pmsg: h, amsg: h\n\n    char *p[] = {\n        \"hello\",\n        \"nihao\"\n    };\n    char a[][6] = {\n        {'h', 'e', 'l', 'l', 'o', '\\0'},\n        {'n', 'i', 'h', 'a', 'o', '\\0'}\n    };\n    printf(\"a: %s, p: %s\\n\", *(p+1), a[1]);     // a: nihao, p: nihao\n    printf(\"a: %c, p: %c\\n\", **(p+1), *a[1]);   // a: n, p: n\n    printf(\"a: %c, p: %c\\n\", *p[1], a[1][0]);   // a: n, p: n\n}\n</code></pre></p> <p>\u8fd0\u884c\u8f93\u51fa\u7ed3\u679c <pre><code># ./a.out hello nihao\n./a.out hello nihao\npmsg: hello, amsg: hello\npmsg: h, amsg: h\npmsg: h, amsg: h\na: nihao, p: nihao\na: n, p: n\na: n, p: n\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#_26","title":"\u6307\u5411\u51fd\u6570\u7684\u6307\u9488","text":""},{"location":"ThreeMountains/OS/C/#_27","title":"\u590d\u6742\u7684\u6307\u9488\u58f0\u660e","text":""},{"location":"ThreeMountains/OS/C/#_28","title":"\u7ed3\u6784\u4f53","text":"<p>\u4e00\u4e9b\u7b80\u5355\u7684\u4f7f\u7528\u793a\u4f8b\uff1a <pre><code>#include &lt;stdio.h&gt;\n#define XMAX 100\n#define YMAX 100\n\nstruct point\n{\n    int x;\n    int y;\n};\n\nstruct rect\n{\n    struct point pt1;\n    struct point pt2;\n};\n\nint main()\n{\n    struct rect screen;\n    struct point middle;\n    struct point makepoint(int, int);\n\n    screen.pt1 = makepoint(0, 0);\n    screen.pt2 = makepoint(XMAX, YMAX);\n    middle = makepoint((screen.pt1.x + screen.pt2.x) / 2,\n                       (screen.pt1.y + screen.pt2.y) / 2);\n\n    printf(\"middle x: %d, y: %d\\n\", middle.x, middle.y);\n}\n\nstruct point makepoint(int x, int y)\n{\n    struct point temp;\n    temp.x = x;\n    temp.y = y;\n    return temp;\n};\n\nstruct point addpoint(struct point p1, struct point p2)\n{\n    p1.x += p2.x;\n    p1.y += p2.y;\n    return p1;\n}\n\nint ptinrect(struct point p, struct rect r)\n{\n    return p.x &gt;= r.pt1.x &amp;&amp; p.x &lt; r.pt2.x &amp;&amp; p.y&gt;= r.pt1.y &amp;&amp; p.y &lt; r.pt2.y;\n}\n</code></pre></p> <p>\u5982\u679c\u4f20\u9012\u7ed9\u51fd\u6570\u7684\u7ed3\u6784\u5f88\u5927\uff0c\u4f7f\u7528\u6307\u9488\u65b9\u5f0f\u6bd4\u590d\u5236\u6574\u4e2a\u7ed3\u6784\u7684\u6548\u7387\u8981\u9ad8\u3002C \u8bed\u8a00\u4e3a\u503c\u4f20\u9012\u3002 <pre><code>struct point *pp;\n</code></pre> pp \u6307\u5411\u4e00\u4e2a point \u7ed3\u6784\uff0c<code>*pp</code> \u5373\u4e3a\u8be5\u7ed3\u6784\uff0c<code>(*pp).x</code> \u548c <code>(*pp).y</code> \u5219\u662f\u7ed3\u6784\u6210\u5458\u3002<code>pp-&gt;x</code> \u548c <code>pp-&gt;y</code> \u4e5f\u662f\u7ed3\u6784\u6210\u5458\u3002 <pre><code>#include &lt;stdio.h&gt;\n\nstruct point {\n    int x;\n    int y;\n} origin, *pp;\n\nint main() {\n    origin.x = 100;\n    origin.y = 100;\n\n    pp = &amp;origin;\n    printf(\"origin is (%d, %d)\\n\", (*pp).x, (*pp).y);\n    printf(\"origin is (%d, %d)\\n\", pp-&gt;x, pp-&gt;y);\n}\n</code></pre></p> <p>\u4e0b\u9762\u56db\u4e2a\u8868\u8fbe\u5f0f\u662f\u7b49\u4ef7\u7684\u3002 <pre><code>struct rect r, *rp = &amp;r;\n\nr.pt1.x;\nrp-&gt;pt1.x;\n(r.pt1).x;\n(rp-&gt;pt1).x;\n</code></pre></p> <p>\u5728\u6240\u6709\u7684\u8fd0\u7b97\u7b26\u4e2d\u7ed3\u6784\u8fd0\u7b97\u7b26 <code>.</code> \u548c <code>-&gt;</code>\u3001\u7528\u4e8e\u51fd\u6570\u8c03\u7528\u7684\u201c()\u201d \u4ee5\u53ca\u7528\u4e8e\u4e0b\u6807\u7684\u201c[]\u201d \u7684\u4f18\u5148\u7ea7\u6700\u9ad8\u3002 <pre><code>struct {\n    int len;\n    char *str;\n} *p;\n\n++p.len // \u5c06\u589e\u52a0 len \u7684\u503c\n*p-&gt;str  // \u8bfb\u53d6\u7684\u662f str \u6240\u6307\u7684\u5bf9\u8c61\u7684\u503c\n*p-&gt;str++ // \u5148\u8bfb\u53d6 str \u6240\u6307\u7684\u5bf9\u8c61\u7684\u503c\uff0c\u7136\u540e\u518d\u5c06 str \u52a0 1\uff0c\u4e0d\u662f str \u7684\u503c\u52a0 1\n(*p-&gt;str)++ // \u5148\u8bfb\u53d6 str \u6240\u6307\u7684\u5bf9\u8c61\u7684\u503c\uff0c\u7136\u540e\u518d\u5c06 str \u6240\u6307\u5411\u7684\u503c\u52a0 1\n*p++-&gt;str // \u5148\u8bfb\u53d6 str \u6307\u5411\u7684\u5bf9\u8c61\u7684\u503c\uff0c\u7136\u540e\u518d\u5c06 p \u52a0 1\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#_29","title":"\u8f93\u5165\u8f93\u51fa","text":"<p>\u4e0b\u9762\u7684\u7a0b\u5e8f\u4ece\u6807\u51c6\u8f93\u5165\u4e2d\u4e00\u4e2a\u4e00\u4e2a\u8bfb\u53d6\u5b57\u7b26\uff0c\u7136\u540e\u5c06\u5b57\u7b26\u4e00\u4e2a\u4e00\u4e2a\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\u3002 <pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    int c;\n\n    while((c = getchar()) != EOF) \n        printf(\"%c\", c);\n\n    return 0;\n}\n</code></pre></p> <p><code>./a.out</code> \u76f4\u63a5\u7b49\u5f85\u8f93\u5165\uff0c\u76f4\u5230\u9047\u5230\u6362\u884c\u6216\u8005 EOF\uff08Ctrl+D\uff09\u3002 <code>./a.out &lt; filename</code> \u4f7f\u7528\u91cd\u5b9a\u5411\u8f93\u51fa\u6587\u4ef6\u7684\u5185\u5bb9\u3002\u6ce8\u610f <code>&lt; filename</code> \u5e76\u4e0d\u5305\u542b\u5728 argv \u7684\u547d\u4ee4\u884c\u53c2\u6570\u4e2d\u3002 <code>echo \"hello world\" | ./a.out</code> \u4f7f\u7528\u7ba1\u9053\u8f93\u51fa\u4e0a\u4e00\u4e2a\u7a0b\u5e8f\u7684\u8f93\u51fa\u3002\u6ce8\u610f <code>echo \"hello world\" |</code> \u5e76\u4e0d\u5305\u542b\u5728 argv \u7684\u547d\u4ee4\u884c\u53c2\u6570\u4e2d\u3002</p>"},{"location":"ThreeMountains/OS/C/#_30","title":"\u4e60\u9898\u7b54\u6848","text":""},{"location":"ThreeMountains/OS/C/#1-1","title":"1-1","text":"<p>\u5728\u4f60\u81ea\u5df1\u7684\u7cfb\u7edf\u4e2d\u8fd0\u884c\u201chello, world\u201d\u7a0b\u5e8f\u3002\u518d\u6709\u610f\u53bb\u6389\u7a0b\u5e8f\u4e2d\u7684\u90e8\u5206 \u5185\u5bb9\uff0c\u770b\u770b\u4f1a\u5f97\u5230\u4ec0\u4e48\u51fa\u9519\u4fe1\u606f\u3002 \u89e3\uff1a \u52a0\u4e0a <code>\\n</code> \u5b57\u7b26\u8868\u793a\u6362\u884c\u3002 <pre><code>// p1-1.c\n#include &lt;stdio.h&gt;\n\nint main() {\n    printf(\"hello world!\\n\");\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-2","title":"1-2","text":"<p>\u505a\u4e2a\u5b9e\u9a8c\uff0c\u5f53 printf \u51fd\u6570\u7684\u53c2\u6570\u5b57\u7b26\u4e32\u4e2d\u5305\u542b\\c\uff08\u5176\u4e2d c \u662f\u4e0a\u9762\u7684\u8f6c\u4e49 \u5b57\u7b26\u5e8f\u5217\u4e2d\u672a\u66fe\u5217\u51fa\u7684\u67d0\u4e00\u4e2a\u5b57\u7b26\uff09\u65f6\uff0c\u89c2\u5bdf\u4e00\u4e0b\u4f1a\u51fa\u73b0\u4ec0\u4e48\u60c5\u51b5\u3002 \u89e3\uff1a \u8f6c\u4e49\u5b57\u7b26 <code>\\c</code> \u662f\u672a\u5b9a\u4e49\u7684\uff0c\u5176\u884c\u4e3a\u662f\u672a\u5b9a\u4e49\u7684\u3002<code>\\7</code> \u5219\u662f\u4e00\u58f0\u8702\u9e23\u3002 <pre><code>// p1-2.c\n#include &lt;stdio.h&gt;\n\nint main() {\n    printf(\"\\chello world!\\n\"); // chello world\n    printf(\"\\7hello world!\\n\"); // hello world\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-3","title":"1-3","text":"<p>\u4fee\u6539\u6e29\u5ea6\u8f6c\u6362\u7a0b\u5e8f\uff0c\u4f7f\u4e4b\u80fd\u5728\u8f6c\u6362\u8868\u7684\u9876\u90e8\u6253\u5370\u4e00\u4e2a\u6807\u9898\u3002 \u534e\u6c0f\u6e29\u5ea6\u8f6c\u6362\u4e3a\u6444\u6c0f\u6e29\u5ea6\u548c\u7684\u8f6c\u6362\u516c\u5f0f\u5982\u4e0b\uff1a <code>\u2103=(5/9)(\u2109-32)</code>\u3002\u6e90\u7a0b\u5e8f\uff1a <pre><code>#include &lt;stdio.h&gt;\n#define UPPER 300\n#define STEP 20\n\nint main() {\n    for(int i = 0; i &lt;= UPPER; i += STEP) {\n    \u00a0 \u00a0 printf(\"%3d\\t%7.2f\\n\", i, (i - 32) * 5.0 / 9);\n    }\n}\n</code></pre> \u89e3\uff1a <pre><code>// p1-3.c\n#include &lt;stdio.h&gt;\n#define UPPER 300\n#define STEP 20\n\nint main() {\n    printf(\"Fahr\\tCelsius\\n\");\n    for(int i = 0; i &lt;= UPPER; i += STEP) {\n        printf(\"%3d\\t%7.2f\\n\", i, (i - 32) * 5.0 / 9);\n    }\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-4","title":"1-4","text":"<p>\u7f16\u5199\u4e00\u4e2a\u7a0b\u5e8f\u6253\u5370\u6444\u6c0f\u6e29\u5ea6\u8f6c\u6362\u4e3a\u76f8\u5e94\u534e\u6c0f\u6e29\u5ea6\u7684\u8f6c\u6362\u8868\u3002 \u89e3\uff1a \u6444\u6c0f\u6e29\u5ea6\u8f6c\u6362\u4e3a\u534e\u6c0f\u6e29\u5ea6\u7684\u516c\u5f0f\uff1a<code>\u2109=\u2103(9/5)+32</code>\u3002 <pre><code>// p1-4.c\n#include &lt;stdio.h&gt;\n#define UPPER 300\n#define STEP 20\n\nint main() {\n    printf(\"Celsius\\t   Fahr\\n\");\n    for(int i = 0; i &lt;= UPPER; i += STEP) {\n        printf(\"%7d\\t%7.0f\\n\", i, i * 9.0 / 5 + 32);\n    }\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-5","title":"1-5","text":"<p>\u4fee\u6539\u6e29\u5ea6\u8f6c\u6362\u7a0b\u5e8f\uff0c\u8981\u6c42\u4ee5\u9006\u5e8f\uff08\u5373\u6309\u7167\u4ece 300 \u5ea6\u5230 0 \u5ea6\u7684\u987a\u5e8f\uff09\u6253\u5370\u6e29\u5ea6\u8f6c\u6362\u8868\u3002 \u89e3\uff1a <pre><code>// p1-5.c\n#include &lt;stdio.h&gt;\n#define UPPER 300\n#define STEP 20\n\nint main() {\n    for(int i = UPPER; i &gt;= 0; i-=STEP) {\n        printf(\"%3d\\t%7.2f\\n\", i, (i - 32) * 5.0 / 9);\n    }\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-6","title":"1-6","text":"<p>\u9a8c\u8bc1\u8868\u8fbe\u5f0f getchar() != EOF \u7684\u503c\u662f 0 \u8fd8\u662f 1\u3002 \u89e3\uff1a \u8868\u8fbe\u5f0f <code>c = getchar() != EOF</code> \u4e0e\u8868\u8fbe\u5f0f <code>c = (getchar() != EOF)</code> \u662f\u7b49\u4ef7\u7684\u3002 <pre><code>// p1-6.c\n#include &lt;stdio.h&gt;\n\nint main() {\n    int c;\n    while((c = getchar()) != EOF) {\n        purchar(c);\n    }\n    printf(\"%d - at EOF\\n\", c);  // ctrl + D \u7ed3\u675f\u7a0b\u5e8f\u65f6\u6253\u5370 0 - at EOF\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-7","title":"1-7","text":"<p>\u7f16\u5199\u4e00\u4e2a\u6253\u5370 EOF \u503c\u7684\u7a0b\u5e8f\u3002 \u89e3\uff1a <code>EOF</code> \u5728 <code>stdio.h</code> \u4e2d\u88ab\u5b9a\u4e49\uff0c\u4e00\u822c\u5b9a\u4e49\u4e3a <code>-1</code>\uff0c<code>#define EOF (-1)</code>\u3002 <pre><code>// p1-7.c\n#include &lt;stdio.h&gt;\n\nint main() {\n    printf(\"%d\\n\", EOF);\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-8","title":"1-8","text":"<p>\u7f16\u5199\u4e00\u4e2a\u7edf\u8ba1\u7a7a\u683c\u3001\u5236\u8868\u7b26\u4e0e\u6362\u884c\u7b26\u4e2a\u6570\u7684\u7a0b\u5e8f\u3002 \u89e3\uff1a <pre><code>// p1-8.c\n#include &lt;stdio.h&gt;\n\nint main() {\n    int ws = 0, tab = 0, nl = 0;\n\n    int c;\n    while((c = getchar()) != EOF) {\n        switch(c) {\n            case '\\n':\n                nl ++;\n                break;\n            case '\\t':\n                tab ++;\n                break;\n            case ' ':\n                ws ++;\n                break;\n            default:\n                break;\n        }\n    }\n\n    printf(\"ws: %d, tab: %d, nl: %d\\n\", ws, tab, nl);\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-9","title":"1-9","text":"<p>\u7f16\u5199\u4e00\u4e2a\u5c06\u8f93\u5165\u590d\u5236\u5230\u8f93\u51fa\u7684\u7a0b\u5e8f\uff0c\u5e76\u5c06\u5176\u4e2d\u8fde\u7eed\u7684\u591a\u4e2a\u7a7a\u683c\u7528\u4e00\u4e2a\u7a7a\u683c\u4ee3\u66ff\u3002 \u89e3\uff1a <pre><code>// p1-9.c\n#include &lt;stdio.h&gt;\n\nint main() {\n    int c;\n    int ws = 0;\n\n    while((c = getchar()) != EOF) {\n        if(c == ' ') {\n            if(ws == 0) {\n                putchar(c);\n                ws = 1;\n            }\n        } else {\n            putchar(c);\n            ws = 0;\n        }\n    }\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-10","title":"1-10","text":"<p>\u7f16\u5199\u4e00\u4e2a\u5c06\u8f93\u5165\u590d\u5236\u5230\u8f93\u51fa\u7684\u7a0b\u5e8f\uff0c\u5e76\u5c06\u5176\u4e2d\u7684\u5236\u8868\u7b26\u66ff\u6362\u4e3a\\t\uff0c\u628a\u56de\u9000\u7b26 \u66ff\u6362\u4e3a\\b\uff0c\u628a\u53cd\u659c\u6760\u66ff\u6309\u4e3a\\\u3002\u8fd9\u6837\u53ef\u4ee5\u5c06\u5236\u8868\u7b26\u548c\u56de\u9000\u7b26\u4ee5\u53ef\u89c1\u7684\u65b9\u5f0f\u663e\u793a\u51fa\u6765\u3002 \u89e3\uff1a <pre><code>// p1-10.c\n#include &lt;stdio.h&gt;\n\nint main() {\n    int c;\n\n    while((c = getchar()) != EOF) {\n        if(c == '\\t') {\n            printf(\"\\\\t\");\n        } else if(c == '\\b') {\n            printf(\"\\\\b\");\n        } else if(c == '\\\\') {\n            printf(\"\\\\\\\\\");\n        } else {\n            putchar(c);\n        }\n    }\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-11","title":"1-11","text":"<p>\u4f60\u51c6\u5907\u5982\u4f55\u6d4b\u8bd5\u5355\u8bcd\u8ba1\u6570\u7a0b\u5e8f\uff1f\u5982\u679c\u7a0b\u5e8f\u4e2d\u5b58\u5728\u67d0\u79cd\u9519\u8bef\uff0c\u90a3\u4e48\u4ec0\u4e48\u6837\u7684\u8f93 \u5165\u6700\u53ef\u80fd\u53d1\u73b0\u8fd9\u7c7b\u9519\u8bef\u5462\uff1f \u9996\u5148\u4e00\u4e2a\u7a0b\u5e8f\u7edf\u8ba1\u5b57\u7b26\u3001\u884c\u548c\u5355\u8bcd\u7684\u6570\u91cf\uff0c\u5047\u5b9a\u5355\u8bcd\u7684\u5b9a\u4e49\u4e3a\u4e0d\u5305\u62ec\u7a7a\u683c\u3001\u5236\u8868\u7b26\u6216\u6362\u884c\u7b26\u7684\u5b57\u7b26\u5e8f\u5217\u3002 <pre><code>#include &lt;stdio.h&gt;\n\n#define IN 1\n#define OUT 0\n\nint main() {\n    int c, nc, nw, nl, state;\n\n    nc = nw = nl = 0;\n    state = OUT;\n    while((c = getchar()) != EOF) {\n        nc ++;\n        if(c == '\\n') {\n            nl ++;\n        } \n        if(c == '\\t' || c == ' ' || c == '\\n') {\n            state = OUT;\n        } else if(state == OUT) {\n            state = IN;\n            nw ++;\n        }\n    }\n    printf(\"nc: %d nw: %d nl: %d\\n\", nc, nw, nl);\n}\n</code></pre> \u89e3\uff1a \u6d4b\u8bd5\u7528\u4f8b\u7684\u9009\u53d6\u95ee\u9898\uff0c\u9664\u4e00\u822c\u5b57\u7b26\u4e32\u5916\uff0c\u8003\u8651\u8fb9\u754c\u503c\u3001\u975e\u6cd5\u503c\u3001\u6781\u7aef\u503c\u7684\u60c5\u51b5\u3002 1. \u6ca1\u6709\u8f93\u5165\u3002 2. \u5168\u90e8\u7a7a\u683c\u3002</p>"},{"location":"ThreeMountains/OS/C/#1-12","title":"1-12","text":"<p>\u7f16\u5199\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u4ee5\u6bcf\u884c\u4e00\u4e2a\u5355\u8bcd\u7684\u5f62\u5f0f\u6253\u5370\u5176\u8f93\u5165\u3002 \u89e3\uff1a <pre><code>// p1-12.c\n#include &lt;stdio.h&gt;\n\n#define IN 1\n#define OUT 0\n\nint main() {\n    int c, state;\n\n    state = OUT;\n    while((c = getchar()) != EOF) {\n        if(c == '\\t' || c == ' ' || c == '\\n') {\n            if(state == IN) {\n                state = OUT;\n                putchar('\\n');\n            }\n        } else {\n            state = IN;\n            putchar(c);\n        }\n    }\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-13","title":"1-13","text":"<p>\u7f16\u5199\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u6253\u5370\u8f93\u5165\u4e2d\u5355\u8bcd\u957f\u5ea6\u7684\u76f4\u65b9\u56fe\u3002\u6c34\u5e73\u65b9\u5411\u7684\u76f4\u65b9\u56fe\u6bd4\u8f83\u5bb9\u6613\u7ed8\u5236\uff0c\u5782\u76f4\u65b9\u5411\u7684\u76f4\u65b9\u56fe\u5219\u8981\u56f0\u96be\u4e9b\u3002 \u89e3\uff1a <pre><code>// p1-13.c\n#include &lt;stdio.h&gt;\n\n#define IN 1\n#define OUT 0\n#define MAXWORD 20\n\nint wordLen[MAXWORD];\n\nint\nmain()\n{\n  int state = OUT;\n  int len = 0;\n  int overflow = 0;\n\n  // \u5355\u8bcd\u8ba1\u6570\u903b\u8f91\n  int c;\n  while ((c = getchar()) != EOF) {\n    if (c == '\\n' || c == '\\t' || c == ' ') {\n      if (state == IN) {\n        if (len &lt;= MAXWORD) {\n          wordLen[len - 1]++;\n        } else {\n          overflow++;\n        }\n      }\n      len = 0;\n      state = OUT;\n    } else {\n      if (state == OUT) {\n        state = IN;\n        len++;\n      } else {\n        len++;\n      }\n    }\n  }\n\n  if (state == IN) {\n    if (len &lt;= MAXWORD) {\n      wordLen[len - 1]++;\n    } else {\n      overflow++;\n    }\n  }\n\n  // \u6253\u5370\u6c34\u5e73\u65b9\u5411\n  for (int i = 0; i &lt; sizeof wordLen / sizeof(int); i++) {\n    printf(\"%2d : \", i + 1);\n    for (int j = 0; j &lt; wordLen[i]; j++) {\n      putchar('*');\n    }\n    printf(\" %d\\n\", wordLen[i]);\n  }\n\n  if (overflow &gt; 0) {\n    printf(\"There ard %d words &gt; %d\\n\", overflow, MAXWORD);\n  }\n\n  // \u6253\u5370\u5782\u76f4\u65b9\u5411\n  int maxvalue = 0;\n  for (int i = 0; i &lt; MAXWORD; i++) {\n    if (wordLen[i] &gt; maxvalue) {\n      maxvalue = wordLen[i];\n    }\n  }\n\n  for (int i = maxvalue + 1; i &gt; 0; i--) {\n    for (int j = 0; j &lt; MAXWORD; j++) {\n      if (wordLen[j] == i - 1) {\n        printf(\"%3d\", i - 1);\n      } else if (wordLen[j] &gt;= i) {\n        printf(\"  *\");\n      } else {\n        printf(\"  \\\\\");\n      }\n    }\n    putchar('\\n');\n  }\n\n  for (int i = 0; i &lt; MAXWORD; i++) {\n    printf(\"%3d\", i + 1);\n  }\n\n  putchar('\\n');\n  if (overflow &gt; 0) {\n    printf(\"There ard %d words &gt; %d\\n\", overflow, MAXWORD);\n  }\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-14","title":"1-14","text":"<p>\u7f16\u5199\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u6253\u5370\u8f93\u5165\u4e2d\u5404\u4e2a\u5b57\u7b26\u51fa\u73b0\u9891\u5ea6\u7684\u76f4\u65b9\u56fe\u3002 \u89e3\uff1a \u548c 1-13 \u4e0d\u540c\u7684\u662f\uff0c\u6307\u5b9a\u4e86\u56fe\u8868\u7684\u6700\u5927\u957f\u5ea6\u4e3a 15\u3002 <pre><code>// p1-14.c\n#include &lt;stdio.h&gt;\n#include &lt;ctype.h&gt;\n\n#define MAXHIST 15\n#define MAXCHAR 120\n\nint main() {\n    int c;\n    int len;\n    int maxvalue;\n    int cc[MAXCHAR];\n\n    for(int i = 0; i &lt; MAXCHAR; i ++) {\n        cc[i] = 0;\n    }\n\n    while((c = getchar()) != EOF) {\n        if(c &lt; MAXCHAR) {\n            ++cc[c];\n        }\n    }\n\n    maxvalue = 0;\n    for(int i = 0; i &lt; MAXCHAR; i ++) {\n        if(cc[i] &gt; maxvalue) {\n            maxvalue = cc[i];\n        }\n    }\n\n    for(int i = 1; i &lt; MAXCHAR; i ++) {\n        if(isprint(i)) {\n            printf(\"%5d - %c - %5d : \", i, i, cc[i]);\n        } else {\n            printf(\"%5d -    - %5d : \", i, i, cc[i]);\n        }\n\n        if(cc[i] &gt; 0) {\n            if((len = cc[i] * MAXHIST / maxvalue) &lt;= 0){\n                len = 1;\n            }\n        } else {\n            len = 0;\n        }\n        while(len &gt; 0) {\n            putchar('*');\n            --len;\n        }\n        putchar('\\n');\n    }\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-15","title":"1-15","text":"<p>\u91cd\u65b0\u7f16\u5199 1.2 \u8282\u4e2d\u7684\u6e29\u5ea6\u8f6c\u6362\u7a0b\u5e8f\uff0c\u4f7f\u7528\u51fd\u6570\u5b9e\u73b0\u6e29\u5ea6\u8f6c\u6362\u8ba1\u7b97\u3002 \u89e3\uff1a <pre><code>// p1-15.c\n#include &lt;stdio.h&gt;\n\nfloat ceisius(float);\n\nint main() {\n    for(float i = 0; i &lt; 300; i += 20) {\n        printf(\"%3.0f %6.1f\\n\", i, ceisius(i));\n    }\n}\n\nfloat ceisius(float fahr) {\n    return (5.0 / 9) * (fahr - 32);\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-16","title":"1-16","text":"<p>\u4fee\u6539\u6253\u5370\u6700\u957f\u6587\u672c\u884c\u7684\u7a0b\u5e8f\u7684\u4e3b\u7a0b\u5e8f main\uff0c\u4f7f\u4e4b\u53ef\u4ee5\u6253\u5370\u4efb\u610f\u957f\u5ea6\u7684\u8f93\u5165\u884c\u7684\u957f\u5ea6\uff0c\u5e76\u5c3d\u53ef\u80fd\u591a\u5730\u6253\u5370\u6587\u672c\u3002 \u89e3\uff1a 1. \u5047\u8bbe\u6700\u591a\u6253\u5370 99 \u4e2a\u5b57\u7b26\u3002 <pre><code>// p1-16.c\n#include &lt;stdio.h&gt;\n\n#define MAXLINE 100\n\nint get_line(char *, int);\n\nvoid copy(char *, char *);\n\nint main() {\n\n    char longest[MAXLINE];\n    char line[MAXLINE];\n\n    int max = 0;\n    int len;\n\n    while((len = get_line(line, MAXLINE)) &gt; 0) {\n        if(len &gt; max) {\n            copy(line, longest);\n            max = len;\n        }\n    }\n\n    printf(\"longest line len: %d, content: %s\", max, longest);\n}\n\nvoid copy(char from[], char to[]) {\n    int i = 0;\n    while((to[i] = from[i]) != '\\0') {\n        i ++;\n    }\n}\n</code></pre></p> <pre><code>// get_line.c\n#include &lt;stdio.h&gt;\n\nint get_line(char *line, int lim) {\n    int c;\n    int i = 0, l = 0;\n    while((c = getchar()) != EOF &amp;&amp; c != '\\n') {\n        if(i &lt; lim - 2) {\n            line[i++] = c;\n        }\n\n        l ++;\n    } \n\n    if(c == '\\n') {\n        line[i++] = '\\n';\n        l ++;\n    }\n\n    line[i] = '\\0';\n\n    return l;\n}\n</code></pre>"},{"location":"ThreeMountains/OS/C/#1-17","title":"1-17","text":"<p>\u7f16\u5199\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u6253\u5370\u957f\u5ea6\u5927\u4e8e 80 \u4e2a\u5b57\u7b26\u7684\u6240\u6709\u8f93\u5165\u884c\u3002 \u89e3\uff1a <pre><code>#include &lt;stdio.h&gt;\n\n#define MAXLINE 10\n#define PLEN 15\n\nint get_line(char *, int);\n\nint main() {\n    int len;\n    char line[MAXLINE];\n\n    while((len = get_line(line, MAXLINE)) &gt; 0) {\n        if(len &gt; PLEN) {\n            printf(\"%s\", line);\n        }\n    }\n}\n\nint get_line(char line[], int lim) {\n    int c;\n    int l = 0, i = 0;\n    while((c = getchar()) != EOF &amp;&amp; c != '\\n') {\n        if(l &lt; lim - 2) {\n            line[i++] = c;\n        }\n        l ++;\n    }\n\n    if(c == '\\n') {\n        line[i ++] = c;\n        l ++;\n    }\n\n    line[i] = '\\0';\n    return l;\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-18","title":"1-18","text":"<p>\u7f16\u5199\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u5220\u9664\u6bcf\u4e2a\u8f93\u5165\u884c\u672b\u5c3e\u7684\u7a7a\u683c\u53ca\u5236\u8868\u7b26\uff0c\u5e76\u5220\u9664\u5b8c\u5168\u662f\u7a7a\u683c\u7684\u884c\u3002 \u89e3\uff1a <pre><code>// p1-18.c\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\n#define MAXLINE 100\n\nint get_line(char *, int);\nvoid remove_end_blank(char *, int);\n\nint main() {\n    char line[MAXLINE];\n\n    int len;\n    while((len = get_line(line, MAXLINE)) &gt; 0) {\n        printf(\"str len: %d, str: %s\", strlen(line), line);\n        remove_end_blank(line, MAXLINE);\n        if(line[0] != '\\n') {\n            printf(\"str len: %d, str: %s\", strlen(line), line);\n        }\n    }   \n}\n\nvoid remove_end_blank(char line[], int max) {\n    int i;\n    for(i = 0; i &lt; max &amp;&amp; line[i] != '\\0'; i ++);\n\n    for(i = i - 1; i &gt;= 0 &amp;&amp; (line[i] == '\\t' || line[i] == ' ' || line[i] == '\\n'); i--);\n\n    line[i + 1] = '\\n';\n    line[i + 2] = '\\0';\n}\n\nint get_line(char line[], int max) {\n    int c;\n    int i = 0, l = 0;\n\n\n    while((c = getchar()) != EOF &amp;&amp; c != '\\n') {\n        if(i &lt; max - 2) {\n            line[i++] = c;\n        }\n\n        l++;\n    }\n\n    if(c == '\\n') {\n        line[i++] = '\\n';\n        l++;\n    }\n\n    line[i] = '\\0';\n    return l;\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-19","title":"1-19","text":"<p>\u7f16\u5199\u51fd\u6570 reverse(s)\uff0c\u5c06\u5b57\u7b26\u4e32 s \u4e2d\u7684\u5b57\u7b26\u987a\u5e8f\u98a0\u5012\u8fc7\u6765\u3002\u4f7f\u7528\u8be5\u51fd\u6570 \u7f16\u5199\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u6bcf\u6b21\u98a0\u5012\u4e00\u4e2a\u8f93\u5165\u884c\u4e2d\u7684\u5b57\u7b26\u987a\u5e8f\u3002 \u89e3\uff1a <pre><code>// p1-19.c\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#define MAXLINE 100\n\nint get_line(char *, int);\n\nvoid revese(char *, int);\n\nint main() {\n    char line[MAXLINE];\n    while(get_line(line, MAXLINE) &gt; 0) {\n        printf(\"str len: %d, str: %s\\n\", strlen(line), line);\n        revese(line, MAXLINE);\n        if(line[0] != '\\n') {\n            printf(\"str len: %d, str: %s\", strlen(line), line);\n        }\n    }\n}\n\nvoid revese(char line[], int max) {\n    int i;\n    for(i = 0; i &lt; max &amp;&amp; (line[i] != '\\n') &amp;&amp; line[i] != '\\0'; i ++) {\n        printf(\"%c - %d\\n\", line[i], i);\n    }\n\n    int right = i - 1, left = 0;\n    while(left &lt; right) {\n        int tmp = line[left];\n        line[left] = line[right];\n        line[right] = tmp;\n\n        left ++;ccc \n        right --;\n    }\n}\n\nint get_line(char line[], int max) {\n    int c;\n    int i = 0, l = 0;\n\n    while((c = getchar()) != EOF &amp;&amp; c != '\\n') {\n        if(i &lt; max - 2) {\n            line[i++] = c;\n        }\n        l++;\n    }\n\n    if(c == '\\n') {\n        line[i] = '\\n';\n        l ++;\n    }\n\n    line[i] = '\\0';\n    return l;\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/C/#1-23","title":"1-23","text":"<p>\u7f16\u5199\u4e00\u4e2a\u5220\u9664 C \u8bed\u8a00\u7a0b\u5e8f\u4e2d\u6240\u6709\u7684\u6ce8\u91ca\u8bed\u53e5\u3002\u8981\u6b63\u786e\u5904\u7406\u5e26\u5f15\u53f7\u7684\u5b57\u7b26\u4e32\u4e0e \u5b57\u7b26\u5e38\u91cf\u3002\u5728 C \u8bed\u8a00\u4e2d\uff0c\u6ce8\u91ca\u4e0d\u5141\u8bb8\u5d4c\u5957\u3002 \u89e3\uff1a \u8981\u5904\u7406\u51e0\u79cd\u60c5\u51b5\uff1a   </p> <ul> <li><code>// xxx</code> \u76f4\u5230\u884c\u7ed3\u675f\uff0c\u6216\u8005\u6587\u4ef6\u7ed3\u675f\u3002  </li> <li><code>\\* *\\</code>  \u591a\u884c\u6ce8\u91ca\u3002  </li> <li><code>'xxx // xxx \\' xx  '</code> \u5f15\u53f7\u5185\u7684\u5185\u5bb9\u539f\u6837\u8f93\u51fa\u3002  </li> <li><code>\"xxx // xxx \\\" xx \"</code>  \u5f15\u53f7\u5185\u7684\u5185\u5bb9\u539f\u6837\u8f93\u51fa\u3002  </li> </ul> <pre><code>// p1-23.c\n#include &lt;stdio.h&gt;\n\nvoid echo_quote(int);\n\nint main() {\n    printf(\"hello \\\" world!\\n\");\n    printf(\"// helloworld /* nihaos */ \\n\");\n    int c;\n    // hello world\n    /*\n        hello world // \n        ' '\n        \"hello world\"\n    */\n    int d;\n    while((c = getchar()) != EOF) {\n        if(c == '/') {\n            if((d = getchar()) == '*') {\n                c = getchar();\n                d = getchar();\n                while(c != '*' || d != '/') {\n                    c = d;\n                    d = getchar();\n                }\n            } else if(d == '/') {\n                while((c = getchar()) != EOF &amp;&amp; c != '\\n')\n                    ;\n                if(c == '\\n') {\n                    putchar(c);\n                }\n            } else {\n                putchar(c);\n                putchar(d);\n            }\n        }  else if(c == '\\'' || c == '\"') {\n            echo_quote(c);\n        } else {\n            putchar(c);\n        }\n    }\n}\n\nvoid echo_quote(int c) {\n    int d;\n    putchar(c);\n\n    while((d = getchar()) != c) {\n        putchar(d);\n        if(d == '\\\\') {\n            putchar(getchar());\n        }\n    }\n\n    putchar(d);\n}\n</code></pre>"},{"location":"ThreeMountains/OS/OS%20Tips/","title":"OS Tips","text":"","tags":["OS","C"]},{"location":"ThreeMountains/OS/OS%20Tips/#c","title":"C \u8bed\u8a00\u5230\u53ef\u6267\u884c\u6587\u4ef6\u7684\u6b65\u9aa4","text":"<p><pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    printf(\"hello world!\\n\");\n}\n</code></pre> \u7f16\u8bd1\u6210\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u7136\u540e\u6267\u884c\uff1a <pre><code># gcc hello.c -o hello\n# ./hello\nhello world!\n</code></pre></p> <p>GCC \u7f16\u8bd1\u5668\u9a71\u52a8\u7a0b\u5e8f\u8bfb\u53d6\u6e90\u7a0b\u5e8f\u6587\u4ef6 <code>hello.c</code>\uff0c\u5e76\u628a\u5b83\u7ffb\u8bd1\u6210\u4e00\u4e2a\u53ef\u6267\u884c\u76ee\u6807\u6587\u4ef6 <code>hello</code>\u3002\u8fd9\u4e2a\u7ffb\u8bd1\u8fc7\u7a0b\u53ef\u5206\u4e3a\u56db\u4e2a\u9636\u6bb5\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u6267\u884c\u8fd9\u56db\u4e2a\u9636\u6bb5\u7684\u7a0b\u5e8f\uff08\u9884\u5904\u7406\u5668\u3001\u7f16\u8bd1\u5668\u3001\u6c47\u7f16\u5668\u548c\u94fe\u63a5\u5668\uff09\u4e00\u8d77\u6784\u6210\u4e86\u7f16\u8bd1\u7cfb\u7edf\uff08compilation system\uff09\u3002 </p>","tags":["OS","C"]},{"location":"ThreeMountains/OS/OS%20Tips/#_1","title":"\u9884\u5904\u7406\u9636\u6bb5","text":"<p>\u9884\u5904\u7406\u5668 cpp \u6839\u636e\u4ee5\u5b57\u7b26 <code>#</code> \u5f00\u5934\u7684\u547d\u4ee4\uff0c\u4fee\u6539\u539f\u59cb\u7684 C \u7a0b\u5e8f\u3002\u6bd4\u5982 <code>hello.c</code> \u4e2d\u7684\u7b2c\u4e00\u884c\u7684 <code>#include &lt;stdio.h&gt;</code> \u544a\u8bc9\u9884\u5904\u7406\u5668\u8bfb\u53d6\u7cfb\u7edf \u5934\u6587\u4ef6 <code>stdio.h</code> \u7684\u5185\u5bb9\uff0c\u5e76\u628a\u5b83\u76f4\u63a5\u63d2\u5165\u7a0b\u5e8f\u6587\u672c\u4e2d\u3002\u7ed3\u679c\u5c31\u5f97\u5230\u53e6\u4e00\u4e2a C \u7a0b\u5e8f\uff0c\u901a\u5e38\u4ee5 <code>.i</code> \u4f5c\u4e3a\u6587\u4ef6\u7684\u6269\u5c55\u540d\u3002</p> <p>\u53ea\u8fdb\u884c\u81f3\u9884\u5904\u7406\u9636\u6bb5\u7684\u547d\u4ee4\uff0c\u5982\u679c\u4e0d\u52a0 <code>-o</code> \u9009\u9879\u7684\u8bdd\u76f4\u63a5\u8f93\u51fa\u5230\u63a7\u5236\u53f0\u800c\u4e0d\u662f <code>hello.i</code>\u3002     <pre><code>gcc -E hello.c -o hello.i\n</code></pre></p>","tags":["OS","C"]},{"location":"ThreeMountains/OS/OS%20Tips/#_2","title":"\u7f16\u8bd1\u9636\u6bb5","text":"<p>\u7f16\u8bd1\u5668 ccl \u5c06\u6587\u672c\u6587\u4ef6\u7ffb\u8bd1\u6210\u6587\u672c\u6587\u4ef6 <code>hello.s</code>\uff0c\u5b83\u5305\u542b\u4e00\u4e2a\u6c47\u7f16\u7a0b\u5e8f\u3002</p> <p>\u53ea\u8fdb\u884c\u81f3\u7f16\u8bd1\u9636\u6bb5\u7684\u547d\u4ee4\uff0c\u6b64\u65f6 <code>-o</code> \u662f\u53ef\u9009\u7684\uff0c\u9ed8\u8ba4\u4f1a\u751f\u6210\u4e00\u4e2a <code>hello.s</code> \u6587\u4ef6\u3002     <pre><code>gcc -S hello.c|hello.i [-o hello.s]\n</code></pre></p>","tags":["OS","C"]},{"location":"ThreeMountains/OS/OS%20Tips/#_3","title":"\u6c47\u7f16\u9636\u6bb5","text":"<p>\u63a5\u4e0b\u6765\uff0c\u6c47\u7f16\u5668 as \u5c06 <code>hello.s</code> \u7ffb\u8bd1\u6210\u673a\u5668\u8bed\u8a00\u6307\u4ee4\uff0c\u628a\u8fd9\u4e9b\u6307\u4ee4\u6253\u5305\u6210\u4e00\u79cd\u53eb\u505a\u53ef\u91cd\u5b9a\u4f4d\u76ee\u6807\u7a0b\u5e8f\uff08relocatable object program\uff09\u7684\u683c\u5f0f\uff0c \u5e76\u5c06\u7ed3\u679c\u4fdd\u5b58\u5728\u6587\u4ef6 <code>hello.o</code> \u4e2d\u3002</p> <p>\u53ea\u8fdb\u884c\u81f3\u6c47\u7f16\u9636\u6bb5\u7684\u547d\u4ee4\uff0c\u6b64\u65f6 <code>-o</code> \u9009\u9879\u662f\u53ef\u9009\u7684\uff0c\u9ed8\u8ba4\u4f1a\u751f\u6210\u4e00\u4e2a<code>hello.o</code> \u6587\u4ef6\u3002     <pre><code>gcc -c hello.c|hello.i|hello.s [-o hello.o]\n</code></pre></p>","tags":["OS","C"]},{"location":"ThreeMountains/OS/OS%20Tips/#_4","title":"\u94fe\u63a5\u9636\u6bb5","text":"<p><code>hello</code> \u7a0b\u5e8f\u8c03\u7528\u4e86 <code>printf</code> \u51fd\u6570\uff0c\u5b83\u662f\u6807\u51c6 C \u5e93\u4e2d\u7684\u51fd\u6570\u3002<code>printf</code> \u51fd\u6570\u5b58\u5728\u4e8e\u4e00\u4e2a\u540d\u4e3a <code>printf.o</code> \u7684\u5355\u72ec\u7684\u9884\u7f16\u8bd1\u597d\u4e86\u7684\u76ee\u6807\u6587\u4ef6\u4e2d\uff0c\u800c\u8fd9\u4e2a \u6587\u4ef6\u5fc5\u987b\u4ee5\u67d0\u79cd\u65b9\u5f0f\u5408\u5e76\u5230\u6211\u4eec\u7684 <code>hello.o</code> \u7a0b\u5e8f\u4e2d\u3002\u94fe\u63a5\u5668 <code>ld</code> \u5c31\u8d1f\u8d23\u5904\u7406\u8fd9\u79cd\u5408\u5e76\uff0c\u7ed3\u679c\u5c31\u662f\u5f97\u5230 <code>hello</code> \u6587\u4ef6\uff0c\u5b83\u662f\u4e00\u4e2a\u53ef\u6267\u884c\u76ee\u6807\u6587\u4ef6\uff0c\u53ef\u4ee5\u88ab\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c \u7531\u7cfb\u7edf\u6267\u884c\u3002</p> <p>\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\u7684\u547d\u4ee4\uff0c\u5982\u679c\u4e0d\u52a0 <code>-o</code> \u9009\u9879\u7684\u8bdd\u9ed8\u8ba4\u751f\u6210\u7684\u662f <code>a.out</code> \u6587\u4ef6\uff08assembly output\uff0c\u5373\u6c47\u7f16\u8f93\u51fa\uff09\u3002     <pre><code>gcc hello.c|hello.i|hello.s|hello.o -o hello\n</code></pre></p>","tags":["OS","C"]},{"location":"ThreeMountains/OS/OS%20Tips/#_5","title":"\u5e93\u6587\u4ef6\u548c\u5934\u6587\u4ef6","text":"","tags":["OS","C"]},{"location":"ThreeMountains/OS/OS%20Tips/#_6","title":"\u5934\u6587\u4ef6","text":"<p>\u5934\u6587\u4ef6\u7528\u6765\u63d0\u4f9b\u5bf9\u5e38\u91cf\u7684\u5b9a\u4e49\u548c\u5bf9\u7cfb\u7edf\u51fd\u6570\u53ca\u5e93\u51fd\u6570\u8c03\u7528\u7684\u58f0\u660e\u3002\u5bf9 C \u8bed\u8a00\u6765\u8bf4\uff0c\u8fd9\u4e9b\u5934\u6587\u4ef6\u51e0\u4e4e\u603b\u662f\u4f4d\u4e8e <code>/usr/include</code> \u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\u4e2d\u3002 <pre><code># ls  /usr/include/\n\u00b7\u00b7\u00b7\nctype.h      gnu-versions.h    netash      protocols           stdio_ext.h    video\ndirent.h     grp.h             netatalk    pthread.h           stdio.h        wait.h\ndlfcn.h      gshadow.h         netax25     pty.h               stdlib.h       wchar.h\nelf.h        iconv.h           netdb.h     pwd.h               string.h       wctype.h\nendian.h     ifaddrs.h         neteconet   python3.9           strings.h      wordexp.h\n\u00b7\u00b7\u00b7\n</code></pre></p> <p>GCC \u5934\u6587\u4ef6\u9ed8\u8ba4\u7684\u641c\u7d22\u8def\u5f84</p> <p>\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u67e5\u770b GCC \u5728\u7f16\u8bd1 C \u8bed\u8a00\u65f6\u9ed8\u8ba4\u7684\u5934\u6587\u4ef6\u641c\u7d22\u8def\u5f84\u3002   <pre><code>gcc -xc -E -v -\n</code></pre></p> <p>\u5728\u8c03\u7528 C \u8bed\u8a00\u7f16\u8bd1\u5668\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>-I</code> \u9009\u9879\u6765\u5305\u542b\u4fdd\u5b58\u5728\u5b50\u76ee\u5f55\u6216\u975e\u6807\u51c6\u4f4d\u7f6e\u4e2d\u7684\u5934\u6587\u4ef6\u3002\u4f8b\u5982\uff1a <pre><code>gcc -I/home/computer/c fred.c\n</code></pre> \u5b83\u6307\u793a\u7f16\u8bd1\u5668\u4e0d\u4ec5\u5728\u6807\u51c6\u4f4d\u7f6e\uff0c\u4e5f\u5728 <code>/home/computer/c</code> \u76ee\u5f55\u4e2d\u67e5\u627e\u7a0b\u5e8f <code>fred.c</code> \u4e2d\u5305\u542b\u7684\u5934\u6587\u4ef6\u3002</p> <p>\u5982\u679c\u6211\u4eec\u60f3\u67e5\u627e\u7528\u4e8e\u4ece\u7a0b\u5e8f\u4e2d\u8fd4\u56de\u9000\u51fa\u72b6\u6001\u7684 <code>#define</code> \u5b9a\u4e49\u7684\u540d\u5b57\uff0c\u53ef\u4ee5\u5728 <code>/usr/include</code> \u76ee\u5f55\u4e0b\u4f7f\u7528 <code>grep</code> \u547d\u4ee4\u8fdb\u884c\u641c\u7d22\u3002 <pre><code># grep EXIT_ *.h\n\u00b7\u00b7\u00b7\nstdlib.h:#define        EXIT_FAILURE    1       /* Failing exit status.  */\nstdlib.h:#define        EXIT_SUCCESS    0       /* Successful exit status.  */\n</code></pre></p>","tags":["OS","C"]},{"location":"ThreeMountains/OS/OS%20Tips/#_7","title":"\u5e93\u6587\u4ef6","text":"<p><code>\u5e93</code>\u662f\u4e00\u7ec4\u9884\u5148\u7f16\u8bd1\u597d\u7684\u51fd\u6570\u7684\u96c6\u5408\uff0c\u8fd9\u4e9b\u51fd\u6570\u662f\u6309\u7167\u53ef\u91cd\u7528\u7684\u539f\u5219\u7f16\u5199\u7684\u3002\u5b83\u4eec\u901a\u5e38\u6709\u4e00\u7ec4\u76f8\u4e92\u5173\u8054\u7684\u51fd\u6570\u7ec4\u6210\u4ee5\u6267\u884c\u67d0\u9879\u5e38\u89c1\u7684\u4efb\u52a1\u3002</p> <p>\u6807\u51c6\u7cfb\u7edf\u5e93\u6587\u4ef6\u4e00\u822c\u5b58\u50a8\u5728 <code>/lib</code> \u548c <code>/usr/lib</code> \u76ee\u5f55\u4e2d\u3002C \u8bed\u8a00\u7f16\u8bd1\u5668\uff08\u786e\u5207\u7684\u8bf4\u662f\u94fe\u63a5\u5668\uff0c<code>ld</code>\uff09\u9700\u8981\u77e5\u9053\u641c\u7d22\u54ea\u4e9b\u5e93\u6587\u4ef6\uff0c\u56e0\u4e3a\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5b83\u53ea\u641c\u7d22 \u6807\u51c6 C \u8bed\u8a00\u5e93\u3002\u6240\u4ee5\u4ec5\u4ec5\u662f\u628a\u5e93\u6587\u4ef6\u653e\u5728\u6807\u51c6\u76ee\u5f55\u4e2d\u662f\u4e0d\u591f\u7684\uff0c\u8fd8\u9700\u8981\u4f7f\u5e93\u6587\u4ef6\u9075\u5faa\u7279\u5b9a\u7684\u547d\u540d\u89c4\u8303\u5e76\u4e14\u5728\u547d\u4ee4\u884c\u4e2d\u660e\u786e\u6307\u5b9a\u3002</p> <p>\u5e93\u6587\u4ef6\u7684\u540d\u5b57\u603b\u662f <code>lib</code> \u5f00\u5934\uff0c\u968f\u540e\u7684\u90e8\u5206\u6307\u660e\u8fd9\u662f\u4ec0\u4e48\u5e93\uff08\u4f8b\u5982\uff0cm \u4ee3\u8868\u6570\u636e\u5b66\u5e93\uff09\u3002\u6587\u4ef6\u540d\u7684\u540e\u7f00\u4e00\u822c\u4e3a <code>.a</code> \u6216\u8005 <code>.so</code>\u3002  </p> <ul> <li><code>.a</code> \u4ee3\u8868\u4f20\u7edf\u7684\u9759\u6001\u51fd\u6570\u5e93\u3002</li> <li><code>.so</code> \u4ee3\u8868\u5171\u4eab\u51fd\u6570\u5e93\u3002</li> </ul> <p>\u51fd\u6570\u5e93\u901a\u5e38\u540c\u65f6\u4ee5\u9759\u6001\u5e93\u548c\u5171\u4eab\u5e93\u4e24\u79cd\u683c\u5f0f\u5b58\u5728\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>ls /usr/lib</code> \u547d\u4ee4\u67e5\u770b\u3002</p>","tags":["OS","C"]},{"location":"ThreeMountains/OS/OS%20Tips/#_8","title":"\u6307\u5b9a\u5e93\u6587\u4ef6","text":"<p>\u5728\u7f16\u8bd1\u65f6\u53ef\u4ee5\u901a\u8fc7\u7ed9\u51fa\u5b8c\u6574\u7684\u5e93\u6587\u4ef6\u8def\u5f84\u6765\u544a\u8bc9\u7f16\u8bd1\u5668\u8981\u641c\u7d22\u7684\u5e93\u6587\u4ef6\uff1a <pre><code>gcc -o fred fred.c /usr/lib/libm.a\n</code></pre> \u8be5\u547d\u4ee4\u8981\u6c42\u7f16\u8bd1\u5668\u7f16\u8bd1 <code>fred.c</code> \u6587\u4ef6\uff0c\u5c06\u7f16\u8bd1\u4ea7\u751f\u7684\u6587\u4ef6\u547d\u540d\u4e3a <code>fred</code>\uff0c\u5e76\u4e14\u9664\u4e86\u641c\u7d22\u6807\u51c6\u7684 C \u8bed\u8a00\u51fd\u6570\u5e93\u4ee5\u5916\uff0c\u8fd8\u641c\u7d22\u6570\u636e\u5b66\u5e93\u4ee5\u89e3\u51b3\u51fd\u6570\u5f15\u7528\u95ee\u9898\u3002 \u4e0b\u9762\u7684\u547d\u4ee4\u4e5f\u80fd\u4ea7\u751f\u7c7b\u4f3c\u7684\u7ed3\u679c\uff1a <pre><code>gcc -o fred fred.d -lm\n</code></pre> <code>-lm</code> \u662f\u7b80\u5199\u7684\u65b9\u5f0f\uff0c\u5b83\u4ee3\u8868\u7684\u662f\u6807\u51c6\u5e93\u76ee\u5f55\u4e2d\u540d\u4e3a <code>libm.a</code> \u7684\u51fd\u6570\u5e93\uff0c\u5e76\u4e14 <code>-lm</code> \u6709\u4e00\u4e2a\u7279\u6027\u5c31\u662f\u5982\u679c\u5b58\u5728\u5171\u4eab\u5e93\u7684\u5316\u4f1a\u4f18\u5148\u4f7f\u7528\u5171\u4eab\u5e93\u3002</p>","tags":["OS","C"]},{"location":"ThreeMountains/OS/OS%20Tips/#_9","title":"\u6307\u5b9a\u5e93\u6587\u4ef6\u641c\u7d22\u8def\u5f84","text":"<p>\u867d\u7136\u5e93\u6587\u4ef6\u548c\u5934\u6587\u4ef6\u4e00\u6837\uff0c\u901a\u5e38\u90fd\u4fdd\u5b58\u5728\u6807\u51c6\u76ee\u5f55\u4e0b\uff0c\u4f46\u662f\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>-L</code> \u9009\u9879\u6307\u793a\u7f16\u8bd1\u5668\u589e\u52a0\u5e93\u7684\u641c\u7d22\u8def\u5f84\u3002 <pre><code>gcc -o x11fred x11fred.c -L/usr/openwin/lib -lX11\n</code></pre> \u8be5\u547d\u4ee4\u8981\u6c42\u989d\u5916\u4f7f\u7528 <code>/usr/openwin/lib/</code> \u76ee\u5f55\u4e2d <code>libX11</code> \u5e93\u6765\u7f16\u8bd1\u548c\u94fe\u63a5 <code>x11fred</code> \u7a0b\u5e8f\u3002</p>","tags":["OS","C"]},{"location":"ThreeMountains/OS/OS%20Tips/#_10","title":"\u9759\u6001\u5e93","text":"<p>\u51fd\u6570\u5e93\u6700\u7b80\u5355\u7684\u5f62\u5f0f\u662f\u4e00\u7ec4\u5904\u4e8e\u201c\u88c5\u5907\u597d\u4f7f\u7528\u201d\u72b6\u6001\u7684\u76ee\u6807\u6587\u4ef6\u3002\u5f53\u7a0b\u5e8f\u9700\u8981\u4f7f\u7528\u51fd\u6570\u5e93\u4e2d\u7684\u67d0\u4e2a\u51fd\u6570\u65f6\uff0c\u5b83\u5305\u542b\u4e00\u4e2a\u58f0\u540d\u8be5\u51fd\u6570\u7684\u5934\u6587\u4ef6\u3002\u7f16\u8bd1\u5668\u548c\u94fe\u63a5\u5668 \u8d1f\u8d23\u5c06\u7a0b\u5e8f\u4ee3\u7801\u548c\u51fd\u6570\u5e93\u7ed3\u5408\u5728\u4e00\u8d77\u7ec4\u6210\u4e00\u4e2a\u5355\u72ec\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> <p>\u521b\u5efa\u548c\u7ef4\u62a4\u9759\u6001\u5e93\u53ea\u9700\u8981\u4f7f\u7528 <code>ar</code>\uff08\u4ee3\u8868 archive\uff0c\u5373\u5efa\u7acb\u5f52\u6863\u6587\u4ef6\uff09\u7a0b\u5e8f\u548c\u4f7f\u7528 <code>gcc -c</code> \u547d\u4ee4\u5bf9\u51fd\u6570\u5206\u522b\u8fdb\u884c\u7f16\u8bd1\u3002\u5e94\u8be5\u5c3d\u53ef\u80fd\u628a\u51fd\u6570\u4fdd\u5b58\u5728\u4e0d\u540c\u7684\u6e90\u6587\u4ef6\u4e2d\uff0c \u5982\u679c\u51fd\u6570\u9700\u8981\u8bbf\u95ee\u516c\u5171\u6570\u636e\uff0c\u53ef\u4ee5\u628a\u5b83\u4eec\u653e\u5728\u540c\u4e00\u4e2a\u6e90\u6587\u4ef6\u4e2d\uff0c\u5e76\u4f7f\u7528\u5728\u8be5\u6587\u4ef6\u4e2d\u58f0\u540d\u7684\u516c\u5171\u53d8\u91cf\u3002</p> <p>\u4e0b\u9762\u662f\u521b\u5efa\u9759\u6001\u5e93\u7684\u5b9e\u4f8b\uff0c\u5b9e\u73b0\u4e00\u4e2a\u5c0f\u578b\u51fd\u6570\u5e93 <code>foo</code>\uff0c\u5305\u542b\u4e24\u4e2a\u51fd\u6570 <code>fred</code> \u548c <code>bill</code>\uff0c\u7136\u540e\u5728\u4e3b\u7a0b\u5e8f\u4e2d <code>hello</code> \u8c03\u7528\u5176\u4e2d\u4e00\u4e2a\u51fd\u6570 <code>bill</code>\u3002  </p> <ol> <li> <p>\u4e24\u4e2a\u51fd\u6570\u5206\u522b\u521b\u5efa\u6e90\u6587\u4ef6 <code>fred.c</code> \u548c <code>bill.c</code>\uff0c\u540c\u65f6\u7f16\u5199\u5305\u542b\u8fd9\u4e24\u4e2a\u51fd\u6570\u7684\u5934\u6587\u4ef6 <code>libfoo.h</code>\u3002\u4e0b\u9762\u662f\u7b2c\u4e00\u4e2a\u6e90\u6587\u4ef6\uff1a <pre><code>// fred.c\n#include &lt;stdio.h&gt;\n\nvoid fred(int arg) {\n    printf(\"fred: we passed %d\", arg);\n}\n</code></pre> \u7b2c\u4e8c\u4e2a\u6e90\u6587\u4ef6\uff1a <pre><code>// bill.c\n#include &lt;stdio.h&gt;\n\nvoid bill(char *arg) {\n    printf(\"bill: we passed %s\", arg);\n}\n</code></pre> \u5934\u6587\u4ef6\uff1a <pre><code>// libfoo.h\n/**\n * This is mylib.h. It declares the functions fred and bill for users.\n**/\n\nvoid fred(int arg);\n\nvoid bill(char *arg);\n</code></pre></p> </li> <li> <p>\u5206\u522b\u7f16\u8bd1\u8fd9\u4e9b\u51fd\u6570\u4ee5\u4ea7\u751f\u8981\u5305\u542b\u5728\u5e93\u6587\u4ef6\u4e2d\u7684\u76ee\u6807\u6587\u4ef6\u3002\u4f7f\u7528 -c \u9009\u9879\u751f\u6210<code>\u53ef\u91cd\u5b9a\u4f4d\u76ee\u6807\u6587\u4ef6</code>\uff0c\u4f1a\u751f\u6210 <code>fred.o</code> \u548c <code>bill.o</code> \u6587\u4ef6\u3002\u5982\u679c\u6b64\u65f6\u5c1d\u8bd5\u521b\u5efa\u4e00\u4e2a\u5b8c\u6210\u7684\u7a0b\u5e8f\u5c06\u4e0d\u4f1a\u6210\u529f\uff0c\u56e0\u4e3a\u8fd8\u6ca1\u5b9a\u4e49 <code>main</code> \u51fd\u6570\u3002 <pre><code>$ gcc -c fred.c bill.c\n</code></pre></p> </li> <li> <p>\u521b\u5efa\u5e93\u6587\u4ef6\u3002\u4f7f\u7528 ar \u7a0b\u5e8f\u521b\u5efa\u5f52\u6863\u6587\u4ef6\u8fd9\u91cc\u662f\u5e93\u6587\u4ef6 <code>libfoo.a</code>\uff0c\u5e76\u5c06<code>\u53ef\u91cd\u5b9a\u4f4d\u76ee\u6807\u6587\u4ef6</code>\u6dfb\u52a0\u8fdb\u53bb\u3002 <pre><code>$ ar crv libfoo.a fred.o bill.o\n</code></pre></p> </li> <li> <p>\u5728\u4e3b\u7a0b\u5e8f\u4e2d\u52a0\u5165 <code>libfoo.h</code> \u5934\u6587\u4ef6\uff0c\u8c03\u7528 <code>bill</code> \u51fd\u6570\u3002 <pre><code>#include \"libfoo.h\"\n\nint main() {\n    bill(\"hello world!\\n\");\n}\n</code></pre> \u7f16\u8bd1\u8fd0\u884c\uff0c<code>-L.</code> \u6307\u5b9a\u989d\u5916\u5728\u5f53\u524d\u76ee\u5f55\u4e2d\u67e5\u627e\u5e93\u6587\u4ef6\uff0c<code>-lfoo</code> \u6267\u884c\u67e5\u627e\u5e93\u6587\u4ef6\u540d <code>libfoo.a</code> \u6216\u8005 <code>libfoo.so</code>\u3002 <pre><code>$ gcc -o hello hello.c -L. -lfoo\n$ ./hello\n</code></pre></p> </li> <li> <p>\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2a makefile \u7701\u53bb\u4e00\u6b65\u4e00\u6b65\u6267\u884c\u547d\u4ee4\uff0c\u76f4\u63a5\u6267\u884c <code>make hello</code> \u76f4\u63a5\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\u3002 <pre><code>fred.o: fred.c\n    gcc -c fred.c\n\nbill.o: bill.c\n    gcc -c bill.c\n\nlibfoo.a: fred.o bill.o\n    ar crv libfoo.a fred.o bill.o\n\nhello: hello.c libfoo.a\n    gcc -o hello hello.c -L. -lfoo \n</code></pre></p> </li> </ol>","tags":["OS","C"]},{"location":"ThreeMountains/OS/OS%20Tips/#_11","title":"\u5171\u4eab\u5e93","text":"<p>\u9759\u6001\u5e93\u7684\u4e00\u4e2a\u7f3a\u70b9\u662f\uff0c\u5f53\u540c\u65f6\u8fd0\u884c\u8bb8\u591a\u5e94\u7528\u7a0b\u5e8f\u5e76\u4e14\u5b83\u4eec\u90fd\u4f7f\u7528\u6765\u81ea\u540c\u4e00\u4e2a\u51fd\u6570\u5e93\u7684\u51fd\u6570\u65f6\uff0c\u5185\u5b58\u4e2d\u5c31\u4f1a\u6709\u540c\u4e00\u4e2a\u51fd\u6570\u7684\u591a\u4e2a\u526f\u672c\uff0c\u800c\u4e14\u7a0b\u5e8f\u6587\u4ef6\u81ea\u8eab\u4e2d\u4e5f\u6709 \u591a\u4efd\u540c\u6837\u7684\u526f\u672c\u3002\u8fd9\u5c06\u6d88\u8017\u66f4\u591a\u7684\u5185\u5b58\u548c\u78c1\u76d8\u7a7a\u95f4\u3002</p> <p>\u5171\u4eab\u5e93\u53ef\u4ee5\u514b\u670d\u9759\u6001\u5e93\u7684\u4e0a\u8ff0\u4e0d\u8db3\u3002\u5f53\u4e00\u4e2a\u7a0b\u5e8f\u4f7f\u7528\u5171\u4eab\u5e93\u65f6\uff0c\u5b83\u7684\u94fe\u63a5\u65b9\u5f0f\u662f\u8fd9\u6837\u7684\uff1a\u7a0b\u5e8f\u672c\u8eab\u4e0d\u5728\u5305\u542b\u51fd\u6570\u4ee3\u7801\uff0c\u800c\u662f\u5f15\u7528\u8fd0\u884c\u65f6\u53ef\u8bbf\u95ee\u7684\u5171\u4eab\u4ee3\u7801\u3002\u5f53 \u7f16\u8bd1\u597d\u7684\u7a0b\u5e8f\u88ab\u88c5\u8f7d\u5230\u5185\u5b58\u4e2d\u6267\u884c\u65f6\uff0c\u51fd\u6570\u5f15\u7528\u88ab\u89e3\u6790\u5e76\u4ea7\u751f\u5bf9\u5171\u4eab\u5e93\u7684\u8c03\u7528\uff0c\u5982\u679c\u6709\u5fc5\u8981\uff0c\u5171\u4eab\u5e93\u624d\u88ab\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u3002</p> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u6cd5\uff0c\u7cfb\u7edf\u53ef\u4ee5\u53ea\u4fdd\u7559\u5171\u4eab\u5e93\u7684\u4e00\u4efd\u526f\u672c\u4f9b\u8bb8\u591a\u5e94\u7528\u7a0b\u5e8f\u540c\u65f6\u4f7f\u7528\uff0c\u5e76\u4e14\u5728\u78c1\u76d8\u4e0a\u4e5f\u4ec5\u4fdd\u5b58\u4e00\u4efd\u3002\u4f7f\u7528\u5171\u4eab\u5e93\u7684\u53e6\u4e00\u4e2a\u597d\u5904\u662f\u5171\u4eab\u5e93\u7684\u66f4\u65b0\u53ef\u4ee5\u72ec\u7acb\u4e8e \u4f9d\u8d56\u5b83\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u4e0b\u9762\u662f\u521b\u5efa\u9759\u6001\u5e93\u7684\u5b9e\u4f8b\uff0c\u4ecd\u7136\u4f7f\u7528\u9759\u6001\u5e93\u7684\u793a\u4f8b\u6e90\u6587\u4ef6\u8fdb\u884c\u64cd\u4f5c\uff0c\u76ee\u5f55\u4f4d\u4e8e <code>/home/c</code>\uff0c\u6587\u4ef6\u5305\u62ec\uff1a<code>fred.c</code>\u3001<code>bill.c</code>\u3001<code>hello.c</code>\u3002  </p> <ol> <li> <p>\u7f16\u8bd1\u51fd\u6570\u4ee5\u4ea7\u751f\u8981\u5305\u542b\u5728\u5e93\u6587\u4ef6\u4e2d\u7684\u76ee\u6807\u6587\u4ef6\uff0c<code>-fPIC</code> \u9009\u9879\u8868\u793a\u7f16\u8bd1\u4e3a\u4f4d\u7f6e\u72ec\u7acb\u7684\u4ee3\u7801\uff0c\u8fd9\u662f\u5171\u4eab\u5e93\u5fc5\u987b\u7684\uff0c\u56e0\u4e3a\u5171\u4eab\u5e93\u9700\u8981\u5728\u4e0d\u540c\u7684\u8fdb\u7a0b\u4e2d\u88ab\u52a0\u8f7d\u6267\u884c\u3002 <pre><code>$ gcc -c -fPIC fred.c bill.c\n</code></pre></p> </li> <li> <p>\u5c06\u4e24\u4e2a\u76ee\u6807\u6587\u4ef6\u94fe\u63a5\u6210\u5171\u4eab\u5e93\uff0c<code>-shared</code> \u8868\u793a\u751f\u6210\u5171\u4eab\u5e93\u800c\u4e0d\u662f\u53ef\u6267\u884c\u6587\u4ef6\u3002 <pre><code>$ gcc -shared -o libfoo.so fred.o bill.o\n</code></pre></p> </li> <li> <p>\u7f16\u8bd1\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5e76\u8fd0\u884c\u7a0b\u5e8f\u3002 <pre><code>$ gcc -o hello -Wl,rpath=/home/c -L. -lfoo hello.c\n$ ./hello\n</code></pre></p> </li> </ol>","tags":["OS","C"]},{"location":"ThreeMountains/OS/OS%20Tips/#gdb","title":"GDB","text":"<p>\u68c0\u67e5\u5b89\u88c5 <pre><code>gdb --version\n</code></pre></p> <p>\u4f7f\u7528 gcc <code>-g</code> \u9009\u9879\u7f16\u8bd1\u6e90\u6587\u4ef6\uff0c\u7136\u540e gdb \u53ef\u6267\u884c\u6587\u4ef6\u5373\u53ef\u8fdb\u5165\u8c03\u8bd5\u3002 <pre><code>gcc -g p3.c\ngdb a.out\n</code></pre></p> <p>gdb \u9009\u9879  </p> <ul> <li><code>l</code> \u67e5\u770b\u7a0b\u5e8f\uff0c\u9ed8\u8ba4\u6bcf\u6b21\u8f93\u51fa 10 \u884c\uff0c\u53ef\u591a\u6b21\u4f7f\u7528 l \u67e5\u770b\u7a0b\u5e8f\u3002</li> <li><code>r</code> \u4ece\u5934\u6267\u884c\u7a0b\u5e8f\uff0c \u9047\u5230\u65ad\u70b9\u4f1a\u963b\u585e\u3002</li> <li> <p><code>q</code> \u9000\u51fa\u8c03\u8bd5\u3002</p> </li> <li> <p><code>b</code> \u8fdb\u884c\u6253\u65ad\u70b9\uff0c\u4e24\u79cd\u65b9\u5f0f b func_name\uff0cb line_number</p> </li> <li><code>info b</code> \u67e5\u770b\u65ad\u70b9\u5217\u8868\u4fe1\u606f\u3002</li> <li> <p><code>n</code> \u4e00\u884c\u4e00\u884c\u6267\u884c\u4ee3\u7801\u3002\u5982\u679c\u8be5\u884c\u4ee3\u7801\u8c03\u7528\u7684\u51fd\u6570\u91cc\u9762\u6709\u65ad\u70b9\uff0cn \u4f1a\u8fdb\u5165\u5230\u65ad\u70b9\u91cc\u9762\u3002</p> </li> <li> <p><code>p</code> \u6253\u5370\u53d8\u91cf\u7684\u503c\u3002\u4f8b\u5982 <code>p *s</code> \u3001<code>p arr[1]</code>\u3001 <code>p &amp;arr[1]</code>\u3002</p> </li> <li> <p><code>step</code> \u53ef\u4ee5\u8fdb\u5165\u51fd\u6570\u3002</p> </li> <li> <p><code>shell cmd</code> \u53ef\u4ee5\u6267\u884c\u547d\u4ee4\u3002</p> </li> <li><code>set logging on</code> \u5c06\u8c03\u8bd5\u4fe1\u606f\u8f93\u51fa\u5230\u65e5\u5fd7\u3002</li> </ul> <p>\u89c2\u5bdf\u70b9 watchpoint\uff0c\u7528\u6765\u76d1\u542c\u5730\u5740\u7684\u503c\u662f\u5426\u53d1\u751f\u53d8\u5316\uff0c\u5982\u679c\u5728\u7a0b\u5e8f\u6267\u884c\u8fc7\u7a0b\u4e2d\u89c2\u5bdf\u70b9\u7684\u503c\u53d1\u751f\u53d8\u5316\u4f1a\u8f93\u51fa\u54cd\u5e94\u7684\u4fe1\u606f\u3002</p> <ul> <li>\u589e\u52a0\u89c2\u5bdf\u70b9 `watch *0x7fffffffe6bc\u3002</li> <li>\u67e5\u770b\u89c2\u5bdf\u70b9 <code>info watchpoints</code>\u3002</li> </ul> <p>\u89c2\u5bdf\u70b9\u7684\u793a\u4f8b\u3002 <pre><code>// \u83b7\u53d6\u53d8\u91cf a \u7684\u5730\u5740\n(gdb) p &amp;a\n$1 = (int *) 0x7fffffffe6bc\n\n// \u589e\u52a0\u89c2\u5bdf\u70b9\n(gdb) watch *0x7fffffffe6bc\nHardware watchpoint 2: *0x7fffffffe6bc\n(gdb) n\n10                  a++;\n// \u6267\u884c a++ \u89c2\u5bdf\u70b9\u7684\u503c\u53d1\u751f\u4e86\u53d8\u5316\n(gdb) n\n\nHardware watchpoint 2: *0x7fffffffe6bc\n\nOld value = 1\nNew value = 2\n0x000055555555513e in main () at wp.c:10\n10                  a++;\n(gdb) n\n\nBreakpoint 1, main () at wp.c:8\n8               if (a &lt; 5)\n(gdb) n\n10                  a++;\n// \u7ee7\u7eed\u6267\u884c a++ \u89c2\u5bdf\u70b9\u7684\u503c\u53c8\u53d1\u751f\u4e86\u53d8\u5316\n(gdb) n\n\nHardware watchpoint 2: *0x7fffffffe6bc\n\nOld value = 2\nNew value = 3\n0x000055555555513e in main () at wp.c:10\n10                  a++;\n</code></pre></p>","tags":["OS","C"]},{"location":"ThreeMountains/OS/OS%20Tips/#_12","title":"\u4ece\u53ef\u6267\u884c\u8fdb\u884c\u53cd\u6c47\u7f16","text":"<p>QA:</p> <ol> <li> <p>GCC \u751f\u6210\u7684\u6c47\u7f16\u548c NASM \u7f16\u8bd1\u5f97\u5230\u7684\u6c47\u7f16\u6709\u4ec0\u4e48\u4e0d\u540c\uff1f</p> </li> <li> <p>\u4ec0\u4e48\u53eb\u505a\u53ef\u91cd\u5b9a\u4f4d\u76ee\u6807\u7a0b\u5e8f\uff1f</p> </li> <li> <p>\u4ec0\u4e48\u662f\u6807\u51c6 C \u5e93\uff0c\u8fd8\u6709\u4ec0\u4e48 C \u5e93\uff1f</p> </li> <li> <p>\u4e3a\u4ec0\u4e48 C \u8bed\u8a00\u7684 <code>main</code> \u51fd\u6570\u53ef\u4ee5\u4e0d\u5199 <code>return</code> \u8bed\u53e5\uff1f    \u5982\u679c <code>main</code> \u51fd\u6570\u4e2d\u4e0d\u5199 <code>return</code> \u8bed\u53e5\uff0c\u5219\u9ed8\u8ba4\u8fd4\u56de 0\uff0c\u8868\u793a\u7a0b\u5e8f\u6b63\u5e38\u6267\u884c\u9000\u51fa\u4e86\u3002\u4f46\u662f\u4e3a\u4e86\u4fdd\u6301\u597d\u7684\u4e60\u60ef\uff0c\u8fd8\u662f\u5e94\u8be5\u52a0\u4e0a <code>return 0;</code> \u8bed\u53e5\u3002</p> </li> <li> <p>C \u8bed\u8a00\u5934\u6587\u4ef6 <code>#include &lt;&gt;</code> \u548c <code>#include \"\"</code> \u6709\u4ec0\u4e48\u533a\u522b\uff1f  </p> <p><code>#include &lt;&gt;</code> \u7528\u6765\u5f15\u7528\u6807\u51c6\u5e93\u5934\u6587\u4ef6\uff0c\u8fd9\u4e9b\u5934\u6587\u4ef6\u901a\u5e38\u5df2\u7ecf\u5b89\u88c5\u5728\u7cfb\u7edf\u7684\u6807\u51c6\u76ee\u5f55\u4e2d\u3002\u7f16\u8bd1\u5668\u4f1a\u5728\u8fd9\u4e2a\u6807\u51c6\u76ee\u5f55\u4e2d\u67e5\u627e\u5934\u6587\u4ef6\u5e76\u5c06\u5176\u5305\u542b\u5230\u4ee3\u7801\u4e2d\u3002  </p> <p><code>#include \"\"</code> \u7528\u6765\u5f15\u7528\u81ea\u5b9a\u4e49\u5934\u6587\u4ef6\uff0c\u8fd9\u4e9b\u5934\u6587\u4ef6\u901a\u5e38\u662f\u7528\u6237\u81ea\u5df1\u7f16\u5199\u7684\u3002\u7f16\u8bd1\u5668\u4f1a\u5728\u5f53\u524d\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u4e2d\u67e5\u627e\u5934\u6587\u4ef6\u5e76\u5c06\u5176\u5305\u542b\u8fdb\u4ee3\u7801\u4e2d\u3002</p> </li> </ol>","tags":["OS","C"]},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/","title":"\u5e76\u53d1\u63a7\u5236","text":""},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#_2","title":"\u9501","text":"<p>\u901a\u8fc7\u5bf9\u591a\u7ebf\u7a0b\u7684\u4ecb\u7ecd\uff0c\u80fd\u591f\u5230\u4e86\u5e76\u53d1\u7f16\u7a0b\u4e00\u4e2a\u6700\u57fa\u672c\u7684\u95ee\u9898\uff1a\u5373\u5e0c\u671b\u539f\u5b50\u6027\u7684\u6267\u884c\u4e00\u7cfb\u5217\u6307\u4ee4\uff0c\u4f46\u662f\u7531\u4e8e\u5355\u5904\u7406\u5668\u7684\u4e2d\u65ad\uff08\u6216\u8005\u591a\u4e2a\u7ebf\u7a0b\u5728\u591a\u4e2a\u5904\u7406\u5668\u4e0a\u6267\u884c\uff09\uff0c\u6211\u4eec\u505a\u4e0d\u5230\u3002</p> <p>\u901a\u8fc7\u9501\uff08lock\uff09\uff0c\u76f4\u63a5\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\u3002\u5728\u7a0b\u5e8f\u4ee3\u7801\u4e2d\u52a0\u9501\uff0c\u653e\u5728\u4e34\u754c\u533a\u5468\u56f4\uff0c\u4fdd\u8bc1\u4e34\u754c\u533a\u80fd\u591f\u50cf\u5355\u6761\u539f\u5b50\u6307\u4ee4\u4e00\u6837\u6267\u884c\u3002</p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#_3","title":"\u5982\u4f55\u5b9e\u73b0\u9501","text":"<p>\u9996\u5148\u9700\u8981\u660e\u786e\u7684\u662f\uff0c\u9501\u7684\u5b9e\u73b0\u9700\u8981\u786c\u4ef6\u548c\u64cd\u4f5c\u7cfb\u7edf\u7684\u5e2e\u52a9\u3002\u5404\u79cd\u8ba1\u7b97\u673a\u4f53\u7cfb\u7ed3\u6784\u7684\u6307\u4ee4\u96c6\u90fd\u5305\u542b\u4e00\u4e9b\u76f8\u4f3c\u7684\u786c\u4ef6\u539f\u8bed\uff0c\u8fd9\u91cc\u4e0d\u7814\u7a76\u8fd9\u4e9b\u6307\u4ee4\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff0c\u53ea\u7814\u7a76\u5982\u4f55\u4f7f\u7528\u5b83\u4eec\u6765\u5b9e\u73b0\u9501\u8fd9\u6837\u7684\u4e92\u65a5\u539f\u8bed\u3002\u64cd\u4f5c\u7cfb\u7edf\u6b63\u662f\u5728\u8fd9\u79cd\u57fa\u7840\u6307\u4ee4\u7684\u652f\u6301\u4e0b\u5b8c\u5584\u53d1\u5c55\uff0c\u652f\u6301\u5b9e\u73b0\u590d\u6742\u6210\u719f\u9501\u5e93\u7684\u3002</p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#_4","title":"\u8bc4\u4ef7\u9501","text":"<p>\u5728\u5b9e\u73b0\u9501\u4e4b\u524d\uff0c\u5e94\u8be5\u660e\u786e\u76ee\u6807\uff0c\u5373\u5982\u4f55\u8bc4\u4ef7\u4e00\u79cd\u9501\u5b9e\u73b0\u7684\u6548\u679c\uff0c\u5e94\u8be5\u4e3a\u6b64\u8bbe\u7acb\u4e00\u4e9b\u660e\u786e\u7684\u76ee\u6807\u3002</p> <ul> <li>\u6b63\u786e\u6027\uff0c\u9501\u662f\u5426\u80fd\u591f\u5b8c\u6210\u5b83\u7684\u57fa\u672c\u4efb\u52a1\uff0c\u5373\u63d0\u4f9b\u4e92\u65a5\u3002\u8fd9\u662f\u6700\u57fa\u672c\u7684\uff0c\u9501\u662f\u5426\u6709\u6548\uff0c\u80fd\u591f\u963b\u6b62\u591a\u4e2a\u7ebf\u7a0b\u8fdb\u5165\u4e34\u754c\u533a\u3002</li> <li>\u516c\u5e73\u6027\uff0c\u5f53\u9501\u53ef\u7528\u65f6\uff0c\u662f\u5426\u6bcf\u4e00\u4e2a\u7ade\u4e89\u7ebf\u7a0b\u6709\u516c\u5e73\u7684\u673a\u4f1a\u62a2\u5230\u9501\uff1f\u7528\u53e6\u4e00\u79cd\u6781\u7aef\u7684\u65b9\u5f0f\u770b\u8fd9\u4e2a\u95ee\u9898\u662f\uff0c\u662f\u5426\u6709\u7ade\u4e89\u7684\u7ebf\u7a0b\u4f1a\u997f\u6b7b\uff0c\u4e00\u81f4\u65e0\u6cd5\u83b7\u5f97\u9501\uff1f</li> <li>\u6027\u80fd\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u662f\u4f7f\u7528\u9501\u4e4b\u540e\u589e\u52a0\u7684\u65f6\u95f4\u5f00\u9500\u3002</li> </ul>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#_5","title":"\u7b80\u5355\u7684\u5c1d\u8bd5","text":"<p>\u6211\u4eec\u7684\u60f3\u6cd5\u5f88\u7b80\u5355\uff1a\u7528\u4e00\u4e2a\u53d8\u91cf\u6765\u6807\u5fd7\u9501\u662f\u5426\u88ab\u67d0\u4e9b\u7ebf\u7a0b\u5360\u7528\u3002</p> <p>\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u5165\u4e34\u754c\u533a\uff0c\u8c03\u7528 lock \u51fd\u6570\uff0c\u68c0\u67e5\u6807\u5fd7\u662f\u5426\u4e3a 1\uff08\u8fd9\u91cc\u4e0d\u662f 1\uff09\uff0c\u7136\u540e\u8bbe\u7f6e\u6807\u5fd7\u4e3a 1\uff0c\u8868\u793a\u7ebf\u7a0b\u6301\u6709\u8be5\u9501\u3002\u7ed3\u675f\u4e34\u754c\u533a\u65f6\uff0c\u7ebf\u7a0b\u8c03\u7528 unlock \u51fd\u6570\uff0c\u6e05\u9664\u6807\u5fd7\uff0c\u8868\u793a\u9501\u672a\u88ab\u6301\u6709\u3002</p> <p>\u7ebf\u7a0b\u5728\u7b49\u5f85\u5df2\u7ecf\u88ab\u6301\u6709\u7684\u9501\u65f6\uff0c\u91c7\u7528\u4e86\u81ea\u65cb\u7b49\u5f85\u7684\u6280\u672f\uff08spin waiting\uff09\uff0c\u5c31\u662f\u4e0d\u505c\u7684\u68c0\u67e5\u9501\u6807\u5fd7\u7684\u503c\u3002 <pre><code>struct my_lock {\n    int flag;\n} mutex;\n\nvoid init(struct my_lock *mutex) {\n    mutex-&gt;flag = 0;\n}\n\nvoid lock(struct my_lock *mutex) {\n    while (mutex-&gt;flag == 1)    // test the flag\n        ;   // spain wait\n    mutex-&gt;flag = 1;    // set the flag\n}\n\nvoid unlock(struct my_lock *mutex) {\n    mutex-&gt;flag = 0;\n}\n</code></pre> \u9057\u61be\u7684\u662f\u8fd9\u6bb5\u4ee3\u7801\u6709\u4e24\u4e2a\u95ee\u9898\uff1a\u6b63\u786e\u6027\u548c\u6027\u80fd\u3002</p> <p>\u6b63\u786e\u6027\u95ee\u9898 \u4e00\u79cd\u662f\u4e0d\u53ef\u63a7\u7684\u7ebf\u7a0b\u8c03\u5ea6\uff0c\u56e0\u4e3a lock \u51fd\u6570\u52a0\u9501\u7684\u903b\u8f91\u5206\u4e3a\u4e24\u6b65\u5e76\u4e14\u7ebf\u7a0b\u7684\u8c03\u5ea6\u4e0d\u53ef\u63a7\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e24\u4e2a\u7ebf\u7a0b\u540c\u65f6\u52a0\u9501\u6210\u529f\u3002\u6211\u4eec\u9700\u8981\u53ef\u9760\u7684\u539f\u5b50\u64cd\u4f5c\uff08guaranteed atomic operations\uff09\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> Thread 1 Thread 2 test the flag; // \u4e2d\u65ad\uff1a\u5207\u6362\u5230 Thread 2 test the flag; set the flag; // \u4e2d\u65ad\uff1a\u5207\u6362\u5230 Thread 1 set the flag; <p>\u53e6\u4e00\u79cd\u662f\u7ebf\u7a0b\u6a21\u578b\uff08\u6216\u8005 CPU \u7f13\u5b58\u6a21\u578b\uff09\u4f7f\u5f97\u53d8\u91cf\u7f13\u5b58\u5728\u7ebf\u7a0b\u672c\u5730\uff08\u6216\u8005 CPU \u7f13\u5b58\uff09\uff0c\u5bfc\u81f4\u5373\u4f7f\u4e00\u4e2a\u7ebf\u7a0b\u52a0\u9501\u6210\u529f\u800c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u89c2\u5bdf\u4e0d\u5230\u4ecd\u80fd\u52a0\u9501\u6210\u529f\u3002\u53ef\u4ee5\u901a\u8fc7\u603b\u7ebf\u52a0\u9501\uff08LOCK# \u4fe1\u53f7\u548c LOCK \u6307\u4ee4\u524d\u7f00\uff09\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u540c\u65f6\u4e3a\u4e86\u4f7f\u4e34\u754c\u533a\u7684\u4ee3\u7801\u6267\u884c\u5b8c\u6210\u4e4b\u540e\uff0c\u6240\u6709\u7684\u7ebf\u7a0b\u90fd\u80fd\u89c2\u5bdf\u5230\u4e34\u754c\u533a\u5bf9\u72b6\u6001\u7684\u66f4\u65b0\uff0c\u4e00\u822c\u4f7f\u7528\u5185\u5b58\u5c4f\u969c\u76f8\u5173\u7684\u6307\u4ee4\u6765\u4fdd\u8bc1\u72b6\u6001\u7684\u53ef\u89c6\u6027\u3002\u9700\u8981\u6ce8\u610f\u8fd9\u91cc\u7684\u72b6\u6001\u53ef\u89c6\u6027\u548c\u9501\u53d8\u91cf\u7684\u53ef\u89c6\u6027\u8981\u533a\u5206\u5f00\u3002</p> <p>\u6027\u80fd\u95ee\u9898 \u6027\u80fd\u95ee\u9898\u4e3b\u8981\u662f\u81ea\u65cb\u7b49\u5f85\u5728\u7b49\u5f85\u5176\u5b83\u7ebf\u7a0b\u91ca\u653e\u9501\u7684\u65f6\u5019\u4f1a\u6d6a\u8d39 CPU \u65f6\u95f4\u3002\u5c24\u5176\u662f\u5728\u5355\u5904\u7406\u5668\u4e0a\uff0c\u4e00\u4e2a\u7b49\u5f85\u7ebf\u7a0b\u7b49\u5f85\u7684\u76ee\u6807\u7ebf\u7a0b\u751a\u81f3\u65e0\u6cd5\u8fd0\u884c\uff01</p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#test-and-set","title":"\u786c\u4ef6\u539f\u8bed test-and-set","text":"<p>\u5c3d\u7ba1\u7b80\u5355\u7684\u5c1d\u8bd5\u60f3\u6cd5\u5f88\u597d\uff0c\u4f46\u662f\u6ca1\u6709\u786c\u4ef6\u7684\u652f\u6301\u662f\u65e0\u6cd5\u5b9e\u73b0\u7684\u3002\u5e78\u8fd0\u7684\u662f\uff0c\u4e00\u4e9b\u7cfb\u7edf\u63d0\u4f9b\u4e86\u8fd9\u4e00\u6307\u4ee4\uff0c\u652f\u6301\u57fa\u4e8e\u8fd9\u79cd\u6982\u5ff5\u521b\u5efa\u7b80\u5355\u7684\u9501\u3002</p> <p>\u5728 x86 \u4e0a\uff0c\u662f xchg\uff08atomic change\uff0c\u539f\u5b50\u4ea4\u6362\uff09\u6307\u4ee4\uff0c\u8be5\u6307\u4ee4\u81ea\u52a8\u5e26\u6709 LOCK \u8bed\u4e49\uff0c\u901a\u5e38\u79f0\u4e3a\u6d4b\u8bd5\u5e76\u8bbe\u7f6e\u6307\u4ee4\uff08test-and-set\uff09\u3002\u4f7f\u7528 C \u4ee3\u7801\u6765\u5b9a\u4e49\u6d4b\u8bd5\u5e76\u8bbe\u7f6e\u6307\u4ee4\u505a\u4e86\u4ec0\u4e48\u3002 <pre><code>int TestAndSet(int *old_ptr, int new) {\n    int old = *old_ptr;\n    *old_ptr = new;\n    return old;\n}\n</code></pre></p> <p>\u4f7f\u7528 xchg \u7684\u7b80\u5355\u81ea\u65cb\u9501\u5982\u4e0b\uff1a <pre><code>typedef struct my_lock {\n    int flag;\n} mutex;\n\nvoid init(struct my_lock *mutex) {\n    mutex-&gt;flag = 0;\n}\n\nvoid lock(struct my_lock *mutex) {\n    while(TestAndSet(mutex-&gt;flag, 1) == 0)\n        ;\n}\n\nvoid unlock(struct my_lock *mutex) {\n    mutex-&gt;flag = 0;\n}\n</code></pre> \u8fd9\u79cd\u9501\u7684\u5b9e\u73b0\u79f0\u4e3a\u81ea\u65cb\u9501\uff0c\u662f\u4e00\u79cd\u6700\u7b80\u5355\u7684\u9501\uff0c\u4e00\u503c\u81ea\u65cb\uff0c\u76f4\u5230\u9501\u53ef\u7528\u3002</p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#compare-and-swap","title":"\u786c\u4ef6\u539f\u8bed compare-and-swap","text":"<p>\u53e6\u4e00\u4e2a\u786c\u4ef6\u539f\u8bed\u662f\u6bd4\u8f83\u5e76\u4ea4\u6362\u6307\u4ee4\uff0cx86 \u67b6\u6784\u4e2d\u662f cmpxchgl \u6307\u4ee4\u3002C \u8bed\u8a00\u4f2a\u4ee3\u7801\u5982\u4e0b\uff1a <pre><code>int CompareAndSwap(int *ptr, int expected, int new) {\n    int actual = *ptr;\n    if(actual == expected) {\n        *ptr = new;\n    }\n    return actual;\n}\n</code></pre> \u6709\u4e86\u6bd4\u8f83\u5e76\u4ea4\u6362\u6307\u4ee4\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u9501\uff0c\u7c7b\u4f3c\u4e8e\u6d4b\u8bd5\u5e76\u8bbe\u7f6e\u90a3\u6837\u3002\u4f8b\u5982\uff0c\u53ea\u9700\u8981\u7528\u4e0b\u9762\u7684\u4ee3\u7801\u66ff\u6362 lock() \u51fd\u6570\uff1a <pre><code>void lock(my_lock *mutex) {\n    while(CompareAndSwap(mutex-&gt;flag, 0, 1) == 0) {\n        ;\n    }\n}\n</code></pre> \u4e0b\u9762\u662f\u901a\u8fc7 cmpxchgl \u6307\u4ee4\u5b9e\u73b0\u9501\u5e76\u901a\u8fc7\u6d4b\u8bd5\u7684\u771f\u5b9e\u793a\u4f8b\uff0c\u4ee3\u7801\u4e2d\u4f7f\u7528\u5230\u4e86\u5185\u8054\u6c47\u7f16\u7684\u8bed\u6cd5\uff1a <pre><code>#include &lt;stdio.h&gt;\n#include &lt;assert.h&gt;\n#include &lt;pthread.h&gt;\n\nchar CompareAndSwap(int *ptr, int old, int new) {\n    unsigned char ret;\n\n    __asm__ __volatile__ (\n            \" lock\\n\"   // lock\n            \" cmpxchgl %2, %1\\n\"    // cmpxchgl\n            \" sete %0\\n\"    // sete\n            : \"=q\" (ret), \"=m\" (*ptr)   // \u8f93\u51fa\n            : \"r\" (new), \"a\" (old)  // \u8f93\u5165\n            : \"memory\");    // memory\n    return ret;\n}\n\nstruct my_lock {\n    int flag;\n} mutex;\n\nvoid init(struct my_lock *mutex) {\n    mutex-&gt;flag = 0;\n}\n\nvoid lock(struct my_lock *mutex) {\n    while(CompareAndSwap(&amp;mutex-&gt;flag, 0, 1) == 0) {\n        ;\n    }\n}\n\nvoid unlock(struct my_lock *mutex) {\n    mutex-&gt;flag = 0;\n}\n\nint counter = 0;\n\nvoid *thread_function(void *arg);\n\nint main() {\n    pthread_t a_thread, b_thread;\n    int rc;\n\n    init(&amp;mutex);\n\n    printf(\"main: begin\\n\");\n\n    rc = pthread_create(&amp;a_thread, NULL, thread_function, \"A\"); assert(rc == 0);\n    rc = pthread_create(&amp;b_thread, NULL, thread_function, \"B\"); assert(rc == 0);\n\n    rc = pthread_join(a_thread, NULL); assert(rc == 0);\n    rc = pthread_join(b_thread, NULL); assert(rc == 0);\n\n    printf(\"main: done with both (counter = %d)\\n\", counter);\n\n    return 0;\n}\n\nvoid *thread_function(void *arg) {\n    printf(\"%s: begin\\n\", (char *) arg);\n    for(int i = 0; i &lt; 1000000; i ++) {\n        lock(&amp;mutex);\n        counter ++;\n        unlock(&amp;mutex);\n    }\n    printf(\"%s: done\\n\", (char *) arg);\n\n    return NULL;\n}\n</code></pre> \u8fd9\u91cc\u89e3\u91ca\u4e00\u4e0b\u5185\u8054\u6c47\u7f16\u90e8\u5206\u7684\u4ee3\u7801\u3002</p> <ol> <li><code>lock</code> \u6807\u8bc6\u9501\u5b9a\u5185\u5b58\u603b\u7ebf\uff0c\u5e76\u4e14\u4fdd\u8bc1\u540e\u7684\u6307\u4ee4\u539f\u5b50\u5f0f\u7684\u6267\u884c\u3002</li> <li>\u8f93\u5165\u90e8\u5206 <code>\"a\" (old)</code> \u8868\u793a\u5c06 <code>old</code> \u53d8\u91cf\u7684\u503c\u653e\u5165 <code>eax</code> \u5bc4\u5b58\u4e2d\u4f5c\u4e3a\u6c47\u7f16\u6307\u4ee4\u7684\u8f93\u5165\u3002<code>a</code> \u8868\u793a <code>eax</code> \u5bc4\u5b58\u5668\u3002</li> <li>\u8f93\u5165\u90e8\u5206 <code>\"r\" (new)</code> \u8868\u793a\u5c06 <code>new</code> \u53d8\u91cf\u7684\u503c\u4f7f\u7528\u4e00\u4e2a\u901a\u7528\u5bc4\u5b58\u5668\u5b58\u653e\uff0c\u4f5c\u4e3a\u6c47\u7f16\u6307\u4ee4\u7684\u8f93\u5165\u3002<code>r</code> \u8868\u793a\u4efb\u610f\u7684\u4e00\u4e2a\u901a\u7528\u5bc4\u5b58\u5668\u3002\u5360\u4f4d <code>%2</code>\u3002</li> <li>\u8f93\u51fa\u90e8\u5206 <code>\"=m\" (*ptr)</code> \u8868\u793a\u4f7f\u7528\u5185\u5b58\u5730\u5740\uff08<code>*ptr</code>\uff09\u4f5c\u4e3a\u6c47\u7f16\u6307\u4ee4\u7684\u8f93\u51fa\uff0c<code>m</code> \u8868\u793a\u5185\u5b58\u5730\u5740\uff0c<code>=</code> \u8868\u793a\u8f93\u51fa\u8868\u8fbe\u5f0f\u64cd\u4f5c\u662f\u53ea\u5199\u7684\u3002\u5360\u4f4d <code>%1</code>\u3002</li> <li>\u8f93\u51fa\u90e8\u5206 <code>\"=q\" (ret)</code> \u6682\u65f6\u6ca1\u6709\u641e\u660e\u767d\uff0c\u5927\u81f4\u5c31\u662f\u8f93\u51fa\u7ed3\u679c\u653e\u5230 <code>ret</code> \u4e2d\u3002\u5360\u4f4d <code>%0</code>\u3002</li> <li><code>cmpxchgl</code> \u6307\u4ee4\u6bd4\u8f83 <code>eax</code> \u5bc4\u5b58\u7684\u503c\uff08\u4e5f\u5c31\u662f <code>old</code> \u53d8\u91cf\u7684\u503c\uff09\u4e0e <code>%1</code> \u5360\u4f4d\u7684\u503c\uff08\u4e5f\u5c31\u662f <code>*ptr</code> \u7684\u503c\uff09\uff0c\u5982\u679c\u76f8\u7b49\uff0c\u5c06 <code>%2</code> \u5360\u4f4d\u7684\u503c\uff08\u4e5f\u5c31\u662f <code>new</code> \u53d8\u91cf\u7684\u503c\uff09     \u8d4b\u503c\u7ed9 <code>%1</code> \u5360\u4f4d\uff08\u4e5f\u5c31\u662f <code>*ptr</code>\uff09\u540c\u65f6\u6807\u5fd7\u5bc4\u5b58\u5668 <code>ZF</code> \u4f4d\u7f6e <code>1</code>\uff1b\u5426\u5219\uff0c\u5c06 <code>%1</code> \u5360\u4f4d\u7684\u503c\u8d4b\u503c\u7ed9 <code>eax</code>\uff0c\u5e76\u4e14\u5c06\u6807\u5fd7\u5bc4\u5b58\u5668 <code>ZF</code> \u4f4d\u7f6e <code>0</code>\u3002</li> <li><code>sete</code> \u6307\u4ee4\uff0c\u5982\u679c\u6807\u5fd7\u5bc4\u5b58\u5668 <code>ZF</code> \u4f4d\u4e3a <code>1</code> \u90a3\u4e48\u8bbe\u7f6e <code>%0</code> \u5360\u4f4d\u7684\u503c\uff08\u4e5f\u5c31\u662f <code>ret</code> \u7684\u503c\uff09\u4e3a <code>1</code>\u3002</li> <li><code>memory</code> \u5411 GCC \u58f0\u660e\uff1a\u5728\u8fd9\u91cc\u5185\u5b58\u53d1\u751f\u6216\u8005\u53ef\u80fd\u53d1\u751f\u53ef\u6539\u53d8\u3002\u90a3\u4e48 GCC \u4f1a\u4fdd\u8bc1\u5728\u6b64\u5185\u8054\u6c47\u7f16\u4e4b\u524d\u5982\u679c\u67d0\u4e2a\u5185\u5b58\u7684\u5185\u5bb9\u88ab\u8bfb\u53d6\uff0c\u90a3\u4e48\u5728\u5185\u8054\u6c47\u7f16\u4e4b\u540e\u5982\u679c\u9700\u8981\u4f7f\u7528    \u4f7f\u7528\u8fd9\u4e2a\u5185\u5b58\u5904\u7684\u5185\u5bb9\uff0c\u5c31\u4f1a\u76f4\u63a5\u4ece\u5185\u5b58\u8bfb\u53d6\u800c\u4e0d\u662f\u4f7f\u7528\u7f13\u5b58\uff0c\u4ece\u800c\u5b9e\u73b0\u5185\u5b58\u5c4f\u969c\u7684\u6548\u679c\u3002</li> </ol>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#fetch-and-add","title":"\u786c\u4ef6\u539f\u8bed fetch-and-add","text":"<p>\u83b7\u53d6\u5e76\u589e\u52a0\u6307\u4ee4\u80fd\u591f\u539f\u5b50\u5730\u8fd4\u56de\u7279\u5b9a\u5730\u5740\u7684\u65e7\u503c\uff0c\u5e76\u4e14\u8ba9\u8be5\u503c\u81ea\u589e\u4e00\u3002\u4f7f\u7528\u8be5\u6307\u4ee4\u4e5f\u80fd\u5b9e\u73b0\u7b80\u5355\u7684\u81ea\u65cb\u9501\uff0c\u8fd9\u91cc\u6211\u4eec\u589e\u52a0\u4e00\u70b9\u73a9\u6cd5\uff0c\u5728\u81ea\u65cb\u7684\u57fa\u7840\u4e0a\u5b9e\u73b0\u516c\u5e73\u6027\u3002 <pre><code>int FetchAndAdd(int *ptr) {\n    int old = *ptr;\n    *ptr ++;\n    return old;\n}\n\ntypedef struct my_lock {\n    int ticket;\n    int turn;\n} mutex;\n\nvoid init(struct my_lock *mutex) {\n    mutex-&gt;ticket = 0;\n    mutex-&gt;turn = 0;\n}\n\nvoid lock(struct my_lock *mutex) {\n    int my_turn = FetchAndAdd(&amp;mutex-&gt;ticket);\n    while(mutex-&gt;turn != my_turn) {\n        ;\n    }\n}\n\nvoid unlock(struct my_lock *mutex) {\n    FetchAndAdd(&amp;mutex-&gt;turn);\n}\n</code></pre> \u4e0d\u540c\u4e8e\u4e4b\u524d\u7684\u65b9\u6cd5\uff0c\u8fd9\u79cd\u65b9\u5f0f\u80fd\u591f\u4fdd\u8bc1\u53ea\u8981\u4e00\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u4e86 ticket \u503c\uff0c\u5b83\u6700\u7ec8\u4f1a\u88ab\u8c03\u5ea6\u3002</p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#_6","title":"\u5982\u4f55\u89e3\u51b3\u8fc7\u591a\u7684\u81ea\u65cb","text":"<p>\u901a\u8fc7\u4e0a\u8ff0\u786c\u4ef6\u539f\u8bed\uff0c\u5df2\u7ecf\u5b9e\u73b0\u4e86\u6b63\u786e\u3001\u516c\u5e73\u7684\u9501\uff0c\u4f46\u662f\u901a\u8fc7\u4f7f\u7528\u81ea\u65cb\u7b49\u5f85\u5b9e\u73b0\u7684\u9501\u53ef\u80fd\u4f1a\u9020\u6210\u6027\u80fd\u95ee\u9898\u3002  </p> <p>\u5728\u5e76\u53d1\u91cf\u8f83\u5c11\u4e14\u4e34\u754c\u533a\u80fd\u591f\u5feb\u901f\u6267\u884c\u5b8c\u6bd5\u7684\u60c5\u51b5\u4e0b \u53ef\u80fd\u95ee\u9898\u4e0d\u660e\u663e\uff1b\u5728\u679c\u5e76\u53d1\u91cf\u6bd4\u8f83\u9ad8\u6216\u8005\u4e34\u754c\u533a\u8017\u65f6\u6bd4\u8f83\u4e45\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u4e34\u754c\u533a\u7684\u7ebf\u7a0b\uff08\u83b7\u5f97\u9501\u7684\u7ebf\u7a0b\uff09\u53d1\u751f\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u90a3\u4e48\u5176\u5b83\u7ebf\u7a0b\u5373\u4f7f\u83b7\u5f97 CPU \u65f6\u95f4 \u4e5f\u53ea\u80fd\u4e00\u76f4\u81ea\u65cb\u7b49\u5f85\uff0c\u6d6a\u8d39\u4e86 CPU \u65f6\u95f4\u3002</p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#_7","title":"\u7ebf\u7a0b\u8ba9\u6b65","text":"<p>\u4e00\u79cd\u7b80\u5355\u7684\u7684\u65b9\u6cd5\u4f7f\u5728\u7ebf\u7a0b\u8981\u81ea\u65cb\u7684\u65f6\u5019\u8ba9\u51fa CPU\uff0c\u53c2\u8003\u4e0b\u9762\u7684\u4ee3\u7801\uff1a <pre><code>void lock(my_lock *mutex) {\n    while(TestAndSet(&amp;mutex-&gt;flag, 1) == 1)\n        yield();\n}\n</code></pre></p> <p>\u5728\u8fd9\u79cd\u65b9\u6cd5\u4e2d\uff0c\u5047\u5b9a\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u539f\u8bed <code>yield()</code>\uff0c\u7ebf\u7a0b\u53ef\u4ee5\u8c03\u7528\u5b83\u4e3b\u52a8\u653e\u5f03 CPU\uff0c\u8ba9\u5176\u5b83\u7ebf\u7a0b\u8fd0\u884c\u3002</p> <p>\u5728\u8bb8\u591a\u7ebf\u7a0b\u7ade\u4e89\u540c\u4e00\u628a\u9501\u7684\u60c5\u51b5\u4e0b\uff0c\u7ebf\u7a0b\u8ba9\u6b65\u5c31\u4e0d\u592a\u597d\u4e86\u3002\u6bd4\u5982 100 \u4e2a\u7ebf\u7a0b\u7ade\u4e89\u4e00\u628a\u9501\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u6301\u6709\u9501\uff0c\u5728\u91ca\u653e\u9501\u4e4b\u524d\uff0c\u5176\u5b83 99 \u4e2a\u7ebf\u7a0b\u5206\u522b\u8c03\u7528 <code>lock()</code>\uff0c\u53d1\u73b0\u9501\u88ab\u62a2\u5360\uff0c\u7136\u540e\u8ba9\u51fa CPU\u3002\u95ee\u9898\u662f\uff0c\u7ade\u4e89\u7ebf\u7a0b\u867d\u7136\u8ba9\u51fa\u4e86 CPU\uff0c\u4f46\u662f\u8ba9\u51fa\u4e4b\u540e\u5904\u4e8e\u5c31\u7eea\u72b6\u6001\uff0c\u4ecd\u80fd\u83b7\u53d6 CPU \u65f6\u95f4\u3002\u90a3\u4e48\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u751a\u81f3\u6781\u7aef\u60c5\u51b5\u4e0b\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u80fd\u4e00\u76f4\u5904\u4e8e\u8ba9\u51fa\u5faa\u73af\uff0c\u9501\u7684\u6027\u80fd\u4ecd\u7136\u5f88\u4f4e\u3002</p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#_8","title":"\u4f11\u7720\u4ee3\u66ff\u81ea\u65cb","text":"<p>\u81ea\u65cb\u548c\u7ebf\u7a0b\u8ba9\u6b65\u771f\u6b63\u7684\u95ee\u9898\u662f\u5b58\u5728\u592a\u591a\u7684\u5076\u7136\u6027\uff0c\u5bfc\u81f4\u5728\u8f83\u591a\u7ebf\u7a0b\u65f6\uff0c\u9501\u7684\u6027\u80fd\u8f83\u4f4e\u3002\u56e0\u6b64\uff0c\u53ef\u4ee5\u65bd\u52a0\u4e00\u4e9b\u63a7\u5236\uff0c\u5e76\u4e14\u5728\u51b3\u5b9a\u91ca\u653e\u9501\u65f6\u5b9a\u80fd\u62a2\u5230\u9501\u3002\u4e3a\u4e86\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u66f4\u591a\u7684\u652f\u6301\uff0c\u5e76\u9700\u8981\u4e00\u4e2a\u961f\u5217\u6765\u4fdd\u5b58\u7b49\u5f85\u9501\u7684\u7ebf\u7a0b\u3002</p> <p>Solaris \u7cfb\u7edf\u63d0\u4f9b\u4e86\u4e24\u4e2a\u7cfb\u7edf\u8c03\u7528\uff1apark() \u80fd\u591f\u8ba9\u8c03\u7528\u7ebf\u7a0b\u4f11\u7720\uff0cunpark(threadID) \u5219\u4f1a\u5524\u9192 threadID \u6807\u8bc6\u7684\u7ebf\u7a0b\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>typedef struct lock_t {\n    int flag;\n    int guard;\n    queue_t *q;\n} lock_t;\n\nvoid lock_init(lock_t *m) {\n    m-&gt;flag = 0;\n    m-&gt;guard = 0;\n    queue_init(m-&gt;q);\n}\n\nvoid lock(lock_t *m) {\n    while(TestAndSet(&amp;m-&gt;guard, 1) == 1)\n        ;   // acquire guard lock by spinning\n\n    if(m-&gt;flag == 0) {\n        m-&gt;flag = 1;\n        m-&gt;guard = 0;\n    } else {\n        queue_add(m-&gt;q, gettid());\n        m-&gt;guard = 0;\n        park();\n    }\n}\n\nvoid unlock(lock_t *m) {\n    while(TestAndSet(&amp;m-&gt;guard, 1) == 1)\n        ; // acquire guard lock by spinning\n\n    if(queue_empty(m-&gt;q)) {\n        m-&gt;flag = 0;\n    } else {\n        unpark(queue_remove(m-&gt;q));\n    }\n\n    m-&gt;guard = 0;\n}\n</code></pre></p> <p>\u4e0a\u8ff0\u4ee3\u7801 guard \u57fa\u672c\u4e0a\u8d77\u5230\u4e86\u81ea\u65cb\u9501\u7684\u4f5c\u7528\uff0c\u56f4\u7ed5\u7740 flag \u548c\u961f\u5217\u64cd\u4f5c\u3002\u7ebf\u7a0b\u8bbe\u7f6e guard \u6210\u529f\u540e\uff0c\u4f1a\u8bbe\u7f6e flag\uff0c\u4e4b\u540e\u91ca\u653e guard\u3002\u65b0\u7684\u7ebf\u7a0b\u8bbe\u7f6e guard \u6210\u529f\u4e4b\u540e\u4f1a\u5224\u65ad flag \u7684\u503c\uff0c\u5224\u65ad\u5f53\u524d\u662f\u5426\u6709\u5176\u5b83\u7ebf\u7a0b\u5df2\u7ecf\u83b7\u5f97\u9501\uff0c\u5982\u679c\u6709\u5219 park() \u8fdb\u5165\u4f11\u7720\u72b6\u6001\uff0c\u7b49\u5f85 unpark() \u5524\u9192\u3002</p> <p>\u5f53\u5524\u9192\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u65f6\uff0cflag \u5e76\u6ca1\u6709\u8bbe\u7f6e\u4e3a 0\u3002\u7ebf\u7a0b\u88ab\u5524\u9192\u65f6\uff0c\u5c31\u50cf\u662f\u4ece park() \u8c03\u7528\u8fd4\u56de\u3002\u5c31\u50cf\u628a\u9501\u4ece\u91ca\u653e\u7684\u7ebf\u7a0b\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u83b7\u5f97\u9501\u7684\u7ebf\u7a0b\uff0c\u76f4\u5230\u961f\u5217\u4e3a\u7a7a\u624d\u5c06 flag \u8bbe\u7f6e\u4e3a 0\u3002</p> <p>\u5728 park() \u8c03\u7528\u4e4b\u524d\uff0c\u5982\u679c\u4e0d\u51d1\u5de7\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u5c06\u8981 park()\uff0c\u6b64\u65f6\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6bd4\u5982\u6301\u6709\u9501\u7684\u7ebf\u7a0b\uff0c\u6267\u884c\u4e86\u91ca\u653e\u9501\u7684\u4ee3\u7801\u3002\u90a3\u4e48\u524d\u4e00\u4e2a\u7ebf\u7a0b\u7684 park() \u5c06\u4f1a\u6c38\u8fdc\u4f11\u7720\u3002\u8fd9\u79cd\u95ee\u9898\u79f0\u4e3a\u5524\u9192/\u7b49\u5f85\u7ade\u4e89\uff08wakeup/waiting race\uff09\uff0c Solaris \u901a\u8fc7\u589e\u52a0 setpark() \u7cfb\u7edf\u8c03\u7528\u6765\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\u3002\u901a\u8fc7 setpark()\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u8868\u660e\u81ea\u5df1\u9a6c\u4e0a\u8981 park\uff0c\u5982\u679c\u521a\u597d\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u88ab\u8c03\u5ea6\uff0c\u5e76\u4e14\u8c03\u7528\u4e86 unpark()\uff0c\u90a3\u4e48\u540e\u7eed\u7684 park() \u8c03\u7528\u4f1a\u76f4\u63a5\u8fd4\u56de\uff0c\u800c\u4e0d\u662f\u4e00\u76f4\u7761\u7720\u3002lock() \u51fd\u6570\u53ef\u4ee5\u505a\u4e00\u70b9\u5c0f\u4fee\u6539\uff1a <pre><code>queue_add(m-&gt;q, gettid());\nsetpark();\nm-&gt;guard = 0;\npark();\n</code></pre></p> <p>\u8fd9\u6bb5\u4ee3\u7801\u8fd8\u6709\u4e00\u4e9b\u95ee\u9898\uff0c\u5982\u4f55\u786e\u4fdd flag \u548c guard \u4ee5\u53ca queue_t \u7684\u53ef\u89c6\u6027\uff1f</p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#linux-futex","title":"Linux futex","text":"<p>Linux \u63d0\u4f9b\u4e86\u5feb\u901f\u7528\u6237\u7a7a\u95f4\u4e92\u65a5\u91cf\uff08fast userspace mutex\uff0cfutex\uff09\uff0c\u6bcf\u4e2a futex \u90fd\u5173\u8054\u4e00\u4e2a\u7279\u5b9a\u7684\u7269\u7406\u5185\u5b58\u4f4d\u7f6e\uff0c\u4e5f\u6709\u4e00\u4e2a\u4e8b\u5148\u5efa\u597d\u7684\u5185\u6838\u961f\u5217\u3002</p> <p>\u6709\u4e24\u4e2a\u7cfb\u7edf\u8c03\u7528\uff1a<code>futex_wait(address\uff0cexpected)</code> \uff0c\u5982\u679c <code>address</code> \u5904\u7684\u503c\u7b49\u4e8e <code>expected</code>\uff0c\u5c31\u4f1a\u8ba9\u7ebf\u7a0b\u7761\u7720\uff0c\u5426\u5219\u7acb\u523b\u8fd4\u56de\uff1b<code>futex_wake(address)</code> \u5524\u9192\u7b49\u5f85\u961f\u5217\u4e2d\u7684\u4e00\u4e2a\u7ebf\u7a0b\u3002</p> <p>futex \u5229\u7528\u4e00\u4e2a\u6574\u6570\uff0c\u540c\u65f6\u8bb0\u5f55\u9501\u662f\u5426\u88ab\u6301\u6709\uff08\u6574\u6570\u7684\u6700\u9ad8\u4f4d\uff09\uff0c\u4ee5\u53ca\u7b49\u5f85\u9501\u7684\u4e2a\u6570\uff08\u6574\u6570\u7684\u5176\u4f59\u6240\u6709\u4f4d\uff09\u3002\u56e0\u6b64\uff0c\u5982\u679c\u9501\u662f\u8d1f\u7684\uff0c\u5b83\u5c31\u88ab\u6301\u6709\u3002</p> <pre><code>void mutex_lock(int *mutex)\n{\n    int v;\n    /* Bit 31 was clear, we got the mutex (the fastpath) */\n    if (atomic_bit_test_set(mutex, 31) == 0)\n        return;\n    atomic_increment(mutex);\n    while (1)\n    {\n        if (atomic_bit_test_set(mutex, 31) == 0)\n        {\n            atomic_decrement(mutex);\n            return;\n        }\n        /* We have to waitFirst make sure the futex value\n        we are monitoring is truly negative (locked). */\n        v = *mutex;\n        if (v &gt;= 0)\n            continue;\n        futex_wait(mutex, v);\n    }\n}\n\nvoid mutex_unlock(int *mutex)\n{\n    /* Adding 0x80000000 to counter results in 0 if and\n    only if there are not other interested threads */\n    if (atomic_add_zero(mutex, 0x80000000))\n        return;\n\n    /* There are other threads waiting for this mutex,\n    wake one of them up. */\n    futex_wake(mutex);\n}\n</code></pre> <p><code>atomic_bit_test_set()</code> \u51fd\u6570\u5c06\u6307\u5b9a\u7684\u4f4d\u8bbe\u7f6e\u4e3a 1\uff0c\u5e76\u8fd4\u56de\u539f\u6765\u7684\u503c\u3002\u793a\u4f8b\u4ee3\u7801\u4e2d\u5c06\u6700\u9ad8\u4f4d\u8bbe\u7f6e\u4e3a 1\uff0c\u6210\u529f\u8868\u793a\u83b7\u53d6\u9501\uff0c\u540c\u65f6 <code>*mutex</code> \u79f0\u4e3a\u8d1f\u6570\u3002</p> <p><code>atomic_add_zero()</code> \u5c06\u4e24\u4e2a\u6570\u76f8\u52a0\uff0c\u5e76\u5224\u65ad\u7ed3\u679c\u662f\u4e0d\u662f 0\u3002\u793a\u4f8b\u4ee3\u7801\u4e2d\u8be5\u51fd\u6570\u7684\u4f5c\u7528\u662f\u91ca\u653e\u9501\uff0c\u5e76\u4e14\u5982\u679c\u7ed3\u679c\u7b49\u4e8e 0 \u8868\u793a\u6ca1\u6709\u7b49\u5f85\u7684\u7ebf\u7a0b\uff0c\u76f4\u63a5\u8fd4\u56de\u3002</p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#_9","title":"\u4e92\u65a5\u91cf","text":"<p>\u53ef\u4ee5\u4f7f\u7528 pthread \u7684\u4e92\u65a5\u63a5\u53e3\u6765\u4fdd\u62a4\u6570\u636e\uff0c\u786e\u4fdd\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u6570\u636e\u3002\u4e92\u65a5\u91cf\uff08mutex\uff09\u672c\u8d28\u4e0a\u662f\u4e00\u628a\u9501\uff0c\u5728\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u524d\u5bf9\u4e92\u65a5\u91cf\u8fdb\u884c\u8bbe\u7f6e\uff08\u52a0\u9501\uff09\uff0c\u5728\u8bbf\u95ee\u5b8c\u6210\u540e\u91ca\u653e\u4e92\u65a5\u91cf\uff08\u89e3\u9501\uff09\u3002</p> <p>\u4e92\u65a5\u53d8\u91cf\u662f\u7528 <code>pthread_mutex_t</code> \u6570\u636e\u7c7b\u578b\u8868\u793a\u7684\u3002\u5728\u4f7f\u7528\u4e92\u65a5\u91cf\u4e4b\u524d\uff0c\u5fc5\u987b\u5bf9\u5b83\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u901a\u8fc7 <code>pthread_mutex_init</code> \u51fd\u6570\u3002\u5982\u679c\u52a8\u6001\u5206\u914d\u4e92\u65a5\u91cf\uff08\u4f8b\u5982\uff0c\u901a\u8fc7 maolloc \u51fd\u6570\uff09\uff0c\u5728\u91ca\u653e\u5185\u5b58\u4e4b\u524d\u9700\u8981\u8c03\u7528 <code>pthread_mutex_destory</code>\u3002 <pre><code>#include &lt;pthread.h&gt;\n\nint pthread_mutex_init(pthread_mutex_t *restrict mutex, const pthread_mutexattr_t *restrict attr);\n\nint pthread_mutex_destory(pthread_mutex_t *mutex);\n</code></pre> \u8981\u7528\u9ed8\u8ba4\u7684\u5c5e\u6027\u521d\u59cb\u5316\u4e92\u65a5\u91cf\uff0c\u53ea\u9700\u8981 \u628a <code>attr</code> \u8bbe\u7f6e NULL\u3002</p> <p>\u5bf9\u4e92\u65a5\u91cf\u8fdb\u884c\u52a0\u9501\uff0c\u8c03\u7528 <code>pthread_mutex_lock</code>\u3002\u5982\u679c\u4e92\u65a5\u91cf\u5df2\u7ecf\u4e0a\u9501\uff0c\u8c03\u7528\u7ebf\u7a0b\u5c06\u963b\u585e\u76f4\u5230\u4e92\u65a5\u91cf\u88ab\u89e3\u9501\u3002\u5bf9\u4e92\u65a5\u91cf\u89e3\u9501\uff0c\u9700\u8981\u8c03\u7528 <code>pthread_mutex_unlock</code>\u3002\u5982\u679c\u4e0d\u5e0c\u671b\u7ebf\u7a0b\u88ab\u963b\u585e\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>pthread_mutex_trylock</code> \u5c1d\u8bd5\u5bf9\u4e92\u65a5\u91cf\u8fdb\u884c\u52a0\u9501\u3002\u5982\u679c\u8c03\u7528 <code>pthread_mutex_trylock</code> \u65f6\u4e92\u65a5\u91cf\u5904\u4e8e\u672a\u9501\u4f4f\u72b6\u6001\uff0c\u90a3\u4e48 <code>pthread_mutex_trylock</code> \u5c06\u9501\u4f4f\u4e92\u65a5\u91cf\uff0c\u4e0d\u4f1a\u51fa\u73b0\u963b\u585e\u76f4\u63a5\u8fd4\u56de 0\uff0c\u5426\u5219 <code>pthread_mutex_trylock</code> \u5c31\u4f1a\u5931\u8d25\uff0c\u4e0d\u80fd\u9501\u4f4f\u4e92\u65a5\u91cf\uff0c\u8fd4\u56de <code>EBUSY</code>\u3002 <pre><code>#include &lt;pthread.h&gt;\n\nint pthread_mutex_lock(pthread_mutex_t *mutex);\n\nint pthread_mutex_trylock(pthread_mutex_t *mutex);\n\nint pthread_mutex_unlock(pthread_mutex_t *mutex);\n</code></pre></p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>#include &lt;stdio.h&gt;\n#include &lt;pthread.h&gt;\n\nstruct foo{\n    int f_count;\n    pthread_mutex_t f_lock;\n    int f_id;\n};\n\nstruct foo *foo_alloc(int id) {\n    struct foo *fp;\n    if((fp = malloc(sizeof(struct foo))) != NULL) {\n        fp-&gt;f_count = 1;\n        fp-&gt;f_id = id;\n        if(pthread_mutex_init(&amp;fp-&gt;f_lock, NULL) != 0) {\n            free(fp);\n            return NULL;\n        }\n    }\n    return fp;\n}\n\nvoid foo_hold(struct foo *fp) {\n    pthread_mutex_lock(&amp;fp-&gt;f_lock);\n    fp-&gt;f_count ++;\n    pthread_mutex_unlock(&amp;fp-&gt;f_lock);\n}\n</code></pre></p> <p>\u5f53\u7ebf\u7a0b\u8bd5\u56fe\u83b7\u53d6\u4e00\u4e2a\u5df2\u7ecf\u52a0\u9501\u7684\u4e92\u65a5\u91cf\u65f6\uff0c<code>pthread_mutex_timedlock</code> \u51fd\u6570\u5141\u8bb8\u7ed1\u5b9a\u7ebf\u7a0b\u963b\u585e\u65f6\u95f4\u3002<code>pthread_mutex_timedlock</code> \u51fd\u6570\u4e0e <code>pthread_mutex_lock</code> \u662f\u57fa\u672c\u7b49\u4ef7\u7684\uff0c\u4f46\u662f\u5728\u8fbe\u5230\u8d85\u65f6\u65f6\u95f4\u503c\u65f6\uff0c<code>pthread_mutex_timedlock</code> \u8fd4\u56de\u9519\u8bef\u4ee3\u7801 <code>ETIMEDOUT</code>\u3002 <pre><code>#include &lt;pthread.h&gt;\n#include &lt;time.h&gt;\n\nint pthread_mutex_timedlock(pthread_mutex_t *restrict mutex,\n                            const struct timespec *restrict tsptr);\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#_10","title":"\u8bfb\u5199\u9501","text":"<p>\u8bfb\u5199\u9501\uff08reader-wirter lock\uff09\u4e0e\u4e92\u65a5\u91cf\u7c7b\u4f3c\uff0c\u4e0d\u8fc7\u8bfb\u5199\u9501\u5141\u8bb8\u66f4\u9ad8\u7684\u5e76\u884c\u6027\u3002\u4e92\u65a5\u91cf\u8981\u4e48\u662f\u9501\u4f4f\u72b6\u6001\uff0c\u8981\u4e48\u5c31\u662f\u4e0d\u52a0\u9501\u72b6\u6001\uff0c\u800c\u4e14\u4e00\u6b21\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u5bf9\u5176\u52a0\u9501\u3002\u8bfb\u5199\u9501\u53ef\u4ee5\u6709 3 \u79cd\u72b6\u6001\uff1a\u8bfb\u6a21\u5f0f\u4e0b\u52a0\u9501\u72b6\u6001\uff0c\u5199\u6a21\u5f0f\u4e0b\u52a0\u9501\u72b6\u6001\uff0c\u4e0d\u52a0\u9501\u72b6\u6001\u3002\u4e00\u6b21\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u5360\u6709\u5199\u6a21\u5f0f\u7684\u8bfb\u5199\u9501\uff0c\u4f46\u662f\u591a\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u540c\u65f6\u5360\u6709\u8bfb\u6a21\u5f0f\u7684\u8bfb\u5199\u9501\u3002</p> <ul> <li> <p>\u5f53\u8bfb\u5199\u9501\u662f\u5199\u52a0\u9501\u72b6\u6001\u65f6\uff0c\u5728\u8fd9\u4e2a\u9501\u88ab\u89e3\u9501\u4e4b\u524d\uff0c\u6240\u6709\u8bd5\u56fe\u5bf9\u8fd9\u4e2a\u9501\u52a0\u9501\u7684\u7ebf\u7a0b\u90fd\u4f1a\u88ab\u963b\u585e\u3002</p> </li> <li> <p>\u5f53\u8bfb\u5199\u9501\u5728\u8bfb\u52a0\u9501\u72b6\u6001\u65f6\uff0c\u6240\u6709\u8bd5\u56fe\u4ee5\u8bfb\u6a21\u5f0f\u5bf9\u5b83\u8fdb\u884c\u52a0\u9501\u7684\u7ebf\u7a0b\u90fd\u53ef\u4ee5\u5f97\u5230\u8bbf\u95ee\u6743\uff0c\u4f46\u662f\u4efb\u4f55\u5e0c\u671b\u4ee5\u5199\u6a21\u5f0f\u5bf9\u6b64\u9501\u8fdb\u884c\u52a0\u9501\u7684\u7ebf\u7a0b\u90fd\u4f1a\u963b\u585e\uff0c\u76f4\u5230\u6240\u6709\u7684\u7ebf\u7a0b\u91ca\u653e\u5b83\u4eec\u7684\u8bfb\u9501\u4e3a\u6b62\u3002</p> </li> <li> <p>\u5f53\u8bfb\u5199\u9501\u5904\u4e8e\u8bfb\u6a21\u5f0f\u52a0\u9501\u72b6\u6001\u65f6\uff0c\u800c\u8fd9\u65f6\u6709\u4e00\u4e2a\u7ebf\u7a0b\u8bd5\u56fe\u4ee5\u5199\u6a21\u5f0f\u83b7\u53d6\u9501\u65f6\uff0c\u8bfb\u5199\u9501\u901a\u5e38\u4f1a\u963b\u585e\u968f\u540e\u7684\u8bfb\u6a21\u5f0f\u9501\u8bf7\u6c42\u3002\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u8bfb\u6a21\u5f0f\u9501\u957f\u671f\u5360\u7528\uff0c\u800c\u7b49\u5f85\u7684\u5199\u6a21\u5f0f\u9501\u8bf7\u6c42\u4e00\u76f4\u5f97\u4e0d\u5230\u6ee1\u8db3\u3002</p> </li> </ul> <p>\u8bfb\u5199\u9501\u975e\u5e38\u9002\u5408\u5bf9\u4e8e\u6570\u636e\u7ed3\u6784\u8bfb\u7684\u6b21\u6570\u8fdc\u5927\u4e8e\u5199\u7684\u60c5\u51b5\u3002\u8bfb\u5199\u9501\u4e5f\u53eb\u505a\u5171\u4eab\u4e92\u65a5\u9501\uff08shared-exclusive lock\uff09\u3002\u5f53\u8bfb\u5199\u9501\u662f\u8bfb\u6a21\u5f0f\u9501\u4f4f\u65f6\uff0c\u5c31\u53ef\u4ee5\u8bf4\u6210\u662f\u4ee5\u5171\u4eab\u6a21\u5f0f\u9501\u4f4f\u7684\u3002\u5f53\u5b83\u662f\u5199\u6a21\u5f0f\u9501\u4f4f\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u8bf4\u6210\u662f\u4ee5\u4e92\u65a5\u6a21\u5f0f\u9501\u4f4f\u7684\u3002</p> <p>\u8bfb\u5199\u9501\u7684\u521d\u59cb\u5316\u548c\u9500\u6bc1\uff1a <pre><code>#include &lt;pthread.h&gt;\n\nint pthread_rwlock_init(pthread_rwlock_t *restrict rwlock, const pthread_rwlockattr_t *restrict attr);\n\nint pthread_rwlock_destory(pthread_rwlock_t *rwlock);\n</code></pre></p> <p>\u8bfb\u5199\u9501\u7684\u52a0\u9501\u548c\u89e3\u9501\uff1a <pre><code>#include &lt;pthread.h&gt;\n\nint pthread_rwlock_rdlock(pthread_rwlock_t *rwlock);\n\nint pthread_rwlock_wrlock(pthread_rwlock_t *rwlock);\n\nint pthread_rwlock_unlock(pthread_rwlock_t *rwlock);\n</code></pre></p> <p>\u8bfb\u5199\u9501\u7684\u975e\u963b\u585e\u83b7\u9501\u7248\u672c\u3002\u53ef\u4ee5\u83b7\u53d6\u9501\u65f6\uff0c\u8fd9\u4e24\u4e2a\u51fd\u6570\u8fd4\u56de 0\u3002\u5426\u5219\u5b83\u4eec\u8fd4\u56de\u9519\u8bef EBUSY\u3002 <pre><code>#include &lt;pthread.h&gt;\n\nint pthread_rwlock_tryrdlock(pthread_rwlock_t *rwlock);\n\nint pthread_rwlock_trywrlock(pthread_rwlock_t *rwlock);\n</code></pre></p> <p>\u8bfb\u5199\u9501\u5e26\u6709\u8d85\u65f6\u7684\u52a0\u9501\u51fd\u6570\uff0c\u5982\u679c\u8d85\u65f6\u5230\u671f\u6ca1\u6709\u83b7\u53d6\u5230\u9501\uff0c\u8fd9\u4e24\u4e2a\u51fd\u6570\u5c06\u8fd4\u56de <code>ETIMEDOUT</code> \u9519\u8bef\u3002 <pre><code>#include &lt;pthread.h&gt;\n#include &lt;time.h&gt;\n\nint pthread_rwlock_timedrdlock(pthread_rwlock_t *restrict rwlock, const struct timespec *retrict tsptr);\n\nint pthread_rwlock_timedwrlock(pthread_rwlock_t *restrict rwlock, const struct timespec *retrict tsptr);\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#_11","title":"\u6761\u4ef6\u53d8\u91cf","text":"<p>\u901a\u8fc7\u9501\uff0c\u80fd\u591f\u5b9e\u73b0\u4e92\u65a5\u8bbf\u95ee\u548c\u539f\u5b50\u6027\u7684\u6267\u884c\u4e00\u7cfb\u5217\u6267\u884c\u7684\u613f\u671b\u3002\u7136\u800c\uff0c\u9501\u5e76\u4e0d\u662f\u5e76\u53d1\u7a0b\u5e8f\u8bbe\u8ba1\u6240\u9700\u7684\u552f\u4e00\u539f\u8bed\u3002\u5728\u4e00\u4e9b\u60c5\u51b5\u4e0b\uff0c\u7ebf\u7a0b\u9700\u8981\u68c0\u67e5\u67d0\u4e00\u6761\u4ef6\u6ee1\u8db3\u4e4b\u540e\uff0c\u624d\u4f1a\u7ee7\u7eed\u8fd0\u884c\u3002\u4f8b\u5982\uff0c\u7236\u7ebf\u7a0b\u68c0\u67e5\u5b50\u7ebf\u7a0b\u662f\u5426\u6267\u884c\u5b8c\u6bd5\uff0c\u8fd9\u79cd\u7b49\u5f85\u5982\u4f55\u5b9e\u73b0\u5462\uff1f</p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#volatile","title":"<code>volatile</code> \u5b9e\u73b0\u7b49\u5f85","text":"<p>\u4e00\u79cd\u7b80\u5355\u7684\u5b9e\u73b0\u7b49\u5f85\u7684\u65b9\u5f0f\u662f <code>volatile</code> \u548c\u81ea\u65cb\u914d\u5408\u5b9e\u73b0\u7b49\u5f85\u3002\u6bd4\u5982 A \u7ebf\u7a0b\u8981\u7b49\u5f85 B \u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\uff0c\u90a3\u4e48\u5b9a\u4e49 <code>volatile int b_finish_flag = 0</code>\uff0c\u5728\u7ebf\u7a0b B \u6267\u884c\u5b8c\u6bd5\u4e4b\u540e\uff0c\u4fee\u6539\u53d8\u91cf\u7684\u503c\uff0cA \u7ebf\u7a0b\u4e00\u81f4\u81ea\u65cb\u7b49\u5f85 B \u5b8c\u6210\u3002\u56e0\u4e3a <code>volatile</code> \u5173\u952e\u5b57\u80fd\u591f\u4fdd\u8bc1\u53ef\u89c6\u6027\u3002 \u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>#include &lt;stdio.h&gt;\n#include &lt;pthread.h&gt;\n\nvoid *child(void *arg);\n\nvolatile int b_finish_flag = 0;\n\nint main() {\n    printf(\"A: begin\\n\");\n\n    pthread_t b;\n    pthread_create(&amp;b, NULL, child, \"B\");\n\n    while(b_finish_flag == 0)\n        ;\n    printf(\"A: end\\n\");\n    return 0;\n}\n\nvoid *child(void *arg) {\n    printf(\"hello, i'm %s\\n\", arg);\n    b_finish_flag = 1;\n    return NULL;\n}\n</code></pre></p> <p>\u6267\u884c\u4ee3\u7801\u8f93\u51fa\uff1a <pre><code># ./a.out \nA: begin\nhello, i'm B\nA: end\n</code></pre></p> <p>\u4e0a\u8ff0\u65b9\u6848\u6709\u4e24\u4e2a\u95ee\u9898\uff0c\u6027\u80fd\u548c\u6269\u5c55\u6027\u3002\u4e3b\u7ebf\u7a0b\u81ea\u9009\u68c0\u67e5\u4f1a\u6d6a\u8d39 CPU \u65f6\u95f4\uff0c\u591a\u7ebf\u7a0b\u7b49\u5f85\u66f4\u751a\u3002</p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#_12","title":"\u6761\u4ef6\u53d8\u91cf\u5b9e\u73b0\u7b49\u5f85","text":"<p>\u7ebf\u7a0b\u53ef\u4ee5\u4f7f\u7528\u6761\u4ef6\u53d8\u91cf\uff0c\u6765\u7b49\u5f85\u4e00\u4e2a\u6761\u4ef6\u6210\u771f\u3002\u6761\u4ef6\u53d8\u91cf\u662f\u4e00\u4e2a\u663e\u793a\u961f\u5217\uff0c\u5f53\u67d0\u4e9b\u6761\u4ef6\u4e0d\u6ee1\u8db3\u65f6\uff0c\u7ebf\u7a0b\u53ef\u4ee5\u628a\u81ea\u5df1\u52a0\u5165\u961f\u5217\uff0c\u7b49\u5f85\u8be5\u6761\u4ef6\u3002\u53e6\u5916\u67d0\u4e2a\u7ebf\u7a0b\uff0c\u5f53\u5b83\u6539\u53d8\u4e86\u4e0a\u8ff0\u72b6\u6001\u65f6\uff0c\u5c31\u53ef\u4ee5\u5524\u9192\u4e00\u4e2a\u6216\u591a\u4e2a\u7ebf\u7a0b\u3002</p> <p>\u6761\u4ef6\u53d8\u91cf\u7684\u7c7b\u578b\u662f <code>pthread_cond_t</code>\uff0c\u6709 <code>wait()</code> \u548c <code>single()</code> \u4e24\u79cd\u64cd\u4f5c\u3002\u7ebf\u7a0b\u8c03\u7528 <code>wait()</code> \u8fdb\u5165\u4f11\u7720\uff0c\u5f53\u7ebf\u7a0b\u60f3\u5524\u9192\u7b49\u5f85\u5728\u67d0\u4e2a\u6761\u4ef6\u53d8\u91cf\u4e0a\u7761\u7720\u7684\u7ebf\u7a0b\u65f6\uff0c\u8c03\u7528 <code>single()</code>\u3002</p> <p>\u6761\u4ef6\u53d8\u91cf\u672c\u8eab\u662f\u7531\u4e92\u65a5\u91cf\u4fdd\u62a4\u7684\uff0c\u7ebf\u7a0b\u5728\u6539\u53d8\u6761\u4ef6\u72b6\u6001\u4e4b\u524d\u5fc5\u987b\u9996\u5148\u9501\u4f4f\u4e92\u65a5\u91cf\u3002</p> <ul> <li> <p>\u6761\u4ef6\u53d8\u91cf\u662f\u4e34\u754c\u8d44\u6e90\uff0c\u90a3\u4e48\u4fee\u6539\u4e34\u754c\u8d44\u6e90\u9996\u5148\u8981\u52a0\u9501\u3002</p> </li> <li> <p>\u7ebf\u7a0b\u5728\u6761\u4ef6\u4e0d\u6ee1\u8db3\u4e4b\u540e\uff0c\u8c03\u7528 wait() \u8fdb\u5165\u963b\u585e\u4f11\u7720\u5e76\u91ca\u653e\u9501\uff0c\u7b49\u5f85\u5176\u5b83\u7ebf\u7a0b\u83b7\u53d6\u9501\u4fee\u6539\u4e34\u754c\u8d44\u6e90\u3002</p> </li> <li> <p>\u5f53\u7ebf\u7a0b\u88ab\u5524\u9192\u540e\uff0c\u5b83\u4f1a\u91cd\u65b0\u5c1d\u8bd5\u83b7\u53d6\u9501\u3002\u53ea\u6709\u5728\u91cd\u65b0\u83b7\u9501\u540e\uff0c\u7ebf\u7a0b\u624d\u4f1a\u4ece wait() \u8fd4\u56de\u5e76\u7ee7\u7eed\u6267\u884c\u3002</p> </li> </ul> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>#include &lt;stdio.h&gt;\n#include &lt;pthread.h&gt;\n\nint done = 0;\npthread_mutex_t m = PTHREAD_MUTEX_INITIALIZER;\npthread_cond_t c = PTHREAD_COND_INITIALIZER;\n\nvoid thr_exit() {\n    pthread_mutex_lock(&amp;m);\n    done = 1;\n    pthread_cond_signal(&amp;c);\n    pthread_mutex_unlock(&amp;m);\n}\n\nvoid *child(void *arg) {\n    printf(\"hellom i'm %s\\n\", arg);\n    thr_exit();\n    return NULL;\n}\n\nvoid thr_join() {\n    pthread_mutex_lock(&amp;m);\n    while(done == 0)\n        pthread_cond_wait(&amp;c, &amp;m);\n    pthread_mutex_unlock(&amp;m);\n}\n\nint main() {\n    printf(\"parent: begin\\n\");\n    pthread_t p;\n    pthread_create(&amp;p, NULL, child, \"B\");\n    thr_join();\n    printf(\"parent: end\\n\");\n    return 0;\n}\n</code></pre></p> <p>wait() \u8c03\u7528\u6709\u4e00\u4e2a\u53c2\u6570\u662f\u4e92\u65a5\u91cf\uff0c\u5b83\u5047\u5b9a wait() \u8c03\u7528\u65f6\u8fd9\u4e2a\u4e92\u65a5\u91cf\u662f\u5df2\u4e0a\u9501\u72b6\u6001\uff0cwait() \u8c03\u7528\u4f1a\u91ca\u653e\u9501\u5e76\u8ba9\u8c03\u7528\u7ebf\u7a0b\u4f11\u7720\u3002wait() \u8c03\u7528\u8fd4\u56de\u65f6\uff0c\u4e92\u65a5\u91cf\u518d\u6b21\u88ab\u9501\u4f4f\u3002</p> <p>while \u5faa\u73af\u662f\u6709\u610f\u4e49\u7684\uff0c\u9996\u5148\u662f\u89e3\u51b3\u4e86\u865a\u5047\u5524\u9192\u7684\u95ee\u9898\uff0c\u7ebf\u7a0b\u5728\u6ca1\u6709\u63a5\u6536\u5230\u901a\u77e5\u7684\u60c5\u51b5\u4e0b\u4ece wait \u8fd4\u56de\uff0c\u867d\u7136\u8fd9\u4e2a\u95ee\u9898\u4e0d\u5e38\u89c1\uff1b\u53e6\u4e00\u79cd\u60c5\u51b5\u662f\u591a\u4e2a\u6d88\u8d39\u8005\u88ab\u5524\u9192\uff0c\u5982\u679c\u5176\u4e2d\u4e00\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u6d88\u606f\u4f7f\u961f\u5217\u4e3a\u7a7a\uff0c\u90a3\u4e48\u5176\u5b83\u7ebf\u7a0b\u8981\u91cd\u65b0\u68c0\u67e5\u961f\u5217\uff0c\u53ef\u80fd\u518d\u6b21\u4e3a\u7a7a\uff0c\u56e0\u6b64\u9700\u8981\u7ee7\u7eed\u7b49\u5f85\u3002</p> <p>\u4e92\u65a5\u91cf\u7684\u4f7f\u7528\u4e5f\u662f\u6709\u610f\u4e49\u7684\uff0c\u6ca1\u6709\u4e92\u65a5\u91cf\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u7236\u7ebf\u7a0b\u5728\u68c0\u67e5\u5b8c\u6761\u4ef6\u5728 wait() \u8c03\u7528\u4e4b\u524d\uff0c\u6b64\u65f6\u5207\u6362\u4e86\u5b50\u7ebf\u7a0b\u6267\u884c\uff0c\u5b50\u7ebf\u7a0b\u4fee\u6539\u4e86\u53d8\u91cf done \u4e3a 1\uff0c\u53d1\u51fa\u4fe1\u53f7\uff0c\u540c\u6837\u6ca1\u6709\u7b49\u5f85\u7ebf\u7a0b\u3002\u7236\u7ebf\u7a0b\u518d\u6b21\u8fd0\u884c\u65f6\uff0c\u5c31\u4f1a\u957f\u7720\u4e0d\u9192\u4e86\u3002</p> <p>\u6761\u4ef6\u53d8\u91cf\u8c03\u7528 single \u548c wait \u65f6\u8981\u6301\u6709\u9501\uff01</p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#_13","title":"\u751f\u4ea7\u6d88\u8d39\u6a21\u578b","text":"<p>\u6761\u4ef6\u53d8\u91cf\u4e00\u4e2a\u6709\u7528\u7684\u573a\u666f\u5c31\u662f\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u6a21\u578b\uff0c\u751f\u4ea7\u6d88\u8d39\u6a21\u578b\u6709\u51e0\u4e2a\u8981\u6c42:  </p> <ul> <li>\u80fd\u591f\u6b63\u786e\u7684\u5e76\u53d1\u8bbf\u95ee\u3002</li> <li>\u5982\u679c\u751f\u4ea7\u6ee1\u4e86\uff0c\u90a3\u4e48\u751f\u4ea7\u8005\u8981\u963b\u585e\u4f11\u7720\uff0c\u76f4\u5230\u6709\u6d88\u8d39\u8005\u6d88\u8d39\u4e86\u6d88\u606f\uff0c\u7136\u540e\u5524\u9192\u751f\u4ea7\u8005\u3002</li> <li>\u5982\u679c\u6d88\u8d39\u7a7a\u4e86\uff0c\u90a3\u4e48\u6d88\u8d39\u8005\u8981\u963b\u585e\u4f11\u7720\uff0c\u76f4\u5230\u6709\u751f\u4ea7\u8005\u751f\u4ea7\u4e86\u6d88\u606f\uff0c\u7136\u540e\u5524\u9192\u6d88\u8d39\u7740\u3002</li> </ul> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>#include &lt;pthread.h&gt;\n\nint buffer[MAX];\nint fill = 0;\nint use = 0;\nint count = 0;\n\nvoid put(int value)\n{\n    buffer[fill] = value;\n    fill = (fill + 1) % MAX;\n    count++;\n}\n\nint get()\n{\n    int tmp = buffer[use];\n    use = (use + 1) % MAX;\n    count--;\n    return tmp;\n}\n\npthread_cond_t empty, fill;\nmutex_t mutex;\n\nvoid *producer(void *arg) {\n    int i;\n    for(i = 0; i &lt; loops; i ++) {\n        pthread_mutex_lock(&amp;mutex);\n        while(count == MAX) {\n            pthread_cond_wait(&amp;empty, &amp;mutex);\n        }\n        put(i);\n        pthread_cond_signal(&amp;fill);\n        pthread_mutex_unlock(&amp;mutex);\n    }\n}\n\nvoid *consume(void *arg) {\n    int i;\n    for(i = 0; i &lt; loops; i ++) {\n        pthread_mutex_lock(&amp;mutex);\n        while(count == 0) {\n            pthread_cond_wait(&amp;fill, &amp;mutex);\n        }\n        int tmp = get();\n        pthread_cond_signal(&amp;empty);\n        pthread_mutex_unlock(&amp;mutex);\n        printf(\"%d\\n\", tmp);\n    }\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#_14","title":"\u4fe1\u53f7\u91cf","text":"<p>\u4fe1\u53f7\u91cf\u662f\u6709\u4e00\u4e2a\u6574\u6570\u503c\u7684\u5bf9\u8c61\uff0c\u4fe1\u53f7\u91cf\u7684\u58f0\u660e\u548c\u521d\u59cb\u5316\uff1a <pre><code>#include &lt;semaphore.h&gt;\n\nsem_t s\nsem_init(&amp;s, 0, 1);\n</code></pre> \u521d\u59cb\u5316\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u4fe1\u53f7\u91cf\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u8bbe\u7f6e\u4e3a 0\uff0c\u8868\u793a\u4fe1\u53f7\u91cf\u5728\u540c\u610f\u8fdb\u7a0b\u7684\u591a\u4e2a\u7ebf\u7a0b\u662f\u5171\u4eab\u7684\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u5c06\u4fe1\u53f7\u91cf\u7684\u521d\u59cb\u503c\u8bbe\u7f6e\u4e3a 1\u3002</p> <p>\u53ef\u4ee5\u7528\u4e24\u4e2a\u51fd\u6570\u6765\u64cd\u4f5c\u4fe1\u53f7\u91cf\u3002\u5728 POSIX \u6807\u51c6\u4e2d\uff0c\u662f sem_wait() \u548c sem_post()\u3002\u9996\u5148\uff0csem_wait() \u4f1a\u5c06\u4fe1\u53f7\u91cf\u7684\u503c\u51cf\u53bb 1\uff0c\u5982\u679c\u7ed3\u679c\u5927\u4e8e\u7b49\u4e8e 0\uff0c\u5219 sem_wait() \u7acb\u523b\u8fd4\u56de\uff0c\u5426\u5219\u4f1a\u8ba9\u8c03\u7528\u7ebf\u7a0b\u6302\u8d77\u3002sem_post() \u76f4\u63a5\u589e\u52a0\u4fe1\u53f7\u91cf\u7684\u503c\uff0c\u5982\u679c\u6709\u7b49\u5f85\u7ebf\u7a0b\uff0c\u5219\u5524\u9192\u5176\u4e2d\u4e00\u4e2a\u3002\u5f53\u4fe1\u53f7\u91cf\u7684\u503c\u4e3a\u8d1f\u6570\u65f6\uff0c\u8fd9\u4e2a\u503c\u5c31\u662f\u7b49\u5f85\u7ebf\u7a0b\u7684\u4e2a\u6570\u3002</p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#_15","title":"\u4e8c\u503c\u4fe1\u53f7\u91cf","text":"<p>\u4e8c\u503c\u4fe1\u53f7\u91cf\u5c06\u4fe1\u53f7\u91cf\u7684\u503c\u521d\u59cb\u5316\u4e3a 1\uff0c\u4e8c\u503c\u4fe1\u53f7\u91cf\u548c\u4e92\u65a5\u91cf\uff08\u9501\uff09\u5728\u8bed\u4e49\u4e0a\u662f\u7b49\u4ef7\u7684\u3002</p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#_16","title":"\u4fe1\u53f7\u91cf\u5b9e\u73b0\u7b49\u5f85","text":"<p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>#include &lt;stdio.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;semaphore.h&gt;\n\nsem_t s;\n\nvoid *child(void *arg) {\n    printf(\"hello, i'm %s\\n\", arg);\n    sem_post(&amp;s);\n    return NULL;\n}\n\nint main() {\n    sem_init(&amp;s, 0, 0);\n    printf(\"parent: begin\\n\");\n    pthread_t c;\n    pthread_create(&amp;c, NULL, child, \"B\");\n    sem_wait(&amp;s);\n    printf(\"parent: end\\n\");\n    return 0;\n}\n</code></pre></p> <p>\u65e0\u8bba\u662f\u7236\u7ebf\u7a0b\u8fd8\u662f\u5b50\u7ebf\u7a0b\u5148\u6267\u884c\uff0c\u90fd\u4f1a\u8f93\u51fa\u5982\u4e0b\u7ed3\u679c\uff1a <pre><code># ./a.out \nparent: begin\nhello, i'm B\nparent: end\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/#qa","title":"QA","text":"<ol> <li> <p>\u5982\u4f55\u5b9e\u73b0\u53ef\u91cd\u5165\u7684\u9501\uff1f</p> </li> <li> <p>\u4e3a\u4ec0\u4e48\u6c47\u7f16\u6307\u4ee4\u9700\u8981\u52a0\u4e0a <code>LOCK</code> \u524d\u7f00\uff1f\u4e34\u754c\u533a\u7684\u72b6\u6001\u53d8\u66f4\u5982\u4f55\u4fdd\u8bc1\u5168\u5c40\u53ef\u89c6\uff1f</p> </li> <li> <p>\u5982\u4f55\u5b9e\u73b0\u8bfb\u5199\u9501\uff1f</p> </li> <li> <p>Java \u901a\u8fc7\u9501\u80fd\u591f\u5b9e\u73b0\u4e92\u65a5\u8bbf\u95ee\uff0c\u4f46\u662f\u6267\u884c\u5b8c\u4e34\u754c\u533a\u7684\u4ee3\u7801\u4e4b\u540e\u5982\u4f55\u4fdd\u8bc1\u5168\u5c40\u53d8\u91cf\u7684\u53ef\u89c6\u6027\uff1f</p> <p>\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u89e3\u9501\uff0c\u90a3\u4e48\u7d27\u8ddf\u7740\u52a0\u9501\u7684\u7ebf\u7a0b\u662f\u80fd\u591f\u770b\u5230\u4e0a\u4e00\u4e2a\u7ebf\u7a0b\u7684\u6539\u53d8\u7684\uff0c\u7531 Happen-before \u89c4\u5219\u7ea6\u675f\u3002 \u90a3\u4e48 Happen-before \u5e95\u5c42\u53c8\u662f\u5982\u679c\u5b9e\u73b0\u7684\u5462\uff1fhttps://gee.cs.oswego.edu/dl/jmm/cookbook.html</p> </li> <li> <p>Java \u5bf9\u8c61\u5934\u7684\u7ed3\u6784\u662f\u4ec0\u4e48\uff1f\u5728\u7531\u65e0\u9501-&gt;\u8f7b\u91cf\u7ea7\u9501-&gt;\u91cd\u91cf\u7ea7\u9501\u8fc7\u7a0b\u4e2d CAS \u7684\u53c2\u6570\u662f\u4ec0\u4e48\uff1f\u5982\u4f55\u83b7\u53d6\u8fd9\u4e9b\u53c2\u6570\uff1f</p> </li> </ol>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E4%BB%8B%E7%BB%8D/","title":"\u6c47\u7f16\u2014\u2014\u4ecb\u7ecd","text":""},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E4%BB%8B%E7%BB%8D/#_1","title":"\u53d1\u5c55\u5386\u53f2","text":"<p>1947 \u5e74\uff0c\u8d1d\u5c14\u5b9e\u9a8c\u5ba4\u53d1\u660e\u4e86\u6676\u4f53\u7ba1\uff0c1958 \u5e74\u7f8e\u56fd\u4eba\u6770\u514b\u00b7\u57fa\u5c14\u53d1\u660e\u4e86\u96c6\u6210\u7535\u8def\uff0c1971 \u5e74 Intel \u516c\u53f8\u751f\u4ea7\u4e86\u4e16\u754c\u4e0a\u7b2c\u4e00\u4e2a\u5904\u7406\u5668 4004\u3002 1978 \u5e74\uff0cIntel \u516c\u53f8\u7b2c\u4e00\u6b3e 16 \u4f4d\u5904\u7406\u5668 8086 \u53d1\u5e03\uff0c\u662f Intel 32 \u4f4d\u67b6\u6784\uff08IA-32\uff09\u5904\u7406\u5668\u7684\u5f00\u5c71\u9f3b\u7956\u3002</p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E4%BB%8B%E7%BB%8D/#_2","title":"\u7f16\u8bd1\u5668\u9009\u62e9","text":"<p>nasm\u3001fasm\u3001yasm\u3001masm\u3001gas \u90fd\u662f\u6c47\u7f16\u7f16\u8bd1\u5668\u3002\u524d\u4e09\u4e2a\u90fd\u662f\u5f00\u6e90\u7684\u6c47\u7f16\u7f16\u8bd1\u5668\uff0c\u4f7f\u7528\u7684\u90fd\u662f Intel \u7684\u8bed\u6cd5\u3002masm \u662f\u5fae\u8f6f\u53d1\u5e03\u7684\u6c47\u7f16\u7f16\u8bd1\u5668\uff0c \u5df2\u7ecf\u505c\u6b62\u5355\u72ec\u53d1\u5e03\uff0c\u88ab\u6574\u5408\u5728 Visual Studio \u4e2d\u3002gas \u662f Linux \u5e73\u53f0\u4e0a\u7684\u514d\u8d39\u7684\u5f00\u6e90\u6c47\u7f16\u7f16\u8bd1\u5668\uff0c\u4f7f\u7528\u7684\u662f AT&amp;T \u7684\u6c47\u7f16\u8bed\u6cd5\u3002</p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E4%BB%8B%E7%BB%8D/#_3","title":"\u5b9e\u6a21\u5f0f\u7684\u5185\u5b58\u5206\u5e03\u4ecb\u7ecd","text":"<p>8086 \u7684\u5bc4\u5b58\u5668\u90fd\u662f 16 \u4f4d\u7684\uff0c\u4f46\u662f 8086 CPU \u63d0\u4f9b\u4e86 20 \u6839\u5730\u5740\u7ebf\u5373 20 \u4f4d\u7684\u7269\u7406\u5730\u5740\u300216 \u4f4d\u7684\u7269\u7406\u5730\u5740\u53ea\u80fd\u8bbf\u95ee 64KB \u7684\u5185\u5b58\uff0c\u5730\u5740\u8303\u56f4\u662f 0x0000~0xFFFF\uff0c\u5171 65535 \u4e2a\u5b57\u8282\u300220 \u4f4d\u7684\u7269\u7406\u5730\u5740\u53ef\u4ee5\u8bbf\u95ee\u591a\u8fbe 1MB \u7684\u5185\u5b58\uff0c\u5730\u5740\u8303\u56f4\u4ece 0x00000~0xFFFFF\u30028086 CPU \u5728\u83b7\u53d6\u7269\u7406\u5730\u5740\u7684\u65f6\u5019 \u5148\u5c06\u6bb5\u5bc4\u5b58\u5668\u7684\u503c\u5de6\u79fb 4 \u4f4d\uff0c\u5f97\u5230 20 \u4f4d\u7684\u5730\u5740\uff0c\u7136\u540e\u518d\u52a0\u4e0a\u504f\u79fb\u5730\u5740\u5f62\u6210 20 \u4f4d\u7684\u7269\u7406\u5730\u5740\u3002</p> <p>\u6bb5\u5bc4\u5b58\u5668\u662f 16 \u4f4d\u7684\uff0c\u56e0\u6b64\u5728\u4e0d\u91cd\u53e0\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5c06 1MB \u7684\u5185\u5b58\u5206\u6210 65536 \u4e2a\u6bb5\uff0c\u6bcf\u4e2a\u6bb5\u6b63\u597d\u662f 16 \u4e2a\u5b57\u8282\u3002\u6bb5\u7684\u5212\u5206\u662f\u81ea\u7531\u7684\uff0c\u53ef\u4ee5\u8d77\u59cb\u4e0e\u4efb\u4f55 16 \u5b57\u8282 \u5bf9\u5176\u7684\u4f4d\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u662f\u4efb\u610f\u957f\u5ea6\uff0c\u53ea\u8981\u4e0d\u8d85\u8fc7 64KB\u3002\u8fd9\u4e5f\u4f7f\u5f97 8086 \u7684\u5185\u5b58\u8bbf\u95ee\u975e\u5e38\u968f\u610f\uff0c\u540c\u4e00\u4e2a\u7269\u7406\u5730\u5740\u5b9e\u9645\u4e0a\u5bf9\u5e94\u591a\u4e2a\u903b\u8f91\u5730\u5740\u3002</p> <p>IBM \u7684\u673a\u5668 IBM PC 5150\uff0cIBM \u5f00\u53d1\u7684 BIOS\uff0cIBM \u5212\u5206\u5185\u5b58\u7684\u4f7f\u7528\u533a\u57df\u3002\u5f53\u65f6\u8be5\u673a\u5668\u642d\u914d\u7684\u64cd\u4f5c\u7cfb\u7edf 86-DOS \u9700\u8981\u7684\u5185\u5b58\u6700\u5c11\u662f 32KB\uff0c\u5185\u5b58\u5730\u5740\u4ece 0x0000 \u5f00\u59cb\u7f16\u53f7\uff0c 32KB \u7684\u5185\u5b58\u5c31\u662f 0x0000~0x7FFF\u3002 \u4e3a\u4e86\u628a\u5c3d\u91cf\u591a\u7684\u8fde\u7eed\u5185\u5b58\u7559\u7ed9\u64cd\u4f5c\u7cfb\u7edf\uff0cMBR \u7684\u4ee3\u7801\u548c\u6808\u5c31\u88ab\u653e\u5728\u4e86\u6700\u540e 1KB\uff0c\u5373\u4f7f\u540e\u7eed\u5185\u5b58\u589e\u957f\uff0c\u4f46\u662f MBR \u52a0\u8f7d\u533a\u57df\u7684\u4f4d\u7f6e\u4ecd\u88ab\u4fdd\u7559\u4e86\u4e0b\u6765\u3002 <pre><code>+---------------------------------+\n| \u4e2d\u65ad\u5411\u91cf\u8868/0x0000~0x03FF/1KB     |\n+---------------------------------+\n| BIOS \u6570\u636e\u533a\u57df/0x0400~0x04FF/256B |\n+---------------------------------+\n| \u53ef\u7528\u533a\u57df/0x0500~0x7BFF/29.75KB   |\n+---------------------------------+\n| MBR \u52a0\u8f7d\u533a\u57df/0x7C00~0x7DFF/512B  |\n+---------------------------------+\n| MBR \u6808\u7a7a\u95f4/0x7E00~0x7FFF/512B    |\n+---------------------------------+\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E4%BB%8B%E7%BB%8D/#_4","title":"\u4f2a\u6307\u4ee4","text":"<p>\u4f2a\u6307\u4ee4\u5e76\u4e0d\u662f\u771f\u6b63\u7684 x86 \u673a\u5668\u6307\u4ee4\uff0c\u4f7f\u7528\u5b83\u4eec\u53ef\u4ee5\u5e26\u6765\u5f88\u5927\u7684\u65b9\u4fbf\u3002 \u5728 nasm \u7684\u6c47\u7f16\u6e90\u7a0b\u5e8f\u91cc\uff0c\u53ef\u4ee5\u4f7f\u7528 db \u7cfb\u5217\u7684\u4f2a\u6307\u4ee4\u6765\u5b9a\u4e49\u521d\u59cb\u5316\u53d8\u91cf\u3002</p> \u4f2a\u6307\u4ee4 \u6570\u636e\u5bbd\u5ea6 \u7c7b\u578b \u63cf\u8ff0 db \u5b57\u8282 \u6574\u578b \u5b9a\u4e49 byte \u5e8f\u5217 dw \u5b57 \u6574\u578b \u5b9a\u4e49 word \u5e8f\u5217 dd \u53cc\u5b57 \u6574\u578b \u5b9a\u4e49 double word \u5e8f\u5217 dq \u56db\u5b57 \u6574\u578b \u5b9a\u4e49 quad word \u5e8f\u5217 dt 10 bytes \u6d6e\u70b9 \u5b9a\u4e49 80 \u4f4d\u7684 double extended-precision \u5e8f\u5217 dq 16 bytes \u6d6e\u70b9 \u5b9a\u4e49 128 \u4f4d\u7684\u6d6e\u70b9\u6570 <p>\u4f7f\u7528\u65b9\u6cd5\uff1a <pre><code>db    0x55                ; just the byte 0x55\ndb    0x55,0x56,0x57      ; three bytes in succession\ndb    'a',0x55            ; character constants are OK\ndb    'hello',13,10,'$'   ; so are string constants\ndw    0x1234              ; 0x34 0x12\ndw    'a'                 ; 0x61 0x00 (it's just a number)\ndw    'ab'                ; 0x61 0x62 (character constant)\ndw    'abc'               ; 0x61 0x62 0x63 0x00 (string)\ndd    0x12345678          ; 0x78 0x56 0x34 0x12\ndd    1.234567e20         ; floating-point constant\ndq    0x123456789abcdef0  ; eight byte constant\ndq    1.234567e20         ; double-precision float\ndt    1.234567e20         ; extended-precision float\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E4%BB%8B%E7%BB%8D/#_5","title":"\u6570\u5b57\u5e38\u91cf","text":"<p>\u6570\u5b57\u5e38\u91cf\u53ea\u662f\u4e00\u4e2a\u6570\u5b57\uff0cNASM \u5141\u8bb8\u4ee5\u591a\u79cd\u65b9\u5f0f\u6307\u5b9a\u5404\u79cd\u4ee5\u6570\u4e3a\u57fa\u7840\u7684\u6570\u5b57\u3002</p> <p>\u4f7f\u7528\u65b9\u6cd5\uff1a <pre><code>mov     ax,200          ; decimal\uff0c\u5e38\u7528\nmov     ax,0200         ; still decimal\nmov     ax,0200d        ; explicitly decimal\uff0c\u5e38\u7528\nmov     ax,0d200        ; also decimal\nmov     ax,0c8h         ; hex\uff0c\u5e38\u7528\nmov     ax,$0c8         ; hex again: the 0 is required\nmov     ax,0xc8         ; hex yet again\uff0c\u5e38\u7528\nmov     ax,0hc8         ; still hex\nmov     ax,310q         ; octal\nmov     ax,310o         ; octal again\uff0c\u5e38\u7528\nmov     ax,0o310        ; octal yet again\uff0c\u5e38\u7528\nmov     ax,0q310        ; octal yet again\nmov     ax,11001000b    ; binary\nmov     ax,1100_1000b   ; same binary constant\uff0c\u5e38\u7528\nmov     ax,1100_1000y   ; same binary constant once more\nmov     ax,0b1100_1000  ; same binary constant yet again\uff0c\u5e38\u7528\nmov     ax,0y1100_1000  ; same binary constant yet again\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E4%BB%8B%E7%BB%8D/#_6","title":"\u5927\u7aef\u6cd5\u548c\u5c0f\u7aef\u6cd5","text":"<p>\u5728\u51e0\u4e4e\u6240\u6709\u7684\u673a\u5668\u4e0a\uff0c\u591a\u5b57\u8282\u5bf9\u8c61\u88ab\u5b58\u50a8\u4e3a\u8fde\u7eed\u7684\u5b57\u8282\u5e8f\u5217\uff0c\u5bf9\u8c61\u7684\u5730\u5740\u4e3a\u6240\u4f7f\u7528\u5b57\u8282\u4e2d\u6700\u5c0f\u7684\u5730\u5740\u30028086 \u662f\u5c0f\u7aef\u6a21\u5f0f\u3002</p> <p>\u5047\u8bbe\u53d8\u91cf x \u7684\u7c7b\u578b\u4e3a int\uff0c\u4f4d\u4e8e\u5730\u5740 0x100 \u5904\uff0c\u5b83\u7684\u5341\u516d\u8fdb\u5236\u503c\u4e3a 0x01234567\u3002\u5730\u5740\u8303\u56f4 0x100~0x103 \u7684\u5b57\u8282\u987a\u5e8f\u4f9d\u8d56\u4e8e\u673a\u5668\u7684\u7c7b\u578b\uff1a \u5927\u7aef\u6cd5 <pre><code>+-----+------+------+------+------+-----+\n| \u00b7\u00b7\u00b7 | 0x01 | 0x23 | 0x45 | 0x67 | \u00b7\u00b7\u00b7 |\n+-----+------+------+------+------+-----+\n</code></pre></p> <p>\u5c0f\u7aef\u6cd5 <pre><code>+-----+------+------+------+------+-----+\n| \u00b7\u00b7\u00b7 | 0x67 | 0x45 | 0x23 | 0x01 | \u00b7\u00b7\u00b7 |\n+-----+------+------+------+------+-----+\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E4%BB%8B%E7%BB%8D/#_7","title":"\u5bc4\u5b58\u5668\u4ecb\u7ecd","text":"<p>8086 CPU \u6709 14 \u4e2a\u5bc4\u5b58\u5668\uff0c\u90fd\u662f 16 \u4f4d\u7684\uff0c\u53ef\u4ee5\u5b58\u653e\u4e24\u4e2a\u5b57\u8282\u3002</p> <p>Main registers: AX\uff08primary accumulator\uff09\uff0c\u53ef\u4ee5\u5206\u4e3a\u4e24\u4e2a\u72ec\u7acb\u7684 8 \u4f4d\u5bc4\u5b58\u5668 AH \u548c AL\u3002 BX\uff08base\uff0caccumulator\uff09\uff0c\u53ef\u4ee5\u5206\u4e3a\u4e24\u4e2a\u72ec\u7acb\u7684 8 \u4f4d\u5bc4\u5b58\u5668 BH \u548c BL\u3002 CX\uff08counter\uff0caccumulator\uff09\uff0c\u53ef\u4ee5\u5206\u4e3a\u4e24\u4e2a\u72ec\u7acb\u7684 8 \u4f4d\u5bc4\u5b58\u5668 CH \u548c CL\u3002 DX\uff08accumulator\uff0cextended acc\uff09\uff0c\u53ef\u4ee5\u5206\u4e3a\u4e24\u4e2a\u72ec\u7acb\u7684 8 \u4f4d\u5bc4\u5b58\u5668 DH \u548c DL\u3002</p> <p>\u5bc4\u5b58\u5668 AX \u7684\u6570\u636e\u4e3a 1001_1100_0100_0000\uff0c\u90a3\u4e48 AH \u7684\u6570\u636e\u4e3a 1001_1100\uff0cAL \u7684\u6570\u636e\u4e3a 0100_0000\u3002</p> <p>Index registers: SI\uff08Source Index\uff09 DI\uff08Destination Index\uff09 BP\uff08Base Pointer\uff09 SP\uff08Stack Pointer\uff09  </p> <p>Program counter: IP\uff08Instruction Pointer\uff09  </p> <p>Segment registers: CS\uff08Code Segment\uff09 DS\uff08Data Segment\uff09 ES\uff08Extra Segment\uff09 SS\uff08Stack Segment\uff09  </p> <p>Status registers: PSW </p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E4%BB%8B%E7%BB%8D/#_8","title":"\u6570\u636e\u7c7b\u578b","text":"<p>QA\uff1a 1. \u65f6\u949f\u5468\u671f\u3001\u6307\u4ee4\u5468\u671f\u3001CPU \u5468\u671f\u4e4b\u95f4\u7684\u5173\u7cfb\uff1f 2. Intel \u6c47\u7f16\u8bed\u6cd5\u548c AT&amp;T \u6c47\u7f16\u8bed\u6cd5\u6709\u4ec0\u4e48\u533a\u522b\uff1f 3. \u4e3a\u4ec0\u4e48 MBR \u4e0d\u7d27\u51d1\u653e\u5728 BIOS \u6570\u636e\u533a\u57df\u540e\u9762\uff0c\u800c\u662f\u8981\u653e\u5728 32KB \u7684\u6700\u540e\uff1f 4. \u5b9a\u4e49\u53d8\u91cf\u4e3a\u4ec0\u4e48\u662f\u4f2a\u6307\u4ee4\uff1f\u4ec0\u4e48\u662f\u4f2a\u6307\u4ee4\uff1f</p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/","title":"\u6c47\u7f16\u2014\u2014\u73af\u5883\u642d\u5efa","text":"<p>\u5728 Windows \u4e0a\u642d\u5efa\u6c47\u7f16\u8bed\u8a00\u5b66\u4e60\u73af\u5883\u3002</p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#_1","title":"\u9700\u8981\u5b89\u88c5\u7684\u8f6f\u4ef6\uff1a","text":""},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#vscode","title":"VSCode \u4ee3\u7801\u7f16\u8f91\u5668","text":"<p>\u9700\u8981\u5b89\u88c5\u7684\u63d2\u4ef6\uff1a</p> <ul> <li>The Netwide Assembler (NASM) \u63d2\u4ef6\uff0c\u6c47\u7f16\u4ee3\u7801\u9ad8\u4eae\u63d2\u4ef6\u3002</li> <li>Hex Editor \u63d2\u4ef6\uff0c\u80fd\u591f\u4ee5\u5341\u516d\u8fdb\u5236\u67e5\u770b\u548c\u7f16\u8f91\u6587\u4ef6\u3002</li> </ul>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#nasm-x86","title":"NASM x86 \u67b6\u6784\u7684\u6c47\u7f16\u5668","text":""},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#dd","title":"dd \u4e00\u4e2a\u8bfb\u53d6\u8f6c\u6362\u5e76\u8f93\u51fa\u6570\u636e\u7684\u5de5\u5177","text":"<p>\u7528\u6765\u5c06\u6307\u4ee4\u5199\u5165\u78c1\u76d8\u7684\u7b2c\u4e00\u4e2a\u6247\u533a\u3002</p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#bochs-x86","title":"Bochs x86 \u8ba1\u7b97\u673a\u6a21\u62df\u5668","text":"<p>\u7528\u6765\u6a21\u62df x86 \u67b6\u6784\u7684\u8ba1\u7b97\u673a\uff0c\u4e3b\u8981\u5305\u62ec x86CPU\u3001\u901a\u7528\u7684 I/O \u8bbe\u5907\u548c\u81ea\u5b9a\u4e49\u7684 BIOS\u3002\u5176\u9644\u5e26\u7684 <code>bximage</code> \u5de5\u5177\u80fd\u7528\u6765\u521b\u5efa\u78c1\u76d8\u955c\u50cf\u6587\u4ef6\u3002</p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#qemu","title":"QEMU \u53e6\u4e00\u4e2a\u6a21\u62df\u5668","text":"<p>\u4f7f\u7528\u9644\u5e26\u7684 <code>qemu-img</code> \u547d\u4ee4\u6765\u8fdb\u884c\u78c1\u76d8\u955c\u50cf\u6587\u4ef6\u683c\u5f0f\u7684\u8f6c\u6362\uff0c\u5236\u4f5c\u865a\u62df\u673a\uff08Hyper-V\u3001Virtual Box\u3001VMware\uff09\u53ef\u8bc6\u522b\u7684\u865a\u62df\u78c1\u76d8\u3002</p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#mingw64-windows-gcc","title":"mingw64 Windows \u4e0b GCC \u7f16\u8bd1\u5668","text":"<p>\u4f7f\u7528\u9644\u5e26\u7684 make \u8f6f\u4ef6\uff0c\u65b9\u4fbf\u7f16\u8bd1\u3002</p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#rgb","title":"\u6c47\u7f16 <code>RGB</code>","text":"<p>\u5de5\u4f5c\u76ee\u5f55 <code>/computer/assembly</code>\uff0c\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a <pre><code># /computer/assembly\n2023/04/18  13:19             2,483 bochsrc.bxrc\n2023/07/25  13:17        10,321,920 c.img\n2023/07/25  13:17               219 hello.asm\n2023/07/25  13:17               512 hello.bin\n2023/04/24  21:53               112 makefile\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#helloasm","title":"<code>hello.asm</code>","text":"<p>\u7f16\u5199\u6c47\u7f16\u6e90\u7801\u3002 <pre><code>mov ax, 0xb800\nmov ds, ax\n\nmov byte [0], 'R'\nmov byte [1], 0x0C\nmov byte [2], 'G'\nmov byte [3], 0x0A\nmov byte [4], 'B'\nmov byte [5], 0000_1001B\n\nhalt:\njmp halt\n\ntimes 510 - ($ -$$) db 0\ndb 0x55, 0xaa\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#cimg","title":"<code>c.img</code>","text":"<p>\u521b\u5efa\u78c1\u76d8\u955c\u50cf\u6587\u4ef6\uff0c\u7528\u6765\u5f53\u4f5c\u7cfb\u7edf\u542f\u52a8\u76d8\u3002</p> <p>\u547d\u4ee4\u884c\u76f4\u63a5\u8f93\u5165\u547d\u4ee4 <code>bximage</code>\uff0c\u7b2c\u4e00\u6b65\u9009\u62e9 <code>Create new floppy or hard disk image</code>\uff0c\u5176\u5b83\u6b65\u9aa4\u4f7f\u7528\u9ed8\u8ba4\u503c\u5373\u53ef\u3002</p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#makefile","title":"<code>makefile</code>","text":"<p>\u7f16\u5199\u7f16\u8bd1\u914d\u7f6e\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a <pre><code>hello.bin: hello.asm\n    nasm hello.asm -o hello.bin\n\nc.img: hello.bin\n    dd if=hello.bin of=c.img bs=512 count=1\n\nbochs: c.img\n    bochs -q -unlock\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#bochsrcbxrc","title":"<code>bochsrc.bxrc</code>","text":"<p>\u521b\u5efa <code>Bochs</code> \u914d\u7f6e\u6587\u4ef6\uff0c\u9700\u8981\u751f\u6210\u3002\u4f7f\u7528 <code>bochs -q</code> \u547d\u4ee4\uff0c\u9009\u4e2d Configuration -&gt; Save\uff0c\u4fdd\u5b58\u914d\u7f6e\u6587\u4ef6 <code>bochsrc.bxrc</code> \u5230\u5de5\u4f5c\u76ee\u5f55\u5373\u53ef\u3002</p> <p>\u7f16\u8bd1\u914d\u7f6e\u6587\u4ef6\uff0c\u5c06\u539f\u672c\u7684\u5185\u5bb9\u66ff\u6362\u4e3a\u65b0\u7684\u5185\u5bb9\u3002\u65e7\u7684 -&gt; \u65b0\u7684 <pre><code>boot: floppy -&gt; boot: disk\nata0-master: type=none -&gt; ata0-master: type=disk, path=\"c.img\", mode=flat\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#_2","title":"\u8fd0\u884c","text":"<p>\u542f\u52a8\u547d\u4ee4\uff1a<code>make bochs</code></p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#_3","title":"\u8c03\u8bd5","text":""},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#qa","title":"QA:","text":""},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#1-img","title":"1. img \u683c\u5f0f\u7684\u6587\u4ef6\u662f\u4ec0\u4e48\u542b\u4e49\uff1f","text":"<p>\u4f7f\u7528 <code>bximage</code> \u547d\u4ee4\u521b\u5efa\u7684 img \u540e\u7f00\u7684\u6587\u4ef6\u5c5e\u4e8e\u78c1\u76d8\u955c\u50cf\u6587\u4ef6\uff0c\u6587\u4ef6\u7684\u5185\u5bb9\u76f8\u5f53\u4e8e\u4e00\u4e2a\u771f\u5b9e\u7684\u7269\u7406\u78c1\u76d8\u6240\u5305\u542b\u7684\u5168\u90e8\u4fe1\u606f\uff0c\u5305\u62ec\u78c1\u76d8\u6587\u4ef6\u7cfb\u7edf\uff0c\u5f15\u5bfc\u6247\u533a\u548c\u5176\u4ed6\u4fe1\u606f\u3002</p> <p>\u8fd9\u79cd\u78c1\u76d8\u955c\u50cf\u6587\u4ef6\u901a\u5e38\u7528\u6765\u5907\u4efd\u6570\u636e\u6216\u8005\u56de\u6eda\u7cfb\u7edf\u72b6\u6001\uff1b\u4e5f\u53ef\u4ee5\u88ab\u6a21\u62df\u5668\u8f6f\u4ef6\u5f53\u4f5c\u7269\u7406\u78c1\u76d8\u52a0\u8f7d\uff0c\u5411\u5176\u4e2d\u8bfb\u53d6\u6216\u8005\u5199\u5165\u4fe1\u606f\u3002</p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#2","title":"2. \u542f\u52a8\u8ba1\u7b97\u673a\u7684\u6d41\u7a0b\uff1f","text":"<p>\u60f3\u8981\u542f\u52a8\u8ba1\u7b97\u673a\u9996\u5148\u8981\u8ba9\u7cfb\u7edf\u52a0\u8f7d BIOS\uff0cBIOS \u7a0b\u5e8f\u53bb\u52a0\u8f7d CMOS \u7684\u4fe1\u606f\uff0c\u83b7\u53d6\u4e3b\u673a\u7684\u5404\u9879\u786c\u4ef6\u914d\u7f6e\uff1aCPU \u548c\u63a5\u53e3\u7684\u6c9f\u901a\u9891\u7387\u3001\u5f00\u673a\u88c5\u7f6e\u7684\u641c\u5bfb\u987a\u5e8f\u3001\u786c\u76d8\u7684\u5927\u5c0f\u548c\u7c7b\u578b\u3001\u7cfb\u7edf\u65f6\u95f4\u548c\u5404\u4e2a\u63a5\u53e3\u8bbe\u5907    \u5404\u4e2a\u63a5\u53e3\u8bbe\u5907\u7684I/O\u5730\u5740\u7b49\u7b49\u3002</p> <p>\u83b7\u5f97\u8fd9\u4e9b\u4fe1\u606f\u4e4b\u540e\uff0cBIOS \u4f1a\u8fdb\u884c\u5f00\u673a\u81ea\u6211\u6d4b\u8bd5\uff08Power-on Self Test\uff0cPOST\uff0c\u52a0\u7535\u81ea\u68c0\uff09\u3002\u7136\u540e\u5f00\u59cb\u6267\u884c\u786c\u4ef6\u4fa6\u6d4b\u7684\u521d\u59cb\u5316\uff0c\u5e76\u8bbe\u5b9a PnP \u88c5\u7f6e\uff0c\u4e4b\u540e\u518d\u5b9a\u4e49\u51fa\u53ef\u5f00\u673a\u7684\u88c5\u7f6e    \u987a\u5e8f\u3002</p> <p>BIOS \u52a0\u7535\u81ea\u68c0\uff0c\u6307\u5b9a\u5f00\u542f\u542f\u52a8\u76d8\u4e4b\u540e\uff0c\u5c31\u662f\u52a0\u8f7d\u64cd\u4f5c\u7cfb\u7edf\u4e86\u3002\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u6709\u4e0d\u540c\u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u56e0\u6b64 BIOS \u5e76\u4e0d\u8d1f\u8d23\u64cd\u4f5c\u7cfb\u7edf\u7684\u52a0\u8f7d\uff0c\u800c\u662f\u5c06\u52a0\u8f7d\u4efb\u52a1\u4ea4\u7ed9\u5f00\u673a\u7ba1\u7406\u7a0b\u5e8f\u6765\u5904\u7406\u64cd\u4f5c    \u7cfb\u7edf\u6838\u5fc3\u7684\u52a0\u8f7d\uff0cBoot Loader\u3002Boot Loader \u7a0b\u5e8f\u5c31\u5728\u5f00\u542f\u542f\u52a8\u76d8\u7684\u7b2c\u4e00\u4e2a\u6247\u533a\u5185\u3002</p> <p>MBR\uff08Master Boot Record\uff0c\u4e3b\u8981\u5f00\u673a\u8bb0\u5f55\u533a\uff09\u901a\u5e38\u662f\u78c1\u76d8\u7684\u7b2c\u4e00\u4e2a\u6247\u533a\uff0c\u5f00\u673a\u7ba1\u7406\u7a0b\u5e8f\u4e0e\u5206\u533a\u8868\u7edf\u7edf\u653e\u5728\u78c1\u76d8\u7684\u7b2c\u4e00\u4e2a\u6247\u533a\u3002\u5927\u5c0f 512 \u5b57\u8282\uff0c\u5f00\u673a\u7ba1\u7406\u7a0b\u5e8f\u5360\u7528 446 bytes\uff0c\u5206\u533a\u8868\u5360\u7528 64 bytes\u3002    \u6700\u540e\u4e24\u4e2a\u5b57\u8282\u662f 0x55AA\uff0cBIOS \u901a\u8fc7\u8be5\u6807\u8bc6\u786e\u8ba4\u6247\u533a\u4e3a\u5f00\u673a\u7ba1\u7406\u7a0b\u5e8f\u6240\u5728\u7684\u6247\u533a\u3002\u4e4b\u540e BIOS \u5c06\u8be5\u6247\u533a\u7684\u5185\u5bb9\u52a0\u8f7d\u5230\u5185\u5b58 MBR \u52a0\u8f7d\u533a\u57df\uff0c\u5730\u5740\u4e3a 0x7C00~0x7DFF\uff0c\u7136\u540e\u5c06 IP \u5bc4\u5b58\u5668\u7684\u503c\u8bbe\u7f6e\u4e3a 0x7C00\uff0c    \u4e4b\u540e\u5f00\u59cb CPU \u5f00\u59cb\u53d6\u6307\u6267\u884c\u542f\u52a8\u6247\u533a\u7684\u4ee3\u7801\u3002 </p>"},{"location":"ThreeMountains/OS/%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#3","title":"3. \u6c47\u7f16\u4ee3\u7801\u7684\u89e3\u91ca\uff1f","text":""},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/","title":"\u7ebf\u7a0b","text":"","tags":["OS"]},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/#_1","title":"\u4ec0\u4e48\u662f\u7ebf\u7a0b","text":"<p>\u7ecf\u5178\u7684\u89c2\u70b9\u662f\u4e00\u4e2a\u7a0b\u5e8f\u53ea\u6709\u4e00\u4e2a\u6267\u884c\u70b9\uff08\u4e00\u4e2a\u7a0b\u5e8f\u8ba1\u6570\u5668\uff0c\u7528\u6765\u5b58\u653e\u8981\u6267\u884c\u7684\u6307\u4ee4\uff09\uff0c\u4f46\u662f\u591a\u7ebf\u7a0b\uff08multi-threaded\uff09\u7a0b\u5e8f\u4f1a\u6709\u591a\u4e2a\u6267\u884c\u70b9\uff08\u591a\u4e2a\u7a0b\u5e8f\u8ba1\u6570\u5668\uff0c\u6bcf\u4e2a\u90fd\u7528\u4e8e\u53d6\u6307\u4ee4\u548c\u6267\u884c\uff09\u3002\u6362\u4e00\u4e2a\u89d2\u5ea6\u770b\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u7c7b\u4f3c\u4e0e\u72ec\u7acb\u7684\u8fdb\u7a0b\uff0c\u53ea\u6709\u4e00\u70b9\u533a\u522b\uff1a\u5b83\u4eec\u5171\u4eab\u5730\u5740\u7a7a\u95f4\uff0c\u4ece\u800c\u80fd\u591f\u8bbf\u95ee\u76f8\u540c\u7684\u6570\u636e\u3002</p> <p>\u5728\u5927\u591a\u6570\u73b0\u4ee3\u7cfb\u7edf\u4e2d\uff0c\u8fdb\u7a0b\u662f\u8d44\u6e90\u7684\u5206\u914d\u5355\u4f4d\uff0c\u7ebf\u7a0b\u662f\u57fa\u672c\u7684\u8c03\u5ea6\u5355\u4f4d\u3002</p> <p>\u7ebf\u7a0b\u6709\u81ea\u5df1\u7684\u7a0b\u5e8f\u8ba1\u6570\u5668\uff0c\u8bb0\u5f55\u7a0b\u5e8f\u4ece\u54ea\u91cc\u83b7\u53d6\u6307\u4ee4\u3002\u6bcf\u4e2a\u7ebf\u7a0b\u6709\u81ea\u5df1\u7684\u4e00\u7ec4\u7528\u4e8e\u8ba1\u7b97\u7684\u5bc4\u5b58\u5668\u3002\u5982\u679c\u6709\u4e24\u4e2a\u7ebf\u7a0b\u8fd0\u884c\u5728\u4e00\u4e2a\u5904\u7406\u5668\u4e0a\uff0c\u4ece\u4e00\u4e2a\u7ebf\u7a0b\uff08T1\uff09\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u7ebf\u7a0b\uff08T2\uff09\u65f6\u5fc5\u5b9a\u53d1\u751f\u4e0a\u4e0b\u6587\u5207\u6362\uff08context switch\uff09\u3002\u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u9700\u8981\u4fdd\u5b58\u4e00\u4e2a\u6216\u591a\u4e2a\u7ebf\u7a0b\u63a7\u5236\u5757\uff08Thread Control Block\uff0cTCB\uff09\uff0c\u4ece\u800c\u4fdd\u5b58\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u72b6\u6001\u3002\u4f46\u662f\u4e0e\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u76f8\u6bd4\uff0c\u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u5730\u5740\u7a7a\u95f4\u4e0d\u53d8\uff08\u5373\u4e0d\u9700\u8981\u5207\u6362\u5f53\u524d\u4f7f\u7528\u7684\u9875\u8868\uff09\u3002</p> <p>\u5f53\u5728\u8fdb\u7a0b\u4e2d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\u65f6\uff0c\u65b0\u7684\u7ebf\u7a0b\u62e5\u6709\u81ea\u5df1\u7684\u6808\uff08\u56e0\u6b64\u4e5f\u6709\u81ea\u5df1\u7684\u5c40\u90e8\u53d8\u91cf\uff09\u3001\u7a0b\u5e8f\u8ba1\u6570\u5668\uff08PC\uff09\uff0c\u4f46\u4e0e\u5b83\u7684\u521b\u5efa\u8005\u5171\u4eab\u5168\u5c40\u53d8\u91cf\u3001\u6587\u4ef6\u63cf\u8ff0\u7b26\u3001\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u548c\u5f53\u524d\u76ee\u5f55\u72b6\u6001\u3002\u5728\u5355\u7ebf\u7a0b\uff08\u8fdb\u7a0b\uff09\u7684\u5730\u5740\u7a7a\u95f4\u6a21\u578b\u4e2d\uff08\u5de6\uff09\uff0c\u53ea\u6709\u4e00\u4e2a\u6808\uff0c\u901a\u5e38\u4f4d\u4e8e\u5730\u5740\u7a7a\u95f4\u7684\u5e95\u90e8\u3002\u7136\u800c\u5728\u591a\u7ebf\u7a0b\u7684\u8fdb\u7a0b\u4e2d\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u4e00\u4e2a\u6808\uff0c\u5730\u5740\u7a7a\u95f4\u770b\u8d77\u6765\u4f1a\u6709\u4e0d\u540c\uff08\u53f3\uff09\u3002  \u591a\u4e2a\u7ebf\u7a0b\u7834\u574f\u4e86\u5730\u5740\u7a7a\u95f4\u5e03\u5c40\u7684\u7f8e\u611f\uff0c\u4e4b\u524d\u5806\u548c\u6808\u53ef\u4ee5\u4e92\u4e0d\u5f71\u54cd\u5730\u589e\u957f\u76f4\u5230\u5730\u5740\u7a7a\u95f4\u8017\u5c3d\u3002\u591a\u4e2a\u6808\u5c31\u6ca1\u8fd9\u4e48\u7b80\u5355\u4e86\uff0c\u4e0d\u8fc7\u901a\u5e38\u6808\u4e0d\u4f1a\u5f88\u5927\uff08\u9664\u4e86\u5927\u91cf\u4f7f\u7528\u9012\u5f52\u7684\u7a0b\u5e8f\uff09\u3002</p>","tags":["OS"]},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/#_2","title":"\u7ebf\u7a0b\u7684\u4f18\u70b9\u548c\u7f3a\u70b9","text":"","tags":["OS"]},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/#_3","title":"\u4f18\u70b9","text":"<ol> <li>\u4e00\u822c\u800c\u8a00\u7ebf\u7a0b\u4e4b\u95f4\u7684\u5207\u6362\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u505a\u7684\u4e8b\u60c5\u6bd4\u8fdb\u7a0b\u95f4\u7684\u5207\u6362\u5c11\u7684\u591a\uff0c\u56e0\u6b64\u591a\u4e2a\u7ebf\u7a0b\u5bf9\u8d44\u6e90\u7684\u9700\u6c42\u8981\u8fdc\u5c0f\u4e8e\u591a\u8fdb\u7a0b\u3002</li> <li>\u591a\u4e2a\u8fdb\u7a0b\u5fc5\u987b\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u590d\u6742\u673a\u5236\u624d\u80fd\u5b9e\u73b0\u5185\u5b58\u548c\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u5171\u4eab\uff0c\u800c\u591a\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u81ea\u52a8\u7684\u8bbf\u95ee\u76f8\u540c\u7684\u5b58\u50a8\u5730\u5740\u7a7a\u95f4\u548c\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002</li> </ol>","tags":["OS"]},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/#_4","title":"\u7f3a\u70b9","text":"<ol> <li>\u7f16\u5199\u591a\u7ebf\u7a0b\u7684\u7a0b\u5e8f\u9700\u8981\u975e\u5e38\u4ed4\u7ec6\u3002</li> <li>\u5bf9\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u7684\u8c03\u8bd5\u8981\u6bd4\u5bf9\u5355\u7ebf\u7a0b\u7a0b\u5e8f\u7684\u8c03\u8bd5\u56f0\u96be\u7684\u591a\u3002</li> <li>\u6709\u4e9b\u65f6\u5019\u66f4\u591a\u7684\u7ebf\u7a0b\u5e76\u4e0d\u4e00\u5b9a\u8fd0\u884c\u7684\u66f4\u5feb\uff08\u7ebf\u7a0b\u6570\u4e00\u822c\u5e94\u5c0f\u4e8e\u7b49\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u652f\u6301\u7684\u5e76\u884c\u7ebf\u7a0b\u6570\uff0c\u56e0\u4e3a\u8fc7\u591a\u7684\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u6240\u5e26\u6765\u7684\u635f\u8017\u4e5f\u4f1a\u589e\u52a0\uff09\u3002</li> </ol>","tags":["OS"]},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/#api","title":"\u7ebf\u7a0b\u7684 API","text":"","tags":["OS"]},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/#_5","title":"\u521b\u5efa\u7ebf\u7a0b","text":"<p><pre><code>#include &lt;pthread.h&gt;\n\nint pthread_create(pthread_t *thread, pthread_attr *attr, void *(*start_routine) (void *), void *arg);\n</code></pre> \u7b2c\u4e00\u4e2a\u53c2\u6570\u6307\u5411 pthread_t \u7c7b\u578b\u6570\u636e\u7684\u6307\u9488\uff0c\u7ebf\u7a0b\u88ab\u521b\u5efa\u65f6\uff0c\u8fd9\u4e2a\u6307\u9488\u6307\u5411\u7684\u53d8\u91cf\u4e2d\u5c06\u88ab\u5199\u5165\u4e00\u4e2a\u6807\u8bc6\u7b26\uff0c\u6211\u4eec\u7528\u8be5\u6807\u8bc6\u7b26\u6765\u5f15\u7528\u65b0\u7ebf\u7a0b\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7528\u4e8e\u8bbe\u7f6e\u7ebf\u7a0b\u7684\u5c5e\u6027\uff0c\u4e00\u822c\u4e0d\u9700\u8981\u7279\u6b8a\u7684\u5c5e\u6027\uff0c\u8bbe\u7f6e\u4e3a NULL \u5373\u53ef\u3002</p> <p>\u6700\u540e\u4e24\u4e2a\u53c2\u6570\u5206\u522b\u544a\u8bc9\u7ebf\u7a0b\u5c06\u8981\u542f\u52a8\u6267\u884c\u7684\u51fd\u6570\u548c\u4f20\u9012\u7ed9\u8be5\u51fd\u6570\u7684\u53c2\u6570\u3002</p> <p>\u8be5\u51fd\u6570\u8c03\u7528\u6210\u529f\u5c06\u8fd4\u56de 0\uff0c\u5931\u8d25\u5c06\u8fd4\u56de\u9519\u8bef\u4ee3\u7801\u3002</p>","tags":["OS"]},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/#_6","title":"\u7ec8\u6b62\u7ebf\u7a0b","text":"<p>\u7ebf\u7a0b\u901a\u8fc7\u8c03\u7528 pthread_exit \u51fd\u6570\u7ec8\u6b62\u6267\u884c\u3002\u8fd9\u4e2a\u51fd\u6570\u7684\u4f5c\u7528\u662f\uff0c\u7ec8\u6b62\u8c03\u7528\u5b83\u7684\u7ebf\u7a0b\u5e76\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u67d0\u4e2a\u5bf9\u8c61\u7684\u6307\u9488\u3002</p> <p>\u7edd\u4e0d\u80fd\u5411 retval \u4f20\u9012\u4e00\u4e2a\u6307\u5411\u5c40\u90e8\u53d8\u91cf\u7684\u6307\u9488\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u8c03\u7528\u8be5\u51fd\u6570\u540e\uff0c\u8fd9\u4e2a\u5c40\u90e8\u53d8\u91cf\u5c31\u4e0d\u5b58\u5728\u4e86\uff0c\u8fd9\u5c06\u5f15\u8d77\u4e25\u91cd\u7684\u7a0b\u5e8f\u6f0f\u6d1e\u3002</p> <pre><code>#include &lt;pthread.h&gt;\n\nvoid pthread_exit(void *retval);\n</code></pre>","tags":["OS"]},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/#_7","title":"\u7b49\u5f85\u7ebf\u7a0b","text":"<p>pthread_join \u5c06\u963b\u585e\u8c03\u7528\u8be5\u51fd\u6570\u7684\u7ebf\u7a0b\u76f4\u5230\u7b49\u5f85\u7684\u76ee\u6807\u7ebf\u7a0b\u8fd0\u884c\u5b8c\u6210\u3002 <pre><code>#include &lt;stdio.h&gt;\n\nint pthread_join(pthread_t th, void **thread_return);\n</code></pre> \u7b2c\u4e00\u4e2a\u53c2\u6570\u6307\u5b9a\u4e86\u5c06\u8981\u7b49\u5f85\u7684\u7ebf\u7a0b\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u6307\u9488\uff0c\u5b83\u6307\u5411\u53e6\u4e00\u4e2a\u6307\u9488\uff0c\u800c\u540e\u8005\u6307\u5411\u7ebf\u7a0b\u7684\u8fd4\u56de\u503c\u3002</p> <p>\u8be5\u51fd\u6570\u6210\u529f\u8c03\u7528\u5c06\u8fd4\u56de 0\uff0c\u5931\u8d25\u65f6\u8fd4\u56de\u9519\u8bef\u4ee3\u7801\u3002</p>","tags":["OS"]},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/#_8","title":"\u4ee3\u7801\u793a\u4f8b","text":"<pre><code>// main.c\n// \u7f16\u8bd1\uff1a# gcc main.c -pthread -o main\n// \u8fd0\u884c\uff1a# ./main\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;string.h&gt;\n\nvoid *thread_function(void *arg);\n\nchar message[] = \"Hello world!\";\n\nint main() {\n    int res;\n    pthread_t a_thread;\n    void *thread_result;\n\n    res = pthread_create(&amp;a_thread, NULL, thread_function, (void *) message);\n    if(res != 0) {\n        perror(\"Thread create failed!\");\n        exit(EXIT_FAILURE);\n    }\n\n    printf(\"Waiting for thread to finish...\\n\");\n    res = pthread_join(a_thread, &amp;thread_result);\n    if(res != 0) {\n        perror(\"Thread join failed!\");\n        exit(EXIT_FAILURE);\n    }\n\n    printf(\"Thread joined, it returned %s\\n\", (char *) thread_result);\n    printf(\"Message is now %s\\n\", message);\n    exit(EXIT_SUCCESS);\n}\n\nvoid *thread_function(void *arg) {\n    printf(\"Thread function is running. Argument was %s\\n\", (char *) arg);\n    sleep(3);\n    strcpy(message, \"Bye!\");\n    pthread_exit(\"Thank you for CPU tune!\");\n}\n</code></pre>","tags":["OS"]},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/#_9","title":"\u591a\u7ebf\u7a0b\u7684\u5e26\u6765\u7684\u6311\u6218","text":"","tags":["OS"]},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/#_10","title":"\u4e0d\u53ef\u63a7\u7684\u7ebf\u7a0b\u8c03\u5ea6","text":"<p>\u4e00\u65e6\u7ebf\u7a0b\u521b\u5efa\uff0c\u53ef\u80fd\u4f1a\u7acb\u5373\u6267\u884c\uff08\u53d6\u51b3\u4e8e\u8c03\u5ea6\u7a0b\u5e8f\uff09\uff0c\u6216\u8005\u5904\u4e8e\u5c31\u7eea\u72b6\u6001\u7b49\u5f85\u6267\u884c\u3002\u4f8b\u5b50\u4e2d\u6211\u4eec\u521b\u5efa\u4e86\u4e24\u4e2a\u7ebf\u7a0b\uff0c\u5206\u522b\u6253\u5370\u201cA\u201d\u6216\u201cB\u201d\u3002 <pre><code>#include &lt;stdio.h&gt;\n#include &lt;assert.h&gt;\n#include &lt;pthread.h&gt;\n\nvoid *thread_function(void *arg);\n\nint main() {\n    pthread_t a_thread, b_thread;\n    int res;\n\n    printf(\"main: begin\\n\");\n\n    res = pthread_create(&amp;a_thread, NULL, thread_function, \"A\");\n    assert(res == 0);\n    res = pthread_create(&amp;b_thread, NULL, thread_function, \"B\");\n    assert(res == 0);\n\n    res = pthread_join(a_thread, NULL);\n    assert(res == 0);\n    res = pthread_join(b_thread, NULL);\n    assert(res == 0);\n\n    printf(\"main: end\\n\");\n}\n\nvoid *thread_function(void *arg) {\n    printf(\"%s\\n\", (char *) arg);\n    return NULL;\n}\n</code></pre> \u591a\u6b21\u8fd0\u884c\u4e0a\u9762\u7684\u7a0b\u5e8f\u4f1a\u53d1\u73b0\u201cA\u201d\u548c\u201cB\u201d\u8f93\u51fa\u7684\u5148\u540e\u987a\u5e8f\u5e76\u4e0d\u662f\u56fa\u5b9a\u7684\uff0c\u56e0\u4e3a\u591a\u7ebf\u7a0b\u5bfc\u81f4\u6211\u4eec\u5f88\u96be\u8bf4\u7a0b\u5e8f\u4ec0\u4e48\u65f6\u5019\u4f1a\u8fd0\u884c\u4e86\uff0c\u5e76\u53d1\u4f7f\u5f97\u7a0b\u5e8f\u53d8\u5f97\u590d\u6742\u4e86\u3002</p>","tags":["OS"]},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/#_11","title":"\u9519\u8bef\u7684\u5171\u4eab\u6570\u636e","text":"<p>\u63a5\u7740\u6211\u4eec\u6f14\u793a\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u4e24\u4e2a\u7ebf\u7a0b\u5e0c\u671b\u66f4\u65b0\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\u3002\u5168\u5c40\u53d8\u91cf\u662f\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u4e24\u4e2a\u7ebf\u7a0b\u5206\u522b\u5c06\u8ba1\u6570\u5668\u7684\u503c\u589e\u52a0 1000000\u3002 <pre><code>#include &lt;stdio.h&gt;\n#include &lt;assert.h&gt;\n#include &lt;pthread.h&gt;\n\nvoid *thread_function(void *arg);\n\nint volatile counter = 0;\n\nint main() {\n    pthread_t a_thread, b_thread;\n    int res;\n\n    printf(\"main: begin (counter = %d)\\n\", counter);\n\n    res = pthread_create(&amp;a_thread, NULL, thread_function, \"A\");\n    assert(res == 0);\n    res = pthread_create(&amp;b_thread, NULL, thread_function, \"B\");\n    assert(res == 0);\n\n    res = pthread_join(a_thread, NULL);\n    assert(res == 0);\n    res = pthread_join(b_thread, NULL);\n    assert(res == 0);\n\n    printf(\"main: done with both (counter = %d)\\n\", counter);\n}\n\nvoid *thread_function(void *arg) {\n    printf(\"%s begin\\n\", (char *)arg);\n\n    for (int i = 0; i &lt; 1000000; ++i) {\n        counter = counter + 1;\n    }\n\n    printf(\"%s end\\n\", (char *) arg);\n\n    return NULL;\n}\n</code></pre> \u901a\u8fc7\u8fd0\u884c\u4ee3\u7801\uff0c\u5373\u4f7f\u662f\u5728\u5355\u5904\u7406\u5668\u4e0a\u591a\u6b21\u8fd0\u884c\uff0c\u6211\u4eec\u4e5f\u4f1a\u53d1\u73b0\u6700\u7ec8\u7684\u7ed3\u679c\u5927\u6982\u7387\u5c11\u4e8e 2000000\u3002 <pre><code>main: begin (counter = 0)\nA begin\nB begin\nA end\nB end\nmain: done with both (counter = 1711917)\n</code></pre> \u4e3a\u4e86\u7406\u89e3\u4e3a\u4ec0\u4e48\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\uff0c\u901a\u8fc7\u547d\u4ee4 <code>objdump -d main</code> \u83b7\u5f97\u7a0b\u5e8f\u7684\u6c47\u7f16\u6307\u4ee4\u3002\u6211\u4eec\u53ea\u662f\u60f3\u5c06 counter \u52a0 1\uff0c\u5b8c\u6210\u8fd9\u9879\u529f\u80fd\u6240\u9700\u8981\u7684\u6307\u4ee4\u770b\u8d77\u6765\u53ef\u80fd\u50cf\u4e0b\u9762\u8fd9\u6837\uff0c \u6700\u7ec8\u901a\u8fc7\u4e09\u6761\u6c47\u7f16\u6307\u4ee4\u5b8c\u6210\u5c06 counter \u52a0 1 \u7684\u4efb\u52a1\u3002 <pre><code>0000000000401678 &lt;thread_function&gt;:\n\u00b7\u00b7\u00b7\n  40169d:       8b 05 8d 69 00 00       mov    0x698d(%rip),%eax        # 408030 &lt;counter&gt;\n  4016a3:       83 c0 01                add    $0x1,%eax\n  4016a6:       89 05 84 69 00 00       mov    %eax,0x6984(%rip)        # 408030 &lt;counter&gt;\n\u00b7\u00b7\u00b7\n</code></pre> \u8fd9\u4e2a\u4f8b\u5b50\u5047\u5b9a\uff0c\u53d8\u91cf counter \u4f4d\u4e8e\u5730\u5740 0x698d\u3002\u5728\u8fd9\u4e09\u6761\u6307\u4ee4\u4e2d\uff0c\u5148\u7528 mov \u6307\u4ee4\uff0c\u4ece\u5185\u5b58\u5730\u5740\u5904\u53d6\u51fa\u503c\uff0c\u653e\u5165 eax\u3002\u7136\u540e\u7ed9 eax \u5bc4\u5b58\u5668\u7684\u503c\u52a0 1\uff080x1\uff09\u3002 \u6700\u540e eax \u7684\u503c\u88ab\u5b58\u56de\u5185\u5b58\u4e2d\u76f8\u540c\u7684\u5730\u5740\u3002</p> <p>\u5047\u8bbe\u4e24\u4e2a\u7ebf\u7a0b\u4e4b\u4e00\uff08\u7ebf\u7a0b A\uff09\u8fdb\u5165\u8fd9\u4e2a\u4ee3\u7801\u533a\u57df\uff0c\u5c06 counter \u7684\u503c\uff08\u5047\u8bbe\u6b64\u65f6\u662f 50\uff09\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668 eax\u3002\u56e0\u6b64\u7ebf\u7a0b A \u7684 eax=50\uff0c\u7136\u540e\u5411\u5bc4\u5b58\u5668\u52a0 1\uff0c\u6b64\u65f6 eax = 51\u3002 \u73b0\u5728\uff1a\u65f6\u949f\u4e2d\u65ad\u53d1\u751f\u4e86\u3002\u56e0\u6b64\u64cd\u4f5c\u7cfb\u7edf\u5c06\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u7ebf\u7a0b\uff08\u5b83\u7684\u7a0b\u5e8f\u8ba1\u6570\u5668\u3001\u5bc4\u5b58\u5668\uff0c\u5305\u62ec eax \u7b49\uff09\u7684\u72b6\u6001\u4fdd\u5b58\u5230\u7ebf\u7a0b\u7684 TCB\u3002</p> <p>\u63a5\u7740\u7cdf\u7cd5\u7684\u4e8b\u60c5\u53d1\u751f\u4e86\uff0c\u7ebf\u7a0b B \u88ab\u9009\u4e2d\u8fd0\u884c\uff0c\u5e76\u8fdb\u5165\u540c\u4e00\u6bb5\u4ee3\u7801\u3002\u6b64\u65f6 counter \u7684\u503c\u4ecd\u4e3a 50\uff0c\u7136\u540e\u7ebf\u7a0b B \u987a\u5229\u7684\u5c06 counter \u7684\u503c\u52a0 1\u3002\u6b64\u65f6\u5185\u5b58\u4e2d counter \u7684\u503c \u4e3a 51\u3002</p> <p>\u6700\u540e\u53c8\u53d1\u751f\u4e86\u4e00\u6b21\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u7ebf\u7a0b A \u6062\u590d\u8fd0\u884c\u3002\u5b83\u5df2\u7ecf\u6267\u884c\u4e86 mov \u548c add \u6307\u4ee4\uff0c\u56e0\u6b64\u63a5\u4e0b\u6765\u6267\u884c\u6700\u540e\u4e00\u6761 mov \u6307\u4ee4\u3002\u56e0\u4e3a\u4e0a\u6b21\u4e0a\u4e0b\u6587\u5207\u6362\u7ebf\u7a0b A \u7684 eax \u7684\u503c\u4e3a 51\uff0c \u56e0\u6b64\u5728\u6267\u884c\u6700\u540e\u4e00\u6761 move \u6307\u4ee4\u65f6\uff0ccounter \u7684\u503c\u518d\u6b21\u88ab\u8bbe\u7f6e\u4e3a 51\u3002\u53ef\u80fd\u66f4\u7cdf\u7cd5\u7684\u60c5\u51b5\u662f\uff0c\u5728\u7ebf\u7a0b A \u91cd\u65b0\u83b7\u5f97\u8c03\u5ea6\u65f6\uff0c\u7ebf\u7a0b B \u5df2\u7ecf\u5c06 counter \u7684\u503c\u589e\u52a0\u4e86\u591a\u6b21\u3002</p> <p>\u8fd9\u91cc\u5c55\u793a\u7684\u60c5\u51b5\u79f0\u4e3a\u7ade\u6001\u6761\u4ef6\uff08race condition\uff09\uff1a\u7ed3\u679c\u53d6\u51b3\u4e8e\u4ee3\u7801\u7684\u6267\u884c\u65f6\u95f4\u3002</p> <p>\u7531\u4e8e\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u4e86\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u5bfc\u81f4\u6ca1\u6709\u5f97\u5230\u6b63\u786e\u7684\u7ed3\u679c\u3002\u4e8b\u5b9e\u4e0a\u6bcf\u6b21\u6267\u884c\u90fd\u4f1a\u5f97\u5230\u4e0d\u540c\u7684\u7ed3\u679c\u3002\u56e0\u6b64\u6211\u4eec\u79f0\u8fd9\u4e2a\u7ed3\u679c\u662f\u4e0d\u786e\u5b9a\u7684\uff08indeterminate\uff09\u7684\u800c\u4e0d\u662f\u786e\u5b9a\u7684(deterministic)\u3002</p> <p>\u7531\u4e8e\u6267\u884c\u8fd9\u6bb5\u4ee3\u7801\u7684\u591a\u4e2a\u7ebf\u7a0b\u53ef\u80fd\u5bfc\u81f4\u7ade\u4e89\u72b6\u6001\uff0c\u56e0\u6b64\u5c06\u8fd9\u6bb5\u4ee3\u7801\u79f0\u4e3a\u4e34\u754c\u533a\uff08critical section\uff09\u3002</p> <p>\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u4e00\u79cd\u9014\u5f84\u662f\u6709\u7528\u66f4\u5f3a\u5927\u7684\u6307\u4ee4\uff0c\u5355\u6b65\u5c31\u80fd\u5b8c\u6210\u4e0a\u8ff0\u4e09\u6761\u6267\u884c\u5b8c\u6210\u7684\u4e8b\u60c5\u3002\u6bd4\u5982\u6709\u8fd9\u6837\u4e00\u6761\u6307\u4ee4\uff1a <pre><code>memory-add 0x698d 0x1\n</code></pre> \u5047\u8bbe\u8fd9\u6761\u6307\u4ee4\u5c06\u4e00\u4e2a\u503c\u6dfb\u52a0\u5230\u5185\u5b58\u4f4d\u7f6e\uff0c\u5e76\u4e14\u786c\u4ef6\u4fdd\u8bc1\u5b83\u4ee5\u539f\u5b50\u65b9\u5f0f\uff08atomically\uff09\u6267\u884c\u3002\u5f53\u6307\u4ee4\u6267\u884c\u65f6\uff0c\u5b83\u4f1a\u5411\u671f\u671b\u7684\u90a3\u6837\u6267\u884c\u66f4\u65b0\uff0c\u5e76\u4e14\u4fdd\u8bc1\u4e2d\u95f4\u4e0d\u4f1a\u4e2d\u65ad\u3002\u8981\u4e48\u5168\u90e8\u6267\u884c\uff0c \u8981\u4e48\u6ca1\u6709\u6267\u884c\uff0c\u800c\u4e0d\u4f1a\u6709\u4e2d\u95f4\u72b6\u6001\u3002</p> <p>\u4f46\u662f\u4e00\u822c\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u6709\u8fd9\u6837\u7684\u6307\u4ee4\uff0c\u8bbe\u60f3\u6211\u4eec\u8981\u6784\u5efa\u4e00\u4e2a\u5e76\u53d1\u7684\u96c6\u5408\uff0c\u5e76\u5e0c\u671b\u66f4\u65b0\u5b83\u3002\u6211\u4eec\u4f1a\u5e0c\u671b\u786c\u4ef6\u6307\u4ee4\u63d0\u4f9b\u201cB \u6811\u7684\u539f\u5b50\u66f4\u65b0\u201d\u6307\u4ee4\u7801\uff1f\u81f3\u5c11\u7406\u667a\u7684\u6307\u4ee4\u96c6\u4e0d\u4f1a\u63d0\u4f9b\u8fd9\u6837\u7684\u6307\u4ee4\u3002</p> <p>\u6240\u4ee5\u6211\u4eec\u5e0c\u671b\u786c\u4ef6\u80fd\u591f\u63d0\u4f9b\u4e00\u4e9b\u6709\u7528\u7684\u6307\u4ee4\uff0c\u53ef\u4ee5\u5728\u8fd9\u4e9b\u6307\u4ee4\u4e4b\u4e0a\u6784\u5efa\u4e00\u4e2a\u901a\u7528\u7684\u96c6\u5408\uff0c\u5373\u6240\u6240\u8c13\u7684\u540c\u6b65\u539f\u8bed\uff08synchronization primitive\uff09\u3002\u901a\u8fc7\u8fd9\u4e9b\u540c\u6b65\u539f\u8bed\u52a0\u4e0a\u64cd\u4f5c\u7cfb\u7edf\u7684 \u4e00\u4e9b\u5e2e\u52a9\uff08\u7ebf\u7a0b\u8c03\u5ea6\u7684\u63a5\u53e3\uff09\uff0c\u6211\u4eec\u5c06\u80fd\u591f\u6784\u5efa\u591a\u7ebf\u7a0b\u4ee3\u7801\uff0c\u4ee5\u540c\u6b65\u548c\u53d7\u63a7\u7684\u65b9\u5f0f\u8bbf\u95ee\u4e34\u754c\u533a\uff0c\u4ece\u800c\u53ef\u9760\u5730\u4ea7\u751f\u6b63\u786e\u7684\u7ed3\u679c\u2014\u2014\u5c3d\u7ba1\u5e76\u53d1\u5f88\u6709\u6311\u6218\u3002</p> <p>\u540c\u6b65\u539f\u8bed</p> <p>\u4e34\u754c\u533a\uff1a\u662f\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u7684\u4e00\u6bb5\u4ee3\u7801\uff0c\u8d44\u6e90\u901a\u5e38\u662f\u4e00\u4e2a\u53d8\u91cf\u6216\u6570\u636e\u7ed3\u6784\u3002</p> <p>\u7ade\u6001\u6761\u4ef6\uff1a\u51fa\u73b0\u5728\u591a\u4e2a\u6267\u884c\u7ebf\u7a0b\u5927\u81f4\u540c\u65f6\u8fdb\u5165\u4e34\u754c\u533a\u65f6\uff0c\u5b83\u4eec\u90fd\u8bd5\u56fe\u66f4\u65b0\u5171\u4eab\u7684\u8d44\u6e90\uff0c\u5bfc\u81f4\u4e86\u4ee4\u4eba\u60ca\u8bb6\u7684\u7ed3\u679c\u3002</p> <p>\u4e92\u65a5\uff1a\u4e3a\u4e86\u907f\u514d\u7ed3\u679c\u7684\u4e0d\u786e\u5b9a\u6027\uff0c\u7ebf\u7a0b\u5e94\u8be5\u4f7f\u7528\u67d0\u79cd\u4e92\u65a5\uff08mutual exclusion\uff09\u539f\u8bed\u3002\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u5165\u4e34\u754c\u533a\uff0c\u4ece\u800c\u907f\u514d\u51fa\u73b0\u7ade\u6001\uff0c\u5e76\u4ea7\u751f\u786e\u5b9a\u7684\u8f93\u51fa\u3002</p>","tags":["OS"]},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/#_12","title":"\u7b49\u5f85\u4e00\u4e2a\u6761\u4ef6\u6ee1\u8db3","text":"<p>\u9664\u4e86\u5171\u4eab\u53d8\u91cf\u8fd9\u4e00\u79cd\u7ebf\u7a0b\u4e4b\u95f4\u7684\u4ea4\u4e92\u5916\uff0c\u901a\u5e38\u8fd8\u6709\u53e6\u4e00\u79cd\u4ea4\u4e92\uff0c\u5373\u7ebf\u7a0b\u5728\u7ee7\u7eed\u4e4b\u524d\u5fc5\u987b\u7b49\u5f85\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u5b8c\u6210\u67d0\u4e9b\u64cd\u4f5c\u3002</p> <p>pthread_join \u5c31\u662f\u8fd9\u6837\u7684\u4e00\u79cd\u60c5\u51b5\uff0c\u9700\u8981\u7b49\u5f85\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u5b8c\u6210\u624d\u80fd\u7ee7\u7eed\u5f53\u524d\u7ebf\u7a0b\u6267\u884c\u4e0b\u53bb\u3002</p> <p>\u8d34\u5408\u5e94\u7528\u7684\u573a\u666f\u662f\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u6a21\u578b\uff0c\u5f53\u6ca1\u6709\u4e1c\u897f\u53ef\u4ee5\u6d88\u8d39\u7684\u65f6\u5019\u6d88\u8d39\u8005\u9700\u8981\u7b49\u5f85\u751f\u4ea7\u8005\u751f\u4ea7\uff0c\u5f53\u751f\u4ea7\u8fc7\u5269\u7684\u65f6\u5019\u751f\u4ea7\u8005\u9700\u8981\u7b49\u5f85\u6d88\u8d39\u8005\u6d88\u8d39\u3002</p>","tags":["OS"]},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/#_13","title":"\u5e76\u53d1\u7f16\u7a0b\u7684\u7ea6\u675f","text":"<p>\u5f53\u4f7f\u7528 POSIX \u7ebf\u7a0b\u5e93\uff08\u5b9e\u9645\u4e0a\uff0c\u4efb\u4f55\u7ebf\u7a0b\u5e93\uff09\u6765\u6784\u5efa\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u65f6\uff0c\u9700\u8981\u8bb0\u4f4f\u4e00\u4e9b\u5c0f\u800c\u91cd\u8981\u7684\u4e8b\u60c5\u3002  </p> <ul> <li>\u4fdd\u6301\u7b80\u6d01\u3002\u7ebf\u7a0b\u4e4b\u95f4\u7684\u9501\u548c\u4fe1\u53f7\u7684\u4ee3\u7801\u5e94\u8be5\u5c3d\u53ef\u80fd\u7684\u7b80\u6d01\uff0c\u590d\u6742\u7684\u7ebf\u7a0b\u4ea4\u4e92\u5bb9\u6613\u4ea7\u751f\u7f3a\u9677\u3002  </li> <li>\u521d\u59cb\u5316\u9501\u548c\u6761\u4ef6\u53d8\u91cf\u3002  </li> <li>\u68c0\u67e5\u8fd4\u56de\u503c\u3002  </li> <li>\u7ebf\u7a0b\u4e4b\u95f4\u603b\u662f\u901a\u8fc7\u6761\u4ef6\u53d8\u91cf\u53d1\u9001\u4fe1\u53f7\u3002\u5207\u8bb0\u4e0d\u8981\u4f7f\u7528\u6807\u8bb0\u53d8\u91cf\u6765\u540c\u6b65\u3002</li> </ul>","tags":["OS"]},{"location":"ThreeMountains/OS/%E7%BA%BF%E7%A8%8B/#qa","title":"QA","text":"<ol> <li> <p>Java \u4e2d\u7ebf\u7a0b\u6808\u7a7a\u95f4\u9ed8\u8ba4\u7684\u5927\u5c0f\u662f\u591a\u5c11\uff1f\u901a\u8fc7\u4ec0\u4e48\u53c2\u6570\u8fdb\u884c\u8c03\u8282\uff1f</p> <p>\u5728 Linux \u7cfb\u7edf\u4e0a\u901a\u8fc7\u547d\u4ee4 <code>java -XX:+PrintFlagsFinal -version | grep ThreadStackSize</code> \u67e5\u8be2\u9ed8\u8ba4\u6808\u7a7a\u95f4\u7684\u5927\u5c0f\u3002\u5176\u4e2d 1024 \u4ee3\u8868\u9ed8\u8ba4\u7684\u6808\u7a7a\u95f4\u5927\u5c0f\u4e3a 1MB\u3002 <pre><code># java -XX:+PrintFlagsFinal -version | grep ThreadStackSize\n     intx CompilerThreadStackSize                  = 1024                                   {pd product} {default}\n     intx ThreadStackSize                          = 1024                                   {pd product} {default}\n     intx VMThreadStackSize                        = 1024                                   {pd product} {default}\nopenjdk version \"17.0.5\" 2022-10-18\nOpenJDK Runtime Environment Temurin-17.0.5+8 (build 17.0.5+8)\nOpenJDK 64-Bit Server VM Temurin-17.0.5+8 (build 17.0.5+8, mixed mode, sharing)\n</code></pre></p> <p>\u53ef\u4ee5\u901a\u8fc7\u5728\u542f\u52a8 JVM \u547d\u4ee4\u884c\u53c2\u6570\u4e2d\u4f7f\u7528 -Xss \u6765\u6307\u5b9a\u6808\u7a7a\u95f4\u7684\u5927\u5c0f\u3002\u4f8b\u5982\uff0c\u5c06\u6808\u7a7a\u95f4\u7684\u5927\u5c0f\u8bbe\u7f6e\u4e3a 2MB\uff0c\u53ef\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a <pre><code>java -Xss2m MinaClass\n</code></pre></p> </li> <li> <p>\u4e3a\u4ec0\u4e48 pthread_join \u51fd\u6570\u7b2c\u4e8c\u4e2a\u53c2\u6570\u88ab\u5b9a\u4e49\u4e3a\u4e00\u4e2a\u6307\u5411\u6307\u9488\u7684\u6307\u9488\uff1f</p> <p>\u6709\u4e24\u4e2a\u539f\u56e0\u5bfc\u81f4 pthread_join \u51fd\u6570\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u88ab\u5b9a\u4e49\u4e3a\u4e00\u4e2a\u6307\u5411\u6307\u9488\u7684\u6307\u9488\u3002</p> <ul> <li> <p>\u7b2c\u4e00\u4e2a\u539f\u56e0\u662f\u8fd9\u4e2a\u6307\u9488\u6307\u5411\u6211\u4eec\u5e0c\u671b\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u7684\u8fd4\u56de\u503c\uff0c\u56e0\u4e3a\u53e6\u4e00\u4e2a\u51fd\u6570\u53ef\u4ee5\u8fd4\u56de\u4efb\u4f55\u4e1c\u897f\uff0c\u6240\u4ee5\u5b83\u88ab\u5b9a\u4e49\u4e3a\u4e00\u4e2a\u6307\u5411 void \u7684\u6307\u9488\u3002</p> </li> <li> <p>\u7b2c\u4e8c\u4e2a\u539f\u56e0\u662f pthread_join \u51fd\u6570\u6539\u53d8\u4e86\u4f20\u5165\u53c2\u6570\u7684\u503c\uff0c\u6240\u4ee5\u9700\u8981\u4e00\u4e2a\u6307\u5411\u8be5\u503c\uff08\u6307\u5411 void \u7684\u6307\u9488\uff09\u7684\u6307\u9488\u3002</p> </li> </ul> <p>\u9519\u8bef\u7684\u5b9e\u73b0\u65b9\u5f0f\u5728\u65b9\u6cd5\u5185\u90e8\u6539\u53d8\u5f62\u53c2\u7684\u6307\u5411\u5e76\u6ca1\u6709\u5f71\u54cd\u5230\u5b9e\u53c2\u3002\u6b63\u786e\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u5c06\u53c2\u6570\u5b9a\u4e49\u4e3a\u6307\u9488\u7684\u6307\u9488\uff0c\u7136\u540e\u518d\u5c06\u6307\u5411\u5b9e\u53c2\u7684\u6307\u9488\u4f20\u9012\u7ed9\u51fd\u6570\uff0c\u6700\u7ec8\u5c06\u5b9e\u53c2\u6307\u5411\u6b63\u786e\u7684\u7ed3\u679c\u3002 <pre><code>void *thread_result = NULL;\n\n// \u9519\u8bef\u7684\u5b9e\u73b0\u65b9\u5f0f\nres = pthread_join(a_thread, thread_result);\nint pthread_join(Thread thread, void *result) {\n    a_type a = a_typet(); // \u6a21\u62df\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u7684\u8fd4\u56de\u7ed3\u679c\n    result = &amp;a; // \u65b9\u6cd5\u7ed3\u675f\u65f6 thread_result \u6ca1\u6709\u83b7\u5f97\u60f3\u8981\u7684\u7ed3\u679c\uff0c\u5e76\u672a\u6307\u5411 a\n    // \u6700\u7ec8\u7684\u7ed3\u679c\u662f result \u6307\u9488\u6307\u5411 a\uff0cthread_result \u6307\u9488\u6307\u5411 NULL\n}\n\n// \u6b63\u786e\u7684\u5b9e\u73b0\u65b9\u5f0f\nres = pthread_join(a_thread, &amp;thread_result);\nint pthread_join(Thread thread, void **result) {\n    a_type a = a_typet(); // \u6a21\u62df\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u7684\u8fd4\u56de\u7ed3\u679c\n    *result = &amp;a; // \u65b9\u6cd5\u7ed3\u675f\u65f6 thread_result \u83b7\u5f97\u60f3\u8981\u7684\u7ed3\u679c\uff0c\u5373\u6307\u5411 a\n    // \u6700\u7ec8\u7684\u7ed3\u679c\u662f result \u6307\u9488\u6307\u5411 thread_result \u6307\u9488\uff0cthread_result \u6307\u9488\u6307\u5411 a\n}\n</code></pre></p> </li> <li> <p>Java \u5982\u4f55\u83b7\u53d6\u7ebf\u7a0b\u7684\u8fd4\u56de\u503c\uff1f</p> <p>\u5176\u5b9e\u8fd9\u662f\u4e24\u4e2a\u95ee\u9898\uff1f</p> <p>\u4e00\u3001\u5982\u5171\u4eab\u7ebf\u7a0b\u7684\u8fd4\u56de\u503c\uff1f\u901a\u8fc7\u53c2\u6570\u4f20\u5165\u80af\u5b9a\u4e0d\u73b0\u5b9e\u4e86\uff0c\u56e0\u4e3a Java \u4e0d\u80fd\u5b9e\u73b0\u7c7b\u4f3c C \u8bed\u8a00\u7684\u6307\u9488\u7684\u6307\u9488\u8fd9\u79cd\u6548\u679c\u3002\u5e76\u4e14\u8fd9\u79cd\u65b9\u5f0f\u4e5f\u4e0d\u592a\u597d\u652f\u6301\u591a\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u7ed3\u679c\uff0c\u6240\u4ee5\u9700\u8981\u901a\u8fc7\u7ebf\u7a0b\u4e4b\u95f4\u5171\u4eab\u5168\u5c40\u53d8\u91cf\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u3002</p> <p>\u4e8c\u3001\u5982\u4f55\u7b49\u5f85\u76f4\u5230\u67d0\u79cd\u6761\u4ef6\u6210\u7acb\uff08\u8fd9\u91cc\u662f\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\u751f\u6210\u8fd4\u56de\u503c\uff09\u3002\u53c2\u8003\uff08\u5e76\u53d1\u2014\u2014\u6761\u4ef6\u53d8\u91cf\uff09</p> <p>Java \u63d0\u4f9b\u4e86 FutureTask \u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u5176\u5185\u90e8\u5c01\u88c5\u4e86 Callable \u548c\u4e00\u4e2a\u8fd4\u56de\u503c\u5171\u4eab\u5bf9\u8c61\uff0c\u5e76\u4e14\u5b9e\u73b0\u4e86 Runnable \u63a5\u53e3\uff0c\u4ee5\u6b64\u6765\u89e3\u51b3\u7b2c\u4e00\u4e2a\u95ee\u9898\u3002 \u5e95\u5c42\u901a\u8fc7 volatile + CAS + LockSupport.park/LockSupport.unpark \u6765\u5b9e\u73b0\u6761\u4ef6\u53d8\u91cf\u7684\u6548\u679c\uff0c\u4ee5\u6b64\u6765\u89e3\u51b3\u7b2c\u4e8c\u4e2a\u95ee\u9898\u3002</p> </li> </ol>","tags":["OS"]},{"location":"ThreeMountains/OS/%E8%BF%9B%E7%A8%8B/","title":"\u8fdb\u7a0b","text":""},{"location":"ThreeMountains/OS/%E8%BF%9B%E7%A8%8B/#_1","title":"\u8fdb\u7a0b\u7684\u4ecb\u7ecd","text":"<p>\u8fdb\u7a0b\u7684\u975e\u6b63\u5f0f\u5b9a\u4e49\uff1a\u8fdb\u7a0b\u5c31\u662f\u6b63\u5728\u8fd0\u884c\u7684\u7a0b\u5e8f\u3002  </p> <p>\u8fdb\u7a0b\u7684\u6b63\u5f0f\u5b9a\u4e49\u5982\u4e0b \uff0c\u5f15\u81ea <code>IEEE Std 1003.1\u2122-2017</code>\u3002</p> <p>An address space with one or more threads executing within that address space, and the required system resources for those threads.  \u5728\u5730\u5740\u7a7a\u95f4\u4e2d\u6267\u884c\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u7ebf\u7a0b\uff0c\u4ee5\u53ca\u8fd9\u4e9b\u7ebf\u7a0b\u6240\u9700\u7684\u7cfb\u7edf\u8d44\u6e90\u3002 </p> <p>Note: Many of the system resources defined by POSIX.1-2017 are shared among all of the threads within a process. These include the process ID, the parent process ID, process group ID, session membership, real, effective, and saved set-user-ID, real, effective, and saved set-group-ID, supplementary group IDs, current working directory, root directory, file mode creation mask, and file descriptors.   POSIX.1-2017 \u5b9a\u4e49\u7684\u8bb8\u591a\u7cfb\u7edf\u8d44\u6e90\u662f\u5728\u8fdb\u7a0b\u5185\u7684\u7ebf\u7a0b\u4e4b\u95f4\u5171\u4eab\u7684\u3002\u8fd9\u4e9b\u8d44\u6e90\u5305\u62ec\u8fdb\u7a0bID\uff0c\u8fdb\u7a0b\u7ec4ID\uff0c...\uff0c\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\uff0croot \u76ee\u5f55\uff0c\u6587\u4ef6\u521b\u5efa\u9884\u8bbe\u6743\u9650\u548c\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002</p> <p>\u4e86\u89e3\u8fdb\u7a0b\u7684\u673a\u5668\u72b6\u6001 <code>machine state</code> \u53ef\u4ee5\u66f4\u597d\u7684\u7406\u89e3\u8fdb\u7a0b\u7684\u6784\u6210\uff0c\u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6\u53ef\u4ee5\u8bfb\u53d6\u6216\u66f4\u65b0\u7684\u5185\u5bb9\u3002</p> <p>\u8fdb\u7a0b\u7684\u673a\u5668\u72b6\u6001\u6709\u4e00\u4e2a\u660e\u663e\u7684\u7ec4\u6210\u90e8\u5206\uff0c\u5185\u5b58\u3002\u6307\u4ee4\uff0c\u6b63\u5728\u8fd0\u884c\u7684\u7a0b\u5e8f\u8bfb\u53d6\u548c\u5199\u5165\u7684\u6570\u636e\u4e5f\u5728\u5185\u5b58\u4e2d\u3002\u56e0\u6b64\u8fdb\u7a0b\u53ef\u4ee5\u8bbf\u95ee\u7684\u5185\u5b58\uff08\u79f0\u4e3a\u5730\u5740\u7a7a\u95f4\uff0cadress space\uff09\u662f\u8fdb\u7a0b\u7684\u4e00\u90e8\u5206\u3002</p> <p>\u8fdb\u7a0b\u7684\u673a\u5668\u72b6\u6001\u7684\u53e6\u4e00\u90e8\u5206\u662f\u5bc4\u5b58\u5668\u3002\u8bb8\u591a\u6307\u4ee4\u660e\u786e\u5730\u8bfb\u53d6\u6216\u66f4\u65b0\u5bc4\u5b58\u5668\uff0c\u56e0\u6b64\u5bc4\u5b58\u5668\u5bf9\u4e8e\u8fdb\u7a0b\u7684\u6267\u884c\u5f88\u91cd\u8981\u3002</p> <p>\u6700\u540e\uff0c\u7a0b\u5e8f\u4e5f\u7ecf\u5e38\u8bbf\u95ee\u6301\u4e45\u5b58\u50a8\u8bbe\u5907\u3002</p>"},{"location":"ThreeMountains/OS/%E8%BF%9B%E7%A8%8B/#_2","title":"\u8fdb\u7a0b\u7684\u521b\u5efa","text":"<p>\u7a0b\u5e8f\u4e00\u822c\u5b58\u50a8\u5728\u78c1\u76d8\u4e2d\uff0c\u64cd\u4f5c\u7cfb\u7edf\u8fd0\u884c\u8fdb\u7a0b\u7684\u7b2c\u4e00\u4ef6\u4e8b\u5c31\u662f\u5c06\u4ee3\u7801\u548c\u6240\u6709\u9759\u6001\u6570\u636e\uff08\u4f8b\u5982\u521d\u59cb\u5316\u53d8\u91cf\uff09\u52a0\u8f7d\uff08load\uff09\u5230\u5185\u5b58\u4e2d\uff0c\u52a0\u8f7d\u5230\u5730\u5740\u7a7a\u95f4\u4e2d\u3002</p> <p>\u5c06\u4ee3\u7801\u548c\u9759\u6001\u6570\u636e\u52a0\u8f7d\u5230\u5185\u5b58\u4e4b\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5728\u8fd0\u884c\u6b64\u8fdb\u7a0b\u4e4b\u524d\u8fd8\u9700\u8981\u6267\u884c\u4e00\u4e9b\u5176\u5b83\u64cd\u4f5c\u3002\u5fc5\u987b\u4e3a\u7a0b\u5e8f\u7684\u8fd0\u884c\u65f6\u6808\u5206\u914d\u4e00\u4e9b\u5185\u5b58\u3002C \u7a0b\u5e8f\u4f7f\u7528\u6808\u5b58\u653e\u5c40\u90e8\u53d8\u91cf\u3001\u51fd\u6570\u53c2\u6570\u548c\u8fd4\u56de\u5730\u5740\u3002\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u8fd9\u4e9b\u5185\u5b58\uff0c\u5e76\u63d0\u4f9b\u7ed9\u8fdb\u7a0b\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u4e5f\u53ef\u80fd\u4e3a\u7a0b\u5e8f\u7684\u5806\u5206\u914d\u4e00\u4e9b\u5185\u5b58\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u8fd8\u5c06\u6267\u884c\u4e00\u4e9b\u5176\u5b83\u521d\u59cb\u5316\u4efb\u52a1\uff0c\u7279\u522b\u662f\u4e0e I/O \u76f8\u5173\u7684\u4efb\u52a1\u3002\u4f8b\u5982\uff0c\u5728 UNIX \u7cfb\u7edf\u4e2d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6253\u5f00 3 \u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff08file descriptor\uff09\uff0c\u7528\u4e8e\u6807\u51c6\u8f93\u5165\u3001\u8f93\u51fa\u548c\u9519\u8bef\u3002</p> <p>\u901a\u8fc7\u5c06\u4ee3\u7801\u548c\u9759\u6001\u6570\u636e\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u901a\u8fc7\u521b\u5efa\u548c\u521d\u59cb\u5316\u6808\u4ee5\u53ca\u6267\u884c\u4e0e I/O \u8bbe\u7f6e\u76f8\u5173\u7684\u5176\u5b83\u5de5\u4f5c\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e3a\u8fdb\u7a0b\u8fd0\u884c\u505a\u597d\u4e86\u51c6\u5907\u3002\u6700\u540e\u4e00\u9879\u4efb\u52a1\u662f\u542f\u52a8\u7a0b\u5e8f\uff0c\u5728\u5165\u53e3\u5904\u8fd0\u884c\uff0c\u5373 <code>main()</code>\u3002</p>"},{"location":"ThreeMountains/OS/%E8%BF%9B%E7%A8%8B/#_3","title":"\u8fdb\u7a0b\u7684\u72b6\u6001","text":"<p>\u5728\u65e9\u671f\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\uff0c\u8fdb\u7a0b\u53ef\u80fd\u5904\u4e8e\u4ee5\u4e0b 3 \u79cd\u72b6\u6001\u4e4b\u4e00\uff1a</p> <ul> <li> <p>\u8fd0\u884c running\uff1a \u5728\u8fd0\u884c\u72b6\u6001\u4e0b\uff0c\u8fdb\u7a0b\u6b63\u5728\u5904\u7406\u5668\u4e0a\u8fd0\u884c\u3002\u53d1\u8d77 I/O \u8fdb\u5165\u963b\u585e\u72b6\u6001\uff0c\u53d6\u6d88\u8c03\u5ea6\u8fdb\u5165\u5c31\u7eea\u72b6\u6001\u3002</p> </li> <li> <p>\u5c31\u7eea ready\uff1a \u5728\u5c31\u7eea\u72b6\u6001\u4e0b\uff0c\u8fdb\u7a0b\u5df2\u51c6\u5907\u597d\u8fd0\u884c\uff0c\u4f46\u662f\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\uff0c\u7cfb\u7edf\u9009\u62e9\u4e0d\u5728\u6b64\u65f6\u8fd0\u884c\u3002\u8c03\u5ea6\u83b7\u5f97 CPU \u65f6\u95f4\u8fdb\u5165\u8fd0\u884c\u72b6\u6001\u3002</p> </li> <li> <p>\u963b\u585e blocked\uff1a \u5728\u963b\u585e\u72b6\u6001\u4e0b\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u6267\u884c\u4e86\u67d0\u79cd\u64cd\u4f5c\u8fdb\u5165\u963b\u585e\uff0c\u76f4\u5230\u53d1\u751f\u5176\u5b83\u4e8b\u4ef6\u65f6\u624d\u4f1a\u51c6\u5907\u8fd0\u884c\u3002I/O \u5b8c\u6210\u8fdb\u5165\u5c31\u7eea\u72b6\u6001\u3002</p> </li> </ul>"},{"location":"ThreeMountains/OS/%E8%BF%9B%E7%A8%8B/#_4","title":"\u8fdb\u7a0b\u7684\u6570\u636e\u7ed3\u6784","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u6709\u4e00\u4e9b\u5173\u952e\u7684\u6570\u636e\u7ed3\u6784\u6765\u8ddf\u8e2a\u5404\u79cd\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u4f8b\u5982\uff0c\u4e3a\u4e86\u8ddf\u8e2a\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u72b6\u6001\uff0c\u64cd\u4f5c\u7cfb\u7edf\u53ef\u80fd\u4f1a\u4e3a\u6240\u6709\u5c31\u7eea\u7684\u8fdb\u7a0b\u4fdd\u7559\u67d0\u79cd\u8fdb\u7a0b\u5217\u8868\uff08process list\uff09\uff0c\u4ee5\u53ca\u8ddf\u8e2a\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\u7684\u4e00\u4e9b\u9644\u52a0\u4fe1\u606f\u3002\u64cd\u4f5c\u7cfb\u7edf\u8fd8\u5fc5\u987b\u4ee5\u67d0\u79cd\u65b9\u5f0f\u8ddf\u8e2a\u88ab\u963b\u585e\u7684\u8fdb\u7a0b\uff0c\u5f53 I/O \u4e8b\u4ef6\u5b8c\u6210\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5e94\u786e\u4fdd\u5524\u9192\u6b63\u786e\u7684\u8fdb\u7a0b\uff0c\u8ba9\u5b83\u51c6\u672c\u597d\u518d\u6b21\u8fd0\u884c\u3002</p> <p>\u5bf9\u4e8e\u505c\u6b62\u7684\u8fdb\u7a0b\uff0c\u5bc4\u5b58\u5668\u4e0a\u4e0b\u6587\u5c06\u4fdd\u5b58\u5176\u5bc4\u5b58\u5668\u7684\u5185\u5bb9\u3002\u901a\u8fc7\u6062\u590d\u8fd9\u4e9b\u5bc4\u5b58\u5668\uff0c\u5c06\u5b83\u4eec\u7684\u503c\u56de\u653e\u5b9e\u9645\u7269\u7406\u5bc4\u5b58\u5668\u79cd\uff0c\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u6062\u590d\u8fd0\u884c\u8be5\u8fdb\u7a0b\u3002 <pre><code>// the registers xv6 will save and restore\n// to stop and subsequently restart a process\nstrct context {\n    int eip;\n    int esp;\n    int ebx;\n    int ecx;\n    int esi;\n    int edi;\n    int ebp;\n}\n</code></pre></p> <p>\u9664\u4e86\u8fd0\u884c\u3001\u5c31\u7eea\u548c\u963b\u585e\u4e4b\u5916\uff0c\u8fd8\u6709\u5176\u5b83\u4e00\u4e9b\u8fdb\u7a0b\u53ef\u4ee5\u5904\u4e8e\u7684\u72b6\u6001\u3002 <pre><code>// the different states a process can be in\nenum proc_state { UNUSED, EMBROY, SLEEPING, RUNNABLE, RUNNING, ZOMBIE };\n</code></pre></p> <p>\u8fdb\u7a0b\u7684\u6570\u636e\u7ed3\u6784\u3002 <pre><code>// the information xv6 tracks about each process\n// including its register context and state\nstruct proc {\n    char *mem;                // start of process memory\n    uint sz;                  // size of process memory\n    char *kstack;             // bottom of kernel stack for this process\n    enum proc_state state;    // process state\n    int pid;                  // process ID\n    struct proc *parent;      // parent process\n    void *chan;               // if non-zero, sleeping on chan\n    int killed;               // if non-zero, have been killed\n    struct file *ofile[NOFILE];    // open file\n    struct inode *cwd;        // current directory\n    struct context context;   // switch here to run process\n    struct trapframe *tf;     // current interrupt\n}\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E8%BF%9B%E7%A8%8B/#api","title":"\u8fdb\u7a0b\u7684 API","text":"<p>\u6240\u6709\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u90fd\u4ee5\u67d0\u79cd\u5f62\u5f0f\u63d0\u4f9b\u8fd9\u4e9b API\u3002</p> <ul> <li> <p>\u521b\u5efa\uff08create\uff09\uff1a\u64cd\u4f5c\u7cfb\u7edf\u5fc5\u987b\u5305\u542b\u4e00\u4e9b\u521b\u5efa\u65b0\u8fdb\u7a0b\u7684\u65b9\u6cd5\u3002</p> </li> <li> <p>\u9500\u6bc1\uff08destroy\uff09\uff1a\u7531\u4e8e\u5b58\u5728\u521b\u5efa\u8fdb\u7a0b\u7684\u63a5\u53e3\uff0c\u56e0\u6b64\u7cfb\u7edf\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5f3a\u5236\u9500\u6bc1\u8fdb\u7a0b\u7684\u63a5\u53e3\u3002</p> </li> <li> <p>\u7b49\u5f85\uff08wait\uff09\uff1a\u6709\u65f6\u7b49\u5f85\u8fdb\u7a0b\u505c\u6b62\u8fd0\u884c\u662f\u6709\u7528\u7684\uff0c\u56e0\u6b64\u7ecf\u5e38\u63d0\u4f9b\u67d0\u79cd\u7b49\u5f85\u63a5\u53e3\u3002</p> </li> <li> <p>\u5176\u5b83\u63a7\u5236\uff08miscellaneous control\uff09\uff1a\u9664\u4e86\u6740\u6b7b\u6216\u7b49\u5f85\u8fdb\u7a0b\u5916\uff0c\u6709\u65f6\u8fd8\u53ef\u80fd\u6709\u5176\u5b83\u63a7\u5236\u3002\u4f8b\u5982\uff0c\u5927\u591a\u6570\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u67d0\u79cd\u65b9\u6cd5\u6765\u6682\u505c\u8fdb\u7a0b\uff0c\u7136\u540e\u6062\u590d\u3002</p> </li> <li> <p>\u72b6\u6001\uff08status\uff09\uff1a\u901a\u5e38\u4e5f\u6709\u4e00\u4e9b\u63a5\u53e3\u53ef\u4ee5\u83b7\u53d6\u6709\u5173\u8fdb\u7a0b\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u4f8b\u5982\u8fd0\u884c\u4e86\u591a\u957f\u65f6\u95f4\uff0c\u6216\u8005\u5904\u4e8e\u4ec0\u4e48\u72b6\u6001\u3002</p> </li> </ul>"},{"location":"ThreeMountains/OS/%E8%BF%9B%E7%A8%8B/#fork","title":"<code>fork()</code> \u7cfb\u7edf\u8c03\u7528","text":"<p><code>fork()</code> \u7cfb\u7edf\u8c03\u7528\u590d\u5236\u5f53\u524d\u8fdb\u7a0b\uff0c\u5728\u64cd\u4f5c\u7cfb\u7edf\u7684\u8fdb\u7a0b\u8868\u4e2d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8868\u9879\uff0c\u65b0\u8868\u9879\u7684\u8bb8\u591a\u5c5e\u6027\u4e0e\u5f53\u524d\u8fdb\u7a0b\u662f\u76f8\u540c\u7684\u3002\u65b0\u7684\u8fdb\u7a0b\u4e0e\u539f\u8fdb\u7a0b\u51e0\u4e4e\u4e00\u6478\u4e00\u6837\uff0c\u6267\u884c\u7684\u4ee3\u7801\u4e5f\u5b8c\u5168\u76f8\u540c\uff0c\u4f46\u65b0\u7684\u8fdb\u7a0b\u6709\u81ea\u5df1\u7684\u5730\u5740\u7a7a\u95f4\u3001\u73af\u5883\u548c\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002</p> <p>\u5728\u7236\u8fdb\u7a0b\u4e2d <code>fork()</code> \u8c03\u7528\u8fd4\u56de\u7684\u662f\u65b0\u7684\u5b50\u8fdb\u7a0b\u7684 PID\u3002\u65b0\u8fdb\u7a0b\u5c06\u7ee7\u7eed\u6267\u884c\uff0c\u5c31\u50cf\u539f\u8fdb\u7a0b\u4e00\u6837\uff0c\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u5b50\u8fdb\u7a0b\u4e2d\u7684 <code>fork()</code> \u8c03\u7528\u8fd4\u56de\u7684\u662f 0\u3002\u7236\u8fdb\u7a0b\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e00\u70b9\u6765\u5224\u65ad\u8c01\u662f\u7236\u8fdb\u7a0b\uff0c\u8c01\u662f\u5b50\u8fdb\u7a0b\u3002</p> <p>\u5982\u679c <code>fork()</code> \u5931\u8d25\uff0c\u5b83\u5c06\u8fd4\u56de -1\u3002</p> <p>\u4ee3\u7801\u793a\u4f8b\uff1a <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n\nint main() {\n    printf(\"hello world (pid: %d)!\\n\", getpid());\n\n    int rc = fork();\n    if(rc &lt; 0) {\n        fprintf(stderr, \"fork failed\\n\");\n        exit(1);\n    } else if(rc == 0) {\n        printf(\"hello, I am child (pid: %d)\\n\", getpid());\n    } else {\n        printf(\"hello, I am parent of %d (pid: %d)\\n\", rc, getpid());\n    }\n    return 0;\n}\n</code></pre></p> <p>\u8fd0\u884c\u5c06\u770b\u5230\u5982\u4e0b\u8f93\u51fa\uff1a <pre><code># ./a.out \nhello world (pid: 316949)!\nhello, I am parent of 316950 (pid: 316949)\nhello, I am child (pid: 316950)\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E8%BF%9B%E7%A8%8B/#wait","title":"<code>wait()</code> \u7cfb\u7edf\u8c03\u7528","text":"<p>\u5f53 <code>fork()</code> \u7cfb\u7edf\u8c03\u7528\u542f\u52a8\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u65f6\uff0c\u5b50\u8fdb\u7a0b\u5c31\u6709\u4e86\u81ea\u5df1\u7684\u751f\u547d\u5468\u671f\u5e76\u5c06\u72ec\u7acb\u8fd0\u884c\u3002<code>wait()</code> \u7cfb\u7edf\u8c03\u7528\u5c06\u6682\u505c\u7236\u8fdb\u7a0b\u76f4\u5230\u5b83\u7684\u5b50\u8fdb\u7a0b\u7ed3\u675f\u4e3a\u6b62\uff08\u6216\u8005\u66f4\u5b8c\u6574\u7684\u5144\u5f1f\u63a5\u53e3 <code>waitpid()</code>\uff09\u3002</p> <p><code>wait()</code> \u63a5\u53d7\u4e00\u4e2a\u6574\u578b\u6307\u9488\u7c7b\u578b\u7684\u53c2\u6570\uff0c\u5982\u679c\u4e0d\u4e3a\u7a7a\u7684\u8bdd\uff0c\u5b50\u8fdb\u7a0b\u7684\u9000\u51fa\u72b6\u6001\u5c06\u88ab\u5199\u5165\u5b83\u6307\u5411\u7684\u4f4d\u7f6e\u3002</p> <p>\u4ee3\u7801\u793a\u4f8b\uff1a <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/wait.h&gt;\n\nint main() {\n    int subReturn;\n\n    printf(\"hello world (pid: %d)\\n\", getpid());\n    int rc = fork();\n    if(rc &lt; 0) {\n        fprintf(stderr, \"fork failed\\n\");\n        exit(1);\n    } else if(rc == 0) {\n        printf(\"hello, I am child (pid: %d)\\n\", getpid());\n    } else {\n        int wc = wait(&amp;subReturn);\n        printf(\"hello, I am parent of %d (wc: %d) (subReturn: %d) (pid: %d)\\n\", rc, wc, WEXITSTATUS(subReturn), getpid());\n    }\n}\n</code></pre></p> <p>\u8fd0\u884c\u5c06\u770b\u5230\u5982\u4e0b\u8f93\u51fa\uff1a <pre><code># ./a.out \nhello world (pid: 320451)\nhello, I am child (pid: 320452)\nhello, I am parent of 320452 (wc: 320452) (subReturn: 0) (pid: 320451)\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E8%BF%9B%E7%A8%8B/#exec","title":"<code>exec()</code> \u7cfb\u7edf\u8c03\u7528","text":"<p><code>exec()</code> \u7cfb\u5217\u51fd\u6570\u7531\u4e00\u7ec4\u76f8\u5173\u7684\u51fd\u6570\u7ec4\u6210\uff0c\u5b83\u4eec\u5728\u8fdb\u7a0b\u7684\u542f\u52a8\u65b9\u5f0f\u548c\u7a0b\u5e8f\u53c2\u6570\u7684\u8868\u8fbe\u5f0f\u4e0a\u5404\u6709\u4e0d\u540c\u3002<code>exec()</code> \u7cfb\u7edf\u8c03\u7528\u53ef\u4ee5\u628a\u5f53\u524d\u8fdb\u7a0b\u66ff\u6362\u4e3a\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\uff0c\u4ece path \u6216 file \u6307\u5b9a\u7684\u53ef\u6267\u884c\u7a0b\u5e8f\u4e2d\u52a0\u8f7d\u4ee3\u7801\u548c\u9759\u6001\u6570\u636e\uff0c\u5e76\u7528\u5b83\u8986\u5199\u81ea\u5df1\u7684\u4ee3\u7801\u6bb5\uff0c\u5806\u3001\u6808\u53ca\u5176\u5b83\u5185\u5b58\u7a7a\u95f4\u4e5f\u4f1a\u88ab\u91cd\u65b0\u521d\u59cb\u5316\u3002\u7136\u540e\u64cd\u4f5c\u7cfb\u7edf\u5c31\u6267\u884c\u8be5\u7a0b\u5e8f\uff0c\u5c06\u53c2\u6570\u901a\u8fc7argv \u4f20\u9012\u7ed9\u8be5\u8fdb\u7a0b\u3002</p> <p><code>exec()</code> \u7cfb\u7edf\u8c03\u7528\u5e76\u4e0d\u4f1a\u521b\u5efa\u65b0\u7684\u8fdb\u7a0b\uff0c\u800c\u662f\u76f4\u63a5\u5c06\u5f53\u524d\u8fd0\u884c\u7684\u7a0b\u5e8f\u66ff\u6362\u4e3a\u4e0d\u540c\u7684\u8fd0\u884c\u7a0b\u5e8f\u3002\u56e0\u6b64\uff0c\u5bf9 <code>exec()</code> \u7684\u6210\u529f\u8c03\u7528\u6c38\u8fdc\u4e0d\u4f1a\u8fd4\u56de\u3002\u51fa\u73b0\u9519\u8bef\u65f6\uff0c<code>exec()</code> \u5c06\u8fd4\u56de -1\uff0c\u5e76\u4e14\u4f1a\u8bbe\u7f6e\u9519\u8bef\u53d8\u91cf errno\u3002\u7531 <code>exec()</code> \u542f\u52a8\u7684\u201c\u65b0\u8fdb\u7a0b\u201d\uff0cPID\u3001PPID \u548c <code>nice</code> \u503c\u4e0e\u539f\u5148\u7684\u5b8c\u5168\u4e00\u6837\u3002\u5728\u539f\u8fdb\u7a0b\u4e2d\u5df2\u6253\u5f00\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u5728\u201c\u65b0\u8fdb\u7a0b\u201d\u4e2d\u4ecd\u4fdd\u6301\u6253\u5f00\uff0c\u9664\u975e\u5b83\u4eec\u7684 <code>close on exec flag</code> \u88ab\u7f6e\u4f4d\u3002</p> <p>exec() \u7cfb\u5217\u51fd\u6570\u7684\u5b9a\u4e49\uff1a <pre><code>int execl(const char *path, const char *arg0, ..., (char *)0);\nint execlp(const char *file, const char *arg0, ..., (char *)0);\nint execle(const char *path, const char *arg0, ..., (char *)0, char *const envp[]);\n\nint execv(const char *path,  char *const argv[]);\nint execvp(const char *file,  char *const argv[]);\nint execve(const char *path, char *const argv[], char *const envp[]);\n</code></pre></p> <p>\u4ee5\u5b57\u6bcd p \u7ed3\u5c3e\u7684\u51fd\u6570\u901a\u8fc7\u641c\u7d22 PATH \u73af\u5883\u53d8\u91cf\u6765\u67e5\u627e\u65b0\u7a0b\u5e8f\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002\u4ee5 e \u7ed3\u5c3e\u7684\u51fd\u6570\u9700\u8981\u4f20\u9012\u53ef\u6267\u884c\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>// p3.c\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n#include &lt;sys/wait.h&gt;\n\nint main() {\n    printf(\"hello world (pid: %d)\\n\", getpid());\n    int rc = fork();\n    if(rc &lt; 0) {\n        fprintf(stderr, \"fork failed\\n\");\n        exit(1);\n    } else if(rc == 0) {\n        printf(\"hello, I am child (pid: %d)\\n\", getpid());\n        char *myargs[3];\n        myargs[0] = strdup(\"wc\");\n        myargs[1] = strdup(\"p3.c\");\n        myargs[2] = NULL;\n        execvp(myargs[0], myargs);\n        printf(\"this shouldn't print out\");\n    } else {\n        int wc = wait(NULL);\n        printf(\"hello, I am parent of %d (wc: %d) (pid: %d)\\n\", rc, wc, getpid());\n    }\n}\n</code></pre></p> <p>\u8fd0\u884c\u5c06\u770b\u5230\u5982\u4e0b\u8f93\u51fa\uff1a <pre><code># ./a.out \nhello world (pid: 321262)\nhello, I am child (pid: 321263)\n 24  82 677 p3.c\nhello, I am parent of 321263 (wc: 321263) (pid: 321262)\n</code></pre></p>"},{"location":"ThreeMountains/OS/%E8%BF%9B%E7%A8%8B/#api_1","title":"\u4e3a\u4ec0\u4e48\u8fd9\u6837\u8bbe\u8ba1 API","text":"<p>\u8fd9\u79cd\u5206\u79bb fork() \u4ee5\u53ca exec() \u7684\u505a\u6cd5\u5728\u6784\u5efa UNIX shell \u7684\u65f6\u5019\u975e\u5e38\u6709\u7528\uff0c\u56e0\u4e3a\u8fd9\u7ed9\u4e86 shell \u5728 fork \u4e4b\u540e exec \u4e4b\u524d\u8fd0\u884c\u4ee3\u7801\u7684\u673a\u4f1a\uff0c\u8fd9\u4e9b\u4ee3\u7801\u53ef\u4ee5\u5728\u8fd0\u884c\u65b0\u7a0b\u5e8f\u524d\u6539\u53d8\u73af\u5883\uff0c\u4ece\u800c\u8ba9\u4e00\u4e9b\u5217\u6709\u8da3\u7684\u529f\u80fd\u5f88\u5bb9\u5668\u5b9e\u73b0\u3002</p> <p>shell \u4e5f\u662f\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u663e\u793a\u4e00\u4e2a\u63d0\u793a\u7b26\uff0c\u7136\u540e\u7b49\u5f85\u7528\u6237\u8f93\u5165\u3002\u5728\u6267\u884c\u547d\u4ee4\u7684\u65f6\u5019\uff0c\u8c03\u7528 fork() \u521b\u5efa\u65b0\u7684\u8fdb\u7a0b\uff0c\u5e76\u8c03\u7528 exec() \u7684\u67d0\u4e2a\u53d8\u4f53\u6765\u6267\u884c\u8fd9\u4e2a\u7a0b\u5e8f\uff0c\u8c03\u7528 wait() \u7b49\u5f85\u8be5\u547d\u4ee4\u5b8c\u6210\u3002\u5b50\u8fdb\u7a0b\u6267\u884c\u7ed3\u675f\u540e\uff0cshell \u4ece wait() \u8fd4\u56de\u5e76\u518d\u4e00\u6b21\u8f93\u51fa\u4e00\u4e2a\u63d0\u793a\u7b26\uff0c\u7b49\u5f85\u7528\u6237\u8f93\u5165\u4e0b\u4e00\u6761\u547d\u4ee4\u3002</p> <p>\u91cd\u5b9a\u5411\uff0cshell \u5b9e\u73b0\u7ed3\u679c\u91cd\u5b9a\u5411\u7684\u65b9\u5f0f\u4e5f\u5f88\u7b80\u5355\uff0c\u5f53\u5b8c\u6210\u5b50\u8fdb\u7a0b\u7684\u521b\u5efa\u540e\uff0cshell \u5728 exec() \u8c03\u7528\u4e4b\u524d\u5148\u5173\u95ed\u6807\u51c6\u8f93\u51fa\uff0c\u7136\u540e open() \u7cfb\u7edf\u8c03\u7528\u6253\u5f00\u6587\u4ef6\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>// p4.c\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;sys/wait.h&gt;\n\nint main() {\n    int rc = fork();\n    if(rc &lt; 0) {\n        fprintf(stderr, \"fork failed\\n\");\n        exit(1);\n    } else if(rc == 0) {\n        close(STDOUT_FILENO);\n        open(\"./p4.output\", O_CREAT | O_WRONLY | O_TRUNC, S_IRUSR | S_IWUSR | S_IXUSR);\n\n        char *myargs[3];\n        myargs[0] = strdup(\"wc\");\n        myargs[1] = strdup(\"p4.c\");\n        myargs[3] = NULL;\n        execvp(myargs[0], myargs);\n    } else {\n        int wc = wait(NULL);\n    }\n\n    return 0;\n}\n</code></pre></p> <p>\u8fd0\u884c\u5c06\u770b\u5230\u5982\u4e0b\u8f93\u51fa\uff1a <pre><code># ./a.out \n# ls -l\n-rwx------ 1 root root    17 Jul 21 20:15 p4.output\n# cat p4.output \n 26  69 595 p4.c\n</code></pre></p> <p>\u7ba1\u9053\uff0c\u5173\u4e8e\u7ba1\u9053\u4e5f\u662f\u7c7b\u4f3c\uff0c\u4f46\u662f\u7528\u7684\u65f6 pipe() \u7cfb\u7edf\u8c03\u7528\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u7684\u8f93\u51fa\u88ab\u94fe\u63a5\u5230\u4e00\u4e2a\u5185\u6838\u7ba1\u9053\uff08pipe\uff09\u4e0a\uff0c\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u7684\u8f93\u5165\u4e5f\u88ab\u8fde\u63a5\u5230\u4e86\u540c\u4e00\u4e2a\u7ba1\u9053\u4e0a\u3002\u56e0\u6b64\uff0c\u524d\u4e00\u4e2a\u8fdb\u7a0b\u7684\u8f93\u51fa\u65e0\u7f1d\u5730\u4f5c\u4e3a\u540e\u4e00\u4e2a\u8fdb\u7a0b\u7684\u8f93\u5165\uff0c\u8bb8\u591a\u547d\u4ee4\u53ef\u4ee5\u7528\u8fd9\u79cd\u65b9\u5f0f\u4e32\u8054\u5728\u4e00\u8d77\uff0c\u5171\u540c\u5b8c\u6210\u67d0\u9879\u4efb\u52a1\u3002</p>"},{"location":"yolo/YOLO%20Tips/","title":"YOLO Tips","text":""},{"location":"yolo/YOLO%20Tips/#yolo","title":"yolo \u7684\u8bed\u6cd5","text":"<pre><code>yolo TASK MODE ARGS  \n</code></pre> <ul> <li>TASK \u4efb\u52a1\u7c7b\u578b\uff0c\u662f\u53ef\u9009\u7684\uff1a  <ul> <li>detect \u76ee\u6807\u68c0\u6d4b\uff0c\u9ed8\u8ba4\u503c\u3002  </li> <li>segment \u5b9e\u529b\u5206\u5272\u3002  </li> <li>classify \u56fe\u50cf\u5206\u7c7b\u3002  </li> <li>pose \u5173\u952e\u70b9\u68c0\u6d4b\u3002  </li> <li>obb \u5b9a\u5411\u8fb9\u754c\u6846\u68c0\u6d4b\u3002  </li> </ul> </li> <li>MODE \u8fd0\u884c\u6a21\u5f0f\uff0c\u662f\u5fc5\u987b\u7684\uff1a  <ul> <li>train \u8bad\u7ec3\u6a21\u578b\u3002  </li> <li>val \u9a8c\u8bc1\u6a21\u578b\u3002  </li> <li>predict \u63a8\u7406/\u9884\u6d4b\u6a21\u578b\u3002  </li> <li>export \u5bfc\u51fa\u6a21\u578b\u5230\u5176\u5b83\u683c\u5f0f\u3002  </li> <li>track \u76ee\u6807\u8ddf\u8e2a\u3002  </li> <li>benchmark \u57fa\u51c6\u6d4b\u8bd5\u3002  </li> </ul> </li> <li>ARGS \u53c2\u6570\uff0c\u662f\u53ef\u9009\u7684\uff0c\u5f62\u5982\uff1aarg=value\u3002\u5e38\u7528\u7684\u53c2\u6570\uff1a  <ul> <li>model \u6307\u5b9a\u6a21\u578b\u8def\u5f84\u6216\u8005\u540d\u79f0\uff0cmodel=yolo11n.pt\u3002  </li> <li>conf \u7f6e\u4fe1\u5ea6\u9608\u503c\uff0c\u53ea\u4fdd\u7559\u5927\u4e8e\u8be5\u503c\u7684\u7ed3\u679c\uff0cconf=0.5\u3002  </li> <li>source</li> </ul> </li> </ul>"},{"location":"yolo/YOLO%20Tips/#_1","title":"\u7f6e\u4fe1\u5ea6","text":"<p>\u5728\u76ee\u6807\u68c0\u6d4b\u6216\u8005\u56fe\u50cf\u5206\u7c7b\u4e2d\uff0c\u7f6e\u4fe1\u5ea6 Confidence \u662f\u6a21\u578b\u5bf9\u9884\u6d4b\u7ed3\u679c\u7684\u786e\u5b9a\u6027\u7a0b\u5ea6\u7684\u91cf\u5316\u6307\u6807\uff0c\u662f 0~1 \u4e4b\u95f4\u7684\u5c0f\u6570\uff0c\u8868\u793a\u6a21\u578b\u8ba4\u4e3a\u5f53\u524d\u9884\u6d4b\u6b63\u786e\u7684\u6982\u7387\u3002</p> <p>\u63d0\u9ad8\u7f6e\u4fe1\u5ea6\u9608\u503c\uff0c\u4f1a\u51cf\u5c11\u8bef\u68c0\uff0c\u4f46\u662f\u53ef\u80fd\u4f1a\u6f0f\u68c0\u3002 \u964d\u4f4e\u7f6e\u4fe1\u5ea6\u9608\u503c\uff0c\u4f1a\u68c0\u51fa\u66f4\u591a\u76ee\u6807\uff0c\u4f46\u53ef\u80fd\u5305\u542b\u566a\u58f0\u3002</p>"},{"location":"yolo/YOLO%20%E6%95%B0%E6%8D%AE%E9%9B%86%E6%9E%84%E5%BB%BA%E4%B8%8E%E8%AE%AD%E7%BB%83/","title":"YOLO \u6570\u636e\u96c6\u6784\u5efa\u4e0e\u8bad\u7ec3","text":""},{"location":"yolo/YOLO%20%E6%95%B0%E6%8D%AE%E9%9B%86%E6%9E%84%E5%BB%BA%E4%B8%8E%E8%AE%AD%E7%BB%83/#_1","title":"\u51c6\u5907\u6570\u636e\u96c6","text":""},{"location":"yolo/YOLO%20%E6%95%B0%E6%8D%AE%E9%9B%86%E6%9E%84%E5%BB%BA%E4%B8%8E%E8%AE%AD%E7%BB%83/#_2","title":"\u56fe\u7247\u51c6\u5907","text":"<p>\u5982\u679c\u539f\u59cb\u6570\u636e\u662f\u89c6\u9891\uff0c\u9700\u8981\u5148\u8bb2\u89c6\u9891\u4e0b\u8f7d\u4e0b\u6765\uff0c\u7136\u540e\u5bf9\u89c6\u9891\u8fdb\u884c\u62bd\u5e27\u3002\u811a\u672c\uff1a <pre><code>from minio import Minio  \nimport os  \nimport cv2  \nimport logging  \nimport logging.config  \n\n# \u52a0\u8f7d\u5916\u90e8\u65e5\u5fd7\u914d\u7f6e\u6587\u4ef6  \nlogging.config.fileConfig('logging.ini')  \nlogger = logging.getLogger()  \n\nminio_client = Minio(  \n    endpoint=\"192.168.31.157\",   # MinIO \u670d\u52a1\u5730\u5740  \n    access_key=\"xxxx\",        # Access Key  \n    secret_key=\"xxxxxxxxxxx\",        # Secret Key  \n    secure=False                         # \u5982\u679c\u662f https \u6539\u4e3a True)  \n\nbucket_name = \"file-bucket\"  \nobject_path = \"file_path.txt\"  \ndownload_dir = \"./videos\"  \nframe_dir = \"./frames\"  \nos.makedirs(download_dir, exist_ok=True)  \nos.makedirs(frame_dir, exist_ok=True)  \n\ndef download_video(file_path):  \n    local_path = os.path.join(download_dir, file_path.replace(\"/\", \"-\"))  \n    try:  \n        logging.info(f\"\u5f00\u59cb\u4e0b\u8f7d: {file_path} -&gt; {local_path}\")  \n        minio_client.fget_object(bucket_name, file_path, local_path)  \n        logging.info(f\"\u4e0b\u8f7d\u5b8c\u6210: {local_path}\")  \n        return local_path  \n    except Exception as e:  \n        logging.error(f\"\u4e0b\u8f7d\u5931\u8d25: {file_path}\uff0c\u9519\u8bef: {e}\")  \n        return None  \n\ndef extract_frames(video_path, frame_interval=30):  \n    if not video_path or not os.path.exists(video_path):  \n        logging.error(f\"\u62bd\u5e27\u5931\u8d25\uff0c\u6587\u4ef6\u4e0d\u5b58\u5728: {video_path}\")  \n        return  \n    try:  \n        cap = cv2.VideoCapture(video_path)  \n        frame_count = 0  \n        saved_count = 0  \n        while True:  \n            ret, frame = cap.read()  \n            if not ret:  \n                break  \n            if frame_count % frame_interval == 0:  \n                img_name = f\"{os.path.splitext(os.path.basename(video_path))[0]}_frame{frame_count}.jpg\"  \n                img_path = os.path.join(frame_dir, img_name)  \n                cv2.imwrite(img_path, frame)  \n                saved_count += 1  \n            frame_count += 1  \n        cap.release()  \n        logging.info(f\"{os.path.basename(video_path)} \u62bd\u5e27\u5b8c\u6210\uff0c\u5171\u4fdd\u5b58 {saved_count} \u5f20\u56fe\u7247\")  \n    except Exception as e:  \n        logging.error(f\"\u62bd\u5e27\u5931\u8d25: {video_path}\uff0c\u9519\u8bef: {e}\")  \n\nif __name__ == \"__main__\":  \n\n    with open(object_path, \"r\") as f:  \n         for file_path in f:    \n             file_path = file_path.strip()   \n             if not file_path:    \n                 continue    \n             local_video = download_video(file_path)    \n             # extract_frames(local_video)  \n\n    for filename in os.listdir(download_dir):  \n        file_path = os.path.join(download_dir, filename)  \n        extract_frames(file_path)  \n\n    logging.info(\"\u6240\u6709\u4efb\u52a1\u5b8c\u6210\uff01\")\n</code></pre></p> <p>\u65e5\u5fd7\u914d\u7f6e\u6587\u4ef6 logging.ini\uff1a <pre><code>[loggers]  \nkeys=root  \n\n[handlers]  \nkeys=consoleHandler,fileHandler  \n\n[formatters]  \nkeys=formatter  \n\n[logger_root]  \nlevel=INFO  \nhandlers=consoleHandler,fileHandler  \n\n[handler_consoleHandler]  \nclass=StreamHandler  \nlevel=INFO  \nformatter=formatter  \nargs=(sys.stdout,)  \n\n[handler_fileHandler]  \nclass=FileHandler  \nlevel=INFO  \nformatter=formatter  \nargs=('process.log', 'a', 'utf-8')  \n\n[formatter_formatter]  \nformat=%(asctime)s %(levelname)s: %(message)s  \ndatefmt=%Y-%m-%d %H:%M:%S\n</code></pre></p>"},{"location":"yolo/YOLO%20%E6%95%B0%E6%8D%AE%E9%9B%86%E6%9E%84%E5%BB%BA%E4%B8%8E%E8%AE%AD%E7%BB%83/#_3","title":"\u6253\u6807\u7b7e","text":"<p>\u5b89\u88c5 labelimg \u5de5\u5177\uff0c\u7136\u540e\u6267\u884c labelimg \u542f\u52a8\u5373\u53ef\uff1a <pre><code>pip install labelimg\n</code></pre></p> <p>Note</p> <p>labelimg \u5bf9 Python \u73af\u5883\u6bd4\u8f83\u6311\u5254\uff0c\u65b0\u7248 Python\uff083.10 \u53ca\u4ee5\u4e0a\uff09\u53ef\u80fd\u8fd0\u884c\u5931\u8d25\u6216\u51fa\u73b0\u517c\u5bb9\u6027\u95ee\u9898\u3002 \u5efa\u8bae\u4f7f\u7528 conda \u65b0\u5efa\u72ec\u7acb\u7684 <code>labelimg</code> \u73af\u5883\uff08\u63a8\u8350 Python 3.8 \u6216 3.9\uff09\uff0c\u5e76\u5728\u8be5\u73af\u5883\u4e2d\u5b89\u88c5\u548c\u8fd0\u884c LabelImg \u8fdb\u884c\u6570\u636e\u5904\u7406\u3002 \u793a\u4f8b\uff1a <pre><code>conda create -n labelimg python=3.8\nconda activate labelimg\npip install pyqt5 lxml labelImg\nlabelImg\n</code></pre></p> <p>\u6253\u5f00\u76ee\u5f55\u9009\u62e9\u56fe\u7247\u6587\u4ef6\u5939</p> <p>\u9009\u62e9\u56fe\u7247\u6587\u4ef6\u5939\u4e4b\u540e\u5728\u9009\u62e9\u4e00\u4e2a\u76ee\u5f55\uff0c\u7528\u6765\u4fdd\u5b58\u6807\u6ce8\u4fe1\u606f\u3002</p> <p>\u70b9\u51fb\u83dc\u5355 View \u7136\u540e\u9009\u4e2d Auto save mode\u3002</p> <p>\u70b9\u51fb Change save format \u6309\u94ae\uff0c\u5207\u6362\u5230 yolo\u3002</p> <p>\u4f7f\u7528 w \u8fdb\u884c\u6846\u9009\u76ee\u6807\uff0cd \u4e0b\u4e00\u5f20\u56fe\u7247\uff0ca \u4e0a\u4e00\u5f20\u56fe\u7247\u3002</p> <p>\u6807\u6ce8\u5b8c\u6210\u4e4b\u540e\uff0c\u5728\u6807\u6ce8\u4fe1\u606f\u5b58\u50a8\u76ee\u5f55\uff0c\u4f1a\u6709\u4e00\u4e2a classes.txt \u6587\u4ef6\uff0c\u5b58\u50a8\u6807\u7b7e\u5217\u8868\u3002\u7b2c\u4e00\u884c\u7684\u7f16\u53f7\u4e3a 0\uff0c\u4f9d\u6b21\u9012\u589e\u3002</p> <p>\u6bcf\u4e2a\u6807\u6ce8\u56fe\u7247\u5bf9\u5e94\u4e00\u4e2a txt \u6587\u4ef6\uff0c\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u884c\u5bf9\u5e94\u4e00\u4e2a\u76ee\u6807\u6846\uff0c\u683c\u5f0f\u4e3a\uff1a <pre><code>class_id x_center y_center width height\n</code></pre></p> <p>classs_id \u5bf9\u5e94 classes.txt \u91cc\u9762\u7684\u6807\u7b7e\u7f16\u53f7\u3002</p> <p>x_center y_center width height \u8868\u793a\u76ee\u6807\u6846\u7684\u4e2d\u5fc3\u70b9\u548c\u5bbd\u9ad8\uff0c\u53d6\u503c\u8303\u56f4\u90fd\u662f 0\uff5e1\uff0c\u90fd\u662f\u76f8\u5bf9\u503c\uff08\u9664\u4ee5\u56fe\u7247\u7684\u5bbd\u9ad8\uff09\u3002</p>"},{"location":"yolo/YOLO%20%E6%95%B0%E6%8D%AE%E9%9B%86%E6%9E%84%E5%BB%BA%E4%B8%8E%E8%AE%AD%E7%BB%83/#_4","title":"\u6570\u636e\u51c6\u5907","text":"<p>\u6570\u636e\u6807\u6ce8\u5b8c\u6210\u4e4b\u540e\uff0c\u8981\u5bf9\u6570\u636e\u76ee\u5f55\u8fdb\u884c\u6574\u7406\uff0c\u5982\u4e0b\uff1a <pre><code>my_dataset/\n    \u251c\u2500\u2500 images/     // \u5b58\u653e\u56fe\u7247\n    \u2502   \u251c\u2500\u2500 train/     // \u8bad\u7ec3\u96c6\u56fe\u7247\n    \u2502   \u2502   \u251c\u2500\u2500 0001.jpg\n    \u2502   \u2502   \u251c\u2500\u2500 0002.jpg\n    \u2502   \u2502   \u2514\u2500\u2500 ...\n    \u2502   \u251c\u2500\u2500 val/     // \u9a8c\u8bc1\u96c6\u56fe\u7247\n    \u2502       \u251c\u2500\u2500 1001.jpg\n    \u2502       \u251c\u2500\u2500 1002.jpg\n    \u2502       \u2514\u2500\u2500 ...\n    \u251c\u2500\u2500 labels/     // \u5b58\u653e\u6807\u7b7e\n    \u2502   \u251c\u2500\u2500 train/     // \u8bad\u7ec3\u96c6\u6807\u7b7e\u6587\u4ef6\n    \u2502   \u2502   \u251c\u2500\u2500 0001.txt\n    \u2502   \u2502   \u251c\u2500\u2500 0002.txt\n    \u2502   \u2502   \u2514\u2500\u2500 ...\n    \u2502   \u251c\u2500\u2500 val/     // \u9a8c\u8bc1\u96c6\u6807\u7b7e\u6587\u4ef6\n    \u2502       \u251c\u2500\u2500 1001.txt\n    \u2502       \u251c\u2500\u2500 1002.txt\n    \u2502       \u2514\u2500\u2500 ...\n    \u2514\u2500\u2500 data.yaml\n</code></pre></p> <p>Note</p> <ol> <li>\u9700\u8981\u6ce8\u610f\u7684\u662f iamges \u548c labels \u76ee\u5f55\u7ed3\u6784\u5fc5\u987b\u5bf9\u5e94\uff0c\u6587\u4ef6\u540d\u987b\u5b8c\u5168\u4e00\u81f4\uff08\u4e0d\u5305\u62ec\u540e\u7f00\uff09\u3002</li> <li>my_dataset \u9700\u8981\u653e\u5230 datasets \u6587\u4ef6\u5939\u4e0b\u3002</li> </ol> <p>data.yaml \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b <pre><code>train: datasets/my_dataset/images/train\nval: datasets/my_dataset/images/val\ntest: datasets/my_dataset/images/test  # \u53ef\u9009\n\nnames: ['cat', 'dog', 'person']  # \u7c7b\u522b\u540d\u79f0\uff0c\u7d22\u5f15\u4f4d\u7f6e\u5bf9\u5e94 class_id\n</code></pre></p>"},{"location":"yolo/YOLO%20%E6%95%B0%E6%8D%AE%E9%9B%86%E6%9E%84%E5%BB%BA%E4%B8%8E%E8%AE%AD%E7%BB%83/#_5","title":"\u8bad\u7ec3","text":""},{"location":"yolo/YOLO%20%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/","title":"YOLO \u73af\u5883\u642d\u5efa","text":""},{"location":"yolo/YOLO%20%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#_1","title":"\u73af\u5883\u5b89\u88c5","text":"<p>\u5b89\u88c5 Miniconda Mac \u4e0b\u8f7d\u5b89\u88c5\u5305\uff0c\u4e00\u8def\u786e\u8ba4\uff0c\u9ed8\u8ba4\u5b89\u88c5\u76ee\u5f55\uff1a/opt/miniconda3  </p> <p>Note</p> <p>\u6253\u5f00\u7ec8\u7aef\uff0c\u6700\u524d\u9762\u4f1a\u6709 (base) \u5c31\u8bf4\u660e\u5b89\u88c5\u6210\u529f\u3002\u6b64\u65f6\u7ec8\u7aef\u9ed8\u8ba4\u6fc0\u6d3b base \u73af\u5883\uff0c\u6267\u884c\u547d\u4ee4\u53d6\u6d88\u9ed8\u8ba4\u6fc0\u6d3b <code>conda config --set auto_activate_base false</code>\u3002</p> <p>\u6267\u884c\u547d\u4ee4 <code>conda --version</code> \u8fdb\u884c\u9a8c\u8bc1\u3002</p> <p>\u521b\u5efa ultralytics \u73af\u5883 <pre><code>conda create -n ultralytics python=3.12\n</code></pre></p> <p>\u67e5\u770b\u73af\u5883\u5217\u8868 <pre><code>conda env list\n</code></pre></p> <p>\u5207\u6362\u5230 ultralytics \u73af\u5883 <pre><code>conda activate ultralytics\n</code></pre></p> <p>\u5220\u9664 labelimg \u73af\u5883\u53ca\u73af\u5883\u4e2d\u6240\u6709\u7684\u5305 <pre><code>conda remove -n labelimg --all\n</code></pre></p> <p>\u5b89\u88c5 PyTorch <pre><code>pip3 install torch torchvision torchaudio\n</code></pre></p> <p>\u9a8c\u8bc1 PyTorch <pre><code>import torch\nprint(torch.rand(5, 3))\n\n// \u8f93\u51fa\u5982\u4e0b\u5185\u5bb9\u5373\u53ef\ntensor([[0.0279, 0.0617, 0.8465],\n\u00a0 \u00a0 \u00a0 \u00a0 [0.5971, 0.7788, 0.1976],\n\u00a0 \u00a0 \u00a0 \u00a0 [0.9156, 0.4530, 0.5232],\n\u00a0 \u00a0 \u00a0 \u00a0 [0.8783, 0.4915, 0.4486],\n\u00a0 \u00a0 \u00a0 \u00a0 [0.4522, 0.8738, 0.2487]])\n</code></pre></p> <p>\u6e90\u7801\u5b89\u88c5 Ultralytics \u76f4\u63a5\u4e0b\u8f7d Release \u7248\u672c\u7684\u6e90\u7801 https://github.com/ultralytics/ultralytics/releases/tag/v8.3.169</p> <p>\u89e3\u538b\uff0c\u8fdb\u5165\u5230\u76ee\u5f55\uff0c\u6267\u884c\u5b89\u88c5\u547d\u4ee4 <code>pip install -e .</code></p> <p>\u9a8c\u8bc1\u5b89\u88c5\uff0c\u76f4\u63a5\u8f93\u5165\u547d\u4ee4 <code>yolo</code> \u5373\u53ef\u3002</p> <p>\u5b89\u88c5 VsCode \u5b89\u88c5 Python \u548c Jupyter \u4e24\u4e2a\u63d2\u4ef6\u3002</p>"},{"location":"yolo/YOLO%20%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#_2","title":"\u76ee\u6807\u9884\u6d4b","text":"<p>\u4f7f\u7528\u547d\u4ee4 <pre><code>yolo predict model=yolo11n.pt source=ultralytics/assets/bus.jpg\n</code></pre></p> <p>\u4f7f\u7528\u811a\u672c <pre><code>from ultralytics import YOLO\n\nmodel = YOLO('yolo11n.pt')\n\nresults = model(source=\"/Users/jacky/Movies/ASU_1658.MOV\", show=True, conf=0.4, save=True)\n</code></pre></p>"}]}