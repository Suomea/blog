## 什么式正则表达式

正则表达式是一组对正在查找的文本的描述。在 Linux 中“正则表达式”和“模式”是同一样东西。

目前 GNU/Linux 中有两套库可用于正则表达式编程：POSIX 库和 PCRE 库。前者是 Linux 自带的正则表达式库，后者是 Perl 的正则表达式库。PCRE 的功能更加强大。

如果只是需要基本的字符串匹配功能且希望更好的性能，可以选择使用 POSIX 正则表达式。如果需要更强大、更灵活的正则表达式功能，并且能够接受一些性能上的损失，那么 PCRE 是更好的选择。

一个简单的示例，查找“a 开头、t 结尾”的单词。
```shell
grep "^a.*t$" /usr/share/dict/words
```

## 字符集

在正则表达式中“.”用于匹配除换行符之外的任意一个字符，需要注意的是不能匹配空字符。

例如模式 `.at` 能够匹配 “aat”，“cat”，“#.at”，如果想要限定 `at` 之前的一个字符只能是小写字母，可以使用模式 `[a-z]at`。

方括号 `[]` 用于指定一个字符集，无论括号中有多少东西，在实际匹配时只能匹配其中一个字符。  

- `[abc]` 能够匹配 a、b 或 c。
- `[a-zA-Z]` 能够匹配所有的大小写英文字母。
- `[0-9]` 能够匹配数字。

POSIX 还提供了预定义的字符类来匹配某些特定的字符串。

| **类**          | **匹配字符**     |
| -------------- | ------------ |
| `[[:alnum:]]`  | 文字、数字字符      |
| `[[:aplha:]]`  | 字母字符         |
| `[[:lower:]]`  | 小写字母         |
| `[[:upper:]]`  | 大写字母         |
| `[[:digit:]]`  | 小数           |
| `[[:xdigit:]]` | 十六进制数字       |
| `[[:punct:]]`  | 标点符号         |
| `[[:blank:]]`  | 制表符和空格       |
| `[[:space:]]`  | 空格           |
| `[[:cntrl:]]`  | 所有控制符        |
| `[[:print:]]`  | 所有可打印的字符     |
| `[[:graph:]]`  | 除空格外所有可打印的字符 |

## 位置匹配

字符 `^` 和 `$` 分别用于匹配行首和行尾。

模式 `^a[a-z]t$` 用于匹配所有以 `a` 开头、`t` 结尾、`a` 和 `t` 之间包含一个小写字母的行。

## 字符转义

一些字符在模式中有特殊的含义，如 `.` 用于匹配任意一个字符（除换行符）。

如果想要匹配字符 `.` 则需要使用模式 `\.`。
如果想要匹配字符 `[` 则需要使用模式 `\[`。

如果想要匹配字符 `\` 则需要使用模式 `\\`。

## 重复

正则表达式中 `*` 表示在它前面的模式应该重复 0 次或者多次。模式 `^a.*t&` 用于匹配所有以 `a` 开头、以 `t` 结尾的行。

与 `*` 类似的两个元字符是 `+` 和 `？` 。`+` 指定重复一次或更多次；`？` 指定重复 0 次或者一次。

使用花括号 `{}` 可以明确的指定重复的次数。例如，`{3}` 表示重复 3 次，`{3,}` 表示重复 3 次或者更多次，`{3,5}` 表示重复不少于 3 次，不多于 12 次。

## 分组

分组也被称为子表达式、捕获组。

模式 `(or){2,}` 用于匹配所有 `or` 重复了两次或者更多次的行。如果去掉 `or` 两边的括号，那么模式将匹配：字母 `o` 后面紧跟两个或者更多个字母 `r` 的行。

## 反义

模式 `[^y]` 匹配除了 `y` 的任何字符。

模式 `[^aeior]` 匹配除了字母 a、e、i、o、u 的所有字符。

> 需要注意 `^` 有两种用法，在模式的开头时是匹配行的开头；出现在字符集 `[]` 内的开头时，表示否定字符集，即匹配不在集合中的字符。

## 或

模式可以使用 `|` 表示或的意思。

模式 `^h|t$` 可以用来匹配以字母 `h` 开头，或者以字母 `t` 结尾的行。 

## 逆向引用

逆向引用时一种特殊的功能，允许在模式中引用先前捕获的子表达式所匹配的文本。逆向引用使用 `\` 后跟数字来实现，其中数字表示捕获组的编号。

需要注意的是分组（或者称为子表达式、捕获组）是由括号 `()` 括起来的正则表达式的一部分，逆向表达式**只能**引用分组的编号。

模式：`(\w+)\s+\1` 
  
- `(\w+)` 是第一个捕获组，匹配一个或多个单词字符。
- `\s+` 匹配一个或者多个空白字符。
- `\1` 是对第一个捕获组的逆向引用，由于 `\s+` 并不是捕获组，所以不能出现 `\2`（Invalid back reference）。

## QA

1.如果要在命令 grep 中使用元字符：`{}`、`()`、`|`、`+`、`?` 或者其它特殊字符时，需要指定 -E 选项来使用扩展正则表达式。

2.一些转义序列，由 `\` 开头的字符或者字符组合具有特殊的含义。

3.shell 通配符和正则表达式是两个东西，shell 通配符主要用来匹配文件名，功能有限，不支持复杂的逻辑。
shell 通配符支持的匹配模式如下：

- `*` 匹配任意长度的字符。
- `?` 匹配任意单个字符。
- `[abc]` 匹配集合中的任意一个字符。
- `[!abc]` 或者 `[^abc]` 匹配集合中未包含的字符。

4. 转义序列:

| 转义序列 | 含义 |
| ---- | ---- |
| `\w` | 表示单词字符 word character |
| `\s` | 表示空白字符 whitespace character |
| `\d` | 表示数字字符 digit character |
| `\b` | 表示单词边界 word boundary |
| `\B` | 表示非单词边界 non-word boundary |
| `\A` | 表示字符串开始的位置 |
| `\Z` | 表示字符串结束的位置 |
| `\t` | 表示制表符 Tab |
| `\n` | 表示换行符 newline |
| `r` | 表示回车符 carriage return |
