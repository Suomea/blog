---
comments: true
---
Linux 有两种方式设置定时任务，分别是使用 crontab 命令和 Systemd timer。

## crontab
`crontab` 操作的定时任务是由 `cron(crond)` 这个系统服务来控制的，该服务是默认启动的。

### crontab 的语法
```text
crontab [-u username] [-l|-e|-r]
选项与参数：
-u : 
-e : 编辑 crontab 的工作内容
-l : 查看 crontab 的工作内容
-r : 移除所有的 crontab 的工作内容，若要仅移除一项，使用 -e 进行编辑。
```
使用 `crontab -e` 命令会打开一个编辑器，建立定时任务，具体的配置内容会被记录到 `/var/spool/cron/` 这个目录下面，而且是以账号来作为区分的。

具体来说，如果 root 用户使用 `crontab -e` 命令，添加了一个定时任务：
```text
* * * * * echo "hello world!" >> ~/cron.log
```
那么这个任务的的配置信息也就是上面的内容会保存在 `/var/spool/cron/root` 这个文件中，而具体的任务是每一分钟都会往 `/root/cron.log` 追加一行 `hello world!` 文本。

### crontab 的配置
crontab 的配置按行区分，每一行都是一个新的定时任务。每行有六个字段，这六个字段的意义为：

| 代表意义 | 分钟 | 小时 | 天 | 月 | 周 | 指令 |
| :-- | :-- | :-- | :-- | :-- | :-- | :-- |
| 数字范围 | 0-59 | 0-23 | 1-31 | 1-12 | 0-7 | 执行的指令 |

需要注意“周”的值为 `0` 或者 `7` 时，都代表“星期天”的意思！另外还有一些辅助字符，如下：

| 特殊字符 | 代表意思 |
| :-- | :-- |
| * | 代表任何时刻都接受的意思！|
| , | 代表分隔时段的意思。比如要下达的工作是 3:00 与 6:00 执行时，就会是 `0 3,6 * * * command`。|
| - | 代表一段时间范围。比如要下载的工作是 8 点到 12 点之间的每小时 20 分钟都执行一次，就会是 `20 8-12 * * * command`。|
| /n | n 代表数字，表示“每隔 n 单位间隔”的意思，例如每 5 分钟进行一次，就会是：`*/5 * * * * command`。|

几个具体的例子：  
1. 每小时的第 3 和第 15 分执行。
```text
3,15 * * * * command
```
2. 每月 1、10、22 日的 4:25 分执行。
```text
25 4 1,10,22 * * command
```

### 系统级的定时任务
前面介绍的 `crontab -e` 和 `/var/spool/cron/` 是配置和存储用户相关的定时任务的，那么如果是系统级别的定时任务直接编辑 `/etc/crontab` 这个文件就行了。


由于 `cron` 服务的最低侦测限制是 `1` 分钟，所以 `cron` 会每分钟读取一次 `/etc/crontab` 文件与 `/var/spool/cron/` 目录下的内容。

一般来说，`cron` 预设有三个地方会有执行脚本配置文件，分别是：

- /etc/crontab
- /etc/cron.d/*
- /var/spool/cron/*

在这三个地方中，跟系统运作比较有关系的两个配置是放在 /etc/crontab 文件内以及 /etc/cron.d/* 目录内的文件，另外一个就是跟用户自己的工作比较相关的配置了。

### 需要注意的
#### 资源分配不均的问题
当大量使用 `crontab` 的时候，如果每一个流程都在同一个时间点启动的话，那么在这个时间点以及之后的一段时间范围内，系统会变得相当繁忙。我们应当避免这种问题，尽量使用“,”来错开
大量的任务。

#### 周与日月不可同时并存
可以分别以周或者日月为单位作为循环，但是不可以使用“几月几日并且是星期几”的模式。应该也尽量避免这种复杂的模式。

## Systemd timer
待续···


<br/>
